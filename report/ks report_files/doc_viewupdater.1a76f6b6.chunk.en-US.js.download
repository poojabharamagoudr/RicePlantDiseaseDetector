(window.webpackJsonp=window.webpackJsonp||[]).push([[892],{10851:function(e,t,a){"use strict";a.r(t),a.d(t,"defaultUpdater",(function(){return or}));var n=a(1),i=a.n(n),r=a(2),o=a.n(r),s=a(410),c=a(1168),l=a(309),u=a(8),h=a.n(u),d=a(13),p=a.n(d),g=a(310),f=a(3976),v=a(654);var m="1"===Object(v.default)("typolog"),y=Function.prototype;m&&(y=console.log);var k=function(){function e(t,a,n,r,o){i()(this,e),this.init(t,a,n,r,o)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:g.ITRange,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e,t,a,n,i){this.mixin_ITRange_init(e,t),this.host=a,this.breakingPack=n,this.breakingLine=i}},{key:"toString",value:function(){var e="unknown";return e=this.breakingLine?"breakingLine":this.breakingPack?"breakingPack":"rollback","lookahead("+this.begin+"--\x3e"+this.end+") at host("+this.host.layoutName+") of page("+this.host.viewPage.layout_index+") for "+e}}]),e}(),b=function(){function e(){i()(this,e)}return o()(e,null,[{key:"freeLookahead",value:function(e){}},{key:"makeLookaheadOfBreakingLine",value:function(e,t,a){var n=a.range.end-1;return y("[typo] \tMake lookahead("+n+"--\x3e"+e+") at host("+t.layoutName+" of page("+t.viewPage.layout_index+") for breakingLine"),new k(n,e,t,void 0,a)}},{key:"makeLookaheadOfBreakingPack",value:function(e,t,a){var n=a.range.pos+a.range.len;return y("[typo] \tMake lookahead("+n+"--\x3e"+e+") at host("+t.layoutName+") of page("+t.viewPage.layout_index+") for breakingPack"),new k(n,e,t,a)}},{key:"makeLookaheadOfRollback",value:function(e,t,a){return y("[typo] \tMake lookahead("+a+"--\x3e"+e+") at host("+t.layoutName+") of page("+t.viewPage.layout_index+") for rollback"),new k(a,e,t)}}]),e}(),P=function(){function e(){i()(this,e),this.init()}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITToolkit",base:g.ITToolkit,methodName:"init"},{baseName:"ITToolkit",base:g.ITToolkit,methodName:"detachNode"}]}}]),o()(e,[{key:"init",value:function(){this.mixin_ITToolkit_init(g.IT.upper,g.IT.Crossing)}},{key:"detachNode",value:function(e){y("[typo] \tFree "+e),this.mixin_ITToolkit_detachNode(e)}},{key:"collectResumeInfo",value:function(e,t){var a=this,n=e.mate,i=null,r=null,o=null,s=[];Object.assign(t,{breakingPacks:[],breakingLines:[],rollbacks:[]});var c=function(e,t,a){var n=e.find((function(e){return e.host==t}));n?(n.range.begin=Math.min(n.range.begin,a.begin),n.range.end=Math.max(n.range.end,a.end)):e.push({host:t,range:{begin:a.begin,end:a.end}})};return t.implicitLines.forEach((function(e){c(s,e.host,e.range)})),this.forEachHintInRange(e.begin,e.end,(function(e){return i=e._node,r=i.host,i.breakingPack?(t.breakingPacks.push(i),void c(s,r,e)):i.breakingLine?(t.breakingLines.push(i),void c(s,r,e)):void(n(r.getWholePath(),r)&&c(t.rollbacks,r,e))}),g.IT.strictIntersectTest),s.forEach((function(e){(o=a.closureRollback(e.host,e.range,n))&&c(t.rollbacks,e.host,o)})),t.rollbacks.forEach((function(e){(o=a.closureRollback(e.host,e.range,n,!0))&&Object.assign(e.range,o)})),t}},{key:"collectResumeInfoForLocal",value:function(e,t){var a=this,n=e.mate,i=e.localHost,r=null,o=null,s=null;Object.assign(t,{rollbacks:[]});return this.forEachHintInRange(e.begin,e.end,(function(e){var a,s,c;(o=e._node,r=o.host,o.breakingPack)||(o.breakingLine||n(r.getWholePath(),i)&&(a=r,s=e,(c=t.rollbacks.find((function(e){return e.host==a})))?(c.range.begin=Math.min(c.range.begin,s.begin),c.range.end=Math.max(c.range.end,s.end)):t.rollbacks.push({host:a,range:{begin:s.begin,end:s.end}})))})),t.rollbacks.forEach((function(e){(s=a.closureRollback(e.host,e.range,n,!0))&&Object.assign(e.range,s)})),t}},{key:"closureRollback",value:function(e,t,a){for(var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=i,o=null,s=Object.assign({},t),c=function(){var t=!1;return n.forEachHintInRange(s.begin,s.end,(function(e){r?(e.begin<s.begin&&(s.begin=e.begin,t=!0),e.end>s.end&&(s.end=e.end,t=!0)):(t=!0,r=!0,s.begin=e.begin,s.end=e.end,s.end=e.end)}),(function(t,a){return o=a._node,e==o.host&&!o.breakingLine&&!o.breakingPack&&g.IT.strictIntersectTest(t,a)})),t};c(););return r&&s}}]),e}();s.a.mix(k,g.ITRange),s.a.mix(P,g.ITToolkit);var x={All:{all:!0},None:{none:!0}},_=a(411),C=a(6110),w=function(){function e(t){i()(this,e),this.init(t)}return o()(e,[{key:"init",value:function(e){this.data=e,this.document=e.doc,this.glyphpool=e.glyphpool,this.view=e.typoinfo,this.autonum=e.autonum,this.view.updater||(this.view.updater=this),this.lookaheads=new P(g.IT.lower,g.IT.Crossing,!1),this.updateOnIdle=this.updateOnIdle.bind(this),this.document.attachObserver(this),this.document.documentFields.attachObserver(this),this.document.footnotes.attachObserver(this),this.document.endnotes.attachObserver(this),this.document.footnoteBodys.attachObserver(this),this.document.endnoteBodys.attachObserver(this),this.data.fontServer.attachObserver(this),this.data.autonum.attachObserver(this),this.data.fieldManager.attachObserver(this),this.document.viewSettings.attachObserver(this)}},{key:"clearAll",value:function(e){this.resetScheduler(),this.document.detachObserver(this),this.document.documentFields.detachObserver(this),this.data.fontServer.detachObserver(this),this.data.autonum.detachObserver(this),this.data.fieldManager.detachObserver(this),this.document.viewSettings.detachObserver(this),this.document.footnotes.detachObserver(this),this.document.endnotes.detachObserver(this),this.document.footnoteBodys.detachObserver(this),this.document.endnoteBodys.detachObserver(this)}},{key:"getCurrentUsedPages",value:function(){return window.APP.workspace.canvasHandler.getCvsList()}},{key:"schedulerUpdateTask",value:function(){var e=this,t=window.APP.scheduler,a=t.PRIORITY,n=t.taskName.user_blocking_update,i=a.UserBlockingPriority,r=n;t.scheduleCallback(i,{callback:function(){return e.updateOnIdle()},name:r})}},{key:"schedulerLowPriorityTask",value:function(){}},{key:"resetScheduler",value:function(){window.APP.scheduler.reset()}},{key:"makeViewStatus",value:function(e){return{startIndex:e,endIndex:e+1,dataStatus:new f.a(this.data,this.data.glyphpool)}}},{key:"freeViewStatus",value:function(e){Object(f.b)(e.dataStatus)}},{key:"pushView",value:function(){this.autonum.pull()}},{key:"jumpTo",value:function(e,t){e.updatingIndex=t,e.startIndex=Math.min(e.startIndex,t),e.lastPage=t>0?this.view.layout_pages[t-1]:null,e.sectionInfo=this.getSectionInfoAt(t),y("[typo] Jump to page "+t+" at section "+e.sectionInfo.sectionIndex)}},{key:"getSectionInfoAt",value:function(e){var t=this.document.sections,a=0,n={};if(0===e)n.section=t.getSection(0),n.isSecFirstPage=!0,n.section.getAppendPrevSection()?n.pageNum=1:n.pageNum=n.section.getPageNumStart();else if(a=this.view.layout_pages[e-1],this.sectionDone(a)){var i=a.getMainRange(),r=a.mainpages[a.mainpages.length-1],o=t.getSection(r.range.pos);n.section=t.getSection(i.pos+i.len),o===n.section?n.isSecFirstPage=!1:n.isSecFirstPage=!0,n.section.getAppendPrevSection()?n.pageNum=a.pageNum+1:(n.pageNum=n.section.getPageNumStart(),n.isSecFirstPage||(n.pageNum+=1))}else n.section=a.section,n.isSecFirstPage=!1,n.pageNum=a.pageNum+1;return n.sectionIndex=t.indexOf(n.section),n}},{key:"sectionDone",value:function(e){var t=e.getMainRange();if(t){var a=t.pos+t.len,n=this.document.concernRanges[0].pos+this.document.concernRanges[0].len;if(a>=e.section.end||a>=n)return!0}return!1}},{key:"onBeforeInsertText",value:function(e,t,a,n){if(!this.data.doc.useCoreTypo||this.isMobile){y("[typo] on before insert, range:{"+t+", "+t+"}.");var i={begin:t,end:t,lines:[]};this.guessOutdatedTableOnBeforeInsert(i)||this.guessOutdatedFrameOnBeforeInsert(i),this.pendingByOutdatedRange(i)}else this.flagByRange(t,t,(function(e){e.onBeforeInsertText(t,a)}))}},{key:"onInsertText",value:function(e,t,a,n,i){this.data.glyphpool.onInsertText(e,t,a,n),this.lookaheads.expand(t,a.length),this.view.packRanges.expand(t,a.length),this.view.textLineRanges.expand(t,a.length),this.view.tableLineRanges.expand(t,a.length),this.view.frameLineRanges.expand(t,a.length),this.view.shapeCardRanges.expand(t,a.length),this.view.embedShapeRanges.expand(t,a.length),this.view.mathCache&&this.view.mathCache.onInsertText(e,t,a,n)}},{key:"onBeforeDeleteText",value:function(e,t,a){if(!this.data.doc.useCoreTypo||this.isMobile){y("[typo] on before delete, range:{"+t+", "+(t+a.length)+"}.");var n={begin:t,end:t+a.length,lines:[]};this.guessOutdatedTableOnAnchorChanged(n),this.guessOutdatedTableOnBeforeDelete(n),this.guessOutdatedDocumentFieldOnBeforeDelete(n),this.pendingByOutdatedRange(n)}else this.flagByRange(t,t+a.length,(function(e){e.onBeforeDeleteText(t,a)}))}},{key:"onDeleteText",value:function(e,t,a){this.data.glyphpool.onDeleteText(e,t,a),this.lookaheads.remove(t,a.length),this.view.packRanges.remove(t,a.length),this.view.textLineRanges.remove(t,a.length),this.view.tableLineRanges.remove(t,a.length),this.view.frameLineRanges.remove(t,a.length),this.view.shapeCardRanges.remove(t,a.length),this.view.embedShapeRanges.remove(t,a.length),this.view.mathCache&&this.view.mathCache.onDeleteText(e,t,a)}},{key:"onChpxChanged",value:function(e,t){if(this.data.glyphpool.onChpxChanged(e,t),this.view.mathCache&&this.view.mathCache.onChpxChanged(e,t),!this.data.doc.useCoreTypo||this.isMobile){y("[typo] on chpx changed, range:{"+t.pos+", "+(t.pos+t.len)+"}");var a={begin:t.pos,end:t.pos+t.len,lines:[]};this.guessOutdatedTableOnAnchorChanged(a),this.pendingByOutdatedRange(a)}else this.flagByRange(t.pos,t.pos+t.len)}},{key:"onPapxChanged",value:function(e,t,a){if(this.data.glyphpool.onPapxChanged(e,t),this.view.mathCache&&this.view.mathCache.onPapxChanged(e,t),!this.data.doc.useCoreTypo||this.isMobile){y("[typo] on papx changed, range:{"+t.pos+", "+(t.pos+t.len)+"}");var n={begin:t.pos,end:t.pos+t.len,lines:[]};this.guessOutdatedTableOnPapxChanged(n),this.pendingByOutdatedRange(n)}else this.flagByRange(t.pos,t.pos+t.len)}},{key:"onSectionxChanged",value:function(e,t){this.data.doc.useCoreTypo&&!this.isMobile||(y("[typo] on section changed"),this.dropPages(this.view,{from:0,to:this.view.layout_pages.length}),this.view.pageCount=0,delete this.view.secPageCountCache,this.view.secPageCountCache=new Map)}},{key:"onAutoNumChanged",value:function(e,t){!this.data.doc.useCoreTypo||this.isMobile?(y("[typo] on before autonum changed, range:{"+t+"}"),this.pendingByOutdatedRange({begin:t,end:t,lines:[]})):this.flagByRange(t,t)}},{key:"onFontUpdate",value:function(e,t){var a=this;this.view.mathCache&&this.view.mathCache.onFontUpdate(e,t),!this.data.doc.useCoreTypo||this.isMobile?t.forEach((function(e){y("[typo] on font update, range:{"+e.pos+", "+(e.pos+e.len)+"}"),a.pendingByOutdatedRange({begin:e.pos,end:e.pos+e.len,lines:[]})})):t.forEach((function(e){a.flagByRange(e.pos,e.pos+e.len)}))}},{key:"onFieldChanged",value:function(e,t){var a=t.getRange();!this.data.doc.useCoreTypo||this.isMobile?(y("[typo] on chpx changed, range:{"+a.pos+", "+(a.pos+a.len)+"}"),this.pendingByOutdatedField(t)):this.flagByRange(a.pos,a.pos+a.len)}},{key:"onStyleChanged",value:function(e,t,a,n){var i=this;!this.data.doc.useCoreTypo||this.isMobile?t.forEach((function(e){i.pendingByOutdatedRange({begin:e.pos,end:e.pos+e.len,lines:[]})})):t.forEach((function(e){i.flagByRange(e.pos,e.pos+e.len)}))}},{key:"invalidateView",value:function(e,t){if(!this.document.useCoreTypo){t=t||{pos:0,len:this.document.getTextSize()},y("[typo] invalidate view, range: {"+t.pos+", "+(t.pos+t.len)+"}");for(var a=0;a<8;++a){var n=this.document.getSubDocRange(a),i={pos:Math.max(t.pos,n.pos),len:Math.min(t.pos+t.len,n.pos+n.len)-Math.max(t.pos,n.pos)};i.len>0&&this.pendingByOutdatedRange({begin:i.pos,end:i.pos+i.len,lines:[]})}this.view.pagePos=[],this.view.pageWidths=[],this.view.page_heights=[],this.view.outer_rects=[],this.view.pageCount=0,this.view.layout_pages=[]}}},{key:"guessOutdatedTableOnPapxChanged",value:function(e){var t=e.end,a=null;this.view.tableLineRanges.forEachHintInRange(t,t,(function(t){(a=t._node.line).obsoleted=x.All,g.IT.calcBoundary(e,t),e.outdatedTable=!0,e.lines.push(a)}),g.IT.endWithTest)}},{key:"guessOutdatedTableOnBeforeInsert",value:function(e){var t=e.begin,a=e.end,n=!1,i=null;return this.view.tableLineRanges.forEachHintInRange(t,a,(function(t){(i=t._node.line).obsoleted=x.All,g.IT.calcBoundary(e,t),e.lines.push(i),n=!0}),(function(e,a){return a.begin===t&&a._node.line.tablecells[0].merge_type>1})),n}},{key:"guessOutdatedFrameOnBeforeInsert",value:function(e){if(!this.view.frameLineRanges)return!1;var t=e.begin,a=e.end,n=!1,i=null;return this.view.frameLineRanges.forEachHintInRange(t,a,(function(t){i=t._node.line,e.begin=Math.min(e.begin,t.begin),e.lines.push(i),n=!0}),(function(t,a){return a.end===e.begin})),e.end=t+1,n}},{key:"guessOutdatedTableOnBeforeDelete",value:function(e){var t=e.begin,a=e.end,n=!1,i=null,r=function(e,n){var i=n.end;return t<i&&i<=a};return this.view.tableLineRanges.forEachHintInRange(t,a,(function(t){(i=t._node.line).obsoleted=x.All;var a=i.host;a.layoutType===_.DOCLayoutType.TableLine&&r(0,a.range)||(g.IT.calcBoundary(e,t),e.lines.push(i),n=!0)}),r),n}},{key:"guessOutdatedDocumentFieldOnBeforeDelete",value:function(e){var t=e.begin;this.view.textLineRanges.mapInRange(t,t,(function(e){return e._node.line}),(function(e,a){return a.end===t})).forEach((function(e){e.documentFields&&(e.isUpdateRequired=!0)}))}},{key:"guessOutdatedTableOnAnchorChanged",value:function(e){var t=e.begin,a=e.end;this.view.shapeCardRanges&&this.view.shapeCardRanges.forEachHintInRange(t,a,(function(t){var a=t._node;a.isWrap&&!a.layoutInCell&&(g.IT.calcBoundary(e,a.layouter),e.lines.push(a.layouter))}),g.IT.strictContainTest)}},{key:"pendingByOutdatedRange",value:function(e){e.lines=e.lines.concat(this.view.collectTextLines(e)),(e.hostUpdater=this.guessHostUpdater(e))&&(this.makesureOutdatedInfo(e),this.pendingByOutdatedAndResumeInfo(e,this.resumeByLookaheads(e)))}},{key:"pendingByOutdatedField",value:function(e){var t=e.getRange(),a={begin:t.pos,end:t.pos+t.len,lines:[]},n=a.lines.concat(this.view.collectTextLines(a)),i=e.host?e.host.viewPage.section:this.view.layout_pages[0].section;n.forEach((function(t){"SECTIONPAGES"==e.getType()?t.viewPage.section===i&&a.lines.push(t):a.lines.push(t)})),(a.hostUpdater=this.guessHostUpdater(a))&&(this.makesureOutdatedInfo(a),this.pendingByOutdatedAndResumeInfo(a,this.resumeByLookaheads(a)))}},{key:"pendingForLocal",value:function(e){var t={};e.hostUpdater.pendingByRange(e.localHost,e),this.makesureOutdatedInfo(e),this.lookaheads.collectResumeInfoForLocal(e,t),this.pendingByOutdatedAndResumeInfo(e,t)}},{key:"makesureOutdatedInfo",value:function(e){var t=e.hostUpdater,a=t.sceneUpdater,n=null,i=null;e.mate=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return(n=a.selectScenePath(e))&&n==e[e.length-1]&&(i=t.selectScopeInfo(n),!r||r==i.host)?i:null}}},{key:"pendingByOutdatedAndResumeInfo",value:function(e,t){var a=e.hostUpdater,n=a.pageUpdater,i=new Map;this.pendingByRollbacks(e,t),this.obsoleteByOutdatedInfo(i,e),this.obsoleteByBreakingLines(i,e,t),i.forEach((function(e,t){a.pendingByObsoletedPack(t,e)})),t.breakingPacks&&t.breakingPacks.forEach((function(e){var t=e.host,a=e.breakingPack;a.lookahead&&n.selectHostUpdaterByWholePath(a.getWholePath()).pendingForUnpack(a,t)}))}},{key:"guessHostUpdater",value:function(e){var t=this.preferTextLine(e);return t?(e.wholePathForGuess=t.getWholePath(),this.selectPageUpdater(e.wholePathForGuess[0]).guessSceneUpdater(e).guessHostUpdater(e)):this.maxUpdatedPos&&this.maxUpdatedPos<=e.begin?this.contentUpdater:null}},{key:"preferTextLine",value:function(e){return e.lines[0]}},{key:"resumeByLookaheads",value:function(e){var t={};return this.collectImplicitResumeInfo(e,t),this.lookaheads.collectResumeInfo(e,t),t}},{key:"collectImplicitResumeInfo",value:function(e,t){var a=e.begin;t.implicitLines=this.view.textLineRanges.mapInRange(a,a,(function(e){return e._node.line}),(function(e,t){return t._node.line.implicitLookahead&&g.IT.endWithTest(e,t)}))}},{key:"obsoleteByOutdatedInfo",value:function(e,t){var a=t.mate;t.lines&&t.lines.forEach((function(t){var n=a(t.getWholePath());n&&n.line&&(n.line.obsoleted=x.All,e.set(n.pack,n.host))}))}},{key:"obsoleteByBreakingLines",value:function(e,t,a){var n=null,i=t.mate;a.implicitLines&&a.implicitLines.forEach((function(t){var a=i(t.getWholePath());a&&(a.line.obsoleted=x.All,e.set(a.pack,a.host))})),a.breakingLines&&a.breakingLines.forEach((function(t){n=t.breakingLine;var a=i(n.getWholePath());a&&(a.line.obsoleted=x.All,e.set(a.pack,a.host))}))}},{key:"pendingByRollbacks",value:function(e,t){var a=e.mate,n=e.hostUpdater;t.rollbacks.forEach((function(e){var t=a(e.host.getWholePath(),e.host);t&&n.pendingByRange(t.host,e.range)}))}},{key:"flagByRange",value:function(e,t,a){var n={begin:e,end:t};this.view.collectTextLines(n).forEach((function(e){(e.viewPage.isDecorativePage?e.viewPage.contentPage:e.viewPage).isUpdate=!0,e.isUpdateRequired=!0,a&&a(e)})),this.view.expired=!0}},{key:"updatePages",value:function(e,t){var a=this.updateUntil((function(e,t){return e.goodPages({updatePages:t})}),p()({},t,{updatePages:e})),n=!!(a&&a.length>0);return this.view.updateComponent(n,{pageNo:Math.min(e.to,this.view.pageCount-1)}),{hasUpdate:n,updatedPages:a}}},{key:"updateViewport",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.APP.workspace.getCurrentRect(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.view.getPageByView(e);if(!a)return{hasUpdate:!1};var n=this.updateUntil((function(e,a){return e.goodPages(p()({},t,{updatePages:a}))}),p()({},t,{viewport:e,updatePages:a})),i=!!(n&&n.length>0);return this.view.updateComponent(i,{}),{hasUpdate:i,updatedPages:n}}},{key:"updateToPosition",value:function(e,t){var a=window.APP.workspace.getCurrentRect(),n=this.view.getPageByView(a);if(n){var i=this.updateUntil((function(t,a){return t.goodPages({updatePages:a})&&t.goodPosition(e,{updatePages:a})}),p()({},t,{viewport:a,updatePages:n})),r=!!(i&&i.length>0);return this.view.updateComponent(r,{pos:e}),r}}},{key:"updateOnIdle",value:function(){var e=this,t=this.view.pendingPages,a=void 0,n=void 0;if(0===t.length){if(this.finished())return!1;n=!0,a=this.view.pageCount}else if((a=t[0])>this.view.pageCount){if(t.shift(),this.finished())return!1;n=!0,a=this.view.pageCount}else{if(a>0&&this.finished(a))return this.view.pendingPages=[],!1;window.APP.workspace.saveSelection()}var i={from:a,to:a,updatingPage:a,updatedPages:[]};this.view.scheduling=!0;var r=this.updateUntil((function(i,r){return n?e.view.pageCount>a:-1===t.indexOf(a)}),{updatePages:i});this.view.scheduling=!1;var o=!!(r&&r.length>0);return!o||(this.view.updateComponent(o,{}),function(){return e.updateOnIdle()})}},{key:"updateByPages",value:function(e){for(var t=this.view,a=t.pendingPages,n=e.updatingPage,i=e.from,r=e.to,o="number"==typeof n?n+1:i;o<=r;o++){if(o>0&&this.finished(o>t.pageCount?t.pageCount:o)){if(a.includes(o)){var s=a.indexOf(o);a.splice(s,a.length)}return!0}if(a.includes(o))return e.updatingPage=o,!1;if(!(o<t.pageCount))return e.updatingPage=t.pageCount,!1}return!0}},{key:"goodPage",value:function(e){return this.view.pageCount>e||this.finished()}},{key:"goodPages",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.updatePages;t.updatedPages=t.updatedPages||[];var a=this.updateByPages(t);if(!a){var n=t.updatingPage,i=n;if(i<=0)return;for(;this.view.layout_pages[i-1]&&!this.view.layout_pages[i-1].mainpages[0].range;)i-=1;if(i!==n){var r=this.view.pendingPages;if(r.includes(i-1)&&(i-=1),i>0&&this.finished(i)){var o=r.indexOf(i);return o>-1&&r.splice(o,r.length),!0}t.updatingPage=i,t.from=i}}return a}},{key:"goodViewport",value:function(e){var t=this.view.getPageByView(e);if(t)return this.updateByPages(t)}},{key:"goodPosition",value:function(e,t){var a=t.updatePages,n=window.APP.data.doc.getSubDocRange(l.MainText),i=e===n.pos+n.len?e-1:e,r=this.view.textLineRanges.findNodeContainPos(i);r||this.view.tableLineRanges.forEachHintInRange(i,i,(function(e){if(!e._node.line.isBrokenAfter)return r=e._node,!0}),(function(e,t){return t.begin<=i&&i<t.end}));var o=r&&r.line,s=this.view.pendingPages,c=void 0;if(o&&!o.isMoc){var u=o.viewPage.layout_index;if(-1===s.indexOf(u))return!0;c=u}else if(s.length>0){var h=a.to,d=window.APP.data.typoinfo.layout_pages[h];if(d&&d.range&&e>=d.range.pos+d.range.len)c=s.find((function(e){return e>=h}));void 0===c&&(c=s[0])}else{if("number"==typeof a.updatingPage&&a.updatingPage>0&&this.finished(a.updatingPage))return!0;c=this.view.pageCount}if(void 0!==c){if(c>0&&this.finished(c)){var p=s.indexOf(c);return p>-1&&s.splice(p,s.length),!0}return a.from=c,a.to=c,a.updatingPage=c,a.updatedPages=[],!1}return!0}},{key:"updateToPosInContext",value:function(e,t){if(e.selection.selContext.isInComment()&&this.commentUpdater)return this.commentUpdater.updateToPosition(t);var a=e.doc.getSubDocType(t);if(a!=l.HeaderFooter&&a!=l.TextboxInHF||!e.selection.selContext.isInHeaderFooter){var n=window.APP.data.doc.subdocs.map((function(e){return e.subdoc_offset+e.subdoc_size}));return t>Math.max.apply(Math,h()(n))?(console.error("大哥怎么会超出范围的？"+JSON.stringify(window.APP.data.doc.concernRanges)+"， gcp: "+t),!1):this.updateToPosition(t)}var i=e.selection.selContext.nLayoutIndex;return this.updatePages({from:i,to:i}).hasUpdate}},{key:"onRevisionsViewChanged",value:function(){return this.onSettingsChanged()}},{key:"onRevisionsModeChanged",value:function(){return this.onSettingsChanged()}},{key:"onRevisionsShowMarkupChanged",value:function(){return window.APP.editor.viewSettings.core.getRevisionsMode()===C.b?this.onSettingsChanged():(this.view.layout_pages.forEach((function(e){e.isUpdate=!0})),this.view.textLineRanges.forEachNode((function(e){return e.line.isUpdateRequired=!0,!1})),this.view.mathCache&&this.view.mathCache.onSettingsChanged(),!0)}},{key:"onSettingsChanged",value:function(){this.glyphpool.onSettingsChanged(),this.view.mathCache&&this.view.mathCache.onSettingsChanged()}},{key:"clearLayoutPage2Canvas",value:function(e){var t=window.APP.workspace.canvasHandler.layoutPage2Canvas;if(t)for(var a=0;a<e.length;a++){var n=e[a];t.has(n)&&t.delete(n)}}},{key:"rollbackRanges",get:function(){return console.error("use lookaheads instead"),null}}]),e}(),S=a(24),L=a.n(S),T=a(336),I=a(400),R=a(1807),O=a(3077),B=a(1475),M=function(){function e(){i()(this,e)}return o()(e,null,[{key:"execute",value:function(e,t,a,n){var i=n.getProps().papx;t.first_line_indent=i.first_line_indent,t.before_indent=i.before_indent,t.after_indent=i.after_indent}},{key:"updateRectByIndent",value:function(e,t,a){if(!t.isExclusive){var n=window.APP.isMobileMode(),i=a.papx.prop.getPropVal("bidi"),r=i?!e.isRightSplit:!e.isLeftSplit,o=i?!e.isLeftSplit:!e.isRightSplit;if(r){var s=n?Math.max(e.before_indent,0):e.before_indent;i?e.rect.right-=s:e.rect.left+=s}if(o){var c=n?Math.max(e.after_indent,0):e.after_indent;i?e.rect.left+=c:e.rect.right-=c}var l=(i?!e.isRightSplit:!e.isLeftSplit)||e.first_line_indent>0?e.first_line_indent:0;if(t.isFirstLineInPara?l>0?t.isOMathPara||(i?e.rect.right-=l:e.rect.left+=l):l<0&&t.isOMathPara&&(i?e.rect.right+=l:e.rect.left-=l):l<0&&(i?e.rect.right+=l:e.rect.left-=l),e.auto_num){var u=a.getProps().papx;if(u.min_text_width){var h=u.min_text_width,d=e.textEnd()-e.textStart();h>d&&(e.auto_num.jcOffset-=h-d)}}}}}]),e}(),E=a(3078);var A=function(){function e(){i()(this,e)}return o()(e,null,[{key:"adjustMargin",value:function(e,t,a){var n=t.gridMode;if(E.c.Typo_GridMode_LineOnly!=n&&E.c.Typo_GridMode_None!=n&&a.papx.prop.getPropVal("adjust_right_indent")){var i=Object(T.Px2Ti)(e.rect.width),r=function(e){var t=e.pos;return e.document.sections.getSection(t).getSrcGridWidth()+e.document.defFontSize()}(a),o=210/r*.01,s=Math.ceil(parseInt(i/r+o)*r);if(E.c.Typo_GridMode_CharAndLine==n){var c=function(e){if(!e)return null;var t=e.getPropVal("first_line_indent_chars");return t?{isAbs:!1,val:t}:{isAbs:!0,val:e.getPropVal("first_line_indent_abs")}}(a.papx.prop),l=a.document.defFontSize();if(i===s&&t.isFirstLineInPara&&c&&!c.isAbs&&0!=c.val&&r<l)return;s++}e.rect.updateByWidth(Object(T.Ti2Px)(s))}}}]),e}(),H=a(3855),U=a(7534),D=a(1291),N=a(5739),F=a(3857),W=a(324),G=a(2956),j=a(1318),V=a(4110),z=a(3333),Z=a(1145),q=a(167),X=a(723),Y=a(7205),K=a(7204),J=a(22),Q=a.n(J),$=a(23),ee=a.n($),te=a(6097),ae=a(6098),ne=Number.MIN_SAFE_INTEGER,ie=function(){return window.APP.isMobileMode()||window.APP.isWebMode()},re=Object(T.Ti2Px)(31500),oe=function(){function e(t){i()(this,e),this.tabStopGetter=t}return o()(e,[{key:"execute",value:function(e,t,a){var n=!1,i=!1,r={},o=a.getProps(),s=o.chpx,c=o.papx,l=e.charPos,u=(t.before_indent,s.getPropVal("p_tab_alignment")),h=s.getPropVal("p_tab_leader"),d=s.getPropVal("p_tab_relative_to");e.thisGlyphIterator.glyphGroup.tabPos=l;var p=e.thisGlyphIterator.glyphBuff,g=p.getMi(e.thisGlyphIterator.position);g&&g.setFixedWidth(0);var f=void 0;switch(u){case 2:if(n=(f=this.tabStopGetter.updateHFTabCaps(e,t,l,u,h,d,r,i)).bRet,i=f.multiCenter,!n)return i;break;case 3:n=(f=this.tabStopGetter.updateHFTabCaps(e,t,l,u,h,d,r)).bRet,i=f.multiCenter;break;case 1:if(!(l<0&&0===d))return!(e.ccp>1&&0!==l);n=(f=this.tabStopGetter.updateHFTabCaps(e,t,l,u,h,d,r)).bRet,i=f.multiCenter}if(!n&&!this.tabStopGetter.updateTabCaps(e,t,l,c,r))return!1;var v=Math.max(r.tabEndPos,l);if(e.charPos<e.textEnd){if(r.isCustom)v>e.textEnd&&(t.isTabExceed=!0,e.xSpaceEnd=e.textEnd=this.adjustTextLineEnd(e.textEnd));else if(v>e.textEnd){if(e.ccp>0)return v=0,!1;v=e.textEnd}}else{if(!t.isTabExceed)return 3===u;if(v>e.textEnd&&e.ccp>0)return v=0,!1}switch(e.lastTabPos=e.charPos,e.curTabPos=v,e.firstDecimalPos=ne,r.code){case te.c:(g=p.getMi(e.thisGlyphIterator.position))&&g.setFixedWidth(v-l),e.charPos=v,e.lastTabGlyph=null;break;case te.d:case te.a:case te.b:e.lastTabGlyph=e.thisGlyphIterator.clone(),e.lastTabCaps=r}r.leadingChar&&"\0"!=r.leadingChar?e.thisGlyphIterator.setCharCode(r.leadingChar.charCodeAt(0)<<8|W.B):e.thisGlyphIterator.setCharCode(W.B);var m=this.adjustTextLineEnd(e.textEnd);if(e.textEnd!==m&&v>=e.textEnd){if(r.isCustom)return!t.isTabExceed&&(t.isTabExceed=!0,e.textEnd=m,!0);if(e.charPos>e.textEnd&&e.ccp>0)return!1}return!0}},{key:"adjustTextLineEnd",value:function(e){return ie()?e:re}},{key:"updateHFTabCaps",value:function(e,t,a,n,i,r,o,s){return!1}},{key:"getDefaultTabSize",value:function(e){var t=0;if(e){var a=e.getSettings();t=a&&a.getDefaultTabSize()}return t<0&&(t=Object(T.Ti2Px)(500)),t}},{key:"useDefaultTabSize",value:function(e,t,a){a.code=te.c,a.leadingChar="\0",a.isCustom=!1;var n=this.getDefaultTabSize();if(n)if(t>=0)a.tabEndPos=(t/n+1)*n;else{var i=t/n;t%n==0&&++i,a.tabEndPos=i*n}else a.tabEndPos=t}},{key:"useAbsFirstIndentValue",value:function(e,t){t.tabEndPos=e,t.code=te.c,t.leadingChar="\0"}},{key:"setDecimalTabContext",value:function(e){return!(!e.lastTabGlyph||e.lastTabCaps.code!==te.b||e.firstDecimalPos!==ne)&&(e.firstDecimalPos=e.charPos,!0)}},{key:"updateTabGlyph",value:function(e){var t=function(e){return Object(T.Ti2Px)(Math.floor(Object(T.Px2Ti)(e)))};if(e.lastTabGlyph){var a=e.lastTabCaps.tabEndPos-e.lastTabPos,n=Math.max(0,t(e.textEnd-e.charPos)),i=t(e.charPos)-e.lastTabPos;switch(e.lastTabCaps.code){case te.a:a=Math.min(n,Math.max(0,a-(i>>1)));break;case te.d:a=Math.max(0,a-i);break;case te.b:e.firstDecimalPos!==ne?i=e.firstDecimalPos-e.lastTabPos:(n=Math.max(0,t(e.textEnd-e.charPos)),i=t(e.charPos-e.lastTabPos)),a=Math.min(n,Math.max(0,a-i))}a<0&&(a=0);var r=e.lastTabGlyph.glyphBuff.getMi(e.lastTabGlyph.position);return r.setFixedWidth(a),r.shared&&delete(r=r.clone()).shared,r.leadingChar=e.lastTabCaps.leadingChar,e.lastTabGlyph.typomi=r.clone(),e.lastTabGlyph.typomi.setFixedWidth(a),e.charPos+=a,e.lastTabGlyph=null,!0}return!1}}]),e}(),se=function(){function e(){i()(this,e)}return o()(e,null,[{key:"updateTabCaps",value:function(t,a,n,i,r){var o=a.view.data.doc,s=o.getListTable(),c=i.getListInfoIndex(),l=s.getList(c);if(!l.good())return e.useDefaultTabSize(o,n,r);var u=i.getListLevel(),h=l.getLevel(u);if(h.good()&&h.getWord6())return r.isCustom=!1,r.code=te.c,r.leadingChar="\0",r.tabEndPos=Math.max(a.getTextBeforeIndentEx()+h.getDxaIndent(),n+h.getDxaSpace()),!0;var d=i.updateTabCaps(n,r,!0),p=a.hangIndent<0;if(d&&p){var g=a.rect.x-a.hangIndent;r.tabEndPos>g&&g>a.rect.x&&(r.tabEndPos=g)}if(!d){e.useDefaultTabSize(o,n,r);var f=a.first_line_indent;f<0&&(f=a.rect.x-f)>a.rect.x&&f<=r.tabEndPos&&e.useAbsFirstIndentValue(f,r)}return!0}},{key:"getDefaultTabSize",value:function(e){var t=0,a=!0;if(e){var n=e.getSettings();n&&(t=Object(T.Ti2Px)(n.getDefaultTabSize()))}return t<=0&&(t=28,a=!1),{defaultTabSize:t,state:a}}},{key:"useDefaultTabSize",value:function(t,a,n){n.code=te.c,n.leadingChar="\0",n.isCustom=!1;var i=e.getDefaultTabSize(t).defaultTabSize;if(!i)return n.tabEndPos=a,!1;if(a>=0)n.tabEndPos=(Math.floor(a/i)+1)*i;else{var r=a/i;a%i==0&&++r,n.tabEndPos=r*i}return!0}},{key:"useAbsFirstIndentValue",value:function(e,t){t.tabEndPos=e,t.code=te.c,t.leadingChar="\0"}}]),e}(),ce=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ee()(t,e),o()(t,null,[{key:"updateHFTabCaps",value:function(e,t,a,n,i,r,o,s){var c=0,l=s,u=t.rect.width,h=t.after_indent,d=t.before_indent,p=t.first_line_indent,g=t.is_para_first;switch(n){case 2:if(g)c=1===r?(u+h+Math.abs(p))/2+d:(u+d+Math.max(0,p)+h)/2;else{var f=p>0?0:p;c=1===r?(u+h)/2+d+Math.abs(f):(u+d+Math.abs(f)+h)/2}break;case 3:if(g)c=u+d+Math.max(0,p)+Math.min(0,h);else{var v=p>0?0:p;c=u+d+Math.abs(v)+Math.min(0,h)}c=Math.min(c,e.textEnd);break;case 1:c=0}if(a<c){o.tabEndPos=c;var m=Object(ae.a)(i);switch(m&&(o.leadingChar=m),n){case 1:o.code=te.c;break;case 2:o.code=te.a;break;case 3:o.code=te.d}return o.isCustom=!1,{bRet:!0,multiCenter:l}}if(l&&2===n&&(255&e.lastGlyphIterator.charCode)===W.B&&e.lastTabCaps.code===te.a){var y=e.lastTapCaps.tabEndPos-e.lastTabPos,k=Math.max(0,e.textEnd-e.charPos),b=e.charPos-e.lastTabPos;l=a-(y=Math.min(k,Math.max(0,y-(b>>1))))<c}return{bRet:!1,multiCenter:l}}},{key:"updateTabCaps",value:function(e,t,a,n,i){var r=n.getTabCapsInfo(a),o=r.bRet,s=r.code,c=r.tabEndPos,l=r.leadingChar,u=r.isCustom;i.code=s||te.c,i.tabEndPos=c,i.leadingChar=l,i.isCustom=u;var h=t.is_para_first,d=t.first_line_indent,p=t.before_indent,g=t.view.data.doc;if(o){if(h){var f=d;f<0&&(f=p-f)>a&&f<i.tabEndPos&&se.useAbsFirstIndentValue(f,i)}}else{if(h){var v=d;if(v<0&&(v=p-v)>a)return se.useAbsFirstIndentValue(v,i),!0}se.useDefaultTabSize(g,a,i)}return ie()&&i.tabEndPos>e.textEnd&&(i.tabEndPos=e.textEnd),!0}}]),t}(se),le=j.c.DOCCharTypeFastDetecter;function ue(e,t,a){for(var n=t,i=a-1,r=void 0;i>n;)r=e[n],e[n]=e[i],e[i]=r,++n,--i}var he=[61693,61694],de=function(){function e(){i()(this,e)}return o()(e,null,[{key:"execute",value:function(t,a,n,i){var r=i.getProps().papx;if(!r.hasAutoNum())return!1;var o=i.pos,s=i.autoNum.getAutoNumNodeByPos(o);if(s&&i.glyphIterator.charCode!==W.k&&i.glyphIterator.charCode!==W.i&&e.isShowAutoNum({pos:i.pos,doc:i.document})){var c=void 0,l=(i.getCachedProps()||{}).props;null!=l&&(c=l[l.length-1].chpx);var u=s.format.levels[s.level].chpx,h=void 0;u&&c?(h=u.duplicate(),V.a.union(c,h)):h=u||c;var d=e.calcAutoNumText(s,r),p=e.calcAutoNumInfo(s,i.document,h,r,a,d,k),g=p.width,f=p.height,v=p.ascent,m=p.textPoss,y=p.renderText,k=s.followChar===H.f?p.jcOffset:e.calcJCOffset(s,g,!1),b=e.createAutoNumLine(a,{width:g,height:f,baseline:v,length:d.length}),P=e.createAutoNum(a,b,d,k,p.followTabInfo);m&&(P.textPoss=m,P.renderText=y),P.chpx=h,P.isBullet=23==s.nfc,a.auto_num=P}}},{key:"calcJCOffset",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=a?0:e.justifyCode,i=0;switch(n){case 2:i=-t;break;case 1:i=-(t>>1)}return i}},{key:"getFontIndex",value:function(e,t){var a=void 0;switch(e.charClass){case j.a.CC_FarEast:a=t.getPropVal("font_name_asia_east");break;case j.a.CC_Ascii:a=t.getPropVal("font_name_ascii");break;case j.a.CC_Shared:var n=t.getPropVal("share_hint");n===G.c?a=t.getPropVal("font_name_asia_east"):n===G.a?a=t.getPropVal("font_name_complex"):n===G.b&&(a=t.getPropVal("font_name_ftcbi"));break;case j.a.CC_NoFarEast:a=t.getPropVal("font_name_complex");break;case j.a.CC_Complex:a=t.getPropVal("font_name_ftcbi");break;default:a=t.getPropVal("font_name_ascii")}return a}},{key:"calcAutoNumInfo",value:function(t,a,n,i,r,o){var s=this,c=t.followChar,l=n.getPropVal("font_size_normal")||n.getPropVal("font_size_cs"),u=l&&Object(T.Ti2Px)(parseInt(l))||14,h=23!==t.nfc&&n.getPropVal("bold")?"bold":"",d=23!==t.nfc&&n.getPropVal("italic")?"italic":"",p=n.getPropVal("font_color")||"#000",g="",f="",v=void 0,m={fontFamily:g,fontSize:u,fontWeight:h,fontStyle:d},y=r.first_line_indent,k=void 0!==r.before_indent?r.before_indent:0,b=r.rect.left,P=0,x=!1,_=[],C=[],w=new F.a,S=o.length,L={};e.initContext(L,a,m,i),o.split("").forEach((function(e,t){var i=e.charCodeAt(0);C.push(i);var r=le.getUnicodeCharItem(i),c=s.getFontIndex(r,n);x|=r.isRealAsia,"number"==typeof c&&(g=a.fonttable.getName(c)),g||(g='Calibri, "'+z.a.SimSun+'"');var l=d+" "+h+" "+u+"px "+g;q.isMobile&&-1!==he.indexOf(i)&&(g=""),f||(f=g),m.fontFamily=g,0==P&&(v=l);var p=w.getCharManorWithMeasure(e,m).width;if((X.a.isNormalSpace(i)||X.a.isFullWidthSpace(i))&&t>0&&t<o.length-1){var y=new K.a;y.setFixedWidth(p);var k=o.charCodeAt(t-1),b=o.charCodeAt(t+1),S=le.getUnicodeCharItem(k),T=le.getUnicodeCharItem(b),I={charCode:k,charInfo:S,chp:n},R={charCode:b,charInfo:T,chp:n};Y.a.adjustSpaceWidth(L,y,i,I,R),p=y.width}isNaN(p)?_.push(0):(P+=p,_.push(p))})),L.isCJKFont=!q.isMobile&&(x||Object(Z.b)(f));var I=(new N.a).calculateHeight(L,o,{fontSize:u,fontFamily:f,fontWeight:h,fontStyle:d}),R=I.height,O=I.ascent,B=I.descent,M=null,E=0;if(c===H.f){P-=_[S-1],E=e.calcJCOffset(t,P,!1);var A=0,U=0,D=P+(k+=E),W=y<0&&!a.settings.getDoNotUseIndentAsTabStop()&&!a.settings.getNotabForIndent(),G=e.getTypoHangOrFirstIndentValue(r)+D,j=i.getTabCapsInfo(G),V=j.bRet,J=j.code,Q=j.tabEndPos,$=j.leadType,ee=J===te.c;if(V){var ae=b-y;U=W&&Q>ae&&ae>G?ae:Q}else{var ne={};if(a.settings.getDoNotUseIndentAsTabStop()){se.useDefaultTabSize(a,G,ne),ee=ne.code===te.c;var ie=y;ie<0&&!a.getSettings().getNotabForIndent()&&(ie=b-ie)>G&&ie<=ne.tabEndPos&&se.useAbsFirstIndentValue(ie,ne)}else{if(W){var re=b-y;(re>G||re===G)&&se.useAbsFirstIndentValue(re,ne)}ne.tabEndPos||(se.useDefaultTabSize(a,G,ne),ee=ne.code===te.c)}U=ne.tabEndPos}if(M={leaderType:$},D<0)A=U-D;else if(ee)A=U-G;else{var oe=Math.round(D),ce=Math.round(U);A=oe%ce?ce-oe%ce:0}_[S-1]=A,P+=A,M&&(M.start=P-A,M.end=P)}var de=void 0,pe=void 0;if(window.APP.createBidi){var ge=i.getPropVal("bidi")?127:126,fe=window.APP.createBidi(),ve=127===ge?1:0;fe.setPara(C,ge,null);for(var me=fe.getLevels(),ye=0,ke=0,be=me.length;ke<be;++ke)X.a.isPunc(C[ke])?me[ke]=ve:me[ke]<ve&&(me[ke]+=2),ye=Math.max(ye,me[ke]);if(c!==H.c&&(me[me.length-1]=ve),ye>0){var Pe=new Array(S);pe=new Array(S);for(var xe=0,_e=S;xe<_e;++xe){Pe[xe]=xe;var Ce=C[xe];me[xe]%2&&(Ce=fe.getBidiMirror(Ce));var we=String.fromCharCode(Ce);pe[xe]=we}for(var Se=1;Se<=ye;++Se){for(var Le=-1,Te=0;Te<S;++Te)me[Pe[Te]]>=Se?Le<0&&(Le=Te):Le>=0&&(ue(Pe,Le,Te),Le=-1);Le>=0&&ue(Pe,Le,S)}de=new Array(S);for(var Ie=0,Re=0;Re<S;++Re){var Oe=Pe[Re];de[Oe]=Ie,Ie+=_[Oe]}}}else{de=new Array(S),pe=new Array(S);for(var Be=0,Me=0;Me<S;++Me)de[Me]=Be,pe[Me]=String.fromCharCode(C[Me]),Be+=_[Me]}return{width:P,height:R,ascent:O,descent:B,font:v,fontColor:p,followTabInfo:M,textPoss:de,renderText:pe,jcOffset:E}}},{key:"calcAutoNumText",value:function(e,t){var a=e.text;switch(e.followChar){case H.f:a+="\t";break;case H.d:a+=" ";break;case H.c:}return a}},{key:"createAutoNumLine",value:function(e,t){var a=t.width,n=t.height,i=t.baseline,r=t.len,o=new D.b({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem},{compose:e.compose});return o.baseline=i,o.before_indent=e.before_indent,o.hang_indent=e.hang_indent,o.range=new O.a(e.range.pos,e.range.pos+r,o),o.rect=I.a.initByRawRect({left:0,right:a,top:0,bottom:n}),o}},{key:"createAutoNum",value:function(e,t,a,n,i){var r=new U.a({parent:e.parent,viewPage:e.viewPage,coorSystem:e.coorSystem,gcp:e.range.pos},{compose:e.compose});return r.line=t,r.jcOffset=n,r.text=a,r.size=a.length,r.followTabInfo=i,r}},{key:"initContext",value:function(e,t,a,n){e.fontArg=a,e.bDiffSBMB=!t.settings.getDiffSBMB(),e.bWordWrap=n.getPropVal("word_wrap"),e.bBoldAdjustment="bold"===a.fontWeight&&"bold"!==a.fontStyle&&"bold_italic"!==a.fontStyle,e.bAppIsFELanguage=!0}},{key:"isShowAutoNum",value:function(e){var t=e.pos,a=e.doc;try{var n=window.APP.editor&&window.APP.editor.cmdExecutor.getCurrentLocalCommand();if(n&&"insertParagraph"===n.name&&void 0!==t&&t>=window.APP.data.selection.begin.position){var i=a.getDataLogic("final").getPapx(t);if(i&&1===i.len&&i.prop&&i.prop.hasAutoNum()){var r=i.prop.getPropVal("basestyle");if(r&&r.id>=1&&r.id<=10)return!1}}}catch(e){}return!0}},{key:"getTypoHangOrFirstIndentValue",value:function(e){var t=e.first_line_indent,a=t<0&&!e.is_para_first,n=t>0&&e.is_para_first;return a||n?Math.abs(t):0}}]),e}(),pe=a(5736),ge=function(){function e(){i()(this,e)}return o()(e,null,[{key:"onLineBegin",value:function(e,t,a){var n=a.papx,i=a.document.getSubDocType(a.pos),r=(e.parent.sublines?e.parent.parent:e.parent).textflow;!n.prop.getPropVal("overflow_punct")||n.prop.getPropVal("nest_level")>=1||r&&"R2L"==r.corY||i==l.Textbox||i==l.TextboxInHF?(t.bHangAnsiPunc=!1,t.bHangAsiaPunc=!1):(t.bHangAnsiPunc=!0,t.bHangAsiaPunc=!0)}},{key:"execute",value:function(e,t,a){if(!t.bHangAnsiPunc&&!t.bHangAsiaPunc)return!1;if(e.hasPuncHang)return!1;if(t.charPos>t.textEnd)return!1;var n=t.thisGlyphIterator,i=n.glyphGroup;if(i.isCharBox()||i.isComplex())return!1;var r=a.getProps().chpx,o=Object(pe.a)(r.getPropVal("east_asia_language")),s=a.document.settings.getFELineBreak11();return!!X.a.isHangPunc(n.charCode,o,!1,s)&&(e.hasPuncHang=!0,t.hangPuncPos=t.ccp+1,!0)}},{key:"onLineEnd",value:function(e,t,a){if(!e.hasPuncHang)return!1;if(e.hasPuncHang&&e.isLineBroken&&t.hangPuncPos>1&&t.ccp>2){for(var n=void 0,i=t.ccp,r=1;i>=t.hangPuncPos&&(n=a.makeGlyphAt(a.pos-r));--i){var o=a.document.settings.getFELineBreak11();if(i==t.hangPuncPos&&!X.a.isDefaultHangPunc(n.charCode,o))return n.free(),!1;++r,n.free()}e.isLineBroken=!1,t.rollBack(a,r-1)}return!0}}]),e}(),fe=function(){function e(){i()(this,e)}return o()(e,null,[{key:"isPartOfWord",value:function(e,t,a){var n=t.glyphGroup;if(n.isTab())return!1;if(n.chpx.getPropVal("asian_layout"))return!1;if(n.isComplex()&&n.isNeedWordBreaking())return!0;if(n.isGlyphComplex())return!0;if(n.isMath()){var i=a.data.typoinfo.mathCache,r=t.position||t.posInBuff||n.pos,o=i.get(r);if(o)return!o.isOpText}var s=!1;return(n.isNormal()||X.a.isNonBreakSpace(t.charCode)||n.isEmbedDrawing()&&n.isNeedWordBreaking()||n.isSpec()||n.isCharBox()||n.isZeroChar()||n.chpx.getPropVal("fit_text_id"))&&(s=!0),s}},{key:"execute",value:function(e,t,a){if(t.isLineBroken)return!1;var n=t.thisGlyphIterator;if(!n)return!1;if(void 0!==t.limitEnd&&a.pos>=t.limitEnd)return!1;if(t.isOMathPara&&t.charPos<=t.textEnd)return!1;var i=n.glyphGroup;if(!i.isComplex()&&!this.isPartOfWord(t,n,a)&&!i.isMath())return!1;if(t.bWordWrap)return!1;for(var r=t.ccp-1,o=a.makeGlyphInLineAt(t.ccp-1,e);r>=0&&(!o.zone||!o.zone.isEqZone)&&(o.glyphGroup.isHidden()||this.isPartOfWord(t,o,a));--r,o.prev());return o&&o.free(),r<t.ccp-1&&(t.rollBack(a,t.ccp-r-1),!0)}},{key:"isHiddenCanSkipGlyph",value:function(e,t){return t&&(t.glyphGroup.isHidden()||t.glyphGroup.isSpecHidden())}},{key:"extendHiddenBefore",value:function(e,t,a,n){for(var i=n-1,r=t.makeGlyphAt(i);i!=a&&this.isHiddenCanSkipGlyph(e,r);)--i,r.prev();return i==a&&this.isHiddenCanSkipGlyph(e,r)?(r.free(),!0):(e.lastGlyphIter=r,!0)}}]),e}(),ve=function(){function e(){i()(this,e)}return o()(e,null,[{key:"execute",value:function(e,t,a){var n=a.pos,i=t.thisGlyphIterator;if(void 0!==t.limitEnd&&a.pos>=t.limitEnd)return!1;if(!a.papx.prop.getPropVal("kinsoku")&&!X.a.isNonBreakSpace(i.charCode))return!1;var r=!t.bWordWrap;if(!X.a.isTailPunc(i.charCode))return!1;var o=t.update_begin,s=void 0;for(s=n-1;s>o;--s){var c=a.makeGlyphAt(s);if(!c)break;var l=c.glyphGroup;if(!fe.isHiddenCanSkipGlyph(t,c)&&l.isClusterStart()){if(!r||!X.a.isFullWidthSpace(c.charCode)&&!X.a.isNormalSpace(c.charCode)){c.free();break}c.free()}else c.free()}var u=a.makeGlyphAt(s);return u&&this.isNoPartOfWord_ModeExpand(u.charCode)?(s=n,u.free(),!1):(u.free(),n-s>0&&t.rollBack(a,n-s),s!=o&&fe.extendHiddenBefore(t,a,o,s),!0)}},{key:"isNoPartOfWord_ModeExpand",value:function(e){return 45==e||8211==e||8212==e}}]),e}(),me=function(){function e(){i()(this,e)}return o()(e,null,[{key:"execute",value:function(e,t,a){var n=a.pos,i=t.thisGlyphIterator;if(!i)return!1;var r=i.glyphGroup;if(n==t.update_begin&&!r.isCharBox()&&X.a.isHeadPunc(i.charCode))return t.bWholeLineBack=!0,!1;if(!a.papx.prop.getPropVal("kinsoku"))return!1;if(r.isCharBox()||!X.a.isHeadPunc(i.charCode))return!1;var o=t.bWordWrap,s=void 0,c=n,l=t.update_begin;for(s=n-1;s>l;--s){var u=a.makeGlyphAt(s);if(r=u.glyphGroup,fe.isHiddenCanSkipGlyph(t,u))u.free();else if(r.isCharBox()||!X.a.isHeadPunc(u.charCode)){if(o||!this.isCanSkipChar(u)){u.free();break}u.free()}else c=s,u.free()}if(s==l){var h=a.makeGlyphAt(s);!(r=h.glyphGroup).isCharBox()&&X.a.isHeadPunc(h.charCode)&&(c=s,t.bWholeLineBack=!0),h.free()}return n-(s=c)>0&&t.rollBack(a,n-s),c!=l&&fe.extendHiddenBefore(t,a,l,s),!0}},{key:"isCanSkipChar",value:function(e){return X.a.isFullWidthSpace(e.charCode)||X.a.isNormalSpace(e.charCode)}}]),e}(),ye=a(8842),ke=0,be=1,Pe=2,xe=3,_e=function(){function e(){i()(this,e)}return o()(e,null,[{key:"calcHeight",value:function(e,t,a){var n=this.calcLineHeightInfo(e,t,a);if(!n.maxCharHeight)return e.ascent=0,e.textHeight=0,e.baseline=0,e.rect.bottom=e.rect.top,e.adjHeight=0,e.strongAscent=0,e.strongDescent=0,e.baseHeight=0,e.isHidden=!0,void(e.auto_num=null);var i=ye.a.adjust(t,n.maxCharHeight,n.baseHeight),r=this.calcBaseLinePos(e,t,n,i),o=i.height;e.ascent=n.maxAscent,e.strongAscent=n.maxStrongAscent,e.strongDescent=n.maxStrongDescent,e.baseHeight=n.baseHeight,e.textHeight=n.maxAscent+n.maxDescent,e.baseline=r,e.rect.bottom=e.rect.top+o,e.adjHeight=ye.a.getPageBottomAdjHeight(e,t),e.auto_num&&(e.auto_num.line.rect.bottom=o-e.auto_num.line.rect.top,e.auto_num.line.baseline=r)}},{key:"calcLineHeightInfo",value:function(e,t,a){var n=0,i=0,r=0,o=0,s=0,c=!0;return e.zones.forEach((function(l){var u=l.getHeightInfo(e,t,a);if(u.allWeakChar){if(!c)return}else c=!1;n=Math.max(n,u.maxAscent),i=Math.max(i,u.maxDescent),s=Math.max(s,u.baseHeight),r=Math.max(r,u.maxStrongAscent),o=Math.max(o,u.maxStrongDescent)})),{baseHeight:s,maxCharHeight:n+i,maxAscent:n,maxDescent:i,maxStrongAscent:r,maxStrongDescent:o}}},{key:"calcHeightMax",value:function(e,t,a){for(var n=0,i=0,r=0,o=0,s=0,c=0,l=0,u=0,h=0,d=0,p=0,g=0,f=!1,v=!1,m=!1,y=!1,k=!1,b=!0,P=0,x=0,_=!1,C=t.update_begin,w=a.pos,S=a.makeGlyphAt(C);S.position<w;)if(S.charCode!==W.b&&S.charCode!==W.c){var L=S.glyphGroup;if(L.isHidden()||L.isSpecHidden()&&S.charCode!==W.d&&S.charCode!==W.e||!L.isClusterStart())_&&L.unSetLineFirstCharFlag(),S.next();else{_?L.unSetLineFirstCharFlag():(L.setLineFirstCharFlag(),_=!0);var T=S.glyphGroup.metrics;if(!L.isCharBox()&&this.isWeekChar(S)){if(P=Math.max(P,T.ascent),x=Math.max(x,T.descent),v||f){S.next();continue}v=!0,c=Math.max(c,T.ascent),l=Math.max(l,T.descent)}else this.isNatureGlyph(S)?(b&&!L.isEmbedDrawing()&&(b=!1),!k&&L.isEmbedDrawing()&&(k=!0),y=!0,d=Math.max(d,T.ascent),p=Math.max(p,T.descent)):(f=!0,o=Math.max(o,T.ascent),s=Math.max(s,T.descent),g=Math.max(g,T.height));S.next()}}else S.next();if(S.free(),e.auto_num)if(m=!0,f){var I=t.vertAlignMode;"alphabetic"==I||0==I||4==I?(u=e.auto_num.ascent,h=0):"top"==I||1==I?(u=0,h=0):"middle"==I||2==I?(u=.5*e.auto_num.height,h=0):"bottom"!=I&&3!=I||(u=e.auto_num.ascent,h=e.auto_num.descent)}else u=e.auto_num.ascent,h=e.auto_num.descent;switch(n=f?g:m?u+h:v?c+l:0,f&&0==n&&(n=P+x),f?xe:m?y?xe:Pe:y?t.gridMode!=E.c.Typo_GridMode_None&&t.snapToGrid?xe:be:ke){case xe:i=Math.max(i,o),r=Math.max(r,s),i=Math.max(i,u),r=Math.max(r,h),i=Math.max(i,d),r=Math.max(r,p);break;case Pe:i=Math.max(i,u),r=Math.max(r,h);break;case be:i=Math.max(i,d),r=Math.max(r,p);break;case ke:i=Math.max(i,c),r=Math.max(r,l)}return{baseHeight:n,maxCharHeight:(i=Math.max(i,o))+(r=Math.max(r,s)),maxAscent:i,maxDescent:r}}},{key:"calcBaseLinePos",value:function(e,t,a,n){var i=0,r=a.maxAscent,o=r+a.maxDescent,s=n.height;switch(n.align){case E.b.Typo_caTop:i=r;break;case E.b.Typo_caMiddle:i=r+.5*(s-o);break;case E.b.Typo_caBottom:i=r+.8*(s-o);break;case E.b.Typo_caFixedTop:i=.2*s;break;case E.b.Typo_caFixedMiddle:i=.5*s;break;case E.b.Typo_caFixedBottom:i=.8*s;break;case E.b.Typo_caMinBottom:i=r+(s-o);break;default:i=.8*s}return i}},{key:"isWeekChar",value:function(e){var t=e.glyphGroup,a=!1;return(t.isSpace()||t.isFullWidthSpace()||t.isTab()||t.isParaBreak()||t.isLineBreak())&&(a=!0),a}},{key:"isNatureGlyph",value:function(e){return e.glyphGroup.isEmbedDrawing()||e.charCode===W.d||e.charCode===W.e}}]),e}(),Ce=function(){function e(){i()(this,e)}return o()(e,null,[{key:"doFirstCompress",value:function(e,t,a){if(t.bForbidCompress||e.hasPuncHang||0===t.ccp)return!1;var n=t.lastGlyphIter;if(1===t.ccp&&n&&!n.glyphGroup.isCharBox()&&X.a.isPureHeadPunc(n.charCode))return!1;var i=t.thisGlyphIterator,r=0,o=i.width,s=i.minWidth;if(r=!i.glyphGroup.isCharBox()&&X.a.isPureHeadPunc(i.charCode)?o:s,t.lineCompress.curWidth=r,0==t.lineCompress.curWidth)return!0;var c=this.getNeedSpace(t);if(0==c)return t.bLineCompressed=!0,t.curCharRealWidth=t.textEnd-t.charPos,this.addCompSpace(t),!0;if(!this.canDoFirstCompress(e,t,a,c))return!1;if(!this.calcInitSpacing(e,t,a))return!1;if(!this.hasEnoughSpace(t,c))return!1;this.doCompress(e,t,c);var l=r-i.width;return 0!=l&&this.updateLineMdInfo(t,l,i,t.ccp),t.bLineCompressed=!0,t.curCharRealWidth=t.textEnd-t.charPos,this.addCompSpace(t),!0}},{key:"getNeedSpace",value:function(e){return e.lineCompress.curWidth+e.charPos-e.textEnd}},{key:"canDoFirstCompress",value:function(e,t,a,n){var i=t.thisGlyphIterator,r=t.lastGlyphIter,o=i.glyphGroup,s=r.glyphGroup,c=a.papx.prop.getPropVal("kinsoku"),l=t.bWordWrap;if(s.isFarEast()&&(c&&!s.isCharBox()&&X.a.isHeadPunc(r.charCode)||(t.lineCompress.bPrevPrevIsCNJudgeNextCom=!0),X.a.isTailPunc(r.charCode)&&(t.lineCompress.bPrevPrevIsFETailPunc=!0)),X.a.isNonBreakSpace(i.charCode))return!0;if(!l&&t.lineCompress.lastNotSpaceGlyph&&(r=t.lineCompress.lastNotSpaceGlyph),X.a.isNonBreakSpace(r.charCode)||s.isSpec()||s.isEmbedDrawing())return!0;if(r=t.lastGlyphIter,X.a.isNormalSpace(i.charCode)||o.isSpec()||o.isEmbedDrawing())return t.charPos<=t.textEnd;if(t.lineCompress.bExistLESs)return t.lineCompress.bLESsCanCompress;if(X.a.isFullWidthSpace(r.charCode))return!0;if(!l&&X.a.isNormalSpace(r.charCode))return!0;if(X.a.isTailPunc(i.charCode)){if(c)return!0;if(o.isGlyphFarEast()||o.isGlyphSharedFarEast())return!1}return!(l||!this.isPartOfWord(i)||!this.isPartOfWord(r))||(!(s.isCharBox()||!X.a.isHeadPunc(r.charCode)||!c)||n<=.5*r.width+Object(T.Ti2Px)(.5))}},{key:"isPartOfWord",value:function(e){var t=e.glyphGroup;return!t.isTab()&&(t.isNormal()||t.isGlyphComplex()||t.isEmbedDrawing()||t.isSpec()||X.a.isNonBreakSpace(e.charCode))}},{key:"calcInitSpacing",value:function(e,t,a){t.lineCompress.bCalcCompressSpace=!0;if(a.pos==t.update_begin||t.ccp<=0)return!1;this.initTypoLineCompressInfo(t);var n=t.lineMdInfo;n.dxList.sort((function(e,t){return e.idx-t.idx}));var i=n.dxList.length-1,r=Number.MAX_SAFE_INTEGER,o=t.lineCompress,s=t.ccp-1,c=t.ccp-1,l=a.makeGlyphInLineAt(c,e);do{if(o.comAtom={},o.comAtom.idx=s,this.isHiddenGlyph(!1,!1,l))--c,--s,l.prev();else{if(this.isTab(!1,l))break;if((r>=o.comAtom.idx&&X.a.isHeadCompressPunc(l.charCode)||X.a.isNormalSpace(l.charCode))&&c<=0)break;var u=l.width,h=l.minWidth;if(u>h)for(;i>=0;--i)if(o.comAtom.idx==n.dxList[i].idx)u+=n.dxList[i].dx;else if(o.comAtom.idx>n.dxList[i].idx)break;o.comAtom.bOffset=!1,u>h&&(o.comAtom.leftComSpace=u-h,X.a.isNormalSpace(l.charCode)||X.a.isFullWidthSpace(l.charCode)?(o.spaceMaxComSpace+=o.comAtom.leftComSpace,o.spaceComList.push(o.comAtom)):X.a.isJPNSpecPunc(l.charCode)||X.a.isHeadCompressPunc(l.charCode)||X.a.isTailCompressPunc(l.charCode)?(o.comAtom.bOffset=!X.a.isTailPunc(l.charCode),o.puncMaxComSpace+=o.comAtom.leftComSpace,o.puncComList.push(o.comAtom)):(o.comAtom.leftComSpace/=2,o.otherMaxComSpace+=o.comAtom.leftComSpace,o.otherComList.push(o.comAtom))),--s,--c,l.prev()}}while(c>=0&&s>=0);if(l.free(),!o.spaceComList&&!o.puncComList&&!o.otherComList)return!1;var d=o.spaceComList.length+o.puncComList.length+o.otherComList.length;return this.initCacheElem(t,d),!0}},{key:"initCacheElem",value:function(e,t){for(var a=0;a<t;++a)e.lineCompress.comCacheElem[a]={},e.lineCompress.comCacheElem[a].dx=0,e.lineCompress.comCacheElem[a].dOffset=0}},{key:"isHiddenGlyph",value:function(e,t,a){return e?t:a.glyphGroup.isHidden()}},{key:"isTab",value:function(e,t){return!e&&t.glyphGroup.isTab()}},{key:"initTypoLineCompressInfo",value:function(e){e.lineCompress.spaceComList=[],e.lineCompress.puncComList=[],e.lineCompress.otherComList=[],e.lineCompress.spaceMaxComSpace=0,e.lineCompress.puncMaxComSpace=0,e.lineCompress.otherMaxComSpace=0,e.lineCompress.comCacheElem=[],e.lineCompress.comCache=[],e.lineMdInfo.dxList=[],e.lineMdInfo.dOffsetList=[]}},{key:"hasEnoughSpace",value:function(e,t){var a=0;return a+=e.lineCompress.spaceMaxComSpace,a+=e.lineCompress.puncMaxComSpace,t<=(a+=e.lineCompress.otherMaxComSpace)}},{key:"doCompress",value:function(e,t,a){var n=a,i=Math.min(n,t.lineCompress.spaceMaxComSpace),r=0;(n-=i)>0&&(n-=r=Math.min(n,t.lineCompress.puncMaxComSpace));var o=0;n>0&&(o=n),i>0&&(this.doSpaceCompress(t,i),t.lineCompress.spaceMaxComSpace<0&&(t.lineCompress.spaceMaxComSpace=0)),r>0&&(this.doPuncCompress(t,r),t.lineCompress.puncMaxComSpace<0&&(t.lineCompress.puncMaxComSpace=0)),o>0&&(this.doOtherCompress(t,o),t.lineCompress.otherMaxComSpace<0&&(t.lineCompress.otherMaxComSpace=0)),this.addCurComOpToCache(t)}},{key:"runCurCharCompress",value:function(e,t,a,n,i,r){var o=0;return o=n*r,o=Math.min(o,r),o=Math.min(o,i),e.comCacheElem[a+t].dx-=o,o}},{key:"doSpaceCompress",value:function(e,t){for(var a=e.lineCompress,n=t/a.spaceMaxComSpace,i=a.spaceComList.length,r=0;r<i&&a.spaceMaxComSpace>0;++r){var o=this.runCurCharCompress(a,r,0,n,a.spaceMaxComSpace,a.spaceComList[r].leftComSpace);a.spaceMaxComSpace-=o,a.spaceComList[r].leftComSpace-=o}}},{key:"doPuncCompress",value:function(e,t){for(var a=e.lineCompress,n=t/a.puncMaxComSpace,i=a.puncComList.length,r=a.spaceComList.length,o=0;o<i&&a.puncMaxComSpace>0;++o){var s=this.runCurCharCompress(a,o,r,n,a.puncMaxComSpace,a.puncComList[o].leftComSpace);a.puncMaxComSpace-=s,a.puncComList[o].leftComSpace-=s,a.puncComList[o].bOffset&&(a.comCacheElem[o+r].dOffset-=s)}}},{key:"doOtherCompress",value:function(e,t){for(var a=e.lineCompress,n=t/a.otherMaxComSpace,i=a.otherComList.length,r=a.spaceComList.length+a.puncComList.length,o=0;o<i&&a.otherMaxComSpace>0;++o){var s=this.runCurCharCompress(a,o,r,n,a.otherMaxComSpace,a.otherComList[o].leftComSpace);a.otherMaxComSpace-=s,a.otherComList[o].leftComSpace-=s}}},{key:"addCurComOpToCache",value:function(e){var t=JSON.parse(JSON.stringify(e.lineCompress.comCacheElem));e.lineCompress.comCache.push(t)}},{key:"updateLineMdInfo",value:function(e,t,a,n){if(0==t||n<0)return!1;var i=e.lineMdInfo,r={};r.idx=n,r.dx=t,i.dxList.push(r);var o=t;if(o&&!a.glyphGroup.isCharBox()&&X.a.isPureHeadPunc(a.charCode)){var s={};s.idx=n,s.dOffset=o,i.dOffsetList.push(s)}return!0}},{key:"onLineEnd",value:function(e,t,a){var n=e.lineCompress,i=e.ccp;if(!(!n||!n.comCache||n.comCache.length<=0||i<=0)){var r=n.comCache.length-1;if(a<=r){r-=a;var o=n.spaceComList.length,s=n.puncComList.length,c=o+s,l=n.otherComList.length,u=n.comCache[r].length;c+l>u&&(c=o+(s-=c+l-u));for(var h=e.lineMdInfo,d=0,p=0;p<u;++p)if(!((d=p>=c?n.otherComList[p-c].idx:p>=o?n.puncComList[p-o].idx:n.spaceComList[p].idx)>=i)){if(n.comCache[r][p].dx){var g={};g.idx=d,g.dx=n.comCache[r][p].dx,h.dxList.push(g)}if(n.comCache[r][p].dOffset){var f={};f.idx=d,f.dOffset=n.comCache[r][p].dOffset,h.dOffsetList.push(f)}}}}}},{key:"addCompSpace",value:function(e){var t=e.thisGlyphIterator,a=t.width,n=t.minWidth;if(a<=n)return!1;if(t.glyphGroup.isCharBox()||!X.a.isHeadCompressPunc(t.charCode))return!1;var i=e.lineCompress;i.comAtom={},i.comAtom.idx=e.ccp;for(var r=e.lineMdInfo,o=r.dxList.length-1;o>0;--o)if(r.dxList[o].idx==i.comAtom.idx)a+=r.dxList[o].dx;else if(r.dxList[o].idx<i.comAtom.idx)break;if(a<=n)return!1;i.comAtom.leftComSpace=a-n,i.comAtom.bOffset=!0,i.puncMaxComSpace+=i.comAtom.leftComSpace,i.puncComList.push(i.comAtom);var s={dx:0,dOffset:0};return e.lineCompress.comCacheElem.push(s),!0}},{key:"doCompressAgain",value:function(e,t,a){if(e.hasPuncHang)return!1;var n=t.thisGlyphIterator,i=0,r=n.width,o=n.minWidth;if(i=!n.glyphGroup.isCharBox()&&X.a.isPureHeadPunc(n.charCode)?r:o,t.lineCompress.curWidth=i,0==t.lineCompress.curWidth)return!0;var s=this.getNeedSpace(t);if(0==s)return!0;if(t.lineCompress.bCalcCompressSpace&&!this.hasEnoughSpace(t,s))return!1;if(!this.canDoCompress(e,t,a,s))return!1;if(!t.lineCompress.bCalcCompressSpace){if(!this.calcInitSpacing(e,t,a))return!1;if(!this.hasEnoughSpace(t,s))return!1}this.doCompress(e,t,s);var c=i-n.width;return 0!=c&&this.updateLineMdInfo(t,c,n,t.ccp),t.bLineCompressed=!0,t.curCharRealWidth=t.textEnd-t.charPos,this.addCompSpace(t),!0}},{key:"canDoCompress",value:function(e,t,a,n){var i=t.thisGlyphIterator,r=t.lastGlyphIter,o=i.glyphGroup,s=r.glyphGroup,c=!1;t.lineCompress.bPrevPrevIsCNJudgeNextCom&&(c=t.lineCompress.bPrevPrevIsCNJudgeNextCom,t.lineCompress.bPrevPrevIsCNJudgeNextCom=!1);var l=!1;if(t.lineCompress.bPrevPrevIsFETailPunc&&(l=t.lineCompress.bPrevPrevIsFETailPunc,t.lineCompress.bPrevPrevIsFETailPunc=!1),X.a.isNonBreakSpace(i.charCode))return!0;var u=t.bWordWrap,h=a.papx.prop.getPropVal("kinsoku");if(!u&&t.lineCompress.lastNotSpaceGlyph&&(r=t.lineCompress.lastNotSpaceGlyph),X.a.isNonBreakSpace(r.charCode))return!0;if(!s.isCharBox()&&X.a.isHeadPunc(r.charCode)){if(h&&(!l||o.isFarEast()&&!X.a.isAlpha(i.charCode)||s.isFarEast()&&!X.a.isAlpha(r.charCode)))return!0;if(s.isGlyphFarEast()||s.isGlyphSharedFarEast())return!1}if(X.a.isTailPunc(i.charCode)){if(!o.isFarEast()||X.a.isAlpha(i.charCode)){var d=t.lastGlyphIter,p=d.glyphGroup;if(o.isNormal()&&p.isNormal()&&!X.a.isTailPunc(d.charCode))return!c}return!!o.isNormal()||h}return!u&&(s=(r=t.lastGlyphIter).glyphGroup,!(!this.isPartOfWord(i)||!this.isPartOfWord(r))&&(!!(s.isEmbedDrawing()||s.isSpec()||X.a.isTailPunc(r.charCode))||!c))}}]),e}(),we=a(772),Se=a(1403),Le=a(4809),Te=a(7376),Ie=a(1732),Re=a(3332),Oe=a(3334),Be=new oe(ce),Me=String.fromCodePoint(W.j),Ee=String.fromCodePoint(W.i),Ae=function(){function e(){i()(this,e)}return o()(e,null,[{key:"initLine",value:function(e,t,a,n){if(t.zoneBrokenInfo){var i=t.zoneBrokenInfo.zone.textPart.getGcpRange().pos;n.locate(i),e.range.reset(i,e.range.end)}var r=n.pos,o=n.getProps(),s=o.para,c=o.papx,u=n.document.sections.getSection(r);t.lineSpacing=function(e){var t=e.papx;if(void 0===t)return{isHeightOrMargin:!0,rule:E.a.RowHeightRule_Auto,val:240};var a=t.line_spacing;if(void 0===a)return{isHeightOrMargin:!0,rule:E.a.RowHeightRule_Auto,val:240};if(void 0===a.value)return{isHeightOrMargin:!0,rule:E.a.RowHeightRule_Auto,val:240};var n=a.rule,i=E.a.RowHeightRule_Auto;"auto"==n?i=E.a.RowHeightRule_Auto:"atLeast"==n?i=E.a.RowHeightRule_AtLeast:"exact"==n&&(i=E.a.RowHeightRule_Exact);var r=Math.abs(a.value),o=i!=E.a.RowHeightRule_Auto,s=i==E.a.RowHeightRule_Exact;return o&&a.value<0&&(s=!s),{isHeightOrMargin:!0,bMetricOrPercent:o,bFixedOrMin:s,rule:i,val:r}}(o);var h=n.glyphIterator.glyphGroup,d=h&&h.isTransposeCoor;t.vertAlignMode=c.vertical_align_mode||(d?"middle":c.getPropVal("vertical_align_mode")),t.gridMode=u.getSnapMode(),t.snapToGrid=c.getPropVal("snap_to_grid"),t.bWordWrap=c.getPropVal("word_wrap"),t.paraMarginBefore=c.getPropVal("para_margin_before"),t.paraMarginAfter=c.getPropVal("para_margin_after");var p=n.document.getSubDocType(r);p===l.HeaderFooter&&(t.snapToGrid=!1);var g=a.updatingPack;e.rect||(e.rect=I.a.initByRawRect({top:0,left:0,right:t.usableWidth||g.rect.width,bottom:0}));var f=s.pos;for(n.glyphIterator.seek(s.pos),f=s.pos;f<s.pos+s.len&&[W.k,W.i].includes(n.glyphIterator.charCode);f++)n.glyphIterator.next();if(n.glyphIterator.seek(r),r===s.pos&&(t.isFirstLineInPara=!0,e.is_para_first=!0),r===f&&(t.isFirstLineInPara=!0),n.glyphIterator.glyphGroup&&n.glyphIterator.glyphGroup.isMath()){var v=n.document,m=v.mathManager.getMath(r,!0),y=m.pos,k=y+m.len,b=s.pos+s.len;t.isOMathPara=(y==s.pos&&!c.hasAutoNum()||y>0&&[Ee,Me].includes(v.getText(y-1,1)))&&(k===b-1||k===b||v.getText(k-1,1)===Me)}M.execute(t,e,a,n),p!==l.MainText||t.isOMathPara||e.isInTable||e.isInTextFrame||A.adjustMargin(e,t,n),M.updateRectByIndent(e,t,n),t.isFirstLineInPara&&de.execute(t,e,a,n),t.isOMathPara&&(e.isOMathPara=!0),t.charPos=t.textStart=e.textStart(),t.textEnd=e.textEnd(),t.minCharPos=t.charPos,t.gridHeight=u.getGridHeight(),!n.document.settings.getSnapTextToGridInTable()&&e.isInTable&&(t.gridHeight=0),t.thisGlyphIterator=n.glyphIterator,t.lastGlyphIter=t.thisGlyphIterator.clone(),t.lastVisibleGlyphIter=null,t.ccp=0,t.ccpTypo=0,t.lineCompress={},t.lineCompress.comAtom={},t.lineCompress.spaceComList=[],t.lineCompress.puncComList=[],t.lineCompress.otherComList=[],E.d.TypoJustificationModeExpand==n.document.settings.getJustificationMode()&&(t.lineCompress.bForbidCompress=!0),t.lineMdInfo={},t.lineMdInfo.dxList=[],t.lineMdInfo.dOffsetList=[],t.update_begin=n.pos,t.maxScanPos=t.update_begin,t.lastTabGlyph=null,t.lastTabPos=0,t.firstDecimalPos=0,t.dataStatus=n,t.bForceRenderChar=t.forceRenderChar,t.embedShapes=[],t.isRTL=c.getPropVal("bidi"),t.canDoCompress=function(){return!1!==t._canDoCompress&&!!t.updatingZone.canDoCompress()},ge.onLineBegin(e,t,n)}},{key:"processLine",value:function(e,t){t.lineUpdater.updateLine(e,t)}},{key:"acceptLineBreak",value:function(e,t,a){++t.ccp,++a.typoRange.len,++t.ccpTypo,t.dataStatus.next()}},{key:"checkLineBreak",value:function(e){if(e.curPapx){if(e.dataStatus.papx!=e.curPapx){if(e.lineUpdater.packUpdater.selectLinePolicy)return e.lineUpdater.packUpdater.selectLinePolicy(e.pack,e.packStatus)!=e.packStatus.getUpdatingLinePolicy()}}else e.curPapx=e.dataStatus.papx;return!1}},{key:"processZone",value:function(t,a,n){var i=a.dataStatus;a.next=function(){a.lastGlyphIter.seekIt(a.thisGlyphIterator),a.thisGlyphIterator=i.next(),a.maxScanPos=Math.max(i.pos,a.maxScanPos),++a.ccp,++n.typoRange.len,a.lastGlyphIter.glyphGroup.isVisible()&&(++a.ccpTypo,null===a.lastVisibleGlyphIter?a.lastVisibleGlyphIter=a.lastGlyphIter.clone():a.lastVisibleGlyphIter.seekIt(a.lastGlyphIter))};var r=!1,o=a.lineUpdater,s=i.document.settings.getSplitPgBreakAndParaMark();for(a.thisGlyphIterator=i.glyphIterator;!(r=o.isDataEnd(t,a))&&!e.checkLineBreak(a,i);a.next()){var c=a.thisGlyphIterator.glyphGroup;if(c&&!c.isRevisionHidden()){if(c.isFootnote()||c.isEndnote()||c.isFootEndNotePlaceholder()){var l=o.selectZonePolicyByFootnoteEndnote(t,a,c);if(l&&l!==a.curPolicy){a.nextZonePolicy=l;break}}if(i.isChpxBegin&&i.chpx.prop){var u=o.selectZonePolicyByChpxBegin(t,a);if(u&&u!==a.curPolicy){a.nextZonePolicy=u;break}}if(c.isSpec()){var h=o.selectZonePolicyBySpecChar(t,a,c);if(h&&h!==a.curPolicy){a.nextZonePolicy=h;break}}if(i.isChpxBegin){var d=o.selectTextZonePolicy(t,a);if(d&&d!==a.curPolicy){a.nextZonePolicy=d;break}}if(c.isParaBreak()){t.isLineBroken=!0;var p=!0,g=i.pos+1,f=i.makeGlyphAt(g);if(f&&f.glyphGroup&&f.glyphGroup.isSepBreak()&&(p=!1),f&&f.free(),p){!f&&t.isPageBrokenParaMark||e.acceptLineBreak(t,a,n);break}}else{if(!c.isHidden()&&c.isClusterStart()||c.isMath()){if(t.isPageBrokenParaMark&&!c.isSepBreak())break}else{var v=!0;if(c.isSepBreak()&&c.isHidden()){var m=i.getProps().para;m&&m.pos===c.pos&&(v=!1)}if(v)continue}if(c.isLineBreak()){t.isLineBroken=!0,t.isSoftLineBroken=!0,e.acceptLineBreak(t,a,n);break}if(c.isColBreak()){t.isLineBroken=!0,t.isPackBroken=!0,0===a.ccp&&(t.isControlLine=!0);var y=!0;if(a.thisGlyphIterator.charCode==W.k){t.isPageBroken=!0;var k=i.bodyRange.end,b=i.pos+1;if(s){e.acceptLineBreak(t,a,n);break}for(;b<k;){var P=i.makeGlyphAt(b);if(!P)break;if(!(P.glyphGroup.isDrawing()||P.glyphGroup.isSepBreak()||P.glyphGroup.isHidden()||P.glyphGroup.isSpecHidden())){if(P.glyphGroup.isParaBreak()&&b!==k-1){y=!1,t.isPageBrokenParaMark=!0,P.free();break}P.free();break}++a.ccp,++n.typoRange.len,a.dataStatus.next(),P.free(),++b}}if(y){e.acceptLineBreak(t,a,n);break}}else{if(c.isSepBreak()){t.isLineBroken=!0;0!==a.ccp&&0!==a.ccpTypo||(t.isControlLine=!0),t.isPackBroken=!0,e.acceptLineBreak(t,a,n);break}var x=!0;if(c.isMath()){var _=a.thisGlyphIterator.position;if(x=this.processMath(t,a,i)){var C=a.thisGlyphIterator.position-_;a.ccp+=C,n.typoRange.len+=C,i.locate(i.pos+C)}}else if(c.isNormal()||c.isFarEast()||c.isZero()||c.isGlyphComplex()||c.isDrawing())x=this.processNormalChar(t,a,i);else if(c.isSpace())x=this.processSpace(t,a,i);else if(c.isEmbedDrawing()){if((x=this.processEmbedDrawing(t,a,i))&&0===a.ccpTypo&&c.isOleEmbedDrawing()&&Object(Ie.e)(a.charPos,a.textEnd)){a.next();break}}else c.isTab()&&(x=this.processTab(t,a,i));if(!x&&!a.bForceRenderChar)break;a.bForceRenderChar=!1}}}}return r?a.hasNextZone?B.a.Pass:B.a.DataEnd:t.isLineBroken?B.a.LineBroken:a.nextZonePolicy?B.a.Pass:B.a.LineEnd}},{key:"forward",value:function(e,t){e.charPos+=t,e.canDoCompress()?e.minCharPos+=e.thisGlyphIterator.minWidth:e.minCharPos+=t}},{key:"processNormalChar",value:function(t,a,n,i){var r=i,o=!0;t.hasHangPunc&&(o=!1);var s=a.thisGlyphIterator;"."===s.char&&Be.setDecimalTabContext(a);var c=!1;if(a.bLineCompressed)return(o=!!Ce.doCompressAgain(t,a,n)||ge.execute(t,a,n))&&this.forward(a,a.curCharRealWidth),o;if(E.c.Typo_GridMode_SnapText==a.gridMode||a.ccp>1||s.width==s.lineHeaderWidth)r=s.width;else{var l=s.glyphGroup.papx;"R2L"!=a.pack.textflow.corX&&l.topline_punct&&(c=X.a.isHeadCompressPunc(s.charCode),r=s.lineHeaderWidth,a.bSpecAdjed=!0)}r||(r=s.width),a.curCharRealWidth=r;var u=0;return a.eqZoneWidth&&(u=a.eqZoneWidth),Object(Ie.e)(a.charPos+r+u,a.textEnd)&&(o=!!a.bForceRenderChar||this.dealLineExceed(t,a,n,r)),o&&(this.forward(a,a.curCharRealWidth),c&&e.compLineHeadPunc(a,s)),o}},{key:"compLineHeadPunc",value:function(t,a){if(0===t.ccp&&E.c.Typo_GridMode_SnapText!=t.gridMode){var n=a.lineHeaderWidth-a.width;0!=n&&e.advanceLineMdInfo(t,n,a,t.ccp-1)}}},{key:"advanceLineMdInfo",value:function(e,t,a,n){if(0==t||n<0)return!1;var i=e.lineMdInfo,r={};r.idx=n,r.dx=t,i.dxList.push(r);var o=t;if(o&&!a.glyphGroup.isCharBox()&&X.a.isPureHeadPunc(a.charCode)){var s={};s.idx=n,s.dOffset=o,i.dOffsetList.push(s)}return!0}},{key:"dealLineExceed",value:function(e,t,a,n){var i=!1;return i||t.lineCompress.bForbidCompress||this.processCharEx(e,t,a,n)&&(i=!0),!i&&ge.execute(e,t,a)&&(i=!0),i}},{key:"processCharEx",value:function(e,t,a,n){var i=n,r=this.calcNeedSpace(t,i),o=t.thisGlyphIterator,s=!1;if(o.glyphGroup.isCharBox()||!X.a.isHeadPunc(o.charCode)){var c=o.minWidth,l=this.adjCurGlyph(c,i,r);s=l.bRet,i=l.lineTailWidth,r=l.needSpace}return s?this.reProcessCurGlyph(e,t,o,i,a):!!Ce.doFirstCompress(e,t,a)}},{key:"calcNeedSpace",value:function(e,t){var a=t+e.charPos-e.textEnd;return a<0&&(a=0),a}},{key:"adjCurGlyph",value:function(e,t,a){return 0!=a&&t>e&&t-e>=a?{bRet:!0,lineTailWidth:t-a,needSpace:0}:{bRet:!1,lineTailWidth:t,needSpace:a}}},{key:"reProcessCurGlyph",value:function(e,t,a,n,i){t.curCharRealWidth=n;var r=n-a.width;0!=r&&Ce.updateLineMdInfo(t,r,a,t.ccp),t.lineCompress.lastNotSpaceGlyph=t.thisGlyphIterator,t.bLineCompressed=!0;var o=t.lastGlyphIter;o&&o.glyphGroup.isFarEast()&&(i.papx.prop.getPropVal("kinsoku")&&!o.glyphGroup.isCharBox()&&X.a.isHeadPunc(o.charCode)||(t.lineCompress.bPrevPrevIsCNJudgeNextCom=!0),X.a.isTailPunc(o.charCode)&&(t.lineCompress.bPrevPrevIsFETailPunc=!0));return!0}},{key:"processSpace",value:function(e,t,a){var n=t.thisGlyphIterator,i=n.width,r=t.lastGlyphIter,o=t.lastVisibleGlyphIter,s=!0;(t.bWordWrap||X.a.isNonBreakSpace(n.charCode)||t.charPos>t.textEnd&&e.hasHangPunc||t.isRTL||t.forbidSpaceExceed)&&(s=!1);var c=!0;if(t.charPos+i>t.textEnd&&!t.bForceRenderChar&&(s&&Object(Ie.e)(t.charPos,t.textEnd)&&!e.hasPuncHang&&o&&!X.a.isNormalSpace(o.charCode)&&!X.a.isFullWidthSpace(o.charCode)&&(s=!1),s?(e.isOverLineEndBySpace=!0,!t.lineCompress.bLESsCanCompress&&t.charPos<=t.textEnd&&!t.lineCompress.bForbidCompress&&(t.lineCompress.bExistLESs=!0,r&&X.a.isNormalSpace(r.charCode)||r&&X.a.isFullWidthSpace(r.charCode)||X.a.isNormalSpace(n.charCode)?t.lineCompress.bLESsCanCompress=!0:X.a.isFullWidthSpace(n.charCode),t.isOverLineEndFirstSpaceAssigned||(t.isOverLineEndFirstSpaceAssigned=!0,t.overLineEndFirstSpacePos=a.pos,t.overLineEndFirstSpacePos-=1),!t.lineCompress.bForbidCompress&&X.a.isNonBreakSpace(n.char)&&(t.lineCompress.lastNotSpaceGlyph=t.thisGlyphIterator)),c=!0):(c=!1,t.lineCompress.bForbidCompress||t.bLineCompressed&&(c=Ce.doCompressAgain(e,t,a)))),c){var l=t.updatingZone;l.parent&&l.parent.inEqZone&&n.mi?this.forward(t,n.mi.realWidth):this.forward(t,i)}return c}},{key:"processEmbedDrawing",value:function(e,t,a){var n=!0,i=t.thisGlyphIterator,r=i.glyphGroup,o=t.embedPolicy.create(e,t,a.pos);if(o&&i.mi){var s=p()({},o.size);if(o.anchor.hasVaildEffectExtents()){var c=o.visualRotation;if(0!==c){var l=I.a.initByOriginAndSize({x:0,y:0},s);Object(Oe.b)(c,l),s.width=l.width,s.height=l.height}var u=o.anchor.effectExtents,h=u.left,d=u.top,g=u.right,f=u.bottom;s.width+=Object(T.Ti2Px)(h+g),s.height+=Object(T.Ti2Px)(d+f)}else if(o.isPresetDrawing){var v=o.innerBoundary,m=v&&v.size;m&&(m.width||m.height)&&(s=p()({},m))}else{var y=o.innerBoundary;if(y){var k=I.a.initByOriginAndSize({x:0,y:0},s),b=o.rotation;0!==b&&Object(Oe.b)(b,k);var P=Math.min(k.left,y.left),x=Math.max(k.right,y.width),_=Math.min(k.top,y.top);s={width:x-P,height:Math.max(k.bottom,y.bottom)-_}}}var C=s.width,w=s.height,S=t.pack.textflow,L="L2R"===S.corX&&"T2B"===S.corY,R=0;if(r&&r.chpx&&r.chpx.position&&(R=Object(T.Ti2Px)(r.chpx.position)),o.isExclusive&&(C=t.usableWidth,t.hasExclusiveEmbed=!0),L){i.mi.setFixedWidth(C);var O=0,B=0,M=r.papx.getProp("vertical_align_mode");"top"==(M=M.def&&r.isTransposeCoor?"middle":M.val)||1==M?B=w:O="middle"==M||2==M?B=w/2:w,O+=R,B-=R,i.setMetrics({ascent:O,descent:B,measureAscent:O,measureDescent:B,height:w})}else{i.mi.setFixedWidth(w);var E=C+R,A=-R;i.setMetrics({ascent:E,descent:A,measureAscent:E,measureDescent:A,height:C})}n=this.processNormalChar(e,t,a,C)}return n&&(e.hasExclusiveEmbed=t.hasExclusiveEmbed,t.embedPolicy.add(e,t,o)),n}},{key:"processTab",value:function(e,t,a){var n=!0;t.thisGlyphIterator.glyphGroup.isTab()&&(Be.updateTabGlyph(t),Be.execute(t,e,a)||(n=!1));return n}},{key:"getCellStyle",value:function(e,t,a){if(!t)return null;var n=Te.a.init(t,a);return n&&n.getCellStyle(t.tablecells.findIndex((function(t){return e===t})),e)}},{key:"getOutShd",value:function(t,a){for(var n=t.getWholePath(),i=n[n.length-1],r=i.length-1;r>=0;--r){var o=i[r];if(o instanceof we.c){var s=o.style||e.getCellStyle(o,i[r-1],a);if(s&&s.shd){var c=s.shd.backColor,l=new Se.a(c).colorEx;if("#ffffffffff000000"!==l)return l}}else if(o instanceof Le.a){var u=o.anchor,h=u&&u.shapeData&&u.shapeData.style;if(h){var d=h.fillColor&&h.fillColor.toRGB;if(d)return d.length>7&&(d="#"+d.slice(3,d.length)),d}}}}},{key:"processMath",value:function(t,a,n){var i=a.thisGlyphIterator,r=function(e){var i=e.pos,r=a.embedPolicy.create(t,a,i),o=n.glyphpool.glyphBuff.getMi(i);if(r&&o){var s=r.size.width,c=r.size.height,l=c;o.setFixedWidth(s),e.metrics={ascent:l,descent:0,measureAscent:l,measureDescent:0,height:c},e.shape=r}},o=function(e){var a=e.pos,i=t.viewPage,r=n.data.doc,o=void 0,s=void 0;if(e.isFootnote())o=r.footnotes.getNote(a),s=!0;else if(e.isEndnote())o=r.endnotes.getNote(a),s=!1;else{o=(s=r.getSubDocType(a)===l.Footnote)?r.footnoteBodys.getRefByPos(a):r.endnoteBodys.getRefByPos(a)}return o?Object(Re.f)(o,s,i,r):" "},s=a.isOMathPara,c=n.data.typoinfo.mathCache,u=e.getOutShd(t,n.data),h=s?c.get(i.position,a.textEnd-a.textStart,r,o,u):c.slice(i.position,a.textEnd-a.charPos,r,o);if(h){var d=!0;if(a.charPos+h.width>a.textEnd&&!a.bForceRenderChar&&(d=!1),d){a.charPos+=h.width,a.minCharPos+=h.width,a.thisGlyphIterator=n.makeGlyphAt(i.position+h.len-1);var p=h.getEmbeds();p&&p.length&&p.forEach((function(e){a.embedPolicy.add(t,a,e.data.shape)}))}return h.isBreak&&(a.isLineBroken=!0),d}return this.processNormalChar(t,a,n)}},{key:"endLine",value:function(e,t){var a=t.dataStatus;t.rollBack=function(a,n){t.ccp-=n;for(var i=n;i>0;){var r=e.zones[e.zones.length-1];r.typoRange.len<=i?((i-=r.typoRange.len)<=0&&a.locate(r.getDataRange().pos),e.zones.pop()):(r.rollBack(i,a),i=0)}t.thisGlyphIterator=a.glyphIterator,t.lastGlyphIter.seek(a.pos-1)},Be.updateTabGlyph(t),ge.onLineEnd(e,t,a);var n=0;!a.isDataEnd&&!e.isLineBroken&&t.ccp>0&&!e.zoneExceed&&(n=this.dealLineRule(e,t,a),n+=this._lineEndHideCharFallBack(e,t,a)),t.lineCompress.bForbidCompress||Ce.onLineEnd(t,e,n),e.lineMdInfo=t.lineMdInfo;var i=a.pos;e.range.reset(t.update_begin,i),e.textWidth=t.charPos+(e.after_indent||0),_e.calcHeight(e,t,a),t.lastGlyphIter&&t.lastGlyphIter.free()}},{key:"dealLineRule",value:function(e,t,a){t.backup=function(e,t,a){var n=e.zones.map((function(e){return{zone:e,len:e.typoRange.len}}));return{dataStatusPos:a.pos,lineStatusBak:t,lineCcpBackup:t.ccp,zonesBackup:n}},t.restore=function(e,t,a,n){a.locate(n.dataStatusPos),n.lineStatusBak.ccp=n.lineCcpBackup,e.zones=n.zonesBackup.map((function(e){var t=e.zone;return t.resetLen(e.len),t}))};var n=t.backup(e,t,a),i=!1,r=!1,o=!1;do{if(i=!1,r|=i|=fe.execute(e,t,a),t.ccp<=0){o=!0;break}var s=a.pos;if(r|=i=me.execute(e,t,a)&&s!=a.pos,t.bWholeLineBack){o=!0;break}if(r|=i|=ve.execute(e,t,a),!i){var c=a.makeGlyphAt(a.pos-1),l=a.papx.prop.getPropVal("kinsoku");c&&X.a.isHeadPunc(c.charCode)&&l&&(t.rollBack(a,1),r|=i|=!0),c.free()}a.pos==t.update_begin&&(o=!0)}while(i&&!o);var u=a.pos,h=u,d=a.makeGlyphAt(u);if(d.position!=t.update_begin&&!d.glyphGroup.isTab()){do{d.prev()}while(d.position!=t.update_begin&&d.glyphGroup.isHidden());var p=d.glyphGroup.isTab();p&&d.position==t.update_begin&&(o=!0),p&&(h=d.position,r=!0)}if(d.free(),r||o){if(o&&t.itOverLineEndFirstSpaceAssigned,o&&t.forceRenderChar)return t.restore(e,t,a,n),0;u>h&&t.rollBack(a,u-h)}return n.lineCcpBackup-t.ccp}},{key:"_lineEndHideCharFallBack",value:function(e,t,a){for(var n=t.ccp-1,i=a.makeGlyphInLineAt(t.ccp-1,e);n>=0&&(!i.glyphGroup||i.glyphGroup.isMath()||fe.isHiddenCanSkipGlyph(t,i));--n,i.prev());if(i&&i.free(),n<t.ccp-1){if(t.forceRenderChar&&n<0)return 0;var r=t.ccp-n-1;return t.rollBack(a,r),r}return 0}}]),e}(),He=a(1916);function Ue(e){return 20*e+.01}var De=function(){function e(){i()(this,e)}return o()(e,null,[{key:"onLineBegin",value:function(t,a,n,i){var r=a.dataStatus;n.border={left_width:0,right_width:0,before_width:0,after_width:0};var o=void 0;if(a.lastLine){var s=r.final.getPapx(a.lastLine.range.begin);s.good&&(o=s)}var c=r.papx,l=1===t.lines.length&&!i.isWebMode,u=o&&!(l&&o.begin===c.begin)&&e._isMergeBorder(o.prop,c.prop)||!1;e._initParaBorder(a,i,o,u,l),r.isPapxBegin&&(n.border.before_width=i.paraBorder.borderBefore),n.border.left_width=i.paraBorder.borderLeft,n.border.right_width=i.paraBorder.borderRight}},{key:"onUpdatingLineRejected",value:function(t,a){if(a.lastLine){var n=a.dataStatus.final.getPapx(a.lastLine.range.begin);n&&(a.updatingLine.range.begin<n.pos||a.updatingLine.range.begin>=n.end)&&(a.lastLine.border.after_width=e._calcBdrWidth(n.prop.border_bottom),a.lastLine.sublines&&a.lastLine.sublines.forEach((function(e){e.border.after_width=a.lastLine.border.after_width})))}}},{key:"onLineEnd",value:function(t,a,n,i){if(n.isHidden)n.border={left_width:0,right_width:0,before_width:0,after_width:0};else{var r=a.dataStatus,o=r.final.getPap(n.range.begin),s=void 0;n.range.end<a.bodyRange.pos+a.bodyRange.len&&(s=r.final.getPap(n.range.end)),o&&s&&e._isMergeBorder(o,s)||!1?o.border_between&&o.border_between.style&&o.border_between.style!==He.l?n.border.after_width=e._getBorderMargin(o.border_top):n.border.after_width=0:n.border.after_width=i.paraBorder.borderAfter}}},{key:"onPackDone",value:function(t){if(t.lastLine){var a=t.hostStatus.updatingPack;if(a&&0!==a.lines.length){var n=t.dataStatus,i=t.updatingLineStatus,r=n.final.getPapx(n.pos,g.IT.Exclude),o=n.final.getPapx(n.pos);(r&&o&&e._isMergeBorder(r.prop,o.prop)||!1)&&null!=i.paraBorder&&(t.lastLine.border.after_width=i.paraBorder.borderAfter)}}}},{key:"_isMergeBorder",value:function(t,a){if(t&&a){var n=!1,i=t.left_indent_abs||0,r=a.left_indent_abs||0,o=t.right_indent_abs||0,s=a.right_indent_abs||0;if(i===r&&o===s&&(n=!0),n&&e._isBorderVauleEqual(t.border_top,a.border_top)&&e._isBorderVauleEqual(t.border_bottom,a.border_bottom)&&e._isBorderVauleEqual(t.border_right,a.border_right)&&e._isBorderVauleEqual(t.border_left,a.border_left))return!0}return!t&&!a}},{key:"_calcBdrWidth",value:function(t){return(e._getBorderWidth(t)||0)+e._getBorderMargin(t)}},{key:"_getBorderMargin",value:function(e){return e?Object(T.Ti2Px)(e.margin||0):0}},{key:"_getBorderWidth",value:function(t){if(!t||!t.style||t.style===He.l)return 0;var a=t.lineWidth||0;return Object(T.Ti2Px)(a+e._getExBorderWidth(t.style,a))}},{key:"_initParaBorder",value:function(t,a,n,i,r){var o=t.dataStatus.papx.prop,s=o.border_bottom,c=o.border_top,l=o.border_left,u=o.border_right;if(a.paraBorder={},a.paraBorder.borderLeft=e._calcBdrWidth(l),a.paraBorder.borderRight=e._calcBdrWidth(u),a.paraBorder.borderBefore=0,a.paraBorder.borderAfter=e._calcBdrWidth(s),t.lastLine&&n&&i&&!r){if(t.lastLine){var h=n.prop.border_between;h&&h.style&&h.style!==He.l&&(a.paraBorder.borderBefore=e._getBorderWidth(h)+e._getBorderMargin(c))}}else a.paraBorder.borderBefore=e._calcBdrWidth(c)}},{key:"_isBorderVauleEqual",value:function(t,a){return!t&&!a||!(!t||!a)&&e._isObjectValueEqual({color:t.color,lineWidth:t.lineWidth,margin:t.margin,sytle:t.style,styleType:t.styleType},{color:a.color,lineWidth:a.lineWidth,margin:a.margin,sytle:a.style,styleType:a.styleType})}},{key:"_isObjectValueEqual",value:function(t,a){if(!t&&!a)return!0;if(t&&a){var n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(a);if(n.length!==i.length)return!1;for(var r=0;r<n.length;r++){var o=n[r];if("[object Object]"===Object.prototype.toString.call(t[o])){if(!e._isObjectValueEqual(t[o],a[o]))return!1}else if(t[o]!==a[o])return!1}return!0}return!1}},{key:"_getExBorderWidth",value:function(e,t){var a=0;switch(e){case He.u:case He.r:a=Ue(1.5);break;case He.x:a=Ue(3);break;case He.t:case He.q:a=t/2+t/2;break;case He.w:a=t/2+t/2+t/2+t/2;break;case He.s:case He.p:a=Ue(2.25);break;case He.v:a=Ue(3)+t;break;case He.o:a=Ue(2.25);break;case He.h:a=Ue(4.5);break;case He.i:case He.j:a=t<Ue(3)?2*Ue(.75):2*Ue(1.5);break;case He.y:a=4*t;break;case He.g:a=2*t}return a}}]),e}(),Ne=a(3858),Fe=function(){function e(){i()(this,e)}return o()(e,null,[{key:"onLineBegin",value:function(t,a,n,i){var r=a.dataStatus;a.isMergeParaSpacing=r.document.settings.getIsMegerParaSpacing(),e._initParaSpacing(a,i),n.after_space=0,n.before_space=0;var o=0;if(r.pos>a.bodyRange.pos){var s=r.makeGlyphAt(r.pos-1);s?(o=s.charCode,s.free()):console.warn("此处有问题，需排查原因.")}if(!(r.pos>0&&r.pos!==r.getProps().para.pos)||o&&(o===W.j||o===W.i||o===W.k)&&r.pos-1===r.getProps().para.pos){var c=a.lastLine;if(0===a.updatingLineTop&&o&&(W.k===o||W.i===o)){var l=a.prevPack;if(c&&c.isControlLine&&l){var u=l.lines;c=u&&u.length>1?u[u.length-2]:null}}if(c&&c.isSnippetLine&&c.isWrapTable){var h=t.lines,d=h.indexOf(c);if(void 0!==d){c=null;for(var p=d-1;p>=0;--p){var f=h[p];if(f&&!f.isSnippetLine){c=f;break}}}}if(c){if(i.isWebMode||0!==a.updatingLineTop||!o||W.m===o||W.k===o||W.i===o){var v=r.glyphIterator.charCode;if(W.k!==v&&W.i!==v)if(a.isMergeParaSpacing){var m=r.papx.prop,y=r.lastPapx.good&&r.lastPapx.prop;if(!(!y||m.contextual_spacing&&e._isObjectValueEqual(y.basestyle,m.basestyle)||y&&m.list_id&&y.list_id&&m.list_id===y.list_id&&m.para_margin_before_auto)){if(o&&o===W.m){var k=r.final.getPapx(r.pos,g.IT.Exclude).prop,b=this.getAfterSpace(k),P=0;if(k.para_margin_after_auto)P=a.isMergeParaSpacing?Object(T.Ti2Px)(e.AUTO_DEFUALT_SPACING):Object(T.Ti2Px)(k.value);else if(b.isAbs)P=Object(T.Ti2Px)(b.value);else{var x=r.document.sections.getSection(r.pos-1),_=x.getGridHeight()||0,C=x.getSnapMode();P=_&&C!==Ne.c?Object(T.Ti2Px)(b.value*_/100):Object(T.Ti2Px)(b.value*e.DEFAULT_GRID_HEIGHT/100)}return i.paraSpace.beforeSpace>P?void(n.before_space=i.paraSpace.beforeSpace-P):void 0}i.paraSpace.beforeSpace>c.after_space&&(n.before_space=i.paraSpace.beforeSpace-c.after_space)}}else n.before_space=i.paraSpace.beforeSpace}}else i.paraSpace.isAutoBeforeSpace||(n.before_space=i.paraSpace.beforeSpace)}}},{key:"onLineEnd",value:function(t,a,n,i){if(n.isHidden)return n.after_space=0,void(n.before_space=0);var r=a.dataStatus,o=r.final.getPapx(r.pos,g.IT.Exclude),s=r.final.getPapx(r.pos);if(!o||!s||o.pos!==s.pos){var c=0;if(r.pos>0){var l=r.makeGlyphAt(r.pos-1);l&&(c=l.charCode,l.free())}if((W.k!==c||W.i!==c)&&!(o.prop.contextual_spacing&&e._isObjectValueEqual(s.prop.basestyle,o.prop.basestyle)||o.prop.list_id&&s.prop.list_id&&o.prop.list_id===s.prop.list_id&&o.prop.para_margin_after_auto)){if(t.isInTable){var u=r.document.settings.getIsMegerParaSpacing();if(!n.auto_num&&u&&o.prop.para_margin_after_auto)return}n.after_space=i.paraSpace.afterSpace}}}},{key:"_initParaSpacing",value:function(t,a){var n=t.dataStatus,i=n.papx.prop,r={beforeSpace:0,afterSpace:0},o=void 0,s=void 0;if(i.para_lineunit_margin_before||i.para_lineunit_margin_after)if(n.document.getSubDocType(n.pos)===l.HeaderFooter)o=0,s=Ne.c;else{var c=n.document.sections.getSection(n.pos);o=c.getGridHeight()||0,s=c.getSnapMode()}var u=this.getBeforeSpace(i),h=t.isMergeParaSpacing;i.para_margin_before_auto?(r.beforeSpace=h?Object(T.Ti2Px)(e.AUTO_DEFUALT_SPACING):Object(T.Ti2Px)(u.value),r.isAutoBeforeSpace=!0):u.isAbs?r.beforeSpace=Object(T.Ti2Px)(u.value):o&&s!==Ne.c?r.beforeSpace=Object(T.Ti2Px)(u.value*o/100):r.beforeSpace=Object(T.Ti2Px)(u.value*e.DEFAULT_GRID_HEIGHT/100);var d=this.getAfterSpace(i);i.para_margin_after_auto?(r.afterSpace=h?Object(T.Ti2Px)(e.AUTO_DEFUALT_SPACING):Object(T.Ti2Px)(d.value),r.isAutoAfterSpace=!0):d.isAbs?r.afterSpace=Object(T.Ti2Px)(d.value):o&&s!==Ne.c?r.afterSpace=Object(T.Ti2Px)(d.value*o/100):r.afterSpace=Object(T.Ti2Px)(d.value*e.DEFAULT_GRID_HEIGHT/100),r.beforeSpace=r.beforeSpace*a.paraSpacingScale,r.afterSpace=r.afterSpace*a.paraSpacingScale,a.paraSpace=r}},{key:"getBeforeSpace",value:function(t){var a={value:0,isAbs:!1};return t.para_lineunit_margin_before&&t.para_lineunit_margin_before!==e.INVALID_PARA_MARGIN?(a.value=t.para_lineunit_margin_before,a.isAbs=!1):t.para_margin_before&&t.para_margin_before!==e.INVALID_PARA_MARGIN&&65535!==t.para_margin_before?(a.value=t.para_margin_before,a.isAbs=!0):(a.value=0,a.isAbs=!0),a}},{key:"getAfterSpace",value:function(t){var a={value:0,isAbs:!1};return t.para_lineunit_margin_after&&t.para_lineunit_margin_after!==e.INVALID_PARA_MARGIN?(a.value=t.para_lineunit_margin_after,a.isAbs=!1):t.para_margin_after&&t.para_margin_after!==e.INVALID_PARA_MARGIN&&65535!==t.para_margin_after?(a.value=t.para_margin_after,a.isAbs=!0):(a.value=0,a.isAbs=!0),a}},{key:"_isObjectValueEqual",value:function(t,a){if(!t&&!a)return!0;if(t&&a){var n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(a);if(n.length!==i.length)return!1;for(var r=0;r<n.length;r++){var o=n[r];if("[object Object]"===Object.prototype.toString.call(t[o])){if(!e._isObjectValueEqual(t[o],a[o]))return!1}else if(t[o]!==a[o])return!1}return!0}return!1}}]),e}();Fe.INVALID_PARA_MARGIN=-2147483648,Fe.AUTO_DEFUALT_SPACING=280,Fe.DEFAULT_GRID_HEIGHT=240;var We=Fe,Ge=a(1251);function je(e,t,a,n,i,r){this.setValues(e,t,a,n,i,r)}var Ve=je.prototype;je.DEG_TO_RAD=Math.PI/180,je.identity=null,Ve.setValues=function(e,t,a,n,i,r){return this.a=null==e?1:e,this.b=t||0,this.c=a||0,this.d=null==n?1:n,this.tx=i||0,this.ty=r||0,this},Ve.append=function(e,t,a,n,i,r){var o=this.a,s=this.b,c=this.c,l=this.d;return 1==e&&0==t&&0==a&&1==n||(this.a=o*e+c*t,this.b=s*e+l*t,this.c=o*a+c*n,this.d=s*a+l*n),this.tx=o*i+c*r+this.tx,this.ty=s*i+l*r+this.ty,this},Ve.prepend=function(e,t,a,n,i,r){var o=this.a,s=this.c,c=this.tx;return this.a=e*o+a*this.b,this.b=t*o+n*this.b,this.c=e*s+a*this.d,this.d=t*s+n*this.d,this.tx=e*c+a*this.ty+i,this.ty=t*c+n*this.ty+r,this},Ve.appendMatrix=function(e){return this.append(e.a,e.b,e.c,e.d,e.tx,e.ty)},Ve.prependMatrix=function(e){return this.prepend(e.a,e.b,e.c,e.d,e.tx,e.ty)},Ve.appendTransform=function(e,t,a,n,i,r,o,s,c){var l=void 0,u=void 0;if(i%360){var h=i*je.DEG_TO_RAD;l=Math.cos(h),u=Math.sin(h)}else l=1,u=0;return r||o?(r*=je.DEG_TO_RAD,o*=je.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(r),Math.cos(r),e,t),this.append(l*a,u*a,-u*n,l*n,0,0)):this.append(l*a,u*a,-u*n,l*n,e,t),(s||c)&&(this.tx-=s*this.a+c*this.c,this.ty-=s*this.b+c*this.d),this},Ve.prependTransform=function(e,t,a,n,i,r,o,s,c){var l=void 0,u=void 0;if(i%360){var h=i*je.DEG_TO_RAD;l=Math.cos(h),u=Math.sin(h)}else l=1,u=0;return(s||c)&&(this.tx-=s,this.ty-=c),r||o?(r*=je.DEG_TO_RAD,o*=je.DEG_TO_RAD,this.prepend(l*a,u*a,-u*n,l*n,0,0),this.prepend(Math.cos(o),Math.sin(o),-Math.sin(r),Math.cos(r),e,t)):this.prepend(l*a,u*a,-u*n,l*n,e,t),this},Ve.rotate=function(e){e*=je.DEG_TO_RAD;var t=Math.cos(e),a=Math.sin(e),n=this.a,i=this.b;return this.a=n*t+this.c*a,this.b=i*t+this.d*a,this.c=-n*a+this.c*t,this.d=-i*a+this.d*t,this},Ve.skew=function(e,t){return e*=je.DEG_TO_RAD,t*=je.DEG_TO_RAD,this.append(Math.cos(t),Math.sin(t),-Math.sin(e),Math.cos(e),0,0),this},Ve.scale=function(e,t){return this.a*=e,this.b*=e,this.c*=t,this.d*=t,this},Ve.translate=function(e,t){return this.tx+=this.a*e+this.c*t,this.ty+=this.b*e+this.d*t,this},Ve.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},Ve.invert=function(){var e=this.a,t=this.b,a=this.c,n=this.d,i=this.tx,r=e*n-t*a;return this.a=n/r,this.b=-t/r,this.c=-a/r,this.d=e/r,this.tx=(a*this.ty-n*i)/r,this.ty=-(e*this.ty-t*i)/r,this},Ve.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},Ve.equals=function(e){return this.tx===e.tx&&this.ty===e.ty&&this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d},Ve.transformPoint=function(e,t,a){return(a=a||{}).x=e*this.a+t*this.c+this.tx,a.y=e*this.b+t*this.d+this.ty,a},Ve.decompose=function(e){null==e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var t=Math.atan2(-this.c,this.d),a=Math.atan2(this.b,this.a);return Math.abs(1-t/a)<1e-5?(e.rotation=a/je.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=t/je.DEG_TO_RAD,e.skewY=a/je.DEG_TO_RAD),e},Ve.copy=function(e){return this.setValues(e.a,e.b,e.c,e.d,e.tx,e.ty)},Ve.clone=function(){return new je(this.a,this.b,this.c,this.d,this.tx,this.ty)},Ve.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},je.identity=new je;var ze={Matrix2D:je};function Ze(e,t,a){return t.y===e.y?{rs:!1}:function(e,t,a){return(e-a)*(t-a)<=0}(e.y,t.y,a)?{rs:!0,xInter:(t.x-e.x)*(a-e.y)/(t.y-e.y)+e.x}:{rs:!1}}var qe=function(){function e(t,a,n,r){i()(this,e),this.points=[t,a],this.xPtMin=Number.MAX_SAFE_INTEGER,this.xPtMax=-Number.MAX_SAFE_INTEGER,this.throughTop=!1,this.throughBottom=!1,this._updateMinAndMax(t,a,n,r)}return o()(e,[{key:"addPoint",value:function(e,t,a){this._updateMinAndMax(this.points[this.points.length-1],e,t,a),this.points.push(e)}},{key:"_updateMinAndMax",value:function(e,t,a,n){var i=e.y,r=t.y;i>=a&&i<=n&&(this.xPtMin=Math.min(e.x,this.xPtMin),this.xPtMax=Math.max(e.x,this.xPtMax)),r>=a&&r<=n&&(this.xPtMin=Math.min(t.x,this.xPtMin),this.xPtMax=Math.max(t.x,this.xPtMax));var o=Ze(e,t,a),s=o.rs,c=o.xInter;s&&(this.xPtMin=Math.min(c,this.xPtMin),this.xPtMax=Math.max(c,this.xPtMax),this.throughTop=!0);var l=Ze(e,t,n),u=l.rs,h=l.xInter;u&&(this.xPtMin=Math.min(h,this.xPtMin),this.xPtMax=Math.max(h,this.xPtMax),this.throughBottom=!0)}}]),e}();function Xe(e,t,a,n,i){for(var r=[],o=Ye(i,{left:a.left,right:a.right,top:0,bottom:0}),s=0;s<e.length;s++){var c=e[s],l=void 0,u=void 0,h=void 0;if(o.left>c.left&&(o.left<c.right?l={left:c.left,right:o.left,isRightSplit:!0,isLeftSplit:c.isLeftSplit,card:n}:h=c),o.right<c.right&&(o.right>c.left?u={left:o.right,right:c.right,isLeftSplit:!0,isRightSplit:c.isRightSplit,card:n}:h=c),h)r.push(c);else if(l||u)switch(n.wrap_side){case 1:l&&r.push(l);break;case 2:u&&r.push(u);break;case 3:u?l&&l.right-l.left>=u.right-u.left?r.push(l):r.push(u):r.push(l);break;default:l&&r.push(l),u&&r.push(u)}}return r}function Ye(e,t){var a=e.transformPoint(t.left,t.top),n=e.transformPoint(t.right,t.bottom);return I.a.initByRawRect({left:a.x,top:a.y,right:n.x,bottom:n.y})}function Ke(e,t){for(var a=new ze.Matrix2D,n=e.parent;n!==t;)a.translate(n.rect.left,n.rect.top),n=n.parent;return a}function Je(e,t,a,n,i){var r=Number.MAX_SAFE_INTEGER,o=-Number.MAX_SAFE_INTEGER,s=a.getWrapPoints();if(s)for(var c=t.top,l=t.bottom,u=0,h=s.length-1;u<h;++u){var d=s[u],p=s[u+1];d.y>=c&&d.y<l&&(r=Math.min(r,d.x),o=Math.max(o,d.x));var g=Ze(d,p,c);g.rs&&(r=Math.min(r,g.xInter),o=Math.max(o,g.xInter));var f=Ze(d,p,l);f.rs&&(r=Math.min(r,f.xInter),o=Math.max(o,f.xInter)),(d.y===c&&p.y===c||d.y===l&&p.y===l)&&(r=Math.min(r,Math.min(d.x,p.x)),o=Math.max(o,Math.max(d.x,p.x)))}if(o===Number.MAX_SAFE_INTEGER)return e;var v=a.anchor.data.private,m=v.distanceLeft,y=v.distanceRight,k=Xe(e,0,{left:r-Object(T.Ti2Px)(m),right:o+Object(T.Ti2Px)(y)},a,n);return i.offset=1,k}function Qe(e,t,a,n,i){var r=[],o=a.anchor.data.private,s=o.distanceLeft,c=o.distanceRight,l=a.getWrapPoints();if(i.offset=1,l&&(function(e,t,a){for(var n=t.top,i=t.bottom,r=void 0,o=0,s=e.length-1;o<s;++o){var c=e[o],l=e[o+1],u=c.y,h=l.y;u<n&&h<n||u>=i&&h>=i?r=null:(r?r.addPoint(l,n,i):(r=new qe(c,l,n,i),a.push(r)),(l.y<n||l.y>=i)&&(r=null))}if(r&&a.length>1){var d=a[0];if(d.points[0]===r.points[r.points.length-1]){var p=d.points[0].y;p>=n&&p<i&&(a.splice(0,1),r.points=r.points.concat(d.points),r.xPtMin=Math.min(r.xPtMin,d.xPtMin),r.xPtMax=Math.max(r.xPtMax,d.xPtMax),r.throughTop=r.throughTop||d.throughTop,r.throughBottom=r.throughBottom||d.throughBottom)}}a.sort((function(e,t){return e.xPtMin-t.xPtMin}))}(l,t,r),r.length)){for(var u=e;u.length&&r.length;){var h=r.shift();if(h.throughTop&&h.throughBottom){for(var d=h.xPtMin,p=h.xPtMax;r.length&&(h=r.shift(),p=Math.max(h.xPtMax,p),!h.throughTop||!h.throughBottom););u=Xe(u,0,{left:d-Object(T.Ti2Px)(s),right:p+Object(T.Ti2Px)(c)},a,n)}else u=Xe(u,0,{left:h.xPtMin-Object(T.Ti2Px)(s),right:h.xPtMax+Object(T.Ti2Px)(c)},a,n)}return u}return e}function $e(e,t,a,n,i){var r=a.boundaryRect;return i.minCardBottom=Math.min(r.bottom,i.minCardBottom),i.offset=i.minCardBottom-t.top+Object(T.Ti2Px)(1),Xe(e,0,r,a,n)}function et(e,t,a,n,i){var r=a.boundaryRect;return i.minCardBottom=Math.min(r.bottom,i.minCardBottom),i.offset=i.minCardBottom-t.top+Object(T.Ti2Px)(1),[]}var tt=function(){function e(t,a){i()(this,e),this.view=t,this.hostAgent=a,this.initWrapTools()}return o()(e,[{key:"initWrapTools",value:function(){this.wrapTools={}}},{key:"freeLine",value:function(e){}},{key:"makeLine",value:function(e,t){return new R.a({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem},{compose:e.compose})}},{key:"killLine",value:function(e){e.zones.forEach((function(e){e.clear()}));var t=this.view;e.sublines&&e.sublines.forEach((function(e){t.detachTextLine(e)})),t.detachTextLine(e)}},{key:"mateByLine",value:function(e){return e.layoutType===_.DOCLayoutType.TextLine}},{key:"mateOf",value:function(e,t){return!0}},{key:"makeLineStatus",value:function(e,t){var a={};return a.pack=e,a.usableWidth=this.hostAgent.getUsableWidthOfPack(e),a.pageUpdater=this.hostAgent.pageUpdater,a.lineUpdater=t.packUpdater.lineUpdater,a.forceRenderChar=!0,a.embedPolicy=this.hostAgent.packToolkit.embedPolicy,a.packStatus=t,a.dataStatus=t.dataStatus,a.paraSpacingScale=1,a.lineSpacingScale=1,a}},{key:"updateLine",value:function(e,t){var a=t.updatingLine,n=t.updatingLineStatus=this.makeLineStatus(e,t);n.zoneBrokenInfo=t.zoneBrokenInfo,a.range=new O.a(t.dataStatus.pos,0,a),this.onTextLineBegin(e,t,a,n),this.update(e,t,a,n),this.onTextLineEnd(e,t,a,n)}},{key:"compatInPack",value:function(e,t){var a=t.hostStatus.host,n=e.pendingLines[0];return!a.conflicting&&t.updatingLineTop===n.rect.top-n.border.before_width-n.before_space}},{key:"usablePendingLine",value:function(e,t){var a=e.pendingLines;return!(!a||0===a.length)&&(t.settledPos===a[0].range.pos&&this.mateByLine(a[0]))}},{key:"reuseUpdatingLine",value:function(e,t){var a=e.lines[e.lines.length-1];if(a.hasBrokenZone)return!1;if(!a.sublines){var n=this.hostAgent.packToolkit.embedPolicy,i=n.getReuseShapes(e,t,a.range);return!i.some((function(e){return!e.isWrapText||e.isAutoSize||e.renderInfo&&e.renderInfo.needRerender}))&&(t.updatingLineStatus=this.makeLineStatus(e,t),i.forEach((function(e){n.reuse(a,t.updatingLineStatus,e),n.add(a,t.updatingLineStatus,e)})),a.isUpdateRequired=!0,a.reuseInfo={},a.reuseInfo.oldTop=a.rect.top,a.reset(),!0)}return!1}},{key:"adjustUpdatingLine",value:function(e,t){var a=this,n=t.updatingLine;n.originTop=t.updatingLineTop,n.rect.offset(0,-n.rect.top);for(var i=t.updatingLineTop,r=Ke(n,e.parent),o=t.hostStatus.host,s=function(){var s=function(){var i=void 0;do{i=a.splitLineOrMoveDown(t,n,e,o,r)}while(i&&0===i.splitRects.length);return i}();if(!s)return t.updatingLineTop=i+n.rect.top,{v:!0};a.view.detachTextLine(n),t.dataStatus.rollback(n.range.begin),a.view.mathCache&&a.view.mathCache.drop(n.range.pos,n.range.len),a.onTextLineBegin(e,t,n,t.updatingLineStatus);var c=n.isPackBroken;n.isPackBroken=!1;var l=function(n,i,r){var o=[],s=t.dataStatus.papx.prop.getPropVal("bidi"),c=t.updatingLineStatus;s&&i.reverse();var l=i.filter((function(e){var t=e.card,a=Object(T.Ti2Px)(E.e.MIN_SUBLINE_WIDTH);return t.isSnippetCard?a=t.isWrapTable?Object(T.Ti2Px)(E.e.MIN_WRAPTABLE_SUBLINE_WIDTH):Object(T.Ti2Px)(E.e.MIN_TEXTFRAMEWRAPED_SUBLINE_WIDTH):t.wrap_mode==Ge.e&&(a=Object(T.Ti2Px)(E.e.MIN_TIGHT_SUBLINE_WIDTH)),e.right-e.left>=a}));if(!l.length)return o;var u=!0,h=l[0].card.wrap_mode==Ge.e;return u=a.__doForceRenderCharRule(t.dataStatus,l,u,h),l.some((function(i){var r=a.makeSubLine(e,n,t,i,s,u);return r.range.len&&o.push({subline:r,lineStatus:t.updatingLineStatus}),r.range.end>=n.range.end})),t.updatingLineStatus=c,o}(n,s.splitRects);if(0===l.length)return function(e,t){var a=Ye(r,e.rect);a.offset(0,i);var n=Number.MAX_SAFE_INTEGER;t.forEach((function(e){n=e.wrap_mode!==Ge.e&&e.wrap_mode!==Ge.d?Math.min(n,e.boundaryRect.bottom):Math.min(a.top+1,n)})),console.assert(n>=a.top,"此处有问题，需排查原因."),e.rect.offset(0,n-a.top+Object(T.Ti2Px)(1))}(n,s.cards),t.dataStatus.locate(n.range.end),n.isPackBroken=c,"continue";t.updatingLineTop=i+n.rect.top,n.range.reset(n.range.begin,l[l.length-1].subline.range.end),a.onTextLineEnd(e,t,n,t.updatingLineStatus),n.sublines=[],t.updatingLineStatus.subLineStatus=[];var u=0,h=0;return l.forEach((function(e){var a=e.subline,i=e.lineStatus;n.sublines.push(a),t.updatingLineStatus.subLineStatus.push(i),u=Math.max(a.rect.height,u),h=Math.max(a.baseline,h),n.isPackBroken|=a.isPackBroken})),n.sublines.forEach((function(e){e.baseline=h,e.rect.bottom=e.rect.top+u,e.border=Object.assign({},n.border),e.isLeftSplit&&(e.border.left_width=0),e.isRightSplit&&(e.border.right_width=0)})),n.rect.bottom=n.rect.top+u,n.baseline=h,n.zones=[],n.renderInfo&&(n.renderInfo.expired=!0),{v:!0}};;){var c=s();switch(c){case"continue":continue;default:if("object"===(void 0===c?"undefined":L()(c)))return c.v}}}},{key:"onUpdatingLineRejected",value:function(e,t){return De.onUpdatingLineRejected(e,t),B.c.Pass}},{key:"isPackBroken",value:function(e,t){return!(!t.lastLine||!t.lastLine.isPackBroken)}},{key:"commitUpdatingLine",value:function(e,t){var a=this;this.view.attachTextLine(t.updatingLine),t.updatingLine.sublines&&t.updatingLine.sublines.forEach((function(e){e.rect.offset(0,t.updatingLine.rect.top),a.view.attachTextLine(e)})),this.hostAgent.onCommitTextLine(e,t,t.updatingLine)}},{key:"onPackDone",value:function(e,t){return De.onPackDone(t),B.c.Pass}},{key:"onLineDone",value:function(e,t){var a=e.lines[e.lines.length-1],n=t.updatingLineStatus.maxScanPos+1,i=a.range.end;n-i>1?(a.lookahead=b.makeLookaheadOfBreakingLine(n,t.hostStatus.host,a),t.viewUpdater.lookaheads.attachNode(a.lookahead)):n-i==1&&(a.implicitLookahead=!0)}},{key:"update",value:function(e,t,a,n){var i=t.dataStatus,r=t.hostStatus;Ae.initLine(a,n,r,i),Ae.processLine(a,n),Ae.endLine(a,n)}},{key:"onTextLineBegin",value:function(e,t,a,n){De.onLineBegin(e,t,a,n),We.onLineBegin(e,t,a,n)}},{key:"onTextLineEnd",value:function(e,t,a,n){De.onLineEnd(e,t,a,n),We.onLineEnd(e,t,a,n)}},{key:"acceptUpdatingLine",value:function(e,t){return t.updatingLine.range.len>0}},{key:"splitLineOrMoveDown",value:function(e,t,a,n,i){var r=this,o=e.updatingLineTop+t.rect.top,s=o+t.border.before_width+t.border.after_width+t.before_space+t.after_space+t.rect.height,c=Ye(i,{left:0,right:this.hostAgent.getUsableWidthOfPack(t.parent),top:o,bottom:s}),l=e.dataStatus.papx.prop.getPropVal("snap_to_grid"),u=this.collectWrapCards(a,n,c,l);if(!u.length)return null;var h=Ye(i,{left:0,right:a.rect.width,top:o,bottom:s}),d=[{left:0,right:h.right-h.left}],p={minCardBottom:Number.MAX_SAFE_INTEGER,offset:1};return u.some((function(a){var n=r.wrapTools[a.wrap_mode];if(n){var o=r.__checkLineBreakCode(e,t.parent);if(0===(d=o?et(0,h,a,i.clone().invert(),p):n(d,h,a,i.clone().invert(),p)).length)return t.rect.offset(0,p.offset),!0}})),1!==d.length||d[0].card?{splitRects:d,cards:u}:null}},{key:"collectWrapCards",value:function(e,t,a){return[]}},{key:"makeSubLineStatus",value:function(e,t,a,n){var i=this.makeLineStatus(e,t);return i.line=a,i.forceRenderChar=n,i}},{key:"makeSubLine",value:function(e,t,a,n,i,r){var o=new D.a({parent:t,viewPage:t.viewPage,coorSystem:t.coorSystem},{compose:t.compose});o.rect=I.a.initByRawRect({left:n.left,right:n.right,top:0,bottom:0}),o.range=new O.a(a.dataStatus.pos,0,o),o.isRightSplit=n.isRightSplit,o.isLeftSplit=n.isLeftSplit;var s=a.updatingLineStatus=this.makeSubLineStatus(e,a,t,r);return this.update(e,a,o,s),o}},{key:"__doForceRenderCharRule",value:function(e,t,a,n){var i=a;if(a&&t.length>1)if(this.__isParaLastGlyph(e)){var r=e.glyphIterator;W.k!=r.charCode&&W.i!=r.charCode||(i=!1)}else i=!1;else n&&(i=!1);return i}},{key:"__isParaLastGlyph",value:function(e){var t=e.papx.pos+e.papx.len;return e.pos>=t-2}},{key:"__checkLineBreakCode",value:function(e,t){if(t.lines.length<=1)return!1;var a=t.lines[t.lines.length-2];if(e.dataStatus.glyphpool.glyphBuff.getCharCode(a.range.end-1)===W.j){var n=e.dataStatus.final.getChpx(a.range.end-1);if(n.prop&&3==n.prop.getPropVal("line_break_code"))return!0}return!1}}]),e}(),at=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,[{key:"init",value:function(e,t){this.hostUpdater=e,this.view=t,this.packToolkit=this.makePackToolkit()}},{key:"mateOf",value:function(e){return!0}},{key:"dropRollbacks",value:function(e,t,a){var n=0,i=e.host;if(t&&(n=t.hostStatus.lookaheadPosOfLayers),i.rollbacks){var r=[],o=[],s=[],c=0,l=this.viewUpdater.lookaheads;i.rollbacks.forEach((function(e){(c=e.end)<=n?r.push(e):c>a?s.push(e):o.push(e)})),i.conflicting&&(o=o.concat(s),s.length=0),o.length&&(o.forEach((function(e){l.detachNode(e)})),s.forEach((function(e){l.detachNode(e)})),i.conflicting=!0,i.rollbacks=r)}}},{key:"dropWithLine",value:function(e,t){var a=this.viewUpdater.lookaheads,n=this.packToolkit,i=n.embedPolicy,r=n.layersPolicy;e.lookahead&&a.detachNode(e.lookahead),i.dropWithLine(e,t),r.dropWithLine(e,t)}},{key:"onEnterPack",value:function(e,t){var a=this.packToolkit,n=a.lanePolicy,i=a.layersPolicy,r=a.embedPolicy,o=a.packUpdater,s=this.calcBodyRange(e,t),c=s.pos,l=null,u=n.getPrevPack(e);e.bodyRange=s;var h=null;u&&(u.packRange?(h=u.brokenInfo,c=u.packRange.end,l=u.lastLine):(l=u.lines[u.lines.length-1],h=u.calcBrokenInfo(),c=o.settledPos(u,s,h))),e.lines.length>0&&(c=(l=e.lines[e.lines.length-1]).range.end),Object.assign(t,{viewUpdater:this.viewUpdater,pageUpdater:this.pageUpdater,hostUpdater:this.hostUpdater,bodyRange:s,settledPos:c,lastLine:l,prevPack:u,prevBrokenInfo:h}),n.markPendingPacksInHost(e,t),i.reset(e),r.reset(e),i.layers&&i.markPendingCards(e,t,t.settledPos),r.layers&&r.markPendingCards(e,t,t.settledPos)}},{key:"onLeavePack",value:function(e,t){}},{key:"compatInPack",value:function(e,t){return!t.hostStatus.layersPolicy.needCommit(e,t)}},{key:"isPageBroken",value:function(e,t){return t.hostStatus.forcedBreakingPos===t.lastLine.range.end}},{key:"acceptUpdatingLine",value:function(e,t){var a=this.packToolkit.lanePolicy,n=!1,i=t.forceAccept=a.forcedToAcceptUpdatingLine(e,t);if(a.acceptUpdatingLine(e,t)){var r=t.getUpdatingLinePolicy();0===t.hostStatus.forcedBreakingPos&&console.error("what's wrong!"),n=!(t.hostStatus.forcedBreakingPos&&t.updatingLine.range.end>t.hostStatus.forcedBreakingPos)&&(!r.adjustUpdatingLine(e,t)||a.acceptUpdatingLine(e,t))}return n?(t.hostStatus.forcedBreakingPos&&t.updatingLine.range.end>t.hostStatus.forcedBreakingPos&&(console.error("typo error: adjust line range maybe > raw line range!"),n=!1),n):(i&&(t.updatingLine.originTop=void 0),i)}},{key:"revertCommitedLine",value:function(e,t){var a=t.hostStatus,n=this.packToolkit,i=n.lanePolicy,r=n.layersPolicy;i.isFinalPackInHost(e)&&(a.lookaheadPosOfLayers=t.settledPos);var o=r.revert(e,t,t.settledPos);return o&&o.wraps.length?(this.pendingByIntersectInfo(o),a.forcedBreakingPos=t.settledPos,B.c.Rollback):B.c.Pass}},{key:"onLineDone",value:function(e,t){t.hostStatus.lookaheadPosOfLayers=Math.max(t.hostStatus.lookaheadPosOfLayers,t.lastLine.range.end)}},{key:"onCommitTextLine",value:function(e,t,a){var n=this.packToolkit,i=n.layersPolicy;n.embedPolicy.commit(e,t),i.createAndAdd(e,t,a)}},{key:"onCommitTableLine",value:function(e,t,a){this.packToolkit.layersPolicy.createAndAdd(e,t,a)}},{key:"onCommitSnippetLine",value:function(e,t,a){this.packToolkit.layersPolicy.addSnippet(e,t,a)}},{key:"onParaDone",value:function(e,t){var a=this.packToolkit.layersPolicy.commit(e,t);if(a&&a.packs.length){var n=a.packs[0].range.begin;if(n<t.settledPos){this.pendingByIntersectInfo(a);var i=t.hostStatus.host;t.hostStatus.lastRollbackPos=n,n=Math.min(n,a.wraps[0].pos);var r=b.makeLookaheadOfRollback(t.settledPos,i,n);return i.rollbacks||(i.rollbacks=[]),i.rollbacks.push(r),this.viewUpdater.lookaheads.attachNode(r),B.c.Rollback}}return B.c.Pass}},{key:"onUpdatingLineReused",value:function(e,t){}},{key:"onRestoring",value:function(e,t){var a=this.packToolkit,n=a.layersPolicy,i=a.embedPolicy;n.restorePendingCards(e,t,t.settledPos),i.restorePendingCards(e,t,t.settledPos)}},{key:"onPackBroken",value:function(e,t){var a=t.hostStatus,n=this.packToolkit,i=n.lanePolicy,r=n.layersPolicy;i.isFinalPackInHost(e)&&(a.lookaheadPosOfLayers=t.settledPos);var o=r.revert(e,t,t.settledPos);if(o&&o.wraps.length){this.pendingByIntersectInfo(o);var s=o.wraps[o.wraps.length-1];return a.forcedBreakingPos=s.pos,!s.layoutInCell&&s.layouter&&(a.forcedBreakingPos=s.layouter.range.begin),B.c.Rollback}return B.c.Pass}},{key:"onPackDone",value:function(e,t){var a=this.packToolkit,n=a.lanePolicy,i=a.layersPolicy,r=a.embedPolicy;n.isFinalPackInHost(e)&&(i.dropPendingCardsInHost(e,t,t.settledPos),r.dropPendingCardsInHost(e,t,t.settledPos),n.dropPendingPacksInHost(e,t))}},{key:"pushNextHost",value:function(e,t){var a=this.packToolkit.lanePolicy.getNextPack(e);a&&!this.compatWithNextPack(e,a)&&this.hostUpdater.pendingAt(a,0)}},{key:"pushNextPack",value:function(e,t){var a=this.packToolkit.lanePolicy.getNextPack(e),n=e.host;!a||!n.conflicting&&this.compatWithNextPack(e,a)||this.hostUpdater.pendingAt(a,0)}},{key:"compatWithNextPack",value:function(e,t){if(t&&t.lines&&t.lines.length){var a=e&&e.lines[e.lines.length-1],n=t.lines[0];return this.packToolkit.packUpdater.settledPos(e)==t.lines[0].range.begin&&a&&!a.isBrokenAfter&&!n.isBrokenBefore}return!1}},{key:"isDataDone",value:function(e,t){return t.dataStatus.pos===t.bodyRange.pos+t.bodyRange.len}},{key:"intersectByRange",value:function(e,t){var a=this,n=this.packToolkit.lanePolicy.getPacksInHost(e),i={host:e,packs:[],wraps:[]};return n.forEach((function(e){a.intersectPackByRange(e,t,i)})),i}},{key:"intersectPackByRange",value:function(e,t,a){if(e.lines){var n=0,i=e.lines.findIndex((function(e){return g.IT.strictIntersectTest(e.range,t)}));-1!=i&&(-1==(n=e.lines.slice(i).findIndex((function(e){return!g.IT.strictIntersectTest(e.range,t)})))&&(n=e.lines.length-i),a.packs.push({pack:e,lineRange:{begin:i,end:i+n},range:{begin:e.lines[i].range.begin,end:e.lines[i+n-1].range.end}}))}}},{key:"pendingByIntersectInfo",value:function(e){var t=this,a=e.host;e.packs.forEach((function(e){t.hostUpdater.pendingAt(e.pack,e.lineRange.begin)})),a.conflicting=!0}},{key:"getUsableHeightOfPack",value:function(e){return e.rect.height}},{key:"getUsableWidthOfPack",value:function(e){return e.rect.width}},{key:"getUsableTopOfPack",value:function(e){return this.getUsableHeightOfPack(e)}},{key:"getUsableHeightOfHost",value:function(e){return this.getUsableHeightOfPack(e)}},{key:"getFieldZonePolicies",value:function(){if(!this.fieldZonePolicies){var e=this.pageUpdater.primeHostAgent();this.fieldZonePolicies=e.getFieldZonePolicies()}return this.fieldZonePolicies||[]}},{key:"getFootnoteEndnotePolicies",value:function(){if(!this.footnoteEndnotePolicies){var e=this.pageUpdater.primeHostAgent();this.footnoteEndnotePolicies=e.getFootnoteEndnotePolicies()}return this.footnoteEndnotePolicies||[]}},{key:"markSceneExpired",value:function(e,t){var a=t.getHostLevelByScenePath(e),n=void 0;for(--a;a>=0;--a)(n=t.getHostUpdaterAt(a).selectScopeInfo(e)).pack.renderInfo.expired=!0,n.host.renderInfo.expired=!0;return n&&n.host.outer}},{key:"markExpired",value:function(e){var t=e.getScenePath(),a=this.hostUpdater.sceneUpdater,n=this.hostUpdater.selectScopeInfo(t),i=void 0;for(e.renderInfo.expired=!0,n.host&&n.host.renderInfo&&(n.host.renderInfo.expired=!0);i=this.markSceneExpired(t,a);)t=i.getScenePath(),a=a.selectOuterUpdater(i).sceneUpdater}},{key:"document",get:function(){return this.view.data.doc}},{key:"pageUpdater",get:function(){return this.hostUpdater.pageUpdater}},{key:"viewUpdater",get:function(){return this.pageUpdater.viewUpdater}}]),e}(),nt={};function it(e,t,a,n){e.forEach((function(e){e[t]&&e[t](a,n)}))}function rt(e,t,a,n){var i=B.e;return e.some((function(e){return!!e[t]&&(i=e[t](a,n))!=B.e})),i}function ot(e,t,a,n){var i=!1;return e.some((function(e){if(e[t])return i=e[t](a,n)})),i}function st(e,t,a,n){var i=!1;return e.some((function(e){if(e[t]&&!(i=e[t](a,n)))return!0})),i}var ct=a(7202),lt=a(3331),ut=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ee()(t,e),o()(t,[{key:"mateOf",value:function(e,t){return!0}},{key:"makeZone",value:function(e){return new ct.a({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"updateZone",value:function(e,t){var a=t.updatingZone;return Ae.processZone(e,t,a)}}]),t}(lt.a),ht=["actionInit","actionCheckpoint","actionExpectNextZone","actionLineBroken","actionLineEnd","actionDataEnd"],dt=function(){function e(t){i()(this,e),this.packUpdater=t}return o()(e,[{key:"updateLine",value:function(e,t){this.bindLineStatusMethod(t);for(var a=B.b.Init;a!==B.b.Term;)a=this[ht[a]](e,t)}},{key:"bindLineStatusMethod",value:function(e){return e.getUpdatingZonePolicy=function(){return e.curPolicy},e.setUpdatingZonePolicy=function(t){e.curPolicy=t},e}},{key:"actionInit",value:function(e,t){var a=this.selectZonePolicy(e,t);return t.setUpdatingZonePolicy(a),a.onLineBegin&&a.onLineBegin(e,t),B.b.Checkpoint}},{key:"actionCheckpoint",value:function(e,t){if(this.isDataEnd(e,t)&&!t.hasNextZone)return B.b.DataEnd;if(e.isLineBroken)return B.b.LineBroken;if(!t.getUpdatingZonePolicy()){var a=t.nextZonePolicy||this.selectZonePolicy(e,t);t.setUpdatingZonePolicy(a),t.nextZonePolicy=null}return B.b.ExpectNextZone}},{key:"actionExpectNextZone",value:function(e,t){var a=t.getUpdatingZonePolicy();a.onChpxBegin&&a.onChpxBegin(e,t);var n=this.linkZone(e,t,a.makeZone(e,t));a.initZone(e,t,n);var i=this.onUpdateZoneBegin(e,t,n),r=a.updateZone(e,t);return this.onUpdatedZoneEnd(e,t,n,i),!n||n.typoRange.len<=0?(e.zones.pop(),B.b.LineEnd):r!=B.a.Pass?r:B.b.Checkpoint}},{key:"actionLineBroken",value:function(e,t){return B.b.Term}},{key:"actionLineEnd",value:function(e,t){return B.b.Term}},{key:"actionDataEnd",value:function(e,t){return t.forceEnd&&t.dataStatus.pos===t.forceEnd&&(e.isPackBroken=!0),B.b.Term}},{key:"isDataEnd",value:function(e,t){var a=t.dataStatus;if(t.forceEnd&&a.pos>=t.forceEnd||t.limitEnd&&a.pos>=t.limitEnd)return!0;var n=t.packStatus.bodyRange;return t.dataStatus.pos>=n.pos+n.len||t.dataStatus.isDataEnd}},{key:"selectZonePolicy",value:function(e,t,a){return(a||this.getAllZonePolicies()).find((function(a){return a.mateOf(e,t)}))}},{key:"selectZonePolicyByChpxBegin",value:function(e,t){return this.selectZonePolicy(e,t,this.getChpxZonePolicies())}},{key:"selectZonePolicyBySpecChar",value:function(e,t,a){return a.isField()?this.selectZonePolicy(e,t,this.getFieldZonePolicies()):null}},{key:"selectZonePolicyByFootnoteEndnote",value:function(e,t,a){return a.isFootnote()||a.isEndnote()||a.isFootEndNotePlaceholder()?this.selectZonePolicy(e,t,this.getFootnoteEndnotePolicies()):null}},{key:"selectTextZonePolicy",value:function(e,t){return this.selectZonePolicy(e,t,this.getTextZonePolicies())}},{key:"linkZone",value:function(e,t,a){return e.zones.push(a),t.updatingZone=a,a}},{key:"onUpdateZoneBegin",value:function(e,t,a){return{ccp:t.ccp}}},{key:"onUpdatedZoneEnd",value:function(e,t,a,n){t.setUpdatingZonePolicy(null),t.ccp=n.ccp+a.typoRange.len,a.typoRange.len&&(t.bForceRenderChar=!1)}},{key:"getTextZonePolicies",value:function(){return this.packUpdater.getTextZonePolicies()}},{key:"getChpxZonePolicies",value:function(){return this.packUpdater.getChpxZonePolicies()}},{key:"getFieldZonePolicies",value:function(){return this.packUpdater.getFieldZonePolicies()}},{key:"getFootnoteEndnotePolicies",value:function(){return this.packUpdater.getFootnoteEndnotePolicies()}},{key:"getAllZonePolicies",value:function(){if(!this.zonePolicies){var e=this.getChpxZonePolicies(),t=this.getFieldZonePolicies(),a=this.getFootnoteEndnotePolicies(),n=this.getTextZonePolicies();this.zonePolicies=e.concat(t).concat(a).concat(n)}return this.zonePolicies}}]),e}(),pt=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ee()(t,e),o()(t,[{key:"mateOf",value:function(e,t){return t.dataStatus.chpx.prop.getPropVal("right_to_left_text")}}]),t}(ut),gt=a(3856),ft=a(1591),vt=function(e){function t(e){var a=e.parent,n=e.viewPage,r=e.coorSystem;return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:a,viewPage:n,coorSystem:r}))}return ee()(t,e),o()(t,[{key:"canDoCompress",value:function(){return!1}},{key:"adaptGlyphGroupInfos",value:function(e,t){var a=this;if(Math.abs(this.textWidth-this.fitTextWidth)<=.01)return{totalWidth:e};var n=t.filter((function(e){return e.zone===a})),i=0;n.forEach((function(e){i+=e.widthSum})),1===this.getPartRange().len?this.adaptOnlyOneChar(n):this.adaptMultChars(n);var r=this.fitTextWidth;return{totalWidth:e-i+r}}},{key:"adaptOnlyOneChar",value:function(e){if(1===e.length){var t=e[0],a=this.fitTextWidth;t.widthSum=t.widths[0]=a;for(var n=this.getGlyphBuff(),i=this.getPartRange(),r=void 0,o=i.pos;o<i.pos+i.len&&!r;++o)r=n.getMi(o);r&&(a>=r.realWidth?t.character_scale&&delete t.character_scale:t.character_scale=100*a/r.realWidth)}}},{key:"adaptMultChars",value:function(e){this._makesureMiSpacingRatio();var t=this.textWidth;t>this.fitTextWidth?this.decreaseScale(e):t<this.fitTextWidth&&this.increaseSpacing(e)}},{key:"increaseSpacing",value:function(e){var t=this.getGlyphBuff(),a=this.parent.range.begin,n=0;e.forEach((function(i,r){for(var o=0;o<i.widths.length;++o)if(r<e.length-1||o<i.widths.length-1){var s=a+i.beginOffset+o,c=t.getMi(s);c&&(n+=c.spacingRatio)}}));var i=this.fitTextWidth-this.textWidth;e.forEach((function(r,o){for(var s=0;s<r.widths.length;++s)if(o<e.length-1||s<r.widths.length-1){var c=a+r.beginOffset+s,l=t.getMi(c);if(l){var u=l.spacingRatio*i/n;r.widths[s]+=u,r.widthSum+=u}}}))}},{key:"decreaseScale",value:function(e){var t=this.getGlyphBuff(),a=this.parent.range.begin,n=0;e.forEach((function(e,i){for(var r=0;r<e.widths.length;++r){var o=a+e.beginOffset+r,s=t.getMi(o);s&&(n+=s.realWidth)}}));var i=1-(this.textWidth-this.fitTextWidth)/n;e.forEach((function(e){e.character_scale=100*i;for(var n=0;n<e.widths.length;++n){var r=a+e.beginOffset+n,o=t.getMi(r);if(o){var s=o.realWidth-o.realWidth*i;e.widths[n]-=s,e.widthSum-=s}}}))}},{key:"_makesureMiSpacingRatio",value:function(){for(var e=this.getGlyphBuff(),t=this.getPartRange(),a=t.pos;a<t.pos+t.len;++a){var n=e.getMi(a);n&&void 0===n.spacingRatio&&(n.spacingRatio=1)}}},{key:"type",get:function(){return ft.b.FitText}}]),t}(gt.a),mt=a(4106),yt=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ee()(t,e),o()(t,[{key:"mateOf",value:function(e,t){var a=t.dataStatus.chpx.prop;if(!!!a.getPropVal("fit_text_id"))return!1;if(a.getPropVal("fit_text")<=0)return!1;if(a.getPropVal("character_scale")<=15)return!1;var n=this.fetchFitTextRange(t.dataStatus);return!(n.len<=0||n.visibleLen<=0)}},{key:"makeZone",value:function(e){return new vt({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"updateZone",value:function(e,t){var a=t.textEnd-t.minCharPos,n=t.dataStatus.chpx.prop.getPropVal("fit_text"),i=Object(T.Ti2Px)(n);if(!(a<i&&e.zones.length>1)){var r=t.charPos,o=t.minCharPos,s=e.zones[e.zones.length-1],c=this.initZoneStatus(e,t);return s.fitTextWidth=i,mt.a.processZone(s,c),mt.a.endZone(s,c),t.charPos=r+i,t.minCharPos=o+i,t.maxScanPos=Math.max(t.dataStatus.pos,t.maxScanPos),B.a.Pass}}},{key:"initZoneStatus",value:function(e,t){var a=t.updatingZoneStatus||{};mt.a.initZone(a,e,t),a.charPosEnd=Number.MAX_SAFE_INTEGER;var n=this.fetchFitTextRange(t.dataStatus);return a.limitRange=n,a.limitEnd=n.pos+n.len,a}},{key:"fetchFitTextRange",value:function(e){for(var t=e.chpx.prop.getPropVal("fit_text_id"),a=e.document.getDataLogic("final"),n=e.papx.pos+e.papx.len,i=e.pos,r=e.pos,o=r,s=0;r<n;){e.nextToPos(r);var c=e.glyphIterator.glyphGroup;if(c.isHidden())r=c.pos+c.len;else{var l=e.chpx;if(l.prop.getPropVal("fit_text_id")!==t)break;if(1===c.len&&l.prop.getPropVal("special")){var u=a.getChar(c.pos).charCodeAt(0);if(this.isSeperatorChar(u))break}o=r=c.pos+c.len,s+=c.len}}return e.locate(i),{pos:i,len:o-i,visibleLen:s}}},{key:"isSeperatorChar",value:function(e){return e===W.g||e===W.B||e===W.j||e===W.l||e===W.k||e===W.m||e===W.i||e===W.q||e===W.a||e===W.f}}]),t}(lt.a),kt=a(7203),bt=2,Pt=-1,xt=0,_t=1,Ct=2,wt=3,St=4,Lt=5,Tt=1,It=4,Rt=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ee()(t,e),o()(t,[{key:"mateOf",value:function(e,t){var a=t.dataStatus.chpx.prop.getPropVal("asian_layout");return!!a&&(!(!a.combine&&a.type!==bt)&&this.fetchRange(t.dataStatus).len>0)}},{key:"makeZone",value:function(e){return new kt.a({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"updateZone",value:function(e,t){var a=t.dataStatus,n=a.pos,i=this.fetchRange(a,!0),r=t.updatingZone,o=this.updateBrackets(a,i,r),s=this._backupLineStatus(t),c=Math.max(0,t.textEnd-t.charPos);if(!t.bForceRenderChar&&r.bracketWidth&&c<=o)return B.a.LineEnd;c-=o,t.charPos+=r.bracketWidth,t.minCharPos+=r.bracketWidth;var l=this.getInnerLineUpdater(t),u=this.createInnerLineStatus(t,i,2*c,l),h=this.createInnerLine(e,u);if(Ae.processLine(h,u),Ae.endLine(h,u,u.dataStatus),!t.bForceRenderChar&&!h.range.len)return B.a.LineEnd;var d=this.splitLine(i,h.textWidth/2,u).optimalSplitCcp,p=!1;return d<=0||d>=i.len?(this._updateBracketsForOneLine(r),p=this.typoOneLine(t,e,u,i,c)):p=this.typoTwoLines(t,e,u,i,c,d),p?(this.updateLineStatus(t,u,r),a.pos<i.endPos&&delete r.rightBracket):a.locate(n),this._restoreLineStatus(t,s),p?B.a.Pass:B.a.LineEnd}},{key:"typoOneLine",value:function(e,t,a,n,i){this.resetLineStatus(a,e,n,i);var r=this.createInnerLine(t,a);if(Ae.processLine(r,a),Ae.endLine(r,a,a.dataStatus),r.range.len<=0)return!1;var o=e.updatingZone;return o.typoRange.len=r.range.len,o.firstLine=r,o.splitGlyphGroup(),!0}},{key:"typoTwoLines",value:function(e,t,a,n,i,r){this.resetLineStatus(a,e,{pos:n.pos,len:r},i);var o=this.createInnerLine(t,a);if(Ae.processLine(o,a),Ae.endLine(o,a,a.dataStatus),o.range.len<=0)return!1;this.resetLineStatus(a,e,{pos:e.dataStatus.pos,len:n.len-o.range.len},i);var s=this.createInnerLine(t,a);if(Ae.processLine(s,a),Ae.endLine(s,a,a.dataStatus),s.range.len<=0)return!1;var c=e.updatingZone;return c.typoRange.len=o.range.len+s.range.len,c.firstLine=o,c.secondLine=s,c.splitGlyphGroup(),!0}},{key:"_backupLineStatus",value:function(e){return{bForbidCompress:e.lineCompress.bForbidCompress}}},{key:"_restoreLineStatus",value:function(e,t){e.lineCompress.bForbidCompress=t.bForbidCompress}},{key:"updateLineStatus",value:function(e,t,a){e.charPos+=a.textWidth+a.bracketWidth,e.minCharPos+=a.textWidth+a.bracketWidth,e.bForceRenderChar=!1,e.maxScanPos=t.maxScanPos;var n=a.getPartRange();e.dataStatus.locate(n.pos+n.len)}},{key:"fetchRange",value:function(e){for(var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.final,i=function(e){if(e.prop.getPropVal("o_math")||e.prop.getPropVal("fit_text_id"))return!1;var a=e.prop.getPropVal("asian_layout");if(!a||!a.combine&&a.type!==bt)return!1;var i=n.getChar(e.pos);return!(!i||t.isSeperatorChar(i.charCodeAt(0)))},r=e.pos,o=e.pos,s=e.papx.pos+e.papx.len;o<s;){var c=n.getChpx(o);if(!i(c))break;o=c.pos+c.len}if(a)for(var l=e.papx.pos;r>l;){var u=n.getChpx(r,g.IT.Exclude);if(!i(u))break;r=u.pos}return{beginPos:r,endPos:o,pos:e.pos,len:o-e.pos}}},{key:"isSeperatorChar",value:function(e){return e===W.g||e===W.B||e===W.j||e===W.l||e===W.k||e===W.m||e===W.i||e===W.q||e===W.a||e===W.f}},{key:"getInnerLineUpdater",value:function(e){return this.innerLineUpdater||(this.fakePackUpdater={},this.fakePackUpdater.getTextZonePolicies=function(){return e.lineUpdater.getTextZonePolicies()},this.fakePackUpdater.getFieldZonePolicies=function(){return e.lineUpdater.getFieldZonePolicies()},this.fakePackUpdater.getChpxZonePolicies=function(){return[]},this.fakePackUpdater.getFootnoteEndnotePolicies=function(){return e.lineUpdater.getFootnoteEndnotePolicies()},this.innerLineUpdater=new dt(this.fakePackUpdater)),this.innerLineUpdater}},{key:"createInnerLine",value:function(e,t){var a=new D.b({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem},{compose:e.compose}),n=t.dataStatus.pos;return a.range=new O.a(n,0,a),a.rect=I.a.initByRawRect({top:0,left:0,right:t.usableWidth,bottom:0}),a}},{key:"createInnerLineStatus",value:function(e,t,a,n){var i=Object.assign({},e);return i.lineUpdater=n,i.lineCompress.bForbidCompress=!0,i.forbidSpaceExceed=!0,i.lineSpacing={isHeightOrMargin:!0,bMetricOrPercent:!1,bFixedOrMin:!1,rule:0,val:240},i.gridMode=0,i._canDoCompress=!1,this.resetLineStatus(i,e,t,a),i}},{key:"resetLineStatus",value:function(e,t,a,n){var i=t.dataStatus;i.locate(a.pos),Object.assign(e,{bForceRenderChar:t.bForceRenderChar,ccp:0,charPos:0,curPolicy:null,hiddenLen:0,lastGlyphIter:i.glyphIterator.clone(),lastTabGlyph:null,lastTabPos:0,limitEnd:a.pos+a.len,limitRange:a,maxScanPos:a.pos,minCharPos:0,textStart:0,textEnd:n,thisGlyphIterator:i.glyphIterator,update_begin:i.pos,updatingZone:null,usableWidth:n})}},{key:"splitLine",value:function(e,t,a){var n=[[xt,_t,Ct,wt,St,Pt],[Pt,Pt,Pt,wt,St,Pt],[xt,_t,Ct,wt,St,Lt],[Pt,Pt,Pt,wt,St,Pt],[xt,_t,Ct,wt,St,Lt],[Pt,Pt,Pt,wt,St,Pt]],i=0,r=0,o=a.dataStatus,s=xt,c=0,l=[];for(o.locate(e.pos);o.pos<e.pos+e.len;o.next()){var u=o.glyphIterator;if(u.glyphGroup.isField())s=Lt;else{var h=this.judgeCharState(a,u.charCode);if(n[s][h]===Pt&&o.pos!==e.pos){l.push({ccp:o.pos-e.pos,width:c});var d=this.checkSplit(l,t);if(d)return{optimalSplitCcp:d.ccp,optimalSplitWidth:d.width}}s=h,c+=u.width}}return 0==i&&l.length&&(i=l[l.length-1].ccp,r=l[l.length-1].width),{optimalSplitCcp:i,optimalSplitWidth:r}}},{key:"judgeCharState",value:function(e,t){var a=e.dataStatus;if(a.papx.prop.getPropVal("kinsoku"))if(X.a.isHeadPunc(t)){if(46!==t&&X.a.isTailPunc(t))return St}else if(46!==t&&X.a.isTailPunc(t))return wt;var n=a.papx.prop.getPropVal("word_wrap"),i=a.glyphIterator.glyphGroup.charInfo;return!n&&(i.isAlpha||i.isNum||i.isDigit||i.isArabic)?X.a.isNormalSpace(t)?_t:xt:Lt}},{key:"checkSplit",value:function(e,t){if(e.length&&e[e.length-1].width>=t){var a=void 0,n=void 0;return e.length>1&&e[e.length-1].width-t>t-e[e.length-2].width?(a=e[e.length-2].ccp,n=e[e.length-2].width):(a=e[e.length-1].ccp,n=e[e.length-1].width),{ccp:a,width:n}}return!1}},{key:"updateBrackets",value:function(e,t,a){var n=e.pos,i=e.chpx.prop.getPropVal("asian_layout");if(i.brackets){n===t.beginPos&&(a.leftBracket=this.getBracket(i.brackets,!0)),a.rightBracket=this.getBracket(i.brackets,!1);var r=a.leftBracket||a.rightBracket;if(r){var o=this.getBracketFontArg(e.document,e.final,t.beginPos),s=this.charMeasure.getCharManorWithMeasure(r,o).width;a.bracketWidth=s,a.bracketFontArg=o}}return a.bracketWidth*((a.leftBracket?1:0)+(a.rightBracket?1:0))}},{key:"_updateBracketsForOneLine",value:function(e){e.bracketWidth&&(e.bracketWidth/=2,e.bracketFontArg.fontSize/=2)}},{key:"getBracket",value:function(e,t){return e>=Tt&&e<=It?"()[]<>{}".charAt(2*(e-1)+(t?0:1)):null}},{key:"getBracketFontArg",value:function(e,t,a){var n=t.getChp(a),i=n.getPropVal("font_name_asia_east");return{fontFamily:e.fonttable.getName(i),fontSize:Object(T.Ti2Px)(n.getPropVal("font_size_normal")),fontStyle:"",fontWeight:""}}},{key:"charMeasure",get:function(){return this._charMeasure||(this._charMeasure=new F.a),this._charMeasure}}]),t}(lt.a),Ot=a(145),Bt=a.n(Ot),Mt=function(e){function t(e){var a=e.parent,n=e.viewPage,r=e.coorSystem;return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:a,viewPage:n,coorSystem:r}))}return ee()(t,e),o()(t,[{key:"getGlyphPool",value:function(){return this.typoRange&&this.typoRange.data||Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getGlyphPool",this).call(this)}},{key:"canDoCompress",value:function(){return!1}},{key:"type",get:function(){return ft.b.Unknow}},{key:"isTextPartZone",get:function(){return!0}}]),t}(gt.a),Et=a(4810),At=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ee()(t,e),o()(t,[{key:"mateOf",value:function(e,t){var a=t.dataStatus.document,n=t.dataStatus.pos,i=this.getField(a,n);return!(!i||!i.isTranslateField())}},{key:"getField",value:function(e,t){return e.fields.getInnerField(t)}},{key:"makeZone",value:function(e){return new Mt({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"initZone",value:function(e,a,n){Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initZone",this).call(this,e,a,n),a.zoneBrokenInfo&&(n.typoRange.pos=a.zoneBrokenInfo.brokenPos,n.brokenBefore=!0,e.hasBrokenZone=!0);var i=a.dataStatus.document,r=a.dataStatus,o=this.getField(i,r.pos),s=o.fieldObj;if(s){s.setTranslateStr(o.getTranslateResult());var c=new Et.a(i,s);n.typoRange.data=c,n.partRangePos=0,n.textPart=s,n.isTranslatedZone=!0}}},{key:"updateZone",value:function(e,t){var a=t.bForceRenderChar,n=e.zones[e.zones.length-1],i=new f.a(t.dataStatus.data,n.typoRange.data),r=t.updatingZoneStatus||{};return t.bForceRenderChar=!1,mt.a.initZone(r,e,t,i),mt.a.processZone(n,r),mt.a.endZone(n,r),t.bForceRenderChar=a,r.zoneExceed?(e.zoneExceed=!0,e.hasBrokenZone=!0,B.a.LineEnd):B.a.Pass}}]),t}(lt.a),Ht=["actionInit","actionCheckpoint","actionExpectLine","actionUpdatingLineAccepted","actionUpdatingLineRejected","actionLineDone","actionRestore","actionPageBroken","actionPackBroken","actionPackDone","actionSectionDone","actionDataDone","actionRollback"],Ut=function(){function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];i()(this,e),this.hostAgent=t,this.linePolicies=a,this.packRules=n,this.initLineUpdater()}return o()(e,[{key:"linkLine",value:function(e,t){return e.lines.push(t),t}},{key:"dropLines",value:function(e,t,a){var n=this,i=a.from,r=a.to,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x.All,s=e.lines;if("number"!=typeof r&&(r=s.length),e.pendingLines?(e.host.conflicting=!0,e.pendingLines=s.splice(r,s.length-r).concat(e.pendingLines)):e.pendingLines=s.splice(r,s.length-r),i!=r){var c=s.slice(i,r),l=this.hostAgent;c.length&&l.dropRollbacks(e,t,c[c.length-1].range.end);var u=void 0;e.renderInfo&&(u=e.renderInfo.removed?e.renderInfo.removed:e.renderInfo.removed=[]),c.forEach((function(t){y("[typo]    drop line at "+t.range.end+" with what:",o);var a=l.packToolkit,i=a.embedPolicy,r=a.layersPolicy;i&&i.reset(e),r&&r.reset(e),l.dropWithLine(t,t.obsoleted||o),u&&t.renderInfo&&(u.push(t.renderInfo),delete t.renderInfo),n.selectLinePolicyByLine(t).killLine(t)})),s.splice(i,r-i).forEach((function(e){n.selectLinePolicyByLine(e).freeLine(e)}))}}},{key:"dropPendingLines",value:function(e,t,a){var n=this,i=a.from,r=a.to,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x.All,s=e.pendingLines;if(s){"number"!=typeof r&&(r=s.length),0!=i&&(e.host.conflicting=!0);var c=s.slice(i,r),l=this.hostAgent;c.length&&l.dropRollbacks(e,t,c[c.length-1].range.end);var u=void 0;e.renderInfo&&(u=e.renderInfo.removed?e.renderInfo.removed:e.renderInfo.removed=[]),c.forEach((function(e){y("[typo]    drop pending line at "+e.range.end+" with what:",o),l.dropWithLine(e,e.obsoleted||o),u&&e.renderInfo&&(u.push(e.renderInfo),delete e.renderInfo),n.selectLinePolicyByLine(e).killLine(e)})),s.splice(i,r-i).forEach((function(e){n.selectLinePolicyByLine(e).freeLine(e)}))}}},{key:"killPack",value:function(e){y("[typo] kill pack"),e.view.detachPack&&e.view.detachPack(e),delete e.packRange,delete e.renderInfo,e.lookahead&&e.view.updater.lookaheads.detachNode(e.lookahead),e.lookahead=void 0,this.dropLines(e,null,{from:0,to:e.lines.length}),this.dropPendingLines(e,null,{from:0})}},{key:"dropUpdatingLine",value:function(e,t){t.updatingLine&&(this.dropLines(e,t,{from:e.lines.length-1},x.None),t.updatingLine=void 0)}},{key:"selectLinePolicy",value:function(e,t){return this.linePolicies.find((function(a){return a.mateOf(e,t)}))}},{key:"selectLinePolicyByLine",value:function(e){return this.linePolicies.find((function(t){return t.mateByLine(e)}))}},{key:"updatePack",value:function(e,t){if(e){var a=this.bindPackStatusMethod(this.makePackStatus(t)),n=B.d.Init;for(this.enterPack(e,a);B.d.Term!=n;)n=this[Ht[n]](e,a);this.leavePack(e,a)}}},{key:"makePackStatus",value:function(e){return{hostStatus:e,dataStatus:e.dataStatus,curPolicies:[this.hostAgent,nt].concat(this.packRules),packUpdater:this}}},{key:"bindPackStatusMethod",value:function(e){return e.getUpdatingLinePolicy=function(){return e.curPolicies[1]},e.setUpdatingLinePolicy=function(t){e.curPolicies[1]=t},e}},{key:"enterPack",value:function(e,t){it(t.curPolicies,"onEnterPack",e,t),e.renderInfo&&this.hostAgent.markExpired(e),t.hostStatus.updatingPack=e,t.updatingLineTop=0,e.lines.length>0&&(t.updatingLineTop=t.lastLine.rect.bottom,t.updatingLineTop+=t.lastLine.border.after_width||0,t.updatingLineTop+=t.lastLine.after_space||0),t.dataStatus.locate(t.settledPos),y("[typo] enterPack: settledPos("+t.settledPos+"), lookaheadPosOfLayers("+t.hostStatus.lookaheadPosOfLayers+")")}},{key:"leavePack",value:function(e,t){!function(e,t,a,n){for(var i=e.length-1;i>=0;--i)e[i][t]&&e[i][t](a,n)}(t.curPolicies,"onLeavePack",e,t),y("[typo] leavePack")}},{key:"actionInit",value:function(e,t){if(this.hostAgent.isDataDone(e,t))return this.pushPendingLines(e,t,!0),B.d.DataDone;var a=B.c.Pass;if(t.dataStatus.isPapxBegin&&(a=rt(t.curPolicies,"onParaDone",e,t),B.c.Pass!=a))return a;var n=!0;return t.hostStatus.balanceStatus&&(n=!1),this.pushPendingLines(e,t,n),t.setUpdatingLinePolicy(this.selectLinePolicy(e,t)),B.d.Checkpoint}},{key:"actionCheckpoint",value:function(e,t){if(t.getUpdatingLinePolicy().usablePendingLine(e,t)){if(this.compatInPack(e,t))return B.d.Restore;if(this.reusePendingLine(e,t)){var a=this.acceptUpdatingLine(e,t);return!t.updatingLine.renderInfo||t.updatingLine&&t.updatingLine.__oldTop===t.updatingLine.rect.top||(t.updatingLine.renderInfo.moved=!0),delete t.updatingLine.__oldTop,a}}return B.d.ExpectLine}},{key:"actionExpectLine",value:function(e,t){var a=t.getUpdatingLinePolicy();return t.updatingLine=this.linkLine(e,a.makeLine(e,t)),a.updateLine(e,t),this.acceptUpdatingLine(e,t)}},{key:"actionUpdatingLineAccepted",value:function(e,t){return this.commitUpdatingLine(e,t),this.pushPendingLines(e,t),B.d.LineDone}},{key:"actionLineDone",value:function(e,t){it(t.curPolicies,"onLineDone",e,t),y("[typo]    Line("+t.lastLine.layoutName+") done at "+t.settledPos);var a=B.c.Pass,n=this.isBrokenByLastLine(e,t);if(n!=B.d.Init)return a=rt(t.curPolicies,"onParaDone",e,t),B.c.Pass!=a?a:n;if(t.dataStatus.isPapxBegin){if(a=rt(t.curPolicies,"onParaDone",e,t),B.c.Pass!=a)return a;t.setUpdatingLinePolicy(this.selectLinePolicy(e,t))}return B.d.Checkpoint}},{key:"actionDataDone",value:function(e,t){return t.setUpdatingLinePolicy(nt),y("[typo]    Data done"),B.d.PageBroken}},{key:"actionRestore",value:function(e,t){return t.setUpdatingLinePolicy(nt),it(t.curPolicies,"onRestoring",e,t),this.restorePendingLines(e,t),y("[typo]    Pack restored"),B.d.PackDone}},{key:"actionUpdatingLineRejected",value:function(e,t){y("[typo]    Rejected line("+t.updatingLine.range.begin+", "+t.updatingLine.range.end+")");var a=B.c.Pass;return t.dataStatus.locate(t.updatingLine.range.begin),t.dataStatus.isPapxBegin||(a=rt(t.curPolicies,"onParaDone",e,t),B.c.Pass==a)?(t.lookaheadPosForPack=t.updatingLine.range.end,a=rt(t.curPolicies,"onUpdatingLineRejected",e,t),B.c.Pass!==a?(t.updatingLine&&e.lines[e.lines.length-1]===t.updatingLine&&this.dropUpdatingLine(e,t),a):(this.dropUpdatingLine(e,t),B.d.PackBroken)):(t.updatingLine&&e.lines[e.lines.length-1]===t.updatingLine&&this.dropUpdatingLine(e,t),a)}},{key:"actionPageBroken",value:function(e,t){t.setUpdatingLinePolicy(nt);var a=rt(t.curPolicies,"onPageBroken",e,t);return B.c.Pass!==a?a:B.d.PackBroken}},{key:"actionPackBroken",value:function(e,t){t.setUpdatingLinePolicy(nt);var a=rt(t.curPolicies,"onPackBroken",e,t);return B.c.Pass!==a?a:(e.lookahead&&t.viewUpdater.lookaheads.detachNode(e.lookahead),e.lookahead=void 0,y("[typo]    Pack broken"),B.d.PackDone)}},{key:"actionPackDone",value:function(e,t){return this.forgetPendingLines(e,t),it(t.curPolicies,"onPackDone",e,t),t.lookaheadPosForPack&&e.lines.length>0&&(e.lookahead=b.makeLookaheadOfBreakingPack(t.lookaheadPosForPack,t.hostStatus.host,e),t.viewUpdater.lookaheads.attachNode(e.lookahead)),B.d.Term}},{key:"actionRollback",value:function(e,t){return y("[typo]    Rollback"),B.d.Term}},{key:"compatInPack",value:function(e,t){return!t.hostStatus.host.conflicting&&st(t.curPolicies,"compatInPack",e,t)}},{key:"reusePendingLine",value:function(e,t){t.updatingLine=this.linkLine(e,e.pendingLines.shift()),t.updatingLine&&t.updatingLine.rect&&(t.updatingLine.__oldTop=t.updatingLine.rect.top);var a=st(t.curPolicies,"reuseUpdatingLine",e,t);return a?(this.hostAgent.dropRollbacks(e,t,t.updatingLine.range.end),it(t.curPolicies,"onUpdatingLineReused",e,t),t.dataStatus.locate(t.updatingLine.range.end),y("[typo]    Reuse Line at "+t.updatingLine.range.end),a):(this.dropUpdatingLine(e,t),a)}},{key:"isBrokenByLastLine",value:function(e,t){return ot(t.curPolicies,"isPageBroken",e,t)?B.d.PageBroken:ot(t.curPolicies,"isPackBroken",e,t)?B.d.PackBroken:this.hostAgent.isDataDone(e,t)?B.d.DataDone:B.d.Init}},{key:"acceptUpdatingLine",value:function(e,t){return st(t.curPolicies,"acceptUpdatingLine",e,t)?B.d.UpdatingLineAccepted:B.d.UpdatingLineRejected}},{key:"commitUpdatingLine",value:function(e,t){var a=t.updatingLine,n=a.rect.height,i=a.reuseInfo;a.rect.top=t.updatingLineTop,a.rect.top+=a.border.before_width||0,a.rect.top+=a.before_space||0,a.rect.top=Math.min(this.hostAgent.getUsableTopOfPack(e),a.rect.top),a.rect.bottom=a.rect.top+n,i&&i.oldTop!==a.rect.top&&a.renderInfo&&(a.renderInfo.moved=!0),delete a.reuseInfo,it(t.curPolicies,"commitUpdatingLine",e,t),t.updatingLine=null,t.lastLine=a,t.updatingLineTop=a.rect.bottom,t.updatingLineTop+=a.border.after_width||0,t.updatingLineTop+=a.after_space||0,t.settledPos=a.range.end}},{key:"revertCommitedLine",value:function(e,t,a){var n=e.lines.indexOf(a),i=e.lines.length-1;return t.lookaheadPosForPack=e.lines[i].range.end,this.dropLines(e,t,{from:n,to:i}),t.settledPos=a.range.begin,t.dataStatus.locate(a.range.begin),rt(t.curPolicies,"revertCommitedLine",e,t)}},{key:"pushPendingLines",value:function(e,t,a){var n=t.settledPos,i=e.pendingLines;if(i&&i.length){var r=i.findIndex((function(e){return n<=e.range.begin}));-1===r&&(r=i.length),this.dropPendingLines(e,t,{from:0,to:r},a?x.All:x.None)}}},{key:"forgetPendingLines",value:function(e,t){var a=e.pendingLines;a&&a.length&&this.dropPendingLines(e,t,{from:0,to:a.length},x.None),e.pendingLines=void 0}},{key:"restorePendingLines",value:function(e,t){var a=e.pendingLines,n=a[a.length-1];e.lines=e.lines.concat(a),e.pendingLines=[],t.updatingLineTop=n.rect.bottom,t.updatingLineTop+=n.border.after_width||0,t.updatingLineTop+=n.after_space||0,t.settledPos=n.range.end,t.lastLine=n,t.dataStatus.locate(t.settledPos)}},{key:"initLineUpdater",value:function(){this.lineUpdater=new dt(this)}},{key:"getTextZonePolicies",value:function(){return this.textZonePolicies||(this.textZonePolicies=[new pt,new At,new ut]),this.textZonePolicies||[]}},{key:"getChpxZonePolicies",value:function(){return this.chpxZonePolicies||(this.chpxZonePolicies=[new yt,new Rt]),this.chpxZonePolicies||[]}},{key:"getFieldZonePolicies",value:function(){return this.hostAgent.getFieldZonePolicies()}},{key:"getFootnoteEndnotePolicies",value:function(){return this.hostAgent.getFootnoteEndnotePolicies()}},{key:"settledPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pos:0,len:0},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!a){if(!e)return t.pos;a=e.calcBrokenInfo()}return a.brokenLines?a.brokenLines[0].range.begin:a.lastUnbrokenLine&&!a.lastUnbrokenLine.isRepeatHeaderRow?a.lastUnbrokenLine.range.end:e.lines.length?t.pos:t.pos+t.len}},{key:"isPackFirstLine",value:function(e,t,a){return e.lines[0]===a}}]),e}(),Dt=a(684),Nt=function(){function e(t){i()(this,e)}return o()(e,[{key:"reset",value:function(e){}},{key:"dropWithLine",value:function(e,t){}},{key:"markPendingCards",value:function(e,t,a){}},{key:"restorePendingCards",value:function(e,t,a){}},{key:"dropPendingCardsInHost",value:function(e,t,a){}},{key:"needCommit",value:function(e,t){}},{key:"commit",value:function(){}},{key:"create",value:function(e,t,a){}},{key:"add",value:function(e,t,a){}},{key:"createAndAdd",value:function(e,t,a){}},{key:"revert",value:function(e,t,a){}},{key:"reuse",value:function(e,t,a){return[]}},{key:"getReuseShapes",value:function(e,t,a){return[]}}],[{key:"collectCardsAfterPos",value:function(e,t,a){var n=e.slice().sort((function(e,t){return e.pos-t.pos})),i=n.findIndex((function(e){return e.pos>=t}));i>=0&&n.slice(i).some((function(e){return!!a(e)}))}},{key:"collectCardsBetween",value:function(e,t,a){var n=t.begin,i=t.end,r=e.slice().sort((function(e,t){return e.pos-t.pos})),o=r.findIndex((function(e){return e.pos>=n}));o>=0&&r.slice(o).some((function(e){return e.pos>=i||!!a(e)}))}}]),e}(),Ft=function(){function e(t){i()(this,e),this.hostAgent=t}return o()(e,[{key:"reset",value:function(e){e&&(this.layers=e.host.selectLayersByPack(e))}},{key:"dropCards",value:function(e){var t=this;e.embeds.forEach((function(e){e.updater&&e.updater.killScene(e),t._detachShape(null,{hostStatus:{embedCache:{}}},e)})),e.textboxs.forEach((function(e){e.updater&&e.updater.killScene(e),t._detachShape(null,{hostStatus:{embedCache:{}}},e)})),e.childTextboxs.forEach((function(e){e.updater&&e.updater.killScene(e)}))}},{key:"dropWithLine",value:function(e,t){if(!t.none&&this.layers){var a,n,i,r=0,o=0,s=this.layers,c={begin:e.range.begin,end:e.range.end},l={embeds:[],textboxs:[],childTextboxs:[]};a=s.embedShapes,n=c,i=function(a){if(a.has_textbox){var n=a.outer.parent===e.parent;(t.all||t.textbox)&&n&&l.textboxs.push(a)}else a.isGroup&&(t.all||t.textbox)&&function e(t){t.childShapes.forEach((function(t){t.isGroup?e(t):t.has_textbox&&l.childTextboxs.push(t)}))}(a),(t.all||t.embed)&&l.embeds.push(a)},-1!=(r=a.findIndex((function(e){return e.pos>=n.begin})))&&(-1==(o=a.slice(r).findIndex((function(e){return e.pos>=n.end})))&&(o=a.length-r),a.slice(r,r+o).forEach((function(e){i(e)}))),this.dropCards(l)}}},{key:"markPendingCards",value:function(e,t,a){var n=this;if(this.layers){var i=this.layers,r=i.embedShapes.findIndex((function(e){return e.pos>=a}));r>=0&&i.embedShapes.slice(r).forEach((function(a){n._detachShape(e,t,a)}))}}},{key:"restorePendingCards",value:function(e,t,a){var n=this._getShapeCache(t);for(var i in n){var r=n[i];r.pos>=a&&this._attachShape(e,t,r)}}},{key:"dropPendingCardsInHost",value:function(e,t,a){var n=this._getShapeCache(t);for(var i in n){var r=n[i];r.pos>=a&&(delete n[i],r.updater&&r.updater.killScene(r))}}},{key:"create",value:function(e,t,a){}},{key:"reuse",value:function(e,t,a){return a}},{key:"add",value:function(e,t,a){t.embedShapes||(t.embedShapes=[]),t.embedShapes.push(a)}},{key:"commit",value:function(e,t){var a=this;if(t.updatingLineStatus){var n=t.updatingLineStatus.embedShapes;t.updatingLineStatus.subLineStatus&&(n=[],t.updatingLineStatus.subLineStatus.forEach((function(e){n=n.concat(e.embedShapes)}))),n&&0!==n.length&&(!this.layers&&this._createLayers(e,t),n.forEach((function(n){var i=t.updatingLine;n.outer=i instanceof D.a?i.parent:i,a._attachShape(e,t,n),n.renderInfo&&(n.renderInfo.moved=!0)})))}}},{key:"getReuseShapes",value:function(e,t,a){var n=this._getShapeCache(t),i=[];for(var r in n){var o=n[r];o.pos>=a.begin&&o.pos<a.end&&i.push(o)}return i}},{key:"revert",value:function(e,t,a){}},{key:"_attachShape",value:function(e,t,a){y("[typo]    Attach embed("+a.id+") at page("+a.viewPage.layout_index+")");var n=this._getShapeCache(t);this.layers.commitEmbed(a),delete n[a.id]}},{key:"_detachShape",value:function(e,t,a){y("[typo]    Detach embed("+a.id+" at page("+a.viewPage.layout_index+"))");var n=this._getShapeCache(t);this.layers.removeEmbed(a),n[a.id]=a}},{key:"_getShapeCache",value:function(e){return e.hostStatus.embedCache}},{key:"_createLayers",value:function(e,t){return this.layers||(this.layers=t.hostStatus.host.createLayersByPack(e,this.hostAgent.hostUpdater.updaterFactory)),this.layers}}]),e}(),Wt=function(){function e(t){i()(this,e),this.hostAgent=t,this.shapeInfos=[]}return o()(e,[{key:"reset",value:function(e){this.shapeInfos=[]}},{key:"dropCards",value:function(e){var t=this;e.shapes.forEach((function(e){e.updater&&e.updater.killScene(e),t._detachShape(null,{hostStatus:{shapeCache:{}}},e),t._setHostConflicting(e)})),e.textboxs.forEach((function(e){e.updater&&e.updater.killScene(e),t._detachShape(null,{hostStatus:{shapeCache:{}}},e),t._setHostConflicting(e)})),e.snippets.forEach((function(e){y("[typo]    Drop snippet card("+e.begin+", "+e.end+") at page("+e.viewPage.layout_index+")"),e.updater&&e.updater.killScene(e),t.layers.removeCard(e),t._setHostConflicting(e)})),e.childTextboxs.forEach((function(e){e.updater&&e.updater.killScene(e)}))}},{key:"dropWithLine",value:function(e,t){if(!t.none&&this.layers){var a=0,n=0,i=this.layers,r={begin:e.range.begin,end:e.range.end},o={shapes:[],textboxs:[],snippets:[],childTextboxs:[]},s=function(e,t,i){var r=e.slice().sort((function(e,t){return e.pos-t.pos}));-1!=(a=r.findIndex((function(e){return e.pos>=t.begin})))&&(-1==(n=r.slice(a).findIndex((function(e){return e.pos>=t.end})))&&(n=r.length-a),r.slice(a,a+n).forEach((function(e){i(e)})))},c=function e(t){t.childShapes.forEach((function(t){t.isGroup?e(t):t.has_textbox&&o.childTextboxs.push(t)}))};s(i.topCards,r,(function(e){e.has_textbox?(t.all||t.textbox)&&o.textboxs.push(e):(e.isGroup&&(t.all||t.textbox)&&c(e),(t.all||t.shape)&&o.shapes.push(e))})),s(i.bottomCards,r,(function(e){e.has_textbox?(t.all||t.textbox)&&o.textboxs.push(e):(e.isGroup&&(t.all||t.textbox)&&c(e),(t.all||t.shape)&&o.shapes.push(e))})),s(i.textframes,r,(function(a){(t.all||t.snippet)&&e.card===a&&o.snippets.push(a)})),this.dropCards(o)}}},{key:"markPendingCards",value:function(e,t,a){var n=this;if(this.layers){var i=this.layers;Nt.collectCardsAfterPos(i.topCards,a,(function(a){a.isWrap&&a.pos<t.hostStatus.lookaheadPosOfLayers||n._detachShape(e,t,a)})),Nt.collectCardsAfterPos(i.bottomCards,a,(function(a){n._detachShape(e,t,a)})),Nt.collectCardsAfterPos(i.textframes,a,(function(a){a.isWrap&&a.pos<t.hostStatus.lookaheadPosOfLayers||n._detachShape(e,t,a)}))}}},{key:"restorePendingCards",value:function(e,t,a){var n=this._getShapeCache(t);for(var i in n){var r=n[i];r.pos>=a&&this._attachShape(e,t,r)}}},{key:"dropPendingCardsInHost",value:function(e,t,a){var n=this._getShapeCache(t);for(var i in n){var r=n[i];r.pos>=a&&(delete n[i],r.updater&&r.updater.killScene(r))}}},{key:"makeRelativeInfo",value:function(e,t,a){return{}}},{key:"createAndAdd",value:function(e,t,a){var n=this,i=a.range,r=t.dataStatus.document,o=this.makeRelativeInfo(e,t,a);r.anchors.rangeClass.forEachHintInRange(i.pos,i.pos+i.len,(function(e){var a=e._node;if(a.wrapMode!==Ge.a&&(window.APP.typoMode!==Dt.TYPO_MODE.MODE_MOBILE&&window.APP.typoMode!==Dt.TYPO_MODE.MODE_WEB||!a.shapeData.isInk)){var i=t.dataStatus.makeGlyphAt(a.pos),s=i.glyphGroup.isHidden()||i.glyphGroup.isRevisionHidden();if(i.free(),a.shapeData&&!a.shapeData.hide&&!s){var c=n.create(t,o,a,r);c&&n.add(c,o)}}}),g.IT.strictIntersectTest)}},{key:"create",value:function(e,t,a,n){return null}},{key:"add",value:function(e,t){e.relativeInfo=t,this.shapeInfos.push(e)}},{key:"needCommit",value:function(e,t){return this.shapeInfos.length>0}},{key:"commit",value:function(e,t){}},{key:"revert",value:function(e,t,a){}},{key:"_setHostConflicting",value:function(e){e.isWrap&&(this.layers.parent.host.conflicting=!0)}},{key:"_detachShape",value:function(e,t,a){y("[typo]    Detach shape("+a.pos+") at page("+a.viewPage.layout_index+")");var n=this._getShapeCache(t);this.layers.removeCard(a),n[a.pos]&&console.warn("[typo] Detach shape error!"),n[a.pos]=a}},{key:"_attachShape",value:function(e,t,a){y("[typo]    Atach shape("+a.pos+") at page("+a.viewPage.layout_index+")");var n=this._getShapeCache(t);this.layers.commitCard(a),delete n[a.pos]}},{key:"_getShapeCache",value:function(e){return e.hostStatus.shapeCache}},{key:"_getLayers",value:function(e,t){return t.hostStatus.host.selectLayersByPack(e)}},{key:"_createLayers",value:function(e,t){}}]),e}(),Gt=function(){function e(t){i()(this,e),this.init(t)}return o()(e,[{key:"init",value:function(e){this.hostAgent=e,this.hostUpdater=e.hostUpdater}},{key:"dropPacksInHost",value:function(e){}},{key:"markPendingPacksInHost",value:function(e,t){}},{key:"dropPendingPacksInHost",value:function(e,t){}},{key:"acceptUpdatingLine",value:function(e,t){var a=e.lines.length?e.lines[e.lines.length-1]:null,n=t.updatingLine,i=t.updatingLineTop,r=n.rect.height,o=n.before_space||0,s=n.border&&n.border.before_width||0,c=n.border&&n.border.after_width||0,l=t.hostStatus.host,u=i+r+o+s+c+(l.maxBottomBorder||0)+(l.maxBottomMargin||0);if(n.isControlLine)return a&&(i-=a.after_width||0,i-=a.border.after_width||0),i<this.hostAgent.getUsableHeightOfPack(e);this.canCompressLine(e,t)&&(u=i+(n.adjHeight||r)+o+s+c);return Object(Ie.f)(this.hostAgent.getUsableHeightOfPack(e),u)}},{key:"forcedToAcceptUpdatingLine",value:function(e,t){return e.lines.length<=1||!e.lines.some((function(e){return e.layoutType!==_.DOCLayoutType.TextLine||0!==e.rect.height}))}},{key:"dockNextPackInHost",value:function(e,t){}},{key:"pushNextPack",value:function(e,t){}},{key:"isFirstPackInHost",value:function(e){return!0}},{key:"isFinalPackInHost",value:function(e){return!0}},{key:"getPrevPack",value:function(e){return e.prevPack}},{key:"getNextPack",value:function(e){return e?e.nextPack:null}},{key:"canCompressLine",value:function(e,t){return t.updatingLine.layoutType===_.DOCLayoutType.TextLine}}]),e}(),jt=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLanePolicy",base:Gt,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCLanePolicy_init(e)}},{key:"acceptUpdatingLine",value:function(e,t){return!0}},{key:"dropPacksInHost",value:function(e){var t=this.hostAgent.packToolkit.packUpdater,a=e.page;t.killPack(a)}}]),e}();s.a.mix(jt,Gt);var Vt=a(5740),zt=function(e){function t(e){var a=e.parent,n=e.viewPage,r=e.coorSystem;i()(this,t);var o=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:a,viewPage:n,coorSystem:r}));return o.eqFieldResult=void 0,o.exraWidth=0,o.isEqZone=!0,o}return ee()(t,e),o()(t,[{key:"getGlyphGroupsForCompose",value:function(){var e=this.typoRange.pos+this.parent.range.pos,t=e+this.typoRange.len,a=this.getGlyphPool().getGlyphGroups(e,t).find((function(e){return!(e.isField()||e.isSpecHidden()||e.isSpace())}));return a?[a]:[]}},{key:"isVisible",value:function(e){return 0==(e&Vt.m)&&0==(e&Vt.C)}},{key:"composeProcess",value:function(e,t){var a=this;if(!this.error){var n=this.parent.glyphGroupInfos.find((function(e){return e.zone===a&&e.zone.typoRange.pos==a.typoRange.pos}));if(n){var i=this.label==W.n?this.parent.baseline-this.line.baseline:0,r={x:n.x,y:t.y+i};this.label&&this.label==W.n?(this.line.isUpdateRequired=!0,this.line.composeProcess(e,r)):this.label&&this.switch.calcOrigin(this,e,r)}}}},{key:"getHeightInfo",value:function(){var e,t=0,a=0;if(this.error)t=this.errorInfo.heightInfo.height,a=this.errorInfo.heightInfo.ascent;else if(this.label&&this.label==W.n)t=this.line?this.line.baseHeight:t,a=this.line?this.line.strongAscent:a;else if(this.label){var n=this.switch.calcHeight(this);if(t=n.height,a=n.ascent,0===this.lines.length){var i=this.switchProp.metrics;t=i.height,a=i.ascent}}return e=t-a,this.heightInfo={allWeakChar:0==t,baseHeight:t,maxCharHeight:t,maxAscent:a,maxDescent:e,maxStrongAscent:a,maxStrongDescent:e},this.heightInfo}},{key:"getWidth",value:function(){return this.error?this.errorInfo.width:this.line?this.line.rect.width:this.lineWidth?this.lineWidth:0}},{key:"type",get:function(){return ft.b.EQField}}]),t}(gt.a),Zt=0,qt=1,Xt=2,Yt=3,Kt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e/4,i=[{cmd:"M",args:[a,0]},{cmd:"L",args:[a+n,0]},{cmd:"L",args:[a+n,t]},{cmd:"L",args:[a,t]}];return{cmds:i,lineWidth:n}},Jt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e/4,i=2*n/3,r=[{cmd:"M",args:[a,0]},{cmd:"C",args:[a+n,i,a+n,2*i,a+n,4*i]},{cmd:"L",args:[a+n,t-4*i]},{cmd:"C",args:[a+n,t-2*i,a+n,t-i,a,t]}];return{cmds:r,lineWidth:n}},Qt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e/4,i=[{cmd:"M",args:[a+n/2,0]},{cmd:"L",args:[a+n/2,t]}];return{cmds:i,lineWidth:n}},$t=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e/2.4,i=t/2,r=Math.min(n,i/2),o=a+n/2+n/20,s=[{cmd:"M",args:[a,0]},{cmd:"C",args:[o,0,o,0,o,r]},{cmd:"L",args:[o,Math.max(r,i-n)]},{cmd:"C",args:[o,t/2,o,t/2,a+n,t/2]},{cmd:"C",args:[o,t/2,o,t/2,o,Math.min(i+i/2,i+n)]},{cmd:"L",args:[o,2*i-n]},{cmd:"C",args:[o,t,o,t,a,t]}];return{cmds:s,lineWidth:n}},ea={91:{l:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e/4,i=[{cmd:"M",args:[a+n,0]},{cmd:"L",args:[a,0]},{cmd:"L",args:[a,t]},{cmd:"L",args:[a+n,t]}];return{cmds:i,lineWidth:n}},r:Kt},93:{l:Kt,r:Kt},40:{l:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e/4,i=2*n/3,r=[{cmd:"M",args:[a+n,0]},{cmd:"C",args:[a,i,a,2*i,a,4*i]},{cmd:"L",args:[a,t-4*i]},{cmd:"C",args:[a,t-2*i,a,t-i,a+n,t]}];return{cmds:r,lineWidth:n}},r:Jt},41:{l:Jt,r:Jt},123:{l:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e/2.4,i=t/2,r=Math.min(n,i/2),o=a+n/2-n/20,s=[{cmd:"M",args:[a+n,0]},{cmd:"C",args:[o,0,o,0,o,r]},{cmd:"L",args:[o,Math.max(r,i-n)]},{cmd:"C",args:[o,t/2,o,t/2,a,t/2]},{cmd:"C",args:[o,t/2,o,t/2,o,Math.min(i+i/2,i+n)]},{cmd:"L",args:[o,2*i-n]},{cmd:"C",args:[o,t,o,t-0,a+n,t-0]}];return{cmds:s,lineWidth:n}},r:$t},124:{l:Qt,r:Qt},125:{l:$t,r:$t}},ta=function(){function e(){i()(this,e),this.switch=void 0}return o()(e,[{key:"getParamsRanges",value:function(e,t){return e.convertParams(t)}},{key:"getAlign",value:function(e){if(e){if(null!=e.al)return Zt;if(null!=e.ac)return qt;if(null!=e.ar)return Xt}return qt}},{key:"checkParamRanges",value:function(e,t){return!0}},{key:"processParam",value:function(e,t,a,n){var i=[];return this.checkParamRanges(a,n)?(this.processParamRange(e,t,a,n,i),i):i}},{key:"processParamRange",value:function(e,t,a,n,i){if(n.length>0)for(var r=0;r<n.length;r++){var o=n[r];if(o.len>0){e.eqHandler.reset(o.eqResult);var s=e.processInnerLine(t,a,o);if(!s)return;i.push(s)}}}},{key:"calcHeight",value:function(e){var t=e.lines,a=0,n=0;return t&&t.length>0&&t.forEach((function(e){a=Math.max(a,e.baseHeight),n=Math.max(n,e.baseline)})),{height:a,ascent:n}}},{key:"calcWidth",value:function(e){var t=e.lines;if(!t||t.length<=0)return 0;var a=0;return t.forEach((function(e){a=Math.max(a,e.rect.width)})),a}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;!n||n.length<=0||n.forEach((function(e){e.isUpdateRequired=!0;var n={x:a.x,y:a.y+e.parent.baseline-e.baseline};e.composeProcess(t,n)}))}}]),e}(),aa=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="a",e}return ee()(t,e),o()(t,[{key:"calcWidth",value:function(e){var t=e.lines,a=0,n=e.subSwitchs.hs,i=n?Object(T.Pt2Px)(n):0;return t&&t.length>0&&t.forEach((function(e){a+=e.max+i})),a}},{key:"calcHeight",value:function(e){var t=e.lines,a=0,n=0;if(t&&t.length>0){for(var i=e.subSwitchs.vs,r=i?Object(T.Pt2Px)(i):0,o=0;o<t[0].arr.length;++o){for(var s=0,c=0;c<t.length;++c){var l=t[c].arr[o];l&&(s=Math.max(s,l.baseHeight))}o!=t[0].arr.length-1&&(s+=r),a+=s}n=.6*a}return{height:a,ascent:n}}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){for(var i=this.getAlign(e.subSwitchs),r=e.subSwitchs.hs?Object(T.Pt2Px)(e.subSwitchs.hs):0,o=e.subSwitchs.vs?Object(T.Pt2Px)(e.subSwitchs.vs):0,s=[],c=0;c<n[0].arr.length;++c){for(var l=0,u=0,h=0;h<n.length;++h){var d=n[h].arr[c];d&&(l=Math.max(l,d.baseHeight),u=Math.max(u,d.baseline))}s.push({maxHeight:l,maxBaseline:u})}var p={x:a.x,y:a.y};i==qt?p.x+=r/2:i==Xt&&(p.x+=r);for(var g=0;g<n.length;++g){for(var f={x:p.x,y:p.y},v=0;v<n[0].arr.length;++v){var m=n[g].arr[v];if(m){var y=void 0;if(i==Zt)y={x:f.x,y:f.y+s[v].maxBaseline-m.baseline};else if(i==qt){var k=(n[g].max-m.rect.width)/2;y={x:f.x+k,y:f.y+s[v].maxBaseline-m.baseline}}else{var b=n[g].max-m.rect.width;y={x:f.x+b,y:f.y+s[v].maxBaseline-m.baseline}}m.isUpdateRequired=!0,m.composeProcess(t,y)}f.y+=s[v].maxHeight+o}p.x+=n[g].max+r}}}},{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone;if(a.subSwitchs.co===Number.MIN_SAFE_INTEGER)return a.error=!0,!1;var n=this.getAlign(a.subSwitchs);if(n&&(n===Number.MAX_SAFE_INTEGER||n>Xt))return a.error=!0,!1;var i=a.subSwitchs.hs;if(i===Number.MAX_SAFE_INTEGER||i>127)return a.error=!0,!1;var r=a.subSwitchs.vs;return r===Number.MAX_SAFE_INTEGER||r>127?(a.error=!0,!1):!(t.length>39)||(a.error=!0,!1)}},{key:"processParamRange",value:function(e,t,a,n,i){for(var r=a.updatingZone,o=r.subSwitchs.co?r.subSwitchs.co:1,s=n.length,c=0;c<o;++c){for(var l=0,u=[],h=c;h<s;){var d=null;if(n[h].len>0){if(e.eqHandler.reset(n[h].eqResult),!(d=e.processInnerLine(t,a,n[h])))return r.error=!0,i;l=Math.max(l,d.rect.width)}u.push(d),h+=o}i.push({max:l,arr:u})}}}]),t}(ta),na=a(1478),ia=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="b",e.defSymbol="(",e}return ee()(t,e),o()(t,[{key:"getParamsRanges",value:function(e,t){return e.unionParams(t)}},{key:"measureSymbolInfo",value:function(e,t,a,n,i){var r=t.final.getChp(a),o=r.getPropVal("font_color")?r.getPropVal("font_color"):"#000000",s=r.getPropVal("font_name_asia_east"),c={fontFamily:t.data.doc.fonttable.getName(s),fontSize:n,fontStyle:"normal",fontWeight:"normal"};return{charWidth:e.charMeasure.getCharManorWithMeasure(i,c).width,charHeight:n,font:c,symbolChar:i,color:o}}},{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone;if(t.length>1)return a.error=!0,!1;var n=a.subSwitchs.lc,i={char:this.defSymbol};n&&n==Number.MAX_SAFE_INTEGER&&(a.subSwitchs.lc=i);var r=a.subSwitchs.rc;r&&r==Number.MAX_SAFE_INTEGER&&(a.subSwitchs.rc=i);var o=a.subSwitchs.bc;return o&&o==Number.MAX_SAFE_INTEGER&&(a.subSwitchs.bc=i),!0}},{key:"processParamRange",value:function(e,a,n,i,r){var o=n.updatingZone;if(Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"processParamRange",this).call(this,e,a,n,i,r),o.error)return r;var s=o.subSwitchs.lc||o.subSwitchs.rc||o.subSwitchs.bc,c=s?s.char:this.defSymbol;if(r&&r.length>0){var l=r[0].baseHeight,u=o.switchProp.metrics.fontSize,h=function(e,t,a){var n=ea[e.charCodeAt(0)];if(n){var i=n.l(t,a,0),r=n.r(t,a,0);return{leftChar:i,rightChar:r}}}(c,u,l);if(h)h.charWidth=h.leftChar.lineWidth,h.color=o.switchProp.color,h.charHeight=l,h.fontSize=u,h.symbolChar=c,o.symbolInfo=h;else{var d=s.range.pos;o.symbolInfo=this.measureSymbolInfo(e,n.dataStatus,d,l,c)}}}},{key:"calcWidth",value:function(e){var t=e.lines;return!t||t.length<=0?0:e.subSwitchs.lc||e.subSwitchs.rc?e.symbolInfo.charWidth+t[0].rect.width:2*e.symbolInfo.charWidth+t[0].rect.width}},{key:"calcHeight",value:function(e){var t=e.lines,a=0,n=0;if(t&&t.length>0){var i=t[0];a=i.baseHeight,n=i.baseline}return{height:a,ascent:n}}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){var i=n[0];i.isUpdateRequired=!0;var r=e.symbolInfo.charWidth,o=e.symbolInfo;if(o){if(!o.font){if(e.subSwitchs.lc||e.subSwitchs.bc||o.symbolChar==e.switch.defSymbol){var s=new na.a(o.leftChar.cmds,o.fontSize/12,o.color,a.x,a.y);o.leftSymbol=s}if(e.subSwitchs.rc||e.subSwitchs.bc||o.symbolChar==e.switch.defSymbol){var c=new na.a(o.rightChar.cmds,o.fontSize/12,o.color,a.x+i.rect.width+r,a.y);o.rightSymbol=c}}i.composeProcess(t,{x:a.x+r,y:a.y})}}}}]),t}(ta),ra=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="d",e}return ee()(t,e),o()(t,[{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone,n=a.subSwitchs.ba;if(n&&n==Number.MIN_SAFE_INTEGER)return a.error=!0,!1;var i=a.subSwitchs.fo;if(i&&i==Number.MIN_SAFE_INTEGER)return a.error=!0,!1;var r=a.subSwitchs.li;return r&&r==Number.MIN_SAFE_INTEGER?(a.error=!0,!1):!(t.length>39)||(a.error=!0,!1)}},{key:"calcWidth",value:function(e){var t=e.lines,a=0;return e.subSwitchs?(t.forEach((function(e){a+=e.rect.width})),e.dSwitchWidth=a,e.subSwitchs.ba?a-=Object(T.Pt2Px)(e.subSwitchs.ba):e.subSwitchs.fo&&(a+=Object(T.Pt2Px)(e.subSwitchs.fo)),a):a}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines,i=e.lineWidth-e.dSwitchWidth,r=a.y+e.parent.baseline-e.heightInfo.maxAscent;n.forEach((function(e){e.isUpdateRequired=!0,e.composeProcess(t,{x:a.x+i,y:r}),i+=e.rect.width}))}}]),t}(ta),oa=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="f",e}return ee()(t,e),o()(t,[{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone;return 2==t.length||(a.error=!0,!1)}},{key:"processParamRange",value:function(e,t,a,n,i){var r=a.updatingZone,o=n[0],s=n[1];o.len>0&&(e.eqHandler.reset(o.eqResult),r.numline=e.processInnerLine(t,a,o),i.push(r.numline)),s.len>0&&(e.eqHandler.reset(s.eqResult),r.denline=e.processInnerLine(t,a,s),i.push(r.denline))}},{key:"calcHeight",value:function(e){var t=e.lines,a=0,n=0;if(t&&t.length>0){var i=3*e.switchProp.metrics.fontSize/4,r=e.numline?e.numline.baseHeight:0;n=r+1+.35*i,a=r+(e.denline?e.denline.baseHeight:i/2)+1}return{height:a,ascent:n}}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){var i=e.numline?e.numline.rect.width:0,r=e.denline?e.denline.rect.width:0,o=Math.max(i,r),s=e.parent.baseline-e.heightInfo.maxAscent;e.numline&&(e.numline.isUpdateRequired=!0,e.numline.composeProcess(t,{x:a.x+(o-i)/2,y:a.y+s})),e.denline&&(e.denline.isUpdateRequired=!0,e.denline.composeProcess(t,{x:a.x+(o-r)/2,y:a.y+s+(e.numline?e.numline.baseHeight:0)}))}}}]),t}(ta),sa=a(3821),ca=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="i",e}return ee()(t,e),o()(t,[{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone,n=a.subSwitchs.fc,i=a.subSwitchs.vc;return n&&i?(a.error=!0,!1):3==t.length||(a.error=!0,!1)}},{key:"processParamRange",value:function(e,a,n,i,r){var o=n.updatingZone,s=o.subSwitchs.fc||o.subSwitchs.vc;s&&s!=Number.MAX_SAFE_INTEGER&&(e.eqHandler.clear(),o.symbolline=e.processInnerLine(a,n,s.range)),Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"processParamRange",this).call(this,e,a,n,i,r)}},{key:"measureSymbol",value:function(e,t,a,n,i){var r="",o=0,s=0,c=0,l=!0,u=0,h={},d=e.subSwitchs;return d&&t&&a&&n?(d.in?(t.baseHeight+a.baseHeight>n.baseHeight?a.baseHeight>=t.baseHeight?(c=a.baseHeight+t.baseline,s=d.su||d.pr?c/1.3:c):(c=a.baseHeight+t.baseHeight,s=d.su||d.pr?c/1.6:c):c=n.baseHeight,u=Math.max(t.rect.width,a.rect.width)):c=n.baseHeight,(l=d.vc||c==n.baseHeight)&&(s=n.baseline/.82),d.fc&&(s=e.switchProp.metrics.ascent),d.fc&&i?(r=d.fc,o=i.rect.width,{symbolChar:r,symbolPoint:h,realHeight:c=s=i.baseHeight,symbolHeight:s,symbolWidth:o,isExpress:l=n.baseHeight>i.baseHeight}):(r=d.su?String.fromCharCode(8721):d.pr?String.fromCharCode(8719):String.fromCharCode(8747),o=Object(sa.a)(r,s),n.glyphGroupInfos&&a.glyphGroupInfos&&(h.y=n.glyphGroupInfos[0].y+n.baseHeight/2-s/2,h.y<a.glyphGroupInfos[0].y&&(h.y=a.glyphGroupInfos[0].y),d.fc&&(h.y=n.glyphGroupInfos[0].y+n.baseline-e.switchProp.metrics.ascent),h.x=n.glyphGroupInfos[0].x-o-u),{symbolChar:r,symbolPoint:h,realHeight:c,symbolHeight:s,symbolWidth:o,isExpress:l})):{symbolChar:r,symbolPoint:h,realHeight:c,symbolHeight:s,symbolWidth:o,isExpress:l}}},{key:"calcWidth",value:function(e){var t=e.lines;if(!t||t.length<=0)return 0;var a=0,n=t[0],i=t[1],r=t[2],o=this.measureSymbol(e,n,i,r,e.symbolline),s=o.symbolChar,c=o.symbolWidth;e.symbolline||(e.switchProp.data=Object(sa.b)(s));var l=Math.max(n.rect.width,i.rect.width);return e.subSwitchs.in?a+=c+l+r.rect.width:a+=((l=Math.max(c,l))-c)/2+c+r.rect.width,a}},{key:"calcHeight",value:function(e){var t=e.lines,a=0,n=0;if(t&&t.length>0){var i=t[0],r=t[1],o=t[2],s=this.measureSymbol(e,i,r,o,e.symbolline),c=s.realHeight,l=s.isExpress;e.subSwitchs.in?(l?(a=c+i.baseline,n=o.baseline):(a=r.baseHeight+i.baseHeight,n=r.baseHeight>=i.baseHeight?a/2:(r.baseHeight+i.baseline)/2),e.symbolline&&(a=e.symbolline.baseHeight>o.baseHeight?r.baseHeight+i.baseline:o.baseHeight+i.baseline,n=o.baseline)):e.symbolline?(a=r.baseHeight+e.symbolline.baseHeight+i.baseHeight,n=e.symbolline.baseHeight>o.baseHeight?r.baseHeight+e.symbolline.baseHeight/2:Math.max(r.baseHeight+e.symbolline.baseline,o.baseline)):(a=r.baseHeight+o.baseHeight+i.baseHeight,n=r.baseHeight+o.strongAscent)}return{height:a,ascent:n}}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){var i=n[0],r=n[1],o=n[2],s=this.measureSymbol(e,i,r,o,e.symbolline),c=s.symbolHeight,l=s.symbolWidth,u=s.isExpress,h=Math.max(i.rect.width,r.rect.width);if(r.isUpdateRequired=!0,i.isUpdateRequired=!0,o.isUpdateRequired=!0,e.symbolline&&(e.symbolline.isUpdateRequired=!0),e.subSwitchs.in){var d=u?0:e.parent.baseline-o.baseline;r.composeProcess(t,{x:a.x+l,y:a.y}),o.composeProcess(t,{x:a.x+l+h,y:a.y+d});var p=u?c-i.baseline/2:r.baseHeight;i.composeProcess(t,{x:a.x+l,y:a.y+p}),e.symbolline&&e.symbolline.composeProcess(t,{x:a.x,y:a.y+d+o.baseline-e.symbolline.baseline})}else{var g=Math.max(h,l);if(e.symbolline){r.composeProcess(t,{x:a.x+(g-r.rect.width)/2,y:a.y}),e.symbolline.composeProcess(t,{x:a.x,y:a.y+r.baseHeight});var f=e.symbolline.baseHeight<o.baseHeight?e.symbolline.baseHeight:e.symbolline.baseHeight/2;o.composeProcess(t,{x:a.x+(g-l)/2+l,y:a.y+r.baseHeight+f-o.baseline}),i.composeProcess(t,{x:a.x+(g-i.rect.width)/2,y:a.y+r.baseHeight+e.symbolline.baseHeight})}else if(o.composeProcess(t,{x:a.x+(g-l)/2+l,y:a.y+r.baseHeight}),e.subSwitchs.fc){var v=a.y+r.baseHeight+o.baseline-e.switchProp.metrics.ascent-r.baseHeight,m=a.y+r.baseHeight+o.baseline;r.composeProcess(t,{x:a.x+(g-r.rect.width)/2,y:v}),i.composeProcess(t,{x:a.x+(g-i.rect.width)/2,y:m})}else r.composeProcess(t,{x:a.x+(g-r.rect.width)/2,y:a.y}),i.composeProcess(t,{x:a.x+(g-i.rect.width)/2,y:a.y+r.baseHeight+o.baseHeight})}}}}]),t}(ta),la=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="l",e}return ee()(t,e),o()(t,[{key:"getParamsRanges",value:function(e,t){return e.unionParams(t)}},{key:"calcWidth",value:function(e){var t=e.lines;if(!t||t.length<=0)return 0;var a=0;return t.forEach((function(e){a+=e.rect.width})),a}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){var i={x:a.x,y:a.y};n.forEach((function(a){a.isUpdateRequired=!0,a.composeProcess(t,{x:i.x,y:i.y+e.parent.baseline-a.baseline}),i.x+=a.rect.width}))}}}]),t}(ta),ua=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="o",e}return ee()(t,e),o()(t,[{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone;return!(t.length>39)||(a.error=!0,!1)}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){var i=0;n.forEach((function(e){i=Math.max(i,e.rect.width)}));var r=this.getAlign(e.subSwitchs);n.forEach((function(e){var n={x:a.x,y:a.y};r==qt?n.x+=(i-e.rect.width)/2:r==Xt&&(n.x+=i-e.rect.width),e.isUpdateRequired=!0,n.y+=e.parent.baseline-e.baseline,e.composeProcess(t,n)}))}}}]),t}(ta),ha=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="r",e}return ee()(t,e),o()(t,[{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone;return t.length>2?(a.error=!0,!1):(a.hasRoot=1==t.length&&0!=t[0].len||2==t.length&&0!=t[1].len,!0)}},{key:"getRootInfo",value:function(e){var t=e/10,a=(e-t)/2;return{gap:t,topHalf:a,secHalf:(e+t)/2,width:t+a}}},{key:"calcHeight",value:function(e){var t=e.lines,a=0,n=0;if(t&&t.length>0)if(e.hasRoot){var i=2==t.length?t[0]:void 0,r=2==t.length?t[1]:t[0],o=i?Math.max(i.baseline-r.baseHeight/4,0):0;a=o+r.baseHeight,n=o+r.baseline,i||(a+=3,n+=2)}else{var s=t[0];a=s.baseHeight,n=s.baseline}return{height:a,ascent:n}}},{key:"calcWidth",value:function(e){var t=e.lines;if(!t||t.length<=0)return 0;if(e.hasRoot){var a=2==t.length?t[0]:void 0,n=2==t.length?t[1]:t[0],i=this.getRootInfo(n.baseHeight);return(a?Math.max(a.rect.width-i.width/2,0):0)+i.width+n.rect.width}return t[0].rect.width}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0))if(e.hasRoot){var i=2==n.length?n[0]:void 0,r=2==n.length?n[1]:n[0],o=this.getRootInfo(r.baseHeight),s=i?Math.max(i.rect.width,o.width/2)+o.width/2:o.width,c=r.parent.baseline-r.baseline,l={x:a.x+s,y:a.y+c};if(r.isUpdateRequired=!0,r.composeProcess(t,l),i){i.isUpdateRequired=!0;var u=Math.max(o.width/2-i.rect.width,0),h=Math.max(r.baseHeight/4-i.baseline,0),d={x:a.x+u,y:a.y+h};i.composeProcess(t,d)}}else{var p=n[0];p.isUpdateRequired=!0,p.composeProcess(t,a)}}}]),t}(ta),da=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="s",e.offset=5,e}return ee()(t,e),o()(t,[{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone,n=a.subSwitchs.ai;if(n===Number.MAX_SAFE_INTEGER||n>127)return a.error=!0,!1;var i=a.subSwitchs.di;return i===Number.MAX_SAFE_INTEGER||i>127||a.subSwitchs.up===Number.MAX_SAFE_INTEGER||a.subSwitchs.do===Number.MAX_SAFE_INTEGER?(a.error=!0,!1):!(t.length>39)||(a.error=!0,!1)}},{key:"calcHeight",value:function(e){var t=0,a=0,n=e.lines;if(n&&n.length>0)if(1==n.length){var i=n[0];if(e.subSwitchs){if(e.subSwitchs.ai){var r=Object(T.Pt2Px)(e.subSwitchs.ai);a=r+i.baseline,t=r+i.baseHeight}if(e.subSwitchs.di){var o=Object(T.Pt2Px)(e.subSwitchs.di);a=i.baseline,t=o+i.baseHeight}if(null!=e.subSwitchs.up){var s=Object(T.Pt2Px)(e.subSwitchs.up),c=Math.abs(s);a=c+i.baseline,t=c+i.baseHeight}if(null!=e.subSwitchs.do){var l=Object(T.Pt2Px)(e.subSwitchs.do),u=Math.abs(l);a=i.baseline,t=u+i.baseHeight}}}else n.forEach((function(e){t+=e.baseHeight})),a=.6*t;return{height:t,ascent:a}}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){var i={x:a.x,y:a.y};if(1==n.length){var r=n[0];i.y+=e.parent.baseline-r.baseline,null!=e.subSwitchs.up?i.y-=Object(T.Pt2Px)(e.subSwitchs.up):null!=e.subSwitchs.do?i.y+=Object(T.Pt2Px)(e.subSwitchs.do):i.y-=this.offset,r.isUpdateRequired=!0,r.composeProcess(t,i)}else i.y+=e.parent.baseline-e.heightInfo.maxAscent,n.forEach((function(e){e.isUpdateRequired=!0,e.composeProcess(t,i),i.y+=e.baseHeight}))}}}]),t}(ta),pa=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.switch="x",e.boundEx={w:11,h:11},e}return ee()(t,e),o()(t,[{key:"checkParamRanges",value:function(e,t){var a=e.updatingZone;return a.subSwitchs.le===Number.MIN_SAFE_INTEGER||a.subSwitchs.ri===Number.MIN_SAFE_INTEGER||a.subSwitchs.to===Number.MIN_SAFE_INTEGER||a.subSwitchs.bo===Number.MIN_SAFE_INTEGER?(a.error=!0,!1):!(t.length>1)||(a.error=!0,!1)}},{key:"calcWidth",value:function(e){var t=e.lines;if(!t||t.length<=0)return e.realWidth=this.boundEx.w/1.5,this.boundEx.w;var a=0;return t.forEach((function(e){a+=e.rect.width})),e.realWidth=a,a+=this.boundEx.w}},{key:"calcHeight",value:function(e){var t=e.lines,a=0,n=0;return t&&t.length>0?(t.forEach((function(e){a=Math.max(a,e.baseHeight),n=Math.max(n,e.baseline)})),e.realHeight=a,a+=this.boundEx.h,n+=this.boundEx.h/2):(a=this.boundEx.h/4,e.realHeight=a),{height:a,ascent:n}}},{key:"calcOrigin",value:function(e,t,a){var n=e.lines;if(n&&!(n.length<=0)){var i={x:a.x+this.boundEx.w/2,y:a.y};n.forEach((function(a){a.isUpdateRequired=!0,a.composeProcess(t,{x:i.x,y:i.y+e.parent.baseline-a.baseline}),i.x+=a.rect.width}))}}}]),t}(ta),ga={a:new aa,b:new ia,d:new ra,f:new oa,i:new ca,l:new la,o:new ua,r:new ha,s:new da,x:new pa},fa=function(){function e(){i()(this,e)}return o()(e,null,[{key:"createSwitch",value:function(e){return ga[e]}}]),e}(),va={a:{al:"switchAlign",ac:"switchAlign",ar:"switchAlign",co:"switchNatural",vs:"switchPosition",hs:"switchPosition"},b:{lc:"switchChar",rc:"switchChar",bc:"switchChar"},d:{fo:"switchNumber",ba:"switchNumber",li:"switchAt"},i:{su:"switchAt",pr:"switchAt",in:"switchAt",fc:"switchChar",vc:"switchChar"},o:{al:"switchAlign",ac:"switchAlign",ar:"switchAlign",ad:"switchAlign"},s:{ai:"switchPosition",di:"switchPosition",up:"switchNumber",do:"switchNumber"},x:{le:"switchAt",ri:"switchAt",to:"switchAt",bo:"switchAt"}},ma=function(){function e(){i()(this,e),this._code="",this._hit=0,this._initPos=0,this._switchs={},this._eqFieldResults=[],this._phoneticArg={}}return o()(e,[{key:"getCode",value:function(){return this._code}},{key:"init",value:function(e,t,a,n){this._hit=0,this.dataStatus=e,this._initPos=t,this._code=a,this._eqFieldResults=n}},{key:"getChar",value:function(e){return e<this._code.length&&e>=0?this._code[e].toLowerCase():""}},{key:"getStr",value:function(e,t){return e<0||e>=this._code.length||t<0||t>this._code.length||this._code.length<=0?"":this._code.slice(e,e+t)}},{key:"getSubSwitch",value:function(){for(var e="a".charCodeAt(),t="z".charCodeAt(),a=this.getStr(this._hit,2);this.curChar.charCodeAt()>=e&&this.curChar.charCodeAt()<=t;)this.move(1);return a}},{key:"getSwitch",value:function(e){return this._switchs[e]?this._switchs[e]:this._switchs.default}},{key:"move",value:function(e){this._hit+=e}},{key:"locate",value:function(e){this._hit=e}},{key:"skipSpace",value:function(){for(;" "==this._code[this._hit];)this.move(1)}},{key:"isEQField",value:function(){return"eq"===this._code.slice(this._hit,this._hit+2).toLowerCase()}},{key:"getSwitchProp",value:function(e){var t=e,a=t+1,n="#000000",i=void 0;if(this.dataStatus){var r=this.dataStatus.glyphpool.getGlyphGroups(t,a);r&&r[0]&&(i=r[0].metrics,r[0].chpx.getPropVal("font_color")&&(n=r[0].chpx.getPropVal("font_color")))}return{color:n,metrics:i}}},{key:"parse",value:function(){if(this.skipSpace(),!this.isEQField())return!1;this.move(2),this.skipSpace();for(var e=void 0;e=this.curChar;)if("\\"==e){var t=this.getChar(this._hit+1);if("*"!=t){var a=this._initPos+this._hit+1;if(this.move(2),!this._switchs[t]){var n=fa.createSwitch(t);if(!n)return!1;this._switchs[t]=n}var i=this.parseSwitch(t),r=i.status,o=i.eqResult;if(!r)return!1;o.switchProp=this.getSwitchProp(a),this._eqFieldResults.push(o)}else this.move(2),this.parsePhonetic()}else if(e.charCodeAt()==W.n){var s=this.parseFieldSection(),c=s.status,l=s.eqResult;if(!c)return!1;this._eqFieldResults.push(l)}else{var u=this.parseStrEx(),h=u.status,d=u.eqResult;if(!h)return!1;this._eqFieldResults.push(d)}return!0}},{key:"switchAlign",value:function(){var e=Number.MAX_SAFE_INTEGER;switch(this.getChar(this._hit-1)){case"l":e=Zt;break;case"r":e=Xt;break;case"c":e=qt;break;case"d":e=Yt;break;default:return e}return e}},{key:"switchNatural",value:function(){var e=this.switchNumber();return e<=0&&(e=1),e}},{key:"switchPosition",value:function(){var e=this.switchNumber();return e<0&&(e=Number.MAX_SAFE_INTEGER),e}},{key:"switchNumber",value:function(){for(var e="0".charCodeAt(),t="9".charCodeAt(),a=Number.MAX_SAFE_INTEGER,n=1,i=0;this.curChar&&"("!=this.curChar||0!=i;){var r=this.curChar.toLocaleLowerCase().charCodeAt();if(r===W.n&&i++,r===W.o&&i--,e<=r&&r<=t&&0==i)break;this.move(1)}"-"==this.getChar(this._hit-1)&&(n=-1);for(var o=this._hit;e<=this.curChar.charCodeAt()&&this.curChar.charCodeAt()<=t;)this.move(1);if(this._hit===o)a=1;else{var s=this.getStr(o,this._hit-o);a=parseInt(s)}return a*=n}},{key:"switchAt",value:function(){return 1}},{key:"switchChar",value:function(){var e=Number.MAX_SAFE_INTEGER;return"\\"!=this.curChar||(this.move(1),e={range:{pos:this._hit+this._initPos,len:1},char:this.raw},this.move(1)),e}},{key:"untilChar",value:function(e){var t="",a=0;for(this.skipSpace();(t=this.curChar)&&t!=e&&"("!=t||0!=a;)t.charCodeAt()===W.n&&a++,t.charCodeAt()===W.o&&a--,this.move(1)}},{key:"parseSwitch",value:function(e){var t={},a=va[e];if(t.charSwitch=e,t.paramRanges=[],a){var n=this.parseSubSwitch(a),i=n.status,r=n.subSwitchs;if(!i)return{status:!1};t.subSwitchs=r}return this.parseParam(t)?("o"==e&&this.checkPhonetic(t),{status:!0,eqResult:t}):{status:!1}}},{key:"parseSubSwitch",value:function(e){var t={};if(!e)return{status:!0,subSwitchs:t};var a=null;for(this.untilChar("\\");(a=this.curChar)&&"("!=a;){if("\\"!=a)return{status:!1,subSwitchs:t};this.move(1),a=this.curChar;var n=this.getSubSwitch().toLowerCase(),i=e[n];if(!i)return{status:!1,subSwitchs:t};var r=this[i]();if(r==Number.MIN_SAFE_INTEGER)return{status:!1,subSwitchs:t};t[n]=r,this.untilChar("\\")}return{status:!0,subSwitchs:t}}},{key:"parseFieldSection",value:function(){var e={};e.charSwitch=W.n,e.paramRanges=[];for(var t={cp:this._hit},a=0,n=null;n=this.curChar;){if(n.charCodeAt()==W.n)a++;else if(n.charCodeAt()==W.o&&0==--a)break;this.move(1)}return 0!=a?{status:!1}:(t.ccp=this._hit-t.cp+1,this.move(1),e.paramRanges.push(t),{status:!0,eqResult:e})}},{key:"parseStr",value:function(e,t){for(var a={charSwitch:" ",paramRanges:[]},n=e,i="",r=this._hit,o={cp:r};(i=this.getChar(r))&&(i!=t||n>0)&&(")"!=i||n>0)&&"\\"!=i&&i.charCodeAt()!=W.n;)"("==i&&this.isNotSymbol(r)?n++:")"==i&&n--,r++;return o.ccp=r-o.cp,this.locate(r),a.paramRanges.push(o),{status:!0,eqResult:a,newLevel:n}}},{key:"parseStrEx",value:function(e){for(var t={charSwitch:" ",paramRanges:[]},a="",n={cp:this._hit};(a=this.curChar)&&a!=e&&"\\"!=a&&a.charCodeAt()!=W.n;)this.move(1);return n.ccp=this._hit-n.cp,t.paramRanges.push(n),{status:!0,eqResult:t}}},{key:"parsePhonetic",value:function(){for(var e=this._hit,t="";(t=this.curChar)&&"\\"!=t;)this.move(1);var a=this.getStr(e,this._hit-e);if(a.indexOf("jc")>=0){var n=a.slice(a.indexOf("jc")+2).trim();this._phoneticArg.jc=n}else if(a.indexOf('"Font:')>=0){var i=a.slice(a.indexOf('"Font:')+6).trim();this._phoneticArg.font=i.slice(0,i.length-1)}else if(a.indexOf("hps")>=0){var r=a.slice(a.indexOf("hps")+3).trim();this._phoneticArg.hps=r}else{var o=!1;if(""!=a&&" "!=a[0]||(o=!0),a.length>1&&" "==a[a.length-1]&&(o=!1),o)for(;this.curChar&&" "!=this.curChar;)this.move(1)}this.skipSpace()}},{key:"checkPhonetic",value:function(e){if(null!=this._phoneticArg.jc){var t=e.params.find((function(e){return"s"==e.charSwitch}));t&&(t.phoneticArg=p()({},this._phoneticArg),this._phoneticArg={})}}},{key:"isNotSymbol",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=e>0?this._initPos+e:this._initPos+this._hit,a=this.dataStatus.data.glyphpool.glyphBuff.getCharCode(t);return!a||a===W.C}},{key:"parseParam",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.skipSpace();var a=0,n=[],i={cp:this._hit},r=null;for("("===this.curChar&&this.isNotSymbol()&&this.move(1);(r=this.curChar)&&")"!=r||""!=r&&a>0;){if("\\"==r){var o=this.getChar(this._hit+1),s=this._initPos+this._hit+1;if(this.move(2),!this._switchs[o]){var c=fa.createSwitch(o);if(!c)return!1;this._switchs[o]=c}var l=this.parseSwitch(o),u=l.status,h=l.eqResult;if(!u)return!1;h.switchProp=this.getSwitchProp(s),n.push(h)}else if(r.charCodeAt()==W.n){var d=this.parseFieldSection(),p=d.status,g=d.eqResult;if(!p)return!1;n.push(g)}else{var f=this.parseStr(a),v=f.status,m=f.eqResult,y=f.newLevel;if(!v)return!1;a=y,n.push(m)}r==t&&(i.ccp=this._hit-i.cp+1,e.params=n,e.paramRanges.push(i),n.length=0)}return")"==r&&(i.ccp=this._hit-i.cp+1,this.move(1),e.params=n,e.paramRanges.push(i),!0)}},{key:"isParseResultsNotEmpty",value:function(){return 0!=this._eqFieldResults.length}},{key:"getLineRange",value:function(){var e=this._eqFieldResults[this._eqFieldResults.length-1];return{pos:this._initPos+this._eqFieldResults[0].paramRanges[0].cp,len:e.paramRanges[0].cp+e.paramRanges[0].ccp-this._eqFieldResults[0].paramRanges[0].cp}}},{key:"convertRange",value:function(e){return{pos:e.cp+this._initPos,len:e.ccp}}},{key:"initLineStatus",value:function(e){this._eqFieldResults&&this._eqFieldResults.length>0&&(e.eqFieldResults=this._eqFieldResults,e.eqPos=this._initPos,e.eqIndex=0)}},{key:"resetInitPos",value:function(e){this._initPos=e.eqPos}},{key:"merge",value:function(e,t){return e?t?Object.assign(e,t):e:t}},{key:"clear",value:function(){this._eqFieldResults=[]}},{key:"reset",value:function(e){e.charSwitch==W.o?this._eqFieldResults=e.params:" "==e.charSwitch||e.charSwitch==W.n?this.clear():this._eqFieldResults=[e]}},{key:"unionParams",value:function(e){var t=this._eqFieldResults[0].paramRanges[0].cp,a=this._eqFieldResults.length,n=this._eqFieldResults[a-1].paramRanges[0].cp+this._eqFieldResults[a-1].paramRanges[0].ccp,i={charSwitch:W.o};i.paramRanges=[{cp:t,ccp:n-t}],i.params=[],this._eqFieldResults.forEach((function(e){i.params.push(e)}));var r=this.convertRange(i.paramRanges[0]);return r.eqResult=i,[r]}},{key:"convertParams",value:function(e){for(var t=this,a=function(e){var t=e.indexOf(",");if(t<0)return t;var a=e.slice(0,t),n=e.slice(t+1),i=a.lastIndexOf("("),r=n.indexOf(")");return i>=0&&i<=a.length-1&&r>=0&&r<=n.length-1?(n=n.slice(r)).indexOf(",")>=0?t+(r+1)+n.indexOf(","):-1:t},n=function e(a){if(!(a<0||a>=t._eqFieldResults.length)){var n=t._eqFieldResults[a];if(!n.isMerge){var i=e(a-1);if(n.isMerge=!0,!i)return n;var r=[{cp:i.paramRanges[0].cp,ccp:n.paramRanges[0].cp+n.paramRanges[0].ccp-i.paramRanges[0].cp}];if(i.charSwitch!=W.o){var o={charSwitch:W.o};return n.charSwitch!=W.o?o.params=[i,n]:o.params=[i].concat(n.params),o.paramRanges=r,o}return i.paramRanges=r,n.charSwitch!=W.o?i.params.push(n):i.params=i.params.concat(n.params),i}}},i=[],r=this._eqFieldResults.length,o=0;o<r;++o){var s=this._eqFieldResults[o];if(" "==s.charSwitch){for(var c=this._eqFieldResults[o-1],l=this._eqFieldResults[o+1],u=this.convertRange(s.paramRanges[0]),h=u.pos,d=e.doc.getText(u.pos,u.len),g=-1;(g=a(d))>=0;){if(s.isMerge=!0,c&&" "!=c.charSwitch&&!c.isMerge){if(g>0){var f={charSwitch:" ",paramRanges:[{cp:s.paramRanges[0].cp,ccp:g}]};if(c.charSwitch==W.o)c.params&&c.params.push(f),c.paramRanges[0].ccp+=g;else{var v=[],m=p()({},c);m.paramRanges=[{cp:c.paramRanges[0].cp,ccp:c.paramRanges[0].ccp}],v.push(m),v.push(f),c.charSwitch=W.o,c.paramRanges[0].ccp+=g,c.params=v}}var y=n(o-1);y&&((u=this.convertRange(y.paramRanges[0])).eqResult=y,i.push(u))}else g>0?i.push({pos:h,len:g,eqResult:s}):i.push({pos:h,len:0,eqResult:s});h+=g+1,d=d.slice(g+1)}if(s.isMerge)if(l&&" "!=l.charSwitch){if(d.length>0){var k=[],b=p()({},l),P={charSwitch:" ",paramRanges:[{cp:s.paramRanges[0].cp+s.paramRanges[0].ccp-d.length,ccp:d.length}]},x=l.paramRanges[0].cp+l.paramRanges[0].ccp,_=P.paramRanges[0].cp;b.paramRanges=[{cp:l.paramRanges[0].cp,ccp:l.paramRanges[0].ccp}],k.push(P),k.push(b),l.charSwitch=W.o,l.paramRanges[0].cp=_,l.paramRanges[0].ccp=x-_,l.params=k}}else i.push({pos:h,len:d.length,eqResult:s})}}var C=n(r-1);if(C){var w=this.convertRange(C.paramRanges[0]);w.eqResult=C,i.push(w)}return i}},{key:"processSwitch",value:function(e,t,a){var n=a.updatingZone,i=a.dataStatus.data,r=n.switch,o=r.getParamsRanges(this,i);return r.processParam(e,t,a,o)}},{key:"isIgnoreEqPart",value:function(){return this._eqFieldResults&&0===this._eqFieldResults.length&&0!=this._hit&&0!=this._code.length}},{key:"updateRect",value:function(e){var t=0;e.isIgnore||(e.zones.find((function(e){return!e.isEqZone}))?t=e.textWidth:e.textWidth=0,e.zones.forEach((function(e){if(e.isEqZone)if(e.error)t+=e.errorInfo.width;else if(e.label==W.n)t+=e.line.rect.width;else{var a=e.switch;if(a){var n=a.calcWidth(e);e.lineWidth=n,t+=n}}})));e.rect.updateByWidth(t)}},{key:"curChar",get:function(){return this._hit<this._code.length?this._code[this._hit].toLowerCase():""}},{key:"raw",get:function(){return this._hit<this._code.length?this._code[this._hit]:""}},{key:"begin",get:function(){return this._initPos}},{key:"end",get:function(){return this._initPos+this._code.length}}],[{key:"getInstance",value:function(){return this._instance=this._instance||new e,this._instance}}]),e}(),ya=function(e){function t(){i()(this,t);var e=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.eqHandler=ma.getInstance(),e}return ee()(t,e),o()(t,[{key:"mateOf",value:function(e,t){var a=t.eqFieldResults;if(a){var n=t.eqIndex;if(t.hasNextZone=n<a.length-1," "==a[n].charSwitch){var i=t.eqPos+a[n].paramRanges[0].cp;return t.dataStatus.locate(i),t.limitEnd=i+a[n].paramRanges[0].ccp,++t.eqIndex,!1}return!0}var r=t.dataStatus.document.fields,o=t.dataStatus.pos,s=r.getField(o);if(!s||"EQ"!==s.type)return!1;var c=t.dataStatus.data.doc.getText(o,1);return!(s.begin<=o&&o<=s.end&&c.charCodeAt()!=W.n)}},{key:"makeZone",value:function(e,t){var a=t.dataStatus,n=new zt({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem}),i=a.data.doc.stylesheet.findStyle(0),r=a.data.doc.stylesheet.getStyle(i),o=a.data.doc.fonttable.getName(r.chpx.font_name_asia_east);return n.errorInfo={code:_i18n("applications.writer.components.other.eqField.error", "Mistake!"),font:{fontFamily:o,fontSize:"14",fontStyle:"normal",fontWeight:"bold"},width:34,heightInfo:{height:18.9,ascent:13.45}},n}},{key:"initZone",value:function(e,t,a){var n=t.dataStatus,i=t.eqFieldResults;a.typoRange={pos:n.pos-e.range.pos,len:0};var r=0,o="",s=[];if(i){var c=t.eqIndex;if(i[c].charSwitch==W.n){var l=i[c].paramRanges[0].ccp-2;r=t.eqPos+i[c].paramRanges[0].cp+1,o=n.data.doc.getText(r,l),n.locate(r)}else o="",r=t.eqPos,s=i[c].params}else{var u=n.document.fields.getEqField(n.pos);u&&(t.eqPos=u.codeBegin,r=u.codeBegin,o=n.data.doc.textStream.getText(u.codeBegin,u.codeEnd-u.codeBegin))}this.eqHandler.init(n,r,o,s)}},{key:"updateZone",value:function(e,t){var a=t.updatingZone,n=this.eqHandler.getCode(),i=e.range.pos+a.typoRange.pos,r=this.eqHandler.end+1,o=t.eqFieldResults;if(n&&n.length>0){if(this.eqHandler.parse()){if(this.eqHandler.isParseResultsNotEmpty()){var s=this.eqHandler.getLineRange();a.line=this.processInnerLine(e,t,s),a.label=W.n}}else a.error=!0;var c=a.error?a.errorInfo.width:a.line?a.line.rect.width:0;if(t.eqZoneWidth||(t.eqZoneWidth=0),t.charPos+t.eqZoneWidth+c>t.textEnd&&!t.bForceRenderChar)return a.typoRange.len=0,t.dataStatus.locate(i),B.a.LineEnd;if(t.bForceRenderChar&&(t.bForceRenderChar=!1),t.eqZoneWidth+=c,t.dataStatus.locate(r),a.typoRange.len=t.dataStatus.pos-i,o&&++t.eqIndex,t.limitEnd&&r===t.limitEnd)return B.a.DataEnd}else if(o){var l=t.eqIndex;if(a.label=o[l].charSwitch,a.switch=this.eqHandler.getSwitch(a.label),a.switchProp=o[l].switchProp,a.subSwitchs=o[l].subSwitchs,o[l].phoneticArg&&(a.phoneticArg=o[l].phoneticArg),a.lines=this.eqHandler.processSwitch(this,e,t),a.typoRange.len=o[l].paramRanges[0].ccp,a.error){var u=o.length-1,h=t.eqPos+o[u].paramRanges[0].cp+o[u].paramRanges[0].ccp;return a.typoRange.len=h-i,t.dataStatus.locate(h),B.a.LineEnd}if(++t.eqIndex,t.eqIndex>=o.length)return t.dataStatus.locate(t.limitEnd+1),B.a.DataEnd}return B.a.Pass}},{key:"processPhonetic",value:function(e,t,a){var n=this,i=e.dataStatus.glyphpool.glyphBuff.getBuffs(),r=a.pos,o=a.pos+a.len,s={},c=parseInt(t.jc);if(Number.isInteger(c)?s.algin=c:s.algin=0,t.hps){var l=parseInt(t.hps);if(Number.isInteger(l)){var u=l/2*4/3;s.fontSize=u.toString()}else s.fontSize="1"}else{var h=e.dataStatus.glyphIterator.glyphGroup;s.fontSize=h.font.fontSize}return s.fontFamily=t.font,i.size<o&&(e.dataStatus.locate(o),e.dataStatus.locate(r)),i.forEach(r,o,(function(e,t,a){if(t[a]){var i=t[a].mi,r=n.charMeasure.getCharManorWithMeasure(t[a].char,s).width;i&&i.setFixedWidth(r)}})),s}},{key:"processInnerLine",value:function(e,t,a){var n=this.getInnerLineUpdater(t),i=this.createInnerLineStatus(t,a,n),r=this.createInnerLine(e,i),o=t.updatingZone.phoneticArg;return o&&(r.phoneticFont=this.processPhonetic(i,o,a),delete t.updatingZone.phoneticArg),this.eqHandler.initLineStatus(i),Ae.processLine(r,i),this.eqHandler.resetInitPos(t),i.updatingZone&&i.updatingZone.error||i.charPos+i.curCharRealWidth>i.textEnd?(t.updatingZone.error=!0,null):(Ae.endLine(r,i,i.dataStatus),this.eqHandler.updateRect(r),r.rect.width>i.textEnd?(t.updatingZone.error=!0,null):(e.view.attachTextLine(r),r))}},{key:"getInnerLineUpdater",value:function(e){return this.innerLineUpdater||(this.fakePackUpdater={},this.fakePackUpdater.getTextZonePolicies=function(){return e.lineUpdater.getTextZonePolicies()},this.fakePackUpdater.getFieldZonePolicies=function(){return e.lineUpdater.getFieldZonePolicies()},this.fakePackUpdater.getChpxZonePolicies=function(){return[]},this.fakePackUpdater.getFootnoteEndnotePolicies=function(){return[]},this.innerLineUpdater=new dt(this.fakePackUpdater)),this.innerLineUpdater}},{key:"createInnerLine",value:function(e,t){var a=new D.b({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem},{compose:e.compose}),n=t.dataStatus.pos;return this.eqHandler.isIgnoreEqPart()&&(a.isIgnore=!0),a.inEqZone=!0,a.range=new O.a(n,0,a),a.rect=I.a.initByRawRect({top:0,left:0,right:t.usableWidth,bottom:0}),a}},{key:"createInnerLineStatus",value:function(e,t,a){var n=Object.assign({},e);return n.lineUpdater=a,n.lineCompress.bForbidCompress=!0,n.forbidSpaceExceed=!0,n.bLineCompressed=!1,n.lineSpacing={isHeightOrMargin:!0,rule:0,val:240},n.gridMode=0,this.removeFieldPorp(n),this.resetLineStatus(n,e,t),n}},{key:"removeFieldPorp",value:function(e){e&&(delete e.hasNextZone,delete e.eqSwitch,delete e.eqFieldResults)}},{key:"resetLineStatus",value:function(e,t,a){var n=t.dataStatus;n.locate(a.pos),Object.assign(e,{bForceRenderChar:t.bForceRenderChar,ccp:0,charPos:0,curPolicy:null,hiddenLen:0,lastGlyphIter:n.glyphIterator.clone(),lastTabGlyph:null,lastTabPos:0,limitEnd:a.pos+a.len,limitRange:a,maxScanPos:a.pos,minCharPos:0,textStart:0,textEnd:1.14*t.textEnd,thisGlyphIterator:n.glyphIterator,update_begin:n.pos,updatingZone:null,usableWidth:t.usableWidth})}},{key:"charMeasure",get:function(){return this._charMeasure||(this._charMeasure=new F.a),this._charMeasure}}],[{key:"mateByField",value:function(e){return e&&"EQ"==e.type}}]),t}(lt.a),ka=ya;window.APP.makeZoneByField=function(e,t,a,n){if(!ya.mateByField(a))return null;var i=new zt({parent:t,viewPage:t.viewPage,coorSystem:t.coorSystem});return i.typoRange={pos:n-t.range.pos,len:a.len},i};var ba=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostAgent",base:at,methodName:"init"},{baseName:"DOCHostAgent",base:at,methodName:"onEnterPack"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCHostAgent_init(e,t)}},{key:"acceptUpdatingLine",value:function(e,t){return!0}},{key:"onPackBroken",value:function(e,t){return B.c.Pass}},{key:"onEnterPack",value:function(e,t){this.mixin_DOCHostAgent_onEnterPack(e,t)}},{key:"onLeavePack",value:function(e,t){var a=this.calcPackSize(e);e.rect.bottom=e.rect.top+a.height}},{key:"makePackToolkit",value:function(){var e=new Nt(this),t=new Nt(this);return{packUpdater:this.makePackUpdater(),lanePolicy:new jt(this),layersPolicy:e,embedPolicy:t}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.makeLinePolicies(this),[])}},{key:"calcBodyRange",value:function(e,t){var a=this.document.comments.getCommentByRcId(t.hostStatus.commentId);return{pos:a.body.pos,len:a.body.len}}},{key:"getUsableHeightOfPack",value:function(e){return Number.MAX_SAFE_INTEGER}},{key:"getFieldZonePolicies",value:function(){return[new ka]}},{key:"getFootnoteEndnotePolicies",value:function(){return[]}},{key:"isPageBroken",value:function(e,t){return!1}},{key:"isDataDone",value:function(e,t){return t.dataStatus.pos===t.bodyRange.pos+t.bodyRange.len}},{key:"calcPackSize",value:function(e){var t=0,a=0,n=e.lines;if(!n.length)return{height:t,width:a};var i=n[n.length-1];t=i.rect.bottom,t+=i.border.after_width||0,t+=i.after_space||0;var r=0,o=Number.MIN_SAFE_INTEGER;return n.forEach((function(e){r=Math.min(r,e.rect.left),o=Math.max(o,e.rect.right)})),{height:t,width:a=Math.max(0,o-r)}}}]),e}();s.a.mix(ba,at);var Pa=function(){function e(){i()(this,e)}return o()(e,[{key:"makeTextLinePolicy",value:function(e,t){return new tt(e,t)}},{key:"makePageAgent",value:function(e,t){return new ba(e,t)}}]),e}(),xa=function e(t){i()(this,e),this.dataStatus=t.dataStatus,this.embedCache={},this.shapeCache={},this.lookaheadPosOfLayers=0,this.enterHostStatus=t.enterHostStatus},_a=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.outerRowData=e.rowData,a.outerStartFromScratch=e.startFromScratch,a.outerLastLineIsBrokenAfter=e.lastLineIsBrokenAfter,a.outerReUpdate=e.reUpdate,a.outerMaxUseableHeight=e.maxUseableHeight,a.outerEnterFromTable=e.enterFromTable,a}return ee()(t,e),t}(xa),Ca=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.outerStartFromScratch=e.startFromScratch,a.hostSubdocType=l.Textbox,a.tableLevel=0,a.isInTextbox=!0,a}return ee()(t,e),t}(xa),wa=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.outerStartFromScratch=e.startFromScratch,a.outerFrameData=e.outerFrameData,a.outerReUpdateSingleLine=e.reUpdateSingleLine,a}return ee()(t,e),t}(xa),Sa=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.viewStatus=e,a.commentId=a.viewStatus.commentId,a}return ee()(t,e),t}(xa),La=a(2292),Ta=a(1032),Ia=function(e){function t(e,a){i()(this,t);var n=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:e,coorSystem:null}));return n.hostPendings=[],n.layers=null,n.rect=I.a.initByRawRect({top:a+e.verticalPadding,left:e.horizontalPadding,right:e.width-e.horizontalPadding,bottom:a+e.verticalPadding}),n.page=Ta.d.initByParams({context:{parent:n,viewPage:n,coorSystem:_.DOCCoorSystemType.MobilePage},params:{rect:I.a.initByRawRect({top:0,left:0,right:e.width-2*e.horizontalPadding,bottom:0}),textflow:La.a.default(),compose:e.compose}}),n._drawingOffset={x:0,y:0},n}return ee()(t,e),o()(t,[{key:"reset",value:function(){this._drawingOffset={x:0,y:0}}},{key:"isHost",value:function(){return!0}},{key:"isScene",value:function(){return!0}},{key:"isCoorSystem",value:function(){return!0}},{key:"expired",value:function(){return this.hostPendings.length>0}},{key:"layoutType",get:function(){return _.DOCLayoutType.CommentPage}},{key:"position2parent",get:function(){return this.rect.origin}},{key:"view",get:function(){return this.parent}},{key:"isTable",get:function(){return!1}},{key:"viewOffset",get:function(){return{x:this.rect.left,y:this.rect.top}}},{key:"width",get:function(){return this.rect.size.width},set:function(e){this.rect.right=e}},{key:"height",get:function(){return this.rect.size.height},set:function(e){this.rect.bottom=e}},{key:"begin",get:function(){return this.page.lines[0].range.begin}},{key:"end",get:function(){var e=this.page.lastline;return e?e.range.end:0}},{key:"minDrawingOffsetX",get:function(){return 0}},{key:"maxDrawingOffsetX",get:function(){return Math.max(0,this.width-this.view.typoWidth)}}]),t}(_.DOCLayout),Ra=function(){function e(t,a,n){i()(this,e),this.init(t,a,n)}return o()(e,[{key:"init",value:function(e,t,a){this.pack=e,this.host=t,this.hostUpdater=a,this.settled=!1}},{key:"term",value:function(){this.pack=null,this.host=null,this.hostUpdater=null,this.settled=!1}},{key:"toString",value:function(){return"pending in "+this.host.constructor.name+" of "+this.viewPage.layout_index}},{key:"viewPage",get:function(){return this.pack?this.pack.viewPage:this.host.viewPage}}]),e}();c.a.buildType(Ra);var Oa=function(){function e(t,a,n){i()(this,e),this.init(t,a,n)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:g.ITRange,methodName:"init"},{baseName:"ITRange",base:g.ITRange,methodName:"onExpand"},{baseName:"ITRange",base:g.ITRange,methodName:"onRemove"}]}}]),o()(e,[{key:"init",value:function(e,t,a){this.mixin_ITRange_init(e,t),this.pack=a}},{key:"toString",value:function(){return"["+this.begin+", "+this.end+")"}}]),e}(),Ba=Oa;s.a.mix(Oa,g.ITRange);var Ma=function(){function e(t,a,n){i()(this,e),this.init(t,a,n)}return o()(e,[{key:"init",value:function(e,t,a){this.pageUpdater=e,this.sceneUpdater=t,this.hostLevel=a,this.initHostPolicies()}},{key:"primeHostAgent",value:function(){return this.hostAgents[0]}},{key:"selectHostAgent",value:function(e){return this.hostAgents.find((function(t){return t.mateOf(e)}))}},{key:"selectPackToolkit",value:function(e){var t=this.selectHostAgent(e);if(!t)return null;var a=t.packToolkit,n=a.layersPolicy,i=a.embedPolicy;return n&&n.reset(e),i&&i.reset(e),t.packToolkit}},{key:"bindPackToolkit",value:function(e,t){var a=this.selectPackToolkit(e);a&&Object.assign(t,a)}},{key:"updateHost",value:function(e,t){var a=this.makeHostStatus(t),n=e.hostPendings;if(!this.checkHost||this.checkHost(e,a)){for(y("[typo] Enter host("+e.layoutName+") conflicting("+e.conflicting+") at level "+(this.getTableLevel()||0)),this.enterHost(e,a);n.length>0;){var i=n.pop(),r=i.pack;this.bindPackToolkit(r,a),a.packUpdater.updatePack(r,a),this.cachePackInfo(r,a),this.pushNextPack(r,a),i.settled=!0}this.leaveHost(e,a),y("[typo] Leave host("+e.layoutName+") at level "+(this.getTableLevel()||0))}}},{key:"pushNextPack",value:function(e,t){t.lanePolicy.isFinalPackInHost(e)?this.primeHostAgent().pushNextHost(e):this.primeHostAgent().pushNextPack(e)}},{key:"cachePackInfo",value:function(e,t){var a=this.pageUpdater.viewUpdater.view;if(a.shouldCachePageInfo&&(e.layoutType===_.DOCLayoutType.MainPage||e.layoutType===_.DOCLayoutType.CellPage)){var n=t.packUpdater,i=t.lanePolicy,r=e.lines[e.lines.length-1],o=e.calcBrokenInfo(),s=n.settledPos(e,e.bodyRange,o),c=i.getPrevPack(e),l=e.bodyRange.pos;c&&(l=c.packRange.end),e.packRange&&a.detachPack(e),e.brokenInfo=e.calcBrokenInfo(),e.lastLine=r,e.packRange=new Ba(l,s,e),a.attachPack(e)}}},{key:"enterHost",value:function(e,t){t.host=e,t.enterHostStatus||(t.enterHostStatus=t)}},{key:"leaveHost",value:function(e,t){e.conflicting=!1}},{key:"pendingByRange",value:function(e,t){this.hostAgents.forEach((function(a){a.pendingByIntersectInfo(a.intersectByRange(e,t))}))}},{key:"pendingToHost",value:function(e,t){var a=this;y("[typo] Pending to host("+t.layoutName+") at page("+t.viewPage.layout_index+")");var n=this.pageUpdater,i=t.hostPendings,r=e.getWholePath(),o=this.getMentionedPosByScenePath(r[r.length-1]),s=!1,c=i.findIndex((function(t){return e===t.pack?s=!0:!!t.pack&&a.compareMentionedPos(a.getMentionedPosByScenePath(t.pack.getScenePath()),o)<=0}));if(!s){var l=Ra.make(e,t,this);-1===c&&(c=i.length),i.splice(c,0,l),n.pendingToPage(l,r)}}},{key:"pendingAt",value:function(e,t){var a=this.selectPackToolkit(e).packUpdater,n=e.lines.length,i=t;"number"!=typeof i&&(i=n),(i<0||n<i)&&console.error("logic error!"),a.dropLines(e,null,{from:i,to:i}),this.pendingToHost(e,e.host)}},{key:"pendingForUnpack",value:function(e,t){e.pendingLines?t.conflicting=!0:e.pendingLines=[],this.pendingToHost(e,t)}},{key:"pendingByObsoletedPack",value:function(e,t){var a=0,n=0,i=this.selectPackToolkit(e).packUpdater;if(e.pendingLines&&-1!=(a=e.pendingLines.findIndex((function(e){return e.obsoleted})))){for(n=e.pendingLines.length-1;n>=0;--n)if(e.pendingLines[n].obsoleted){++n;break}i.dropPendingLines(e,null,{from:a,to:n})}if(-1!=(a=e.lines.findIndex((function(e){return e.obsoleted})))){for(n=e.lines.length-1;n>=0;--n)if(e.lines[n].obsoleted){++n;break}i.dropLines(e,null,{from:a,to:n})}this.pendingToHost(e,t)}},{key:"upPackSize",value:function(e,t){if(e&&e.lines.length){var a=this.getFirstBrokenLineIndex(e,t),n=a>=0?a:e.lines.length;this.pendingAt(e,n)}}},{key:"moveUpPack",value:function(e,t){if(e&&e.lines.length){var a=this.getFirstBrokenLineIndex(e,t),n=a>=0?a:e.lines.length,i=n>0?this.getLastCompatLineIndex(e,n):0,r=i>=0?i:a;r>=0&&this.pendingAt(e,r)}}},{key:"moveDownPack",value:function(e,t,a){if(e&&e.lines.length){var n=this.getFirstBrokenLineIndex(e,a),i=this.getTruncatedLineIndex(e,t),r=n>=0?n:e.lines.length,o=(r=Math.min(r,i>=0?i:e.lines.length))>0?this.getLastCompatLineIndex(e,r):0,s=-1;(s=o>=0?o:n>=0&&i>=0?Math.min(n,i):Math.max(n,i))>=0&&this.pendingAt(e,s)}}},{key:"getFirstBrokenLineIndex",value:function(e,t){var a=-1,n=e.calcBrokenInfo(),i=e.lines[e.lines.length-1];return n.brokenLines?a=e.lines.length-n.brokenLines.length:i.range.end<t.end&&(a=e.lines.length),a}},{key:"getTruncatedLineIndex",value:function(e,t){if(!e||!e.lines.length)return-1;var a=e.lines.findIndex((function(e){return e.rect.bottom>t||e.layoutType===_.DOCLayoutType.TableLine&&e.tablecells.some((function(a){var n=a.cell_page?a.cell_page:a.diagCell&&a.diagCell.pages[0];return e.rect.top+(n&&n.rect.bottom||0)>t}))})),n=e.host.selectLayersByPack(e);if(n){var i={left:0,right:Number.MAX_SAFE_INTEGER,top:t+1,bottom:e.rect.height},r=n.collectWrapCardsByRect(i);if(r.length){r.sort((function(e,t){return e.pos-t.pos}));var o=r[0].outer,s=e.lines.findIndex((function(e){return e===o}));(-1===a||a>s)&&(a=s)}}return a}},{key:"getLastCompatLineIndex",value:function(e,t){var a=this,n=e.lines.slice(0,t).findIndex((function(e){return!!(e.layoutType===_.DOCLayoutType.SnippetLine||e.layoutType===_.DOCLayoutType.TableLine&&a._checkHasCards(e)||e.layoutType===_.DOCLayoutType.TextLine&&e.sublines&&e.sublines.length)}));if(0===n)return 0;var i=e.host.selectLayersByPack(e);if(i){var r=n<0?t:n,o=e.lines[0].range.begin,s=e.lines[r-1].range.end,c=i.collectCardsByRange(o,s);if((c=c.concat(i.collectEmbedsByRange(o,s))).length){c.sort((function(e,t){return e.pos-t.pos}));var l=c[0].outer;return e.lines.findIndex((function(e){return e===l}))}}return n}},{key:"_checkHasCards",value:function(e){var t=e.viewPage.layers;if(!t)return!1;var a=e.range.begin,n=e.range.end,i=t.collectCardsByRange(a,n);return(i=i.concat(t.collectEmbedsByRange(a,n)))&&i.length}},{key:"updaterFactory",get:function(){return this.pageUpdater.viewUpdater.updaterFactory}}]),e}(),Ea=a(1631),Aa=a(3283),Ha=a(3859),Ua=a(3319);function Da(e,t,a){for(var n=a.textStream,i=e.pos+e.len,r=e.pos,o=r,s=0;o<i;){var c=n.getPapx(o);if(o=c.pos+c.len,4===c.prop.para_type){if(!(s<t))break;r=o,++s}}return{pos:r,len:o-r}}function Na(e,t,a){var n=void 0;switch(e.cellBorder){case 1:n={x:0,y:Object(T.Px2Ti)(a*(100-e.pos)/100)};break;case 2:n={x:Object(T.Px2Ti)(t*e.pos/100),y:0};break;case 4:n={x:Object(T.Px2Ti)(t),y:Object(T.Px2Ti)(a*e.pos/100)};break;case 8:n={x:Object(T.Px2Ti)(t*(100-e.pos)/100),y:Object(T.Px2Ti)(a)}}return n}function Fa(e,t,a){var n=void 0;switch(e.cellBorder){case 1:n={x:0,y:a*(100-e.pos)/100};break;case 2:n={x:t*e.pos/100,y:0};break;case 4:n={x:t,y:a*e.pos/100};break;case 8:n={x:t*(100-e.pos)/100,y:a}}return n}var Wa=function(){function e(t){i()(this,e);var a=t[0].x,n=t[0].x,r=t[0].y,o=t[0].y;t.forEach((function(e){a=Math.min(a,e.x),n=Math.max(n,e.x),r=Math.min(r,e.y),o=Math.max(o,e.y)})),this.wrapPoints=t,this.rect=new Ua.a({left:a,top:r,right:n,bottom:o}),this.anchor={data:{private:{distanceLeft:0,distanceRight:0,distanceTop:0,distanceBottom:0}}}}return o()(e,[{key:"getWrapPoints",value:function(){return this.wrapPoints}},{key:"isOrphan",value:function(){return!1}},{key:"startFetchingImg",value:function(){}},{key:"intersect",value:function(e,t){var a=e.left,n=e.top,i=e.right,r=e.bottom,o=new Ua.a(this.rect);return t&&(o.left-=t.x,o.right-=t.x,o.top-=t.y,o.bottom-=t.y),!(o.right<=a||o.bottom<=n||i<=o.left||r<=o.top)}},{key:"isWrap",get:function(){return!0}},{key:"wrap_mode",get:function(){return Ge.e}},{key:"pos",get:function(){return-1}},{key:"len",get:function(){return 0}},{key:"boundaryRect",get:function(){return this.rect}},{key:"boundary",get:function(){return this.rect}},{key:"allowover",get:function(){return!0}},{key:"isDiagonalShape",get:function(){return!0}}]),e}();function Ga(e,t){var a=e.FirstPoint,n=e.SecondPoint;if(a.cellBorder>n.cellBorder){var i=a;a=n,n=i}if(1===a.cellBorder)if(0===a.pos)a=n,n={cellBorder:8,pos:100};else if(2===n.cellBorder){var r=a;a=n,n=r}var o=t.width,s=t.height,c=[];c.push(Fa(a,o,s)),c.push(Fa(n,o,s));var l=p()({},n);for(8===l.cellBorder&&100===l.pos&&(l={cellBorder:1,pos:0});l.cellBorder!==a.cellBorder||l.pos!==a.pos;)l.cellBorder===a.cellBorder?l.pos=a.pos:0!==l.pos?(l.cellBorder*=2,l.pos=0):l.cellBorder*=2,l.cellBorder>8&&(l.cellBorder=1),c.push(Fa(l,o,s));return new Wa(c)}function ja(e,t){var a=e.FirstPoint,n=e.SecondPoint;if(a.cellBorder>n.cellBorder){var i=a;a=n,n=i}if(1===a.cellBorder)if(0==a.pos)a=n,n={cellBorder:8,pos:100};else if(2===n.cellBorder){var r=a;a=n,n=r}var o=t.width,s=t.height,c=[];c.push(Fa(a,o,s)),c.push(Fa(n,o,s));var l=p()({},n);for(1===l.cellBorder&&(l.cellBorder=8,l.pos=100,c.push(Fa(l,o,s)));l.cellBorder!==a.cellBorder||l.pos!==a.pos;)l.cellBorder===a.cellBorder?l.pos=a.pos:0!==l.pos?l.pos=0:(l.cellBorder/=2,l.cellBorder===a.cellBorder&&(l.pos=a.pos)),c.push(Fa(l,o,s));return new Wa(c)}function Va(e,t,a){var n=[];return 0===e?n.push(ja(t[e],a)):e>=t.length?n.push(Ga(t[e-1],a)):(n.push(Ga(t[e-1],a)),n.push(ja(t[e],a))),n}function za(e,t){return e.cellBorder<t.cellBorder?-1:e.cellBorder>t.cellBorder?1:e.pos-t.pos}function Za(e){return 1===e.cellBorder&&0===e.pos?{cellBorder:8,pos:100}:e}function qa(e,t){var a=Za(e.FirstPoint),n=Za(e.SecondPoint),i=Za(t.FirstPoint),r=Za(t.SecondPoint);if(za(a,n)>0){var o=n;n=a,a=o}if(za(i,r)>0){var s=r;r=i,i=s}if(a.cellBorder<i.cellBorder)return-1;if(a.cellBorder>i.cellBorder)return 1;var c=void 0;switch(a.cellBorder){case 1:2===Math.min(n.cellBorder,r.cellBorder)?0===(c=za(i,a))&&(c=za(n,r)):0===(c=za(a,i))&&(c=za(r,n));break;case 2:case 4:0===(c=za(a,i))&&(c=za(r,n));break;default:console.error("Diag cell error start")}return c}var Xa=function(){function e(t,a,n){i()(this,e),this.init(t,a,n)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostUpdater",base:Ma,methodName:"init"},{baseName:"DOCHostUpdater",base:Ma,methodName:"enterHost"},{baseName:"DOCHostUpdater",base:Ma,methodName:"leaveHost"}]}}]),o()(e,[{key:"init",value:function(e,t,a){this.mixin_DOCHostUpdater_init(e,t,a)}},{key:"killTableLine",value:function(e){var t=e.viewPage.layers,a=null,n=this.primeHostAgent().packToolkit.lanePolicy;e.tablecells.forEach((function(e){if(e.cell_page){var t=e.cell_page.nextPack;t&&(e.cell_page.nextPack=t.prevPack=null);var a=e.cell_page.prevPack;a&&(e.cell_page.prevPack=a.nextPack=null)}})),e.tablecells.forEach((function(e){n.dropPackOfCell(e),(a=e.layers)&&t.removeChild(a)})),e.hostPendings.forEach((function(e){e.settled=!0})),e.view.detachTableLine(e)}},{key:"selectScopeInfo",value:function(e){var t=this.sceneUpdater.rootScope(e).to+3*(this.hostLevel-1);return{line:e[t+3],pack:e[t+2],host:e[t]}}},{key:"makeHostStatus",value:function(e){return new _a(e)}},{key:"compatWithMemento",value:function(e,t){var a=t.memento;return a.cells.length===e.tablecells.length&&(!a.cells.some((function(t,a){if(t){var n=e.tablecells[a],i=n.cell_page?n.cell_page:n.diagCell&&n.diagCell.pages[0];return we.e.FIRST===n.merge_type&&(!i||i.rect.height!==t.packHeight)}}))&&(e.rect.height===a.lineHeight&&e.isBrokenAfter===a.isBrokenAfter))}},{key:"getUpperUpdater",value:function(){return this.sceneUpdater.getHostUpdaterAt(this.hostLevel-1)}},{key:"pendingToUpper",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.assign(t,{begin:e.range.begin,end:e.range.end,localHost:e.host,hostUpdater:this.getUpperUpdater()}),this.pageUpdater.viewUpdater.pendingForLocal(t)}},{key:"leaveHost",value:function(e,t){this.calcTableLineHeight(e,t),function(e){if(!e.isBrokenBefore)for(var t=new Aa.a(e.maxBottomMargin,Object(Aa.d)(e)),a=e.tablecells,n=0;n<a.length;++n){var i=a[n];(e.isPackLast||e.isTableLast||i.merge_type===we.e.NONE)&&t.calcOffset(e.rect.height,i)}}(e),Object(Aa.c)(e),this.updateDiagonals(e,t);for(var a=t.outerRowData.cellDatas,n=e.tablecells,i=!1,r=0;r<n.length;++r){var o=n[r],s=o.cell_page;if(s&&s.lines&&s.lines.length>0){var c=s.lines[s.lines.length-1];o.isBrokenAfter=c.layoutType===_.DOCLayoutType.TableLine&&c.isBrokenAfter||c.range.end!==a[r].end,o.isBrokenAfter&&!i&&(i=!0)}}e.isBrokenAfter=t.isBrokenAfter||i,this.breakNextPack(e),this.mixin_DOCHostUpdater_leaveHost(e,t),t.outerStartFromScratch||this.compatWithMemento(e,t)&&!e.shapeInfos||this.pendingToUpper(e)}},{key:"makesureOuterRowData",value:function(e,t){if(!t.outerRowData){var a=t.dataStatus;a.locate(e.range.begin),t.outerRowData=Object(Ea.b)(a.final,a.pos,this.getTableLevel())[0]}}},{key:"makesureOuterLastLineIsBrokenAfter",value:function(e,t){if(void 0===t.outerLastLineIsBrokenAfter){var a=e.parent,n=a.lines.findIndex((function(t){return t===e}));n>0&&(t.outerLastLineIsBrokenAfter=a.lines[n-1].isBrokenAfter)}}},{key:"mementoForTableLine",value:function(e,t){var a={};a.lineHeight=e.rect.height,a.isBrokenAfter=e.isBrokenAfter,a.cells=e.tablecells.map((function(e){return null})),t.memento=a}},{key:"mementoForTableCell",value:function(e,t){var a=t.hostStatus,n={};n.packHeight=e.rect.height,a.memento.cells[t.updatingCellIndex]=n}},{key:"checkHost",value:function(e,t){var a=e.range,n=t.dataStatus.final.specTable.getTapx(a.begin,g.IT.Include,e.layer);return!(!n.good||a.begin!==n.begin||a.end!==n.end)||(e.obsoleted=x.All,this.pendingToUpper(e,{lines:[e]}),!1)}},{key:"enterHost",value:function(e,t){this.mixin_DOCHostUpdater_enterHost(e,t),this.makesureOuterRowData(e,t),this.makesureOuterLastLineIsBrokenAfter(e,t),t.outerStartFromScratch||this.mementoForTableLine(e,t),t.outerEnterFromTable||(t.outerEnterFromTable=e),t.isBrokenAfter=t.outerLastLineIsBrokenAfter}},{key:"compareMentionedPos",value:function(e,t){return e.tableLine,t.tableLine,e.cellPack===t.cellPack?e.lineIndex-t.lineIndex:this.getCellIndex(e.cellPack,e.tableLine)-this.getCellIndex(t.cellPack,t.tableLine)}},{key:"getMentionedPosByScenePath",value:function(e){var t=0,a=this.selectScopeInfo(e),n=a.host,i=a.pack,r=a.line;return t=r?i.lines.indexOf(r):i.lines.length,{tableLine:n,cellPack:i,lineIndex:t}}},{key:"getMentionedPosOfWholePath",value:function(e){return this.getMentionedPosByScenePath(this.pageUpdater.selectScenePath(e))}},{key:"getCellIndex",value:function(e,t){var a=t.tablecells.indexOf(e.parent);return a}},{key:"calcTableLineHeight",value:function(e){var t=Object(Ha.b)(window.APP.data.doc.getDataLogic("final").getChpx(e.range.end-1).prop),a=0;if(!t){var n=!0;if(e.tablecells.forEach((function(t){var i=t.cell_page,r=0;if(i&&i.range?(r=i.rect.height,t.merge_type!==we.e.FIRST&&(n=!1)):t.diagCell&&(n=!1),t.merge_type!==we.e.NONE||t.is_diag_cell||0===r){if(e.isTableLast||t.merge_type===we.e.LAST){var o;if((o=Object(Aa.e)(t.rect.left,e))&&o.cell_page){var s=o.rect.top+o.cell_page.rect.top+o.cell_page.rect.height+o.parent.rect.top-(t.rect.top+t.parent.rect.top);a=Math.max(a,s),n=!1}}}else"T2B"===i.textflow.corX&&"B2T"===i.textflow.corX||(a=Math.max(a,r+i.rect.top))})),e.rowHeight){var i=Object(T.Ti2Px)(e.rowHeight.rowHeight||0);e.rowHeight.exactly?a=i:(a-e.maxTopGap-Aa.b.getTableTopSpacing(e)<i&&(a=i+e.maxTopGap+Aa.b.getTableTopSpacing(e)),a=Math.min(a,this.tableAgent.getUsableHeightOfLine(e)))}a+=e.maxBottomMargin,a+=Object(Aa.d)(e),e.isBrokenBefore&&n&&(a=0)}e.tablecells.forEach((function(e){e.rect.bottom=e.rect.top+a})),e.rect.bottom=e.rect.top+a}},{key:"initHostPolicies",value:function(){var e=this.updaterFactory;this.tableAgent=e.makeTableAgent(this,this.pageUpdater.viewUpdater.view),this.hostAgents=[this.tableAgent]}},{key:"getTableLevel",value:function(){return this.sceneUpdater.getTableLevel()+this.hostLevel}},{key:"breakNextPack",value:function(e){e.isBrokenAfter||e.tablecells.forEach((function(e){if(e.cell_page){var t=e.cell_page.nextPack;t&&(e.cell_page.nextPack=null,t.prevPack=null)}}))}},{key:"moveUpHost",value:function(e){var t=this,a=this.getCellDatas(e);e.tablecells.forEach((function(e,n){!e.cell_page||e.cell_page.lines.length<=0||t.moveUpPack(e.cell_page,a[n])}))}},{key:"moveDownHost",value:function(e,t){var a=this,n=t,i=Aa.b.getTableTopGap(e)+Aa.b.getTableTopSpacing(e);n-=i;var r=this.getCellDatas(e);e.tablecells.forEach((function(e,t){a.moveDownPack(e.cell_page,n,r[t])}))}},{key:"upHostSize",value:function(e){var t=this,a=this.getCellDatas(e);e.tablecells.forEach((function(e,n){!e.cell_page||e.cell_page.lines.length<=0||t.upPackSize(e.cell_page,a[n])}))}},{key:"getCellDatas",value:function(e){var t=e.view.data.doc.getDataLogic("final");return Object(Ea.b)(t,e.range.begin,this.getTableLevel())[0].cellDatas.slice(0)}},{key:"updateDiagonals",value:function(e,t){for(var a=this,n=e.tablecells,i=t.outerReUpdate,r=t.outerMaxUseableHeight,o=void 0,s=function(s){var c=n[s];if(!i&&(c.merge_type===we.e.FIRST||c.merge_type===we.e.MIDDLE))return"continue";var l=!1;if(c.merge_type!==we.e.LAST&&c.merge_type!==we.e.MIDDLE||(c=Object(Aa.e)(c.rect.left,e),l=!0),c&&c.diagCell){var u=void 0,h=c.rect,d=t.host,p=t.outerRowData;if(t.lastTableLine=d,l){var g=c.parent;g.renderInfo&&(g.renderInfo.expired=!0);var f=t.dataStatus,v=Object(Ea.b)(f.final,g.range.pos,a.getTableLevel())[0],m=g.tablecells.indexOf(c);u=v.cells[m].diagonals,h=I.a.initByOriginAndSize(h.origin,{width:h.width,height:i?r:e.rect.bottom-g.rect.top}),t.host=g,t.outerRowData=v}else o||(o=t.outerRowData.cells),u=o[s].diagonals;var y=(u=u.sort(qa))[0].Border.lineWidth,k=h,b=k.width,P=k.height,x={x:y/2,y:Object(T.Px2Ti)(P)-y/2},_=[{start:x,end:x}];u.forEach((function(e){_.push({start:Na(e.FirstPoint,b,P),end:Na(e.SecondPoint,b,P)})})),c.diagCell.diags=_,t.host.conflicting=!0;var C=t.lookaheadPosOfLayers;c.diagCell.pages.forEach((function(n){a.pendingAt(n,0),a.bindPackToolkit(n,t),t.lookaheadPosOfLayers=0;do{t.packUpdater.updatePack(n,t)}while(n.pendingLines&&n.pendingLines.length);if(l){var i=e.rect.bottom-c.parent.rect.top;n.rect.updateByHeight(i)}var r=c.parent.hostPendings.findIndex((function(e){return e.pack===n}));r>=0&&(c.parent.hostPendings[r].settled=!0,c.parent.hostPendings.splice(r,1))})),t.lookaheadPosOfLayers=C,l&&(t.host=d,t.outerRowData=p,delete t.lastTableLine),delete t.host.conflicting}},c=0;c<n.length;++c)s(c)}}]),e}();s.a.mix(Xa,Ma);var Ya=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostUpdater",base:Ma,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.hostUpdaters=[this],this.mixin_DOCHostUpdater_init(e,this,0)}},{key:"makeLinePolicies",value:function(e){var t=e.view;return[this.updaterFactory.makeTableLinePolicy(t,e,e.hostUpdater),this.updaterFactory.makeTextLinePolicy(t,e)]}},{key:"guessHostUpdater",value:function(e){for(var t=this.selectScenePath(e.wholePathForGuess),a=this.getHostLevelByScenePath(t),n=null;a>0;--a){var i=(n=this.getHostUpdaterAt(a)).selectScopeInfo(t).host;if(g.IT.containTest(i.range,e))return n}return this}},{key:"selectHostUpdaterByPack",value:function(e){return this.getHostUpdaterAt(this.getHostLevelByScenePath(e.getScenePath()))}},{key:"selectOuterUpdater",value:function(e){return this.pageUpdater.selectHostUpdaterByWholePath(e.getWholePath())}},{key:"getTableLevel",value:function(){return 0}},{key:"getHostLevelByScenePath",value:function(e){var t=this.rootScope(e);return Math.floor((e.length-t.to)/3)}},{key:"getHostUpdaterAt",value:function(e){return this.hostUpdaters[e]||(this.hostUpdaters[e]=new Xa(this.pageUpdater,this,e)),this.hostUpdaters[e]}},{key:"pendingToOuter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.outer;Object.assign(t,{begin:a.range.begin,end:a.range.end,localHost:a.host,hostUpdater:this.selectOuterUpdater(a)}),this.pageUpdater.viewUpdater.pendingForLocal(t)}}]),e}();s.a.mix(Ya,Ma);var Ka=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCSceneUpdater",base:Ya,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.viewUpdater=e,this.mixin_DOCSceneUpdater_init(this)}},{key:"initHostPolicies",value:function(){this.pageAgent=this.updaterFactory.makePageAgent(this,this.viewUpdater.view),this.hostAgents=[this.pageAgent]}},{key:"killPage",value:function(e){this.hostAgents.forEach((function(t){t.packToolkit.lanePolicy.dropPacksInHost(e)}))}},{key:"makeLinePolicies",value:function(e){var t=e.view;return[this.updaterFactory.makeTextLinePolicy(t,e)]}},{key:"getHostUpdaterAt",value:function(e){return this.hostUpdaters[e]}},{key:"updatePage",value:function(e,t){this.enterPage(e,t);var a=!1;return e.hostPendings.length>0&&(this.updateHost(e,t),a=!0),t.hasUpdate=a,this.leavePage(e,t),a}},{key:"enterPage",value:function(e,t){}},{key:"leavePage",value:function(e,t){var a=e.view;e.rect.bottom=e.rect.top+e.page.rect.height+a.verticalPadding}},{key:"getTableLevel",value:function(){return 0}},{key:"guessSceneUpdater",value:function(e){return this}},{key:"selectHostUpdaterByWholePath",value:function(e){var t=this.getHostLevelByScenePath(e[0]);return this.getHostUpdaterAt(t)}},{key:"selectScenePath",value:function(e){return e[0]}},{key:"rootScope",value:function(){return{from:1,to:3}}},{key:"mateByScenePath",value:function(e){return this.selectScopeInfo(e).pack instanceof Ia}},{key:"selectScopeInfo",value:function(e){return{line:e[3],pack:e[2],host:e[1]}}},{key:"makeHostStatus",value:function(e){return new Sa(e)}},{key:"usablePendingPage",value:function(e,t,a){return!1}},{key:"reuseUpdatingPage",value:function(e,t){return!1}},{key:"compatWithNextPage",value:function(e,t){return!1}},{key:"pendingToHost",value:function(e,t){var a=t.hostPendings;if(a.length<=0){var n=Ra.make(e,t,this);a.push(n)}}}]),e}(),Ja=Ka;s.a.mix(Ka,Ya);var Qa=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCViewUpdater",base:w,methodName:"init"},{baseName:"DOCViewUpdater",base:w,methodName:"clearAll"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCViewUpdater_init(e),this.view=e.typoinfo.commentView,this.updaterFactory=new Pa,this.commentPageUpdater=new Ja(this),this.pageUpdaters=[this.commentPageUpdater]}},{key:"clearAll",value:function(e){this.mixin_DOCViewUpdater_clearAll(e);var t=this.view;this.dropPages(t,Object.values(t.comment_pages)),Object.keys(t.comment_pages).forEach((function(e){return t.removeCommentPage(e)}))}},{key:"update",value:function(e){var t=this.view,a=this.makeViewStatus(t,e);return this.pushUpdatingPage(t,a),this.updatePage(t,a),this.pageDone(t,a),a.updatingPage}},{key:"updateToPosition",value:function(e){var t=this.document.comments.getCommentByBookmarkPos(e);return t&&this.view.getCommentPage(t.rc_id)}},{key:"makeViewStatus",value:function(e,t){return{commentId:t,dataStatus:new f.a(this.data,this.data.glyphpool)}}},{key:"pushUpdatingPage",value:function(e,t){e.comment_pages[t.commentId]?t.updatingPage=e.comment_pages[t.commentId]:(t.updatingPage=new Ia(e,0),this.commentPageUpdater.pendingAt(t.updatingPage.page,0))}},{key:"updatePage",value:function(e,t){var a=t.updatingPage;this.commentPageUpdater.updatePage(a,t)}},{key:"pageDone",value:function(e,t){var a=t.updatingPage;a.isUpdate=!0,e.composeProcessLayout(a)}},{key:"prepareIdle",value:function(){}},{key:"selectPageUpdater",value:function(e){return this.commentPageUpdater}},{key:"onInsertText",value:function(e,t,a,n,i){this.view.textLineRanges.expand(t,a.length),this.view.tableLineRanges.expand(t,a.length)}},{key:"onDeleteText",value:function(e,t,a){this.view.textLineRanges.remove(t,a.length),this.view.tableLineRanges.remove(t,a.length)}},{key:"onSectionxChanged",value:function(e,t){}},{key:"onSettingsChanged",value:function(){}},{key:"onRevisionsShowMarkupChanged",value:function(){}},{key:"onBeforeInsertText",value:function(e,t,a,n){var i={begin:t,end:t,lines:[]};this.pendingByOutdatedRange(i)}},{key:"onBeforeDeleteText",value:function(e,t,a){var n={begin:t,end:t+a.length,lines:[]};this.pendingByOutdatedRange(n)}},{key:"dropPages",value:function(e,t){var a=this;t.forEach((function(e){a.commentPageUpdater.killPage(e)}))}},{key:"pendingByOutdatedField",value:function(e){}}]),e}(),$a=Qa;s.a.mix(Qa,w);var en=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLanePolicy",base:Gt,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCLanePolicy_init(e)}},{key:"freePack",value:function(e){}},{key:"dropPacksInHost",value:function(e){var t=this.hostAgent.packToolkit.packUpdater,a=e.snippetPack;t.killPack(a),this.freePack(a)}},{key:"getPacksInHost",value:function(e){return[e.snippetPack]}},{key:"forcedToAcceptUpdatingLine",value:function(e,t){var a=e.host.outer,n=a.parent;return e.lines.length<=1&&Math.round(n.rect.top)==Math.round(n.viewPage.inner_rect.top)&&0===n.lines.findIndex((function(e){return e===a}))}}]),e}();s.a.mix(en,Gt);var tn=a(5717),an=a(1804),nn=function(){function e(){i()(this,e)}return o()(e,null,[{key:"makeEmbedCard",value:function(t,a,n,i){var r={begin:t.begin,end:t.end},o=a.data.doc,s=o.getSubDocType(t.begin),c=o.getEmbedDrawing(t.begin).shapeTreeType,l=new tn.a({range:r,anchor:t,subDocType:s,shapeTreeType:c,viewPage:n.viewPage,line:n});return l.initTextbox(),l.has_textbox&&(l.updater=i.getTextboxUpdater(),l.updater.pendingToHost(l.textbox_page,l),l.updater.updateTextBox(a,l)),l.isGroup&&l.childShapes&&l.childShapes.forEach((function(t){e.updateShapeTextbox(t,i,a)})),l.updateInnerBoundary(),l.startFetchingImg(),l}},{key:"updateShapeTextbox",value:function(t,a,n){t.isGroup?t.childShapes.forEach((function(t){e.updateShapeTextbox(t,a,n)})):t.textbox_page&&(t.updater=a.getTextboxUpdater(),t.updater.pendingToHost(t.textbox_page,t),t.updater.updateTextBox(n,t))}},{key:"reuseEmbedCard",value:function(e,t,a,n,i){return e.reset(t),e.has_textbox&&(e.updater=i.getTextboxUpdater(),e.isMovingUp=!0,e.conflicting=!0,e.updater.moveHost(e),e.updater.updateTextBox(a,e),delete e.isMovingUp,e.conflicting=!1),e}},{key:"getShapeTreeType",value:function(e,t){var a=e.getSubDocType(t.begin),n=e.anchors.findAnchor(t.begin);return t.shapeData.hasTextbox||n?a==l.HeaderFooter||a==l.TextboxInHF?an.b:an.d:a==l.HeaderFooter||a==l.TextboxInHF?an.a:an.c}}]),e}(),rn=a(908),on=function(){function e(t){i()(this,e),this.line=t,t instanceof D.a?this.pack=t.parent.parent:this.pack=t.parent,this.viewPage=this.pack.viewPage}return o()(e,[{key:"getCharRect",value:function(e){var t=e.begin-1,a=this.line;if(a){var n=this.pack.parent,i=rn.a.transvertPositionFromNode2Target(a,n);a.composeProcess&&a.composeProcess(!0,i),a.isUpdateRequired=!0;var r=a.glyphGroupInfos;if(r&&r.length>0)for(var o=a.range.pos,s=0,c=r.length;s<c;++s){var l=r[s];if(t<l.endOffset+o){var u=t-l.beginOffset-o,h=l.x,d=l.y;if(u>0&&l.widths)for(var p=l.widths,g=0;g<u;++g)h+=p[g];return new Ua.a({left:h,right:h,top:d,bottom:d})}}}return this.colRect}},{key:"getLineRect",value:function(e){var t=this.pack.parent,a=rn.a.transvertPositionFromNode2Target(this.pack,t),n=a.x+e.rect.left,i=a.y+(void 0!==e.originTop?e.originTop:e.rect.top),r=n+e.rect.width,o=i+e.rect.height;return new Ua.a({left:n,top:i,right:r,bottom:o})}},{key:"getVisiblePageHeight",value:function(){if(this.pack.layoutType!==_.DOCLayoutType.CellPage)return this.viewPage.outer_rect.height;var e=this.pack.parent.parent.rowHeight;return e&&e.exactly?Object(T.Ti2Px)(e.rowHeight||0):this.viewPage.inner_rect.height}},{key:"isInTable",value:function(){return this.pack.layoutType===_.DOCLayoutType.CellPage}},{key:"parent",get:function(){return this.pack.parent}},{key:"coorSystem",get:function(){return null}},{key:"upper",get:function(){return this.pack.layoutType===_.DOCLayoutType.CellPage||this.pack.host.layoutType===_.DOCLayoutType.SnippetScene?this.pack.parent:this.viewPage}},{key:"section",get:function(){return this.viewPage.section}},{key:"pageCoreRect",get:function(){var e=void 0;if(this.pack.layoutType===_.DOCLayoutType.CellPage){var t=this.pack.rect,a=t.left,n=t.right,i=t.top;e=new Ua.a({left:a,top:i,right:n,bottom:i})}else e=new Ua.a(this.viewPage.inner_rect);return e}},{key:"pageCoreRectWithoutHF",get:function(){return this.viewPage.coreRectWithoutHF}},{key:"pageRect",get:function(){var e=void 0,t=void 0;return this.pack.layoutType===_.DOCLayoutType.CellPage?(e=this.pack.parent.rect.width,t=this.pack.parent.rect.height):(e=this.viewPage.outer_rect.width,t=this.viewPage.outer_rect.height),new Ua.a({left:0,top:0,right:e,bottom:t})}},{key:"leftMargin",get:function(){return this.viewPage.inner_rect.left}},{key:"topMargin",get:function(){return this.viewPage.inner_rect.top}},{key:"rightMargin",get:function(){var e=this.viewPage.inner_rect;return this.viewPage.outer_rect.width-e.right}},{key:"bottomMargin",get:function(){var e=this.viewPage.inner_rect;return this.viewPage.outer_rect.height-e.bottom}},{key:"insideIsTop",get:function(){return this.viewPage.layout_index%2==0}},{key:"insideIsLeft",get:function(){return this.viewPage.layout_index%2==0}},{key:"insideHorzMarginRect",get:function(){var e=this.viewPage.outer_rect,t=e.height,a=this.insideIsLeft,n=a?0:this.viewPage.inner_rect.right,i=a?this.viewPage.inner_rect.left:e.width;return new Ua.a({left:n,top:0,bottom:t,right:i})}},{key:"outsideHorzMarginRect",get:function(){var e=this.viewPage.outer_rect,t=e.height,a=this.insideIsLeft,n=a?this.viewPage.inner_rect.right:0,i=a?e.width:this.viewPage.inner_rect.left;return new Ua.a({left:n,top:0,bottom:t,right:i})}},{key:"insideVertMarginRect",get:function(){var e=this.viewPage.outer_rect,t=e.width,a=this.insideIsTop,n=a?0:this.viewPage.inner_rect.bottom,i=a?this.viewPage.inner_rect.top:e.height;return new Ua.a({left:0,top:n,bottom:i,right:t})}},{key:"outsideVertMarginRect",get:function(){var e=this.viewPage.outer_rect,t=e.width,a=this.insideIsTop,n=a?this.viewPage.inner_rect.bottom:0,i=a?e.height:this.viewPage.inner_rect.top;return new Ua.a({left:0,top:n,bottom:i,right:t})}},{key:"leftMarginRect",get:function(){var e=0,t=this.leftMargin;return this.pack.layoutType===_.DOCLayoutType.CellPage&&(t=this.pack.parent.rect.left,e=this.pack.rect.left),new Ua.a({left:e,top:0,bottom:0,right:t})}},{key:"rightMarginRect",get:function(){var e=this.viewPage.inner_rect.right,t=e+this.rightMargin;return this.pack.layoutType===_.DOCLayoutType.CellPage&&(t=this.pack.parent.rect.right,e=this.pack.rect.right),new Ua.a({left:e,top:0,bottom:0,right:t})}},{key:"topMarginRect",get:function(){var e=this.topMargin;return new Ua.a({left:0,top:0,right:0,bottom:e})}},{key:"bottomMarginRect",get:function(){var e=this.viewPage.inner_rect.bottom,t=e+this.bottomMargin;return new Ua.a({left:0,top:e,right:0,bottom:t})}},{key:"colRect",get:function(){var e=this.pack.rect,t=e.top,a=e.right,n=e.bottom,i=e.left;return this.line.sublines&&(i+=this.line.sublines[0].rect.left),new Ua.a({left:i,top:t,right:a,bottom:n})}},{key:"paragraphRect",get:function(){for(var e=this.pack.lines,t=this.line,a=e.indexOf(t);a>0&&!t.is_para_first;)t=e[--a];return this.getLineRect(t)}},{key:"lineRect",get:function(){return this.getLineRect(this.line)}},{key:"lastCard",get:function(){return this.line.layoutType===_.DOCLayoutType.SnippetLine?this.line.prevLine&&this.line.prevLine.card:null}}]),e}(),sn=on,cn=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.pack=e.parent,a.host=e.host,a.host.isSnippetCard&&(a.pack=e.host.outer.parent),a.viewPage=a.pack.viewPage,a}return ee()(t,e),o()(t,[{key:"paragraphRect",get:function(){return this.lineRect}},{key:"upper",get:function(){return this.pack.parent}},{key:"lineRect",get:function(){if(this.host.isSnippetCard){var e=this.line,t=rn.a.transvertPositionFromNode2Target(this.line.parent,this.pack.parent),a=t.x+e.rect.left,n=t.y+(void 0!==e.originTop?e.originTop:e.rect.top),i=a+e.rect.width,r=n+e.rect.height;return new Ua.a({left:a,top:n,right:i,bottom:r})}return this.getLineRect(this.line)}}]),t}(on),ln=a(7213),un=T.Ti2Px,hn=function(){function e(){i()(this,e)}return o()(e,null,[{key:"makeShapeCard",value:function(t,a,n,i,r,o){var s=new Le.a({outer:i,viewPage:r,range:{begin:t.begin,end:t.end},coorSystem:o,anchor:t});return s.subdoc_type=n.getSubDocType(t.begin),a?(e.calcShapeCardRect(s,a),s.initTextbox(),s.relativeInfo=a,s):s}},{key:"resetShapeCard",value:function(t,a,n,i,r,o,s){return t.reset({outer:r,viewPage:o,range:{begin:a.begin,end:a.end},coorSystem:s,anchor:a}),t.coor_pos2view=null,n&&(e.calcShapeCardRect(t,n),t.initTextbox(),t.relativeInfo=n),t}},{key:"makesureTextbox",value:function(t,a,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t.isGroup&&e.updateShpaeTextbox(t,a,i),t.has_textbox)if(r)t.isMovingUp=!0,t.conflicting=!0,a.moveHost(t),a.updateTextBox(i,t),t.updater=a,delete t.isMovingUp,t.conflicting=!1;else{var o=t.anchor,s=o.shapeData.textRect,c=e.calcTextBoxPackRect(t,i.document,n,s);t.textbox_page.rect=c,t.rawTextRect=s,t.updater=a,a.pendingToHost(t.textbox_page,t),a.updateTextBox(i,t)}}},{key:"updateShpaeTextbox",value:function(t,a,n){t.isGroup?t.childShapes.forEach((function(t){e.updateShpaeTextbox(t,a,n)})):t.textbox_page&&(t.updater=a,t.updater.pendingToHost(t.textbox_page,t),t.updater.updateTextBox(n,t))}},{key:"calcShapeCardRect",value:function(t,a){var n=t.anchor,i=n.shapeData.textRect,r=e.getWidth(n,a),o=e.getHeight(n,a);if(o=Math.max(1,o),r=Math.max(1,r),n.shapeData.hasArtWord&&i&&(t.isAutoSize||!t.isWrapText)&&i){var s=I.a.initByDocRect(i),c=n.shapeData.padding;r=s.width+un(c.leftPadding+c.rightPadding+n.effectExtentLeft+n.effectExtentRight),o=s.height+un(c.topPadding+c.bottomPadding+n.effectExtentTop+n.effectExtentBottom)}var l=I.a.initByOriginAndSize({x:0,y:0},{width:r,height:o});return t.setRect(l),t.sizeFromAnchor=l.size,t.rect}},{key:"adjustShapeCardRect",value:function(t,a){var n=t.anchor,i=t.rect,r=i.left,o=i.top,s=t.rect,c=s.width,l=s.height;if(t.offset(-r,-o),r=e.getLeft(n,a,c),o=e.getTop(n,a,l),t.needAlignToOriginCenter)r=r+t.originWidth/2-c/2,o=o+t.originHeight/2-l/2;else if(t.needAdjustForRotate90){var u=r+t.originWidth/2,h=o+t.originHeight/2;r=u-t.originHeight/2+l/2-c/2,o=h-t.originWidth/2+c/2-l/2}t.offset(r,o),0!==t.rotation&&(t.layoutRect=new I.a({raw_rect:t.rect}),Object(Oe.b)(t.rotation,t.layoutRect));var d=t.rect,p=d.left+(t.innerBoundary?t.innerBoundary.left:0),g=d.top+(t.innerBoundary?t.innerBoundary.top:0),f=p+(t.innerBoundary?t.innerBoundary.width:d.width),v=g+(t.innerBoundary?t.innerBoundary.height:d.height);t.boundary={left:p-un(n.distanceLeft),top:g-un(n.distanceTop),right:f+un(n.distanceRight),bottom:v+un(n.distanceBottom)},t.upper=a.upper}},{key:"calcTextBoxPackRect",value:function(e,t,a,n){var i=void 0,r=e.textbox_page.rect;i=I.a.initByRawRect(r);var o=e.textbox_page.textflow;if("L2R"===o.corX?i.updateByHeight(Number.MAX_SAFE_INTEGER):i.updateByWidth(Number.MAX_SAFE_INTEGER),!e.isWrapText)if("L2R"===o.corX){var s=a.pageCoreRect.width;if(e.subdoc_type===l.MainText){var c=t.sections.getSection(e.begin);if(c){s=Number.MAX_SAFE_INTEGER;for(var u=c.getColumnsCount(),h=0;h<u;++h){var d=c.getColumnItem(h).columnWidth;s=Math.min(s,d)}}}i.updateByWidth(s)}else{var p=a.pageCoreRect.height;i.updateByHeight(p)}return i}},{key:"getWidth",value:function(e,t){var a=void 0;if(0!==e.pctSizeHorzRel)switch(e.sizeHorzRel){case 0:a=e.pctSizeHorzRel*t.pageCoreRect.width/1e3;break;case 1:a=e.pctSizeHorzRel*t.pageRect.width/1e3;break;case 2:a=e.pctSizeHorzRel*t.leftMargin/1e3;break;case 3:a=e.pctSizeHorzRel*t.rightMargin/1e3;break;case 4:a=e.pctSizeHorzRel*t.insideHorzMarginRect.width/1e3;break;case 5:a=e.pctSizeHorzRel*t.outsideHorzMarginRect.width/1e3;break;default:a=un(e.sizeHorz)}else a=un(e.sizeHorz);return a}},{key:"getHeight",value:function(e,t){var a=void 0;if(0!==e.pctSizeVertRel)switch(e.sizeVertRel){case 0:a=e.pctSizeVertRel*t.pageCoreRect.height/1e3;break;case 1:a=e.pctSizeVertRel*t.pageRect.height/1e3;break;case 2:a=e.pctSizeVertRel*t.topMargin/1e3;break;case 3:a=e.pctSizeVertRel*t.bottomMargin/1e3;break;case 4:a=e.pctSizeVertRel*t.insideVertMarginRect.height/1e3;break;case 5:a=e.pctSizeVertRel*t.outsideVertMarginRect.height/1e3;break;default:a=un(e.sizeVert)}else a=un(e.sizeVert);return a}},{key:"getLeft",value:function(e,t,a){var n=void 0;switch(e.horzRel){case 1:n=t.pageRect;break;case 2:n=t.colRect;break;case 3:n=t.getCharRect(e);break;case 4:n=t.leftMarginRect;break;case 5:n=t.rightMarginRect;break;case 6:n=t.insideHorzMarginRect;break;case 7:n=t.outsideHorzMarginRect;break;case 0:default:n=t.pageCoreRect}var i=void 0;switch(e.horzAlign){case ln.d:i=n.left;break;case ln.b:i=(n.left+n.right)/2-a/2;break;case ln.f:i=n.right-a;break;case ln.c:i=t.insideIsLeft?n.left:n.right-a;break;case ln.e:i=t.insideIsLeft?n.right-a:n.left;break;case ln.a:default:i=-10001===e.pctRelHorzPos?n.left+un(e.relHorzPos):n.left+n.width*e.pctRelHorzPos/1e3}return e.wrapMode!==Ge.b&&e.wrapMode!==Ge.a&&(i=Math.min(i,t.pageRect.right-a),i=Math.max(0,i)),i}},{key:"getTop",value:function(e,t,a){var n=void 0;switch(e.vertRel){case 1:n=t.pageRect;break;case 2:n=t.paragraphRect;break;case 3:n=t.lineRect;break;case 4:n=t.topMarginRect;break;case 5:n=t.bottomMarginRect;break;case 6:n=t.insideVertMarginRect;break;case 7:n=t.outsideVertMarginRect;break;case 0:default:n=t.pageCoreRect}var i=void 0;switch(e.vertAlign){case 1:i=n.top;break;case 2:i=(n.top+n.bottom)/2-a/2;break;case 3:i=n.bottom-a;break;case 4:i=t.insideIsTop?n.top:n.bottom-a;break;case 5:i=t.insideIsTop?n.bottom-a:n.top;break;case 6:default:i=-10001===e.pctRelVertPos?n.top+un(e.relVertPos):n.top+n.height*e.pctRelVertPos/1e3}return e.wrapMode!==Ge.b&&e.wrapMode!==Ge.a&&(i=Math.min(i,t.pageRect.bottom-a),i=Math.max(0,i)),i}}]),e}(),dn=(0,T.Ti2Px)(.5),pn=function(){function e(){i()(this,e)}return o()(e,[{key:"init",value:function(e){this.layers=e}},{key:"update",value:function(e){var t=this;this.notallowWrapCards=[],this.notallowNowrapCards=[],this.allWrapCards=[],this.allNoWrapCards=[],this.allowFrameCards=[],e.topCards.forEach((function(e){e.isDiagonalShape||(e.allowover||(e.isWrap?t.notallowWrapCards.push(e):t.notallowNowrapCards.push(e)),e.isWrap?t.allWrapCards.push(e):t.allNoWrapCards.push(e))})),e.bottomCards.forEach((function(e){e.allowover||t.notallowNowrapCards.push(e),t.allNoWrapCards.push(e)})),e.textframes.forEach((function(e){e.allowover?!e.isWrapTable&&e.isDropCap&&t.allowFrameCards.push(e):t.notallowWrapCards.push(e),t.allWrapCards.push(e)}))}},{key:"commit",value:function(e){this.update(this.layers);var t=!e.allowover;e.isWrap?(t?this._hitCards(e,this.allWrapCards):(this._hitCards(e,this.notallowWrapCards),e.isSnippetCard&&!e.isWrapTable&&e.isDropCap&&this._hitCards(e,this.allowFrameCards)),this.allWrapCards.push(e),t&&this.notallowWrapCards.push(e)):(t?this._hitCards(e,this.allNoWrapCards):this._hitCards(e,this.notallowNowrapCards),this.allNoWrapCards.push(e),t&&this.notallowNowrapCards.push(e))}},{key:"_hitCards",value:function(e,t){var a=this,n=new Ua.a(e.boundary),i=n.width,r=n.height,o=this.innerRect.right,s=void 0,c=!0,l=void 0,u=function(t){var u=t.boundary;if(t.pos<e.pos&&n.intersect(u)){if(c)n.left=u.right+dn,n.right=n.left+i,n.right>o&&(n.init(e.boundary),c=!1,l=(a.innerRect.bottom+a.outerRect.height)/2);else{if(n.top=u.bottom+dn,n.top>l)return n.top=l,n.bottom=n.top+r,!0;n.bottom=n.top+r}return s=!0,!0}};do{s=!1,t.some(u)}while(s);var h=n.left-e.boundary.left,d=n.top-e.boundary.top;0===h&&0===d||e.offset(h,d)}},{key:"innerRect",get:function(){var e=this.layers.parent;return e.layoutType===_.DOCLayoutType.LayoutPage?e.inner_rect:e.layoutType===_.DOCLayoutType.Cell?e.cell_page?e.cell_page.rect:e.diagCell&&e.diagCell.pages[0].rect:e.host.layoutType===_.DOCLayoutType.SnippetScene?e.viewPage.inner_rect:null}},{key:"outerRect",get:function(){var e=this.layers.parent;return e.layoutType===_.DOCLayoutType.LayoutPage?e.outer_rect:e.layoutType===_.DOCLayoutType.Cell?e.rect:e.host.layoutType===_.DOCLayoutType.SnippetScene?e.viewPage.outer_rect:null}}]),e}(),gn=a(1252),fn=function(){function e(t,a){i()(this,e),this.hostAgent=t,this.parent=a}return o()(e,[{key:"markPendingCards",value:function(e,t,a){var n=this;if(this.layers&&this.layers.layoutCards){Nt.collectCardsAfterPos(this.layers.layoutCards,a,(function(a){var i=t.hostStatus.enterHostStatus;a.isWrap&&a.pos<i.lookaheadPosOfLayers||(n._removeCard(n.layers,a),n.parent._detachShape(e,t,a),a.layouter.host.layers.removeCard(a),a.layouter.shapeCache&&delete a.layouter.shapeCache[a.pos])}))}}},{key:"detachShape",value:function(e,t,a){console.assert(!a.layoutInCell&&e.host.isScene()),a.layouter.shapeCache||(a.layouter.shapeCache={}),a.layouter.shapeCache[a.pos]=a,this.layers.removeCard(a),e.host.conflicting=!0}},{key:"markPendingCardsBetween",value:function(e,t,a){var n=this;if(this.layers&&this.layers.layoutCards){Nt.collectCardsBetween(this.layers.layoutCards,a,(function(a){var i=t.hostStatus.enterHostStatus;a.isWrap&&a.pos<i.lookaheadPosOfLayers||(n.parent._detachShape(e,t,a),a.layouter.host.layers.removeCard(a))}))}}},{key:"mateOf",value:function(e,t){return!t.layoutInCell&&this.hostAgent.hostUpdater.getTableLevel()}},{key:"makeRelativeInfo",value:function(e,t,a){return new cn(a)}},{key:"createAndAdd",value:function(e,t,a){var n=this;if(a.layoutType!=gn.c.TableLine)return!1;if(a.shapeInfos&&a.shapeInfos.length){if(a.host.layoutType==gn.c.TableLine){var i=t.hostStatus.outerEnterFromTable;i.shapeInfo||(i.shapeInfo=[]),i.shapeInfo=i.shapeInfo.concat(a.shapeInfos)}else{var r=this.makeRelativeInfo(e,t,a);a.shapeInfos.forEach((function(e){n.parent.add(e,r)}))}delete a.shapeInfos}if(a.shapeCache){var o=this.makeRelativeInfo(e,t,a);for(var s in a.shapeCache){var c=a.shapeCache[s];this.parent.add({shape:c},o)}delete a.shapeCache}return!0}},{key:"create",value:function(e,t,a,n){if(!this.mateOf(e,a))return null;var i=e.hostStatus.enterHostStatus;if(!(a.wrapMode!==Ge.b&&a.pos<i.lookaheadPosOfLayers)){var r=this.parent._getShapeCache(e)[a.pos],o=!1;return r?r=hn.resetShapeCard(r,a,null,n,t.line,t.viewPage,t.coorSystem):(r=hn.makeShapeCard(a,null,n,t.line,t.viewPage,t.coorSystem),o=!0),r.layoutInCell=!1,{shape:r,isNew:o}}}},{key:"update",value:function(e,t,a){var n=t.shape,i=t.isNew;hn.resetShapeCard(n,n.anchor,a,document,n.outer,a.viewPage,a.coorSystem),n.layouter=a.line;var r=this.hostAgent.pageUpdater.getTextboxUpdater(),o=!i&&n.textbox_page&&n.textbox_page.lines.length;hn.makesureTextbox(n,r,a,e.dataStatus,o),n.updateInnerBoundary()}},{key:"commit",value:function(e,t,a,n){return!a.shape.layoutInCell&&(e.host.layoutType==gn.c.TableLine?(this._commitToRoot(e,t,a),!0):(this.update(t,a,a.relativeInfo),!1))}},{key:"_commitToRoot",value:function(e,t,a){var n=t.hostStatus.outerEnterFromTable;console.assert(n&&n.isInTable);var i=a.shape,r=this.parent._getShapeCache(t);this._commitCard(this.layers,i),delete r[i.pos],n.shapeInfos||(n.shapeInfos=[]),n.shapeInfos.push(a)}},{key:"_commitCard",value:function(e,t){e.layoutCards||(e.layoutCards=[]),e.layoutCards.push(t)}},{key:"_removeCard",value:function(e,t){var a=e.layoutCards;if(!a)return!1;var n=a.indexOf(t);return n>=0&&(a.splice(n,1),!0)}},{key:"layers",get:function(){return this.parent.layers}}]),e}(),vn=a(7201),mn=T.Ti2Px,yn=mn(366),kn=function(){function e(){i()(this,e)}return o()(e,null,[{key:"calcCardRect",value:function(e,t){var a=e.frameProp,n=this.getWidth(e,a,t),i=this.getHeight(e,a),r=this.getLeft(t,a,n)+this.offsetRule(e,t),o={vertRel:a.vertAnchor,vertPos:a.vertPos||0},s=this.getTop(t,o,i),c={left:r,top:s,right:r+n,bottom:s+i};e.setRect(c);var l={};l.left=c.left-mn(a.horiSpace||0),l.right=c.right+mn(a.rightSpace||0),l.top=c.top-mn(a.vertSpace||0),l.bottom=c.bottom+mn(a.bottomSpace||0),e.boundary=l}},{key:"adjustCardPos",value:function(e){var t=e.rect.top,a=e.rect.height;e.offset(0,-t);var n=e.frameProp,i=new sn(e.outer),r={vertRel:n.vertAnchor,vertPos:n.vertPos||0};t=this.getTop(i,r,a),e.offset(0,t)}},{key:"adjustPackByCard",value:function(e){if(!e.isWrapTable&&e.snippetPack){var t=e.snippetPack,a=e.rect.width,n=e.rect.height;t.rect.updateBySize(a,n),t.lines.forEach((function(e){e.rect.updateByWidth(a-e.rect.left)}))}}},{key:"adjustChildCards",value:function(e){var t=e.layers;t&&(t.topCards&&t.topCards.forEach((function(e){hn.adjustShapeCardRect(e,e.relativeInfo)})),t.bottomCards&&t.bottomCards.forEach((function(e){hn.adjustShapeCardRect(e,e.relativeInfo)})))}},{key:"getWidth",value:function(e,t,a){var n=void 0;if(a.lastCard)n=a.lastCard.rect.width;else if(n=mn(t.width||0),!t.widthRule||"auto"===t.widthRule){var i=e.snippetPack;if(!i)return 0;if(e.outer.isWrapTable||1===i.lines.length){if(0===(n=i.getTextRect().width))n=mn(181)}else n=i.packCaps.width}return n}},{key:"getHeight",value:function(e,t){var a=mn(t.height||0);if(!t.heightRule||"auto"===t.heightRule||"atLeast"===t.heightRule){var n=e.snippetPack,i=n&&n.getTextRect().bottom||0;a=Math.max(a,i)}return a}},{key:"getLeft",value:function(e,t,a){var n=void 0;if(e.lastCard)n=e.lastCard.rect.left;else switch(t.horiAnchor){case 0:n=this.calcHoriPos_RelMargin(e,t,a);break;case 1:n=this.calcHoriPos_RelPage(e,t,a);break;case 2:default:n=this.calcHoriPos_RelColumn(e,t,a)}return e.isInTable()&&(n=Math.min(n,e.pageRect.right-a)),n=Math.max(n,0)}},{key:"getTop",value:function(e,t,a){var n=void 0;if(e.lastCard)n=e.pageCoreRect.top;else{var i=t.vertRel,r=t.vertPos;switch(i){case 1:n=this.calcVertPos_RelPage(r,a,e);break;case 2:n=this.calcVertPos_RelPara(r,a,e);break;case 0:default:n=this.calcVertPos_RelMargin(r,a,e)}}var o=e.getVisiblePageHeight()-a;return n=Math.max(Math.min(n,o),0)}},{key:"calcVertPos_RelMargin",value:function(e,t,a){var n=0,i=a.pageCoreRectWithoutHF;switch(e){case 32769:n=i.top;break;case 32770:n=i.bottom-t;break;case 32771:n=i.top+(i.height-t)/2;break;case 32772:n=a.insideIsTop?i.top:i.bottom-t;break;case 32773:n=a.insideIsTop?i.bottom-t:i.top;break;default:n=i.top+(e?mn(e):0)}return n}},{key:"calcVertPos_RelPage",value:function(e,t,a){var n=0,i=a.pageRect;switch(e){case 32769:n=i.top;break;case 32770:n=i.bottom-t;break;case 32771:n=i.top+(i.height-t)/2;break;case 32772:var r=0,o=a.section.getPageHeader2Top();r=a.viewPage.isDecorativePage?yn:mn(o)/2,n=a.insideIsTop?r:i.height-t-r;break;case 32773:var s=0,c=a.section.getPageFooter2Bottom();s=a.viewPage.isDecorativePage?yn:mn(c)/2,n=a.insideIsTop?i.height-t-s:s;break;default:n=i.top+(e?mn(e):0)}return n}},{key:"calcVertPos_RelPara",value:function(e,t,a){return a.paragraphRect.top+this.calcVertOffset_RelPara(e)}},{key:"calcVertOffset_RelPara",value:function(e){switch(e){case 32769:case 32770:case 32771:case 32772:case 32773:return 0;default:return e?mn(e):0}}},{key:"calcHoriPos_RelColumn",value:function(e,t,a){var n=0,i=this._transformHoriAlign(t.horiAlign,t.horiPos,!!(e.viewPage.pageNum%2)),r=e.colRect;switch(i){case vn.d:n=r.left;break;case vn.f:n=r.right-a+this._getHoriOffset(e.line.card);break;case vn.b:n=r.left+(r.width-a)/2;break;default:n=r.left+mn(t.horiPos||0)}return n}},{key:"calcHoriPos_RelPage",value:function(e,t,a){var n=0,i=this._transformHoriAlign(t.horiAlign,t.horiPos,!!(e.viewPage.pageNum%2)),r=e.pageCoreRect,o=e.pageRect;switch(i){case vn.d:n=r.left>a+mn(t.horiSpace||0)?r.left-a-mn(t.horiSpace||0):o.left;break;case vn.f:n=o.right-r.right>a+mn(t.rightSpace||0)?r.right+mn(t.rightSpace||0):o.right-a+this._getHoriOffset(e.line.card);break;case vn.b:n=(o.width-a)/2;break;default:n=o.left+mn(t.horiPos||0)}return n}},{key:"calcHoriPos_RelMargin",value:function(e,t,a){var n=0,i=this._transformHoriAlign(t.horiAlign,t.horiPos,!!(e.viewPage.pageNum%2)),r=e.pageCoreRect;switch(i){case vn.d:n=r.left;break;case vn.f:n=r.right-a+this._getHoriOffset(e.line.card);break;case vn.b:n=r.left+(r.width-a)/2;break;default:n=r.left+mn(t.horiPos||0)}return n}},{key:"isEmptyFrame",value:function(e){var t=32769!==e.vertPos;if(!(e.wrapMode===Ge.c&&t||32768===e.vertPos||0===e.vertPos&&t))return!1;var a={};return a.horiPos=e.horiPos||0,a.vertPos=e.vertPos||0,a.horiAnchor=e.horiAnchor&&e.horiAnchor<=2?e.horiAnchor:0,a.vertAnchor=e.vertAnchor&&e.vertAnchor<=2?e.vertAnchor:0,!a.horiPos&&!a.vertPos&&2==a.horiAnchor&&0==a.vertAnchor}},{key:"_getHoriOffset",value:function(e){return e?e.rightOffset:0}},{key:"_getRightOffset",value:function(e){return e&&e.snippetPack&&e.snippetPack.lines.length&&e.snippetPack.lines[0].rightMargin||0}},{key:"_getLeftOffset",value:function(e){return e&&e.snippetPack&&e.snippetPack.lines.length&&e.snippetPack.lines[0].leftMargin||0}},{key:"_transformHoriAlign",value:function(e,t,a){return void 0===e&&null==t?vn.d:void 0!==e?e===vn.c?a?vn.d:vn.f:e===vn.e?a?vn.f:vn.d:e===vn.a?this._transformSpecXPos(t):e:void 0}},{key:"calcCardOffset",value:function(e,t,a){var n=0,i=0,r=e.snippetPack;if(!r)return e.pageOffset=-n,void(e.rightOffset=i);var o=0,s=0,c=e.outer;!c.isWrapTable&&1!==r.lines.length||c.isInTable||(o=this._getLeftOffset(e),s=this._getRightOffset(e));var l=e.frameProp;if(a&&"T2B"===a.corX&&("R2L"===a.corY&&"NORMAL"===a.chardirect||"L2R"===a.corY&&"TRANSPOSE"===a.chardirect)&&2==l.horiAnchor)n=s;else switch(this._transformHoriAlign(l.horiAlign,l.horiPos,!!(t.viewPage.pageNum%2))){case vn.f:n=s,i=s;break;case vn.b:n=null==l.dxaWidth||0==l.dxaWidth?0:-o/2;break;case vn.d:default:n=-o}e.pageOffset=n,e.rightOffset=i}},{key:"offsetRule",value:function(e,t){if(!e.pageOffset)return 0;var a=e.pageOffset,n=e.frameProp;switch(this._transformHoriAlign(n.horiAlign,n.horiPos,!!(t.viewPage.pageNum%2))){case vn.a:case vn.d:break;case vn.b:case vn.f:default:a=0}return a}},{key:"_transformSpecXPos",value:function(e){if(null==e)return vn.a;switch(e){case vn.i:return vn.d;case vn.g:return vn.b;case vn.k:return vn.f;case vn.h:return vn.c;case vn.j:return vn.e;default:return vn.a}}}]),e}(),bn=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"create",value:function(e,t,a){var n=this._getShapeCache(t.packStatus),i=t.dataStatus,r=i.data.doc.getEmbedDrawing(a).anchor;if(r&&null!=r.shapeId){var o=r.shapeId,s=e.viewPage&&e.viewPage.embed_shape_map,c=s&&s[o]||n[o]||null;return c?(c=nn.reuseEmbedCard(c,r,i,e,t.pageUpdater)).startFetchingImg():(c=nn.makeEmbedCard(r,i,e,t.pageUpdater),n[o]=c),c}console.error("[EMBED SHAPE] Get Anchor ShapeId Error")}},{key:"reuse",value:function(e,t,a){return nn.reuseEmbedCard(a,a.anchor,t.dataStatus,e,t.pageUpdater)}}]),t}(Ft),Pn=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.snippetCards=[],a.notAllowoverPolicy=new pn,a.notLayoutInCellPolicy=new fn(e,a),a}return ee()(t,e),o()(t,[{key:"markPendingCards",value:function(e,t,a){var n=this;if(this.layers){var i=this.layers;Nt.collectCardsAfterPos(i.topCards,a,(function(a){a.isWrap&&a.pos<t.hostStatus.lookaheadPosOfLayers||(a.layoutInCell?n._detachShape(e,t,a):n.notLayoutInCellPolicy.detachShape(e,t,a))})),Nt.collectCardsAfterPos(i.bottomCards,a,(function(a){a.layoutInCell?n._detachShape(e,t,a):n.notLayoutInCellPolicy.detachShape(e,t,a)})),Nt.collectCardsAfterPos(i.textframes,a,(function(a){a.isWrap&&a.pos<t.hostStatus.lookaheadPosOfLayers||n._detachShape(e,t,a)})),this.notLayoutInCellPolicy.markPendingCards(e,t,a)}}},{key:"_createAndAdd",value:function(e,t,a){var n=this;if(a.layoutType!=gn.c.TextLine)return!1;var i=a.range,r=t.dataStatus.document,o=this.makeRelativeInfo(e,t,a);r.anchors.rangeClass.forEachHintInRange(i.pos,i.pos+i.len,(function(e){var a=e._node;if(a.wrapMode!==Ge.a&&(window.APP.typoMode!==Dt.TYPO_MODE.MODE_MOBILE&&window.APP.typoMode!==Dt.TYPO_MODE.MODE_WEB||!a.shapeData.isInk)){var i=t.dataStatus.makeGlyphAt(a.pos),s=i.glyphGroup.isHidden()||i.glyphGroup.isRevisionHidden();if(i.free(),a.shapeData&&!a.shapeData.hide&&!s){var c=null;(c=n.notLayoutInCellPolicy.mateOf(t,a)?n.notLayoutInCellPolicy.create(t,o,a,r):n.create(t,o,a,r))&&n.add(c,o)}}}),g.IT.strictIntersectTest)}},{key:"createAndAdd",value:function(e,t,a){this._createAndAdd(e,t,a),this.notLayoutInCellPolicy.createAndAdd(e,t,a)}},{key:"reset",value:function(e){e!==this.pack&&(this.pack=e,e&&(this.layers=e.host.selectLayersByPack(e)),this.notAllowoverPolicy.init(this.layers),this.shapeInfos=[],this.snippetCards=[])}},{key:"makeRelativeInfo",value:function(e,t,a){return new sn(a)}},{key:"create",value:function(e,t,a,n){if(!(a.wrapMode!==Ge.b&&a.pos<e.hostStatus.lookaheadPosOfLayers)){var i=this.notLayoutInCellPolicy.create(e,t,a,n);if(i)return i;var r=this._getShapeCache(e)[a.pos],o=!1;r?r=hn.resetShapeCard(r,a,null,n,t.line,t.viewPage,t.coorSystem):(r=hn.makeShapeCard(a,t,n,t.line,t.viewPage,t.coorSystem),o=!0);var s=this.hostAgent.pageUpdater.getTextboxUpdater();return hn.makesureTextbox(r,s,t,e.dataStatus,!o),r.updateInnerBoundary(),{shape:r,isNew:o}}}},{key:"needCommit",value:function(e,t){return this.shapeInfos.length>0}},{key:"commit",value:function(e,t){var a=this;(this.shapeInfos.length>0||this.snippetCards.length>0)&&!this.layers&&this._createLayers(e,t);var n=[];return this._commitShapes(e,t,(function(e){e.shape.isWrap&&n.push(e.shape)})),this._commitSnippets(e,t,(function(i){n.push(i),a.onCommitSnippet&&a.onCommitSnippet(e,t,i)})),n.sort((function(e,t){return e.pos-t.pos})),this.afterCommit(e,t,n)}},{key:"afterCommit",value:function(e,t,a){var n=t.hostStatus.host,i=n.mainpages||[e],r=[];return i.forEach((function(t){t.isBalanced&&t.section&&t.section.end<=e.section.begin||r.push(t)})),this.intersectByWraps(n,r,a)}},{key:"addSnippet",value:function(e,t,a){a.range.begin<t.hostStatus.lookaheadPosOfLayers||this.snippetCards.push(a.card)}},{key:"revert",value:function(e,t,a){var n=this;if(this.layers){var i=[],r=t.hostStatus.lookaheadPosOfLayers;return Nt.collectCardsAfterPos(this.layers.topCards,a,(function(a){a.isWrap?a.pos>=r&&(n._detachShape(e,t,a),i.push(a)):n._detachShape(e,t,a)})),Nt.collectCardsAfterPos(this.layers.bottomCards,a,(function(a){n._detachShape(e,t,a)})),Nt.collectCardsAfterPos(this.layers.textframes,a,(function(a){a.pos>=r&&(n._detachShape(e,t,a),i.push(a))})),this.afterRevert(e,t,a,i.sort((function(e,t){return e.pos-t.pos})))}}},{key:"afterRevert",value:function(e,t,a,n){var i=t.hostStatus.host,r=i.mainpages||[e],o=null;if(n.length&&i.rollbacks){for(var s=i.rollbacks.length-1;s>=0;--s){var c=i.rollbacks[s];if(c.begin<=n[0].pos&&c.end>n[0].pos){o=c;break}}if(o&&!(o.begin>a)){var l=this.intersectByRange(i,r,{begin:o.begin,end:a});if(l.wraps=n,!l.packs.length){var u=e.lines.length-1;l.packs.push({pack:e,lineRange:{begin:u,end:u+1}})}return l}}}},{key:"intersectByRange",value:function(e,t,a){var n=this,i={host:e,packs:[]};return t.forEach((function(e){var t=n.intersectPackByRange(e,a);if(t){var r=e.lines[t.begin].range.begin,o=e.lines[t.end-1].range.end;i.packs.push({pack:e,lineRange:t,range:{begin:r,end:o}})}})),i}},{key:"intersectByWraps",value:function(e,t,a){var n=this,i={host:e,packs:[],wraps:a};return t.forEach((function(t){var r=n.intersectPackByCards(t,e,a);if(r){var o=t.lines[r.begin].range.begin,s=t.lines[r.end-1].range.end;i.packs.push({pack:t,lineRange:r,range:{begin:o,end:s}})}})),i}},{key:"_commitShapes",value:function(e,t,a){var n=this;this.shapeInfos.forEach((function(i){var r=i.shape,o=i.relativeInfo;if(!n.notLayoutInCellPolicy.commit(e,t,i,a)){var s=r.rect,c=s.top,l=s.left,u=s.right,h=s.bottom;i.oldRect={top:c,left:l,right:u,bottom:h},hn.adjustShapeCardRect(r,o),n.notAllowoverPolicy.commit(r),n._attachShape(e,t,r),e.host.conflicting=!0,(i.isNew||c!==r.rect.top||l!==r.rect.left)&&(i.isChanged=!0),a&&a(i),r.renderInfo&&(r.renderInfo.moved=!0)}})),this.shapeInfos=[]}},{key:"_commitSnippets",value:function(e,t,a){var n=this;this.snippetCards.forEach((function(i){y("[typo]    Commit snippet card("+i.begin+", "+i.end+") at page("+i.viewPage.layout_index+")"),n.notAllowoverPolicy.commit(i),n._attachShape(e,t,i),e.host.conflicting=!0,a&&a(i)})),this.snippetCards=[]}},{key:"_createLayers",value:function(e,t){if(!this.layers){var a=this.hostAgent.hostUpdater.updaterFactory;this.layers=t.hostStatus.host.createLayersByPack(e,a),this.notAllowoverPolicy.init(this.layers)}return this.layers}},{key:"intersectPackByRange",value:function(e,t){var a=void 0,n=void 0,i=!1;if(e.lines.some((function(e,r){if(g.IT.strictIntersectTest(e.range,t))void 0===a?(a=r,n=r+1):n=r+1,i=!0;else if(a)return!0})),i)return{begin:a,end:n}}},{key:"intersectPackByCards",value:function(e,t,a,n,i){var r=this,o=n;return a.forEach((function(a){o=r.intersectPackByCard(e,t,a,o,i)})),o}},{key:"intersectPackByCard",value:function(e,t,a,n,i){var r=function(e,t){var a=e.transformPoint(t.left,t.top),n=e.transformPoint(t.right,t.bottom);return new Ua.a({left:a.x,top:a.y,right:n.x,bottom:n.y})},o=function(e,t){for(var a=new ze.Matrix2D,n=e.parent;n!==t;)a.translate(-n.rect.left,-n.rect.top),n=n.parent;return a}(e,e.parent),s=r(o,a.boundary);if(!s.intersect(e.rect))return n;o.translate(-e.rect.left,-e.rect.top),s=r(o,s),Math.abs(s.height-0)<=Number.EPSILON&&a.anchor&&a.anchor.wrapMode===Ge.f||(s.top+=.1);var c=null,l=null;n&&(c=n.begin,l=n.end);var u=[];u=u.concat(e.lines);var h=null!==c?c:u.length,d=this.hostAgent.getUsableWidthOfPack(e),p=function(e,t){var a=t.rect,n=a.top,i=a.bottom,r=e.wrap_mode;if(r==Ge.f){if(n<=s.bottom&&i>s.top&&(s.top!==s.bottom||!e.anchor.allowover||e.anchor.zorder))return!0}else{if(r==Ge.d||r===Ge.e)return t.layoutType==gn.c.TableLine?s.intersect({left:0,right:d,top:n,bottom:n+1}):s.intersect({left:0,right:d,top:n,bottom:i});if(s.intersect({left:0,right:d,top:n,bottom:i}))return!0}return!1};if(1===i||!i)for(var g=0;g<h;g++)if(p(a,u[g])){c=g;break}if(2===i||!i){h=l||0;for(var f=u.length-1;f>=h;f--)if(p(a,u[f])){l=f+1;break}}return null===c&&null===l?null:{begin:c,end:l}}},{key:"onCommitSnippet",value:function(e,t,a){kn.adjustChildCards(a)}}]),t}(Wt),xn=0,_n=1,Cn=2,wn=function(){function e(){i()(this,e)}return o()(e,[{key:"onParaDone",value:function(e,t){if(!t.dataStatus.isPapxBegin)return B.c.Pass;if(this.initParaBreak(t.dataStatus.pos,t),!t.paraBreak.pageBreakBefore)return B.c.Pass;var a=!1,n=t.dataStatus.makeGlyphAt(t.dataStatus.pos-1),i=t.updatingLineStatus;if(i&&!i.bForceRenderLine&&(!n||n&&n.charCode==W.i)&&(a=!0),e.lines.length>0){a=!1;for(var r=0;r<e.lines.length;++r){var o=e.lines[r];if(!o.isAllHiddenLine&&!o.isRepeatHeaderRow){a=!0;break}}}return a&&(t.lookaheadPosForPack=t.dataStatus.pos),a?B.c.PackBroken:B.c.Pass}},{key:"onUpdatingLineAccepted",value:function(e,t){return B.c.Pass}},{key:"onUpdatingLineRejected",value:function(e,t){return t.nextToParaLastLine=this.isParaLastLine(t.updatingLine,t),B.c.Pass}},{key:"dealDrawingSplitRule",value:function(e,t){var a=void 0,n=e.lines[e.lines.length-1],i=this.calcSplitPos(e,t),r=i.splitType,o=i.posY;if(r==Cn){if(this.isParaLastLine(n,t))return;var s=this.dealKeepTogether(e,t,e.lines.length-1);if((a=s&&s.reflowLineKeepTogether)&&s.index<0){if(n===a)return;a=null;for(var c=0;;){var l=e.lines[c].rect.bottom;if(++c>=e.lines.length)break;if(e.lines[c].rect.top!=l){a=e.lines[c];break}}}a&&(t.updatingLineTop=o)}else if(r==_n&&!n.is_para_first){var u=this.dealKeepTogether(e,t,e.lines.length-2);if((a=u.reflowLineKeepTogether)&&u.index<0)return t.updatingLineTop=o,n;t.updatingLineTop=n.rect.top}return a}},{key:"calcSplitPos",value:function(e,t){var a=e.lines[e.lines.length-1],n=e.host.layers,i=this.getMetrixLocal2Parent(a,e.parent),r=this.translate(i,{left:a.rect.left,right:a.rect.right,top:a.rect.top,bottom:a.rect.bottom}),o=[];n&&n.collectWrapCardsByRect(r).forEach((function(e){o.push(e)}));var s=xn,c=a.rect.top;if(!o.length)return{splitType:s,posY:c};for(var l=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,h=!1,d=!1,p=0;p<o.length;++p){var g=o[p].boundaryRect;h=r.top<g.top&&r.bottom>=g.top,d=r.top<g.bottom&&r.bottom>=g.bottom,l=l>g.top?g.top:l,u=u<g.bottom?g.bottom:u}return l-=e.rect.top-1,u-=e.rect.top-1,h&&(s=_n,c=l),d&&(s=Cn,c=u),{splitType:s,posY:c}}},{key:"translate",value:function(e,t){var a=e.transformPoint(t.left,t.top),n=e.transformPoint(t.right,t.bottom);return I.a.initByRawRect({left:a.x,top:a.y,right:n.x,bottom:n.y})}},{key:"getMetrixLocal2Parent",value:function(e,t){for(var a=new ze.Matrix2D,n=e.parent;n!==t;)a.translate(n.rect.left,n.rect.top),n=n.parent;return a}},{key:"isParaLastLine",value:function(e,t){return t.dataStatus.final.getPapx(e.range.begin).end==e.range.end}},{key:"onPackBroken",value:function(e,t){if(e.lines.length<=0||t.dataStatus.isDataEnd||t.packBreakBefore)return B.c.Pass;if(this.initParaBreak(e.lines[e.lines.length-1].range.begin,t),!(t.paraBreak.widowControl||t.paraBreak.keepLines||t.paraBreak.keepNext))return B.c.Pass;var a=void 0,n=this.dealOrphanLine(e,t),i=n.reflowLineWidow?e.lines.indexOf(n.reflowLineWidow)-1:e.lines.length-1;n&&n.reflowLineWidow&&(t.hostStatus.balanceStatus||n.index>0)&&(a=n.reflowLineWidow);var r=void 0;do{var o=this.dealKeepWithNext(e,t,i);i=o&&o.reflowLineKeepWithNext?e.lines.indexOf(o.reflowLineKeepWithNext)-1:i;var s=this.dealKeepTogether(e,t,i);i=s&&s.reflowLineKeepTogether?e.lines.indexOf(s.reflowLineKeepTogether)-1:i,r=null,s&&s.reflowLineKeepTogether?(t.hostStatus.balanceStatus||s.index>0)&&(r=s.reflowLineKeepTogether,e.isBrokenByKeepLines=!0):r=o&&o.reflowLineKeepWithNext&&o.index>0?o.reflowLineKeepWithNext:null,r&&(a=r)}while(r&&i>0);return a?this.reflowToLine(a,e,t):B.c.Pass}},{key:"initParaBreak",value:function(e,t){var a=t.dataStatus.final.getPapx(e).prop,n={};n.widowControl=a.getPropVal("widow_control"),n.keepNext=a.getPropVal("keep_next"),n.keepLines=a.getPropVal("keep_lines"),n.pageBreakBefore=a.getPropVal("page_break_before"),t.paraBreak=n}},{key:"reflowToLine",value:function(e,t,a){return a.packUpdater.revertCommitedLine(t,a,e)}},{key:"dealOrphanLine",value:function(e,t){var a=void 0,n=e.lines.length-1;if(t.paraBreak.widowControl){var i=e.lines[n],r=this.isParaLastLine(i,t),o=i.layoutType==_.DOCLayoutType.TableLine;!i||i.sublines||r||i.isPackBroken||o||i.isWrapTable||i.isSnippetLine||!i.is_para_first&&!t.nextToParaLastLine||(a=i,--n,(i=e.lines[n])&&!a.is_para_first&&!i.sublines&&i.is_para_first&&(a=i))}return{reflowLineWidow:a,index:n}}},{key:"dealKeepWithNext",value:function(e,t,a){var n=void 0,i=void 0,r=!1,o=a;do{if(o<0)return;r=!1;var s=e.lines[o],c=this.isParaLastLine(s,t),l=s.layoutType==_.DOCLayoutType.TableLine;if(this.initParaBreak(s.range.begin,t),!s||s.isPackBroken||!t.paraBreak.keepNext||!c&&!l||l&&s.host.isWrapTable)break;for(;s;){if(s.is_para_first){n=s,i=o,r=!0,s=--o>=0?e.lines[o]:null;break}s=--o>=0?e.lines[o]:null}if(!s){n=null;break}}while(r);return{reflowLineKeepWithNext:n,index:i}}},{key:"dealKeepTogether",value:function(e,t,a){var n=void 0,i=a,r=e.lines[i];if(!(i<0)){this.initParaBreak(r.range.begin,t);var o=this.isParaLastLine(r,t),s=r.layoutType==_.DOCLayoutType.TableLine;if(r&&!r.isPackBroken&&!r.isWrapTable&&!s&&t.paraBreak.keepLines&&!o)for(;r;){if(r.is_para_first){n=r,r=--i>=0?e.lines[i]:null;break}r=--i>=0?e.lines[i]:null}return{reflowLineKeepTogether:n,index:i}}}}]),e}(),Sn=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostAgent",base:at,methodName:"init"},{baseName:"DOCHostAgent",base:at,methodName:"acceptUpdatingLine"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCHostAgent_init(e,t)}},{key:"makePackToolkit",value:function(){return{packUpdater:this.makePackUpdater(this),lanePolicy:new en(this),layersPolicy:new Pn(this),embedPolicy:new bn(this)}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.makeLinePolicies(this),[new wn])}},{key:"calcBodyRange",value:function(e,t){var a=t.hostStatus.outerFrameData;return t.bodyRange=a.range,t.bodyRange}},{key:"getUsableHeightOfPack",value:function(e){return e.packCaps.height}},{key:"getUsableWidthOfPack",value:function(e){return e.packCaps.width}},{key:"isPackBroken",value:function(e,t){if(t.hostStatus.outerReUpdateSingleLine)return!0}},{key:"onParaDone",value:function(e,t){return this.packToolkit.layersPolicy.commit(e,t),B.c.Pass}},{key:"acceptUpdatingLine",value:function(e,t){var a=this.packToolkit.lanePolicy;return!!a.acceptUpdatingLine(e,t)||(t.forceAccept=a.forcedToAcceptUpdatingLine(e,t))}}]),e}();s.a.mix(Sn,at);var Ln=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCSceneUpdater",base:Ya,methodName:"init"},{baseName:"DOCSceneUpdater",base:Ya,methodName:"enterHost"},{baseName:"DOCSceneUpdater",base:Ya,methodName:"leaveHost"}]}}]),o()(e,[{key:"init",value:function(e,t){this.tableLevel=t,this.mixin_DOCSceneUpdater_init(e)}},{key:"initHostPolicies",value:function(){this.hostAgent=new Sn(this,this.pageUpdater.viewUpdater.view),this.hostAgents=[this.hostAgent]}},{key:"killScene",value:function(e){var t=e.selectLayersByPack(e.pack);t&&e.viewPage.layers.removeChild(t);var a=e.snippetPack.nextPack;a&&(e.snippetPack.nextPack=a.prevPack=null,a.host.outer.prevLine=null);var n=e.snippetPack.prevPack;n&&(e.snippetPack.prevPack=n.nextPack=null,e.outer.prevLine=null),this.primeHostAgent().packToolkit.lanePolicy.dropPacksInHost(e),e.hostPendings&&e.hostPendings.forEach((function(e){e.settled=!0}))}},{key:"killSnippetLine",value:function(e){e.parent.isBalanced||this.killScene(e.card),e.view.detachFrameLine(e)}},{key:"rootScope",value:function(){return{from:0,to:2}}},{key:"getTableLevel",value:function(){return this.tableLevel}},{key:"checkHost",value:function(e,t){if(this.makesureOuterFrameData(e,t),t.outerFrameData)return!0;e.hostPendings.forEach((function(e){e.settled=!0}));var a=e.outer;return a.obsoleted=x.All,this.pendingToOuter(e,{lines:[a]}),!1}},{key:"enterHost",value:function(e,t){this.mixin_DOCSceneUpdater_enterHost(e,t),this.mementoForSnippetLine(e,t)}},{key:"leaveHost",value:function(e,t){this.mixin_DOCSceneUpdater_leaveHost(e,t);var a=e.outer,n=new sn(a),i=a?a.parent:null;kn.calcCardOffset(e,n,i?i.textflow:null),kn.calcCardRect(e,n),kn.adjustPackByCard(e);var r=e.snippetPack,o=r.lines[r.lines.length-1];o&&(o.isBrokenAfter||o.range.end<e.outer.range.end)?e.outer.isBrokenAfter=!0:e.outer.isBrokenAfter=!1,this.breakNextPack(e),t.outerStartFromScratch||this.compatWithMemento(e,t)||this.pendingToOuter(e)}},{key:"makeHostStatus",value:function(e){return new wa(e)}},{key:"mateByScenePath",value:function(e){return this.selectScopeInfo(e).pack instanceof Ta.c}},{key:"selectScopeInfo",value:function(e){return{line:e[2],pack:e[1],host:e[0]}}},{key:"selectScenePath",value:function(e){var t=this,a=this.pageUpdater,n=null,i=a.getHostLevelByScenePath(e[0]);return e.slice(1).find((function(e){if(i===t.getTableLevel())return!0;n=a.selectSceneUpdater(e,i),i+=n.getHostLevelByScenePath(e)}))}},{key:"makesureOuterFrameData",value:function(e,t){if(!t.outerFrameData){var a=t.dataStatus;a.locate(e.begin),t.outerFrameData=Object(Ea.a)(a.final,a.pos,this.getTableLevel()),e.reset(t.outerFrameData)}}},{key:"acceptUpdatingLine",value:function(e,t){return t.updatingLineTop+t.updatingLine.rect.height<=e.rect.bottom}},{key:"compareMentionedPos",value:function(e,t){return e.snippetScene,t.snippetScene,e.lineIndex-t.lineIndex}},{key:"getMentionedPosByScenePath",value:function(e){var t=this.selectScopeInfo(e),a=t.host,n=t.pack,i=t.line;return{snippetScene:a,lineIndex:i?n.lines.indexOf(i):n.lines.length}}},{key:"getMentionedPosOfWholePath",value:function(e){return this.getMentionedPosByScenePath(this.pageUpdater.selectScenePath(e))}},{key:"breakNextPack",value:function(e){if(!e.snippetLine.isBrokenAfter){var t=e.snippetPack.nextPack;t&&(e.snippetPack.nextPack=null,t.prevPack=null,t.host.outer.prevLine=null)}}},{key:"mementoForSnippetLine",value:function(e,t){if(!t.outerStartFromScratch){var a={};a.isBrokenAfter=e.outer.isBrokenAfter,a.cardRect=I.a.initByRawRect(e.rect),t.memento=a}}},{key:"compatWithMemento",value:function(e,t){var a=t.memento;return I.a.equal(e.rect,a.cardRect)&&e.outer.isBrokenAfter==a.isBrokenAfter}},{key:"moveUpHost",value:function(e){var t=this.getBodyRange(e);this.moveUpPack(e.pack,t)}},{key:"moveDownHost",value:function(e,t){var a=this.getBodyRange(e);this.moveDownPack(e.pack,t,a)}},{key:"getBodyRange",value:function(e){var t=e.view.data.doc.getDataLogic("final"),a=Object(Ea.a)(t,e.range.begin,this.getTableLevel());return{begin:a.range.pos,end:a.range.pos+a.range.len}}}]),e}();s.a.mix(Ln,Ya);var Tn=a(6103),In=a(6107),Rn=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLanePolicy",base:Gt,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCLanePolicy_init(e)}},{key:"getPacksInHost",value:function(e){return[e.textbox_page]}}]),e}(),On=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostAgent",base:at,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCHostAgent_init(e,t)}},{key:"makePackToolkit",value:function(){var e=this.hostUpdater.updaterFactory,t=new Nt(this),a=e.makeEmbedPolicy(this);return{packUpdater:this.makePackUpdater(),lanePolicy:new Rn(this),layersPolicy:t,embedPolicy:a}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.makeLinePolicies(this),[])}},{key:"calcBodyRange",value:function(e,t){var a={},n=t.hostStatus.host;if(n.anchor)a.pos=n.anchor.body.pos,a.len=n.anchor.body.len;else{var i=n.shapeData.private.textRange,r=window.APP.data.doc.textboxs.rangeClass.findRangeByRefId(i.refId);a.pos=r.pos,a.len=r.len}return t.bodyRange=a,a}},{key:"getUsableWidthOfPack",value:function(e){var t=e.parent,a=t.outer,n=this.hostUpdater.selectOuterUpdater(a).selectScopeInfo(a.getScenePath()),i=e.textflow;return t.isWrapText?"L2R"===i.corX?e.rect.width:e.rect.height:"L2R"===i.corX?n.pack.rect.width-t.left_padding-t.right_padding:n.pack.rect.height-t.top_padding-t.bottom_padding}},{key:"getUsableHeightOfPack",value:function(e){return Number.MAX_SAFE_INTEGER}},{key:"getFieldZonePolicies",value:function(){return this.fieldZonePolicies||(this.fieldZonePolicies=[new Tn.a,new In.a,new ka]),this.fieldZonePolicies}},{key:"getFootnoteEndnotePolicies",value:function(){return[]}}]),e}();s.a.mix(On,at),s.a.mix(Rn,Gt);var Bn=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCSceneUpdater",base:Ya,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCSceneUpdater_init(e)}},{key:"initHostPolicies",value:function(){this.hostAgent=new On(this,this.pageUpdater.viewUpdater.view),this.hostAgents=[this.hostAgent]}},{key:"killScene",value:function(e){this.hostAgent.packToolkit.packUpdater.killPack(e.textbox_page),e.hostPendings&&e.hostPendings.forEach((function(e){e.settled=!0}))}},{key:"rootScope",value:function(e){for(var t=2,a=e.length;t<a&&e[t-1].isChildShape;++t);return{from:0,to:t}}},{key:"selectScopeInfo",value:function(e){for(var t=e.length-1;t>=0;){var a=e[t];if(a.isChildShape||a.isTopShape)break;--t}var n=Math.max(0,t);return{host:e[n],pack:e[n+1],line:e[n+2]}}},{key:"selectScenePath",value:function(e){return e[e.length-1]}},{key:"makeHostStatus",value:function(e){return new Ca(e)}},{key:"enterHost",value:function(e,t){t.host=e,t.originTextRect=e.backupTextRect}},{key:"leaveHost",value:function(e,t){var a,n=t.outerStartFromScratch?void 0:t.originTextRect,i=(a=e.autoFitByContent(this.updaterFactory.getShapeCardFactory(),n))||window.APP.isWebMode()||window.APP.isMobileMode(),r=e.topShape;if(i&&!t.outerStartFromScratch&&(r.isEmbedShape||r.isWrap)&&this.pendingToOuter(r),e.isChildShape)if(a){for(var o=e.parent;o&&(delete o._drawingLayout,!o.isTopShape);)o=o.parent;o.renderInfo&&(o.renderInfo.needRerender=!0)}else{e.renderInfo&&(e.renderInfo.expired=!0);for(var s=e.parent;s&&(s.renderInfo&&(s.renderInfo.expired=!0),!s.isTopShape);)s=s.parent}}},{key:"mateByScenePath",value:function(e){return this.selectScopeInfo(e).host.layoutType===_.DOCLayoutType.ShapeScene}},{key:"getMentionedPosByScenePath",value:function(e){var t=this.selectScopeInfo(e),a=t.host,n=t.pack,i=t.line;return{shapeCard:a,lineIndex:i?n.lines.indexOf(i):n.lines.length}}},{key:"updateTextBox",value:function(e,t){var a={dataStatus:e,startFromScratch:!0},n=e.pos;this.updateHost(t,a),e.locate(n)}},{key:"moveHost",value:function(e){var t={};t.pos=e.anchor.body.pos,t.len=e.anchor.body.len,this.moveUpPack(e.textbox_page,t)}}]),e}();s.a.mix(Bn,Ya);var Mn=a(7207),En=a(4580),An=a(626),Hn=a(4111),Un=function(){function e(t,a,n){i()(this,e),this.view=t,this.hostAgent=a,this.outerUpdater=n,this.innerUpdater=n.pageUpdater.getSnippetUpdaterAt(n.getTableLevel()),this.hostPendings=[]}return o()(e,[{key:"freeLine",value:function(e){}},{key:"killLine",value:function(e){this.getInnerUpdater().killSnippetLine(e)}},{key:"mateByLine",value:function(e){return e.layoutType===_.DOCLayoutType.SnippetLine}},{key:"mateOf",value:function(e,t){var a=t.dataStatus,n=a.papx,i=this.outerUpdater.getTableLevel();if(0===i&&n.prop.text_frame&&32768!=n.prop.text_frame.vertPos)return!0;if(n.prop.getPropVal("nest_level")>i){var r=a.final.specTable.getTapx(n.pos,g.IT.Include,i+1);if(r&&r.prop)return!(!r.prop.text_frame||r.prop.type&Hn.a||kn.isEmptyFrame(r.prop.text_frame))}return!1}},{key:"makeLine",value:function(e,t){var a=this.getInnerUpdater().getTableLevel(),n=Object(Ea.a)(t.dataStatus.final,t.dataStatus.pos,a);return n.range.pos+n.range.len>t.bodyRange.end&&(n.range.len=t.bodyRange.end-n.range.pos),t.frameData=n,this.makeSnippetFromCache(e,t,n)||this.makeSnippet(e,t,n)}},{key:"updateLine",value:function(e,t){var a=t.updatingLine,n=this.getInnerUpdater();a.reuseSnippetCard||this.pendingToSnippetLine(a,n),this.updateSnippetLine(e,t,t.frameData),this.onSnippetLineEnd(a,e,t),delete t.frameData}},{key:"getInnerUpdater",value:function(){return this.innerUpdater}},{key:"makeSnippet",value:function(e,t,a){var n=this.makeSnippetLine(e,t,a.range),i=this.makeSnippetCard(n,t,a),r=this.makeSnippetPack(n,i,e,t);if(n.pack=i.snippetPack=r,n.card=i,i.outer=i.snippetLine=n,i.updater=this.getInnerUpdater(),n.isWrapTable=i.isWrapTable=a.frameProp.isWrapTable,!n.isWrapTable){var o=t.dataStatus.papx.prop.drop_cap;n.isDropCap=i.isDropCap=!(!o||0===o.position)}return n}},{key:"makeSnippetFromCache",value:function(e,t,a){var n=a.range.pos,i=t.hostStatus.host.selectLayersByPack(e),r=(i&&i.getTextframeCards(!1)||[]).find((function(e){return e.pos===n}));if(r){var o=this.makeSnippetLine(e,t,a.range),s=r;o.pack=s.snippetPack,o.card=s,s.outer=s.snippetLine=o,o.reuseSnippetCard=!0;var c=o.pack,l=c.lines[c.lines.length-1];return l&&(l.isBrokenAfter||l.range.end<o.range.end)&&(o.isBrokenAfter=!0),o}return null}},{key:"makeSnippetLine",value:function(e,t,a){var n=e.viewPage,i=e.compose,r={parent:e,viewPage:n,coorSystem:_.DOCCoorSystemType.TextPage},o=new Mn.a(r,{compose:i,snippetLine:null});return o.border={left_width:0,right_width:0,before_width:0,after_width:0},o.after_space=0,o.before_space=0,o.range=new O.a(a.pos,a.pos+a.len,o),o.rect=I.a.initByRawRect({top:t.updatingLineTop,left:0,right:0,bottom:t.updatingLineTop}),o.is_para_first=!0,o.isBrokenBefore=t.prevBrokenInfo&&t.prevBrokenInfo.brokenLines&&e.lines.length<t.prevBrokenInfo.brokenLines.length,o.isBrokenBefore&&(o.prevLine=t.prevBrokenInfo.brokenLines[0]),o.relativeInfo=this.getRelativeInfo(o),o}},{key:"makeSnippetCard",value:function(e,t,a){var n={begin:e.range.begin,end:e.range.end},i=new En.a({viewPage:e.viewPage,range:n,frameData:a});return i.snippetPack=null,i.subdoc_type=t.dataStatus.document.getSubDocType(n.begin),kn.calcCardRect(i,e.relativeInfo),i}},{key:"makeSnippetPack",value:function(e,t,a,n){var i={parent:t,viewPage:a.viewPage,coorSystem:_.DOCCoorSystemType.TextFramePage},r=new Ta.c(i,{compose:a.viewPage.compose,textpage:null});r.textflow=new La.a(0),r.coor_pos2view=An.a.ZERO();var o=!a.lines.length,s=this.calcSnippetPackCaps(e,t,a,n,o);if(r.packCaps=s,r.rect=I.a.initByRawRect({left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height}),e.isBrokenBefore){var c=e.prevLine.pack;r.prevPack=c,c.nextPack=r}return r}},{key:"pendingToSnippetLine",value:function(e,t){var a=e.pack;a&&t.pendingToHost(a,e.card)}},{key:"calcSnippetPackCaps",value:function(e,t,a,n,i){var r=this.outerUpdater.selectHostAgent(a),o=n.hostStatus.host.selectLayersByPack(a),s=a.viewPage.inner_rect.top,c=e.rect.top+a.rect.top-s,l=!1;o&&o.getWrapCards().forEach((function(e){if(!(t.isWrapTable&&t.allowover&&e.isWrapTable&&e.allowover)&&!e.isDiagonalShape&&e.boundaryRect.intersect(t.boundaryRect)){var a=e.rect.bottom-s;c=Math.max(a,c),l=!0}}));var u=r.getUsableHeightOfHost(a)-c,h=t.frameProp,d=u;if(!a.footer_type||"header"!=a.footer_type&&"footer"!=a.footer_type)if(t.isWrapTable){if(2!==h.vertAnchor||e.isBrokenBefore||(l||(u-=kn.calcVertOffset_RelPara(h.vertPos)),u=Math.max(u,1)),(a.section?a.section.getColumnsCount():1)>1&&a.layoutType==_.DOCLayoutType.MainPage){var p=a.viewPage.inner_rect;(Math.floor(u)==Math.floor(p.height)||a.isSecFirstPack&&2!==h.vertAnchor||a.isSecLastPack&&a.section===a.viewPage.section)&&(u=Number.MAX_SAFE_INTEGER)}}else h.heightRule&&"atLeast"!==h.heightRule&&"auto"!==h.heightRule?u=Number.MAX_SAFE_INTEGER:(u=2===h.vertAnchor?Math.max(1,Math.max(u,Object(T.Ti2Px)(h.height||0))):Number.MAX_SAFE_INTEGER,i&&(u=Number.MAX_SAFE_INTEGER));else u=Number.MAX_SAFE_INTEGER;return{x:0,y:0,width:h.widthRule&&"auto"!==h.widthRule?Object(T.Ti2Px)(h.width||0):a.rect.width,height:u,ySpace:d}}},{key:"onSnippetLineEnd",value:function(e,t,a){var n=e.card;if(n.upper=t.parent,n.renderInfo&&n.renderInfo.oldInfo){var i=n.rect,r=i.left,o=i.top,s=n.renderInfo.oldInfo,c=s.oldLeft;s.oldTop==o&&c==r||(n.renderInfo.moved=!0),delete n.renderInfo.oldInfo}a.dataStatus.locate(e.range.end)}},{key:"getRelativeInfo",value:function(e){return new sn(e)}},{key:"commitUpdatingLine",value:function(e,t){this.view.attachFrameLine(t.updatingLine);var a=t.updatingLine;t.lastRollbackRange&&t.lastRollbackRange.end>=a.range.end||this.hostAgent.onCommitSnippetLine(e,t,a)}},{key:"isPageBroken",value:function(e,t){return!!t.lastLine.isBrokenAfter}},{key:"compatInPack",value:function(e,t){if(t.lastLine&&t.lastLine.layoutType===_.DOCLayoutType.SnippetLine&&0===e.lines.length)return!1;var a=e.pendingLines[0];return!((!t.lastLine||t.lastLine.layoutType!==_.DOCLayoutType.SnippetLine)&&a.isBrokenBefore)&&t.updatingLineTop===a.rect.top}},{key:"usablePendingLine",value:function(e,t){var a=e.pendingLines;return!(!a||0===a.length)&&(t.settledPos===a[0].range.pos&&this.mateByLine(a[0]))}},{key:"reuseUpdatingLine",value:function(e,t){var a=t.updatingLine;return 0!=a.range.len&&(a.card.begin<t.hostStatus.lookaheadPosOfLayers||(this.resetLine(e,t),this.moveSnippetCard(e,t),this.updateSnippetLine(e,t),this.onSnippetLineEnd(a,e,t),this.clearOldStatus(e,t)),!0)}},{key:"resetLine",value:function(e,t){var a=this.getInnerUpdater().getTableLevel(),n=Object(Ea.a)(t.dataStatus.final,t.dataStatus.pos,a);t.frameData=n,this.resetSnippetLine(e,t),this.resetSnippetCard(e,t),this.resetSnippetPack(e,t)}},{key:"resetSnippetLine",value:function(e,t){var a=t.updatingLine,n=t.updatingLineTop-a.rect.top;a.rect.offset(0,n),a.oldIsBrokenBefore=a.isBrokenBefore,a.isBrokenBefore=t.prevBrokenInfo&&t.prevBrokenInfo.brokenLines&&e.lines.length<=t.prevBrokenInfo.brokenLines.length,a.isBrokenBefore&&(a.prevLine=t.prevBrokenInfo.brokenLines[0])}},{key:"resetSnippetCard",value:function(e,t){var a=t.updatingLine,n=a.card.reset(t.frameData),i=n.frameProp,r=this.getRelativeInfo(a),o=n.rect.width,s=kn.getLeft(r,i,o)+kn.offsetRule(n,r),c=n.rect.left,l=n.rect.height,u={vertRel:i.vertAnchor,vertPos:i.vertPos||0},h=kn.getTop(r,u,l),d=n.rect.top;n.oldRect={left:c,top:d},n.offset(s-c,h-d),n.conflicting=!0,n.renderInfo&&(n.renderInfo.oldInfo={oldTop:d,oldLeft:c})}},{key:"resetSnippetPack",value:function(e,t){var a=t.updatingLine,n=a.pack,i=1===e.lines.length;if(n.packCaps=this.calcSnippetPackCaps(a,a.card,e,t,i),a.isBrokenBefore){var r=a.prevLine.pack;n.prevPack=r,r.nextPack=n}else n.prevPack&&(n.prevPack=null)}},{key:"clearOldStatus",value:function(e,t){var a=t.updatingLine,n=a.card;delete a.oldIsBrokenBefore,delete n.oldRect,delete n.isMovingUp,delete n.isMovingUp,n.conflicting=!1}},{key:"moveSnippetCard",value:function(e,t){var a=t.updatingLine,n=a.card,i=a.pack;if(!!a.isBrokenBefore==!!a.oldIsBrokenBefore&&this.compatWithPrevPack(a.pack))if(n.rect.top===n.oldRect.top){var r=a.host;r.layoutType!==_.DOCLayoutType.SnippetScene&&r.layoutType!==_.DOCLayoutType.TableLine||(r.isMovingUp?(n.isMovingUp=!0,this.getInnerUpdater().moveUpHost(a)):r.isMovingDown&&(n.isMovingDown=!0,this.getInnerUpdater().moveDownHost(a,i.packCaps.height)))}else n.rect.top<n.oldRect.top?(n.isMovingUp=!0,this.getInnerUpdater().moveUpHost(a)):(n.isMovingDown=!0,this.getInnerUpdater().moveDownHost(a,i.packCaps.height));else this.getInnerUpdater().pendingAt(a.pack,0)}},{key:"updateSnippetLine",value:function(e,t,a){var n=t.updatingLine,i=n.card,r=n.pack;if(!(i.hostPendings.length<=0&&r.lines.length)){var o={dataStatus:t.dataStatus,outerFrameData:a,startFromScratch:!0};if(this.getInnerUpdater().updateHost(i,o),!r.lines.length){var s=i.frameProp;if(2===s.vertAnchor&&s.vertPos>0&&i.isWrapTable){var c=r.packCaps,l=c.height;c.height=c.ySpace,o.reUpdateSingleLine=!0,o.dataStatus.locate(n.range.begin),this.pendingToSnippetLine(n,this.getInnerUpdater()),this.getInnerUpdater().updateHost(i,o),c.height=l}}}}},{key:"acceptUpdatingLine",value:function(e,t){var a=t.updatingLine,n=a.pack;if(!n.lines.length)return!1;if(!a.isWrapTable){var i=n.lines[n.lines.length-1];if(i.isBrokenAfter||i.range.end<a.range.end)return!1}return!0}},{key:"adjustUpdatingLine",value:function(){return!0}},{key:"compatWithPrevPack",value:function(e){var t=e.prevPack;return!t||this.getInnerUpdater().primeHostAgent().compatWithNextPack(t,e)}}]),e}(),Dn=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCSceneUpdater",base:Ya,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.viewUpdater=e,this.snippetUpdaters=[],this.textboxUpdater=new Bn(this),this.mixin_DOCSceneUpdater_init(this)}},{key:"killPage",value:function(e){this.hostAgents.forEach((function(t){t.packToolkit.lanePolicy.dropPacksInHost(e)}))}},{key:"makeLinePolicies",value:function(e){var t=e.view;return[this.updaterFactory.makeRepeatHeaderLinePolicy(t,e,e.hostUpdater),new Un(t,e,e.hostUpdater),this.updaterFactory.makeTableLinePolicy(t,e,e.hostUpdater),this.updaterFactory.makeTextLinePolicy(t,e)]}},{key:"updatePage",value:function(e,t){this.enterPage(e,t);for(var a=e.pagePendings;a.length>0;){var n=a.pop();if(!n.settled){var i=n.host;n.hostUpdater.updateHost(i,t)}n.free()}this.leavePage(e,t)}},{key:"enterPage",value:function(e,t){}},{key:"leavePage",value:function(e,t){}},{key:"getTableLevel",value:function(){return 0}},{key:"getTextboxUpdater",value:function(){return this.textboxUpdater}},{key:"getSnippetUpdaterAt",value:function(e){return this.snippetUpdaters[e]||(this.snippetUpdaters[e]=new Ln(this,e)),this.snippetUpdaters[e]}},{key:"guessSceneUpdater",value:function(e){var t=this,a=e.wholePathForGuess,n=this.getHostLevelByScenePath(a[0]),i=this,r=null,o=null,s=null,c=[];for(a.slice(1).forEach((function(e){r=t.selectSceneUpdater(e,n),o=r.selectScopeInfo(e).host,n+=r.getHostLevelByScenePath(e),i=r,s=o,c.push({innerUpdater:r,innerScene:o})}));c.length;){var l=c.pop(),u=l.innerUpdater,h=l.innerScene;if(h.isContain(e)){i=u,s=h;break}}return e.outdatedTable&&s&&s.layoutType===_.DOCLayoutType.SnippetScene?(s.outer.obsoleted=x.All,e.lines.push(s.outer),i.selectOuterUpdater(s.outer).sceneUpdater):i}},{key:"selectHostUpdaterByWholePath",value:function(e){var t=this,a=this.getHostLevelByScenePath(e[0]),n=a,i=this;return e.slice(1).forEach((function(e){i=t.selectSceneUpdater(e,n),a=i.getHostLevelByScenePath(e),n+=a})),i.getHostUpdaterAt(a)}},{key:"selectSceneUpdater",value:function(e,t){return[this.getTextboxUpdater(),this.getSnippetUpdaterAt(t)].find((function(t){return t.mateByScenePath(e)}))}},{key:"selectScenePath",value:function(e){return e[0]}}]),e}();s.a.mix(Dn,Ya);var Nn=a(3863),Fn=a(8841),Wn=a(6115),Gn=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLanePolicy",base:Gt,methodName:"init"},{baseName:"DOCLanePolicy",base:Gt,methodName:"acceptUpdatingLine"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCLanePolicy_init(e)}},{key:"freePack",value:function(e){}},{key:"makePack",value:function(e){return new Nn.a({parent:e,viewPage:e,coorSystem:e.coorSystem},{compose:e.view.compose})}},{key:"dropPacksInHost",value:function(e){var t=this,a=this.hostAgent.packToolkit.packUpdater,n=e.mainpages;n&&(n.forEach((function(e){var t=e.footnotes,n=e.endnotes;t&&t.notes.forEach((function(e){a.killPack(e.note_page)})),n&&n.notes.forEach((function(e){a.killPack(e.note_page)})),a.killPack(e)})),n.forEach((function(e){t.freePack(e)})))}},{key:"getPacksInHost",value:function(e){return e.mainpages}},{key:"getFinalPackInHost",value:function(e){if(!e)return null;var t=e.mainpages;return t&&t.length?t[t.length-1]:null}},{key:"getFirstPackInHost",value:function(e){if(!e)return null;var t=e.mainpages;return t&&t.length?t[0]:null}},{key:"getPrevPack",value:function(e){var t=e.host;if(this.isFirstPackInHost(e)){var a=this.hostUpdater.getPrevPage(t);return a&&this.getFinalPackInHost(a)}return this.getPrevPackInHost(e,t)}},{key:"getNextPack",value:function(e){var t=e.host;if(this.isFinalPackInHost(e)){var a=this.hostUpdater.getNextPage(t);return a&&this.getFirstPackInHost(a)}return this.getNextPackInHost(e,t)}},{key:"getNextPackInHost",value:function(e,t){var a=t.mainpages.indexOf(e);return t.mainpages[a+1]}},{key:"getPrevPackInHost",value:function(e,t){var a=t.mainpages.indexOf(e);return a>0?t.mainpages[a-1]:null}},{key:"isFirstPackInHost",value:function(e){return 0==e.host.mainpages.indexOf(e)}},{key:"isFinalPackInHost",value:function(e){if(!e.range)return!0;var t=e.host,a=this.hostUpdater.pageUpdater.viewUpdater.document,n=e.section,i=n.getColumnsCount(),r=a.sections.getSection(n.end),o=this.getPacksInSection(t,n).indexOf(e),s=e.range&&e.range.pos+e.range.len>=n.begin;if(e.lines.length>0&&e.lines[e.lines.length-1].isPageBroken)return!0;var c=e.lines[e.lines.length-1];if(c.isSnippetLine&&c.isBrokenAfter)return!0;if(e.range){var l=a.getDataLogic("final").getPapx(e.range.pos);if(l.prop.getPropVal("page_break_before")&&s&&l.pos===e.range.pos)return!0}if(e.range){var u=e.range.pos+e.range.len,h=a.getDataLogic("final").getPapx(u),d=u==h.pos,p=h.prop.getPropVal("page_break_before");if(d&&p)return!0}if(s){var g=e.rect.top+e.lines[e.lines.length-1].rect.bottom-e.lines[0].rect.top;return Math.floor(g)===Math.floor(t.inner_rect.bottom)&&o===i-1||!this.compatWidthNextSection(n,r)}return o==i-1}},{key:"compatWidthNextSection",value:function(e,t){return!(!e||!t||t.begin==e.begin)&&(t.getMarkType()==Fn.a&&e.getPageOrientation()==t.getPageOrientation()&&e.getTextFlow()==t.getTextFlow()&&e.getPageWidth()==t.getPageWidth()&&e.getPageHeight()==t.getPageHeight())}},{key:"getSectionByPack",value:function(e,t){if(!t)return e.host.section;var a=this.hostUpdater.pageUpdater.viewUpdater.document,n=a.concernRanges[0],i=n.pos,r=this.getPrevPack(e);if(r)if(r.packRange)i=r.packRange.end;else{var o=r.calcBrokenInfo();i=t.packUpdater.settledPos(r,n,o)}return a.sections.getSection(i)}},{key:"makeSureFirstPack",value:function(e){var t=e.mainpages&&e.mainpages[0];if(!t){t=this.makePack(e),e.mainpages=[t];var a=this.getSectionByPack(t);t.section=a,this.hostUpdater.pendingAt(t,0)}var n=this.calcPackRect(e,0),i=!I.a.equal(t.rect,n);t.rect=n,(e.conflicting||i)&&this.hostUpdater.pendingAt(t,0)}},{key:"calcMaxBottom",value:function(e,t){for(var a=Number.MIN_SAFE_INTEGER,n=0;n<t;++n){var i=e.mainpages[n].rect.bottom;a=a<i?i:a}return a}},{key:"getPacksInSection",value:function(e,t){var a=[];return e.mainpages.forEach((function(e){e.section===t&&a.push(e)})),a}},{key:"calcPackRect",value:function(e,t){var a=e.mainpages[t],n=e.mainpages[t].section,i=n.getColumnsCount(),r=this.getPacksInSection(e,n).indexOf(a),o=0==r?0:n.getColumnItem(r-1).space,s=n.getColumnItem(r).columnWidth,c=n.getColumnsBidi(),l=e.inner_rect;if(n!==e.section){var u=Object(T.Ti2Px)(n.getPageWidth()),h=n.getPageMargin(),d=Object(T.Ti2Px)(h.left),p=u-Object(T.Ti2Px)(h.right),g=e.inner_rect.top,f=e.inner_rect.bottom;l=I.a.initByRawRect({left:d,top:g,right:p,bottom:f})}var v=0==t?l.left:e.mainpages[t-1].rect.right+Object(T.Ti2Px)(o),m=l.top,y=l.height,k=l.right;c&&(k=0==t?l.right:e.mainpages[t-1].rect.left-Object(T.Ti2Px)(o));var b=Object(T.Ti2Px)(s);0==r&&t>0||r>=i?(v=l.left,c&&(k=l.right),m=this.calcMaxBottom(e,t),y=l.bottom-m):t>0&&(m=e.mainpages[t-1].rect.top,y=l.bottom-m),c&&(v=k-b);var P=n.getMultiPages(),x=n.getGutterMargin(),_=this.hostUpdater.pageUpdater.viewUpdater.document,C=_.settings.getGutterPos(),w=0,S=0,L=0,R=0;switch(P){case Wn.f.MultiplePages_Normal:var O=n.getPageOrientation();if(_.sections.getSection(0).getPageOrientation()!==O)O===Wn.g.PageOrientation_Portrait?C===Wn.e.GutterPos_PageLeftRight?w+=x:L+=x:C===Wn.e.GutterPos_PageLeftRight?S+=x:L+=x;else if(C===Wn.e.GutterPos_PageTopBottom)w+=x;else{var B=!0;B=n.getTextFlow()&Wn.h.TypoTextFlow_Vert_L2R_Norm?!B:!n.getGutterPlacment(),n.isOddEvenDiff()&&e.pageNum%2==0&&(B=!B),B?L+=x:R+=x}break;case Wn.f.MultiplePages_MirrorMargins:case Wn.f.MultiplePages_2PagesPerSheet:case Wn.f.MultiplePages_BookFold:case Wn.f.MultiplePages_ReversBookFold:}return I.a.initByOriginAndSize({x:v+Object(T.Ti2Px)(L),y:m+Object(T.Ti2Px)(w)},{width:b-Object(T.Ti2Px)(L+R),height:y-Object(T.Ti2Px)(w+S)})}},{key:"fillPackInSection",value:function(e,t){var a=e.host,n=this.makePack(a),i=a.mainpages.indexOf(e);i==a.mainpages.length-1?a.mainpages.push(n):a.mainpages.splice(i+1,0,n),n.section=t;var r=this.calcPackRect(a,i+1);return n.rect=r,n}},{key:"dockPackInHost",value:function(e,t){var a=e.host,n=a.mainpages.indexOf(e);e.section=this.getSectionByPack(e,t);var i=this.calcPackRect(a,n);e.rect=i,e.renderInfo&&(e.renderInfo.moved=!0);var r=this.getPrevPack(e);r&&r.viewPage===e.viewPage?Math.floor(r.rect.top)!=Math.floor(e.rect.top)&&(e.isSecFirstPack=!0):e.isSecFirstPack=!0,Math.round(i.right)===Math.round(a.inner_rect.right)&&(e.isSecLastPack=!0)}},{key:"pushNextPackInHost",value:function(e,t){var a=e.host,n=a.mainpages.indexOf(e),i=a.mainpages&&a.mainpages[n+1];if(!i){i=this.makePack(a),a.mainpages.push(i);var r=this.getSectionByPack(i,t);i.section=r;var o=this.calcPackRect(a,n+1);return i.rect=o,void this.hostUpdater.pendingAt(i,0)}var s=this.compatWithNextPack(e,i,t);!a.conflicting&&s||this.hostUpdater.pendingAt(i,0)}},{key:"compatWithNextPack",value:function(e,t,a){for(var n=e.rect.bottom,i=this.getPrevPack(e);i&&i.section===e.section&&i.rect.top==e.rect.top;)n=i.rect.bottom>n?i.rect.bottom:n,i=this.getPrevPack(i);if(t&&t.lines&&t.lines.length){var r=e&&e.lines[e.lines.length-1],o=t.lines[0];return a.packUpdater.settledPos(e)==t.lines[0].range.begin&&t.rect&&Math.round(t.rect.top)==Math.round(n)&&r&&!r.isBrokenAfter&&!o.isBrokenBefore}return!1}},{key:"forcedToAcceptUpdatingLine",value:function(e,t){if(e.lines.length<=1&&Math.round(e.rect.top)==Math.round(e.viewPage.inner_rect.top))return!0;if(e.lines.length>1&&t.prevRepeatInfo&&t.prevRepeatInfo.repeatLines.length>0){for(var a=!0,n=0;n<e.lines.length-1;n++){if(!e.lines[n].isRepeatHeaderRow){a=!1;break}}return a}return!e.lines.some((function(e){return e.layoutType!==_.DOCLayoutType.TextLine||0!==e.rect.height}))}},{key:"acceptUpdatingLine",value:function(e,t){var a=e.section,n=e.host,i=a.getColumnsCount(),r=t.updatingLine;return r.isSnippetLine&&r.isBrokenAfter&&i>1?(n.conflicting=!0,!1):this.mixin_DOCLanePolicy_acceptUpdatingLine(e,t)}}]),e}();s.a.mix(Gn,Gt);var jn=a(5741),Vn=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostAgent",base:at,methodName:"init"},{baseName:"DOCHostAgent",base:at,methodName:"pushNextPack"},{baseName:"DOCHostAgent",base:at,methodName:"isDataDone"},{baseName:"DOCHostAgent",base:at,methodName:"compatWithNextPack"},{baseName:"DOCHostAgent",base:at,methodName:"onEnterPack"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCHostAgent_init(e,t)}},{key:"makePackToolkit",value:function(){var e=new Pn(this),t=new bn(this);return{packUpdater:this.makePackUpdater(),lanePolicy:new Gn(this),layersPolicy:e,embedPolicy:t}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.makeLinePolicies(this),[new wn])}},{key:"calcBodyRange",value:function(e,t){return this.document.concernRanges[0]}},{key:"pushNextPack",value:function(e,t){var a=e.host;this.packToolkit.lanePolicy.isFinalPackInHost(e)||a.conflicting||this.mixin_DOCHostAgent_pushNextPack(e,t)}},{key:"onEnterPack",value:function(e,t){var a=this.packToolkit.lanePolicy.getPrevPack(e);t.prevRepeatInfo=this.getRepeatHeaderInfo(a),this.mixin_DOCHostAgent_onEnterPack(e,t)}},{key:"checkRepeatHeaderLine",value:function(e,t){for(var a=this.getRepeatHeaderInfo(e),n=t.lines,i=n.length,r=0,o=0;o<i&&n[o].isRepeatHeaderRow&&(r++,!(a&&a.repeatLines.length<r));o++);return!(a&&r<a.repeatLines.length)}},{key:"compatWithNextPack",value:function(e,t){return!!(t&&t.lines&&t.lines.length&&this.checkRepeatHeaderLine(e,t))&&this.mixin_DOCHostAgent_compatWithNextPack(e,t)}},{key:"getUsableHeightOfPack",value:function(e){return e.rect.height}},{key:"getFieldZonePolicies",value:function(){return[new ka]}},{key:"getFootnoteEndnotePolicies",value:function(){return this.footnoteEndnotePolicies||(this.footnoteEndnotePolicies=[new jn.c,new jn.a,new jn.b]),this.footnoteEndnotePolicies}},{key:"getViewUpdater",value:function(){return this.hostUpdater.viewUpdater}},{key:"isDataDone",value:function(e,t){var a=this.mixin_DOCHostAgent_isDataDone(e,t);if(a){var n=this.document.getSubDocRange(l.MainText),i=t.bodyRange;i.pos+i.len<n.pos+n.len&&(t.lookaheadPosForPack=i.pos+i.len,this.getViewUpdater().maxUpdatedPos=i.pos+i.len)}return a}},{key:"onLeavePack",value:function(e,t){var a=this.packToolkit.lanePolicy,n=a.isFinalPackInHost(e),i=e.host,r=e.section;if(e.lines.length>0&&!n){var o=e.getTextRect();e.rect.bottom=o.bottom,e.textHeight=o.height}n&&a.getPacksInSection(i,r).forEach((function(t){t.rect.bottom=e.rect.bottom}))}},{key:"getUsableHeightOfHost",value:function(e){return e.host.inner_rect.height}},{key:"getRepeatHeaderInfo",value:function(e){for(var t=this.packToolkit.lanePolicy,a=e,n={repeatLines:[],totalHeight:0};a&&!n.isOver;)a.calcRepeatInfo(this.document,n),a=t.getPrevPack(a);return n}}]),e}();s.a.mix(Vn,at);var zn=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.viewStatus=e,a}return ee()(t,e),t}(xa),Zn=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.isInFooter=!1,a}return ee()(t,e),t}(xa),qn=(function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.outerStartFromScratch=e.startFromScratch,a.hostSubdocType=l.TextboxInHF,a.tableLevel=0,a.isInTextbox=!0,a}ee()(t,e)}(xa),function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCWordMainLanePolicy",base:Gn,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCWordMainLanePolicy_init(e)}},{key:"getPrevPack",value:function(e){var t=e.host;if(this.isFirstPackInHost(e)){var a=this.hostUpdater.pageUpdater.getPrevPage(t);return a&&this.getFinalPackInHost(a)}return this.getPrevPackInHost(e,t)}},{key:"getNextPack",value:function(e){var t=e.host;if(this.isFinalPackInHost(e)){var a=this.hostUpdater.pageUpdater.getNextPage(t);return a&&this.getFirstPackInHost(a)}return this.getNextPackInHost(e,t)}},{key:"isFinalPackInHost",value:function(e){return!1}}]),e}());s.a.mix(qn,Gn);var Xn=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCWordContentAgent",base:Vn,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCWordContentAgent_init(e,t)}},{key:"makePackToolkit",value:function(){var e=new Pn(this),t=new bn(this);return{packUpdater:this.makePackUpdater(),lanePolicy:new qn(this),layersPolicy:e,embedPolicy:t}}},{key:"calcBodyRange",value:function(e,t){var a=e.section,n=this.view.data.doc,i=n.sections.getItem(n.sections.indexOf(a)),r=i&&i.begin!=a.begin?i.end:0;return{pos:r,len:a.end-r}}},{key:"getViewUpdater",value:function(){return this.hostUpdater.pageUpdater.viewUpdater}},{key:"onUpdatingLineRejected",value:function(e,t){return B.c.Pass}},{key:"onLeavePack",value:function(e,t){e.range&&(e.textHeight=e.getTextRect().height)}}]),e}();s.a.mix(Xn,Vn);var Yn=function(){function e(t,a,n){i()(this,e),this.init(t,a,n)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostUpdater",base:Ma,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e,t,a){this.mixin_DOCHostUpdater_init(e,t,a)}},{key:"initHostPolicies",value:function(){this.balanceAgent=new Xn(this,this.pageUpdater.viewUpdater.view),this.hostAgents=[this.balanceAgent]}},{key:"makeLinePolicies",value:function(e){var t=e.view;return[new Un(t,e,e.hostUpdater),this.updaterFactory.makeTableLinePolicy(t,e,e.hostUpdater),this.updaterFactory.makeTextLinePolicy(t,e)]}},{key:"getTableLevel",value:function(){return 0}},{key:"updateHost",value:function(e,t){var a=this.makeHostStatus(t);this.balanceUpdate(e,a)}},{key:"balanceUpdate",value:function(e,t){var a=!1;do{a=this._balanceUpdate(e,t)}while(!a)}},{key:"_balanceUpdate",value:function(e,t){var a=e.hostPendings;if(!this.checkHost||this.checkHost(e,t)){y("[typo] Enter host("+e.layoutName+") conflicting("+e.conflicting+") at level "+(this.getTableLevel()||0)),this.enterHost(e,t);for(var n=a[a.length-1].pack.section;a.length>0&&a[a.length-1].pack.section===n;){var i=a.pop(),r=i.pack;this.bindPackToolkit(r,t),t.packUpdater.updatePack(r,t),this.cachePackInfo(r,t),i.settled=!0}var o=this.leaveHost(e,t);return y("[typo] Leave host("+e.layoutName+") at level "+(this.getTableLevel()||0)),o}}},{key:"leaveHost",value:function(e,t){if(t.balanceStatus&&t.balanceStatus.balanceDone){var a=t.balanceStatus.balancePacks;return this.balanceDone(e,a,t),!0}return this.doBalance(e,t)}},{key:"isSectionEnd",value:function(e,t){for(var a=!1,n=e.length-1;n>=0;--n)if(e[n].range){a=e[n].range.pos+e[n].range.len>=t.begin;break}return a}},{key:"doBalance",value:function(e,t){var a=this,n=e,i=t.updatingPack.section,r=t.balanceStatus.balancePacks,o=!1;if(this.isSectionEnd(r,i))t.balanceStatus.successHeight=t.balanceStatus.testHeight,t.balanceStatus.successOnce=!0,t.balanceStatus.endHeight-t.balanceStatus.beginHeight<=1?t.balanceStatus.balanceDone=!0:(t.balanceStatus.endHeight=t.balanceStatus.testHeight,t.balanceStatus.testHeight=(t.balanceStatus.beginHeight+t.balanceStatus.endHeight)/2),o=!0;else if(t.balanceStatus.successOnce&&t.balanceStatus.endHeight-t.balanceStatus.beginHeight<=1)t.balanceStatus.testHeight=t.balanceStatus.successHeight,t.balanceStatus.balanceDone=!0,o=!0;else{if(t.balanceStatus.endHeight-t.balanceStatus.beginHeight<=1)n.inner_rect.bottom-t.balanceStatus.balancePacks[0].rect.top-t.balanceStatus.endHeight<=1?(t.balanceStatus.successOnce=!0,t.balanceStatus.successHeight=t.balanceStatus.testHeight):(t.balanceStatus.endHeight=n.inner_rect.bottom-t.balanceStatus.balancePacks[0].rect.top,t.balanceStatus.testHeight=(t.balanceStatus.beginHeight+t.balanceStatus.endHeight)/2);else t.balanceStatus.beginHeight=t.balanceStatus.testHeight,t.balanceStatus.testHeight=(t.balanceStatus.beginHeight+t.balanceStatus.endHeight)/2;o=!0}return!o||(r.forEach((function(e){e.rect.bottom=e.rect.top+t.balanceStatus.testHeight,a.pendingAt(e,0)})),n.conflicting=!0,!1)}},{key:"balanceDone",value:function(e,t,a){e.renderInfo&&(e.renderInfo.removed||(e.renderInfo.removed=[]));for(var n=0;n<t.length;++n){var i=t[n];if(i.range){if(a.lastPack=i,i.rect.height<i.textHeight){var r=i.getTextRect();i.rect.bottom=i.rect.top+r.height}}else i.renderInfo&&e.renderInfo.removed.push(i.renderInfo),a.packUpdater.killPack(i),e.mainpages.splice(e.mainpages.indexOf(i),1)}a.balanceStatus=null}},{key:"getMainPackIndex",value:function(e,t){return e.mainpages.indexOf(t)}},{key:"rootScope",value:function(){return{from:1,to:3}}},{key:"mateByScenePath",value:function(e){return this.selectScopeInfo(e).pack instanceof Nn.a}},{key:"selectScopeInfo",value:function(e){return{line:e[3],pack:e[2],host:e[1]}}},{key:"makeHostStatus",value:function(e){return new zn(e)}},{key:"getMentionedPosByScenePath",value:function(e){var t=-1,a=this.selectScopeInfo(e),n=a.host,i=a.pack,r=a.line;return r&&(t=i.lines.indexOf(r)),-1===t&&(t=i.lines.length),{viewPage:n,mainPack:i,lineIndex:t}}},{key:"getMentionedPosOfWholePath",value:function(e){return this.getMentionedPosByScenePath(e[0])}},{key:"compareMentionedPos",value:function(e,t){return e.viewPage===t.viewPage?e.mainPack===t.mainPack?e.lineIndex-t.lineIndex:this.getMainPackIndex(e.viewPage,e.mainPack)-this.getMainPackIndex(t.viewPage,t.mainPack):this.getViewPageIndex(e.viewPage)-this.getViewPageIndex(t.viewPage)}}]),e}();s.a.mix(Yn,Ma);var Kn=0,Jn=1,Qn=2,$n=3,ei=4,ti=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCPageUpdater",base:Dn,methodName:"init"},{baseName:"DOCSceneUpdater",base:Ya,methodName:"guessHostUpdater"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCPageUpdater_init(e),this.balanceUpdater=new Yn(this,this,0)}},{key:"initHostPolicies",value:function(){this.contentAgent=new Vn(this,this.viewUpdater.view),this.hostAgents=[this.contentAgent]}},{key:"pushContentPage",value:function(e,t){var a=this.primeHostAgent().packToolkit.lanePolicy;this.pushCoreRect(e,t)&&(this.bindDecorativePage(e,e.decorativePage),a.makeSureFirstPack(e))}},{key:"pushCoreRect",value:function(e,t){var a=e.section,n=Object(T.Ti2Px)(a.getPageWidth()),i=Object(T.Ti2Px)(a.getPageHeight()),r=a.getOriginPageMargin(),o=Object(T.Ti2Px)(r.top),s=Object(T.Ti2Px)(r.bottom),c=Object(T.Ti2Px)(r.left),l=n-Object(T.Ti2Px)(r.right),u=e.inner_rect;return e.header&&(o=o>=0?Math.max(o,e.header.rect.bottom):Math.abs(o)),e.footer&&(s=s>=0?Math.max(s,e.outer_rect.height-e.footer.rect.top):Math.abs(s)),e.inner_rect=I.a.initByRawRect({left:c,top:Math.abs(o),right:l,bottom:i-Math.abs(s)}),u&&(e.inner_rect.top>u.top?e.isMovingDown=!0:e.inner_rect.top<u.top&&(e.isMovingUp=!0)),e.conflicting||!I.a.equal(e.inner_rect,u)}},{key:"cleanPage",value:function(e,t){delete e.isMovingDown,delete e.isMovingUp}},{key:"bindDecorativePage",value:function(e,t){t&&(e.header=t.header,e.footer=t.footer,t.inner_rect=e.inner_rect)}},{key:"rootScope",value:function(){return{from:1,to:3}}},{key:"mateByScenePath",value:function(e){return this.selectScopeInfo(e).pack instanceof Nn.a}},{key:"selectScopeInfo",value:function(e){return{line:e[3],pack:e[2],host:e[1]}}},{key:"isFirstPage",value:function(e){return!!e&&e===this.viewUpdater.view.layout_pages[0]}},{key:"isFinalPage",value:function(e){if(!e)return!1;var t=this.viewUpdater.view.layout_pages;return e===t[t.length-1]}},{key:"getPrevPage",value:function(e){var t=this.viewUpdater.view.layout_pages,a=t.indexOf(e);return-1===a||0===a?null:t[a-1]}},{key:"getNextPage",value:function(e){var t=this.viewUpdater.view.layout_pages,a=t.indexOf(e);return-1===a||t.length-1===a?null:t[a+1]}},{key:"makeHostStatus",value:function(e){return new zn(e)}},{key:"usablePendingPage",value:function(e){return!!e.mainpages&&e.mainpages.some((function(e){return 0!==e.lines.length||e.pendingLines&&0!==e.pendingLines.length}))}},{key:"reuseUpdatingPage",value:function(e,t){return!this.farAwayFromUpdatingPage(e,t)&&(this.pushUpdatingPage(e,t),!0)}},{key:"farAwayFromUpdatingPage",value:function(e,t){if(!t.updatingPage||t.updatingPage.section!==t.sectionInfo.section)return!0;var a=this.settledPos(e,t),n=this.pendingPos(e,t);if(a==n){var i=this.primeHostAgent().packToolkit.lanePolicy,r=i.getFinalPackInHost(t.lastPage),o=i.getFirstPackInHost(t.updatingPage);if(o&&o.lines&&o.lines.length&&o.lines[0].isBrokenBefore)return!r||!r.calcBrokenInfo().brokenLines}return a+500<n}},{key:"pushUpdatingPage",value:function(e,t){var a=this.primeHostAgent(),n=a.packToolkit.lanePolicy,i=n.getFinalPackInHost(t.lastPage),r=n.getFirstPackInHost(t.updatingPage);i?r&&!a.compatWithNextPack(i,r)&&this.pendingAt(r,0):r&&r.lines&&r.lines.length&&0!=r.lines[0].range.begin&&this.pendingAt(r,0)}},{key:"settledPos",value:function(e,t){if(!t.lastPage)return 0;var a=this.primeHostAgent().packToolkit,n=a.lanePolicy;return a.packUpdater.settledPos(n.getFinalPackInHost(t.lastPage))}},{key:"pendingPos",value:function(e,t){var a=this.primeHostAgent().packToolkit.lanePolicy.getFirstPackInHost(t.updatingPage);return a&&a.lines.length?a.lines[0].range.begin:0}},{key:"compareMentionedPos",value:function(e,t){return e.viewPage===t.viewPage?e.mainPack===t.mainPack?e.lineIndex-t.lineIndex:this.getMainPackIndex(e.viewPage,e.mainPack)-this.getMainPackIndex(t.viewPage,t.mainPack):this.getViewPageIndex(e.viewPage)-this.getViewPageIndex(t.viewPage)}},{key:"getMainPackIndex",value:function(e,t){return e.mainpages.indexOf(t)}},{key:"getViewPageIndex",value:function(e){return e.layout_index}},{key:"getMentionedPosByScenePath",value:function(e){var t=-1,a=this.selectScopeInfo(e),n=a.host,i=a.pack,r=a.line;return r&&(t=i.lines.indexOf(r)),-1===t&&(t=i.lines.length),{viewPage:n,mainPack:i,lineIndex:t}}},{key:"getMentionedPosOfWholePath",value:function(e){return this.getMentionedPosByScenePath(e[0])}},{key:"pendingToPage",value:function(e,t){var a=this,n=e.host.viewPage.layout_index,i=e.host.view;-1===i.pendingPages.indexOf(n)&&(i.pendingPages.push(n),i.pendingPages.sort((function(e,t){return e-t}))),this.viewUpdater.schedulerUpdateTask();var r=e.host.viewPage.pagePendings,o=this.selectScenePath(t),s=this.getMentionedPosByScenePath(o),c=r.findIndex((function(e){var n=e.pack.getWholePath(),i=a.compareMentionedPos(a.getMentionedPosByScenePath(a.selectScenePath(n)),s);return 0!==i?i<0:n.length<t.length}));-1===c&&(c=r.length),r.splice(c,0,e)}},{key:"finished",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.viewUpdater.view.pageCount,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.viewUpdater.view,n=a.layout_pages;if(a.pageCount){var i=this.primeHostAgent().packToolkit.lanePolicy,r=i.getFinalPackInHost(n[e-1]),o=n[e-1].range,s=t?this.viewUpdater.document.concernRanges[0]:this.viewUpdater.document.getSubDocRange(l.MainText);return o&&o.pos+o.len===s.pos+s.len&&!r.calcBrokenInfo().brokenLines}return!1}},{key:"dockPack",value:function(e,t){var a=e.rect;this.primeHostAgent().packToolkit.lanePolicy.dockPackInHost(e,t),e.backupInfo={},e.backupInfo.oldRect=a,e.backupInfo.oldTextHeight=e.textHeight}},{key:"checkBeforeUpdate",value:function(e,t){var a=e.host;if(Math.round(e.rect.top)!=Math.round(e.backupInfo.oldRect.top)&&(a.conflicting=!0),e.isBalanced){if(a.conflicting)return ei;e.rect=e.backupInfo.oldRect}return Jn}},{key:"pushNextPack",value:function(e,t){if(!e.pendingLines||!e.pendingLines.length){var a=this.primeHostAgent().packToolkit.lanePolicy,n=e.host;if(a.isFinalPackInHost(e)){var i=n.mainpages.indexOf(e);if(i<n.mainpages.length-1){var r=i+1,o=n.mainpages.length-r;this.clearPacks(n,r,o,t)}}a.isFinalPackInHost(e)?this.primeHostAgent().pushNextHost(e):a.pushNextPackInHost(e,t)}}},{key:"clearPacks",value:function(e,t,a,n){e.renderInfo&&(e.renderInfo.removed||(e.renderInfo.removed=[]));for(var i=function(t){var a=e.mainpages[t];a.renderInfo&&e.renderInfo.removed.push(a.renderInfo),n.packUpdater.killPack(a),e.hostPendings.forEach((function(t){if(a===t.pack)return e.hostPendings.splice(e.hostPendings.indexOf(t),1),void e.pagePendings.splice(e.pagePendings.indexOf(t),1)}))},r=t;r<t+a;++r)i(r);e.mainpages.splice(t,a)}},{key:"updateHost",value:function(e,t){var a=this.makeHostStatus(t),n=e.hostPendings;if(!this.checkHost||this.checkHost(e,a)){for(y("[typo] Enter host("+e.layoutName+") conflicting("+e.conflicting+") at level "+(this.getTableLevel()||0)),this.enterHost(e,a);n.length>0;){var i=n.pop(),r=i.pack;this.bindPackToolkit(r,a),this.dockPack(r,a);var o=this.checkBeforeUpdate(r,a);this.actionInPackState(o,r,a,t),o===Jn&&(a.packUpdater.updatePack(r,a),i.settled=!0,o=this.checkAfterUpdate(r),this.actionInPackState(o,r,a,t))}this.leaveHost(e,a),y("[typo] Leave host("+e.layoutName+") at level "+(this.getTableLevel()||0))}}},{key:"actionInPackState",value:function(e,t,a,n){switch(e){case Kn:this.dropPack(t,a);break;case $n:this.reBalance(t,a,n);break;case ei:this.reLayout(t,a);break;case Qn:this.cachePackInfo(t,a),this.pushNextPack(t,a)}}},{key:"dropPack",value:function(e,t){var a=e.host;this.primeHostAgent().pushNextHost(e);var n=a.mainpages.indexOf(e);this.clearPacks(a,n,a.mainpages.length-n,t)}},{key:"reBalance",value:function(e,t,a){var n=this.makeHostStatus(a);n.lookaheadPosOfLayers=t.lookaheadPosOfLayers,this.balanceUpdate(e,n),this.pushNextPack(n.lastPack,t)}},{key:"reLayout",value:function(e,t){var a=this,n=this.primeHostAgent().packToolkit.lanePolicy,i=e.section,r=e.host,o=n.getPacksInSection(r,i),s=n.getPrevPack(o[0]);t.lookaheadPosOfLayers=s&&s.range?s.range.pos+s.range.len:0,r.renderInfo&&(r.renderInfo.removed||(r.renderInfo.removed=[]),o.forEach((function(e){e.renderInfo&&r.renderInfo.removed.push(e.renderInfo)}))),o.forEach((function(e){e.isBalanced=!1,t.packUpdater.killPack(e),a.pendingAt(e,0)}))}},{key:"checkParaRule",value:function(e){var t=this.viewUpdater.document,a=e.viewPage;e.range&&(t.getDataLogic("final").getPapx(e.range.pos).prop.getPropVal("page_break_before")&&(a.disableBalance=!0))}},{key:"checkAfterUpdate",value:function(e){if(!(e.lines.length>0||e.pendingLines&&e.pendingLines.length>0))return e.isBalanced?ei:Kn;var t=e.section,a=t.getColumnsCount();if(a<=1||!e.range)return Qn;this.checkParaRule(e);var n=e.host,i=this.primeHostAgent().packToolkit.lanePolicy,r=this.viewUpdater.document.sections.getSection(t.end),o=i.getPacksInSection(n,t).indexOf(e),s=e.range.pos+e.range.len>=t.begin;if(s&&(i.isFinalPackInHost(e)||n.disableBalance))return Qn;if(e.isBalanced){if(o!=a-1)return Qn;var c=this.effectByWrap(n,e),l=Math.round(e.backupInfo.oldTextHeight)!=Math.round(e.textHeight);return s?l?c?ei:$n:Qn:ei}return s&&i.compatWidthNextSection(t,r)?$n:Qn}},{key:"effectByWrap",value:function(e,t){var a=!1;return Nt.collectCardsBetween(e.layers.topCards,{begin:t.range.pos,end:t.range.pos+t.range.len},(function(e){a=!0})),a||Nt.collectCardsBetween(e.layers.textframes,{begin:t.range.pos,end:t.range.pos+t.range.len},(function(e){a=!0})),a||t.lines.forEach((function(e){e.sublines&&e.sublines.length>0&&(a=!0)})),a}},{key:"collectPacksInSection",value:function(e){var t=[],a=e.section,n=e.host,i=a.getColumnsCount();if(n.mainpages.forEach((function(e){e.section===a&&t.push(e)})),t.length<i)for(var r=this.primeHostAgent().packToolkit.lanePolicy,o=i-t.length,s=e,c=0;c<o;++c){var l=r.fillPackInSection(s,a);s=l,t.push(l)}return t}},{key:"initBalanceStatus",value:function(e,t,a,n){var i=t,r=(a+n)/2;e.balanceStatus={},e.balanceStatus.testHeight=r,e.balanceStatus.beginHeight=a,e.balanceStatus.endHeight=n,e.balanceStatus.balancePacks=i}},{key:"balanceUpdate",value:function(e,t){var a=this,n=e.host,i=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,o=e.rect.top,s=this.collectPacksInSection(e);s.forEach((function(e){var t=e.getTextRect().height;i=i>t?t:i,r=r<t?t:r})),this.initBalanceStatus(t,s,i,r),s.forEach((function(e){e.rect.top=o,e.rect.bottom=e.rect.top+t.balanceStatus.testHeight,a.balanceUpdater.pendingAt(e,0),e.isBalanced=!0,a.checkPendingForBalance(n,e)})),n.conflicting=!0,this.balanceUpdater.balanceUpdate(n,t)}},{key:"checkPendingForBalance",value:function(e,t){var a=this;e.hostPendings.forEach((function(e){t!==e.pack||e.hostUpdater===a.balanceUpdater||(e.hostUpdater=a.balanceUpdater)}))}}]),e}();s.a.mix(ti,Dn);var ai=a(5745),ni=a(5742),ii=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLanePolicy",base:Gt,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCLanePolicy_init(e)}},{key:"getPacksInHost",value:function(e){var t=[];return e.header&&t.push(e.header),e.footer&&t.push(e.footer),t}},{key:"dropPacksInHost",value:function(e){e.header&&(this.hostUpdater.selectPackToolkit(e.header),this.hostAgent.packToolkit.packUpdater.killPack(e.header)),e.footer&&(this.hostUpdater.selectPackToolkit(e.footer),this.hostAgent.packToolkit.packUpdater.killPack(e.footer))}}]),e}();s.a.mix(ii,Gt);var ri=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"markPendingCards",value:function(e,t,a){var n=this;if(this.layers){var i=this.layers,r=t.bodyRange,o={begin:a,end:r.pos+r.len};Nt.collectCardsBetween(i.embedShapes,o,(function(a){n._detachShape(e,t,a)}))}}}]),t}(bn),oi=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"markPendingCards",value:function(e,t,a){var n=this;if(this.layers){var i=this.layers,r=t.bodyRange,o={begin:a,end:r.pos+r.len};Nt.collectCardsBetween(i.topCards,o,(function(a){a.isWrap&&a.pos<t.hostStatus.lookaheadPosOfLayers||a.layoutInCell&&n._detachShape(e,t,a)})),Nt.collectCardsBetween(i.bottomCards,o,(function(a){a.layoutInCell&&n._detachShape(e,t,a)})),Nt.collectCardsBetween(i.textframes,o,(function(a){a.isWrap&&a.pos<t.hostStatus.lookaheadPosOfLayers||n._detachShape(e,t,a)})),this.notLayoutInCellPolicy.markPendingCardsBetween(e,t,o)}}},{key:"afterCommit",value:function(e,t,a){var n=t.hostStatus.host.contentPage,i=n.mainpages||[];return this.intersectByWraps(n,i,a)}},{key:"_commitSnippets",value:function(e,t,a){var n=this;this.snippetCards.forEach((function(i){y("[typo]    Commit snippet card("+i.begin+", "+i.end+") at page("+i.viewPage.layout_index+")"),"footer"===e.footer_type&&kn.adjustCardPos(i),n.notAllowoverPolicy.commit(i),n._attachShape(e,t,i),a&&a(i)})),this.snippetCards=[]}},{key:"revert",value:function(e,t,a){}}]),t}(Pn),si=function(){function e(t,a,n){i()(this,e),this.init(t,a,n)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostAgent",base:at,methodName:"init"},{baseName:"DOCHostAgent",base:at,methodName:"onPackDone"},{baseName:"DOCHostAgent",base:at,methodName:"onLeavePack"}]}}]),o()(e,[{key:"init",value:function(e,t,a){this.mixin_DOCHostAgent_init(e,t),this.isFooter=a}},{key:"mateOf",value:function(e){return this.isFooter?"footer"==e.footer_type:"header"==e.footer_type}},{key:"makePackToolkit",value:function(){return{packUpdater:this.makePackUpdater(),lanePolicy:new ii(this),layersPolicy:new oi(this),embedPolicy:new ri(this)}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.makeLinePolicies(this),[])}},{key:"calcBodyRange",value:function(e,t){var a=e.viewPage,n=a.section,i=ni.g(!this.isFooter,a.isSecFirstPage&&n.isFirstDiff(),a.pageNum%2==0&&n.isOddEvenDiff()),r=n.pos,o=this.document.getHeaderFooterRange(r,i);return o||(console.log("Header/Footer body range not found"),o={pos:0,len:0}),o}},{key:"getUsableHeightOfPack",value:function(e){return.5*e.viewPage.outer_rect.height}},{key:"calcPackRect",value:function(e){var t=I.a.initByRawRect(e.rect);if(e.lines&&e.lines.length){var a=e.viewPage,n=e.lines[e.lines.length-1].getLineBottom(),i=this.getUsableHeightOfPack(e);n>i&&(n=i);var r=a.section,o=Object(T.Ti2Px)(r.getPageHeader2Top()),s=Object(T.Ti2Px)(r.getPageFooter2Bottom());this.isFooter?(e.rect.bottom=a.outer_rect.height-s,e.rect.top!==e.rect.bottom-n&&e.renderInfo&&(e.renderInfo.moved=!0),e.rect.top=e.rect.bottom-n):(e.rect.top!==o&&e.renderInfo&&(e.renderInfo.moved=!0),e.rect.top=o,e.rect.bottom=o+n)}return!I.a.equal(e.rect,t)}},{key:"getFieldZonePolicies",value:function(){return this.fieldZonePolicies||(this.fieldZonePolicies=[new Tn.a,new In.a,new ka]),this.fieldZonePolicies}},{key:"getFootnoteEndnotePolicies",value:function(){return[]}},{key:"onParaDone",value:function(e,t){return B.c.Pass}},{key:"onPackDone",value:function(e,t){this.mixin_DOCHostAgent_onPackDone(e,t),this.calcPackRect(e)&&(t.hostStatus.host.conflicting=!0);var a=this.packToolkit.layersPolicy.commit(e,t);a&&a.packs.length&&this.pendingByIntersectInfo(a)}},{key:"pendingByIntersectInfo",value:function(e){var t=e.host,a=t.isDecorativePage?this:this.hostUpdater.viewUpdater.contentUpdater.contentAgent;e.packs.forEach((function(e){a.hostUpdater.pendingAt(e.pack,0)})),t.conflicting=!0}},{key:"onLeavePack",value:function(e,t){this.mixin_DOCHostAgent_onLeavePack(e,t),delete t.hostStatus.lookaheadPosOfLayers}}]),e}();s.a.mix(si,at);var ci=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCPageUpdater",base:Dn,methodName:"init"},{baseName:"DOCPageUpdater",base:Dn,methodName:"updatePage"},{baseName:"DOCPageUpdater",base:Dn,methodName:"leaveHost"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCPageUpdater_init(e)}},{key:"initHostPolicies",value:function(){this.headerPolicy=new si(this,this.viewUpdater.view,!1),this.footerPolicy=new si(this,this.viewUpdater.view,!0),this.hostAgents=[this.headerPolicy,this.footerPolicy]}},{key:"updatePage",value:function(e,t){this.mixin_DOCPageUpdater_updatePage(e,t)}},{key:"pushDecorativePage",value:function(e,t){var a=this.viewUpdater.view,n=e.section,i=e.isSecFirstPage,r=e.pageNum,o=n.getPageMargin(),s=Object(T.Ti2Px)(n.getPageWidth()),c=Object(T.Ti2Px)(n.getPageHeight()),l=Object(T.Ti2Px)(o.left),u=s-Object(T.Ti2Px)(o.right),h=Object(T.Ti2Px)(n.getPageHeader2Top()),d=c-Object(T.Ti2Px)(o.bottom);if(this.getHeader(n,i,r)){var p=this.makesureDecorativePage(e,t);if(!p.header){var g=new ai.a({parent:p,viewPage:p,coorSystem:e.coorSystem},{compose:a.compose});g.rect=I.a.initByRawRect({left:l,top:h,right:u,bottom:h}),g.footer_type="header",this.pendingToHost(g,p),p.header=g,e.header=g}}if(this.getFooter(n,i,r)){var f=this.makesureDecorativePage(e,t);if(!f.footer){var v=new ai.a({parent:f,viewPage:f,coorSystem:e.coorSystem},{compose:a.compose});v.rect=I.a.initByRawRect({left:l,top:d,right:u,bottom:d}),v.footer_type="footer",this.pendingToHost(v,f),f.footer=v,e.footer=v}}if(e.decorativePage&&this.isDecorativePageExpired(e)){var m=e.decorativePage;this.killPage(m),this.bindContentPage(m,e),m.header&&this.pendingToHost(m.header,m),m.footer&&this.pendingToHost(m.footer,m)}e.decorativePage&&!e.decorativePage.inner_rect&&(e.decorativePage.inner_rect=I.a.initByRawRect({left:Object(T.Ti2Px)(o.left),top:Object(T.Ti2Px)(o.top),right:s-Object(T.Ti2Px)(o.right),bottom:c-Object(T.Ti2Px)(o.bottom)}))}},{key:"makesureDecorativePage",value:function(e,t){return e.decorativePage||(e.decorativePage=this.viewUpdater.pageFactory.makePage(t),this.bindContentPage(e.decorativePage,e)),e.decorativePage}},{key:"bindContentPage",value:function(e,t){e.isDecorativePage=!0,e.section=t.section,e.sectionIndex=t.sectionIndex,e.isSecFirstPage=t.isSecFirstPage,e.pageNum=t.pageNum,e.outer_rect=t.outer_rect,e.contentPage=t,t.decorativePage=e}},{key:"getHeader",value:function(e,t,a){var n=this.viewUpdater.document;return t&&e.isFirstDiff()?n.getHeaderFooterRange(e.pos,ni.d):n.getHeaderFooterRange(e.pos,!e.isOddEvenDiff()||a%2?ni.f:ni.b)}},{key:"getFooter",value:function(e,t,a){var n=this.viewUpdater.document;return t&&e.isFirstDiff()?n.getHeaderFooterRange(e.pos,ni.c):n.getHeaderFooterRange(e.pos,!e.isOddEvenDiff()||a%2?ni.e:ni.a)}},{key:"enterPage",value:function(e,t){e.layout_index=t.updatingIndex}},{key:"getMentionedPosByScenePath",value:function(e){var t=-1,a=this.selectScopeInfo(e),n=a.host,i=a.pack,r=a.line;return r&&(t=i.lines.indexOf(r)),-1===t&&(t=i.lines.length),{viewPage:n,hfPack:i,lineIndex:t}}},{key:"pendingToPage",value:function(e,t){var a=this,n=e.host.viewPage.contentPage.layout_index,i=e.host.view;-1===i.pendingPages.indexOf(n)&&(i.pendingPages.push(n),i.pendingPages.sort((function(e,t){return e-t}))),this.viewUpdater.schedulerUpdateTask();var r=e.host.viewPage.pagePendings,o=this.selectScenePath(t),s=this.getMentionedPosByScenePath(o),c=r.findIndex((function(e){var n=e.pack.getWholePath(),i=a.compareMentionedPos(a.getMentionedPosByScenePath(a.selectScenePath(n)),s);return 0!==i?i<0:n.length<t.length}));-1===c&&(c=r.length),r.splice(c,0,e)}},{key:"compareMentionedPos",value:function(e,t){return e.viewPage===t.viewPage?e.hfPack===t.hfPack?e.lineIndex-t.lineIndex:this.getHFPackIndex(e.hfPack)-this.getHFPackIndex(t.hfPack):this.getViewPageIndex(e.viewPage)-this.getViewPageIndex(t.viewPage)}},{key:"getHFPackIndex",value:function(e){return"header"==e.footer_type?0:1}},{key:"getViewPageIndex",value:function(e){return e.layout_index}},{key:"rootScope",value:function(){return{from:1,to:3}}},{key:"mateByScenePath",value:function(e){var t=this.selectScopeInfo(e),a=t.host,n=t.pack;return a.footer===n||a.header===n}},{key:"selectScopeInfo",value:function(e){return{line:e[3],pack:e[2],host:e[1]}}},{key:"makeHostStatus",value:function(e){return new Zn(e)}},{key:"isInFooter",value:function(e){var t=this.selectScopeInfo(this.selectScenePath(e.getWholePath()));return t.pack===t.host.footer}},{key:"leaveHost",value:function(e,t){e.conflicting&&e.contentPage&&(e.contentPage.conflicting=!0),this.mixin_DOCPageUpdater_leaveHost(e,t)}},{key:"isDecorativePageExpired",value:function(e){var t=e.decorativePage;return!!t&&(void 0!==t.layout_index&&t.layout_index!==e.layout_index)}}]),e}();s.a.mix(ci,Dn);var li=a(7528),ui=function(){function e(t,a){i()(this,e),this.data=t,this.viewUpdater=a,this.view=t.typoinfo}return o()(e,[{key:"freePage",value:function(e){}},{key:"makePage",value:function(e){var t=this.view,a=new li.a(t,t.compose,{}),n=e.sectionInfo.section,i=Math.round(Object(T.Ti2Px)(n.getPageWidth())),r=Math.round(Object(T.Ti2Px)(n.getPageHeight())),o=Math.max(50,(t.width-i)/2);a.outer_rect=I.a.initByOriginAndSize({x:o,y:0},{width:i,height:r});var s=n.getPageMargin();return a.coreRectWithoutHF=I.a.initByRawRect({left:Object(T.Ti2Px)(s.left),top:Object(T.Ti2Px)(s.top),right:i-Object(T.Ti2Px)(s.right),bottom:r-Object(T.Ti2Px)(s.bottom)}),a}}]),e}(),hi=a(7214),di=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLanePolicy",base:Gt,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCLanePolicy_init(e)}},{key:"freePack",value:function(e){}},{key:"dropPackOfCell",value:function(e){var t=this,a=function(e){var a=t.hostAgent.packToolkit,n=a.embedPolicy,i=a.layersPolicy,r=a.packUpdater;n.reset(e),i.reset(e),r.killPack(e)};e.cell_page&&(a(e.cell_page),delete e.cell_page),e.diagCell&&e.diagCell.pages.forEach((function(e){a(e)}))}},{key:"dropPacksInHost",value:function(e){}},{key:"getPacksInHost",value:function(e){}},{key:"dockNextPackInHost",value:function(e,t){}},{key:"acceptUpdatingLine",value:function(e,t){var a=t.updatingLine,n=a.before_space||0,i=a.after_space||0,r=a.border&&a.border.before_width||0,o=a.border&&a.border.after_width||0,s=t.hostStatus.host,c=s.maxBottomBorder||0,l=s.maxBottomMargin||0,u=t.updatingLineTop+a.rect.height;u+=n+i+r+o+c+l;var h=t.hostStatus,d=!1;return!(d=h.outerReUpdate?u<=h.outerMaxUseableHeight-e.rect.top:u<=this.hostAgent.getUsableHeightOfPack(e))&&a.range.end===t.bodyRange.pos+t.bodyRange.len&&Object(Aa.f)(e.lines.length-1,e,t.dataStatus.glyphpool,!1)&&(d=!0),d}}]),e}();s.a.mix(di,Gt);var pi=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostAgent",base:at,methodName:"init"},{baseName:"DOCHostAgent",base:at,methodName:"onEnterPack"},{baseName:"DOCHostAgent",base:at,methodName:"onPackDone"},{baseName:"DOCHostAgent",base:at,methodName:"onLeavePack"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCHostAgent_init(e,t)}},{key:"makePackToolkit",value:function(){return{packUpdater:this.makePackUpdater(),lanePolicy:new di(this),layersPolicy:new Pn(this),embedPolicy:new bn(this)}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.sceneUpdater.makeLinePolicies(this),[])}},{key:"calcBodyRange",value:function(e,t){var a=t.hostStatus.outerRowData.cellDatas[t.updatingCellIndex];if(a){var n={pos:a.begin,len:a.end-a.begin};return void 0!==t.diagIndex&&(n=Da(n,t.diagIndex,t.dataStatus.data.doc)),n}return{pos:0,len:0}}},{key:"getUsableHeightOfPack",value:function(e){if(e.host.rowHeight&&e.host.rowHeight.exactly)return Number.MAX_SAFE_INTEGER;if(e.host.isHeaderRow||e.host.isRepeatHeaderRow)return Number.MAX_SAFE_INTEGER;if(e.parent.diagCell)return Number.MAX_SAFE_INTEGER;var t=this.hostUpdater.sceneUpdater,a=e.getScenePath(),n=t.rootScope(a),i=t.selectScopeInfo(a),r=t.selectHostAgent(i.pack).getUsableHeightOfPack(i.pack);return a.slice(n.to).forEach((function(e){r-=e.rect.top})),r}},{key:"onEnterPack",value:function(e,t){var a=t.hostStatus.host,n=e.parent;if(t.updatingCellIndex=a.tablecells.indexOf(n),n.diagCell?t.diagIndex=n.diagCell.pages.indexOf(e):delete t.diagIndex,this.mixin_DOCHostAgent_onEnterPack(e,t),t.hostStatus.outerStartFromScratch||this.hostUpdater.mementoForTableCell(e,t),e.rect.bottom=Number.MAX_SAFE_INTEGER,void 0===t.diagIndex)n.rect.bottom=Number.MAX_SAFE_INTEGER;else{var i=n.rect;if(t.hostStatus.lastTableLine)i=I.a.initByOriginAndSize(i.origin,{width:i.width,height:t.hostStatus.lastTableLine.rect.bottom-t.hostStatus.host.rect.top});else if(n.nextMergedCell){for(var r=n.nextMergedCell;r.nextMergedCell;)r=r.nextMergedCell;i=I.a.initByOriginAndSize(i.origin,{width:i.width,height:r.parent.rect.bottom-t.hostStatus.host.rect.top})}var o=t.hostStatus.outerRowData.cells[t.updatingCellIndex].diagonals;n.diagShapes=Va(t.diagIndex,o,i),n.layers||(n.layers=a.createLayersByPack(e)),n.diagShapes.forEach((function(e){n.layers.commitCard(e)}))}}},{key:"onPackDone",value:function(e,t){this.adjCellPackHeight(e,t),this.mixin_DOCHostAgent_onPackDone(e,t)}},{key:"onLeavePack",value:function(e,t){this.mixin_DOCHostAgent_onLeavePack(e,t);var a=e.parent;a.diagShapes&&(a.diagShapes.forEach((function(e){a.layers.removeCard(e)})),delete a.diagShapes)}},{key:"adjCellPackHeight",value:function(e,t){if(void 0===t.diagIndex){var a=0;if(e.lines&&e.lines.length>0){var n=e.lines[e.lines.length-1];Object(Aa.f)(e.lines.length-1,e,t.hostStatus.dataStatus.glyphpool,!1)?(a=n.rect.top,a-=n.border.before_width||0,a-=n.before_space||0):(a+=n.rect.bottom,a+=n.border.after_width||0,a+=n.after_space||0)}e.rect.bottom=e.rect.top+a;var i=t.hostStatus.host.selectLayersByPack(e);i&&e.range&&i.collectWrapCardsByRange(e.range.pos,e.range.pos+e.range.len).forEach((function(t){e.rect.bottom=Math.max(e.rect.bottom,t.rect.bottom)}))}else{var r=e.parent;if(r.nextMergedCell){for(var o=r.nextMergedCell;o.nextMergedCell;)o=o.nextMergedCell;e.rect.bottom=o.parent.rect.bottom-r.parent.rect.top}else e.rect.bottom=e.parent.rect.height}}},{key:"getUsableHeightOfLine",value:function(e){return this.hostUpdater.getUpperUpdater().selectHostAgent(e.parent).getUsableHeightOfPack(e.parent)-e.rect.top+1}},{key:"intersectByRange",value:function(e,t){var a=this,n={host:e,packs:[],wraps:[]};return e.tablecells.forEach((function(e){e.cell_page&&a.intersectPackByRange(e.cell_page,t,n),e.diagCell&&e.diagCell.pages.forEach((function(e){a.intersectPackByRange(e,t,n)}))})),n}}]),e}();s.a.mix(pi,at);var gi=a(3860),fi=a(30),vi=a.n(fi),mi=a(4107),yi=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"initWrapTools",value:function(){var e;this.wrapTools=(e={},vi()(e,Ge.e,Je),vi()(e,Ge.d,Qe),vi()(e,Ge.f,et),vi()(e,Ge.c,$e),e)}},{key:"getMetrixParent2Local",value:function(e,t){for(var a=new ze.Matrix2D,n=e.parent;n!==t;)a.translate(-n.rect.left,-n.rect.top),n=n.parent;return a}},{key:"collectWrapCards",value:function(e,t,a,n){var i=t.selectLayersByPack(e),r=t.decorativePage&&t.decorativePage.selectLayersByPack(e)||null,o=[],s=function(e){e.collectWrapCardsByRect(a).forEach((function(e){if(n){var t=e.anchor&&e.anchor.wrapMode===Ge.d?e.rect:e.boundaryRect;if(0===e.visualRotation&&(t.top>=a.bottom||t.bottom<=a.top)){var i=e.shapeProperty&&e.shapeProperty.outline&&e.shapeProperty.outline.width;if(i&&Object(T.Ti2Pt)(Object(mi.b)(i))<2.25)return}}o.push(e)}))};return r&&s(r),i&&s(i),o}},{key:"adjustUpdatingLine",value:function(e,a){if(e.viewPage.isDecorativePage&&e.layoutType!==gn.c.CellPage)return!0;var n=Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"adjustUpdatingLine",this).call(this,e,a),i=a.updatingLine,r=this.hostAgent.getUsableHeightOfPack(i.parent);return n&&a.forceAccept&&a.updatingLineTop>r&&(a.updatingLineTop=i.originTop),n}}]),t}(tt),ki=a(2011),bi=a(1736),Pi=function(){function e(t,a,n){i()(this,e),this.view=t,this.outerAgent=a,this.outerUpdater=n,this.initWrapTools()}return o()(e,[{key:"initWrapTools",value:function(){this.wrapTools={}}},{key:"freeLine",value:function(e){}},{key:"killLine",value:function(e){this.getInnerUpdater().killTableLine(e)}},{key:"mateByLine",value:function(e){return e.layoutType===_.DOCLayoutType.TableLine}},{key:"mateOf",value:function(e,t){return t.dataStatus.papx.prop.getPropVal("nest_level")>this.outerUpdater.getTableLevel()}},{key:"makeLine",value:function(e,t){var a=this.getInnerTableLevel(),n=Object(Ea.b)(t.dataStatus.final,t.dataStatus.pos,a);return t.rowData=n[0],this.makeTableLine(e,t,n[0],n[1])}},{key:"updateLine",value:function(e,t){var a={dataStatus:t.dataStatus,rowData:t.rowData,startFromScratch:!0,lastLineIsBrokenAfter:e.lines.length>1&&t.lastLine.isBrokenAfter,enterHostStatus:t.hostStatus.enterHostStatus,enterFromeTable:t.hostStatus.outerEnterFromeTable},n=t.updatingLine;this.initTableLine(e,t,n);var i=this.getInnerUpdater();this.pendingToTableLine(n,i),i.updateHost(n,a),this.onTableLineEnd(n),a.dataStatus.locate(n.range.end),delete t.rowData}},{key:"compatInPack",value:function(e,t){if(t.lastLine&&t.lastLine.layoutType===_.DOCLayoutType.TableLine&&0===e.lines.length)return!1;if(t.prevBrokenInfo){var a=t.prevBrokenInfo;if(a.brokenLines&&e.lines.length<a.brokenLines.length)return!1}var n=e.pendingLines[0];return!n.isBrokenBefore&&t.updatingLineTop===n.rect.top}},{key:"usablePendingLine",value:function(e,t){var a=e.pendingLines;return!(!a||0===a.length)&&(t.settledPos===a[0].range.pos&&this.mateByLine(a[0]))}},{key:"reuseUpdatingLine",value:function(e,t){var a=t.updatingLine,n=a.range,i=t.dataStatus.final.specTable.getTapx(n.begin,g.IT.Include,this.getInnerTableLevel());if(!i.good||n.end!==i.end)return!1;var r=this.outerAgent.getUsableHeightOfPack(e)-t.updatingLineTop;return a.rowHeight&&a.rowHeight.exactly&&!a.isBrokenAfter?a.rect.height<=r:(!e.isBalanced||!(a.isBrokenAfter||a.isBrokenBefore||a.rect.height>r))&&(null!=a.originLeft&&a.rect.left!=a.originLeft&&a.rect.offset(a.originLeft-a.rect.left,0),this.resetLine(e,t,a),this.moveTableLine(t,r),this.updateTableLine(e,t),this.clearOldStatus(e,t),!0)}},{key:"updateTableLine",value:function(e,t){var a=t.updatingLine,n=this.getInnerUpdater(),i=e.lines.length>1&&t.lastLine.isBrokenAfter;if(a.hostPendings.length>0){var r={dataStatus:t.dataStatus,startFromScratch:!0,lastLineIsBrokenAfter:i,enterHostStatus:t.hostStatus.enterHostStatus,enterFromeTable:t.hostStatus.outerEnterFromeTable};n.updateHost(a,r),this.onTableLineEnd(a),t.dataStatus.locate(a.range.end)}else{if(n.calcTableLineHeight(a),Object(Aa.c)(a),i)a.isBrokenAfter=i;else{var o=n.getCellDatas(a);a.isBrokenAfter=a.tablecells.some((function(e,t){var a=e.cell_page;if(a&&a.lines&&a.lines.length>0){var n=a.lines[a.lines.length-1];return n.layoutType===_.DOCLayoutType.TableLine&&n.isBrokenAfter||n.range.end!==o[t].end}}))}if(a.isMovingUp||a.isMovingDown){var s=!1;if(a.tablecells&&a.tablecells.some((function(e){if(e.merge_type===we.e.FIRST||e.merge_type===we.e.MIDDLE)return!1;if(e.merge_type===we.e.LAST){var t=Object(Aa.e)(e.rect.left,a);t&&t.diagCell&&(s=!0)}return e.diagCell&&(s=!0),s})),s){var c={dataStatus:t.dataStatus,startFromScratch:!0,lastLineIsBrokenAfter:i,enterHostStatus:t.hostStatus.enterHostStatus,enterFromeTable:t.hostStatus.outerEnterFromeTable};n.updateHost(a,c),this.onTableLineEnd(a),t.dataStatus.locate(a.range.end)}}}}},{key:"resetLine",value:function(e,t,a){var n=t.updatingLineTop-a.rect.top;if(a.oldTop=a.rect.top,a.rect.offset(0,n),a.oldIsBrokenBefore=a.isBrokenBefore,a.isHeaderRowProp){var i=this.getLastTableLine(t);i&&!i.isHeaderRow||(a.isHeaderRow=!0,a.isRepeatHeaderRow=!1)}this.initTableLine(e,t,a),a.conflicting=!0}},{key:"moveTableLine",value:function(e,t){var a=this,n=e.updatingLine;if(!!n.isBrokenBefore!=!!n.oldIsBrokenBefore||n.hasLayoutNotInCell)n.tablecells.forEach((function(e){var t=e.cell_page;t&&a.getInnerUpdater().pendingAt(t,0)}));else if(n.rect.top===n.oldTop){var i=n.host;i.isMovingUp?(n.isMovingUp=!0,this.getInnerUpdater().moveUpHost(n)):i.isMovingDown?(n.isMovingDown=!0,this.getInnerUpdater().moveDownHost(n,t)):i.isUpSize&&(n.isUpSize=!0,this.getInnerUpdater().upHostSize(n,t))}else n.rect.top<n.oldTop?(n.isMovingUp=!0,this.getInnerUpdater().moveUpHost(n)):(n.isMovingDown=!0,this.getInnerUpdater().moveDownHost(n,t))}},{key:"acceptUpdatingLine",value:function(e,t){return!0}},{key:"commitUpdatingLine",value:function(e,t){this.view.attachTableLine(t.updatingLine)}},{key:"isPageBroken",value:function(e,t){var a=t.lastLine;if(a.isBrokenAfter){for(var n=a.tablecells,i=0,r=0;r<n.length;++r){var o=n[r],s=o.merge_type;if(s===we.e.NONE||s===we.e.LAST){if(o.isBrokenAfter)return!0;i++}}if(i==n.length)return!0}return!1}},{key:"onUpdatingLineRejected",value:function(e,t){return t.lastLine&&t.lastLine.layoutType===_.DOCLayoutType.TableLine&&Object(Aa.c)(t.lastLine,!0),B.c.Pass}},{key:"getInnerTableLevel",value:function(){return this.outerUpdater.getTableLevel()+1}},{key:"getInnerUpdater",value:function(){var e=this.outerUpdater;return e.sceneUpdater.getHostUpdaterAt(e.hostLevel+1)}},{key:"makeRgdxa",value:function(e){var t=[];if(e.prop.table_row.rgdxa)e.prop.table_row.rgdxa.forEach((function(e){t.push(e)}));else{t.push(-108);var a=!1;if(e.cells.forEach((function(e){void 0===e.width||0!==e.width.type?a=!0:t.push(t[t.length-1]+e.width.width)})),a)for(var n=8522/e.cells.length,i=0;i<e.cells.length;++i)t.push(t[t.length-1]+n)}return t=t.map((function(e){return Object(T.Ti2Px)(e)}))}},{key:"getLastTableLine",value:function(e){return e.lastLine&&e.lastLine.layoutType===_.DOCLayoutType.TableLine?e.lastLine:null}},{key:"makeTableLine",value:function(e,t,a,n){var i=this,r={parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem},o=new ki.a(r,{compose:e.compose,tableline:null}),s=this.getLastTableLine(t);o.border={left_width:0,right_width:0,before_width:0,after_width:0},o.after_space=0,o.before_space=0,o.horzAlign=bi.Left,void 0!==a.prop.table_row.horzAlignMode&&(2===a.prop.table_row.horzAlignMode?o.horzAlign=bi.Center:3===a.prop.table_row.horzAlignMode&&(o.horzAlign=bi.Right)),o.spacing=0;void 0!==a.prop.table_row.cellMargin&&(o.hasSpacing=!0,o.spacing=a.prop.table_row.cellMargin.x<=15850?Object(T.Ti2Px)(a.prop.table_row.cellMargin.x/2):0),o.layer=this.getInnerTableLevel(),o.maxTopBorder=0,o.maxTopMargin=0,o.maxBottomMargin=0,o.maxBottomBorder=0,o.maxTopGap=0,o.isTableLast=a.isTableLast,o.rowHeight=a.prop.table_row.rowHeight,o.cantSplit=a.prop.table_row.cantSplit;var c,l=!1;!(c=a.prop.table_row.repeatHeader)||s&&!s.isHeaderRow||(l=!0),o.isHeaderRowProp=c,o.isHeaderRow=l,o.range=new O.a(a.begin,a.end,o),o.rect=I.a.initByRawRect({top:t.updatingLineTop,left:0,right:0,bottom:t.updatingLineTop});var u=this.makeRgdxa(a);a.cells.forEach((function(i){var r=t.packUpdater.isPackFirstLine(e,t,o)||!s,c=void 0!==i.border&&void 0!==i.border.top?i.border.top:null==a.prop.table_row.borders?void 0:r?a.prop.table_row.borders.top:a.prop.table_row.borders.insideH;void 0!==c&&(o.maxTopBorder=Math.max(o.maxTopBorder,c.lineWidth),i.topBorderWidth=c.lineWidth);var l=void 0!==i.innerMargin&&void 0!==i.innerMargin.top?i.innerMargin.top:a.prop.table_row.defCellInnerMarginTop;void 0!==l&&(o.maxTopMargin=Math.max(o.maxTopMargin,l));var u=!n,h=void 0!==i.border&&void 0!==i.border.bottom?i.border.bottom:null==a.prop.table_row.borders?void 0:u?a.prop.table_row.borders.bottom:a.prop.table_row.borders.insideH;void 0!==h&&(o.maxBottomBorder=Math.max(o.maxBottomBorder,h.lineWidth));var d=void 0!==i.innerMargin&&void 0!==i.innerMargin.bottom?i.innerMargin.bottom:a.prop.table_row.defCellInnerMarginBottom;void 0!==d&&(o.maxBottomMargin=Math.max(o.maxBottomMargin,d))}));var h=o.isRTL=a.prop.table_row.bidi;o.orgRgdxa=u[0],o.rect.left=0,o.rect.right=u[u.length-1]-u[0],o.leftIndent=Object(T.Ti2Px)(a.prop.table_row.leftIndent||0),o.rightIndent=Object(T.Ti2Px)(a.prop.table_row.rightIndent||0),o.maxTopBorder=Object(T.Ti2Px)(o.maxTopBorder),o.maxTopMargin=Object(T.Ti2Px)(o.maxTopMargin),o.maxBottomBorder=Object(T.Ti2Px)(o.maxBottomBorder),o.maxBottomMargin=Object(T.Ti2Px)(o.maxBottomMargin),o.hasMergedCell=!1;var d=a.cells.length;return o.tablecells=a.cells.map((function(e,t){var r=we.b.MIDDLE;0===t&&(r=we.b.HEAD),d-1===t&&(r=we.b.TAIL);var c=new we.c({parent:o,viewPage:o.viewPage,coorSystem:o.coorSystem},{index:t,cell_sum:d,pos_type:r,tablecell:null,height:0,compose:o.compose});c.cell2page_offset=An.a.initWithOrigin({x:0,y:0}),c.align_type=e.vertAlign||we.a.TOP,1===c.align_type&&(c.align_type=we.a.TOP),c.merge_type=e.vertMerge||we.e.NONE,c.merge_type!==we.e.FIRST||n&&!i.isCellLastMerged(u[t],n)||(c.merge_type=we.e.NONE),c.merge_type===we.e.MIDDLE&&(o.hasMergedCell=!0,n&&!i.isCellLastMerged(u[t],n)||(c.merge_type=we.e.LAST)),c.is_diag_cell=!1;var l=An.a.initWithOrigin({x:h?u[u.length-1]-u[t+1]:u[t]-u[0],y:0});if(c.rect=I.a.initByRawRect({top:l.y,left:l.x,right:h?u[u.length-1]-u[t]:u[t+1]-u[0],bottom:Number.MAX_SAFE_INTEGER}),c.merge_type===we.e.NONE||c.merge_type===we.e.FIRST){var p=void 0!==e.innerMargin&&void 0!==e.innerMargin.left?e.innerMargin.left:a.prop.table_row.defCellInnerMarginLeft;p=void 0!==p?Object(T.Ti2Px)(p):0;var g=void 0!==e.innerMargin&&void 0!==e.innerMargin.right?e.innerMargin.right:a.prop.table_row.defCellInnerMarginRight;g=void 0!==g?Object(T.Ti2Px)(g):0;var f=Aa.b.getTableTopGap(o),v=c.rect.width,m=p;if(o.spacing>0){if(0===t){var y=void 0!==e.border&&void 0!==e.border.left?e.border.left:void 0!==a.prop.table_row.borders?a.prop.table_row.borders.left:void 0;c.tableSpacing=void 0!==y?Math.max(2*o.spacing,Object(T.Ti2Px)(y.lineWidth/2)):2*o.spacing,m+=c.tableSpacing,v-=2*o.spacing}else c.tableSpacing=o.spacing,m+=c.tableSpacing,v-=o.spacing;t===a.cells.length-1?v-=2*o.spacing:v-=o.spacing}else f=s?Math.max(s.maxBottomBorder,o.maxTopBorder+o.maxTopMargin):o.maxTopBorder+o.maxTopMargin;o.hasSpacing&&e.topBorderWidth&&Aa.b.isFirstTableLine(o)&&(f+=Object(T.Ti2Px)(e.topBorderWidth)),o.maxTopGap=Math.max(f,o.maxTopGap),v-=p+g,f+=Aa.b.getTableTopSpacing(o);var k=e.diagonals;if(k){for(var b=[],P=k.length+1,x=0;x<P;++x){var _=new Ta.a({parent:c,viewPage:c.viewPage,coorSystem:c.coorSystem},{compose:c.compose,cellpage:null});_.textflow=new La.a(0),_.rect=I.a.initByRawRect({left:m,top:f,right:m+v,bottom:Number.MAX_SAFE_INTEGER}),b.push(_)}c.diagCell={pages:b},c.is_diag_cell=!0}else{var C=new Ta.a({parent:c,viewPage:c.viewPage,coorSystem:c.coorSystem},{compose:c.compose,cellpage:null});C.textflow=new La.a(0),C.rect=I.a.initByRawRect({left:m,top:f,right:m+v,bottom:Number.MAX_SAFE_INTEGER}),c.cell_page=C}}return c})),o}},{key:"isCellLastMerged",value:function(e,t){for(var a=this.makeRgdxa(t),n=!0,i=a[0],r=0;r<t.cells.length;++r){var o=t.cells[r],s=a[r+1];if(e>=i&&e<s){n=(o.vertMerge||we.e.NONE)!==we.e.MIDDLE;break}i=s}return n}},{key:"pendingToTableLine",value:function(e,t){e.tablecells.forEach((function(a){var n=a.cell_page;n&&t.pendingToHost(n,e)}))}},{key:"onTableLineEnd",value:function(e){for(var t=e.tablecells,a=0;a<t.length;++a){var n=t[a];n.cell_page&&n.cell_page._calculateTransposedCoordination()}}},{key:"calcSpaceArea",value:function(e,t){var a=I.a.initByRawRect({top:t.updatingLineTop,left:0,right:e.rect.width,bottom:t.updatingLineTop+1});return{xSpaceBegin:a.left,xSpaceEnd:a.right}}},{key:"adjustUpdatingLine",value:function(e,t){var a=t.updatingLine;return a.originLeft=a.rect.left,!0}},{key:"initTableLine",value:function(e,t,a){var n=e.lines,i=t.prevBrokenInfo;this._initTableLine(n,i,a)}},{key:"_initTableLine",value:function(e,t,a){if(a.isBrokenBefore=!a.isRepeatHeaderRow&&t&&t.brokenLines&&e.length<=t.brokenLines.length,a.isBrokenBefore){var n=t.brokenLines[e.length-1];a.tablecells.forEach((function(e,t){var a=n.tablecells[t];a&&e.cell_page&&a.cell_page&&(e.cell_page.prevPack=a.cell_page,a.cell_page.nextPack=e.cell_page)}))}}},{key:"_checkShapeLayoutNotInCell",value:function(e){var t=e.updatingLine;if(this.outerUpdater.getTableLevel()<1){var a=t.viewPage.layers;if(!a)return!1;var n=t.range.begin,i=t.range.end,r=a.collectCardsByRange(n,i);t.hasLayoutNotInCell=r.some((function(e){if(!e.layoutInCell)return t.hasLayoutNotInCell=!0,!0}))}else t.hasLayoutNotInCell=t.host.hasLayoutNotInCell;return t.shapeInfos&&(t.hasLayoutNotInCell=!1),t.hasLayoutNotInCell}},{key:"clearOldStatus",value:function(e,t){var a=t.updatingLine;delete a.isMovingUp,delete a.isMovingDown,delete a.isUpSize,delete a.oldIsBrokenBefore,delete a.oldTop,a.conflicting=!1}}]),e}(),xi=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"initWrapTools",value:function(){var e;this.wrapTools=(e={},vi()(e,Ge.e,Je),vi()(e,Ge.d,Qe),vi()(e,Ge.f,et),vi()(e,Ge.c,$e),e)}},{key:"makeTableLine",value:function(e,a,n,i){var r=Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"makeTableLine",this).call(this,e,a,n,i);return this.calcTableRowPos(e,a,n,r),r}},{key:"moveLine",value:function(e,t,a,n,i){var r=this,o=I.a.initByRawRect(t.rect);o.left-=t.orgRgdxa;var s=Ye(i,o),c=n?n.collectWrapCardsByRect(s):[];if(a&&a.collectWrapCardsByRect(s).forEach((function(e){c.push(e)})),!c.length)return!1;var l=0,u=0,h=this.outerAgent.getUsableWidthOfPack(t.parent),d=this.outerAgent.getUsableHeightOfPack(t.parent)-t.rect.top,p={minCardBottom:Number.MAX_SAFE_INTEGER,offset:0},g=[{left:0,right:h}];return c.some((function(a){var n=r.wrapTools[a.wrap_mode];if(!n)return!1;if((g=(g=n(g,s,a,i.clone().invert(),p)).filter((function(e){var t=Object(T.Ti2Px)(E.e.MIN_SUBLINE_WIDTH);return a.wrap_mode==Ge.e&&(t=Object(T.Ti2Px)(E.e.MIN_TIGHT_SUBLINE_WIDTH)),e.right-e.left>=t}))).length){var c=g[0];if(c.right-c.left>s.width)return u=c.left-o.left,!1}return l=p.offset,u=0,!(e.forceAccept&&l>d)||(l=0,a.boundary.top<=s.top&&(t.rect.offset(0,0-t.rect.top),!0))})),(!Object(Ie.d)(u,0)||!Object(Ie.d)(l,0))&&(t.rect.offset(u,l),!0)}},{key:"calcTableRowPos",value:function(e,t,a,n){if(!e.host.isTextFrame){var i=this.calcSpaceArea(e,t),r=i.xSpaceBegin,o=i.xSpaceEnd,s=Math.max(0,o-r),c=0;c=n.isRTL?s-n.rect.width-n.orgRgdxa:n.orgRgdxa,n.orgRgdxaLeft=c+n.leftIndent,n.rect.offset(n.orgRgdxaLeft>=Object(T.Ti2Px)(-32768)&&n.orgRgdxaLeft<=Object(T.Ti2Px)(32767)?n.orgRgdxaLeft:0,0);var l=n.rect.left,u=n.horzAlign,h=t.lastLine&&t.lastLine.layoutType===_.DOCLayoutType.TableLine?t.lastLine:null;if(!h||u!==bi.Center&&u!==bi.Right){var d=void 0;switch(u){case bi.Center:l=(s-(d=this.calcTableWidth(e,t,n)))/2;break;case bi.Right:d=this.calcTableWidth(e,t,n);var p=t.dataStatus.document.sections.getSection(n.range.begin);n.isRTL||(l=s-d),p.sepx.bidi&&(l=Math.max(0,l));break;case bi.Left:n.isRTL&&(l=0)}l+=r}else l=h.rect.left+(c-h.orgRgdxaLeft);n.rect.updateByOrigin(l,null)}}},{key:"calcTableWidth",value:function(e,t,a){var n=this,i=Object(Ea.c)(t.dataStatus.document,a.range.begin,this.getInnerTableLevel()),r=void 0,o=void 0;return i.rows.forEach((function(e){var t=n.makeRgdxa(e);r=r?Math.min(r,t[0]):t[0],o=o?Math.max(o,t[t.length-1]):t[t.length-1]})),o-r}},{key:"_getNoRepeatHeaderLines",value:function(e){for(var t=[],a=0;a<e.lines.length;a++){var n=e.lines[a];n.isRepeatHeaderRow||t.push(n)}return t}},{key:"initTableLine",value:function(e,t,a){var n=this._getNoRepeatHeaderLines(e),i=t.prevBrokenInfo;this._initTableLine(n,i,a)}},{key:"adjustUpdatingLine",value:function(e,a){if(Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"adjustUpdatingLine",this).call(this,e,a),e.viewPage.isDecorativePage&&e.layoutType!==_.DOCLayoutType.CellPage)return!0;for(var n=a.updatingLine,i=a.hostStatus.host,r=n.rect.top,o=i.selectLayersByPack(e),s=i.decorativePage&&i.decorativePage.selectLayersByPack(e)||null,c=Ke(n,e.parent);this.moveLine(a,n,o,s,c););var l=n.rect.top-r;if(l){var u=this.outerAgent.getUsableHeightOfPack(e)-(a.updatingLineTop+l);u<=0?n.rect.offset(0,r-n.rect.top):(a.updatingLineTop+=l,u<n.rect.height&&(n.isMovingDown=!0,n.conflicting=!0,this.getInnerUpdater().moveDownHost(n,u),this.updateTableLine(e,a),delete n.isMovingDown))}return!0}},{key:"commitUpdatingLine",value:function(e,a){Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"commitUpdatingLine",this).call(this,e,a),this.outerAgent.onCommitTableLine(e,a,a.updatingLine)}},{key:"onUpdatingLineRejected",value:function(e,t){var a=this,n=e.lines.length-1-1,i=e.lines[n],r=this.getInnerUpdater(),o=[];if(!i||!i.tablecells)return B.c.Pass;i.tablecells.forEach((function(t,s){if(t.merge_type===we.e.MIDDLE){var c=a.findFirstMergeCell(t.rect.left,e,n-1),l=c.tableLine,u=c.tableCell;u&&(u.cell_page?(r.pendingAt(u.cell_page,0),l.conflicting=!0,o.push(l)):u.diagCell&&(l.conflicting=!0,o.push(l)))}else t.merge_type===we.e.FIRST&&(t.cell_page?(r.pendingAt(t.cell_page,0),i.conflicting=!0,o.push(i)):t.diagCell&&(i.conflicting=!0,o.push(i)))}));var s={dataStatus:t.dataStatus,startFromScratch:!0,reUpdate:!0};i.isPackLast=!0,o.sort((function(e,t){return e.range.begin-t.range.begin}));var c=void 0;return o.forEach((function(e){c!==e&&(c=e,s.maxUseableHeight=i.rect.bottom-e.rect.top,s.dataStatus.locate(e.range.begin),a.getInnerUpdater().updateHost(e,s),s.dataStatus.locate(e.range.end))})),delete i.isPackLast,B.c.Pass}},{key:"findFirstMergeCell",value:function(e,t,a){for(var n=void 0,i=void 0,r=t,o=a;o>=0;--o){var s=r.lines[o];if(s.layoutType!==_.DOCLayoutType.TableLine)break;for(var c=!1,l=0;l<s.tablecells.length;++l){var u=s.tablecells[l];if(e>=u.rect.left&&e<u.rect.right){c=!0,u.merge_type===we.e.FIRST?(c=!0,n=u,i=s):u.merge_type===we.e.NONE&&(c=!1);break}if(e<u.rect.left)break}if(!c)break}return{tableLine:i,tableCell:n}}}]),t}(Pi),_i=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"mateByLine",value:function(e){return e.isHeaderRowProp}},{key:"mateOf",value:function(e,t){var a=t.prevRepeatInfo;if(!a||!a.repeatLines||0==a.repeatLines.length||a.isAllRepeatLine)return!1;if(a.totalHeight>=e.rect.height)return!1;var n=a.repeatLines,i=e.lines.length,r=t.dataStatus.final.specTable,o=this.getInnerTableLevel();if(o>1||l.MainText!=t.dataStatus.subdocType)return!1;var s=r.getTapx(t.dataStatus.pos,g.IT.Include,o);if(s.good&&s.prop&&s.prop.table_row&&s.prop.table_row.repeatHeader)return t.prevRepeatInfo=null,!1;if(i<n.length&&s.good){var c=r.getTapx(n[i].range.pos,g.IT.Include,o);return!Object(Ea.g)(c,s)}return!1}},{key:"makeLine",value:function(e,t){var a=t.prevRepeatInfo.repeatLines,n=e.lines.length,i=a[n].range.pos,r=this.getInnerTableLevel(),o=Object(Ea.b)(t.dataStatus.final,i,r),s=n+1<a.length&&o[1]||null;t.backupPos=t.dataStatus.pos,t.rowData=o[0],t.dataStatus.locate(i);var c=this.makeTableLine(e,t,o[0],s);return c.isRepeatHeaderRow=!0,c}},{key:"onLineDone",value:function(e,t){t.dataStatus.locate(t.backupPos),t.settledPos=t.backupPos}},{key:"usablePendingLine",value:function(e,t){var a=e.pendingLines;return!(!a||0===a.length)&&(t.prevRepeatInfo.repeatLines[e.lines.length].range.pos===a[0].range.pos&&this.mateByLine(a[0]))}},{key:"compatInPack",value:function(e,t){return!1}}]),t}(xi),Ci=function(){function e(){i()(this,e)}return o()(e,[{key:"makeTextLinePolicy",value:function(e,t){return new yi(e,t)}},{key:"makeTableLinePolicy",value:function(e,t,a){return new xi(e,t,a)}},{key:"makeTableAgent",value:function(e,t){return new pi(e,t)}},{key:"makeLayers",value:function(e){return new gi.a(e)}},{key:"makeLayersPolicy",value:function(e){return new Pn(e)}},{key:"makeEmbedPolicy",value:function(e){return new bn(e)}},{key:"makeRepeatHeaderLinePolicy",value:function(e,t,a){return new _i(e,t,a)}},{key:"getEmbedShapeFactory",value:function(){return nn}},{key:"getShapeCardFactory",value:function(){return hn}}]),e}(),wi=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCViewUpdater",base:w,methodName:"init"},{baseName:"DOCViewUpdater",base:w,methodName:"clearAll"},{baseName:"DOCViewUpdater",base:w,methodName:"onSettingsChanged"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCViewUpdater_init(e),this.totalElapse=0,this.updaterFactory=new Ci,this.pageFactory=new ui(e,this),this.contentUpdater=new ti(this),this.decorativeUpdater=new ci(this),this.commentUpdater=new $a(e),this.pageUpdaters=[this.decorativeUpdater,this.contentUpdater]}},{key:"clearAll",value:function(e){this.mixin_DOCViewUpdater_clearAll(e),this.dropPages(this.view,{from:0,to:this.view.layout_pages.length}),this.view.secPageCountCache.clear(),this.commentUpdater.clearAll(e)}},{key:"updateUntil",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.document.useCoreTypo){var a=this.view.expired;return this.view.expired=!1,a}this.pushView();var n=this.view,i=t.updatePages,r=!1,o=!1,s=null,l=!1,u=!1,h=!1;do{for(u=!1,l=!1;!e(this,i)&&(r||(o=Date.now(),r=!0,s=this.makeViewStatus(i.updatingPage)),console.log("updatingPage ",i.updatingPage,"from: "+i.from+" to: "+i.to),this.jumpTo(s,i.updatingPage),this.pushUpdatingPage(n,s),this.linkPage(n,s),this.updatePage(n,s),this.pageDone(n,s),i.updatedPages.push(i.updatingPage),!this.sectionDone(s.updatingPage)||!(u=n.calcSectionPageCount(s.updatingPage))););var d=this.data.doc.previewPages;if(r&&this.finished(s.updatingIndex+1,d>0)){var p=s.updatingIndex+1,g=n.layout_pages.length-p;g>0&&this.dropPages(n,{from:p,to:n.layout_pages.length}),this.view.onAllPageDone(),l=this.data.fieldManager.updatePageCountField(this.view._stablePageCount)}h=u||l}while(h);return r&&(this.updateView(n,s,i.updatedPages),this.freeViewStatus(s),this.totalElapse+=o=Date.now()-o,console.log("updateUntil elapse ",o," ms","from: "+i.updatedPages[0]+" to: "+i.updatedPages[i.updatedPages.length-1]),c.a.debug&&(console.log("=============================="),console.log(c.a.desc()))),i&&i.updatedPages}},{key:"pushUpdatingPage",value:function(e,t){var a=this.contentUpdater,n=e.layout_pages,i=t.updatingIndex,r=n.slice(i).findIndex((function(e){return a.usablePendingPage(e)}));r>0&&(t.dropCount=r,this.dropPages(e,{from:i,to:i+r}),this.view.decreasePageIndex({from:i,dropCount:r})),t.updatingPage=e.layout_pages[i],a.reuseUpdatingPage(e,t)||(t.reMakeUpdatingPage=!0,n.splice(i,0,this.pageFactory.makePage(t)),this.view.increasePageIndex({from:i})),t.updatingPage=e.layout_pages[i]}},{key:"linkPage",value:function(e,t){var a=t.updatingPage,n=t.lastPage,i=t.updatingIndex?Object(T.Ti2Px)(hi.a):Object(T.Ti2Px)(hi.b);n&&(i+=n.outer_rect.bottom),a.layout_index=t.updatingIndex,a.outer_rect.updateByOrigin(null,i),Object.assign(a,t.sectionInfo)}},{key:"updatePage",value:function(e,t){var a=t.updatingPage,n=this.decorativeUpdater,i=this.contentUpdater;n.pushDecorativePage(a,t),a.decorativePage&&n.updatePage(a.decorativePage,t),i.pushContentPage(a,t),i.updatePage(a,t),i.cleanPage(a,t)}},{key:"pageDone",value:function(e,t){var a=t.updatingPage,n=t.updatingIndex,i=a.outer_rect,r=a.mainpages[0];if(!r){var o=(new Error).stack;return console.error("为什么会进来这里， index: "+n+", pagecount: "+e.pageCount+", stack: \n"+o),this.dropPages(e,{from:0,to:e.layout_pages.length}),e.pendingPages=[],void window.APP.api.queryInit()}var s=i.left,c=i.top,l=i.width,u=i.height;t.endIndex=Math.max(t.endIndex,n+1),a.decorativePage&&(a.decorativePage.outer_rect=i),a.isUpdate=!0,delete a.startLineNumbering,delete a.nextLineNumbering;var h=t.reMakeUpdatingPage?0:1;e.outer_rects.splice(n,h,{left:s,top:c,width:l,height:u}),e.page_heights.splice(n,h,i.height),e.pageWidths.splice(n,h,i.width);var d=e.pendingPages.indexOf(n);d>-1&&e.pendingPages.splice(d,1),e.allpage_width=this.data.doc.getMaxPageWidth();var p=void 0;if(r.range){var g=a.mainpages[a.mainpages.length-1];p={beginPos:r.range.pos,endPos:g.range.pos+g.range.len}}else{var f=n>0?e.pagePos[n-1].endPos:0;p={beginPos:f,endPos:f}}e.pagePos.splice(n,h,p),e.composeProcessLayout(a)}},{key:"updateView",value:function(e,t,a){e.outer_rects_is_dirty=!0,e.onUpdated({dropCount:t.dropCount||0,from:t.updatingIndex},a),e.scheduling||this.schedulerUpdateTask()}},{key:"selectPageUpdater",value:function(e){return this.pageUpdaters.find((function(t){return t.mateByScenePath(e)}))}},{key:"selectPageUpdaterBySubdocType",value:function(e){return e===l.HeaderFooter?this.decorativeUpdater:this.contentUpdater}},{key:"onSettingsChanged",value:function(){this.mixin_DOCViewUpdater_onSettingsChanged(),this.data.doc.useCoreTypo||(this.dropPages(this.view,{from:0,to:this.view.layout_pages.length}),delete this.view.secPageCountCache,this.view.secPageCountCache=new Map)}},{key:"freeLayoutPage",value:function(e){this.contentUpdater.killPage(e),this.decorativeUpdater.killPage(e),this.pageFactory.freePage(e)}},{key:"dropPages",value:function(e,t){var a=this,n=t.from,i=t.to;"number"!=typeof i&&(i=n+1);var r=this.pageFactory,o=e.layout_pages;o.slice(n,i).forEach((function(e){a.contentUpdater.killPage(e),a.decorativeUpdater.killPage(e)}));var s=o.splice(n,i-n);s.forEach((function(e){r.freePage(e),a.view.deletePendingPage(e.layout_index)})),this.clearLayoutPage2Canvas(s)}},{key:"finished",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.contentUpdater.finished(e,t)}}]),e}(),Si=wi;s.a.mix(wi,w);var Li=a(144),Ti=a.n(Li),Ii=a(1583).a.getDPR(),Ri=function(e){function t(e,a,n){i()(this,t);var r=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:e,coorSystem:null}));return r.layout_index=a,r.pagePendings=[],r.hostPendings=[],r.layers=null,r.rect=I.a.initByRawRect({top:n,left:e.horizontalPadding,right:e.width-e.horizontalPadding,bottom:n}),r.page=Ta.d.initByParams({context:{parent:r,viewPage:r,coorSystem:_.DOCCoorSystemType.MobilePage},params:{rect:I.a.initByRawRect({top:0,left:0,right:e.width-2*e.horizontalPadding,bottom:0}),textflow:La.a.default(),compose:e.compose}}),r._drawingOffset={x:0,y:0},r.shapesHeight=0,r.marginBefore=0,r.marginAfter=0,r}return ee()(t,e),o()(t,[{key:"reset",value:function(){this._drawingOffset={x:0,y:0},this.shapesHeight=0,this.marginBefore=0,this.marginAfter=0}},{key:"isHost",value:function(){return!0}},{key:"isScene",value:function(){return!0}},{key:"isCoorSystem",value:function(){return!0}},{key:"getTableWidth",value:function(){if(this.tableWidth&&this.tableWidth.expired){for(var e=this.width,t=this._prevTable;t;)e=Math.max(e,t.width),t=t._prevTable;for(var a=this._nextTable;a;)e=Math.max(e,a.width),a=a._nextTable;this.tableWidth.width=e,delete this.tableWidth.expired}return this.tableWidth&&this.tableWidth.width}},{key:"updateDrawingOffset",value:function(e,t){var a=this._drawingOffset.x,n=this._drawingOffset.x+e.x,i=void 0!==t?t:this.maxDrawingOffsetX,r=a-Math.min(Math.max(this.minDrawingOffsetX,n),i),o=void 0,s=void 0;if(r>0?(o=0,s=Math.floor(Ii*r),this._drawingOffset.x+=(o-s)/Ii):r<0&&(o=Math.ceil(Ii*-r),s=0,this._drawingOffset.x+=o/Ii),this.svgNode&&(this.svgNode.setAttribute("transform","translate("+Math.round(this.rect.left-this._drawingOffset.x)+", "+Math.round(this.rect.top)+")"),this.svgTableMask&&this.svgTableMask.setAttribute("x",Math.round(-this.view.horizontalPadding+this._drawingOffset.x)),this.svgTableMenu)){if(this.svgTableMenu.table&&isNaN(this._tableMenuBtnOriginY)){var c=this.svgTableMenu.table.getAttribute("transform"),l=c?c.match(/(-?\d?\.?\d+)/g):[0,0],u=Ti()(l,2)[1];this._tableMenuBtnOriginY=parseFloat(u)}this.svgTableMenu.row.setAttribute("transform","translate("+Math.round(this._drawingOffset.x)+", "+Math.round(this._drawingOffset.y)+")"),this.svgTableMenu.table&&this.svgTableMenu.table.setAttribute("transform","translate("+Math.round(this._drawingOffset.x)+", "+Math.round(this._tableMenuBtnOriginY)+")")}}},{key:"onModify",value:function(){this.isUpdate=!0}},{key:"onOffsetYTo",value:function(e){this.svgNode&&this.svgNode.setAttribute("transform","translate("+Math.round(this.rect.left-this._drawingOffset.x)+", "+Math.round(e)+")")}},{key:"onDel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.onModify(!0),this.svgNode){var t=this.svgNode;this.svgNode=null,t.parentNode.removeChild(t)}this.doRemoveRevisionSvgManager&&this.doRemoveRevisionSvgManager(),this.doRemoveCommentSvgManager&&this.doRemoveCommentSvgManager(),this.doDocumentFieldSvgNodeManager&&this.doDocumentFieldSvgNodeManager(),this.doRemoveSpellCheckSvgNodeManager&&this.doRemoveSpellCheckSvgNodeManager(),this.cleanRenderInfo(e)}},{key:"getShape",value:function(e){return this.shapeArray.find((function(t){return t.id==e}))}},{key:"expired",value:function(){var e=this.view;return this!==e.layout_pages[this.layout_index]||this.layout_index>=e.pageCount}},{key:"getMainRange",value:function(){return this.page.range}},{key:"selectLayersByPack",value:function(e){return this.layers}},{key:"createLayersByPack",value:function(e,t){return this.createLayers(t)}},{key:"createLayers",value:function(e){return this.layers||(this.layers=e.makeLayers({parent:this,viewPage:this.viewPage,coorSystem:_.DOCCoorSystemType.Canvas})),this.layers}},{key:"cleanRenderInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.page&&this.page.cleanRenderInfo(),this.layers&&this.layers.cleanRenderInfo(e),Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this)}},{key:"cleanCardRenderInfo",value:function(){this.layers&&this.layers.cleanCardRenderInfo()}},{key:"layoutType",get:function(){return _.DOCLayoutType.MobilePage}},{key:"position2parent",get:function(){return this.rect.origin}},{key:"view",get:function(){return this.parent}},{key:"isTable",get:function(){var e=this.page.firstline;return e&&e instanceof ki.a}},{key:"viewOffset",get:function(){return{x:this.rect.left,y:this.rect.top}}},{key:"inner_rect",get:function(){return this.rect}},{key:"outer_rect",get:function(){return this.rect}},{key:"width",get:function(){return this.rect.size.width},set:function(e){this.rect.right=e}},{key:"height",get:function(){return this.rect.size.height},set:function(e){this.rect.bottom=e}},{key:"offsetTopOfShapes",get:function(){return Math.round(this.page.rect.bottom+this.page.marginAfter)}},{key:"offsetTopOfComments",get:function(){return Math.round(this.rect.top+this.page.rect.bottom+this.page.marginAfter+this.shapesHeight)}},{key:"inner_height",get:function(){return this.page.rect.bottom+this.page.marginAfter+this.shapesHeight+(this.comments&&this.comments.height||0)+this.marginAfter}},{key:"begin",get:function(){return this.page.lines[0].range.begin}},{key:"end",get:function(){var e=this.page.lastline;return e?e.range.end:0}},{key:"minDrawingOffsetX",get:function(){return 0}},{key:"maxDrawingOffsetX",get:function(){var e=this.getTableWidth()||this.width;return Math.max(0,e-this.view.typoWidth)}},{key:"isPageBroken",get:function(){return this.page.isPageBroken}},{key:"svgNode",get:function(){return this.renderInfo&&this.renderInfo.svgNode},set:function(e){this.renderInfo||(this.renderInfo={}),this.renderInfo.svgNode=e}},{key:"compose",get:function(){return this.parent.compose}}]),t}(_.DOCLayout),Oi=function(){function e(t,a){i()(this,e),this.data=t,this.viewUpdater=a,this.view=t.typoinfo}return o()(e,[{key:"freePage",value:function(e){e.onDel()}},{key:"makePage",value:function(e){var t=this.view;return new Ri(t,0,0)}}]),e}(),Bi=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.viewStatus=e,a}return ee()(t,e),t}(xa),Mi=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCSceneUpdater",base:Ya,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.hostUpdaters=[this],this.mixin_DOCHostUpdater_init(e,this,0)}},{key:"makeLinePolicies",value:function(e){var t=e.view;return[this.updaterFactory.makeTableLinePolicy(t,e,e.hostUpdater),this.updaterFactory.makeTextLinePolicy(t,e)]}},{key:"getHostUpdaterAt",value:function(e){return this.hostUpdaters[e]||(this.hostUpdaters[e]=new Xa(this.pageUpdater,this,e)),this.hostUpdaters[e]}}]),e}();s.a.mix(Mi,Ya);var Ei=a(260),Ai=a(2294),Hi=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLayout",base:_.DOCLayout,methodName:"init"},{baseName:"ITPoint",base:g.ITPoint,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCLayout_init({parent:t,viewPage:t,coorSystem:null}),this.mixin_ITPoint_init(e),this.key=Ai.getRandomId(),this.offsetTop=null,this.height=0,this.expired=!0,this.view.comments[this.key]=t,this.pending=null}},{key:"reuse",value:function(e){this.mixin_DOCLayout_init({parent:e,viewPage:e,coorSystem:null});var t=this.view.comments[this.key];t&&t.comments===this&&(t.comments=null),this.view.comments[this.key]=e}},{key:"setPending",value:function(e){this.pending?Object.assign(this.pending,e):this.pending=e}},{key:"update",value:function(e){var t=this.parent.offsetTopOfComments,a=this.pending;if(this.pending=null,a&&a.expired&&(this.expired=!0,a.height=null),a&&"number"==typeof a.height&&(this.height=Math.max(0,a.height)),e&&this.expired){var n={pos:e.pos,len:e.len};Ei.default.dispatchEvent(Ei.default.comments.COMMENTS_SHOULD_UPDATE,{key:this.key,offsetTop:t,range:n,type:"update"}),this.offsetTop=t,this.expired=!1}else t!=this.offsetTop&&(Ei.default.dispatchEvent(Ei.default.comments.COMMENTS_SHOULD_MOVE,{key:this.key,offsetTop:t,type:"move"}),this.offsetTop=t);this.show()}},{key:"delete",value:function(){delete this.view.comments[this.key],Ei.default.dispatchEvent(Ei.default.comments.COMMENTS_SHOULD_DELETE,{key:this.key,offsetTop:this.offsetTop,type:"del"})}},{key:"show",value:function(){Ei.default.dispatchEvent(Ei.default.comments.COMMENTS_SHOULD_SHOW,{key:this.key,offsetTop:this.offsetTop,type:"show"})}},{key:"hide",value:function(){Ei.default.dispatchEvent(Ei.default.comments.COMMENTS_SHOULD_HIDE,{key:this.key,offsetTop:this.offsetTop,type:"hide"})}},{key:"layoutType",get:function(){return _.DOCLayoutType.Comments}}],[{key:"makeComments",value:function(t){if(!t.page.range)return null;var a=t.view,n=t.page.range.pos;if(t._prevTable){for(var i=t._prevTable;i._prevTable;)i=i._prevTable;n=i.page.range.pos}var r=a.commentsRanges.findNodeEqualRange(n,n);return r?r.reuse(t):(r=new e(n,t),a.commentsRanges.attachNode(r)),r}},{key:"freeComments",value:function(e){e.delete()}}]),e}();s.a.mix(Hi,_.DOCLayout,g.ITPoint);var Ui=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCMobileSceneUpdater",base:Mi,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.viewUpdater=e,this.mixin_DOCMobileSceneUpdater_init(this),this.textboxUpdater=new Bn(this)}},{key:"initHostPolicies",value:function(){this.pageAgent=this.updaterFactory.makePageAgent(this,this.viewUpdater.view),this.hostAgents=[this.pageAgent]}},{key:"killPage",value:function(e){this.hostAgents.forEach((function(t){t.packToolkit.lanePolicy.dropPacksInHost(e)}))}},{key:"updatePage",value:function(e,t){if(!this.isInRevisionHiddleNote(t)){e.page.isMoc&&(this.killPage(e),delete e.page.isMoc),this.enterPage(e,t);for(var a=e.pagePendings,n=!1;a.length>0;){var i=a.pop();if(!i.settled){var r=i.host;i.hostUpdater.updateHost(r,t),n=!0}i.free()}return t.hasUpdate=n,this.leavePage(e,t),n}this.updatePageForRevisionHiddleNoteBody(e,t)}},{key:"enterPage",value:function(e,t){t.pageDrawingOffset=e._drawingOffset,e.reset(),!t.lastPage||t.lastPage.isFootnoteSep||t.lastPage.isEndnoteSep||(e.page.prevPack=t.lastPage.page)}},{key:"leavePage",value:function(e,t){if(e.rect.right=e.rect.left+e.page.rect.width,e.isTable){var a=t.lastPage;if(a&&a.isTable&&!a.page.lines[a.page.lines.length-1].isLastTable){var n=e,i=a._nextTable;i!==n&&(a._nextTable=n,n._prevTable=a,n._nextTable=i,i&&(i._prevTable=n),a._prevTable||0!==a._drawingOffset.x||0===t.pageDrawingOffset.x||(a._drawingOffset=p()({},t.pageDrawingOffset)));var r=a.tableWidth;r.width=Math.max(e.width,r.width),e.tableWidth=r}else e.tableWidth={width:e.width}}else delete e.tableWidth;e.isTable&&e._prevTable?(e._drawingOffset=p()({},e._prevTable._drawingOffset),e.svgNode&&t.pageDrawingOffset.x!==e._drawingOffset.x&&e.onDel(!0)):(e._drawingOffset=t.pageDrawingOffset,e._nextTable&&(delete e._nextTable._prevTable,delete e._nextTable),e._prevTable&&(delete e._prevTable._nextTable,delete e._prevTable)),!e.isTable||function(e){if(e._nextTable)return!1;var t=e.page&&e.page.lines;return t[t.length-1].isLastTable}(e)?(this.updateShapes(e,t),this.updateComments(e,t)):(e.shapesHeight=0,delete e.comments),e.rect.bottom=e.rect.top+e.inner_height;var o=e.maxDrawingOffsetX,s=e.maxDrawingOffsetX-e._drawingOffset.x;if(s<0){var c={x:s,y:0};e.updateDrawingOffset(c,o);for(var l=e._prevTable;l;)l.updateDrawingOffset(c,o),l=l._prevTable}}},{key:"updateLastTable",value:function(e,t){var a=e.page.lines;a[a.length-1].isLastTable=!0,this.updateShapes(e,t),this.updateComments(e,t),e.rect.bottom=e.rect.top+e.inner_height}},{key:"updateShapes",value:function(e,t){var a=void 0;if(e.isTable){a=[];for(var n=e;n;)n.layers&&a.splice(0,0,n.layers),n=n._prevTable}else e.layers&&(a=[e.layers]);if(a&&a.length){var i=t.dataStatus.data.shapeManager.margin(),r=e.offsetTopOfShapes+i,o=0,s=e.page.rect.width,c=!1;a.forEach((function(t){t.getShapeCards().forEach((function(t){var a=t.rect;if(a){var n=t.innerBoundary,l=t.renderScale||1,u=r+o-(n?n.top*l:0),h=(s-(n?n.width*l:a.width))/2-(n?n.left*l:0);o+=(n?n.height*l:a.height)+2*i,a.addOffset(h-a.left,u-a.top),t.upper=e,t.renderInfo||(c=!0)}}))})),c&&e.onModify(),e.shapesHeight=o}}},{key:"updateComments",value:function(e,t){var a=e.comments=Hi.makeComments(e);if(a){t.hasUpdate&&(a.expired=!0);var n=e.page.range;if(e._prevTable){for(var i=e._prevTable;i._prevTable;)i=i._prevTable;var r=i.page.range.pos;n={pos:r,len:n.pos+n.len-r}}a.update(n)}}},{key:"getTableLevel",value:function(){return 0}},{key:"getTextboxUpdater",value:function(){return this.textboxUpdater}},{key:"guessSceneUpdater",value:function(e){if(e.wholePathForGuess.length>1&&e.wholePathForGuess[e.wholePathForGuess.length-1][0].isTopShape)return this.textboxUpdater;return this}},{key:"selectHostUpdaterByWholePath",value:function(e){var t=this.getHostLevelByScenePath(e[0]);return this.getHostUpdaterAt(t)}},{key:"selectScenePath",value:function(e){return e[0]}},{key:"rootScope",value:function(){return{from:1,to:3}}},{key:"mateByScenePath",value:function(e){return this.selectScopeInfo(e).pack instanceof Ri}},{key:"selectScopeInfo",value:function(e){return{line:e[3],pack:e[2],host:e[1]}}},{key:"makeHostStatus",value:function(e){return new Bi(e)}},{key:"usablePendingPage",value:function(e,t,a){if(a.isFootnoteSep)return this.viewUpdater.document.getSubDocRange(l.Footnote).len;if(a.isEndnoteSep)return this.viewUpdater.document.getSubDocRange(l.Endnote).len;var n=this.settledPos(t.lastPage);if(n===this.viewUpdater.document.getSubDocRange(l.MainText).len)return a.isFootnoteSep||a.isEndnoteSep;var i=this.viewUpdater.document.getSubDocRange(l.Footnote);return n===i.pos+i.len?a.isEndnoteSep:a.pagePendings.length||this.pendingPos(a)>=n}},{key:"reuseUpdatingPage",value:function(e,t){if(!t.updatingPage||t.updatingPage.isFootnoteSep||t.updatingPage.isEndnoteSep)return!1;var a=this.pendingPos(t.updatingPage),n=this.settledPos(t.lastPage);return t.updatingPage.pagePendings.length?a?a===n:!t.lastPage||this.pendingPos(t.updatingPage,-1)<0:a===n&&(t.updatingPage.oldTop=t.updatingPage.outer_rect.top,!0)}},{key:"compatWithNextPage",value:function(e,t){return t&&this.settledPos(e)===this.pendingPos(t)&&e.rect.bottom===t.rect.top&&!t.pagePendings.length&&(t.isTable?t._nextTable&&!t.comments:t.comments&&!t.comments.pending)&&t.page.lines.length}},{key:"pushPage",value:function(e){var t=e.oldTop,a=e.outer_rect.top;e.pagePendings.length||(t?a<t?(e.isMovingUp=!0,this._movePage(e)):a>t?(e.isMovingDown=!0,this._movePage(e)):e.isPageBroken&&this._upSize(e):this.pendingAt(e.page,0))}},{key:"cleanPage",value:function(e){delete e.oldTop,delete e.isMovingUp,delete e.isMovingDown,delete e.isUpSize}},{key:"_movePage",value:function(e){var t=e.outer_rect.top;e.onOffsetYTo(t),e.comments&&e.comments.update(),e.isTable&&e.renderInfo&&e.renderInfo.extendHeightForTableBorder!==Math.round(e.rect.bottom)-(Math.round(e.rect.top)+Math.round(e.rect.height))&&(e.page.lines.forEach((function(e){e.renderInfo&&(e.renderInfo.needRefreshTableBorder=!0)})),e.page.renderInfo.expired=!0,e.isUpdate=!0)}},{key:"_upSize",value:function(e){if(!(e.page.rect.height>=this.viewUpdater.getUsableHeightOfPage(e))){e.isUpSize=!0,e.conflicting=!0;var t=this.viewUpdater.document.concernRanges[0];this.upPackSize(e.page,{begin:t.pos,end:t.pos+t.len})}}},{key:"settledPos",value:function(e){if(!e)return 0;if(e.isFootnoteSep)return this.viewUpdater.data.doc.getSubDocRange(l.Footnote).pos;if(e.isEndnoteSep)return this.viewUpdater.data.doc.getSubDocRange(l.Endnote).pos;var t=this.primeHostAgent().packToolkit,a=t.lanePolicy;return t.packUpdater.settledPos(a.getFinalPackInHost(e))}},{key:"pendingPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=this.primeHostAgent().packToolkit.lanePolicy,n=a.getFinalPackInHost(e);return n&&n.lines.length?n.lines[0].range.begin:t}},{key:"compareMentionedPos",value:function(e,t){return e.viewPage===t.viewPage&&e.pack===t.pack?e.lineIndex-t.lineIndex:this.getViewPageIndex(e.viewPage)-this.getViewPageIndex(t.viewPage)}},{key:"getViewPageIndex",value:function(e){return e.layout_index}},{key:"getMentionedPosByScenePath",value:function(e){var t=-1,a=this.selectScopeInfo(e),n=a.host,i=a.pack,r=a.line;return r&&(t=i.lines.indexOf(r)),-1===t&&(t=i.lines.length),{viewPage:n,pack:i,lineIndex:t}}},{key:"getMentionedPosOfWholePath",value:function(e){return this.getMentionedPosByScenePath(e[0])}},{key:"pendingToPage",value:function(e,t){var a=this;e.host.viewPage.expired()||(e.host.view.pageCount=e.host.viewPage.layout_index);var n=e.host.viewPage.pagePendings,i=this.selectScenePath(t),r=this.getMentionedPosByScenePath(i),o=n.findIndex((function(e){var n=e.pack.getWholePath(),i=a.compareMentionedPos(a.getMentionedPosByScenePath(a.selectScenePath(n)),r);return 0!==i?i<0:n.length<t.length}));-1===o&&(o=n.length),n.splice(o,0,e)}},{key:"pendingToComment",value:function(e,t){e.expired()||(e.view.pageCount=e.layout_index),e.comments&&e.comments.setPending(t)}},{key:"finished",value:function(){var e=this.viewUpdater.view,t=e.layout_pages;if(e.pageCount){var a=this.primeHostAgent().packToolkit.lanePolicy,n=t[e.pageCount-1],i=a.getFinalPackInHost(n),r=i.range,o=this.viewUpdater.document,s=o.getSubDocRange(l.Footnote),c=o.getSubDocRange(l.Endnote),u=o.concernRanges[0],h=o.getSubDocRange(l.MainText);if(u.len<h.len&&r&&r.pos+r.len>=u.len)return!0;var d=c.len?c:s.len?s:h;return r&&r.pos+r.len===d.pos+d.len&&!i.calcBrokenInfo().brokenLines}return!1}},{key:"isInRevisionHiddleNote",value:function(e){if(e.lastPage){var t=this.settledPos(e.lastPage),a=e.dataStatus.document,n=a.getSubDocType(t),i=void 0;if(n===l.Footnote?i=a.footnoteBodys.getRefByPos(t):n===l.Endnote&&(i=a.endnoteBodys.getRefByPos(t)),i&&i.isRevisionHidden)return!0}return!1}},{key:"updatePageForRevisionHiddleNoteBody",value:function(e,t){this.enterPage(e,t),this.killPage(e),e.onDel(),e.page.isMoc=!0;var a=this.settledPos(t.lastPage),n=t.dataStatus.document,i=n.getSubDocType(a),r=void 0;i===l.Footnote?r=n.footnoteBodys.getNoteBody(a):i===l.Endnote&&(r=n.endnoteBodys.getNoteBody(a));var o=r,s={pos:o.pos,len:o.len},c=new R.a({parent:e.page,viewPage:e.viewPage,coorSystem:e.page.coorSystem},{textline:{range:s}});e.page.lines.push(c),e.page.rect.updateByHeight(0),e.page.marginAfter=0,this.leavePage(e,t)}}]),e}();s.a.mix(Ui,Mi);var Di=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"makeLineStatus",value:function(e,a){var n=Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"makeLineStatus",this).call(this,e,a);return window.APP.isMobileMode()&&(n.paraSpacingScale=window.APP.appApi.readingFontSize/100,n.lineSpacingScale=window.APP.appApi.readingLineSpacing),n.isWebMode=!0,n}},{key:"initWrapTools",value:function(){this.wrapTools=vi()({},Ge.e,Je)}},{key:"collectWrapCards",value:function(e,t,a){var n=t.selectLayersByPack(e);return n&&n.collectWrapCardsByRect(a)||[]}}]),t}(tt),Ni=function(e){function t(){return i()(this,t),Q()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ee()(t,e),o()(t,[{key:"initWrapTools",value:function(){this.wrapTools=vi()({},Ge.e,Je)}},{key:"makeRgdxa",value:function(e){var t=[],a=e.prop.table_row.rgdxa;if(a){var n=-Ti()(a,1)[0];a.forEach((function(e){t.push(e+n)}))}else{t.push(0);var i=!1;if(e.cells.forEach((function(e){void 0===e.width||0!==e.width.type?i=!0:t.push(t[t.length-1]+e.width.width)})),i)for(var r=8522/e.cells.length,o=0;o<e.cells.length;++o)t.push(t[t.length-1]+r)}return t=t.map((function(e){return Object(T.Ti2Px)(e)}))}},{key:"makeTableLine",value:function(e,a,n,i){var r=Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"makeTableLine",this).call(this,e,a,n,i);return i||(r.isLastTable=!0),r}},{key:"moveLine",value:function(e,t,a,n,i){var r=this,o=I.a.initByRawRect(t.rect);o.offset(-t.orgRgdxa,0);var s=Ye(i,o),c=[];if(a&&a.collectWrapCardsByRect(s).forEach((function(e){c.push(e)})),!c.length)return!1;var l=0,u=0,h=this.outerAgent.getUsableWidthOfPack(t.parent),d={minCardBottom:Number.MAX_SAFE_INTEGER,offset:0},p=[{left:0,right:h}];return c.some((function(e){var t=r.wrapTools[e.wrap_mode];if(!t)return!1;if((p=(p=t(p,s,e,i.clone().invert(),d)).filter((function(t){var a=Object(T.Ti2Px)(E.e.MIN_SUBLINE_WIDTH);return e.wrap_mode==Ge.e&&(a=Object(T.Ti2Px)(E.e.MIN_TIGHT_SUBLINE_WIDTH)),t.right-t.left>=a}))).length){var a=p[0];if(a.right-a.left>s.width)return u=a.left-o.left,!1}return l=d.offset,u=0,!0})),(!Object(Ie.d)(u,0)||!Object(Ie.d)(l,0))&&(t.rect.offset(u,l),!0)}},{key:"adjustUpdatingLine",value:function(e,a){Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"adjustUpdatingLine",this).call(this,e,a);for(var n=a.updatingLine,i=a.hostStatus.host,r=n.rect.top,o=i.selectLayersByPack(e),s=i.decorativePage&&i.decorativePage.selectLayersByPack(e)||null,c=Ke(n,e.parent);this.moveLine(a,n,o,s,c););var l=n.rect.top-r;a.updatingLineTop+=l}},{key:"reuseUpdatingLine",value:function(e,a){return e.parent!==e.viewPage&&Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reuseUpdatingLine",this).call(this,e,a)}},{key:"compatInPack",value:function(e,a){return e.parent!==e.viewPage&&Bt()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"compatInPack",this).call(this,e,a)}}]),t}(Pi),Fi=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCLanePolicy",base:Gt,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.hostAgent=e,this.hostUpdater=e.hostUpdater,this.mixin_DOCLanePolicy_init(e)}},{key:"acceptUpdatingLine",value:function(e,t){return t.updatingLineTop<=this.hostAgent.getUsableHeightOfPack(e)}}]),e}();s.a.mix(Fi,Gt);var Wi=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCMobileLanePolicy",base:Fi,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCLanePolicy_init(e)}},{key:"freePack",value:function(e){}},{key:"dropPackOfCell",value:function(e){var t=this,a=function(e){var a=t.hostAgent.packToolkit,n=a.embedPolicy,i=a.layersPolicy,r=a.packUpdater;n.reset(e),i.reset(e),r.killPack(e)};e.cell_page?(a(e.cell_page),delete e.cell_page):e.diagCell&&(e.diagCell.pages.forEach((function(e){a(e)})),delete e.diagCell)}},{key:"dropPacksInHost",value:function(e){}},{key:"getPacksInHost",value:function(e){}}]),e}();s.a.mix(Wi,Fi);var Gi=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCHostAgent",base:at,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCHostAgent_init(e,t)}},{key:"onPackBroken",value:function(e,t){return B.c.Pass}},{key:"isPackBroken",value:function(e,t){return t.updatingLineTop>=this.getUsableHeightOfPack(e)}},{key:"getUsableTopOfPack",value:function(e){return Number.MAX_SAFE_INTEGER}}]),e}();s.a.mix(Gi,at);var ji=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCMobileHostAgent",base:Gi,methodName:"init"},{baseName:"DOCMobileHostAgent",base:Gi,methodName:"onEnterPack"},{baseName:"DOCMobileHostAgent",base:Gi,methodName:"onPackDone"},{baseName:"DOCMobileHostAgent",base:Gi,methodName:"onLeavePack"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCHostAgent_init(e,t)}},{key:"makePackToolkit",value:function(){var e=this.hostUpdater.updaterFactory;return{packUpdater:this.makePackUpdater(),lanePolicy:new Wi(this),layersPolicy:e.makeLayersPolicy(this),embedPolicy:e.makeEmbedPolicy(this)}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.sceneUpdater.makeLinePolicies(this),[])}},{key:"calcBodyRange",value:function(e,t){var a=t.hostStatus.outerRowData.cellDatas[t.updatingCellIndex],n={pos:a.begin,len:a.end-a.begin};return void 0!==t.diagIndex&&(n=Da(n,t.diagIndex,t.dataStatus.data.doc)),n}},{key:"getUsableHeightOfPack",value:function(e){if(e.host.rowHeight&&e.host.rowHeight.exactly)return Number.MAX_SAFE_INTEGER;if(e.parent.diagCell)return Number.MAX_SAFE_INTEGER;var t=this.hostUpdater.sceneUpdater,a=e.getScenePath(),n=t.rootScope(a),i=t.selectScopeInfo(a),r=t.selectHostAgent(i.pack).getUsableHeightOfPack(i.pack);return a.slice(n.to).forEach((function(e){r-=e.rect.top})),r}},{key:"onEnterPack",value:function(e,t){var a=t.hostStatus.host,n=e.parent;if(t.updatingCellIndex=a.tablecells.indexOf(n),n.diagCell?t.diagIndex=n.diagCell.pages.indexOf(e):delete t.diagIndex,this.mixin_DOCMobileHostAgent_onEnterPack(e,t),t.hostStatus.outerStartFromScratch||this.hostUpdater.mementoForTableCell(e,t),e.rect.bottom=Number.MAX_SAFE_INTEGER,void 0===t.diagIndex)n.rect.bottom=Number.MAX_SAFE_INTEGER;else{var i=n.rect;if(t.hostStatus.lastTableLine)i=I.a.initByOriginAndSize(i.origin,{width:i.width,height:t.hostStatus.lastTableLine.rect.bottom-t.hostStatus.host.rect.top});else if(n.nextMergedCell){for(var r=n.nextMergedCell;r.nextMergedCell;)r=r.nextMergedCell;i=I.a.initByOriginAndSize(i.origin,{width:i.width,height:r.parent.rect.bottom-t.hostStatus.host.rect.top})}var o=t.hostStatus.outerRowData.cells[t.updatingCellIndex].diagonals;n.diagShapes=Va(t.diagIndex,o,i),t.hostStatus.layersPolicy._createLayers(e,t).commitDiagCards(n.diagShapes)}}},{key:"onPackDone",value:function(e,t){this.adjCellPackHeight(e,t),this.mixin_DOCMobileHostAgent_onPackDone(e,t)}},{key:"onLeavePack",value:function(e,t){this.mixin_DOCMobileHostAgent_onLeavePack(e,t);var a=e.parent;a.diagShapes&&(a.viewPage.layers.clearDiagCards(),delete a.diagShapes)}},{key:"adjCellPackHeight",value:function(e,t){if(void 0===t.diagIndex){var a=0;if(e.lines&&e.lines.length>0){var n=e.lines[e.lines.length-1],i=n.range.end<t.bodyRange.pos+t.bodyRange.len;Object(Aa.f)(e.lines.length-1,e,t.hostStatus.dataStatus.glyphpool,!1)&&!i?(a=n.rect.top,a-=n.border.before_width||0,a-=n.before_space||0):(a+=n.rect.bottom,a+=n.border.after_width||0,a+=n.after_space||0)}e.rect.bottom=e.rect.top+a}else{var r=e.parent;if(r.nextMergedCell){for(var o=r.nextMergedCell;o.nextMergedCell;)o=o.nextMergedCell;e.rect.bottom=o.parent.rect.bottom-r.parent.rect.top}else e.rect.bottom=e.parent.rect.height}}},{key:"getFootnoteEndnotePolicies",value:function(){return this.footnoteEndnotePolicies||(this.footnoteEndnotePolicies=[new jn.c,new jn.a,new jn.b]),this.footnoteEndnotePolicies}},{key:"getUsableHeightOfLine",value:function(e){return Number.MAX_SAFE_INTEGER}},{key:"intersectByRange",value:function(e,t){var a=this,n={host:e,packs:[],wraps:[]};return e.tablecells.forEach((function(e){e.cell_page&&a.intersectPackByRange(e.cell_page,t,n),e.diagCell&&e.diagCell.pages.forEach((function(e){a.intersectPackByRange(e,t,n)}))})),n}}]),e}();s.a.mix(ji,Gi);var Vi=function(){function e(t){var a=t.parent,n=t.viewPage;i()(this,e),this.parent=a,this.viewPage=n,this.view=n.parent,this.embedShapes=[],this.shapeCards=[]}return o()(e,[{key:"addChild",value:function(e){this.childLayers||(this.childLayers=[]),this.childLayers.push(e),e.parentLayers=this}},{key:"removeChild",value:function(e){var t=this.childLayers.indexOf(e);t>=0&&this.childLayers.splice(t,1)}},{key:"getTopRenderInfo",value:function(){for(var e=this;e.parentLayers;)e=e.parentLayers;var t=e.renderInfo;return t||(t=e.renderInfo={}),t}},{key:"getShapeCards",value:function(){var e=this,t=void 0;if(this.childLayers&&this.childLayers.forEach((function(e){e.shapeCards&&e.shapeCards.length&&(t=t?t.concat(e.shapeCards):e.shapeCards)})),t&&t.length){var a=[].concat(this.shapeCards);return t.forEach((function(t){e.insertByPos(t,a)})),a}return this.shapeCards}},{key:"getTopShapeCards",value:function(){return[]}},{key:"getBottomShapeCards",value:function(){return[]}},{key:"getTextframeCards",value:function(){return[]}},{key:"collectCardsByRange",value:function(e,t){var a=this.view.shapeCardRanges,n=this.viewPage.layout_index;return a.mapInRange(e,t,g.IT.mapToNode,g.IT.strictIntersectTest).filter((function(a){return a.viewPage.layout_index===n&&(e<=a.begin&&a.end<=t)}))}},{key:"collectEmbedsByRange",value:function(e,t){var a=this.view.embedShapeRanges,n=this.viewPage.layout_index;return a.mapInRange(e,t,g.IT.mapToNode,g.IT.strictIntersectTest).filter((function(a){return a.viewPage.layout_index===n&&(e<=a.begin&&a.end<=t)}))}},{key:"commitDiagCards",value:function(e){this.diagShapes=e}},{key:"clearDiagCards",value:function(){delete this.diagShapes}},{key:"collectWrapCardsByRect",value:function(e){var t=[];return this.diagShapes&&this.diagShapes.forEach((function(a){a.intersect(e)&&t.push(a)})),t}},{key:"commitEmbed",value:function(e){if(e.isOrphan()){this.view.embedShapeRanges.attachNode(e);var t=this.getTopRenderInfo();if(e.renderInfo&&t&&t.removed){var a=t.removed.indexOf(e.renderInfo);a>=0&&t.removed.splice(a,1)}}this.insertByPos(e,this.embedShapes),this.viewPage.embed_shape_map||(this.viewPage.embed_shape_map={}),this.viewPage.embed_shape_map[e.id]=e,e.startFetchingImg&&e.startFetchingImg()}},{key:"removeEmbed",value:function(e){if(e&&e.isEmbedShape){if(!e.isOrphan()){this.view.embedShapeRanges.detachNode(e);var t=this.getTopRenderInfo();t&&(t.removed||(t.removed=[]),t.removed.push(e.renderInfo))}this.viewPage.embed_shape_map[e.id]&&delete this.viewPage.embed_shape_map[e.id],this.doRemove(e,this.embedShapes)}}},{key:"commitCard",value:function(e){if(e.linkLayers=this,this.insertByPos(e,this.shapeCards),e.isOrphan()){this.view.shapeCardRanges.attachNode(e);var t=this.getTopRenderInfo();if(e.renderInfo&&t&&t.removed){var a=t.removed.indexOf(e.renderInfo);a>=0&&t.removed.splice(a,1)}}e.startFetchingImg()}},{key:"removeCard",value:function(e){var t=this;this.doRemove(e,this.shapeCards),this.view.shapeCardRanges.mapInRange(e.pos,e.pos+e.len,g.IT.mapToNode,g.IT.strictIntersectTest).forEach((function(a){a===e&&t.view.shapeCardRanges.detachNode(e)}));var a=this.getTopRenderInfo();a&&(a.removed||(a.removed=[]),a.removed.push(e.renderInfo))}},{key:"insertByPos",value:function(e,t){var a=t.findIndex((function(t){return t.pos>e.pos}));-1===a?t.push(e):t.splice(a,0,e)}},{key:"doRemove",value:function(e,t){var a=t.indexOf(e);a>=0&&t.splice(a,1)}},{key:"cleanRenderInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=function(e){e.forEach((function(e){e.cleanRenderInfo()}))};t(this.embedShapes),e||(t(this.shapeCards),delete this.renderInfo),this.childLayers&&this.childLayers.forEach((function(t){t.cleanRenderInfo(e)}))}},{key:"cleanCardRenderInfo",value:function(){this.shapeCards&&this.shapeCards.forEach((function(e){e.cleanRenderInfo()})),this.childLayers&&this.childLayers.forEach((function(e){e.cleanCardRenderInfo()}))}}]),e}(),zi=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.hostAgent=e,a.updaterFactory=a.hostAgent.hostUpdater.updaterFactory,a}return ee()(t,e),o()(t,[{key:"create",value:function(e,t,a){var n=this._getShapeCache(t.packStatus),i=t.dataStatus,r=i.data.doc.getEmbedDrawing(a).anchor;if(r&&null!=r.shapeId){var o=r.shapeId,s=e.viewPage&&e.viewPage.embed_shape_map,c=s&&s[o]||n[o]||null,l=this.updaterFactory.getEmbedShapeFactory();return c?c.reset(r):(c=l.makeEmbedCard(r,i,e,t.pageUpdater),n[o]=c),c.textpage=e.parent,c}console.error("[EMBED SHAPE] Get Anchor ShapeId Error")}},{key:"_createLayers",value:function(e,t){var a=this.updaterFactory;return e.viewPage.layers||(e.viewPage.layers=a.makeLayers({parent:e.viewPage,viewPage:e.viewPage}),t.hostStatus.host===e.viewPage&&(this.layers=e.viewPage.layers)),this.layers||(this.layers=t.hostStatus.host.createLayersByPack(e,a)),this.layers}}]),t}(Ft),Zi=function(e){function t(e){i()(this,t);var a=Q()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.updaterFactory=a.hostAgent.hostUpdater.updaterFactory,a}return ee()(t,e),o()(t,[{key:"reset",value:function(e){e!==this.pack&&(this.pack=e,this.layers=e.host.selectLayersByPack(e),this.shapeInfos=[])}},{key:"dropTextbox",value:function(e){var t=this;e.isGroup?e.childShapes.forEach((function(e){t.dropTextbox(e)})):e.has_textbox&&e.updater.killScene(e)}},{key:"dropCard",value:function(e){this.dropTextbox(e),this.layers.removeCard(e)}},{key:"dropWithLine",value:function(e,t){var a=this;if(this.layers){var n=this.layers,i={begin:e.range.begin,end:e.range.end};Nt.collectCardsBetween(n.shapeCards,i,(function(e){(t.all||t.shape)&&a.dropCard(e)}))}}},{key:"markPendingCards",value:function(e,t,a){var n=this;if(this.layers){var i=this.layers;Nt.collectCardsAfterPos(i.shapeCards,a,(function(a){n._detachShape(e,t,a)}))}}},{key:"restorePendingCards",value:function(e,t,a){var n=this._getShapeCache(t);for(var i in n){var r=n[i];r.pos>=a&&this._attachShape(e,t,r)}}},{key:"dropPendingCardsInHost",value:function(e,t,a){var n=this._getShapeCache(t);for(var i in n){n[i].pos>=a&&delete n[i]}}},{key:"makeRelativeInfo",value:function(e,t,a){return{pack:e,line:a,data:t.dataStatus.data,relRect:e.viewPage.rect,viewPage:a.viewPage,pageCoreRect:e.rect}}},{key:"create",value:function(e,t,a,n){var i=this._getShapeCache(e)[a.pos],r=!1,o=this.updaterFactory.getShapeCardFactory();i?o.resetShapeCard(i,a,t,n,t.line,t.viewPage,t.coorSystem):(i=o.makeShapeCard(a,t,n,t.line,t.viewPage,t.coorSystem),r=!0);var s=this.hostAgent.pageUpdater.getTextboxUpdater();return o.makesureTextbox(i,s,t,e.dataStatus,!r),i.updateInnerBoundary(),o.scaleIntoPage(i,t.relRect.width),{shape:i,isNew:r}}},{key:"commit",value:function(e,t){this.shapeInfos.length>0&&!this.layers&&this._createLayers(e,t),this._commitShapes(e,t)}},{key:"_commitShapes",value:function(e,t,a){var n=this;this.shapeInfos.forEach((function(i){var r=i.shape;n._attachShape(e,t,r),a&&a(i),r.renderInfo&&(r.renderInfo.moved=!0)})),this.shapeInfos=[]}},{key:"_createLayers",value:function(e,t){var a=this.hostAgent.hostUpdater.updaterFactory;return e.viewPage.layers||e.viewPage.createLayers(a),this.layers||(this.layers=t.hostStatus.host.createLayersByPack(e,a)),this.layers}}]),t}(Wt),qi=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCMobileLanePolicy",base:Fi,methodName:"init"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCMobileLanePolicy_init(e)}},{key:"dropPacksInHost",value:function(e){var t=this.hostAgent.packToolkit,a=t.embedPolicy,n=t.layersPolicy,i=t.packUpdater,r=e.page;a.reset(r),n.reset(r),i.killPack(r)}},{key:"getPacksInHost",value:function(e){return[e.page]}},{key:"getFinalPackInHost",value:function(e){return e?e.page:null}},{key:"getFirstPackInHost",value:function(e){return e?e.page:null}}]),e}();s.a.mix(qi,Fi);var Xi=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCMobileHostAgent",base:Gi,methodName:"init"},{baseName:"DOCMobileHostAgent",base:Gi,methodName:"onEnterPack"},{baseName:"DOCMobileHostAgent",base:Gi,methodName:"onLeavePack"},{baseName:"DOCMobileHostAgent",base:Gi,methodName:"pushNextPack"},{baseName:"DOCMobileHostAgent",base:Gi,methodName:"isDataDone"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCMobileHostAgent_init(e,t)}},{key:"onEnterPack",value:function(e,t){this.mixin_DOCMobileHostAgent_onEnterPack(e,t),e.rect.updateBySize(this.view.width-2*this.view.horizontalPadding,0),e.isPageBroken=!1,t.pageRange=this.calcPageRange(e,t)}},{key:"onLeavePack",value:function(e,t){this.mixin_DOCMobileHostAgent_onLeavePack(e,t),e.isPageBroken=t.isPageBroken;var a=this.calcPackSize(e),n=e.rect.top;if(e.rect.top=0,e.rect.bottom=e.rect.top+a.height,e.rect.right=e.rect.left+a.width,e.marginBefore=e.marginAfter=0,t.isTable){var i=window.APP.data.doc.getDocInfo().woTemplateSpaceBetweenTableAndTextline,r=i?Object(T.Ti2Px)(i):0,o=t.prevPack&&t.prevPack.viewPage;r&&(o&&o.isTable&&!o.page.lines[o.page.lines.length-1].isLastTable||(e.marginBefore=r,e.rect.offset(0,r)),e.lines[e.lines.length-1].isLastTable&&(e.marginAfter=r))}n!==e.rect.top&&e.renderInfo&&(e.renderInfo.moved=!0)}},{key:"makePackToolkit",value:function(){var e=this.hostUpdater.updaterFactory,t=e.makeLayersPolicy(this),a=e.makeEmbedPolicy(this);return{packUpdater:this.makePackUpdater(),lanePolicy:new qi(this),layersPolicy:t,embedPolicy:a}}},{key:"makePackUpdater",value:function(){return new Ut(this,this.hostUpdater.makeLinePolicies(this),[])}},{key:"calcBodyRange",value:function(e,t){var a=t.hostStatus.viewStatus,n=a.lastPage;if(n){if(n.isFootnoteSep)return this.document.getSubDocRange(l.Footnote);if(n.isEndnoteSep)return this.document.getSubDocRange(l.Endnote);var i=this.packToolkit.lanePolicy.getFinalPackInHost(a.lastPage).range.pos,r=this.document.getSubDocType(i);switch(r){case l.Footnote:case l.Endnote:return this.document.getSubDocRange(r)}}return this.document.concernRanges[0]}},{key:"calcPageRange",value:function(e,t){var a=t.dataStatus,n=t.hostStatus.viewStatus,i=0,r=this.packToolkit.lanePolicy.getFinalPackInHost(n.lastPage);if(r){var o=r.range;if(n.lastPage.isFootnoteSep){var s=t.dataStatus.document.getSubDocRange(l.Footnote);i=s.pos}else if(n.lastPage.isEndnoteSep){var c=t.dataStatus.document.getSubDocRange(l.Endnote);i=c.pos}else i=o.pos+o.len}a.locate(i);var u=a.papx,h=this.hostUpdater.getTableLevel()+1;if(a.isEnterTable(h)){var d=function(){t.isTable=!0;for(var e=t.tableData=Object(Ea.c)(a.document,a.pos,h),n=e.range,r=e.rows,o=r.findIndex((function(e){return e.pos===a.pos})),s=function(){var e=r[o],t=e.cells,a=!1;if(t.some((function(t,n){var i=Object(Ea.e)(t,n,e,r[o+1]);if(i!=we.e.NONE&&i!=we.e.LAST)return a=!0})),!a)return"break";++o};o<r.length;){if("break"===s())break}var c=o<r.length?r[o].pos+r[o].len:n.pos+n.len;return{v:new g.Range(i,c)}}();if("object"===(void 0===d?"undefined":L()(d)))return d.v}var p=Math.min(u.pos+u.len,a.bodyRange.end);return new g.Range(u.pos,p)}},{key:"getUsableHeightOfPack",value:function(e){return this.viewUpdater.getUsableHeightOfPage(e.viewPage)}},{key:"pushNextPack",value:function(e,t){}},{key:"getFieldZonePolicies",value:function(){return[new ka]}},{key:"getFootnoteEndnotePolicies",value:function(){return this.footnoteEndnotePolicies||(this.footnoteEndnotePolicies=[new jn.c,new jn.a,new jn.b]),this.footnoteEndnotePolicies}},{key:"isPageBroken",value:function(e,t){return t.dataStatus.pos===t.pageRange.pos+t.pageRange.len}},{key:"isPageFinished",value:function(e,t){return t.lastLine.isPackBroken||t.dataStatus.pos>=t.pageRange.pos+t.pageRange.len&&!e.calcBrokenInfo().brokenLines}},{key:"isDataDone",value:function(e,t){var a=this.mixin_DOCMobileHostAgent_isDataDone(e,t);if(a){var n=this.document.getSubDocRange(l.MainText),i=t.bodyRange;i.pos+i.len<n.pos+n.len&&(t.lookaheadPosForPack=i.pos+i.len,this.hostUpdater.viewUpdater.maxUpdatedPos=i.pos+i.len)}return a}},{key:"calcPackSize",value:function(e){var t=0,a=0,n=e.lines;if(!n.length)return{height:t,width:a};var i=n[n.length-1];t=i.rect.bottom,t+=i.border.after_width||0,t+=i.after_space||0;var r=0,o=Number.MIN_SAFE_INTEGER;return n.forEach((function(e){r=Math.min(r,e.rect.left),o=Math.max(o,e.rect.right)})),{height:t,width:a=Math.max(0,o-r)}}},{key:"onPackBroken",value:function(e,t){return B.c.Pass}},{key:"onPackDone",value:function(e,t){this.isPageFinished(e,t)||(t.isPageBroken=!0)}}]),e}(),Yi=function(){function e(t,a){i()(this,e),this.init(t,a)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCWebPageAgent",base:Xi,methodName:"init"},{baseName:"DOCWebPageAgent",base:Xi,methodName:"onLeavePack"}]}}]),o()(e,[{key:"init",value:function(e,t){this.mixin_DOCWebPageAgent_init(e,t)}},{key:"onLeavePack",value:function(e,t){this.mixin_DOCWebPageAgent_onLeavePack(e,t);var a=0;if(t.isTable){var n=t.prevPack&&t.prevPack.viewPage;n&&n.isTable&&!n.page.lines[n.page.lines.length-1].isLastTable||(a=20)}e.marginBefore=e.marginAfter=0,a!==e.rect.top&&e.renderInfo&&(e.renderInfo.moved=!0),e.rect.offset(0,a-e.rect.top)}}]),e}();s.a.mix(Xi,Gi),s.a.mix(Yi,Xi);var Ki=a(4103),Ji=T.Ti2Px;function Qi(e,t){var a=void 0,n=e.anchor,i=e.innerBoundary,r=e.rect?e.rect.size:e.size,o=r.width,s=r.height;if(n&&n.hasVaildEffectExtents()){var c={width:o,height:s},l=e.visualRotation;if(0!==l){var u=I.a.initByOriginAndSize({x:0,y:0},c);Object(Oe.b)(l,u),c.width=u.width,c.height=u.height}var h=n.effectExtents;c.width+=Object(T.Ti2Px)(h.left+h.right),c.width>t&&(a=e.renderScale=t/c.width)}else if(i){var d=i.width;d>t&&(a=e.renderScale=t/d)}void 0!==a&&(s*=a,o*=a,e.rect.updateBySize?e.rect.updateBySize(o,s):(e.rect.right=e.rect.left+o,e.rect.bottom=e.rect.top+s),e.size&&(e.size.width=o,e.size.height=s))}var $i=function(){function e(){i()(this,e)}return o()(e,null,[{key:"makeShapeCard",value:function(e,t,a,n,i,r){var o=new Le.a({outer:n,viewPage:i,range:{begin:e.begin,end:e.end},coorSystem:r,anchor:e});return o.subdoc_type=a.getSubDocType(e.begin),this.calcShapeCardRect(o,t),o.initTextbox(),o}},{key:"calcShapeCardRect",value:function(e,t){var a=e.anchor,n=t.data.shapeManager,i=e.drawingLayout,r=i?i.layoutRect:n.getShapeInfo({shapeTreeType:0,shapeId:e.id,data:t.data}).rect.size,o=I.a.initByRawRect({left:0,right:r.width,top:0,bottom:r.height});e.setRect(o);var s=o.left-Ji(a.distanceLeft),c=o.top-Ji(a.distanceTop),l=o.right+Ji(a.distanceRight),u=o.bottom+Ji(a.distanceBottom);e.boundary={left:s,top:c,right:l,bottom:u}}},{key:"resetShapeCard",value:function(e,t,a,n,i,r,o){e.reset({outer:i,viewPage:r,range:{begin:t.begin,end:t.end},coorSystem:o,anchor:t}),e.coor_pos2view=null}},{key:"makesureTextbox",value:function(t,a,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t.isGroup&&e.updateShpaeTextbox(t,a,i),t.has_textbox)if(r)t.isMovingUp=!0,t.conflicting=!0,a.moveHost(t),a.updateTextBox(i,t),t.updater=a,delete t.isMovingUp,t.conflicting=!1;else{var o=t.anchor,s=o.shapeData.textRect,c=e.calcTextBoxPackRect(t,i.document,n,s);t.textbox_page.rect=c,t.rawTextRect=s,t.updater=a,a.pendingToHost(t.textbox_page,t),a.updateTextBox(i,t)}}},{key:"updateShpaeTextbox",value:function(t,a,n){t.isGroup?t.childShapes.forEach((function(t){e.updateShpaeTextbox(t,a,n)})):t.textbox_page&&(t.updater=a,t.updater.pendingToHost(t.textbox_page,t),t.updater.updateTextBox(n,t))}},{key:"calcTextBoxPackRect",value:function(e,t,a,n){var i=void 0,r=e.textbox_page.rect;i=I.a.initByRawRect(r);var o=e.textbox_page.textflow;if("L2R"===o.corX?i.updateByHeight(Number.MAX_SAFE_INTEGER):i.updateByWidth(Number.MAX_SAFE_INTEGER),!e.isWrapText)if("L2R"===o.corX){var s=a.pageCoreRect.width;if(e.subdoc_type===l.MainText){var c=t.sections.getSection(e.begin);if(c){s=Number.MAX_SAFE_INTEGER;for(var u=c.getColumnsCount(),h=0;h<u;++h){var d=c.getColumnItem(h).columnWidth;s=Math.min(s,d)}}}i.updateByWidth(s)}else{var p=a.pageCoreRect.height;i.updateByHeight(p)}return i}},{key:"scaleIntoPage",value:function(e,t){return Qi(e,t)}}]),e}(),er=function(){function e(){i()(this,e)}return o()(e,null,[{key:"makeEmbedCard",value:function(t,a,n,i){var r={begin:t.begin,end:t.end},o=a.data.doc,s=o.getSubDocType(t.begin),c=o.getEmbedDrawing(t.begin).shapeTreeType,l=Ki.a.getInstance(),u=new tn.a({range:r,anchor:t,subDocType:s,shapeTreeType:c,viewPage:n.viewPage,line:n}),h=u.drawingLayout,d=h?h.layoutRect:l.getShapeInfo({shapeTreeType:c,shapeId:u.id,data:a.data}).rect.size;return u.setShapeSize(d),u.initTextbox(),u.has_textbox&&(u.updater=i.getTextboxUpdater(),u.updater.pendingToHost(u.textbox_page,u),u.updater.updateTextBox(a,u)),u.isGroup&&u.childShapes&&u.childShapes.forEach((function(t){e.updateShapeTextbox(t,i,a)})),u.updateInnerBoundary(),Qi(u,n.rect.right-n.textStart()),u.startFetchingImg(),u}},{key:"updateShapeTextbox",value:function(t,a,n){t.isGroup?t.childShapes.forEach((function(t){e.updateShapeTextbox(t,a,n)})):t.textbox_page&&(t.updater=a.getTextboxUpdater(),t.updater.pendingToHost(t.textbox_page,t),t.updater.updateTextBox(n,t))}}]),e}(),tr=function(){function e(){i()(this,e)}return o()(e,null,[{key:"isExclusiveEmbed",value:function(e){return e.chpx.getPropVal("spacing")>=4096}},{key:"makeEmbedCard",value:function(e,t,a,n){var i=er.makeEmbedCard(e,t,a,n);return i.isExclusive=this.isExclusiveEmbed(t.glyphIterator.glyphGroup),i}}]),e}(),ar=function(){function e(){i()(this,e)}return o()(e,[{key:"makeTextLinePolicy",value:function(e,t){return new Di(e,t)}},{key:"makeTableLinePolicy",value:function(e,t,a){return new Ni(e,t,a)}},{key:"makeTableAgent",value:function(e,t){return new ji(e,t)}},{key:"makeLayers",value:function(e){return new Vi(e)}},{key:"makeLayersPolicy",value:function(e){return new Zi(e)}},{key:"makeEmbedPolicy",value:function(e){return new zi(e)}},{key:"makePageAgent",value:function(e,t){return window.APP.isMobileMode()?new Yi(e,t):new Xi(e,t)}},{key:"getEmbedShapeFactory",value:function(){return window.APP.isMobileMode()?er:tr}},{key:"getShapeCardFactory",value:function(){return $i}}]),e}(),nr=a(6006),ir=function(){function e(t){i()(this,e),this.init(t)}return o()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCViewUpdater",base:w,methodName:"init"},{baseName:"DOCViewUpdater",base:w,methodName:"pushView"},{baseName:"DOCViewUpdater",base:w,methodName:"clearAll"},{baseName:"DOCViewUpdater",base:w,methodName:"onSettingsChanged"}]}}]),o()(e,[{key:"init",value:function(e){this.mixin_DOCViewUpdater_init(e),this.updaterFactory=new ar,this.pageFactory=new Oi(e,this),this.mobilePageUpdater=new Ui(this),this.commentUpdater=new $a(e),this.isMobile=!0,this.pageUpdaters=[this.mobilePageUpdater]}},{key:"clearAll",value:function(e){this.mixin_DOCViewUpdater_clearAll(e),this.dropPages(this.view,{from:0,to:this.view.layout_pages.length}),this.view.pageCount=0,this.commentUpdater.clearAll()}},{key:"pushView",value:function(e){var t=Math.max(100,document.body.cacheDOMAttr.clientHeight);this.mixin_DOCViewUpdater_pushView(),this.typoStep=t,this.typoHeight=Number.MAX_SAFE_INTEGER,this.typoDisablePageBreak=!1,this.typoDisableTableBreak=!1;var a=window.APP.workspace.getCurrentRect(),n=t;e&&(a=e.viewport||a,n=e.step||n,this.typoDisablePageBreak=!!e.disablePageBreak,this.typoDisableTableBreak=!!e.disableTableBreak),this.typoHeight=a.bottom,this.typoStep=n}},{key:"updateUntil",value:function(e,t){this.pushView(t);for(var a=!1,n=!1,i=this.view,r=null;!e(this);)a||(n=Date.now(),a=!0,r=this.makeViewStatus(i.pageCount)),this.jumpTo(i,r),this.pushUpdatingPage(i,r),this.linkPage(i,r),this.updatePage(i,r),this.pageDone(i,r);return a&&this.finished(!1)?(i.layout_pages.length>i.pageCount&&this.dropPages(i,{from:i.pageCount,to:i.layout_pages.length}),this.view.onAllPageDone()):this.view.layout_pages.slice(this.view.pageCount).forEach((function(e){e.onDel(),e.comments&&e.comments.hide()})),a&&(this.updateView(i,r),this.freeViewStatus(r),console.log("updateUntil elapse ",Date.now()-n," ms")),a}},{key:"jumpTo",value:function(e,t){e.pageCount>0&&e.layout_pages[e.pageCount-1].isPageBroken&&--e.pageCount;var a=e.pageCount;t.lastPage=a>0?this.view.layout_pages[a-1]:null,t.updatingIndex=a,t.startIndex=Math.min(t.startIndex,a),t.sectionInfo||(t.sectionInfo=this.getSectionInfoAt(0))}},{key:"pushUpdatingPage",value:function(e,t){var a=this.mobilePageUpdater,n=e.layout_pages,i=t.updatingIndex,r=n.slice(i).findIndex((function(n){return a.usablePendingPage(e,t,n)}));r>0&&this.dropPages(e,{from:i,to:i+r}),t.updatingPage=e.layout_pages[i];var o=i>0?e.layout_pages[i-1]:null;if(o&&!o.isFootnoteSep&&!o.isEndnoteSep){var s=this.document.getSubDocRange(l.MainText),c=this.document.getSubDocRange(l.Footnote),u=this.mobilePageUpdater.settledPos(o);u===s.pos+s.len?(c.len?this.pushFootEndNoteSepPage(e,t,!0):this.pushFootEndNoteSepPage(e,t,!1),++i):u===c.pos+c.len&&(this.pushFootEndNoteSepPage(e,t,!1),++i)}a.reuseUpdatingPage(e,t)||n.splice(i,0,this.pageFactory.makePage(t)),t.updatingPage=e.layout_pages[i]}},{key:"linkPage",value:function(e,t){var a=t.updatingPage,n=t.updatingIndex,i=this.view.heightAt(n);a.layout_index=n,a.outer_rect.updateByOrigin(null,i),Object.assign(a,t.sectionInfo)}},{key:"updatePage",value:function(e,t){var a=t.updatingPage,n=this.mobilePageUpdater;n.pushPage(a,t),n.updatePage(a,t)&&a.onModify(),n.cleanPage(a,t)}},{key:"pushFootEndNoteSepPage",value:function(e,t,a){var n=this.view.heightAt(e.pageCount);if(t.updatingPage){if(t.updatingPage.isFootnoteSep&&a)return++e.pageCount,++t.updatingIndex,t.updatingPage.outer_rect.updateByOrigin(null,n),t.updatingPage.onOffsetYTo(n),t.lastPage=t.updatingPage,void(t.updatingPage=e.layout_pages[t.updatingIndex]);if(t.updatingPage.isEndnoteSep&&!a)return++e.pageCount,++t.updatingIndex,t.updatingPage.outer_rect.updateByOrigin(null,n),t.updatingPage.onOffsetYTo(n),t.lastPage=t.updatingPage,void(t.updatingPage=e.layout_pages[t.updatingIndex])}var i=this.pageFactory.makePage(t),r=nr.b;a?(i.isFootnoteSep=!0,this.isAllFootnoteRefIsRevisionHiddle()&&(r=0)):(i.isEndnoteSep=!0,this.isAllEndnoteRefIsRevisionHiddle()&&(r=0)),i.outer_rect.updateByHeight(r),i.outer_rect.updateByOrigin(null,n),e.layout_pages.splice(e.pageCount,0,i),++e.pageCount,++t.updatingIndex,t.lastPage=i,t.updatingPage=e.layout_pages[t.updatingIndex]}},{key:"_updateSepPage",value:function(e,t){e.rect.bottom!==t.rect.top&&(t.rect.updateByOrigin(null,e.rect.bottom),t.onOffsetYTo(e.rect.bottom));var a=nr.b;t.isFootnoteSep?this.isAllFootnoteRefIsRevisionHiddle()&&(a=0):this.isAllEndnoteRefIsRevisionHiddle()&&(a=0),a!==t.rect.height&&(t.rect.updateByHeight(a),t.onDel())}},{key:"pageDone",value:function(e,t){var a=t.updatingIndex,n=t.updatingPage;if(delete n.startLineNumbering,delete n.nextLineNumbering,!n.isTable&&n._prevTable){var i=n._prevTable;this.mobilePageUpdater.updateLastTable(i,t),i.onModify(),delete i._nextTable,delete n._prevTable,n.rect.offset(0,i.rect.bottom-n.rect.top)}var r=!1;!n.isTable||!n._nextTable&&n.page.lines[n.page.lines.length-1].isLastTable||(r=!0),e.pageCount++,e.composeProcessLayout(n);for(var o=this.data.doc,s=o.getSubDocRange(l.MainText),c=o.getSubDocRange(l.Footnote),u=o.getSubDocRange(l.Endnote),h=a+1;h<e.layout_pages.length;++h){var d=e.layout_pages[h],g=this.mobilePageUpdater.settledPos(n),f=this.mobilePageUpdater.pendingPos(d);if(d.isFootnoteSep&&c.len){if(g===s.pos+s.len){e.pageCount++,this._updateSepPage(n,d),n=d;continue}break}if(d.isEndnoteSep&&u.len){if(g===c.pos+c.len){e.pageCount++,this._updateSepPage(n,d),n=d;continue}if(g===s.pos+s.len&&0===c.len){e.pageCount++,this._updateSepPage(n,d),n=d;continue}break}if(n.isFootnoteSep){if(f!==c.pos||d.pagePendings.length||n.rect.bottom!==d.rect.top)break;e.pageCount++,n=d}else if(n.isEndnoteSep){if(f!==u.pos||d.pagePendings.length||n.rect.bottom!==d.rect.top)break;e.pageCount++,n=d}else{if(!this.mobilePageUpdater.compatWithNextPage(n,d)||r&&d.isTable&&!d._nextTable){r&&d.isTable&&!d._nextTable&&d.comments&&(d.comments.expired=!0);break}e.pageCount++,n.isTable&&d.isTable&&!n._nextTable&&!n.page.lines[n.page.lines.length-1].isLastTable&&(n._nextTable=d,d._prevTable=n,n._prevTable||(n._drawingOffset=p()({},d._drawingOffset))),n=d}}var v=this.view.heightAt(e.pageCount);this.view.height=v+(this.view.paddingBottom||this.view.verticalPadding),this.view.orgPageHeight&&(this.view.height=Math.max(this.view.orgPageHeight,this.view.height)),v>=this.typoHeight&&(this.typoHeight=v+this.typoStep)}},{key:"updateView",value:function(e,t){e.onUpdated()}},{key:"prepareIdle",value:function(){}},{key:"selectPageUpdater",value:function(e){return this.mobilePageUpdater}},{key:"freeLayoutPage",value:function(e){this.mobilePageUpdater.killPage(e),this.pageFactory.freePage(e)}},{key:"dropPages",value:function(e,t){var a=this,n=t.from,i=t.to;"number"!=typeof i&&(i=n+1);var r=this.pageFactory,o=e.layout_pages,s=o.slice(n,i);e.pageCount>n&&(this.pageCount=n),s.forEach((function(e){a.mobilePageUpdater.killPage(e)})),o.splice(n,i-n).forEach((function(e){e._prevTable&&(e._prevTable._nextTable=e._nextTable,e._prevTable.tableWidth&&e._prevTable.width<e._prevTable.tableWidth.width&&(e._prevTable.tableWidth.expired=!0)),e._nextTable&&(e._nextTable._prevTable=e._prevTable),delete e._prevTable,delete e._nextTable,r.freePage(e)}))}},{key:"finished",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.mobilePageUpdater.finished(e)}},{key:"updateToPage",value:function(e,t){var a=window.APP.workspace.getCurrentRect(),n=this.updateUntil((function(t){return t.goodViewport(a)&&t.goodPage(e)}),Object.assign({viewport:a},t));return this.view.updateComponent(n,{pageNo:e}),n}},{key:"updateViewport",value:function(e,t){var a=this.updateUntil((function(t){return t.goodViewport(e)}),Object.assign({viewport:e},t));return this.view.updateComponent(a,{}),a}},{key:"updateToPosition",value:function(e,t){var a=window.APP.workspace.getCurrentRect(),n=this.updateUntil((function(t){return t.goodViewport(a)&&t.goodPosition(e)}),Object.assign({viewport:a},t));return this.view.updateComponent(n,{pos:e}),n}},{key:"updateOnCondition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"!=typeof e)return!1;var a=this.updateUntil(e,t.context);return this.view.updateComponent(a,t),a}},{key:"goodPosition",value:function(e){var t=this.view.textLineRanges.findNodeContainPos(e);t||this.view.tableLineRanges.forEachHintInRange(e,e,(function(e){if(!e._node.line.isBrokenAfter)return t=e._node,!0}),(function(t,a){return a.begin<=e&&e<a.end}));var a=t&&t.line;return!(!a||a.isMoc||a.viewPage.expired())||this.finished()}},{key:"goodViewport",value:function(e){var t=this.view,a=t.pageCount;if(a&&t.heightAt(a)>=e.bottom)return!0;return this.finished()}},{key:"invalidateView",value:function(e,t){var a=t||{pos:0,len:this.document.getTextSize()};this.pendingByOutdatedRange({begin:a.pos,end:a.pos+a.len,lines:[]})}},{key:"guessOutdatedTableOnBeforeInsert",value:function(e){var t=e.begin,a=e.end,n=!1,i=null,r=null,o=null,s=this.view;return s.tableLineRanges.forEachHintInRange(t,a,(function(t){(r=t._node.line).obsoleted=x.All,g.IT.calcBoundary(e,t),e.outdatedTable=!0,e.lines.push(r),o&&(e.lines.push(o),e.end=o.range.end),n=!0}),(function(e,a){if(r=a._node.line,i=r.viewPage.page,a.begin===t&&a._node.line.tablecells[0].merge_type>1)return!0;if(a.end===t&&i.lines[i.lines.length-1]===r){var n=s.layout_pages[r.viewPage.layout_index+1];return n&&(o=n.page.lines[0]),!0}})),n}},{key:"onInsertText",value:function(e,t,a,n,i,r,o){if(this.data.glyphpool.onInsertText(e,t,a,n),this.lookaheads.expand(t,a.length),this.view.textLineRanges.expand(t,a.length),this.view.tableLineRanges.expand(t,a.length),this.view.embedShapeRanges.expand(t,a.length),this.view.shapeCardRanges.expand(t,a.length),this.view.commentsRanges.expand(t,a.length),this.view.mathCache&&this.view.mathCache.onInsertText(e,t,a,n),o){var s=this.data.doc.textStream.getPapx(t),c=this.view.commentsRanges.findNodeEqualRange(s.pos,s.pos);c&&(this.view.commentsRanges.detachNode(c),c.reset(t+a.length),this.view.commentsRanges.attachNode(c))}}},{key:"onDeleteText",value:function(e,t,a){this.data.glyphpool.onDeleteText(e,t,a),this.lookaheads.remove(t,a.length),this.view.textLineRanges.remove(t,a.length),this.view.tableLineRanges.remove(t,a.length),this.view.embedShapeRanges.remove(t,a.length),this.view.shapeCardRanges.remove(t,a.length),this.view.mathCache&&this.view.mathCache.onDeleteText(e,t,a),this.view.commentsRanges.detachNodes(t,t+a.length,g.IT.intersectTest).nodes.forEach((function(e){t<=e.pos&&e.pos<=t+a.length&&Hi.freeComments(e)})),this.view.commentsRanges.remove(t,a.length)}},{key:"onCommentPreview",value:function(e){var t=this.view.locateViewPage(e);t&&this.mobilePageUpdater.pendingToComment(t,{expired:!0})}},{key:"onCommentHeight",value:function(e,t){var a=t,n=this.view.comments[e];n&&(0===a&&(a=1),a!==n.comments.height&&this.mobilePageUpdater.pendingToComment(n,{height:a}))}},{key:"onTitleHeightChange",value:function(){this.invalidateView(null,{pos:0,len:1})}},{key:"getUsableHeightOfPage",value:function(e){if(e.isTable){if(this.typoDisableTableBreak)return Number.MAX_SAFE_INTEGER}else if(this.typoDisablePageBreak)return Number.MAX_SAFE_INTEGER;return this.typoHeight-e.rect.top}},{key:"onSettingsChanged",value:function(){this.mixin_DOCViewUpdater_onSettingsChanged(),this.invalidateView()}},{key:"isAllFootnoteRefIsRevisionHiddle",value:function(){var e=this.data.doc,t=!1;return e.footnotes.rangeClass.mapInRange(0,e.getMainTextLength(),(function(e){e._node.isRevisionHidden||(t=!0)}),g.IT.strictIntersectTest),!t}},{key:"isAllEndnoteRefIsRevisionHiddle",value:function(){var e=this.data.doc,t=!1;return e.endnotes.rangeClass.mapInRange(0,e.getMainTextLength(),(function(e){e._node.isRevisionHidden||(t=!0)}),g.IT.strictIntersectTest),!t}}]),e}(),rr=ir;s.a.mix(ir,w);var or=function(){switch(window.APP.typoMode){case Dt.TYPO_MODE.MODE_PC:case Dt.TYPO_MODE.MODE_PAGINATION:return Si;case Dt.TYPO_MODE.MODE_MOBILE:case Dt.TYPO_MODE.MODE_WEB:return rr;default:return null}}},1478:function(e,t,a){"use strict";var n=a(1),i=a.n(n),r=a(2),o=a.n(r),s=a(22),c=a.n(s),l=a(23),u=a.n(l),h=function(e){function t(e,a,n,r,o){return i()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,n,r,o))}return u()(t,e),o()(t,[{key:"_doRender",value:function(e){e.lineWidth=this._lineWidth,e.strokeStyle=this._color,e.stroke()}}]),t}(a(2505).a);t.a=h},2505:function(e,t,a){"use strict";var n=a(1),i=a.n(n),r=a(2),o=a.n(r),s=function(){function e(t,a,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;i()(this,e),this._data=t,this._lineWidth=a,this._color=n,this._left=r,this._top=o}return o()(e,[{key:"offsetXTo",value:function(e){this._left=e}},{key:"offsetYTo",value:function(e){this._top=e}},{key:"render",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!1;t&&(e.save(),e.translate(this._left,this._top),a=!0),e.beginPath(),this._data.forEach((function(t){var a=t.cmd,n=t.args;switch(a){case"M":e.moveTo(n[0],n[1]);break;case"C":e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);break;case"L":e.lineTo(n[0],n[1]);break;case"Q":e.quadraticCurveTo(n[0],n[1],n[2],n[3]);break;case"S":e.bezierCurToContinue(n[0],n[1],n[2],n[3]);break;case"A":e.arcTo(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case"Z":e.closePath()}})),this._doRender(e),a&&e.restore()}},{key:"left",get:function(){return this._left}},{key:"right",get:function(){return this._left+this.width}},{key:"top",get:function(){return this._top}},{key:"bottom",get:function(){return this._top+this.height}}]),e}();t.a=s},3283:function(e,t,a){"use strict";a.d(t,"a",(function(){return h})),a.d(t,"b",(function(){return d})),a.d(t,"e",(function(){return p})),a.d(t,"d",(function(){return g})),a.d(t,"c",(function(){return f})),a.d(t,"f",(function(){return v}));var n=a(1),i=a.n(n),r=a(2),o=a.n(r),s=a(772),c=a(411),l=a(324);function u(e,t){return!!(Math.abs(t-e)<=1&&t&&e)}var h=function(){function e(t,a){i()(this,e),this.maxBottomMargin=t,this.btmSpacingExtend=a}return o()(e,[{key:"calcOffset",value:function(e,t){var a=t.cell_page;if(a){var n=t.layers,i=0;if(n&&(i+=n.bottomCards&&n.bottomCards.length||0,i+=n.topCards&&n.topCards.length||0,i+=n.textframes&&n.textframes.length||0),t.align_type===s.a.TOP||i>0)t.cell2page_offset.y=0;else{var r=t.cell2page_offset.y,o=0;if(a.lines.length>0){var c=a.lines[a.lines.length-1];o=c.rect.bottom+c.after_space}var l=0;0!=e&&(l=e-this.btmSpacingExtend-this.maxBottomMargin-a.rect.top),o<=l?t.align_type===s.a.Center?u((l-o)/2,t.cell2page_offset.y)||(t.cell2page_offset.y=(l-o)/2):u(l-o,t.cell2page_offset.y)||(t.cell2page_offset.y=l-o):t.cell2page_offset.y=0,t.cell2page_offset.y!==r&&a.renderInfo&&(a.renderInfo.moved=!0,t.parent.renderInfo.expired=!0)}}}}]),e}(),d=function(){function e(){i()(this,e)}return o()(e,null,[{key:"getTableTopGap",value:function(e){return Math.max(e.maxTopMargin,e.maxTopBorder)}},{key:"getTableTopSpacing",value:function(t){var a=t.spacing;return e.isFirstTableLine(t)&&(a+=t.spacing),a}},{key:"isFirstTableLine",value:function(e){var t=e.parent;return 0===t.lines.length||t.lines[t.lines.length-1].layoutType===c.DOCLayoutType.TableLine}},{key:"findBreakLine",value:function(e,t){var a=t.prev;if(!e||!a||0===a.lines.length)return null;if(e.parent!==t){if(!e.isBrokenAfter)return null}else if(!e.isBrokenBefore)return null;var n=null,i=a.lines.length-1;do{var r=a.lines[i];if(r.layoutType!==c.DOCLayoutType.TableLine)break;if(!r.isBrokenAfter)break;if(e.parent===t&&r.range.end===e.range.end)break;n=r,--i}while(i>=0);return n}}]),e}();function p(e,t){var a=t.parent;if(0===a.lines.length)return null;var n=a.lines.findIndex((function(e){return e===t}));-1===n&&(n=a.lines.length-1);for(var i=n;i>=0;--i){var r=a.lines[i];if(r.layoutType!==c.DOCLayoutType.TableLine)break;for(var o=!1,l=0;l<r.tablecells.length;++l){var u=r.tablecells[l];if(e>=u.rect.left&&e<u.rect.right){if(o=!0,u.merge_type===s.e.FIRST)return u;u.merge_type===s.e.NONE&&(o=!1);break}if(e<u.rect.left)break}if(!1===o)break}return null}function g(e){return e.isTableLast?e.maxBottomBorder+2*e.spacing:e.spacing}function f(e,t){for(var a=e.tablecells,n=e.renderInfo&&e.renderInfo.height!==e.rect.height,i=0;i<a.length;++i){var r=a[i];if((e.isTableLast||t)&&r.merge_type!==s.e.NONE||r.merge_type===s.e.LAST){var o;if(!(o=p(r.rect.left,e))||!o.cell_page&&!o.diagCell||o.cell_page&&o.cell_page.prev)continue;var c=o.parent;if(!c.renderInfo||e.renderInfo&&!n||(c.renderInfo.moved=!0),o.align_type===s.a.TOP)continue;var l=e.rect.bottom-c.rect.top;new h(e.maxBottomMargin,g(e)).calcOffset(l,o)}}}function v(e,t,a,n){if(e>0&&e===t.lines.length-1){var i=t.lines[e-1];if(i.layoutType===c.DOCLayoutType.TableLine||i.layoutType===c.DOCLayoutType.SnippetLine&&!n){var r=t.lines[e];if(1===r.range.len)if(a.glyphBuff.getCharCode(r.range.pos)===l.l)return!0}}return!1}},3821:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return r}));var n={"∏":{viewboxSize:{width:264,height:358},commands:[{cmd:"M",args:[15.3,351.4]},{cmd:"L",args:[15.5,351.4]},{cmd:"L",args:[82,350.9]},{cmd:"L",args:[82.7,350.9]},{cmd:"L",args:[83.4,350.9]},{cmd:"L",args:[84.1,350.9]},{cmd:"L",args:[84.5,350.9]},{cmd:"L",args:[84.9,350.9]},{cmd:"L",args:[85.3,350.9]},{cmd:"L",args:[85.7,350.9]},{cmd:"L",args:[86.1,350.9]},{cmd:"L",args:[86.5,350.9]},{cmd:"L",args:[86.9,350.8]},{cmd:"L",args:[87.3,350.7]},{cmd:"L",args:[87.7,350.6]},{cmd:"L",args:[88.1,350.5]},{cmd:"L",args:[88.5,350.4]},{cmd:"C",args:[88.6,350.4,88.6,350.4,88.7,350.4]},{cmd:"L",args:[89,350.3]},{cmd:"C",args:[92.1,349.4,94.2,347.5,94.1,343.3]},{cmd:"C",args:[94.1,338.7,91.5,336.5,87.8,335.6]},{cmd:"L",args:[87.4,335.5]},{cmd:"C",args:[87.3,335.5,87.3,335.5,87.2,335.5]},{cmd:"L",args:[86.8,335.4]},{cmd:"L",args:[86.4,335.3]},{cmd:"C",args:[86.3,335.3,86.3,335.3,86.2,335.3]},{cmd:"L",args:[85.8,335.2]},{cmd:"L",args:[85.4,335.1]},{cmd:"L",args:[85,335.1]},{cmd:"L",args:[84.6,335.1]},{cmd:"L",args:[84.2,335.1]},{cmd:"L",args:[83.8,335.1]},{cmd:"L",args:[83.4,335.1]},{cmd:"L",args:[83,335.1]},{cmd:"L",args:[82.3,335.1]},{cmd:"L",args:[81.8,335.1]},{cmd:"L",args:[81.6,335.1]},{cmd:"C",args:[70.9,335.2,62,326.6,61.8,315.9]},{cmd:"L",args:[61.8,315.4]},{cmd:"L",args:[61.8,31.7]},{cmd:"L",args:[203.7,31.7]},{cmd:"L",args:[203.7,314.1]},{cmd:"C",args:[203.7,325.6,194.5,335,183,335.3]},{cmd:"L",args:[182,335.3]},{cmd:"L",args:[181.5,335.3]},{cmd:"L",args:[181,335.3]},{cmd:"L",args:[180.6,335.3]},{cmd:"C",args:[180.5,335.3,180.5,335.3,180.4,335.3]},{cmd:"L",args:[180,335.3]},{cmd:"C",args:[179.9,335.3,179.7,335.3,179.6,335.3]},{cmd:"L",args:[179.2,335.3]},{cmd:"L",args:[178.8,335.4]},{cmd:"L",args:[178.4,335.5]},{cmd:"L",args:[178,335.6]},{cmd:"C",args:[177.9,335.6,177.9,335.6,177.8,335.6]},{cmd:"L",args:[177.4,335.7]},{cmd:"C",args:[177.1,335.8,176.9,335.8,176.6,335.9]},{cmd:"L",args:[176.2,336]},{cmd:"C",args:[172.6,337,170.3,339.2,170.3,343.7]},{cmd:"C",args:[170.3,348.1,172.6,349.9,175.9,350.7]},{cmd:"L",args:[176.3,350.8]},{cmd:"C",args:[176.4,350.8,176.4,350.8,176.5,350.8]},{cmd:"L",args:[176.9,350.9]},{cmd:"L",args:[177.3,351]},{cmd:"C",args:[177.4,351,177.4,351,177.5,351]},{cmd:"L",args:[177.9,351.1]},{cmd:"L",args:[178.3,351.1]},{cmd:"L",args:[178.7,351.1]},{cmd:"L",args:[179.1,351.1]},{cmd:"L",args:[179.5,351.1]},{cmd:"L",args:[179.9,351.1]},{cmd:"L",args:[180.3,351.1]},{cmd:"L",args:[181,351.1]},{cmd:"L",args:[181.4,351.1]},{cmd:"L",args:[182.3,351.1]},{cmd:"L",args:[182.8,351.1]},{cmd:"L",args:[183,351.1]},{cmd:"L",args:[249.5,350.6]},{cmd:"L",args:[250.2,350.6]},{cmd:"L",args:[250.9,350.6]},{cmd:"L",args:[251.6,350.6]},{cmd:"L",args:[252,350.6]},{cmd:"L",args:[252.4,350.6]},{cmd:"L",args:[252.8,350.6]},{cmd:"L",args:[253.2,350.6]},{cmd:"L",args:[253.6,350.6]},{cmd:"L",args:[254,350.6]},{cmd:"L",args:[254.4,350.5]},{cmd:"L",args:[254.8,350.4]},{cmd:"L",args:[255.2,350.3]},{cmd:"L",args:[255.6,350.2]},{cmd:"L",args:[256,350.1]},{cmd:"C",args:[256.1,350.1,256.1,350.1,256.2,350.1]},{cmd:"L",args:[256.5,350]},{cmd:"L",args:[256.8,349.9]},{cmd:"C",args:[259.7,349,261.6,347,261.6,343]},{cmd:"C",args:[261.6,338.3,258.9,336.2,255.1,335.3]},{cmd:"L",args:[254.7,335.2]},{cmd:"L",args:[254.3,335.1]},{cmd:"L",args:[253.9,335]},{cmd:"C",args:[253.8,335,253.8,335,253.7,335]},{cmd:"L",args:[253.3,334.9]},{cmd:"L",args:[252.9,334.8]},{cmd:"L",args:[252.5,334.8]},{cmd:"L",args:[252.1,334.8]},{cmd:"L",args:[251.7,334.8]},{cmd:"L",args:[251.3,334.8]},{cmd:"L",args:[250.9,334.8]},{cmd:"L",args:[250.5,334.8]},{cmd:"L",args:[249.8,334.8]},{cmd:"L",args:[249.3,334.8]},{cmd:"L",args:[249.1,334.8]},{cmd:"C",args:[238.4,334.9,229.5,326.3,229.3,315.6]},{cmd:"L",args:[229.3,315.1]},{cmd:"L",args:[229.3,31.7]},{cmd:"L",args:[248.9,31.7]},{cmd:"C",args:[255.8,31.7,261.5,26.1,261.5,19.1]},{cmd:"C",args:[261.5,12.2,256,6.6,249.2,6.5]},{cmd:"L",args:[15.5,6.5]},{cmd:"C",args:[8.6,6.5,2.9,12.1,2.9,19.1]},{cmd:"C",args:[2.9,26,8.4,31.6,15.2,31.7]},{cmd:"L",args:[15.4,31.7]},{cmd:"L",args:[36.4,31.7]},{cmd:"L",args:[36.4,314.1]},{cmd:"C",args:[36.4,325.6,27.2,335,15.7,335.3]},{cmd:"L",args:[14.7,335.3]},{cmd:"L",args:[14.2,335.3]},{cmd:"L",args:[13.7,335.3]},{cmd:"L",args:[13.3,335.3]},{cmd:"C",args:[13.2,335.3,13.2,335.3,13.1,335.3]},{cmd:"L",args:[12.7,335.3]},{cmd:"C",args:[12.6,335.3,12.4,335.3,12.3,335.3]},{cmd:"L",args:[11.9,335.3]},{cmd:"L",args:[11.5,335.4]},{cmd:"L",args:[11.1,335.5]},{cmd:"L",args:[10.7,335.6]},{cmd:"C",args:[10.6,335.6,10.6,335.6,10.5,335.6]},{cmd:"L",args:[10.1,335.7]},{cmd:"C",args:[9.8,335.8,9.6,335.8,9.3,335.9]},{cmd:"L",args:[8.9,336]},{cmd:"C",args:[5.3,337,3,339.2,3,343.7]},{cmd:"C",args:[3,348.1,5.3,349.9,8.7,350.7]},{cmd:"L",args:[9.1,350.8]},{cmd:"C",args:[9.2,350.8,9.2,350.8,9.3,350.8]},{cmd:"L",args:[9.7,350.9]},{cmd:"L",args:[10.1,351]},{cmd:"C",args:[10.2,351,10.2,351,10.3,351]},{cmd:"L",args:[10.7,351.1]},{cmd:"L",args:[11.1,351.1]},{cmd:"L",args:[11.5,351.1]},{cmd:"L",args:[11.9,351.1]},{cmd:"L",args:[12.3,351.1]},{cmd:"L",args:[12.7,351.1]},{cmd:"L",args:[13.1,351.1]},{cmd:"L",args:[13.8,351.1]},{cmd:"L",args:[14.2,351.1]},{cmd:"L",args:[15.1,351.1]},{cmd:"L",args:[15.3,351.4]},{cmd:"Z"}]},"∐":{viewboxSize:{width:265,height:358},commands:[{cmd:"M",args:[249.7,6.6]},{cmd:"L",args:[249.5,6.6]},{cmd:"L",args:[183,7.1]},{cmd:"L",args:[182.3,7.1]},{cmd:"L",args:[181.6,7.1]},{cmd:"L",args:[180.9,7.1]},{cmd:"L",args:[180.5,7.1]},{cmd:"L",args:[180.1,7.1]},{cmd:"L",args:[179.7,7.1]},{cmd:"L",args:[179.3,7.1]},{cmd:"L",args:[178.9,7.1]},{cmd:"L",args:[178.5,7.1]},{cmd:"L",args:[178.1,7.2]},{cmd:"L",args:[177.7,7.3]},{cmd:"L",args:[177.3,7.4]},{cmd:"L",args:[176.9,7.5]},{cmd:"L",args:[176.5,7.6]},{cmd:"C",args:[176.4,7.6,176.4,7.6,176.3,7.6]},{cmd:"L",args:[176,7.8]},{cmd:"C",args:[172.9,8.7,170.8,10.6,170.9,14.8]},{cmd:"C",args:[170.9,19.4,173.5,21.6,177.2,22.5]},{cmd:"L",args:[177.6,22.6]},{cmd:"C",args:[177.7,22.6,177.7,22.6,177.8,22.6]},{cmd:"L",args:[178.2,22.7]},{cmd:"L",args:[178.6,22.8]},{cmd:"C",args:[178.7,22.8,178.7,22.8,178.8,22.8]},{cmd:"L",args:[179.2,22.9]},{cmd:"L",args:[179.6,23]},{cmd:"L",args:[180,23]},{cmd:"L",args:[180.4,23]},{cmd:"L",args:[180.8,23]},{cmd:"L",args:[181.2,23]},{cmd:"L",args:[181.6,23]},{cmd:"L",args:[182,23]},{cmd:"L",args:[182.7,23]},{cmd:"L",args:[183.2,23]},{cmd:"L",args:[183.4,23]},{cmd:"C",args:[194.1,22.9,203,31.5,203.2,42.2]},{cmd:"L",args:[203.2,42.7]},{cmd:"L",args:[203.2,326.2]},{cmd:"L",args:[61.5,326.2]},{cmd:"L",args:[61.5,43.9]},{cmd:"C",args:[61.5,32.4,70.7,23,82.2,22.7]},{cmd:"L",args:[83.2,22.7]},{cmd:"L",args:[83.7,22.7]},{cmd:"L",args:[84.2,22.7]},{cmd:"L",args:[84.6,22.7]},{cmd:"C",args:[84.7,22.7,84.7,22.7,84.8,22.7]},{cmd:"L",args:[85.2,22.7]},{cmd:"C",args:[85.3,22.7,85.5,22.7,85.6,22.7]},{cmd:"L",args:[86,22.7]},{cmd:"L",args:[86.4,22.6]},{cmd:"L",args:[86.8,22.5]},{cmd:"L",args:[87.2,22.4]},{cmd:"C",args:[87.3,22.4,87.3,22.4,87.4,22.4]},{cmd:"L",args:[87.8,22.3]},{cmd:"C",args:[88.1,22.2,88.3,22.2,88.6,22.1]},{cmd:"L",args:[89,22]},{cmd:"C",args:[92.6,21,94.9,18.8,94.9,14.3]},{cmd:"C",args:[94.9,9.9,92.6,8.1,89.3,7.3]},{cmd:"L",args:[88.9,7.2]},{cmd:"C",args:[88.8,7.2,88.8,7.2,88.7,7.2]},{cmd:"L",args:[88.5,7]},{cmd:"L",args:[88.1,6.9]},{cmd:"C",args:[88,6.9,88,6.9,87.9,6.9]},{cmd:"L",args:[87.5,6.8]},{cmd:"L",args:[87.1,6.8]},{cmd:"L",args:[86.7,6.8]},{cmd:"L",args:[86.3,6.8]},{cmd:"L",args:[85.9,6.8]},{cmd:"L",args:[85.5,6.8]},{cmd:"L",args:[85.1,6.8]},{cmd:"L",args:[84.4,6.8]},{cmd:"L",args:[84,6.8]},{cmd:"L",args:[83.1,6.8]},{cmd:"L",args:[82.6,6.8]},{cmd:"L",args:[82.4,6.8]},{cmd:"L",args:[15.9,7.1]},{cmd:"L",args:[15.2,7.1]},{cmd:"L",args:[14.5,7.1]},{cmd:"L",args:[13.8,7.1]},{cmd:"L",args:[13.4,7.1]},{cmd:"L",args:[13,7.1]},{cmd:"L",args:[12.6,7.1]},{cmd:"L",args:[12.2,7.1]},{cmd:"L",args:[11.8,7.1]},{cmd:"L",args:[11.4,7.1]},{cmd:"L",args:[11,7.4]},{cmd:"L",args:[10.6,7.5]},{cmd:"L",args:[10.2,7.6]},{cmd:"L",args:[9.9,7.6]},{cmd:"L",args:[9.6,7.7]},{cmd:"C",args:[9.5,7.7,9.5,7.7,9.4,7.7]},{cmd:"L",args:[9,7.8]},{cmd:"L",args:[8.7,7.9]},{cmd:"C",args:[5.8,8.8,3.9,10.8,3.9,14.8]},{cmd:"C",args:[3.9,19.5,6.6,21.6,10.4,22.5]},{cmd:"L",args:[10.8,22.6]},{cmd:"L",args:[11.2,22.7]},{cmd:"L",args:[11.6,22.8]},{cmd:"C",args:[11.7,22.8,11.7,22.8,11.8,22.8]},{cmd:"L",args:[12.2,22.9]},{cmd:"L",args:[12.6,23]},{cmd:"L",args:[13,23]},{cmd:"L",args:[13.4,23]},{cmd:"L",args:[13.8,23]},{cmd:"L",args:[14.2,23]},{cmd:"L",args:[14.6,23]},{cmd:"L",args:[15,23]},{cmd:"L",args:[15.7,23]},{cmd:"L",args:[16.2,23]},{cmd:"L",args:[16.4,23]},{cmd:"C",args:[27.1,22.9,36,31.5,36.2,42.2]},{cmd:"L",args:[36.2,42.7]},{cmd:"L",args:[36.2,326.2]},{cmd:"L",args:[16.6,326.2]},{cmd:"C",args:[9.7,326.2,4,331.8,4,338.8]},{cmd:"C",args:[4,345.7,9.5,351.3,16.3,351.4]},{cmd:"L",args:[249.2,351.4]},{cmd:"C",args:[256.1,351.4,261.8,345.8,261.8,338.8]},{cmd:"C",args:[261.8,331.9,256.3,326.3,249.5,326.2]},{cmd:"L",args:[249.3,326.2]},{cmd:"L",args:[228.3,326.2]},{cmd:"L",args:[228.3,43.9]},{cmd:"C",args:[228.3,32.4,237.5,23,249,22.7]},{cmd:"L",args:[250,22.7]},{cmd:"L",args:[250.5,22.7]},{cmd:"L",args:[251,22.7]},{cmd:"L",args:[251.4,22.7]},{cmd:"C",args:[251.5,22.7,251.5,22.7,251.6,22.7]},{cmd:"L",args:[252,22.7]},{cmd:"C",args:[252.1,22.7,252.3,22.7,252.4,22.7]},{cmd:"L",args:[252.8,22.7]},{cmd:"L",args:[253.2,22.6]},{cmd:"L",args:[253.6,22.5]},{cmd:"L",args:[254,22.4]},{cmd:"C",args:[254.1,22.4,254.1,22.4,254.2,22.4]},{cmd:"L",args:[254.6,22.3]},{cmd:"C",args:[254.9,22.2,255.1,22.2,255.4,22.1]},{cmd:"L",args:[255.8,22]},{cmd:"C",args:[259.4,21,261.7,18.8,261.7,14.3]},{cmd:"C",args:[261.7,9.9,259.4,8.1,256,7.3]},{cmd:"L",args:[255.6,7.2]},{cmd:"C",args:[255.5,7.2,255.5,7.2,255.4,7.2]},{cmd:"L",args:[255.5,7]},{cmd:"L",args:[255.1,6.9]},{cmd:"C",args:[255,6.9,255,6.9,254.9,6.9]},{cmd:"L",args:[254.5,6.8]},{cmd:"L",args:[254.1,6.8]},{cmd:"L",args:[253.7,6.8]},{cmd:"L",args:[253.3,6.8]},{cmd:"L",args:[252.9,6.8]},{cmd:"L",args:[252.5,6.8]},{cmd:"L",args:[252.1,6.8]},{cmd:"L",args:[251.4,6.8]},{cmd:"L",args:[251,6.8]},{cmd:"L",args:[250.1,6.8]},{cmd:"L",args:[249.7,6.6]},{cmd:"Z"}]},"∑":{viewboxSize:{width:304,height:406},commands:[{cmd:"M",args:[294.89,405.19]},{cmd:"C",args:[295.31,399.49,302.73,324.4,303.15,315.96]},{cmd:"L",args:[291.31,314.16]},{cmd:"C",args:[287.49,328.09,284.1,337.49,281.13,346.35]},{cmd:"C",args:[278.17,355.22,275.09,362.18,271.91,367.25]},{cmd:"C",args:[268.73,372.32,264.97,375.85,260.63,377.86]},{cmd:"C",args:[256.28,379.86,250.83,380.86,244.26,380.86]},{cmd:"L",args:[36.78,380.86]},{cmd:"L",args:[192.98,191.79]},{cmd:"L",args:[41.26,24.92]},{cmd:"L",args:[235.36,24.92]},{cmd:"C",args:[238.53,24.92,241.82,25.23,245.21,25.87]},{cmd:"C",args:[248.6,26.5,252.1,28.77,255.7,32.68]},{cmd:"S",args:[263.01,42.75,266.83,51.2]},{cmd:"C",args:[270.64,59.64,274.46,69.67,278.27,85.29]},{cmd:"L",args:[291.07,83.49]},{cmd:"L",args:[289.8,1.19]},{cmd:"C",args:[277.09,3.72,265.59,5.2,255.31,5.62]},{cmd:"C",args:[245.03,6.05,233.96,6.26,222.09,6.26]},{cmd:"L",args:[7.83,6.26]},{cmd:"L",args:[7.83,19.87]},{cmd:"L",args:[166.07,194.14]},{cmd:"L",args:[1.15,391.58]},{cmd:"L",args:[11.01,405.19]},{cmd:"Z"}]},"∫":{viewboxSize:{width:161,height:522},commands:[{cmd:"M",args:[74,434.26]},{cmd:"C",args:[83.09,386.34,100.56,111.32,102.56,94.46]},{cmd:"C",args:[104.56,77.6,113.95,24.51,139.98,20.43]},{cmd:"C",args:[142.95,19.97,147.98,21.89,155.08,26.18]},{cmd:"L",args:[160,11.42]},{cmd:"C",args:[156.82,4.47,148.99,1,136.51,1]},{cmd:"C",args:[112.89,1,89.69,30.27,82.61,94.46]},{cmd:"C",args:[75.52,158.65,61.09,380.06,54.11,426.84]},{cmd:"C",args:[47.12,473.62,28.63,500.08,20.28,501.09]},{cmd:"C",args:[13.83,501.87,9.32,499.93,6.74,495.28]},{cmd:"L",args:[1,512.35]},{cmd:"C",args:[3.35,518.45,9.78,521.5,20.28,521.5]},{cmd:"C",args:[42.58,521.5,64.91,482.18,74,434.26]},{cmd:"Z"}]},"∬":{viewboxSize:{width:257,height:522},commands:[{cmd:"M",args:[136.51,1]},{cmd:"C",args:[148.99,1,156.82,4.47,160,11.42]},{cmd:"L",args:[155.08,26.18]},{cmd:"C",args:[147.98,21.89,142.95,19.97,139.98,20.43]},{cmd:"C",args:[113.95,24.51,104.56,77.6,102.56,94.46]},{cmd:"C",args:[100.56,111.32,83.09,386.34,74,434.26]},{cmd:"C",args:[64.91,482.18,42.58,521.5,20.28,521.5]},{cmd:"C",args:[9.78,521.5,3.35,518.45,1,512.35]},{cmd:"L",args:[6.74,495.28]},{cmd:"C",args:[9.32,499.93,13.83,501.87,20.28,501.09]},{cmd:"C",args:[28.63,500.08,47.12,473.62,54.11,426.84]},{cmd:"C",args:[61.09,380.06,75.52,158.65,82.61,94.46]},{cmd:"C",args:[89.69,30.27,112.89,1,136.51,1]},{cmd:"Z"},{cmd:"M",args:[232.51,1]},{cmd:"C",args:[244.99,1,252.82,4.47,256,11.42]},{cmd:"L",args:[251.08,26.18]},{cmd:"C",args:[243.98,21.89,238.95,19.97,235.98,20.43]},{cmd:"C",args:[209.95,24.51,200.56,77.6,198.56,94.46]},{cmd:"C",args:[196.56,111.32,179.09,386.34,170,434.26]},{cmd:"C",args:[160.91,482.18,138.58,521.5,116.28,521.5]},{cmd:"C",args:[105.78,521.5,99.35,518.45,97,512.35]},{cmd:"L",args:[102.74,495.28]},{cmd:"C",args:[105.32,499.93,109.83,501.87,116.28,501.09]},{cmd:"C",args:[124.63,500.08,143.12,473.62,150.11,426.84]},{cmd:"S",args:[171.52,158.65,178.61,94.46]},{cmd:"C",args:[185.69,30.27,208.89,1,232.51,1]},{cmd:"Z"}]},"∭":{viewboxSize:{width:352,height:522},commands:[{cmd:"M",args:[136.51,1]},{cmd:"C",args:[148.99,1,156.82,4.47,160,11.42]},{cmd:"L",args:[155.08,26.18]},{cmd:"C",args:[147.98,21.89,142.95,19.97,139.98,20.43]},{cmd:"C",args:[113.95,24.51,104.56,77.6,102.56,94.46]},{cmd:"C",args:[100.56,111.32,83.09,386.34,74,434.26]},{cmd:"C",args:[64.91,482.18,42.58,521.5,20.28,521.5]},{cmd:"C",args:[9.78,521.5,3.35,518.45,1,512.35]},{cmd:"L",args:[6.74,495.28]},{cmd:"C",args:[9.32,499.93,13.83,501.87,20.28,501.09]},{cmd:"C",args:[28.63,500.08,47.12,473.62,54.11,426.84]},{cmd:"C",args:[61.09,380.06,75.52,158.65,82.61,94.46]},{cmd:"C",args:[89.69,30.27,112.89,1,136.51,1]},{cmd:"Z"},{cmd:"M",args:[232.51,1]},{cmd:"C",args:[244.99,1,252.82,4.47,256,11.42]},{cmd:"L",args:[251.08,26.18]},{cmd:"C",args:[243.98,21.89,238.95,19.97,235.98,20.43]},{cmd:"C",args:[209.95,24.51,200.56,77.6,198.56,94.46]},{cmd:"C",args:[196.56,111.32,179.09,386.34,170,434.26]},{cmd:"C",args:[160.91,482.18,138.58,521.5,116.28,521.5]},{cmd:"C",args:[105.78,521.5,99.35,518.45,97,512.35]},{cmd:"L",args:[102.74,495.28]},{cmd:"C",args:[105.32,499.93,109.83,501.87,116.28,501.09]},{cmd:"C",args:[124.63,500.08,143.12,473.62,150.11,426.84]},{cmd:"S",args:[171.52,158.65,178.61,94.46]},{cmd:"C",args:[185.69,30.27,208.89,1,232.51,1]},{cmd:"Z"},{cmd:"M",args:[327.51,1]},{cmd:"C",args:[339.99,1,347.82,4.47,351,11.42]},{cmd:"L",args:[346.08,26.18]},{cmd:"C",args:[338.98,21.89,333.95,19.97,330.98,20.43]},{cmd:"C",args:[304.95,24.51,295.56,77.6,293.56,94.46]},{cmd:"C",args:[291.56,111.32,274.09,386.34,265,434.26]},{cmd:"C",args:[255.91,482.18,233.58,521.5,211.28,521.5]},{cmd:"C",args:[200.78,521.5,194.35,518.45,192,512.35]},{cmd:"L",args:[197.74,495.28]},{cmd:"C",args:[200.32,499.93,204.83,501.87,211.28,501.09]},{cmd:"C",args:[219.63,500.08,238.12,473.62,245.11,426.84]},{cmd:"S",args:[266.52,158.65,273.61,94.46]},{cmd:"C",args:[280.69,30.27,303.89,1,327.51,1]},{cmd:"Z"}]},"∮":{viewboxSize:{width:161,height:522},commands:[{cmd:"M",args:[136.51,1]},{cmd:"C",args:[148.99,1,156.82,4.47,160,11.42]},{cmd:"L",args:[155.08,26.18]},{cmd:"C",args:[147.98,21.89,142.95,19.97,139.98,20.43]},{cmd:"C",args:[113.95,24.51,104.56,77.6,102.56,94.46]},{cmd:"C",args:[101.85,100.49,99.16,139.5,95.58,189.33]},{cmd:"C",args:[124.05,197.05,145,223.08,145,254]},{cmd:"C",args:[145,288.41,119.06,316.77,85.66,320.57]},{cmd:"L",args:[85.6,321.29]},{cmd:"C",args:[81.39,372.9,77.18,417.49,74,434.26]},{cmd:"C",args:[64.91,482.18,42.58,521.5,20.28,521.5]},{cmd:"C",args:[9.78,521.5,3.35,518.45,1,512.35]},{cmd:"L",args:[6.74,495.28]},{cmd:"C",args:[9.32,499.93,13.83,501.87,20.28,501.09]},{cmd:"C",args:[28.63,500.08,47.12,473.62,54.11,426.84]},{cmd:"C",args:[56.7,409.48,60.32,368.07,64.2,319.58]},{cmd:"C",args:[33.82,313.22,11,286.27,11,254]},{cmd:"C",args:[11,218.16,39.14,188.89,74.54,187.09]},{cmd:"C",args:[77.63,147.91,80.46,113.94,82.61,94.46]},{cmd:"C",args:[89.69,30.27,112.89,1,136.51,1]},{cmd:"Z"},{cmd:"M",args:[94.4,205.69]},{cmd:"C",args:[92.16,236.58,89.65,270.33,87.11,302.35]},{cmd:"C",args:[111,298.11,129.14,277.24,129.14,252.14]},{cmd:"C",args:[129.14,229.71,114.65,210.66,94.53,203.83]},{cmd:"Z"},{cmd:"M",args:[73.41,201.35]},{cmd:"C",args:[47.59,203.87,27.42,225.63,27.42,252.11]},{cmd:"C",args:[27.42,275.96,43.79,295.98,65.9,301.56]},{cmd:"C",args:[68.49,268.81,71.16,233.79,73.69,201.33]},{cmd:"Z"}]},"∯":{viewboxSize:{width:257,height:522},commands:[{cmd:"M",args:[232.51,1]},{cmd:"C",args:[244.99,1,252.82,4.47,256,11.42]},{cmd:"L",args:[251.08,26.18]},{cmd:"C",args:[243.98,21.89,238.95,19.97,235.98,20.43]},{cmd:"C",args:[209.95,24.51,200.56,77.6,198.56,94.46]},{cmd:"C",args:[197.85,100.45,195.19,139,191.64,188.38]},{cmd:"C",args:[221.45,198.79,241,218.16,241,248]},{cmd:"C",args:[241,280.8,217.38,300.95,182.48,310.45]},{cmd:"C",args:[177.98,366.57,173.4,416.32,170,434.26]},{cmd:"C",args:[160.91,482.18,138.58,521.5,116.28,521.5]},{cmd:"C",args:[105.78,521.5,99.35,518.45,97,512.35]},{cmd:"L",args:[102.74,495.28]},{cmd:"C",args:[105.32,499.93,109.83,501.87,116.28,501.09]},{cmd:"C",args:[124.63,500.08,143.12,473.62,150.11,426.84]},{cmd:"C",args:[152.78,408.92,156.55,365.37,160.58,314.85]},{cmd:"C",args:[150.12,316.3,139.01,317,127.5,317]},{cmd:"C",args:[112.94,317,99.02,315.87,86.23,313.54]},{cmd:"C",args:[81.81,368.39,77.34,416.65,74,434.26]},{cmd:"C",args:[64.91,482.18,42.58,521.5,20.28,521.5]},{cmd:"C",args:[9.78,521.5,3.35,518.45,1,512.35]},{cmd:"L",args:[6.74,495.28]},{cmd:"C",args:[9.32,499.93,13.83,501.87,20.28,501.09]},{cmd:"C",args:[28.63,500.08,47.12,473.62,54.11,426.84]},{cmd:"C",args:[56.9,408.14,60.88,361.53,65.11,308.21]},{cmd:"C",args:[34.32,297.96,14,278.42,14,248]},{cmd:"C",args:[14,214.52,38.61,194.22,74.7,184.97]},{cmd:"C",args:[77.73,146.69,80.5,113.59,82.61,94.46]},{cmd:"C",args:[89.69,30.27,112.89,1,136.51,1]},{cmd:"C",args:[148.99,1,156.82,4.47,160,11.42]},{cmd:"L",args:[155.08,26.18]},{cmd:"C",args:[147.98,21.89,142.95,19.97,139.98,20.43]},{cmd:"C",args:[113.95,24.51,104.56,77.6,102.56,94.46]},{cmd:"C",args:[101.89,100.14,99.46,135.15,96.18,180.91]},{cmd:"C",args:[106.13,179.63,116.63,179,127.5,179]},{cmd:"C",args:[142.86,179,157.51,180.25,170.87,182.86]},{cmd:"C",args:[173.83,145.47,176.54,113.24,178.61,94.46]},{cmd:"C",args:[185.69,30.27,208.89,1,232.51,1]},{cmd:"Z"},{cmd:"M",args:[127.5,195]},{cmd:"C",args:[120.51,195,113.76,195.28,107.32,195.82]},{cmd:"L",args:[105.48,195.98]},{cmd:"C",args:[101.89,196.31,98.4,196.73,95.01,197.23]},{cmd:"C",args:[92.74,228.7,90.15,263.87,87.51,297.5]},{cmd:"C",args:[93.18,298.59,99.18,299.44,105.48,300.02]},{cmd:"L",args:[107.32,300.18]},{cmd:"C",args:[113.76,300.72,120.51,301,127.5,301]},{cmd:"S",args:[141.24,300.72,147.68,300.18]},{cmd:"L",args:[149.52,300.02]},{cmd:"C",args:[153.78,299.62,157.9,299.11,161.88,298.48]},{cmd:"C",args:[164.46,265.72,167.1,230.95,169.61,198.92]},{cmd:"C",args:[163.32,197.62,156.6,196.64,149.52,195.98]},{cmd:"L",args:[147.68,195.82]},{cmd:"C",args:[141.54,195.3,135.14,195.03,128.5,195]},{cmd:"Z"},{cmd:"M",args:[191.44,205.01]},{cmd:"C",args:[189.46,232.42,187.26,262.1,185.01,290.82]},{cmd:"C",args:[191.01,288.88,196.45,286.59,201.26,283.96]},{cmd:"C",args:[217.95,274.83,226.18,262.33,226.18,245.45]},{cmd:"S",args:[217.95,216.08,201.26,206.95]},{cmd:"C",args:[198.28,205.32,195.07,203.83,191.63,202.46]},{cmd:"Z"},{cmd:"M",args:[74.55,199.4]},{cmd:"C",args:[67.75,201.47,61.62,203.97,56.27,206.9]},{cmd:"C",args:[39.58,216.03,31.35,228.53,31.35,245.4]},{cmd:"S",args:[39.58,274.78,56.27,283.91]},{cmd:"C",args:[59.77,285.82,63.61,287.56,67.75,289.11]},{cmd:"C",args:[70.08,259.4,72.46,228.33,74.72,199.35]},{cmd:"Z"}]},"∰":{viewboxSize:{width:352,height:522},commands:[{cmd:"M",args:[327.51,1]},{cmd:"C",args:[339.99,1,347.82,4.47,351,11.42]},{cmd:"L",args:[346.08,26.18]},{cmd:"C",args:[338.98,21.89,333.95,19.97,330.98,20.43]},{cmd:"C",args:[304.95,24.51,295.56,77.6,293.56,94.46]},{cmd:"C",args:[292.81,100.8,289.87,143.65,286.01,197.19]},{cmd:"C",args:[315.64,208.43,334,225.76,334,250]},{cmd:"C",args:[334,276.39,312.24,294.59,277.86,305.65]},{cmd:"C",args:[273.24,363.72,268.5,415.81,265,434.26]},{cmd:"C",args:[255.91,482.18,233.58,521.5,211.28,521.5]},{cmd:"C",args:[200.78,521.5,194.35,518.45,192,512.35]},{cmd:"L",args:[197.74,495.28]},{cmd:"C",args:[200.32,499.93,204.83,501.87,211.28,501.09]},{cmd:"C",args:[219.63,500.08,238.12,473.62,245.11,426.84]},{cmd:"C",args:[247.84,408.51,251.72,363.39,255.85,311.42]},{cmd:"C",args:[234.01,316.03,208.79,318.47,181.79,318.92]},{cmd:"C",args:[177.52,371.53,173.23,417.23,170,434.26]},{cmd:"C",args:[160.91,482.18,138.58,521.5,116.28,521.5]},{cmd:"C",args:[105.78,521.5,99.35,518.45,97,512.35]},{cmd:"L",args:[102.74,495.28]},{cmd:"C",args:[105.32,499.93,109.83,501.87,116.28,501.09]},{cmd:"C",args:[124.63,500.08,143.12,473.62,150.11,426.84]},{cmd:"C",args:[152.71,409.39,156.35,367.67,160.26,318.87]},{cmd:"C",args:[133.26,318.27,108.11,315.65,86.44,310.83]},{cmd:"C",args:[81.96,366.8,77.39,416.37,74,434.26]},{cmd:"C",args:[64.91,482.18,42.58,521.5,20.28,521.5]},{cmd:"C",args:[9.78,521.5,3.35,518.45,1,512.35]},{cmd:"L",args:[6.74,495.28]},{cmd:"C",args:[9.32,499.93,13.83,501.87,20.28,501.09]},{cmd:"C",args:[28.63,500.08,47.12,473.62,54.11,426.84]},{cmd:"C",args:[56.95,407.77,61.04,359.69,65.36,305.07]},{cmd:"C",args:[32.01,293.96,11,275.93,11,250]},{cmd:"C",args:[11,221.86,35.74,203.03,74.13,192.25]},{cmd:"C",args:[77.38,150.91,80.36,114.79,82.61,94.46]},{cmd:"C",args:[89.69,30.27,112.89,1,136.51,1]},{cmd:"C",args:[148.99,1,156.82,4.47,160,11.42]},{cmd:"L",args:[155.08,26.18]},{cmd:"C",args:[147.98,21.89,142.95,19.97,139.98,20.43]},{cmd:"C",args:[113.95,24.51,104.56,77.6,102.56,94.46]},{cmd:"C",args:[101.86,100.4,99.23,138.43,95.72,187.27]},{cmd:"C",args:[118.15,183.1,143.78,181.07,171.02,181]},{cmd:"C",args:[173.92,144.41,176.57,112.93,178.61,94.46]},{cmd:"C",args:[185.69,30.27,208.89,1,232.51,1]},{cmd:"C",args:[244.99,1,252.82,4.47,256,11.42]},{cmd:"L",args:[251.08,26.18]},{cmd:"C",args:[243.98,21.89,238.95,19.97,235.98,20.43]},{cmd:"C",args:[209.95,24.51,200.56,77.6,198.56,94.46]},{cmd:"C",args:[197.89,100.16,195.44,135.38,192.15,181.35]},{cmd:"C",args:[219.13,182.34,244.06,185.41,265.25,190.75]},{cmd:"C",args:[268.45,150.04,271.39,114.55,273.61,94.46]},{cmd:"C",args:[280.69,30.27,303.89,1,327.51,1]},{cmd:"Z"},{cmd:"M",args:[191,197.32]},{cmd:"C",args:[188.64,230.06,185.94,266.68,183.19,301.33]},{cmd:"L",args:[181.83,301.35]},{cmd:"C",args:[183.14,301.33,184.43,301.3,185.72,301.27]},{cmd:"L",args:[188.3,301.2]},{cmd:"L",args:[190.85,301.12]},{cmd:"C",args:[192.13,301.07,193.39,301.03,194.65,300.97]},{cmd:"L",args:[197.16,300.86]},{cmd:"L",args:[199.66,300.73]},{cmd:"C",args:[202.14,300.6,204.6,300.45,207.03,300.28]},{cmd:"L",args:[209.45,300.1]},{cmd:"C",args:[209.85,300.07,210.25,300.04,210.65,300.01]},{cmd:"L",args:[213.04,299.82]},{cmd:"C",args:[215.02,299.65,216.99,299.47,218.93,299.28]},{cmd:"L",args:[221.25,299.04]},{cmd:"C",args:[221.64,299,222.02,298.96,222.4,298.92]},{cmd:"L",args:[224.69,298.66]},{cmd:"L",args:[226.96,298.39]},{cmd:"L",args:[229.21,298.11]},{cmd:"C",args:[229.96,298.02,230.7,297.92,231.44,297.82]},{cmd:"L",args:[233.65,297.51]},{cmd:"C",args:[242.02,296.33,249.92,294.88,257.28,293.17]},{cmd:"C",args:[259.56,264.24,261.87,233.91,264.1,205.38]},{cmd:"C",args:[254.86,202.92,244.67,200.91,233.65,199.35]},{cmd:"L",args:[231.44,199.04]},{cmd:"C",args:[230.7,198.94,229.96,198.84,229.21,198.75]},{cmd:"L",args:[226.96,198.47]},{cmd:"L",args:[224.69,198.2]},{cmd:"L",args:[222.4,197.94]},{cmd:"C",args:[222.02,197.9,221.64,197.86,221.25,197.82]},{cmd:"L",args:[218.93,197.58]},{cmd:"C",args:[216.99,197.39,215.02,197.21,213.04,197.04]},{cmd:"L",args:[210.65,196.85]},{cmd:"C",args:[210.25,196.82,209.85,196.79,209.45,196.76]},{cmd:"L",args:[207.03,196.58]},{cmd:"C",args:[204.6,196.41,202.14,196.26,199.66,196.13]},{cmd:"L",args:[197.16,196]},{cmd:"L",args:[194.65,195.89]},{cmd:"C",args:[193.48,195.84,192.3,195.79,191.11,195.75]},{cmd:"Z"},{cmd:"M",args:[169.87,195.44]},{cmd:"C",args:[169.14,195.44,168.41,195.45,167.68,195.46]},{cmd:"L",args:[165.07,195.5]},{cmd:"C",args:[163.77,195.52,162.47,195.55,161.18,195.58]},{cmd:"L",args:[158.61,195.65]},{cmd:"L",args:[156.05,195.73]},{cmd:"C",args:[154.78,195.77,153.51,195.82,152.25,195.88]},{cmd:"L",args:[149.74,195.99]},{cmd:"L",args:[147.24,196.12]},{cmd:"C",args:[144.76,196.25,142.3,196.4,139.87,196.57]},{cmd:"L",args:[137.45,196.74]},{cmd:"C",args:[137.05,196.78,136.65,196.81,136.25,196.84]},{cmd:"L",args:[133.86,197.03]},{cmd:"C",args:[131.88,197.2,129.91,197.38,127.97,197.57]},{cmd:"L",args:[125.65,197.81]},{cmd:"C",args:[125.26,197.85,124.88,197.89,124.5,197.93]},{cmd:"L",args:[122.21,198.19]},{cmd:"L",args:[119.94,198.46]},{cmd:"L",args:[117.69,198.74]},{cmd:"C",args:[116.94,198.83,116.2,198.93,115.46,199.03]},{cmd:"L",args:[113.26,199.33]},{cmd:"C",args:[107.37,200.17,101.72,201.13,96.32,202.22]},{cmd:"C",args:[94.23,231.09,91.9,262.69,89.51,293.14]},{cmd:"C",args:[96.9,294.85,104.84,296.31,113.26,297.5]},{cmd:"L",args:[115.46,297.81]},{cmd:"C",args:[116.2,297.91,116.94,298,117.69,298.1]},{cmd:"L",args:[119.94,298.38]},{cmd:"L",args:[122.21,298.65]},{cmd:"L",args:[124.5,298.9]},{cmd:"C",args:[124.88,298.94,125.26,298.99,125.65,299.03]},{cmd:"L",args:[127.97,299.26]},{cmd:"C",args:[129.91,299.46,131.88,299.64,133.86,299.8]},{cmd:"L",args:[136.25,300]},{cmd:"C",args:[136.65,300.03,137.05,300.06,137.45,300.09]},{cmd:"L",args:[139.87,300.27]},{cmd:"C",args:[142.3,300.44,144.76,300.59,147.24,300.72]},{cmd:"L",args:[149.74,300.85]},{cmd:"L",args:[152.25,300.96]},{cmd:"C",args:[153.51,301.01,154.78,301.06,156.05,301.11]},{cmd:"L",args:[158.61,301.19]},{cmd:"L",args:[161.18,301.26]},{cmd:"C",args:[161.89,301.28,162.6,301.29,163.32,301.31]},{cmd:"C",args:[166.06,266.62,168.88,229.42,171.55,195.42]},{cmd:"Z"},{cmd:"M",args:[74.58,207.76]},{cmd:"C",args:[71.73,208.67,69,209.63,66.37,210.64]},{cmd:"C",args:[41.19,220.32,29.33,232.98,29.33,248.25]},{cmd:"S",args:[41.19,276.17,66.37,285.85]},{cmd:"C",args:[67.23,286.18,68.1,286.51,68.98,286.83]},{cmd:"C",args:[71.04,260.59,73.12,233.39,75.13,207.59]},{cmd:"Z"},{cmd:"M",args:[287.13,212.18]},{cmd:"C",args:[285.43,235.43,283.61,260.02,281.74,284.07]},{cmd:"C",args:[282.32,283.85,282.89,283.64,283.46,283.42]},{cmd:"C",args:[308.65,273.74,320.51,261.08,320.51,245.81]},{cmd:"C",args:[320.51,231.35,309.86,219.22,287.31,209.75]},{cmd:"Z"}]},"⋀":{viewboxSize:{width:265,height:358},commands:[{cmd:"M",args:[118,8]},{cmd:"L",args:[8,350]},{cmd:"L",args:[38,350]},{cmd:"L",args:[132,42]},{cmd:"L",args:[227,350]},{cmd:"L",args:[257,350]},{cmd:"L",args:[146,8]},{cmd:"Z"}]},"⋁":{viewboxSize:{width:265,height:358},commands:[{cmd:"M",args:[116,350]},{cmd:"L",args:[8,8]},{cmd:"L",args:[38,8]},{cmd:"L",args:[132,314]},{cmd:"L",args:[227,8]},{cmd:"L",args:[257,8]},{cmd:"L",args:[147,350]},{cmd:"Z"}]},"⋂":{viewboxSize:{width:265,height:358},commands:[{cmd:"M",args:[8,350]},{cmd:"L",args:[8,124]},{cmd:"Q",args:[8,8,132.5,8]},{cmd:"Q",args:[257,8,257,124]},{cmd:"L",args:[257,350]},{cmd:"L",args:[227,350]},{cmd:"L",args:[227,124]},{cmd:"Q",args:[227,38,132.5,38]},{cmd:"Q",args:[38,38,38,124]},{cmd:"L",args:[38,350]},{cmd:"Z"}]},"⋃":{viewboxSize:{width:265,height:358},commands:[{cmd:"M",args:[8,8]},{cmd:"L",args:[8,233.5]},{cmd:"Q",args:[8,350,132.5,350]},{cmd:"Q",args:[257,350,257,233.5]},{cmd:"L",args:[257,8]},{cmd:"L",args:[227,8]},{cmd:"L",args:[227,233.5]},{cmd:"Q",args:[227,320,132.5,320]},{cmd:"Q",args:[38,320,38,233.5]},{cmd:"L",args:[38,8]},{cmd:"Z"}]},"⨆":{viewboxSize:{width:265,height:358},commands:[{cmd:"M",args:[8,8]},{cmd:"L",args:[8,350]},{cmd:"L",args:[257,350]},{cmd:"L",args:[257,8]},{cmd:"L",args:[227,8]},{cmd:"L",args:[227,320]},{cmd:"L",args:[38,320]},{cmd:"L",args:[38,8]},{cmd:"Z"}]}},i=function(e){return n[e]},r=function(e,t){var a=n[e];if(a){var i=a.viewboxSize;return t*i.width/i.height}return 0}},7376:function(e,t,a){"use strict";var n=a(1),i=a.n(n),r=a(2),o=a.n(r),s=a(772),c=a(400),l=a(1916),u=a(336),h=a(4579),d=a(411),p=function(){function e(t,a){i()(this,e),this.table_style={nest_level:t.nest_level,para_type:t.para_type,type:t.type},this.table_row_style=t.table_row,this.tableline=a;var n=a.parent&&a.parent.parent&&a.parent.parent.layoutType===d.DOCLayoutType.MobilePage&&a.parent.parent,r=a.position_in_table;this.isFirstLine=(r===h.b||h.a)&&(!n||!n._prevTable),this.isLastLine=(r===h.b||h.d)&&(!n||!n._nextTable&&a.isLastTable)}return o()(e,[{key:"getCellStyle",value:function(t,a){var n=this,i=this.table_row_style,r=i&&i.tableCells&&i.tableCells[t],o=i&&i.borders||null,l=c.a.copy(a.rect);a.merge_type===s.e.FIRST&&function(){for(var e=n.tableline.parent.lines,t=e.indexOf(n.tableline),i=a.rect,r=i.left,o=i.right,u=t+1;u<e.length&&e[u].tablecells;u++){var h=e[u].tablecells.find((function(e){return!(e.rect.right<=r||e.rect.left>=o)}));if(!h)break;var d=h.merge_type;if(d===s.e.NONE||d===s.e.FIRST)break;var p=c.a.copy(h.rect);if(p.top=a.rect.top,p.bottom=a.rect.bottom,!c.a.equal(a.rect,p))break;var g=h.rect.size;if(l.addSize({width:0,height:g.height}),d===s.e.LAST)break}}();var u=r&&r.border&&r.border.top||o&&(this.isFirstLine?o.top:o.insideH),h=r&&r.border&&r.border.bottom||o&&(this.isLastLine?o.bottom:o.insideH),d=u&&e.getBorderWidth(u)/2||0,p=h&&e.getBorderWidth(h)/2||0;0!==p&&l.addOffset({x:0,y:d}),d+p>0&&l.addSize({width:0,height:-(d+p)});var g={rowStyle:o,shd_rect:l};return r?Object.assign(r,g):g}}],[{key:"init",value:function(t,a){var n=t.cell_style_cp;return new e(a.doc.getDataLogic("final").getPap(n),t)}},{key:"getBorderWidth",value:function(e){if(!e||!e.type||e.type===l.l||e.type>l.k)return 0;var t=Object(u.Ti2Px)(e.lineWidth),a=Math.floor(t);return(t=t-a>.5?a+.5:a)||(t=.5),t}}]),e}();t.a=p},8841:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return r})),a.d(t,"b",(function(){return o})),a.d(t,"e",(function(){return s}));var n=0,i=1,r=2,o=3,s=4},8842:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(1),i=a.n(n),r=a(2),o=a.n(r),s=a(3078),c=a(336),l=a(309),u=function(){function e(){i()(this,e)}return o()(e,null,[{key:"adjust",value:function(e,t,a){var n={height:0,bNeedSetAlign:!0,bLocked:!1,blineSpacingIsMinZero:!1,align:null};return this.setChannelAlign(n,e),e.hasExclusiveEmbed?n.height=t:this.getChannelHeightAndAlign(n,t,a,e),n}},{key:"setChannelAlign",value:function(e,t){var a=t.vertAlignMode;e.align="middle"==a?s.b.Typo_caMiddle:"top"==a?s.b.Typo_caTop:s.b.Typo_caBottom}},{key:"getChannelHeightAndAlign",value:function(e,t,a,n){if(this.updateChannelByLineSpacing(e,t,a,n),e.bLocked&&e.bNeedSetAlign)this.getChannelAlignByVertAlign(n,e);else{var i=n.gridMode,r=n.snapToGrid,o=n.dataStatus.subdocType;if(!e.blineSpacingIsMinZero&&this.isUpdateChannelByAlignGrid({gridMode:i,snapToGrid:r,subDocType:o})){var c={height:this.updateChannelByAlignGrid(e,t,n),align:s.b.Typo_caMiddle};c.height>e.height&&(e.height=c.height,e.align=c.align)}e.bNeedSetAlign&&this.getChannelAlignByVertAlign(n,e)}}},{key:"getChannelAlignByVertAlign",value:function(e,t){var a=e.vertAlignMode;t.align="middle"==a?s.b.Typo_caFixedMiddle:"top"==a?s.b.Typo_caFixedTop:s.b.Typo_caFixedBottom}},{key:"updateChannelByLineSpacing",value:function(e,t,a,n){if(!e.bLocked){var i=n.lineSpacing,r=n.lineSpacingScale,o=i.val;if(i.isHeightOrMargin)if(i.bMetricOrPercent)i.bFixedOrMin?(e.bLocked=!0,e.height=Object(c.Ti2Px)(o)):(0==o&&(e.blineSpacingIsMinZero=!0),e.bNeedSetAlign=!1,e.align=s.b.Typo_caMinBottom,e.height=Math.max(t,Object(c.Ti2Px)(o)));else{var l=n.gridMode,u=n.snapToGrid,h=n.dataStatus.subdocType;this.isUpdateChannelByAlignGrid({gridMode:l,snapToGrid:u,subDocType:h})&&n.gridHeight>0?(e.height=240==o?Object(c.Ti2Px)(n.gridHeight):Object(c.Ti2Px)(n.gridHeight)*(o/240),0==o&&0==n.paraMarginBefore&&0==n.paraMarginAfter&&(e.blineSpacingIsMinZero=!0),e.bNeedSetAlign=!1,e.align=s.b.Typo_caMiddle):(e.height=240==o?t:t+a*(o/240-1),e.bNeedSetAlign=!1,e.align=o>=240?s.b.Typo_caTop:s.b.Typo_caBottom,window.APP.isWebMode()&&(e.align=s.b.Typo_caMiddle))}e.height*=r}}},{key:"isUpdateChannelByAlignGrid",value:function(e){var t=e.gridMode,a=e.snapToGrid,n=e.subDocType;return!(t==s.c.Typo_GridMode_None||!a||window.APP.isWebMode()||n==l.Comment)}},{key:"updateChannelByAlignGrid",value:function(e,t,a){var n=Object(c.Ti2Px)(a.gridHeight),i=Math.ceil(t/n);return t>i*n&&++i,n*i*a.lineSpacingScale}},{key:"adjPageBottomLine",value:function(e,t){var a=e.rect.height,n=t-e.rect.top,i=e.baseline+e.textHeight-e.ascent;return n>i&&(i=n),!(a-i<Math.abs(t-e.rect.bottom))}},{key:"getPageBottomAdjHeight",value:function(e,t){var a=t.lineSpacing;return a.bMetricOrPercent&&a.bFixedOrMin?e.rect.height:e.baseline+e.textHeight-e.ascent}}]),e}()}}]);