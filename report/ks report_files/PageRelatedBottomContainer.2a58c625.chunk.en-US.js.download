(window.webpackJsonp=window.webpackJsonp||[]).push([[861],{10921:function(e,t,n){"use strict";n.r(t);var i=n(13),r=n.n(i),o=n(8),a=n.n(o),s=n(1),u=n.n(s),c=n(2),d=n.n(c),f=n(22),l=n.n(f),h=n(23),w=n.n(h),p=n(238),v=n.n(p),m=n(260),b=n(336),P=n(258),_=n.n(P),O=function(e){function t(e){u()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={id:n.props.id,visible:!0,enable:!0},n}return w()(t,e),d()(t,[{key:"render",value:function(){var e=this.state,t=e.visible,n=e.enable;return t&&v.a.createElement("div",{className:_()("wps-page-related-bottom-container-custom-item",{disabled:!n})})}},{key:"id",get:function(){return this.state.id}},{key:"__visible",get:function(){return this.state.visible},set:function(e){this.setState({visible:e})}},{key:"__enable",set:function(e){this.setState({enable:e})},get:function(){return this.state.enable}}]),t}(p.PureComponent),y=n(167),g=n(81),A=(n(14154),window.CommandBarComponent),M=A.cmbIds.wps,E=function(e){function t(e){u()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,M.PageRelatedBottomContainer));return n.isUpdateAvailable=!1,n.events=["orientationchange",m.default.names.DOC_SECTION_CHANGE,m.default.zoom.ON_SCALING_CHANGE,m.default.view.AFTER_VIEW_MODE_CHANGED,m.default.names.DOC_WORKSPACE_AFTER_RESIZE],n.containerRef=v.a.createRef(),n.containerResizeObserver=null,n.containerUpdateRaf=null,n.state={style:{},items:[]},n.waitingItems=new Set,n.handleTypoDone=function(){n.markTypoFinish()},n.init=function(){n.setState({style:{height:0,position:"relative",transformOrigin:"top"}})},n.resize=function(){n.containerUpdateRaf&&cancelAnimationFrame(n.containerUpdateRaf),n.containerUpdateRaf=requestAnimationFrame((function(){y.isMobile?n.resizeForMobile():n.resizeForPc()}))},n.bindContainerUpdateEvents=function(){n.isUpdateAvailable||(n.init(),n.resize(),n.isUpdateAvailable=!0,n.events.forEach((function(e){window.addEventListener(e,n.resize)})))},n.unbindContainerUpdateEvents=function(){n.isUpdateAvailable&&(n.isUpdateAvailable=!1,n.events.forEach((function(e){window.removeEventListener(e,n.resize)})))},n.waitTypoFinish=new Promise((function(e){n.markTypoFinish=e;try{window.APP.data.typoinfo.isTypoEnd&&n.markTypoFinish()}catch(e){}})),n}return w()(t,e),d()(t,[{key:"componentDidMount",value:function(){if(window.addEventListener(m.default.names.DOC_TYPO_ALL_PAGE_DONE,this.handleTypoDone),y.isMobile&&(window.ResizeObserver||window.MutationObserver)){var e=Object(g.debounce)((function(e){window.APP.workspace.updateContainer()}),300);window.ResizeObserver?(this.containerResizeObserver=new window.ResizeObserver(e),this.containerResizeObserver.observe(this.containerRef.current)):MutationObserver&&(this.containerMutationObserver=new window.MutationObserver(e),this.containerMutationObserver.observe(this.containerRef.current,{childList:!0,subtree:!0}))}}},{key:"componentWillUnmount",value:function(){window.removeEventListener(m.default.names.DOC_TYPO_ALL_PAGE_DONE,this.handleTypoDone),this.containerResizeObserver&&this.containerResizeObserver.disconnect(),this.containerMutationObserver&&this.containerMutationObserver.disconnect()}},{key:"add",value:function(e){var t=this,n=e.id;e.icon,e.caption,e.tooltip,e.divider;if(this.bindContainerUpdateEvents(),this.state.items.find((function(e){return e.id===n}))||this.waitingItems.has(n))throw new Error("该控件ID已存在："+n);return this.waitingItems.add(n),this.waitTypoFinish.then((function(){return new Promise((function(e){t.waitingItems.delete(n);var i=[].concat(a()(t.state.items),[{id:n}]);t.setState({items:i},(function(){return e(t._refMap[n].el)}))}))}))}},{key:"remove",value:function(e){if(this.waitingItems.has(e))return this.waitingItems.delete(e),!0;var t=this.state.items.filter((function(t){return t.id!==e}));return t.length||this.unbindContainerUpdateEvents(),this.setState({items:t}),!0}},{key:"_ref",value:function(e){var t=this;return this._refMap=this._refMap||{},this._refMap[e]||(this._refMap[e]={cb:function(n){return t._refMap[e].el=n}}),this._refMap[e]}},{key:"resizeForPc",value:function(){this.containerUpdateRaf=null;var e=window.APP.data.doc.sections.rangeClass.tree.getMax(),t=Math.round(Object(b.Ti2Px)(e.getPageWidth())),n=window.APP.isWebMode(),i=window.APP.workspace.container.cacheDOMAttr.clientWidth,o=window.APP.data.typoinfo.padding;n&&o+t>i&&(i=o+t);var a=(i-t)/2+window.APP.workspace.horizontalCenterOffset,s=window.APP.workspace.config.zoom,u="scale("+s+")",c=window.APP.isWebMode()?18*s-45:0,d=this.state.style;d.width===t&&d.left===a&&d.transform===u&&d.top===c||this.setState({style:r()({},d,{transform:u,width:t,left:a,top:c})})}},{key:"resizeForMobile",value:function(){var e="0px";if(window.APP.isPaginationMode()){var t=window.APP.data.doc.sections.rangeClass.tree.getMax(),n=Math.round(Object(b.Ti2Px)(t.getPageWidth())),i=(window.APP.workspace.clientWidth-n*window.APP.workspace.config.zoom)/2;e=Math.max(6,Math.round(i))+"px"}this.setState({style:{padding:"0 "+e}})}},{key:"render",value:function(){var e=this,t=this.state,n=t.style,i=t.items;return v.a.createElement("div",{ref:this.containerRef,className:_()("wps-page-related-bottom-container",{empty:0===i.length}),style:n},i.map((function(t){return v.a.createElement(O,{key:t.id,id:t.id,ref:e._ref(t.id).cb})})))}}]),t}(A);t.default=E},14154:function(e,t,n){},336:function(e,t,n){"use strict";n.r(t),n.d(t,"Ti2Px",(function(){return i})),n.d(t,"Px2Ti",(function(){return r})),n.d(t,"Ti2Pt",(function(){return o})),n.d(t,"Pt2Ti",(function(){return a})),n.d(t,"Ti2Mm",(function(){return s})),n.d(t,"Mm2Ti",(function(){return u})),n.d(t,"Ti2Cm",(function(){return c})),n.d(t,"Cm2Ti",(function(){return d})),n.d(t,"Px2Pt",(function(){return f})),n.d(t,"Pt2Px",(function(){return l}));var i=function(e){return e/15},r=function(e){return 15*e},o=function(e){return e/20},a=function(e){return 20*e},s=function(e){return 127*e/7200},u=function(e){return 7200*e/127},c=function(e){return 127*e/72e3},d=function(e){return 72e3*e/127},f=function(e){return 15*e/20},l=function(e){return 20*e/15}}}]);