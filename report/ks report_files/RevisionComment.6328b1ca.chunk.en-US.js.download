(window.webpackJsonp=window.webpackJsonp||[]).push([[863],{10023:function(e,t,n){"use strict";var i,o=n(30),r=n.n(o),a=n(80),s=n.n(a),l=n(1),c=n.n(l),u=n(2),d=n.n(u),m=n(22),p=n.n(m),h=n(23),f=n.n(h),v=n(238),g=n.n(v),E=n(244),w=n.n(E),C=n(258),y=n.n(C),b=n(7530),T=n(7141),_=n(144),O=n.n(_),P=n(812),N=n(560),I=n.n(N),k=n(167),D=(n(9242),Object(v.forwardRef)((function(e,t){var n=e.rcId,i=e.commentId,o=e.cooperUserId,r=e.cooperEditTimestamp,a=e.isEditable,s=e.isActive,l=e.showBorder,c=e.invalidCacheHeight,u=e.onTextChanged,d=Object(v.useState)(!1),m=O()(d,2),p=m[0],h=m[1],f=Object(v.useState)(!1),E=O()(f,2),w=E[0],C=E[1],b=Object(v.useState)(!1),T=O()(b,2),_=T[0],D=T[1],S=Object(v.useState)(!1),A=O()(S,2),M=A[0],L=A[1],x=Object(v.useState)({}),R=O()(x,2),j=R[0],H=R[1],B=Object(v.useState)({}),F=O()(B,2),V=F[0],W=F[1],U=Object(v.useState)({}),Y=O()(U,2),K=Y[0],G=Y[1],z=Object(v.useState)({}),X=O()(z,2),J=X[0],q=X[1],Z=Object(v.useRef)(null),$=Object(v.useRef)(null),Q=Object(v.useRef)(null),ee=Object(v.useRef)(null),te=Object(v.useRef)(!1),ne=window.APP,ie=k.isPad&&(!s||window.APP.isReadOnly()&&!window.APP.isReadOnlyComment()),oe=Object(v.useCallback)((function(e){var t=e.detail;if(window.APP.data.selection.selContext.isInComment()&&a){var i=window.APP.data.typoinfo.getCommentPage(n),o=i&&i.end-i.begin||0;L(o<=1),u(o)}!a&&t&&t.commentRcIds&&t.commentRcIds.includes(n)&&re(!0)}),[a,n,s,K,u]);function re(){var e=window.APP.data.typoinfo.commentView,t=window.APP.data.typoinfo.getCommentPage(n);if(t){var i=t.page.lines||[],o=i.length>3,r=i.slice(0,3).reduce((function(e,t){return e+t.rect.height}),e.verticalPadding||0),l=void 0;if(!s&&o){var u=i[3].rect.height;l={width:"100%",height:u,backgroundColor:"#fff",top:r,left:0},r+=u}c&&c(),D(o),l&&q(l),!a&&K&&parseFloat(K.minHeight)!==r&&G({minHeight:r+"px"})}}function ae(){return{element:ee.current,get value(){return ee.current&&ee.current.value},set value(e){ee.current&&(ee.current.value=e)},get isMounted(){return te.current},focus:function(){te.current&&(k.isPad?Promise.resolve().then((function(){ee.current.focus()})):ee.current.focus())},update:function(){if(te.current){var e=window.APP.data.selection.end.pos;if(e&&e.isInComment){var t=e.posX,n=e.posY,i=e.line.baseline;W({left:t,top:n+i})}}}}}function se(){return{update:function(){if(te.current){var e=window.APP.data.selection,t=e.begin,n=e.end,i=n.pos;if(i&&t.position===n.position&&i.isInComment){var o=i.posX,r=i.charPosY,a=i.charHeight;C(!0),H({top:r,left:o,height:a}),window.APP.workspace.makesureCursorVisible()}else C(!1)}}}}function le(){return{element:$.current,get isMounted(){return te.current},get rect(){return te.current?$.current.getBoundingClientRect():null},get scrollTop(){return te.current?$.current.scrollTop:0}}}function ce(e){window.APP.view.uilManager.onEvent(e,{rcId:n,commentId:i,isCommentEditable:a,commentContainer:le(),commentInput:ae(),commentCursor:se()})}function ue(){if(window.APP.data.selection.selContext.isInComment()){var e=window.APP.data.selection,t=e.begin,n=e.end;k.isPad&&setTimeout((function(){Z.current&&Z.current.scrollIntoViewIfNeeded(!0)}),200),t.position===n.position&&C(!0)}}function de(){C(!1)}return Object(v.useImperativeHandle)(t,(function(){return{getCommentContainer:le,getCommentInput:ae,getCommentCursor:se}}),[]),Object(v.useEffect)((function(){return te.current=!0,function(){te.current=!1;var e=window.APP.data.selection.selContext;if(!a&&e.isInComment()&&e.commentId===i&&(window.APP.uilManager.resetCommentElements(),!window.APP.workspace.revisionComment.dataHandler.data.some((function(e){return"comments"===e.type&&e.data.some((function(e){return e.comment_id===i}))})))){var t=e.commentPos||0;window.APP.data.selection.setPosition(t,t,{isSend:!0})}}}),[]),Object(v.useEffect)((function(){!a&&n&&o&&re(!0)}),[a,n,o,r]),Object(v.useEffect)((function(){a?(ee.current&&ee.current.focus(),ue(),se().update()):(ee.current&&ee.current.blur(),de())}),[a]),Object(v.useEffect)((function(){re(!!o)}),[s]),Object(v.useEffect)((function(){var e=window.APP.workspace.commentRenderHandler;return e.createRenderUnit(n,Q.current),e.refresh(n),e.onSelectionChanged(),a||re(),function(){console.log("[auxops] unmount comment: ",n,":",i),e.removeRenderUnit(n,Q.current),e=null}}),[n]),Object(v.useEffect)((function(){if(s){var e=window.utils.Lodash.throttle(ce,16,{trailing:!1}),t=new P.d($.current,null,[P.c.MOUSE]);return t.on(P.a.START,ce).on(P.a.MOVE,e).on(P.a.END,ce).on(P.a.TAP,ce).on(P.a.PRE_DOUBLE_TAP,ce).on(P.a.PRE_TRIPLE_TAP,ce).on(P.a.LEAVE,ce),function(){e.cancel&&e.cancel(),t.destroy()}}}),[n,a,s]),Object(v.useLayoutEffect)((function(){if(s&&!ie)return ee.current.addEventListener("keydown",ce),a&&(ee.current.addEventListener("input",ce),ee.current.addEventListener("compositionstart",ce),ee.current.addEventListener("compositionend",ce),ee.current.addEventListener("compositionupdate",ce),ee.current.addEventListener("paste",ce),ee.current.addEventListener("focus",ue),ee.current.addEventListener("blur",de)),function(){ee.current.removeEventListener("keydown",ce),a&&(ee.current.removeEventListener("input",ce),ee.current.removeEventListener("compositionstart",ce),ee.current.removeEventListener("compositionend",ce),ee.current.removeEventListener("compositionupdate",ce),ee.current.removeEventListener("paste",ce),ee.current.removeEventListener("focus",ue),ee.current.removeEventListener("blur",de))}}),[a,s,ie]),I()(N.DOCCustomEvents.names.SELECTION_CHANGE_AND_CONTENT_UPDATED,oe),I()(N.DOCCustomEvents.comments.ON_ENTER_COMMENT_BODY,(function(e){a&&e.detail.id===n&&h(!0)})),I()(N.DOCCustomEvents.comments.ON_EXIT_COMMENT_BODY,(function(){a&&p&&h(!1)})),g.a.createElement("div",{className:y()("content","comment-text",{"content-show":s,canCopy:ne.canCopy(),"is-editing":p,"is-editable":a,"show-border":l,"is-exceed-preset-area":_,"not-Select":!p&&ne.copyControl()}),ref:Z,style:K},g.a.createElement("div",{className:y()("page-container comment",n),ref:$},g.a.createElement("div",{className:"canvas-unit",ref:Q}),g.a.createElement("div",{className:"components-container"},M&&g.a.createElement("span",{className:"tip"},"zh-CN"===window.langName?k.convertCtrl(_i18n("applications.writer.components.other.enterPlaceholder", "Press Enter to send and press Shift+Enter to wrap.")):k.convertCtrl(_i18n("applications.writer.components.other.otherLanguageEnterPlaceholder", "Shift+Enter line break"))),!s&&_&&g.a.createElement("span",{className:"text-ellipse",style:J},"..."),g.a.createElement("div",{className:y()("cursor",{"is-visible":w}),style:j}),g.a.createElement("input",{className:y()("virtual-input","alt-excluded",{"is-ie":k.isIE}),type:"text",style:V,ref:ee,readOnly:ie}))))}))),S=n(6635),A=n(248),M=A.default.types.voice,L="voicePlaying",x="voiceNormal",R=function(e){function t(e){c()(this,t);var n=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={currType:x},n.timer=null,n.animate=n.animate.bind(n),n}return f()(t,e),d()(t,[{key:"animate",value:function(){this.setState({currType:L})}},{key:"componentDidMount",value:function(){this.animate()}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.state.currType;return g.a.createElement("div",{className:"play "+e},g.a.createElement(A.default,{type:M.voiceNormal}))}}]),t}(v.PureComponent),j=A.default.types.voice,H=function(e){function t(){return c()(this,t),p()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),d()(t,[{key:"render",value:function(){return g.a.createElement("div",{className:"loading"},g.a.createElement(A.default,{type:j.loading}))}}]),t}(v.PureComponent),B=n(147),F=n(252),V=n.n(F),W=(n(9243),A.default.types.voice),U=function(e){function t(e){c()(this,t);var n=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.transformVoice=function(){var e=n.props;(0,e.handleVoiceTransform)(!e.transformVoice,e.id)},n}return f()(t,e),d()(t,[{key:"render",value:function(){var e=this.props,t=e.savedTextComment,n=e.transformVoice,i=n||t?g.a.createElement(A.default,{type:W.transform_hot}):g.a.createElement(A.default,{type:W.transform});return g.a.createElement(V.a,{title:""+(n||t?_i18n("applications.writer.components.other.cancel", "Cancel"):"")+_i18n("applications.writer.components.other.transformText", "Convert to Text")},g.a.createElement("div",{className:"voice-transform-btn",onClick:this.transformVoice},i))}}]),t}(v.PureComponent),Y=(n(9244),A.default.types.voice),K="loading",G="uploading",z="normal",X="playing",J="error",q=(i={},r()(i,K,"voiceLoading"),r()(i,G,"voiceUploading"),r()(i,z,"voiceNormal"),r()(i,X,"voicePlaying"),r()(i,J,"voiceError"),i),Z=function(e){function t(e){c()(this,t);var n=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={status:z},n.touchStartTime=null,n.tipTimer=null,n.holdTime=500,n.clickResponseTime=300,n.handleClick=n.handleClick.bind(n),n.audio=new S.a,n.audio.on(n.audio.events.ENDED,(function(e){e===n.props.url&&n.setState({status:z})})),n.audio.on(n.audio.events.LOADING,(function(e){e===n.props.url&&n.setState({status:K})})),n.audio.on(n.audio.events.START,(function(e){e===n.props.url&&n.setState({status:X})})),n.audio.on(n.audio.events.STOP,(function(e){e===n.props.url&&n.setState({status:z})})),n.audio.on(n.audio.events.ERROR,(function(e){e===n.props.url&&n.setState({status:J})})),window.__CONFIG__.product!==B.default.drive&&(n.showTxtComment=!0),n}return f()(t,e),d()(t,[{key:"componentDidUpdate",value:function(e){this.props.transformVoice!==e.transformVoice&&e.text.length>0&&this.setState({status:z})}},{key:"playVoice",value:function(){window.collection("revision","click","voice_play")}},{key:"handleClick",value:function(e){if(!this.props.isLoading&&this.state.status!==K&&this.state.status!=G){switch(this.state.status){case z:case J:this.playVoice(),this.audio.play(this.props.url);break;case X:this.audio.stop()}e.preventDefault()}}},{key:"resetStatus",value:function(){this.setState({status:z})}},{key:"renderText",value:function(e){var t=this.props,n=t.text,i=t.duration,o=t.transformVoice,r=t.showModal;return!r||this.state.status===z||i&&this.state.status!==J?r&&o||e?0===n.length?g.a.createElement("div",{className:"text"},g.a.createElement("div",{className:"error"},g.a.createElement(A.default,{type:Y.comment_alert}),g.a.createElement("i",null,_i18n("applications.writer.components.other.transformFailed", "Conversion failed")))):g.a.createElement("div",{className:"text"},g.a.createElement("div",{className:"transform "+(window.APP.canCopy()?"canCopy":"")},n)):void 0:g.a.createElement("div",{className:"text"},g.a.createElement("div",{className:"error"},g.a.createElement(A.default,{type:Y.comment_alert}),g.a.createElement("i",null,_i18n("applications.writer.components.other.broadcastFailed", "Play failed"))))}},{key:"render",value:function(){var e=this,t=null,n=this.state.status,i=this.props,o=i.text,r=i.duration,a=i.id,s=i.transformVoice,l=i.compareLocalStorage,c=i.showModal,u=i.handleVoiceTransform,d=l(a),m=this.renderText(d);if(n===K)t=g.a.createElement(H,null);else if(n!==X){var p=Y[q[n]];n===J&&(p=Y[q[z]]),t=g.a.createElement(A.default,{type:p})}else t=g.a.createElement(R,null);t&&(t=g.a.createElement("div",{className:"wrap"},g.a.createElement("div",{className:"vicon"},t)));var h=(s||d||n===J)&&c;return g.a.createElement("div",{ref:function(t){return e.voice=t},className:"comment-content "+(h?"large":"")},g.a.createElement("div",{className:"comment-voice"},this.showTxtComment?g.a.createElement("div",{className:"text"},g.a.createElement("div",{className:"transform"},o)):g.a.createElement(g.a.Fragment,null,g.a.createElement("div",{className:"bar",onClick:this.handleClick},g.a.createElement("div",{className:"top-elements"},t,g.a.createElement("div",{className:"duration"},r||0,"â€³")),m),window.__CONFIG__.product===B.default.drive&&g.a.createElement(U,{transformVoice:s,savedTextComment:d,handleVoiceTransform:u}))))}}]),t}(v.PureComponent),$=n(253),Q=n(260),ee=n(9245),te=n.n(ee),ne=n(1146),ie=(n(9247),window.__WPSPLUGIN__.helper),oe=ie.has(ie.types.FeedBackReport),re=ie.has(ie.types.ReportComment),ae=new Set,se=function(e){function t(e){var n=this;c()(this,t);var i=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.state={isDelete:!1,transformVoice:i.compareLocalStorage(i.props.info.uuId)||!1,cooperUserId:null,cooperEditTimestamp:Date.now(),commentStateChange:!1},i.handleEdit=function(){i.props.onEdit(i.props.info)},i.handleReply=function(){i.props.onReply({replyId:i.props.info.comment_id})},i.handleFeedback=function(e){var t=i.props.info;ie.exec(ie.types.FeedBackReport,{id:window.__WPSENV__.file_info.file.id,comment_id:t.comment_id,scene:"comment"})},i.handleCooperSelectionChanged=function(e){var t=Date.now(),o=i.state.cooperUserId,r=e.detail.changedCoopRange;if(!r){if(!o)return;var a=window.APP.data.selection.selCoop.onLineCooperators;if(!a.has(o))return void i.setState({cooperUserId:null,cooperEditTimestamp:t});r={userid:o,range:a.get(o)._range}}var l=r,c=l.userid,u=l.range,d=i.props.info.comment_id;if(c!==window.APP.info.userid&&u){var m=u.isEditing,p=u.commentId,h=u.isReplyComment,f=window.APP.commentsDataManager;switch(h&&p===d&&f&&f.addEditingCommentToGetOnlineData(p),!0){case m&&d===p:i.setState({cooperUserId:c,cooperEditTimestamp:t});break;case!m&&o===c:case m&&o===c&&d!==p:i.setState({cooperUserId:null,cooperEditTimestamp:t}),f&&f.commentIdsToWaitRequest.has(d)&&(f.removeEditingCommentToGetOnlineData(d),setTimeout(s()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.getCommentCache(d)){e.next=6;break}return f.commentsCache._del(d),e.next=5,window.APP.workspace.revisionComment.handleGetOnline({detail:{comment_id:d,modal_id:i.props.bubbleId,comment:i.props.info}});case 5:Q.default.dispatchEvent(Q.default.comments.NOTIFY_COMMENTS_PANEL_DATA_IS_CHANGED,{editingBubbleId:i.props.bubbleId,updatedBubbleIds:[i.props.bubbleId]});case 6:case"end":return e.stop()}}),e,n)}))),500))}}},i.handleCommentStatusChange=function(){var e=i.state.commentStateChange;i.setState({commentStateChange:!e})},i.handleDelete=i.handleDelete.bind(i),i.handleDeleteOk=i.handleDeleteOk.bind(i),i.handleDeleteCancel=i.handleDeleteCancel.bind(i),i.handleVoiceTransform=i.handleVoiceTransform.bind(i),i.handleEndEvent=i.handleEndEvent.bind(i),i.itemHeight=0,i}return f()(t,e),d()(t,[{key:"voiceTransform",value:function(e){window.collection("revision","click","voice_convert_"+(e?"on":"off"))}},{key:"getPosition",value:function(){return this.item.offsetTop-35}},{key:"handleDelete",value:function(){this.setState({isDelete:!0})}},{key:"handleDeleteCancel",value:function(){this.setState({isDelete:!1})}},{key:"handleDeleteOk",value:function(){this.setState({isDelete:!1});var e=this.props,t=e.info;(0,e.onDelete)(t)}},{key:"handleVoiceTransform",value:function(e,t){var n=t;n&&(n+="_save_transform",this.saveLocalStorage(e,n),this.voiceTransform(e)),this.setState({transformVoice:e}),ae.delete(this.props.info.rc_id),e&&(ae.add(this.props.info.rc_id),this.voice.resetStatus())}},{key:"compareLocalStorage",value:function(e){if(!e)return!1;var t=localStorage.getItem(e+"_save_transform");return!!t&&((new Date).getTime()-t<=6048e5||(localStorage.removeItem(e+"_save_transform"),!1))}},{key:"saveLocalStorage",value:function(e,t){t&&(e&&this.props.info.text?localStorage.setItem(t,(new Date).getTime()):localStorage.removeItem(t))}},{key:"renderContent",value:function(){var e=this,t=this.props.content,n=this.props,i=n.info,o=n.text,r=n.showModal,a=n.invalidCacheHeight,s=this.state,l=s.cooperUserId,c=s.cooperEditTimestamp;return"voice"===i.comment_type?(t=t||{duration:0,url:""},g.a.createElement(Z,{ref:function(t){return e.voice=t},id:i.rc_id,text:o,transformVoice:this.state.transformVoice,duration:t.duration,url:window.__CONFIG__.pathPrefix+t.url,compareLocalStorage:this.compareLocalStorage,handleVoiceTransform:this.handleVoiceTransform,closed:closed,showModal:r})):g.a.createElement(D,{ref:function(t){return e.refsCommentText=t},rcId:i.rc_id,commentId:i.comment_id,cooperEditTimestamp:c,cooperUserId:l,isEditable:!1,isActive:r,text:o,invalidCacheHeight:a})}},{key:"handleEndEvent",value:function(){window.APP.setBookmarkHandled(),this.item.removeEventListener(this.props.prefix,this.handleEndEvent)}},{key:"updateCooperUserId",value:function(){var e=this,t=window.APP.data.selection.selCoop.onLineCooperators,n=this.props.info.comment_id;t.forEach((function(t){var i=t.id,o=t._range;i!==window.APP.info.userid&&o&&o.isEditing&&o.commentId===n&&e.setState({cooperUserId:i})}))}},{key:"componentDidMount",value:function(){window.APP.isFirstTimeHandleBookmark&&this.props.isBookmark&&this.item.addEventListener(this.props.prefix,this.handleEndEvent),this.updateCooperUserId(),window.addEventListener(Q.default.cooperation.COOPERATOR_SELECTION_CHANGE,this.handleCooperSelectionChanged),window.addEventListener(Q.default.comments.GET_ONLINE_AUDIT_COMMENTS,this.handleCommentStatusChange),ae.has(this.props.info.rc_id)&&this.setState({transformVoice:!0}),this.handleCommentStatusChange(),this.itemHeight=this.item&&this.item.clientHeight||0;try{window.APP.workspace.revisionComment.commentComponentManager.onCommentComponentMounted({rcId:this.props.info.rc_id,commentId:this.props.info.comment_id,commentTextRef:this.refsCommentText,source:this.props.source})}catch(e){}}},{key:"componentDidUpdate",value:function(e){if(e.visible!==this.props.visible&&this.setState({isDelete:!1}),e.replyInfo.pCommentId!==this.props.replyInfo.pCommentId){var t=this.state.commentStateChange;this.setState({commentStateChange:!t})}var n=this.item&&this.item.clientHeight||0;n!==this.itemHeight&&(this.itemHeight=n,e.showModal==this.props.showModal&&Q.default.dispatchEvent(Q.default.comments.COMMENT_UPDATE_LAYOUT,{comment_id:this.props.info.comment_id})),this.deleteAnchor=w.a.findDOMNode(this.commentInfo),this.props.showModal||this.setState({isDelete:!1})}},{key:"componentWillUnmount",value:function(){window.removeEventListener(Q.default.cooperation.COOPERATOR_SELECTION_CHANGE,this.handleCooperSelectionChanged),window.removeEventListener(Q.default.comments.GET_ONLINE_AUDIT_COMMENTS,this.handleCommentStatusChange),window.APP.workspace.revisionComment.commentComponentManager.onCommentComponentUnMounted({rcId:this.props.info.rc_id,commentId:this.props.info.comment_id,source:this.props.source})}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,i=t.info,o=t.username,a=t.avatar,s=t.showDel,l=t.readOnly,c=t.showEdit,u=t.showReply,d=t.getContainer,m=t.isBookmark,p=t.connected,h=t.canEdit,f=t.replyInfo,v=t.isDone,E=t.authorUserId,w=t.emojis,C=t.isFirstComment,_=t.firstCommentUserId,O=this.state,P=O.isDelete,N=O.cooperUserId,I=this.renderContent(),k=i.date?Object($.formatDate)($.FormatType.Auto,i.date):null,D=window.APP.isFirstTimeHandleBookmark,S="voice"===i.comment_type,A=D&&m,M=!!i.comment_id,L=Object(ne.checkVisible)(i.comment_id),x=Object(ne.checkVisible)(f.pCommentId),R=f.isExist&&(L===ne.CommentShowType.visible||x===ne.CommentShowType.visible),j=R?f.isValid?_i18n("applications.writer.components.other.Comment.replyInfo", "Reply to @{0}: {1}").replace("{0}",f.username).replace("{1}",f.text):_i18n("applications.writer.components.other.Comment.replyCommentDeleted", "The referenced comment has been deleted."):"",H=!(u&&M&&!N&&h),B=!c||S||!h,F=!s||!!N||!h,W=window.fileInfo.creator.id,U=window.APP.info.userid,Y=E===U;return v?(H=!0,B=!0,F=!0):U==E||(U==W||U==_?B=!0:(B=!0,F=!0)),g.a.createElement("div",{ref:function(t){e.item=t},className:y()("comment-item",n?"comment-item-"+n:"",r()({"can-edit":h||re,"show-reply-info":R,bookmark:A},"rc-id-"+i.rc_id,!i.comment_id))},g.a.createElement(T.a,{ref:function(t){return e.commentInfo=t},id:i.rc_id,commentType:i.comment_type,username:o,avatar:a,time:k,connected:p,isNormal:i.isNormal,isVoice:S,isDone:v,isCooperating:!!N,isClientCmt:!M,canEdit:h,disableReply:H,disableEdit:B,disableDelete:F,handleReply:this.handleReply,handleEdit:this.handleEdit,handleDelete:this.handleDelete,authorUserId:E,commentId:i.comment_id}),x!==ne.CommentShowType.visible&&L===ne.CommentShowType.visible&&g.a.createElement("div",{className:"comment-unable-view"},g.a.createElement("div",{className:"comment-unable-text"},_i18n("applications.writer.components.other.Comment.unableView", "Comment content is not visible"))),L!==ne.CommentShowType.visible&&g.a.createElement("div",{className:"comment-unable-view"},g.a.createElement("div",{className:"comment-unable-text"},_i18n("applications.writer.components.other.Comment.unableView", "Comment content is not visible")),oe&&Y&&L===ne.CommentShowType.forbid&&g.a.createElement("div",{ref:this.feedbackRef,onMouseDown:this.handleFeedback,className:"feedback-btn"},_i18n("applications.writer.components.other.Comment.feedback", "the feedback"))),L===ne.CommentShowType.visible&&I,R&&x===ne.CommentShowType.visible&&g.a.createElement(V.a,{title:f.text},g.a.createElement("div",{className:"reply-info"},j)),L===ne.CommentShowType.visible&&g.a.createElement(te.a,{comment_id:i.comment_id,emojis:w,readOnly:l,connected:p}),P&&g.a.createElement(b.a,{anchor:this.deleteAnchor,getContainer:d,onOk:this.handleDeleteOk,onCancel:this.handleDeleteCancel,deleteTitle:C?_i18n("applications.writer.components.other.Comment.deleteBubbleCommentsTitle", "After deletion, all replies in this comment will also be deleted"):""}))}}]),t}(v.PureComponent);t.a=se},1003:function(e,t,n){},10084:function(e,t,n){"use strict";var i=n(144),o=n.n(i),r=n(238),a=n.n(r),s=n(258),l=n.n(s),c=n(7141),u=n(252),d=n.n(u),m=n(248),p=n(243),h=n.n(p),f=n(560),v=n.n(f),g=n(1170),E=n(1476),w=n(6640),C=n.n(w),y=(n(9248),Object(r.forwardRef)((function(e,t){var n=e.bubbleId,i=e.commentId,o=e.rcId,s=e.isReply,c=e.scrollToVisible,u=Object(r.useRef)(null),d=Object(r.useRef)(null),m=Object(r.useRef)(Object(g.getTempData)().trueCommentId),p=Object(r.useRef)(!1),h=Object(r.useCallback)((function(){var e=u.current.getCommentInput();return{element:d.current,get isMounted(){return e.isMounted},get rect(){return e.isMounted?d.current.getBoundingClientRect():null},get scrollTop(){return e.isMounted?d.current.scrollTop:0}}}),[]),w=Object(r.useCallback)((function(){return u.current.getCommentInput()}),[]);Object(r.useImperativeHandle)(t,(function(){return{getCommentContainer:h,getCommentInput:w}}),[]),v()(f.DOCCustomEvents.comments.ON_INSERT_TEMP_COMMENT,(function(e){p.current=!0})),Object(r.useEffect)((function(){window.APP.view.uilManager.enterCommentBody({context:{rcId:o,commentId:i,isReply:s,commentContainer:h(),commentInput:w(),isCommentEditable:!0}}),c(n)}),[]),Object(r.useEffect)((function(){if(window.APP&&window.APP.workspace&&!window.APP.workspace.commentInput&&Object(g.isInTempComment)()){var e=Object(g.getTempData)().trueCommentId;if(m.current&&m.current!=e||p.current){var t=u.current.richTextDom;t.innerHTML="<br/>",t.blur(),m.current=e,u.current.onTextchange(),u.current.updatePlugin(),p.current=!1}window.APP.view.uilManager.enterCommentBody({context:{rcId:o,commentId:e,isReply:s,commentContainer:h(),commentInput:w(),isCommentEditable:!0}})}}));var y=Object(r.useCallback)((function(){window.requestAnimationFrame((function(){return u.current&&Object(E.scrollToView)(u.current.richTextDom)})),window.APP.workspace.commentInput||window.APP.view.uilManager.setupCommentElements(h(),w())}),[]);return a.a.createElement("div",{className:l()("content")},a.a.createElement("div",{className:l()("page-container comment",e.rcId),ref:d},a.a.createElement(C.a,{ref:u,commentId:i,isEditable:e.isEditable,onTextChanged:e.onTextChanged,onFocus:y})))}))),b=n(167),T=n(805),_=n(342),O=n(1388),P=n(329),N=(n(9249),window.__WPSPLUGIN__.loader.search({pluginType:_.PLUGIN_TYPE.AT}));t.a=a.a.memo((function(e){var t=e.connected,n=e.showUser,i=e.user,s=e.bubbleId,u=e.rcId,p=e.onTextChanged,v=e.commentId,g=e.placeholder,E=void 0===g?"":g,w=e.replyInfo,C=e.onAddItem,_=e.onCancelReplyItem,I=e.scrollToVisible,k=Object(r.useState)(!!E),D=o()(k,2),S=D[0],A=D[1],M=Object(r.useState)(N),L=o()(M,2),x=L[0],R=L[1],j=Object(r.useRef)(null),H=Object(r.useRef)(!1).current,B=w.isExist,F=B?w.isValid?_i18n("applications.writer.components.other.Comment.replyInfo", "Reply to @{0}: {1}").replace("{0}",w.username).replace("{1}",w.text):_i18n("applications.writer.components.other.Comment.replyCommentDeleted", "The referenced comment has been deleted."):"",V=Object(r.useCallback)((function(e){N&&(e>1?x&&R(!1):x||R(!0),p&&p(e))}),[x]),W=window.utils.Lodash.debounce((function(){window.collection("commandbar","click","comment_@"),f.DOCCustomEvents.dispatchEvent(f.DOCCustomEvents.comments.MENTION_IN_COMMENT,{rcId:u,bubbleId:s})}),100);return Object(r.useEffect)((function(){u&&(H=!1,A(!1))}),[u]),a.a.createElement("div",{className:l()("comment-editor-wrap",{"show-user":n,"show-reply-info":B,disabled:!t}),onClick:function(e){e.stopPropagation()}},n&&!!i&&a.a.createElement(c.a,{username:i.username,avatar:i.avatar,commentId:v}),S&&a.a.createElement("div",{className:"comment-editor-placeholder",onClick:function(){t&&!H&&(H=!0,b.isIPad&&Object(T.focusOnOtherInput)(),C({bubbleId:s}))}},E),x&&a.a.createElement(h.a,{size:"medium",className:l()("comment-editor-mention-btn",{"is-ie":b.isIE},{"show-comment-info":n&&!!i},{"show-reply-info":B}),title:_i18n("applications.writer.components.other.Comment.mentionTip", "Click @ to remind others"),icon:a.a.createElement(O.default,{size:P.smallSize,fill:P.defaultFill}),onClick:W}),B&&a.a.createElement("div",{className:"comment-editor-reply-options"},a.a.createElement(d.a,{title:w.text},a.a.createElement("div",{className:"comment-editor-reply-info"},F)),a.a.createElement("div",{className:"comment-editor-reply-cancel-btn",onClick:_},a.a.createElement(m.default,{type:m.default.types.size16.close}))),u&&a.a.createElement(y,{ref:j,bubbleId:s,rcId:u,commentId:v,isReply:!!w.id,isEditable:t,scrollToVisible:I,onTextChanged:V}))}))},1131:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPraiseEmoji=t.getEmojiById=t.getEmojiListOrder=t.idToEmoji=t.emojiMap=void 0;var i=n(5);t.emojiMap=[{id:"001",name:_i18n("applications.writer.helpers.emojiController.emoji.praise", "Like"),value:"praise",unicode:"ðŸ‘"},{id:"002",name:_i18n("applications.writer.helpers.emojiController.emoji.ok", "OK"),value:"ok",unicode:"ðŸ‘Œ"},{id:"003",name:_i18n("applications.writer.helpers.emojiController.emoji.rose", "flowers"),value:"rose",unicode:"ðŸŒ¹"},{id:"004",name:_i18n("applications.writer.helpers.emojiController.emoji.hug_fist", "Fist"),value:"hug_fist",unicode:"ðŸ™"},{id:"005",name:_i18n("applications.writer.helpers.emojiController.emoji.congratulate", "celebrate"),value:"congratulate",unicode:"ðŸŽ‰"}];t.idToEmoji=function(){return t.emojiMap.reduce((function(e,t){var n=t.id,i=t.name,o=t.value;return e[n]={name:i,value:o},e}),{})};t.getEmojiListOrder=function(){return t.emojiMap.map((function(e){return e.id}))};t.getEmojiById=function(e){if(!e)return null;var n=t.emojiMap.find((function(t){return t.id===e}));return n?i.__assign({},n):null};t.getPraiseEmoji=function(){var e=t.emojiMap.find((function(e){return"praise"===e.value}));return e?i.__assign({},e):null}},1152:function(e,t,n){"use strict";n.r(t);var i=n(238),o=n.n(i),r=n(239);t.default=Object(r.a)("share_to",!1,(function(e){return o.a.createElement("svg",{width:e.size,height:e.size,viewBox:"0 0 16 16",fill:"none",strokeWidth:e.strokeWidth},o.a.createElement("g",{id:"group-0",stroke:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333",fill:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333"},o.a.createElement("path",{d:"M1.75 10.7497V12.7497C1.75 13.5782 2.42157 14.2497 3.25 14.2497H12.75C13.5784 14.2497 14.25 13.5782 14.25 12.7497V10.7497M3 8C6 4.5 8.24222 4.20044 14 4.46935M14 4.46935C13.9933 4.40299 13.9645 4.33844 13.9137 4.28759L11.25 1.5M14 4.46935C14.0088 4.5559 13.98 4.64554 13.9137 4.71186L11.25 7.5",strokeLinecap:e.strokeLinecap,fill:"none",vectorEffect:"non-scaling-stroke"})))}))},1170:function(e,t,n){"use strict";n.r(t),n.d(t,"getCommentMode",(function(){return d})),n.d(t,"getTempCommentData",(function(){return m})),n.d(t,"getTempBubbleData",(function(){return p})),n.d(t,"getCommentPluginState",(function(){return h})),n.d(t,"isInTempComment",(function(){return f})),n.d(t,"getTempData",(function(){return v})),n.d(t,"getTempComment",(function(){return g})),n.d(t,"isTempCommentId",(function(){return E})),n.d(t,"isTempBubbleId",(function(){return w})),n.d(t,"isTempCommentAt",(function(){return C})),n.d(t,"renderElements",(function(){return y}));var i=n(238),o=n.n(i),r=n(966),a=n(1808);n.d(t,"TEMP",(function(){return r.TEMP}));var s=n(677),l=n(1320),c={id:r.TEMP,type:r.CR_TYPE.comments,range:{pos:-1,len:-1}},u={comment_id:r.TEMP,rc_id:r.TEMP,comment_type:"text",body:{pos:-1,len:-1}};function d(){var e=window.APP&&window.APP.appApi&&window.APP.appApi.getCommentShowStatus?window.APP.appApi.getCommentShowStatus():{commentBubble:!1,commentPanel:!1},t=e.commentBubble,n=e.commentPanel;return t?0:n?1:void 0}function m(e){var t=JSON.parse(JSON.stringify(u));return e&&(t.date=e),t}function p(e,t,n){var i=JSON.parse(JSON.stringify(c));return e&&(i.range=e),t&&(i.data=[t]),n&&(i.id=n),i}function h(){var e={};if(window.APP.uilManager){var t=window.APP.uilManager.getModuleState(s.b.SELECTION,l.a.COMMENT);t&&(e=t)}return e}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(),t=!1;if(0===e){if(window.APP&&window.APP.workspace&&window.APP.workspace.revisionComment){var n=window.APP.workspace.revisionComment.dataHandler,i=n.tempCommentId,o=n.reEditCommentId;(E(i)||o)&&(t=!0)}}else if(1===e){var r=h();(r.currentCommentId&&E(r.currentCommentId)||r.currentReeditCommentId)&&(t=!0)}return t}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(),t={};if(0===e){var n=window.APP.workspace.revisionComment.dataHandler,i=n.tempBubbleId,o=n.tempCommentId,r=n.tempRcId,a=n.tempReplyId,s=n.tempReplyTo,l=n.tempRange,c=n.reEditCommentId,u=n.tempTrueCommentId;t={tempBubbleId:i,tempCommentId:o,tempRcId:r,tempReplyId:a,tempRange:l,tempReplyTo:s,reEditCommentId:c,trueCommentId:u}}else if(1===e){var m=h(),p=m.currentBubbleId,f=m.currentCommentId,v=m.currentRcId,g=m.currentReplyId,E=m.currentReplyTo,w=m.tempRange,C=m.currentReeditCommentId,y=m.tempTrueCommentId;t={tempBubbleId:p,tempCommentId:f,tempRcId:v,tempReplyId:g,tempRange:w,tempReplyTo:E,reEditCommentId:C,trueCommentId:y}}return t}function g(){var e={comment_type:"text",comment_id:r.TEMP,rc_id:r.TEMP,pos:-1};if(!f())return e;var t=v().tempRcId;if(t&&t!==r.TEMP){var n=window.APP.data.doc.comments.getCommentByRcId(t);n&&(e=n)}return e}function E(e){return e===r.TEMP}function w(e){return e===r.TEMP}function C(){return f()&&Object(a.hasTempAtDom)()}function y(e){var t=e.elements,n=e.isMore,i=e.showPlaceholder,r=e.text,a=e.className;if(n&&i){var s=t[0],l=t.slice(1,t.length-1),c=t[t.length-1],u=[s];return u.push(o.a.createElement("p",{key:2,className:a||null},o.a.createElement("svg",{width:"9",height:"6",viewBox:"0 0 9 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o.a.createElement("path",{d:"M0.75 1.5L4.50009 5L8.25 1.5",stroke:"#0063F4","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})),r.replace("{0}",l.length))),u.push(c),u}return t}},1290:function(e,t,n){"use strict";n.r(t),n.d(t,"shallowEqual",(function(){return h})),n.d(t,"getNextWord",(function(){return f})),n.d(t,"parseFieldCode",(function(){return v})),n.d(t,"isRangeIntersect",(function(){return g})),n.d(t,"toParams",(function(){return E})),n.d(t,"NODETYPE",(function(){return w})),n.d(t,"getLinks",(function(){return y})),n.d(t,"getMentions",(function(){return b})),n.d(t,"getHyperlinks",(function(){return T})),n.d(t,"getCatalogs",(function(){return _})),n.d(t,"getPictures",(function(){return O})),n.d(t,"handleTypes",(function(){return P})),n.d(t,"getRelatedUserIdsByContent",(function(){return N}));var i,o=n(13),r=n.n(o),a=n(8),s=n.n(a),l=n(144),c=n.n(l),u=n(30),d=n.n(u),m=n(1806),p=n(698),h=function(e,t){if(e!==t)if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1}else{var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(var a in e)if(!t.hasOwnProperty(a)||e[a]!==t[a])return!1}return!0};function f(e,t){for(var n="",i=t;" "===e[i];)++i;for(var o=!1;i<e.length;++i)if('"'===e[i]){if(o)break;o=!0}else n+=e[i];return++i,{string:n.trim(),idx:i}}function v(e){for(var t=[],n={},i=0;" "===e[i];)++i;for(;i<e.length;)if('"'===e[i]){var o=f(e,i);t.push(o.string),i=o.idx}else if("\\"===e[i]){var r=f(e,++i+1);n[e[i]]=r.string,i=r.idx}else++i;return{params:t,switchs:n}}function g(e,t){return!(e.pos+e.len<=t.pos||e.pos>=t.pos+t.len)}function E(e){return e.split("&").reduce((function(e,t){var n=t.indexOf("="),i=t.slice(0,n),o=t.slice(n+1);return void 0!==i&&void 0!==o&&("type"===i?e._type=o:e[i]=o),e}),{})}var w={TEXT:"text",MENTION:"mention",PICTURE:"picture",HYPERLINK:"hyperlink",CATALOG:"catalog"},C=(i={},d()(i,w.MENTION,"mentionNodes"),d()(i,w.HYPERLINK,"linkNodes"),d()(i,w.CATALOG,"catalogNodes"),i);function y(e){var t,n=window.APP.data.doc,i=e.pos,o=e.len,r=n.fields.getFields({begin:i,end:i+o}),a=[],s=[],l=[];return r.forEach((function(e){var t=e.pos,i=e.len,o=e._node;if("HYPERLINK"===o.type){var r=n.getText(t,i),u=r.match(/\x13 HYPERLINK "kw:mention\?(.+)" \x14@(.+)\x15/);if(u){var d=c()(u,3),h=d[1],f=d[2],v=E(h);v.userid&&(v.userid=parseInt(v.userid)),v.classes=m.classes.mention;var g={pos:t,len:i,text:"@"+f,attrs:v};return void s.push(g)}var w=r.match(/\x13 HYPERLINK "(.+)" \x14(.+)\x15/);if(w){var C=c()(w,3),y=C[1],b=C[2];a.push({pos:t,len:i,text:Object(p.filterSpecialPlaceholder)(b),link:y,classes:m.classes.link})}}else if("TOC"===o.type){var T={pos:t,len:i,text:Object(p.getText)({pos:t,len:i})};l.push(T)}})),t={},d()(t,C[w.MENTION],s),d()(t,C[w.HYPERLINK],a),d()(t,C[w.CATALOG],l),t}function b(e){return y(e)[C[w.MENTION]]}function T(e){return y(e)[C[w.HYPERLINK]]}function _(e){return y(e)[C[w.CATALOG]]}function O(e){var t=window.APP.data.doc,n=e.pos,i=e.len,o=t.inlineAnchors.getAnchors(n,i),r=t.anchors.getAnchors(n,i);return[].concat(s()(o),s()(r)).map((function(e){var t=(e.anchor||{len:0}).len;return e.len=t,e}))}function P(e,t,n){var i=t.pos,o=t.len,a=i+o-1,s=[];if(n){var l=n.hyperlinks,c=void 0===l?[]:l,u=n.range;s=c.map((function(e){var t=r()({},e.params);return r()({},u,{text:e.text.slice(1),attrs:t,_nType:w.MENTION})}))}var d=void 0,m=Object.keys(e).reduce((function(n,i){var o=void 0;(C[i]&&(d||(d=y(t)),o=d[C[i]]),o)||(o=(0,e[i])(t));return o.forEach((function(e){return e._nType=i})),n.concat(o)}),s).sort((function(e,t){return(e.pos||0)-(t.pos||0)}));return m.length?m.reduce((function(e,t,n){var o=t.pos,r=t.len;if(i<o){var s=i,l=o-i,c={pos:s,len:l,text:Object(p.getText)({pos:s,len:l}),_nType:w.TEXT};e.push(c)}if(e.push(t),i=o+r,n===m.length-1&&i<a){var u=i,d=a-i,h={pos:u,len:d,text:Object(p.getText)({pos:u,len:d}),_nType:w.TEXT};e.push(h)}return e}),[]):[{pos:i,len:o,text:Object(p.getText)({pos:i,len:o}),_nType:w.TEXT}]}var N=function(e,t){var n=new Set(t||[]);return e.replace(/\x13 HYPERLINK "kw:mention\?(.+?)" \x14@.+?\x15/g,(function(e,t){var i=E(t).userid;i&&n.add(i)})),Array.from(n)}},1320:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i={UI:"UI",UPDATE:"UPDATE",COOPERATION:"COOPERATION",CURSOR:"CURSOR",COOPER_SELECTION:"COOPER_SELECTION",TABLE:"TABLE",SHAPE:"SHAPE",SELECTION:"SELECTION",KEYBOARD:"KEYBOARD",HYPERLINK:"HYPERLINK",DATE:"DATE",CATALOG:"CATALOG",RICH_TEXT:"RICH_TEXT",SELECTIVE_PASTE:"SELECTIVE_PASTE",AT:"AT",TEXT:"TEXT",SHAPE_RESIZE:"SHAPE_RESIZE",CONTEXT_MENU:"CONTEXT_MENU",INK:"INK",PARAGRAPH_SETTING:"PARAGRAPH_SETTING",SPELL_CHECK:"SPELL_CHECK",SWIPE_MATH:"SWIPE_MATH",COMMENT:"COMMENT",TICKCHAR:"TICKCHAR",NOTES:"NOTES",SHAPE_PREVIEW:"SHAPE_PREVIEW",SHAPE_ADJUSTHANDLER:"SHAPE_ADJUSTHANDLER",CONTENT_CONTROL:"CONTENT_CONTROL"},o={INIT:"INIT",START:"START",MOVE:"MOVE"}},1388:function(e,t,n){"use strict";n.r(t);var i=n(238),o=n.n(i),r=n(239);t.default=Object(r.a)("symbol_mention",!1,(function(e){return o.a.createElement("svg",{width:e.size,height:e.size,viewBox:"0 0 16 16",fill:"none",strokeWidth:e.strokeWidth},o.a.createElement("g",{id:"group-0",stroke:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333",fill:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333"},o.a.createElement("path",{d:"M10.25 4.75V9.75C10.25 11.1307 11.3594 12.25 12.4922 12.25C12.8181 12.25 13.214 12.1623 13.5 11.914C14.0039 11.4766 14.75 9.4591 14.75 8C14.75 4.27208 11.7279 1.25 8 1.25C4.27208 1.25 1.25 4.27208 1.25 8C1.25 11.7279 4.27208 14.75 8 14.75C8.49386 14.75 8.97534 14.697 9.43904 14.5963C9.62914 14.555 9.81625 14.5057 10 14.4488",strokeLinecap:e.strokeLinecap,fill:"none",vectorEffect:"non-scaling-stroke"}),o.a.createElement("path",{d:"M10.1428 6.27622C9.63874 5.65041 8.86613 5.25 8 5.25C6.48122 5.25 5.25 6.48122 5.25 8C5.25 9.51878 6.48122 10.75 8 10.75C8.86613 10.75 9.63874 10.3496 10.1428 9.72378",strokeLinecap:e.strokeLinecap,fill:"none",vectorEffect:"non-scaling-stroke"})))}))},14078:function(e,t,n){},14079:function(e,t,n){},14080:function(e,t,n){},1449:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(957)),a=i.__importDefault(n(351)),s=i.__importDefault(n(393)),l=window.__WPSPLUGIN__,c=function(e){function t(t){var n=e.call(this,t)||this;return n.state={dropdownVisible:!1,isSupport:!1},n.isCompanyEqual=function(){var e=window.__WPSENV__.file_info.user.attrs,t=n.props.companyId;return"0"!==e.company_id&&t+""===e.company_id},n.checkSupport=function(){var e=window.__CONFIG__.isEnableShowIpAddress&&n.props.showPanel&&l.helper.has("MemberCard")&&!n.isCompanyEqual();n.setState({isSupport:e})},n.showPanel=function(){return i.__awaiter(n,void 0,void 0,(function(){var e,t,n,o,r,a,s,l,c;return i.__generator(this,(function(u){return e=this.props,t=e.avatar,n=e.userInfo,o=e.location,r=e.commentId,a=void 0===r?"":r,s=this.refMemberCardPluginRef,l=i.__assign(i.__assign({},n),{avatar:t,location:o}),c={getPluginContainer:function(){return s},commentId:a,member:l,onClose:this.handleClose},this.pluginInstance.destroy(),this.pluginInstance.exec(c),[2]}))}))},n.handleClose=function(){n.trigger(!1)},n.trigger=function(e){return i.__awaiter(n,void 0,void 0,(function(){var t,n=this;return i.__generator(this,(function(i){switch(i.label){case 0:if(!e||this.pluginInstance)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,l.loader.loadSingleInstance({pluginType:"MemberCard"})];case 2:return t.pluginInstance=i.sent(),[3,4];case 3:return i.sent(),[2];case 4:return this.setState({dropdownVisible:e},(function(){e&&n.showPanel()})),[2]}}))}))},n.handlePluginRef=function(e){n.refMemberCardPluginRef=e},n.renderPanelBox=function(){return o.default.createElement("div",{ref:n.handlePluginRef})},n.handleDropdownVisible=function(e){return i.__awaiter(n,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.trigger(e),[2]}))}))},n.renderBaseAvatar=function(){var e=n.props,t=e.avatar,a=i.__rest(e,["avatar"]);return delete a.commentId,delete a.showPanel,delete a.userInfo,o.default.createElement(r.default,i.__assign({avatar:t},a))},n.renderPanelAvatar=function(){var e=n.state.dropdownVisible,t=o.default.createElement(s.default,null,n.renderPanelBox());return o.default.createElement(a.default,{panel:t,trigger:"hover",distance:8,visible:e,placement:"bottomRight",onVisibleChange:n.handleDropdownVisible,panelClass:"avatar-dropdown-panel"},o.default.createElement("div",null,n.renderBaseAvatar()))},n}return i.__extends(t,e),t.prototype.componentDidMount=function(){this.checkSupport()},t.prototype.componentDidUpdate=function(){this.checkSupport()},t.prototype.render=function(){return this.state.isSupport?this.renderPanelAvatar():this.renderBaseAvatar()},t.defaultProps={showPanel:!0},t}(o.PureComponent);t.default=c},1476:function(e,t,n){"use strict";function i(e){return e&&3===e.nodeType}Object.defineProperty(t,"__esModule",{value:!0}),t.mockScroll=t.isChrome=t.insertDom=t.createTextSpace=t.isTextSpace=t.isBrNode=t.isEmptyTextNode=t.isContentTextNode=t.isTextNode=t.isNoEditableNode=t.scrollToView=t.textSpaceCode=void 0,t.textSpaceCode="â€‹",t.scrollToView=function(e){if(e&&!function(e){var t=!1,n=e.getBoundingClientRect(),i=n.top,o=n.bottom,r=window.APP.workspace.element.cacheDOMAttr.rect,a=r.top,s=r.height;return i>a&&o<a+s&&(t=!0),t}(e)){for(var t=window.APP.workspace,n=t.element.cacheDOMAttr.offsetHeight,i=0,o=e;o&&o!==t.element;)i+=o.offsetTop,o=o.parentNode;var r=i-n/2;r&&r>0&&(t.scrollTo({scrollTop:r}),setTimeout((function(){return t.onScroll()}),50))}},t.isNoEditableNode=function(e){return e&&"false"===e.contentEditable},t.isTextNode=i,t.isContentTextNode=function(e){return i(e)&&e.textContent.length},t.isEmptyTextNode=function(e){return i(e)&&!e.textContent.length},t.isBrNode=function(e){return e&&"BR"===e.tagName},t.isTextSpace=function(e){return i(e)&&e.textContent===t.textSpaceCode},t.createTextSpace=function(){return document.createTextNode(t.textSpaceCode)},t.insertDom=function(e,t,n){void 0===n&&(n="before");var i=t.parentNode;i&&("before"===n?i.insertBefore(e,t):"after"===n&&(i.lastChild==t?i.appendChild(e):i.insertBefore(e,t.nextSibling)))};var o=window.navigator.userAgent.toLowerCase();t.isChrome=-1!==o.indexOf("chrome");var r=function(){function e(t){var n=this;if(this.touchStart=function(e){var t=e.touches[0],i=t.pageX,o=t.pageY;n.touchStartX=i,n.touchStartY=o},this.touchMove=function(e){var t=e.touches[0],i=t.pageX,o=t.pageY;0==n.touchStartY&&(n.touchStartY=o),0==n.touchStartX&&(n.touchStartX=i);var r=o-n.touchStartY,a=i-n.touchStartX,s=Math.abs(r)/Math.abs(a)||0,l=Math.atan(s)/Math.PI*180;r=.3*Math.max(Math.min(r,60),-60);var c=e.target,u=c.scrollTop,d=c.clientHeight,m=c.scrollHeight;if(m>d&&l>45){var p=m-d;if(r>0){var h=Math.max(u-r,0);n.AnimationFrame&&cancelAnimationFrame(n.AnimationFrame),n.AnimationFrame=requestAnimationFrame((function(){c.scrollTop=h,n.AnimationFrame=null}))}else if(r<0){var f=Math.min(u-r,p);n.AnimationFrame&&cancelAnimationFrame(n.AnimationFrame),n.AnimationFrame=requestAnimationFrame((function(){c.scrollTop=f,n.AnimationFrame=null}))}}e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault()},e.instance)return e.instance;e.instance=this,this.dom=t,this.touchStartX=0,this.touchStartY=0}return e.destroy=function(){e.instance&&e.instance.unbindEvent()},e.prototype.bindEvent=function(){this.dom?(this.dom.addEventListener("touchstart",this.touchStart),this.dom.addEventListener("touchmove",this.touchMove)):delete e.instance},e.prototype.unbindEvent=function(){delete e.instance,this.AnimationFrame&&cancelAnimationFrame(this.AnimationFrame),this.dom&&(this.dom.removeEventListener("touchstart",this.touchStart),this.dom.removeEventListener("touchmove",this.touchMove))},e}();t.mockScroll=r},1567:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5).__importStar(n(238)),o=n(1131);n(2137);var r=(0,o.idToEmoji)();t.default=(0,i.forwardRef)((function(e,t){var n=e.id,o=e.value,a=e.className,s=void 0===a?"":a,l=r[n]&&r[n].value||o;return i.default.createElement("i",{ref:t,className:"bg-cover ".concat(l?"emoji-".concat(l):""," ").concat(s)})}))},1568:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enableEmojiComment=t.enableCommentEmojiReply=void 0;var i=!!window.__CONFIG__.wps.enableCommentEmojiReply;t.enableCommentEmojiReply=i;var o=!!window.__CONFIG__.wps.enableEmojiComment;t.enableEmojiComment=o},1578:function(e,t,n){"use strict";var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=(n(1579),n(238)),m=n.n(d),p=n(240),h=n(246),f=n(227),v=n(319),g=n(571),E=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.refWrap=m.a.createRef(),n.refModalBody=m.a.createRef(),n.handleWindowKeyDown=n.handleWindowKeyDown.bind(n),n.handleCloseModalDialog=n.handleCloseModalDialog.bind(n),n}return u()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.visible&&this.bindEvents(),this.refWrap.current.contains(window.document.activeElement)||this.refWrap.current.focus()}},{key:"componentDidUpdate",value:function(e,t){this.props.visible!==e.visible&&(this.props.visible?this.bindEvents():this.unbindEvents())}},{key:"componentWillUnmount",value:function(){this.unbindEvents()}},{key:"bindEvents",value:function(){Object(p.stopBubble)(window.event),f.default.dispatchEvent(f.default.names.ON_MODAL_VISIBLE_CHANGE,{visible:!0}),window.addEventListener("keydown",this.handleWindowKeyDown,!0),window.addEventListener(f.default.names.CLOSE_MODAL_DIALOG,this.handleCloseModalDialog)}},{key:"unbindEvents",value:function(){f.default.dispatchEvent(f.default.names.ON_MODAL_VISIBLE_CHANGE,{visible:!1}),window.removeEventListener("keydown",this.handleWindowKeyDown,!0),window.removeEventListener(f.default.names.CLOSE_MODAL_DIALOG,this.handleCloseModalDialog)}},{key:"handleCloseModalDialog",value:function(){var e=this.props,t=e.visible,n=e.onCancel;t&&n&&n()}},{key:"handleWindowKeyDown",value:function(e){var t=this.props,n=t.onCancel,i=t.onOk,o=h.getKey(e);if(n&&o===h.Keys.Esc)Object(g.b)(1)||(Object(p.stopBubble)(e),n());else if(i&&o===h.Keys.Enter){if(Object(g.b)(1))return;if(window.__WPSENV__.altStatus)return;var r=e.target,a=r.tagName;"TEXTAREA"!==a&&"INPUT"!==a&&"true"!==r.contentEditable&&(Object(p.stopBubble)(e),i())}}},{key:"getBodyElement",value:function(){return this.refModalBody.current}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.bodyStyle,i=e.className,o=e.toBody,r=e.keepEdit,a=e.maskTransparency,s=e.isNonModal,l=e.zIndex,c="wps-modal-wrap";o||(c+=" in-container"),a&&(c+=" mask-transparency"),s&&(c+=" is-non-modal");var u="wps-modal";i&&(u+=" "+i);var d="modal-body";e.isShowModelAnimation&&(d+=" animation-bounce-in");var p=void 0!==l?{zIndex:l}:null;return m.a.createElement("div",{className:c,style:p,"data-keep-edit":r||void 0},m.a.createElement("div",{ref:this.refWrap,className:u,tabIndex:1},m.a.createElement("div",{ref:this.refModalBody,className:d,style:n},t)))}}]),t}(d.PureComponent);E.defaultProps={isShowModelAnimation:!0};var w=function(e){function t(){var e,n,i,r;o()(this,t);for(var a=arguments.length,s=Array(a),c=0;c<a;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.refBody=m.a.createRef(),r=n,l()(i,r)}return u()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.visible&&f.default.dispatchEvent(f.default.names.CLOSE_DROPDOWN_PANEL)}},{key:"componentDidUpdate",value:function(e,t){this.props.visible&&!e.visible&&f.default.dispatchEvent(f.default.names.CLOSE_DROPDOWN_PANEL)}},{key:"getBodyElement",value:function(){return this.refBody.current.getBodyElement()}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,i=e.visible,o=e.onCancel,r=e.onOk,a=e.bodyStyle,s=e.getContainer,l=e.maskTransparency,c=e.keepEdit,u=e.isNonModal,d=e.zIndex,p=e.isShowModelAnimation;return m.a.createElement(v.default,{destroyOnHide:!1,visible:i,getContainer:s},m.a.createElement(E,{ref:this.refBody,className:n,zIndex:d,visible:i,maskTransparency:l,keepEdit:c,bodyStyle:a,isNonModal:u,toBody:!s,onCancel:o,onOk:r,isShowModelAnimation:p},t))}}]),t}(d.PureComponent);w.defaultProps={visible:!0,maskTransparency:!1},t.a=w},1579:function(e,t,n){},16794:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=n(238),m=n.n(d),p=n(258),h=n.n(p),f=n(260),v=n(966),g=n(5268),E=n(7437),w=n(10084),C=n(10023),y=n(248),b=n(252),T=n.n(b),_=n(3483),O=n(1170),P=n(3952),N=n(1146),I=(n(14078),function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isNew:!!n.props.data.isNew,isCooperating:!1,onlineData:{}},n.shouldScrollEnd=function(){var e=n.props,t=e.items,i=e.showModal;return i&&t.length>3||!i&&t.length<5},n.handleOnlineDataResolved=function(){n.setCommentOnlineData()},n.scrollIntoView=function(){var e=n.props,t=e.scrollIntoView,i=e.id;e.showModal&&t&&requestAnimationFrame((function(){return t(i)}))},n.onAddItem=function(e){n.disabledScrollToEnd=!1,f.default.dispatchEvent(f.default.comments.ON_ADD_ITEM_BY_MODAL,{params:e})},n.onEditItem=function(e){n.disabledScrollToEnd=!0,window.collection("commandbar","click","comment_modify"),f.default.dispatchEvent(f.default.comments.ON_EDIT_ITEM,{params:e})},n.onDeleteItem=function(e){n.disabledScrollToEnd=!0,window.collection("revision","click","delete");var t=n.props.items;if(e&&e.rc_id&&0===t.findIndex((function(t){return t.rc_id==e.rc_id}))){var i=t.map((function(e){return{rc_id:e.rc_id,comment_id:e.comment_id,pos:e.pos,len:e.len}}));return void f.default.dispatchEvent(f.default.comments.ON_DELETE_ITEMS,{comments:i})}f.default.dispatchEvent(f.default.comments.ON_DELETE_ITEM,{params:e})},n.onReplyItem=function(e){n.disabledScrollToEnd=!1,window.collection("revision","click","reply"),f.default.dispatchEvent(f.default.comments.ON_REPLY_ITEM,{params:e})},n.onCancelReplyItem=function(){f.default.dispatchEvent(f.default.comments.ON_CANCEL_REPLY_ITEM)},n.handleOnShow=function(){},n.handleOnActive=function(e){var t=n.props,i=t.range,o=t.id,r=t.data;n.props.onActive(i,o,r),e||n.setModalFocus()},n.handleOnClose=function(){window.collection("comment_popup_close",2),n.props.onClose(!0)},n.handleCommentEditSuccess=function(e){var t=e&&e.detail;if(t&&"edit"===t.type){var i=t.commentId;n.props.items.some((function(e){return e.comment_id===i}))&&n.setCommentOnlineData()}},n.invalidCacheHeight=function(){var e=n.props.data,t=window.APP.workspace.revisionComment.dataHandler.dataIdObj[e.id];t&&(t.isHeightValid=!1)},n.deBounceChangeCmtResolveStatus=window.utils.Lodash.debounce((function(){var e=n.props,t=e.id,i=e.isDone;if(e.readOnly)i||window.Toast.info(_i18n("applications.writer.components.other.documentIsReadonly", "The document is read-only"));else{var o=window.APP.data.selection.selCoop.onLineCooperators,r=window.APP.data.doc.commentBubbles.getBubbleById(t).getComments(),a=!1;o.forEach((function(e){var t=e.id,n=e._range;!a&&t!==window.APP.info.userid&&n&&n.isEditing&&r.find((function(e){return n.commentId===e.comment_id}))&&(a=!0)})),a?(n.setState({isCooperating:!0}),clearTimeout(n.coopTips),n.coopTips=setTimeout((function(){n.setState({isCooperating:!1})}),2500)):(f.default.dispatchEvent(f.default.comments.BEFORE_MODIFY_COMMENT,{bubbleId:t}),window.APP.editor.modifyComments({bubbleId:t,done:!i})),window.collection("commandbar","click",i?"comment_solved":"comment_to be solved")}}),200).bind(n),n.getModal=n.getModal.bind(n),n.getContainer=n.getContainer.bind(n),n.handleModalClicked=n.handleModalClicked.bind(n),n.InputEnterKeyDown=n.InputEnterKeyDown.bind(n),n.handleModalFocus=n.setModalFocus.bind(n),n.scrollToComment=n.scrollToComment.bind(n),n.showCommentHighLight=n.showCommentHighLight.bind(n),n.resetCommentHighLight=n.resetCommentHighLight.bind(n),n.locateCommentContent=n.locateCommentContent.bind(n),n.updateHeightFlag=!1,n.updatePosFlag=!1,n.firstCommentUserId=void 0,n}return u()(t,e),a()(t,[{key:"shouldComponentUpdate",value:function(e,t){if(t.isNew!==this.state.isNew||e.isDone!==this.props.isDone||this.state.isCooperating!==t.isCooperating)return!0;if(this.props.top!==e.top&&(this.updatePosFlag=!0,this.getPos()),this.props.showModal!==e.showModal)return this.updateHeightFlag=!0,this.updatePosFlag=!0,!0;if(!1===e.isVisible&&!1===e.preVisible)return!1;if(this.state.onlineData!==t.onlineData)return!0;if(this.props.isVisible!==e.isVisible||this.props.top!==e.top&&e.isVisible)return!0;var n=this.props.data,i=e.data;if(this.props.showModal!==e.showModal||n.data.length!==i.data.length)return this.updateHeightFlag=!0,!0;if(this.props.replyId!==e.replyId)return!0;if(this.props.isEditing&&e.isEditing){var o=n.data.find((function(e){return e.isTemp})),r=i.data.find((function(e){return e.isTemp}));if(o.rc_id!==r.rc_id)return!0}return!!n.data.some((function(e){return-1===i.data.findIndex((function(t){return t.rc_id===e.rc_id}))}))||(this.props.isVisible!==e.isVisible||JSON.stringify(this.getBaseData(this.props))!==JSON.stringify(this.getBaseData(e))||JSON.stringify(this.getCommentData(n))!==JSON.stringify(this.getCommentData(i)))}},{key:"getBaseData",value:function(e){return{className:e.className,id:e.id,color:e.color,connected:e.connected,isProtect:e.isProtect,range:e.range,readOnly:e.readOnly,showModal:e.showModal,top:e.top,visible:e.visible,isJump:e.isJump}}},{key:"getCommentData",value:function(e){return{height:e.height,id:e.id,isNew:e.isNew,pageIndex:e.pageIndex,position:e.position,range:e.range,type:e.type}}},{key:"setCommentOnlineData",value:function(){var e=this,t=!1,n=window.APP.servicesLoader&&window.APP.servicesLoader.commentsDataManager;if(n){var i=this.state.onlineData,o={};this.props.items.forEach((function(r){var a=e.props.id,s=r.comment_id,l=i[s],c=n.getCommentCache(s);void 0===c?e.props.handleGetOnline(s,a,r):(!c||l&&l.p_comment_id===c.p_comment_id||(t=!0),o[s]=c)})),this.setState({onlineData:o})}return t}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.visible,i=t.showModal;if(n){var o=!1;if(e.items.length!==this.props.items.length)this.setCommentOnlineData(),o=!0;else{var r=this.props.items.map((function(e){return e.comment_id})),a=e.items.map((function(e){return e.comment_id}));r.length&&r.some((function(e){return!a.includes(e)}))&&(this.setCommentOnlineData(),o=!0)}i&&(e.showModal&&!o||this.disabledScrollToEnd||this.checkTodo()?this.props.isEditing&&this.scrollToEditItem():this.scrollEnd(),this.observeDom||e.showModal&&this.props.top===e.top||this.scrollIntoView()),this.updateHeightFlag&&(this.getHeight(),this.updateHeightFlag=!1),this.getPos()}}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener(f.default.comments.SCROLL_TO_COMMENT,this.scrollToComment),window.addEventListener(f.default.comments.GET_ONLINE_COMMENTS_END,this.handleOnlineDataResolved),window.addEventListener(f.default.comments.COMMENT_INSERTOREDIT_SUCCESS,this.handleCommentEditSuccess),window.addEventListener(f.default.comments.SCROLL_FIND_COMMENT,this.locateCommentContent),this.observeDom=Object(P.observeDom)(this.modal.element,this.scrollIntoView);var t=this.props.data;if(window.APP.workspace.revisionComment){this.getHeight(),this.getPos(),this.setCommentOnlineData(),t.isNew&&(this.time=setTimeout((function(){e.setState({isNew:!1})}),400));var n=this.checkTodo();this.props.showModal&&!n&&this.scrollEnd()}}},{key:"componentWillUnmount",value:function(){clearTimeout(this.time),window.removeEventListener(f.default.comments.GET_ONLINE_COMMENTS_END,this.handleOnlineDataResolved),window.removeEventListener(f.default.comments.SCROLL_TO_COMMENT,this.scrollToComment),window.removeEventListener(f.default.comments.COMMENT_INSERTOREDIT_SUCCESS,this.handleCommentEditSuccess),N.CommentAudit.unsubscribes(),window.removeEventListener(f.default.comments.SCROLL_FIND_COMMENT,this.locateCommentContent),this.observeDom&&this.observeDom.disconnect()}},{key:"getHeight",value:function(){var e=this.props.data,t=this.modal.refs.container.offsetHeight,n=window.APP.workspace.revisionComment.dataHandler.dataIdObj[e.id];n&&(n.isHeightValid=!0,n.height=0===t?n.height||0:t)}},{key:"getPos",value:function(){var e=this.props.data,t=this.modal.refs.container.style,n=parseInt(t.top),i=window.APP.workspace.revisionComment.dataHandler.dataIdObj[e.id];i&&(i.truePos=n)}},{key:"checkTodo",value:function(){var e=this,t=[_.EventType.ShowCommentItemAfterFindLocate,_.EventType.ShowCommentItemAfterJump],n=!1;return t.forEach((function(t){var i=window.APP.todoList.get(t);i&&(e.locateCommentContent({detail:i})&&(n=!0))})),n}},{key:"locateCommentContent",value:function(e){var t=this,n=e.detail,i=n.bubbleId,o=n.commentId,r=n.rcId,a=n.range,s=i&&i!==this.props.id,l=this["item_"+r];if(s||!l)return!1;var c=document.activeElement;return this.props.showModal||this.handleOnActive(!0),setTimeout((function(){window.APP.todoList.delete(_.EventType.ShowCommentItemAfterFindLocate),t.scrollToItem(o,r),a&&(window.APP.uilManager.enterComment({commentId:o,rcId:r},a,!1),c&&"function"==typeof c.focus&&setTimeout((function(){c.focus()}),16))}),16),!0}},{key:"scrollEnd",value:function(){var e=this.itemsWrap;e&&requestAnimationFrame((function(){e.scrollTop=e.scrollHeight}))}},{key:"scrollToItem",value:function(e,t,n){var i=this,o=null;e&&(o=this.comment.querySelector(".comment-item-"+e)),!o&&t&&(o=this.comment.querySelector(".rc-id-"+t)),o&&this.itemsWrap&&requestAnimationFrame((function(){var e=Math.min(o.offsetTop-i.itemsWrap.offsetTop,i.itemsWrap.scrollHeight);i.itemsWrap.scrollTop=e}))}},{key:"scrollToEditItem",value:function(){var e=this,t=this.comment.querySelector(".comment-editor-wrap");t&&this.itemsWrap&&requestAnimationFrame((function(){var n=e.itemsWrap,i=n.scrollTop,o=n.scrollHeight,r=n.offsetHeight,a=n.offsetTop,s=t.offsetTop,l=t.offsetHeight;if(s+l>i+r){var c=s-l/2-a,u=Math.min(c,o);e.itemsWrap.scrollTop=u}}))}},{key:"setModalFocus",value:function(){var e=this.getContainer(),t=this.modal.element;e.contains(document.activeElement)||t.focus()}},{key:"InputEnterKeyDown",value:function(){window.collection("revision","click","enter")}},{key:"InputAltEnterKeyDown",value:function(){window.collection("revision","click","comment_break")}},{key:"getContainer",value:function(){return this.props.getContainer()}},{key:"getModal",value:function(){return this.modal.getModal()}},{key:"onUpdateItem",value:function(){}},{key:"handleModalClicked",value:function(){this.props.removeMainFocus()}},{key:"scrollToComment",value:function(){var e=this.getCommentBookmarkId();if(this["item_"+e]){var t=this["item_"+e].getPosition();this.itemsWrap.scrollTop=t}}},{key:"getCommentBookmarkId",value:function(){var e=window.APP.initializedBookmarkInfo;return e&&e.comment_id}},{key:"showCommentHighLight",value:function(){this.hasEntered||(this.hasEntered=!0,this.props.onHover(this.props.data.range,this.props.data.data,v.CR_TYPE.comments))}},{key:"resetCommentHighLight",value:function(){this.hasEntered=!1,this.props.showModal||this.props.onLeave(null,null,v.CR_TYPE.comments)}},{key:"updateReplyInfo",value:function(e,t){e.isExist=t.p_comment_exist,e.isValid=t.p_comment_valid,e.isExist&&e.isValid&&(e.username=t.p_comment_user_info.name,e.text=t.p_comment_text,e.pCommentId=t.p_comment_id)}},{key:"getCommentContent",value:function(e){var t=this,n=window.APP;if(!n.commentsDataManager)return null;var i=e.user,o=e.info,r=e.visible,a=e.readOnly,s=e.color,l=e.connected,c=e.showModal,u=e.isDone,d=e.id,p=e.bookmarkId,h=this.state.onlineData,f=h&&h[o.comment_id],v=o.rc_id===p,E=void 0,w=void 0,y=void 0,b=void 0,T=void 0,_=void 0,O={isExist:!1},P=n.commentsDataManager&&n.commentsDataManager.getUserInfoByCommentId(o.comment_id);P&&(N=(T=P.id)===window.APP.info.userid,E=P.name,w=P.avatar);var N=!1;f?(N=(T=f.user_info.id)===i.userid,E=E||f.user_info.name,w=w||f.user_info.avatar||f.user_info.avatar_url,y=(b=f.content).voicetext||o.content,_=f.emojis,this.updateReplyInfo(O,f)):(!h||!1!==h[o.comment_id]&&void 0!==o.comment_id||(E=E||o.author,w=w||g.a.getDefaultAvatar(E)),y=o.text||o.content),y=y&&"string"==typeof y?y.trim():"";var I=Boolean(0===e.index);return I&&(this.firstCommentUserId=T),m.a.createElement(C.a,{className:o.comment_id,ref:function(e){return t["item_"+o.rc_id]=e},key:o.rc_id,source:"matinText",info:o,content:b,text:y,avatar:w,username:E,showColor:!1,canEdit:!a,showDel:!0,showReply:!0,showEdit:N,visible:r,isDone:u,color:s,replyInfo:O,onDelete:this.onDeleteItem,onEdit:this.onEditItem,onReply:this.onReplyItem,getContainer:this.getModal,connected:l,isBookmark:v,showModal:c,invalidCacheHeight:this.invalidCacheHeight,readOnly:a,authorUserId:T,bubbleId:d,emojis:_,isFirstComment:I,firstCommentUserId:this.firstCommentUserId})}},{key:"getCommentEditor",value:function(e){var t=e.connected,n=e.items,i=e.info,o=e.id,r=e.isEditing,a=e.isBottom,s=e.replyId,l=e.scrollToVisible,c=e.manager,u=r?o+"_editing":o,d=r&&i?i.rc_id:null,p=r&&i?i.comment_id:null,h=r?"":_i18n("applications.writer.components.other.editPlaceholder", "Click to enter your comment."),f=r&&(!a||1===n.length),v=c.getCommentCache(p);Object(O.isTempCommentId)(p)&&s&&(v=c.updateCommentCache({p_comment_id:s}));var g={isExist:!1,id:s};v&&this.updateReplyInfo(g,v);var E=e.user,C=p&&window.APP.commentsDataManager.getUserInfoByCommentId(p);return C&&(E={username:C.name,avatar:C.avatar}),m.a.createElement(w.a,{key:u,connected:t,showUser:f,user:E,bubbleId:o,rcId:d,commentId:p,replyInfo:g,placeholder:h,onAddItem:this.onAddItem,onCancelReplyItem:this.onCancelReplyItem,scrollToVisible:l})}},{key:"renderItems",value:function(){var e=this,t=this.props,n=t.user,i=t.id,o=t.visible,r=t.readOnly,a=t.color,s=t.items,l=t.connected,c=t.replyId,u=t.handleGetOnline,d=t.showModal,p=t.scrollToVisible,f=t.isEditing,v=t.isDone,g=s.length>=3,E=window.APP.servicesLoader&&window.APP.servicesLoader.commentsDataManager,w=this.getCommentBookmarkId(),C=g&&!d,y=d&&!r,b=void 0,T=s.reduce((function(t,m,h){return m.isTemp?h===s.length-1&&Object(O.isTempCommentId)(m.comment_id)||!y||(b=e.getCommentEditor({info:m,items:s,id:i,connected:l,user:n,replyId:c,scrollToVisible:p,manager:E,isEditing:f,isBottom:!1}),t.push(b)):t.push(e.getCommentContent({user:n,index:h,info:m,items:s,id:i,visible:o,readOnly:r,color:a,connected:l,handleGetOnline:u,manager:E,showModal:d,isDone:v,bookmarkId:w})),t}),[]),_=!b&&y&&this.getCommentEditor({info:s[s.length-1],items:s,id:i,connected:l,user:n,replyId:c,scrollToVisible:p,manager:E,isEditing:f,isBottom:!0}),P=Object(O.renderElements)({elements:T,isMore:g,showPlaceholder:C,text:_i18n("applications.writer.components.other.Comment.hide", "{0} comments are hidden"),className:h()("hideItems",{showItems:C})});return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{ref:function(t){return e.itemsWrap=t},className:h()("comment-items-wrap",{hidden:!T.length,overflow:g})},P),_)}},{key:"render",value:function(){var e=this,t=this.props.className,n=this.state,i=n.isCooperating,o=n.isNew,r=this.props,a=r.connected,s=r.getContainer,l=r.items,c=r.showModal,u=r.top,d=r.id,p=r.isJump,f=r.readOnly,v=r.isEditing,g=r.isDone,w=r.data,C=void 0,b=!1;l&&l.length>0&&void 0!==this.props.top&&(C=this.renderItems()),f||(t+=" can-edit"),v&&(t+=" opacity-trans",0===u&&(t+=" opacity")),v&&l&&1===l.length?(b=!0,t+=" show-temp"):c&&l.length>0&&(b=!0,t+=" show"),o&&(t+=" opacity"),p&&!c&&(t+=" noanimate");var _=window.APP.editor&&window.APP.editor.cmdExecutor.getCurrentLocalCommand(),N=!(1===l.length&&_&&"insertComment"===_.name),I=!0,k=!1;try{if(l&&1===l.length&&l[0].isTemp){var D=(window.APP.servicesLoader&&window.APP.servicesLoader.commentsDataManager).getCommentCache(l[0].comment_id);D&&!D.isNotified&&(I=!1)}}catch(e){}return l&&l.some((function(e){return Object(O.isTempCommentId)(e.comment_id)}))&&(I=!1,k=!0),m.a.createElement(E.a,{ref:function(t){return e.modal=t},className:t,id:d,position:{top:u,left:0},initSize:{width:260},active:b,getContainer:s,visible:this.props.visible,scrollToVisible:this.props.scrollToVisible,onShow:this.handleOnShow,onClose:this.handleOnClose,onActive:this.handleOnActive},m.a.createElement("div",{className:"comment-modal",ref:function(t){return e.comment=t},onClick:this.handleModalClicked,onMouseEnter:this.showCommentHighLight,onMouseLeave:this.resetCommentHighLight},!b&&!v&&m.a.createElement("div",{className:"cover"}),g&&!c&&m.a.createElement("span",{className:"comment-done-tips"},m.a.createElement(y.default,{className:"comment-done-logo",type:y.default.types.size16.select_white})),b&&m.a.createElement("div",{className:"top_bar"}),m.a.createElement("div",{className:"comment-modal-header"},m.a.createElement("div",{className:"header-title"},m.a.createElement("span",{className:"header-color-bar"}),m.a.createElement("span",{className:"quote-content"},Object(P.getRangeStr)({pos:w.range.pos,len:w.range.len})),window.__CONFIG__.wps.enableShowCommentNum&&"("+(l?k?l.length-1:l.length:0)+")"),N&&I&&m.a.createElement(T.a,{title:g?_i18n("applications.writer.components.other.markAsUnChecked", "Mark as Unresolved"):_i18n("applications.writer.components.other.markAsChecked", "Mark as Resolved")},m.a.createElement("div",{className:h()("resolve-status",{disabled:!a}),onClick:this.deBounceChangeCmtResolveStatus},g?m.a.createElement(y.default,{type:y.default.types.size16.wps_circle_checkbox_checked}):m.a.createElement(y.default,{type:y.default.types.size16.wps_circle_checkbox}),m.a.createElement("div",{className:h()("resolve-tips",{checked:g})},g?_i18n("applications.writer.components.other.Comment.resolved", "solved"):_i18n("applications.writer.components.other.Comment.unresolved", "unsolved"))))),m.a.createElement("div",{className:"comment-modal-body"},C),b&&i?m.a.createElement("div",{className:"isDoneTips"},_i18n("applications.writer.components.other.Comment.isCooperating", "The collaborator is editing the comment. Adjusting the comment status is not supported at this time.")):null))}}]),t}(d.Component)),k=(n(14079),n(253)),D=n(472),S=n(167),A=function(e){function t(){var e,n,i,r;o()(this,t);for(var a=arguments.length,s=Array(a),c=0;c<a;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.didHide=!1,r=n,l()(i,r)}return u()(t,e),a()(t,[{key:"componentDidUpdate",value:function(e){this.props.text!==e.text&&this.dealText(this.props.text,!0),this.props.showModal!==e.showModal&&(S.isIE||S.isFirefox)&&this.dealText(this.props.text)}},{key:"componentDidMount",value:function(){this.dealText()}},{key:"dealText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.text,t=arguments[1],n=(S.isIE||S.isFirefox)&&Object(D.getStrLength)(e)>g.a.baseTextLength;n?(this.setHideText(e,t),this.text&&(this.text.innerText=e)):this.content&&(this.content.innerText=e)}},{key:"setHideText",value:function(e,t){if(!this.didHide||t){var n=this.hide,i="";if(n){this.didHide=!0;for(var o=0;o<e.length;o++){i+=e[o],n.innerText=i;var r=window.getComputedStyle(n).height;if(parseInt(r)>g.a.originHeight){n.innerText=i.substr(0,o-3)+"...";break}}}}}},{key:"render",value:function(){var e=this,t=this.props,n=t.text,i=t.showModal;return m.a.createElement("div",{ref:function(t){return e.content=t},className:"content "+(i?"content-show":"")+" "+(window.APP.canCopy()?"canCopy":"")},(S.isIE||S.isFirefox)&&Object(D.getStrLength)(n)>g.a.baseTextLength&&m.a.createElement("div",null,m.a.createElement("div",{ref:function(t){return e.hide=t},className:"hide"}),m.a.createElement("div",{ref:function(t){return e.text=t},className:"origin"})))}}]),t}(d.PureComponent),M=n(344),L=n(375),x=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.getModal=n.getModal.bind(n),n.getContainer=n.getContainer.bind(n),n.handleDeleteItem=n.handleDeleteItem.bind(n),n.handleOnActive=n.handleOnActive.bind(n),n.handleOnClose=n.handleOnClose.bind(n),n.showRevisionHighLight=n.showRevisionHighLight.bind(n),n.resetRevisionHighLight=n.resetRevisionHighLight.bind(n),n.time=null,n.updateHeightFlag=!1,n.updatePosFlag=!1,n.state={isNew:!!n.props.data.isNew},n}return u()(t,e),a()(t,[{key:"shouldComponentUpdate",value:function(e,t){if(t.isNew!==this.state.isNew)return!0;if(this.props.top!==e.top&&(this.updatePosFlag=!0,this.getPos()),e.isShowBtn!==this.props.isShowBtn)return!0;if(this.props.showModal!==e.showModal)return this.updateHeightFlag=!0,this.updatePosFlag=!0,!0;if(!1===e.isVisible&&!1===e.preVisible)return!1;if(!1===e.isVisible&&!1===e.preVisible)return!1;if(this.props.isVisible!==e.isVisible||this.props.top!==e.top&&e.isVisible)return!0;var n=this.props.data,i=e.data;return n.cleanContent!==i.cleanContent||n.wholeContent!==i.wholeContent||n.content!==i.content?(this.updateHeightFlag=!0,!0):JSON.stringify(this.getBaseData(this.props))!==JSON.stringify(this.getBaseData(e))||JSON.stringify(this.getRevisionData(n))!==JSON.stringify(this.getRevisionData(i))}},{key:"getBaseData",value:function(e){return{className:e.className,id:e.id,color:e.color,connected:e.connected,range:e.range,readOnly:e.readOnly,showModal:e.showModal,top:e.top,visible:e.visible,isJump:e.isJump}}},{key:"getRevisionData",value:function(e){return{cleanContent:e.cleanContent,wholeContent:e.wholeContent,docType:e.docType,idx:e.idx,isNew:e.isNew,pageIndex:e.pageIndex,position:e.position,author:e.author,content:e.content,date:e.date,leader:e.leader,revisionType:e.revisionType,type:e.type,user:e.user,userID:e.userID}}},{key:"componentDidUpdate",value:function(){this.updateHeightFlag&&(this.getHeight(),this.updateHeightFlag=!1),this.updatePosFlag&&(this.getPos(),this.updatePosFlag=!1)}},{key:"componentDidMount",value:function(){var e=this,t=this.props.data;this.getHeight(),this.getPos(),t.isNew&&(this.time=setTimeout((function(){e.setState({isNew:!1})}),400))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.time),this.time=null}},{key:"getHeight",value:function(){var e=this.props.data,t=this.modal.refs.container.offsetHeight,n=window.APP.workspace.revisionComment.dataHandler.dataIdObj[e.id];n&&(n.height=0===t?n.height||0:t)}},{key:"getPos",value:function(){var e=this.props.data,t=this.modal.refs.container.style,n=parseInt(t.top),i=window.APP.workspace.revisionComment.dataHandler.dataIdObj[e.id];i&&(i.truePos=n)}},{key:"handleDeleteItem",value:function(e){window.collection("revision","click","delete"),this.props.onDeleteItem&&this.props.onDeleteItem(e)}},{key:"getContainer",value:function(){return this.props.getContainer()}},{key:"getModal",value:function(){return this.modal.getModal()}},{key:"setModalFocus",value:function(){var e=this.getContainer(),t=this.modal.element;e.contains(document.activeElement)||t.focus()}},{key:"handleOnClose",value:function(){window.collection("comment_popup_close",2),this.setState({editUUID:""}),this.props.onClose()}},{key:"handleOnActive",value:function(e){if(!e.target||-1===e.target.className.indexOf("submit")){var t=this.props,n=t.range,i=t.id,o=t.data;this.props.onActive(n,i,o),this.setModalFocus()}}},{key:"usePaginationModeInkTips",value:function(e){try{if(window.APP.isWebMode()){var t=window.APP.data.doc.anchors.getAnchors(e,1);t.length&&t[0]&&t[0].anchor&&t[0].anchor.shapeData&&t[0].anchor.shapeData.isInk&&window.APP.workspace.showToast("warn",_i18n("applications.writer.components.other.paginationModeToSeeInk", "The continuous page layout cannot view the ink object, you can try to switch the page layout"))}}catch(e){console.error("revision accept or reject ink error",e)}}},{key:"submit",value:function(e){var t=this.props,n=t.data;if(t.connected){var i=document.querySelector(".virtual-input");this.usePaginationModeInkTips(n.pos),f.default.dispatchEvent(f.default.revision.REVISION_ACCEPTREFUSE,{id:n.rc_id,type:e});var o=window.APP.workspace.element.scrollTop;i&&(i.style.top=o+50+"px"),window.APP.focusInput(),window.collection("revision","click","accept"===e?"revise_accept":"revise_refuse")}}},{key:"showRevisionHighLight",value:function(){this.hasEntered||(this.hasEntered=!0,this.props.onHover(this.props.data.range,null,v.CR_TYPE.revision))}},{key:"resetRevisionHighLight",value:function(){this.hasEntered=!1,this.props.onLeave(window.APP.data.selection.begin.position,null,v.CR_TYPE.revision)}},{key:"render",value:function(){var e,t=this,n=this.props.className,i=this.props,o=i.getContainer,r=i.data,a=i.showModal,s=i.top,l=i.id,c=i.readOnly,u=i.connected,d=i.isJump,p=i.isShowBtn,h=r.author,f=r.date?Object(k.formatDate)(k.FormatType.Auto,r.date):null,v="tools";return e={background:""+window.APP.data.selection.selCoop.getCooperatorColor(r.userID)},this.state.isNew&&(n+=" opacity"),u||(v+=" disabled"),d&&!a&&(n+=" noanimate"),m.a.createElement(E.a,{ref:function(e){return t.modal=e},className:n+(a?" show":""),id:l,position:{top:s,left:0},initSize:{width:260},active:a,getContainer:o,visible:!0,scrollToVisible:this.props.scrollToVisible,onShow:function(){},onClose:this.handleOnClose,onActive:this.handleOnActive},m.a.createElement("div",{ref:function(e){return t.modal=e},className:"revision-modal",onMouseEnter:this.showRevisionHighLight,onMouseLeave:this.resetRevisionHighLight},m.a.createElement("div",{className:"revision-modal-body"},m.a.createElement("div",{className:"header"},m.a.createElement("div",{className:"name"},h),m.a.createElement("div",{className:"times"},f),!c&&p&&m.a.createElement("div",{className:v},m.a.createElement("div",{className:"tools-btn",onClick:this.submit.bind(this,"accept")},m.a.createElement(L.default,{size:16,className:"item-icon",fill:"#757575"})),m.a.createElement("div",{className:"tools-btn",onClick:this.submit.bind(this,"reject")},m.a.createElement(M.default,{size:16,className:"item-icon",fill:"#757575"})))),m.a.createElement("div",{className:"line",style:e}),m.a.createElement(A,{showModal:a,text:r.cleanContent}))))}}]),t}(d.Component),R=n(227),j=n(14),H=(n(14080),function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleGetCommentStatus=function(){var e=Object(N.isLoadedAuditComment)();e&&window.removeEventListener(f.default.comments.GET_ONLINE_AUDIT_COMMENTS,n.handleGetCommentStatus),n.setState({isLoadComments:e})},n.scrollToVisible=function(e){var t="cr_modal_"+e,i=n[t]&&n[t].modal&&n[t].modal.element;if(i){var o=window.APP.workspace.element,r=o.clientWidth,a=i.getBoundingClientRect(),s=a.left+a.width-r-16;s>0&&!window.APP.isAdaptMode()&&setTimeout((function(){o.scrollLeft+=s}),100)}},n.scrollIntoView=function(e){var t="cr_modal_"+e,i=n[t]&&n[t].modal&&n[t].modal.element;if(i&&n.wrapRef){var o=n.props,r=o.data,a=o.tops[r.findIndex((function(t){return t.id===e}))];if(void 0!==a){var s=i.offsetHeight,l=n.wrapRef.offsetHeight,c=a+s;n.wrapRef.scrollTop=c>l?Math.ceil(c-l):0}}},n.onActive=function(e,t,n){f.default.dispatchEvent(f.default.comments.ON_ACTIVE,{range:e,id:t,data:n})},n.onClose=function(e){f.default.dispatchEvent(f.default.comments.ON_CLOSE,{isDiscardComment:e})},n.onHover=function(e,t,n){f.default.dispatchEvent(f.default.comments.ON_HOVER,{range:e,data:t,type:n})},n.onLeave=function(e,t,n){f.default.dispatchEvent(f.default.comments.ON_LEAVE,{pos:e,data:t,type:n})},n.onDidMount=function(){f.default.dispatchEvent(f.default.comments.ON_DID_MOUNT)},n.handleGetOnline=function(e,t,n){f.default.dispatchEvent(f.default.comments.GET_ONLINE_COMMENTS,{comment_id:e,modal_id:t,comment:n})},n.handlePageContainerSizeChange=function(e){var t=(e.detail||{}).clientHeight;t&&t!==n.state.wrapHeight&&n.setState({wrapHeight:t})},n.state={connected:!0,isRestrictEditMode:window.APP.formatContentController&&window.APP.formatContentController.isRestrictEditMode,isLoadComments:!1,wrapHeight:window.APP.workspace&&window.APP.workspace.container&&window.APP.workspace.container.cacheDOMAttr&&window.APP.workspace.container.cacheDOMAttr.clientHeight||0},n.handleConnected=n.handleConnected.bind(n),n.handleDisConnected=n.handleDisConnected.bind(n),n.handleRestrictEditModeChange=n.handleRestrictEditModeChange.bind(n),n.removeMainFocus=n.removeMainFocus.bind(n),n.containerRefeshForce=n.containerRefeshForce.bind(n),n}return u()(t,e),a()(t,[{key:"shouldComponentUpdate",value:function(e,t){if(this.props.currId!==e.currId)return!0;var n=this.props.data,i=e.data;return!!(n&&i&&(this.props.length>0||e.length>0))||(t.isLoadComments!==this.state.isLoadComments||t.wrapHeight!==this.state.wrapHeight)}},{key:"componentWillUnmount",value:function(){window.removeEventListener(R.default.names.network.ON_CONNECTED,this.handleConnected),window.removeEventListener(R.default.names.network.ON_DISCONNECTED,this.handleDisConnected),window.removeEventListener(f.default.revision.REVISION_BTN_DISPLAY_CHANGE,this.containerRefeshForce),window.removeEventListener(f.default.restrictEdit.ON_RESTRICT_STATE_CHANGE,this.handleRestrictEditModeChange),window.removeEventListener(f.default.names.ON_ENTER_PARAGRAPH_SETTING_MODE,this.containerRefeshForce),window.removeEventListener(f.default.names.ON_EXIT_PARAGRAPH_SETTING_MODE,this.containerRefeshForce),window.removeEventListener(f.default.names.ON_PAGE_CONTAINER_SIZE_CHANGE,this.handlePageContainerSizeChange)}},{key:"componentDidUpdate",value:function(){var e=this.props.data;window.APP.isAdaptMode()&&Array.isArray(e)&&0===e.length&&0!==this.preDataLength&&window.APP.workspace.resize(),this.preDataLength=Array.isArray(e)?e.length:0,!this.props.currId&&this.wrapRef&&(this.wrapRef.scrollTop=0)}},{key:"componentDidMount",value:function(){window.addEventListener(R.default.names.network.ON_CONNECTED,this.handleConnected),window.addEventListener(R.default.names.network.ON_DISCONNECTED,this.handleDisConnected),window.addEventListener(f.default.revision.REVISION_BTN_DISPLAY_CHANGE,this.containerRefeshForce),window.addEventListener(f.default.restrictEdit.ON_RESTRICT_STATE_CHANGE,this.handleRestrictEditModeChange),window.addEventListener(f.default.names.ON_ENTER_PARAGRAPH_SETTING_MODE,this.containerRefeshForce),window.addEventListener(f.default.names.ON_EXIT_PARAGRAPH_SETTING_MODE,this.containerRefeshForce),window.addEventListener(f.default.comments.GET_ONLINE_AUDIT_COMMENTS,this.handleGetCommentStatus),window.addEventListener(f.default.names.ON_PAGE_CONTAINER_SIZE_CHANGE,this.handlePageContainerSizeChange),this.onDidMount(),this.handleGetCommentStatus(),Object(j.hasQuery)("commentid")&&f.default.dispatchEvent(f.default.comments.SET_COMMENT_OR_COMMENT_PANEL_CHECKED,{showComment:!1,showCommentPanel:!0})}},{key:"handleConnected",value:function(){this.setState({connected:!0})}},{key:"handleDisConnected",value:function(){this.setState({connected:!1})}},{key:"handleRestrictEditModeChange",value:function(e){var t=this,n=e.detail.isRestrict;this.setState({isRestrictEditMode:n},(function(){t.forceUpdate()}))}},{key:"containerRefeshForce",value:function(){this.forceUpdate()}},{key:"getContainer",value:function(){return document.querySelector(".cr-list")}},{key:"isCommentsModalOpen",value:function(){var e=document.querySelector(".comment-addmodal");return!!e&&("none"!==(e=e.parentNode).style.display&&"hidden"!==e.style.visibility)}},{key:"checkIfCRmodal",value:function(e){for(var t=document.querySelector("body"),n=e,i=!1;n!==t;){if(-1!==n.className.indexOf("cr-modal")){i=!0;break}n=n.parentNode}return i}},{key:"removeMainFocus",value:function(){window.APP.workspace.input.blur()}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,i=t.currId,o=t.replyId,r=t.tops,a=t.ranges,s=this.onActive,l=this.onClose,c=this.onHover,u=this.onLeave,d=this.handleGetOnline,p=this.state,f=p.connected,v=p.isLoadComments,g=p.wrapHeight,E=window.APP,w=E.info,C=n.map((function(t,n){var p=!0;try{p=!E.workspace.revisionComment.checkIsCommentOrRevisionBubbleEditable(t)}catch(e){}var h=t.id,v=t.data,g="cr_modal_"+t.id,C=h===i,y=!!t.isTemp,b=null;if("comments"===t.type){var T=t.data.reduce((function(e,n){return!(!n.isTemp&&!n.isDone||n.isTemp&&1===t.data.length)&&e}),!0);b=m.a.createElement(I,{ref:function(t){return e[g]=t},key:h,id:h,className:"cr-modal cr-comment "+g,getContainer:e.getContainer,visible:!0,readOnly:p,color:"#f00",user:w,data:t,preVisible:t.preVisible,isVisible:t.isVisible,isJump:t.isJump,isEditing:y,items:v,top:r[n],range:a[n],showModal:C,connected:f,currId:i,replyId:o,isDone:T,onActive:s,onClose:l,onHover:c,onLeave:u,handleGetOnline:d,removeMainFocus:e.removeMainFocus,scrollToVisible:e.scrollToVisible,scrollIntoView:e.scrollIntoView})}else{var _=E.workspace.revisionComment.isShowRevisionBtn;b=m.a.createElement(x,{ref:function(t){return e[g]=t},key:h,id:t.id,className:"cr-modal cr-revision "+g,getContainer:e.getContainer,visible:!0,readOnly:p,isShowBtn:_,color:"#f00",data:t,preVisible:t.preVisible,isVisible:t.isVisible,isJump:t.isJump,top:r[n],range:a[n],showModal:C,connected:f,onActive:s,onClose:l,onHover:c,onLeave:u,removeMainFocus:e.removeMainFocus,scrollToVisible:e.scrollToVisible})}return b})).filter((function(e){return e}));return m.a.createElement("div",{ref:function(t){return e.wrapRef=t},className:"cr-wrap",style:{height:g}},m.a.createElement("div",{className:h()("cr-content",{"list-empty":!C||0===C.length})},v?C:null))}}],[{key:"getDerivedStateFromProps",value:function(e){return e.left?{left:e.left}:null}}]),t}(d.Component));t.default=H},1735:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSelectionEnd=t.selectAllByNode=t.setRangeByNode=t.setRangeByRange=t.createRange=t.getCurrentRange=void 0;var i=n(1476);function o(e,t,n,i){n||(n=e),i||(i=t);var o=document.createRange();return o.setStart(e,t),o.setEnd(n,i),o}function r(e){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}function a(e,t,n,i){var a=o(e,t,n,i);return r(a),a}t.getCurrentRange=function(){var e=window.getSelection();return e&&e.rangeCount?e.getRangeAt(0):null},t.createRange=o,t.setRangeByRange=r,t.setRangeByNode=a,t.selectAllByNode=function(e){var t=window.getSelection();t.removeAllRanges(),t.selectAllChildren(e)},t.setSelectionEnd=function(e){var t=getSelection();if((0,i.isTextSpace)(e.lastChild))a(e.lastChild,0);else{if((0,i.isBrNode)(e.lastChild)){var n=e.lastChild.previousSibling;if((0,i.isTextSpace)(n))return void a(n,0)}(0,i.isEmptyTextNode)(e.lastChild)&&e.lastChild.remove(),t.selectAllChildren(e),t.collapseToEnd()}}},1806:function(e,t,n){"use strict";n.r(t),n.d(t,"classes",(function(){return i})),n.d(t,"ItemConfig",(function(){return o})),n.d(t,"categories",(function(){return r}));var i={mention:"mention",filelink:"filelink",link:"link"},o={user:"mention",file:"filelink"},r={avatar:"avatar",text:"text"}},1808:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAtPosition=t.getAtAttrs=t.isTrueAtDom=t.createAtDom=t.closeAt=t.showAt=t.hasTempAtDom=t.setTempAtDom=t.getTempAtDom=void 0;var i,o,r=n(5),a=r.__importDefault(n(260)),s=r.__importStar(n(167)),l=n(1806),c=n(246),u=n(1735),d=null,m=null;function p(){return m}function h(e){m=e}function f(){return!!m}function v(e){void 0===e&&(e=!1),e&&a.default.dispatchEvent(a.default.comments.COLSE_AT_MODEL),h(null),g(!1)}function g(e){s.isMobile?function(e){e?window.addEventListener("keydown",C):window.removeEventListener("keydown",C)}(e):function(e){o||(o=window.utils.Lodash.debounce(w,100));i||(i=window.utils.Lodash.debounce(E,16));if(e){window.addEventListener("keydown",C),document.addEventListener("selectionchange",o),window.addEventListener(a.default.comments.ON_COMMENT_PANEL_SCROLL,i),d&&d.disconnect();var t=function(){var e=null;if(f())for(var t=p().parentNode;t;)t.classList&&t.classList.contains("comment-modal-body")?(e=t,t=null):t=t.parentNode;return e}();t&&((d=new MutationObserver(i)).observe(t,{childList:!0,subtree:!0}),window.addEventListener("resize",i,!1))}else window.removeEventListener("keydown",C),document.removeEventListener("selectionchange",o),window.removeEventListener(a.default.comments.ON_COMMENT_PANEL_SCROLL,i),d&&(d.disconnect(),d=null,window.removeEventListener("resize",i,!1))}(e)}function E(){if(f()){var e=p();if(!e.parentNode)return;var t=y((0,u.createRange)(e,e.textContent.length).getBoundingClientRect());a.default.dispatchEvent(a.default.comments.SHOW_AT_MODEL,{position:t,isUpdate:!0})}}function w(){if(f()){var e=(0,u.getCurrentRange)(),t=window.APP.workspace.commentInput.element;if(e&&t.contains(e.commonAncestorContainer)){var n=p();(e.startContainer!==n||e.endContainer!==n||e.startOffset<=n.startOffset)&&v(!0)}}}function C(e){var t=(0,c.getKey)(e);return![c.Keys.Tab,c.Keys.Enter,c.Keys.Esc,c.Keys.ArrowLeft,c.Keys.ArrowUp,c.Keys.ArrowRight,c.Keys.ArrowDown].includes(t)||(e.preventDefault(),e.stopPropagation(),!1)}function y(e){var t,n,i={bound:{},begin:{},end:{}},o=window.APP,r=o.workspace.element.cacheDOMAttr,a=r.rect,l=r.scrollLeft,c=r.scrollTop,u=r.clientWidth,d=r.clientHeight,m=s.isPad?o.appApi.keyboardHeight:0,p=window.APP.workspace.commentInput&&window.APP.workspace.commentInput.element||document.querySelector("#root .temp_comment_input"),h=p&&p.getBoundingClientRect()||e,f=!0;if(e.right/a.right<.5&&(f=!1),o.commentShowStatus.commentBubble)t=h.left+l,n=e.top+c-a.top,i.bound={left:l,right:f?l+h.x:l+u,top:c,bottom:c+d-m};else{t=h.left,n=e.top;var v=document.body.cacheDOMAttr,g=v.clientWidth,E=v.clientHeight;i.bound={left:0,right:f?h.x:g,top:0,bottom:E-m}}return i.begin={x:t,y:n,offsetX:h.width,offsetY:e.height},i.end={x:t+e.width,y:n,offsetX:h.width,offsetY:e.height},i}t.getTempAtDom=p,t.setTempAtDom=h,t.hasTempAtDom=f,t.showAt=function(e,t){a.default.dispatchEvent(a.default.comments.SHOW_AT_MODEL,{position:e}),h(t),g(!0)},t.closeAt=v,t.createAtDom=function(e,t){var n=document.createElement("span");return e&&(n.classList.add("isMention"),n.textContent=t||"",Object.keys(e).forEach((function(t){n.setAttribute("contenteditable","false"),"classes"!==t?(n.setAttribute(t,e[t]),"userid"===t&&e[t]==window.APP.info.userid&&n.classList.add("isAtSelf")):n.classList.add(e[t])}))),n},t.isTrueAtDom=function(e){return e&&e.classList&&e.classList.contains("isMention")},t.getAtAttrs=function(e){var t=["class","contenteditable"],n={extraattrs:"extraAttrs"},i=r.__spreadArray([],e.attributes,!0).reduce((function(e,i){var o=i.name,r=i.value;return t.includes(o)||(n.hasOwnProperty(o)&&(o=n[o]),e[o]=r),e}),{});return r.__spreadArray([],e.classList,!0).forEach((function(e){l.classes[e]&&(i.classes=l.classes[e])})),i},t.getAtPosition=y},2137:function(e,t,n){},2165:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=n(1131),a=i.__importDefault(n(2166));n(2167),t.default=(0,o.memo)((function(e){var t=e.clickItem,n=(0,o.useCallback)((function(e){t&&t(e)}),[t]);return o.default.createElement("div",{className:"emoji-list"},o.default.createElement("div",{className:"emoji-list-title"},_i18n("applications.writer.helpers.emojiController.type.all", "all expressions")),o.default.createElement("div",{className:"emoji-list-content"},r.emojiMap.map((function(e){var t=e.id,i=e.value;return o.default.createElement(a.default,{key:t,id:t,value:i,clickItem:n})}))))}))},2166:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(1567));t.default=(0,o.memo)((function(e){var t=e.id,n=e.value,i=e.clickItem,a=(0,o.useCallback)((function(e){e.stopPropagation(),i&&i(t)}),[i,t]);return o.default.createElement("div",{className:"emoji-item",onClick:a},o.default.createElement(r.default,{id:t,value:n}))}))},2167:function(e,t,n){},239:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n(238),o=n.n(i),r=["size","strokeWidth","strokeLinecap","strokeLinejoin","theme","fill","className","spin"];function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function u(){return"icon-"+(4294967296*(1+Math.random())|0).toString(16).substring(1)}var d=Object(i.createContext)({size:"1em",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"miter",rtl:!1,theme:"outline",colors:{outline:{fill:"#333333",background:"transparent"}},prefix:"kd"});d.Provider;function m(e,t,n){return function(a){var l=a.size,m=a.strokeWidth,p=a.strokeLinecap,h=a.strokeLinejoin,f=a.theme,v=a.fill,g=a.className,E=a.spin,w=c(a,r),C=Object(i.useContext)(d),y=function(e,t,n){var i="";return t.fill&&(t.fill,i=t.fill),t.theme||n.theme,{size:t.size||n.size,strokeWidth:t.strokeWidth||n.strokeWidth,strokeLinecap:t.strokeLinecap||n.strokeLinecap,strokeLinejoin:t.strokeLinejoin||n.strokeLinejoin,colors:i,id:e}}(Object(i.useMemo)(u,[]),{size:l,strokeWidth:m,strokeLinecap:p,strokeLinejoin:h,theme:f,fill:v},C),b=["kd-icon"];return b.push("kd-icon-"+e),t&&C.rtl&&b.push("kd-icon-rtl"),E&&b.push("kd-icon-spin"),g&&b.push(g),o.a.createElement("i",s(s({},w),{},{className:b.join(" "),style:{lineHeight:0}}),n(y))}}},2488:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={INSERT_LINK:"INSERT_LINK",INSERT_BOOKMARK:"INSERT_BOOKMARK",CONVENE_COOPERATORS:"CONVENE_COOPERATORS"}},253:function(e,t,n){"use strict";n.r(t),n.d(t,"getDateTimestamp",(function(){return s})),n.d(t,"FormatType",(function(){return d})),n.d(t,"formatDate",(function(){return m})),n.d(t,"TimeMode",(function(){return h})),n.d(t,"calcTime",(function(){return f})),n.d(t,"formatTime",(function(){return v})),n.d(t,"toTimestamp",(function(){return a})),n.d(t,"transformSeconds",(function(){return g})),n.d(t,"isHasSecTime",(function(){return E})),n.d(t,"isHasTime",(function(){return w}));var i={0:_i18n("applications.public.helpers.number.zero", "Zero"),1:_i18n("applications.public.helpers.number.one", "Mon."),2:_i18n("applications.public.helpers.number.two", "Tue."),3:_i18n("applications.public.helpers.number.three", "Wed."),4:_i18n("applications.public.helpers.number.four", "Thur."),5:_i18n("applications.public.helpers.number.five", "Fri."),6:_i18n("applications.public.helpers.number.six", "Sat."),7:_i18n("applications.public.helpers.number.seven", "Seven"),8:_i18n("applications.public.helpers.number.eight", "Eight"),9:_i18n("applications.public.helpers.number.night", "Nine"),10:_i18n("applications.public.helpers.number.ten", "Tenth")},o={ARABIC_NUM_MAP_CHINESE:i,turnArabic2ChineseNumChar:function(e){for(var t=e.toString(),n="",o=0;o<t.length;o++)n+=i[t[o]];return n},numToChinese:function(e){var t=e.toString();if(t.length>2)return!1;var n="",o=parseInt(t/10),r=parseInt(t%10);return o>1&&(n+=i[o]),o>0&&(n+=i[10]),r>0&&(n+=i[r]),n}},r=function(e){return e<10?"0"+e:e},a=function(e){return e.toString().length>11?e:1e3*e},s=function(e){"number"!=typeof e&&(e=e.getTime());var t=u("yyyy-mm-dd",e);return new Date(t).getTime()},l=[_i18n("applications.public.helpers.date.weekday.sun", "Sunday"),_i18n("applications.public.helpers.date.weekday.mon", "Monday"),_i18n("applications.public.helpers.date.weekday.tues", "Tuesday"),_i18n("applications.public.helpers.date.weekday.wed", "Wednesday"),_i18n("applications.public.helpers.date.weekday.thur", "Thursday"),_i18n("applications.public.helpers.date.weekday.fri", "Friday"),_i18n("applications.public.helpers.date.weekday.sat", "Saturday")],c=[_i18n("applications.public.helpers.date.month.jan", "Jan"),_i18n("applications.public.helpers.date.month.feb", "Feb"),_i18n("applications.public.helpers.date.month.mar", "Mar"),_i18n("applications.public.helpers.date.month.apr", "Apr"),_i18n("applications.public.helpers.date.month.may", "May"),_i18n("applications.public.helpers.date.month.jun", "Jun"),_i18n("applications.public.helpers.date.month.jul", "Jul"),_i18n("applications.public.helpers.date.month.aug", "Aug"),_i18n("applications.public.helpers.date.month.sept", "Sept"),_i18n("applications.public.helpers.date.month.oct", "Oct"),_i18n("applications.public.helpers.date.month.nov", "Nov"),_i18n("applications.public.helpers.date.month.dec", "Dec")],u=function(e,t){t=a(t);var n=new Date(t);return e=e.replace(/(ys|yyyy|ycyc|mm|mc|m|M|dd|dc|d|H|i|s|D)/g,(function(e){switch(e){case"ys":return n.getFullYear()%100;case"yyyy":return n.getFullYear();case"ycyc":return o.turnArabic2ChineseNumChar(n.getFullYear());case"mm":return r(n.getMonth()+1);case"mc":return o.numToChinese(n.getMonth()+1);case"m":return n.getMonth()+1;case"M":return c[n.getMonth()];case"dd":return r(n.getDate());case"dc":return o.numToChinese(n.getDate());case"d":return n.getDate();case"H":return r(n.getHours());case"i":return r(n.getMinutes());case"s":return r(n.getSeconds());case"D":return l[n.getDay()];default:return console.assert(!1),e}}))},d={Date:_i18n("applications.public.helpers.date.format.time6", "M dd, yyyy"),Time:_i18n("applications.public.helpers.date.format.time3", "H:i"),DateTime:_i18n("applications.public.helpers.date.format.time5", "M dd, yyyy H:i"),FullTime:_i18n("applications.public.helpers.date.format.time7", "M dd, yyyy H:i:s"),Auto:null},m=function(e,t){return e===d.Auto?p(t):u(e,t)},p=function(e){var t=a(e),n=new Date(t),i=new Date,o=i.getTime()-t;if(o<0)return u(_i18n("applications.public.helpers.date.format.time5", "M dd, yyyy H:i"),t);if(o<6e4)return _i18n("applications.public.helpers.date.format.time1", "Just Now");if(i.getFullYear()-n.getFullYear()!=0)return u(_i18n("applications.public.helpers.date.format.time5", "M dd, yyyy H:i"),t);if(i.getMonth()-n.getMonth()!=0)return u(_i18n("applications.public.helpers.date.format.time4", "M dd H:i"),t);if(i.getDate()-n.getDate()==0){var r=u(_i18n("applications.public.helpers.date.format.time3", "H:i"),t);return _i18n("applications.public.helpers.date.format.time2", "Today {0}").replace("{0}",r)}return u(_i18n("applications.public.helpers.date.format.time4", "M dd H:i"),t)},h={T24HourClock:0,T12HourClock:1},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=60*i+n,s=h.T24HourClock===o?e:e+(r?0:12),l=60*s+t+a;l=l<0?1440+l:l;var c=Math.floor(l/60)%24,u=l%60;return h.T24HourClock===o?{rHour:c,rMinute:u}:(c>12&&(c-=12),{rHour:c,rMinute:u,isAm:c>12||12===c&&u>=0})},v=function(e,t,n){var i=t.toString(),o=n.toString();return i.length<2&&(i="0"+i),o.length<2&&(o="0"+o),e=e.replace("H",i).replace("i",o)},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="0"+Math.floor(e%60),i="0"+Math.floor(e/60%60),o="0"+Math.floor(e/3600);return t?parseInt(1e3*e):o.slice(-2)+":"+i.slice(-2)+":"+n.slice(-2)},E=function(e){return/h{1,2}:mm:ss/.test(e)},w=function(e){return/h{1,2}:mm/.test(e)}},2918:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),r=n(22),a=n.n(r),s=n(23),l=n.n(s),c=(n(2919),n(1449)),u=function(e){function t(){return o()(this,t),a()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l()(t,e),t}(n.n(c).a);t.default=u},2919:function(e,t,n){},321:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=(n(499),n(238)),m=n.n(d),p=n(244),h=n.n(p),f=n(167),v=n(227),g=n(372),E=n(30),w=n.n(E),C=(n(500),n(240)),y=n(246),b={topCenter:"topCenter",topRight:"topRight",topLeft:"topLeft",bottomLeft:"bottomLeft",bottomRight:"bottomRight",rightBottom:"rightBottom",leftBottom:"leftBottom"},T=n(450),_=n(13),O=n.n(_);var P=function(e,t,n,i){n=function(e){var t=O()({},e),n=window.scrollY;return e&&n&&(t.top+=n,t.bottom+=n),t}(n);var o=void 0;switch(window.rightToLeft&&(e=/(Left|left)/.test(e)?e.replace("Left","Right").replace("left","right"):e.replace("Right","Left").replace("right","left")),e){case b.topCenter:o=function(e,t,n){var i=e.offsetWidth,o=e.offsetHeight,r=document.body.clientHeight,a=t.left+t.width/2-i/2,s=t.top-n,l=r-t.bottom-n,c=t.top-n-o,u=t.bottom+n;return{left:a,top:s>=o?c:l>=o?u:s>=50||s>=l?c:u}}(t,n,i);break;case b.topRight:o=function(e,t,n){var i=e.offsetWidth,o=e.offsetHeight,r=document.body,a=r.clientWidth,s=r.clientHeight,l=t.right,c=a-t.left,u=t.right-i,d=t.left,m=void 0;m=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var p=s-t.bottom-n,h=t.top-n,f=t.bottom+n,v=t.top-n-o;return{left:m,top:h>=o?v:p>=o||p>=50||p>=h?f:v}}(t,n,i);break;case b.topLeft:o=function(e,t,n){var i=e.offsetWidth,o=e.offsetHeight,r=document.body,a=r.clientWidth,s=r.clientHeight,l=t.right,c=a-t.left,u=t.right-i,d=t.left,m=void 0;m=c>=i?d:l>=i||l>=50||l>=c?u:d;var p=s-t.bottom-n,h=t.top-n,f=t.bottom+n,v=t.top-n-o;return{left:m,top:h>=o?v:p>=o||p>=50||p>=h?f:v}}(t,n,i);break;case b.bottomLeft:o=function(e,t,n){var i=e.offsetWidth,o=e.offsetHeight,r=document.body,a=r.clientWidth,s=r.clientHeight,l=a-t.left,c=t.right,u=t.left,d=t.right-i,m=void 0;m=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var p=s-t.bottom-n,h=t.top-n,f=t.bottom+n,v=t.top-n-o;return{left:m,top:p>=o?f:h>=o?v:p>=50||p>=h?f:v}}(t,n,i);break;case b.bottomRight:o=function(e,t,n){var i=e.offsetWidth,o=e.offsetHeight,r=document.body,a=r.clientWidth,s=r.clientHeight,l=t.right,c=a-t.left,u=t.right-i,d=t.left,m=void 0;m=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var p=s-t.bottom-n,h=t.top-n,f=t.bottom+n,v=t.top-n-o;return{left:m,top:p>=o?f:h>=o?v:p>=50||p>=h?f:v}}(t,n,i);break;case b.rightBottom:o=function(e,t,n){var i=e.offsetWidth,o=e.offsetHeight,r=document.body,a=r.clientWidth,s=r.clientHeight,l=a-t.right-n,c=t.left-n,u=t.right+n,d=t.left-n-i,m=void 0;m=l>=i?u:c>=i?d:l>=50||l>=c?u:d;var p=s-t.top,h=t.bottom,f=t.top,v=t.bottom-o;return{left:m,top:p>=o?f:h>=o?v:p>=50||p>=h?f:v}}(t,n,i);break;case b.leftBottom:o=function(e,t,n){var i=e.offsetWidth,o=e.offsetHeight,r=document.body,a=r.clientWidth,s=r.clientHeight,l=a-t.right-n,c=t.left-n,u=t.right+n,d=t.left-n-i,m=void 0;m=c>=i?d:l>=i||l>=50||l>=c?u:d;var p=s-t.top,h=t.bottom,f=t.top,v=t.bottom-o;return{left:m,top:p>=o?f:h>=o?v:p>=50||p>=h?f:v}}(t,n,i);break;default:throw new Error("what is thisï¼Ÿ"+e)}return window.rightToLeft&&(o.right=document.body.clientWidth-o.left-t.offsetWidth,delete o.left),o},N=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={visible:!1},n.panelW=void 0,n.panelH=void 0,n.timestamp=void 0,n.handleClose=function(e){var t=e.target,i=n.refPanel.current,o=n.props.triggerElement;!i||i.contains(t)||function(e,t){if(e){var n=e.getBoundingClientRect(),i=t.changedTouches&&t.changedTouches[0]?t.changedTouches[0]:t,o=i.pageX,r=i.pageY;return o>=n.left&&o<=n.right&&r>=n.top&&r<=n.bottom}return!1}(o,e)||T.a(e.target)<n.level&&n.props.onClose()},n.handleOrientationchange=function(){n.props.onClose()},n.handleWheel=function(e){n.handleClose(e)},n.origin=null,n.style=null,n.maxHeight=void 0,n.refPanel=m.a.createRef(),n.handleWindowKeyDown=n.handleWindowKeyDown.bind(n),n.handleWindowResize=n.handleWindowResize.bind(n),n.handleClosePanel=n.handleClosePanel.bind(n),n.handleDisconnected=n.handleDisconnected.bind(n),n.handleWindowMouseDown=n.handleWindowMouseDown.bind(n),n.timestamp=window.performance.now(),n}return u()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.props.visible&&(this.bindEvents(),this.setState({visible:!0}))}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.visible;e.visible!==n&&(n?(this.bindEvents(),this.origin=null,this.style=null,this.maxHeight=void 0):this.unbindEvents(),this.setState({visible:n}))}},{key:"componentWillUnmount",value:function(){this.unbindEvents()}},{key:"observerPanel",value:function(){var e=this;if(void 0===this.panelW){var t=this.refPanel.current;this.panelW=t.clientWidth,this.panelH=t.clientHeight,this.observer=new MutationObserver((function(){var n=t.clientWidth,i=t.clientHeight;e.panelW===n&&e.panelH===i||(e.panelW=n,e.panelH=i,e.origin=null,e.style=null,e.forceUpdate())})),this.observer.observe(t,{childList:!0,subtree:!0})}}},{key:"handleClosePanel",value:function(e){if(this.state.visible){var t=e.detail.isCloseSub;t&&this.level>1?this.props.onClose():t||1!==this.level||this.props.onClose()}}},{key:"handleDisconnected",value:function(){this.props.autoClose&&this.props.onClose()}},{key:"handleWindowKeyDown",value:function(e){y.getKey(e)===y.Keys.Esc&&(T.b(this.level+1)||(Object(C.stopBubble)(e),this.props.onClose()))}},{key:"handleWindowMouseDown",value:function(e){f.isPad&&window.performance.now()-this.timestamp<=300||this.handleClose(e)}},{key:"handleWindowResize",value:function(e){var t=(e.detail||{}).isClosePanel;(void 0===t?null:t)||(f.isTouchScreen?(this.style=null,this.forceUpdate()):this.props.onClose())}},{key:"bindEvents",value:function(){this.observerPanel(),v.default.dispatchEvent(v.default.names.ON_DROPDOWN_PANEL_VISIBLE_CHANGE,{visible:!0}),window.addEventListener(v.default.names.CLOSE_DROPDOWN_PANEL,this.handleClosePanel),window.addEventListener(v.default.names.network.ON_DISCONNECTED,this.handleDisconnected),window.addEventListener("keydown",this.handleWindowKeyDown,!0),window.addEventListener("mousedown",this.handleWindowMouseDown,!0),window.addEventListener("resize",this.handleWindowResize),window.addEventListener("touchstart",this.handleClose,!0),window.addEventListener("orientationchange",this.handleOrientationchange),window.addEventListener("wheel",this.handleWheel,!0),window.visualViewport&&window.visualViewport.addEventListener("resize",this.handleWindowResize)}},{key:"unbindEvents",value:function(){v.default.dispatchEvent(v.default.names.ON_DROPDOWN_PANEL_VISIBLE_CHANGE,{visible:!1}),window.removeEventListener(v.default.names.CLOSE_DROPDOWN_PANEL,this.handleClosePanel),window.removeEventListener(v.default.names.network.ON_DISCONNECTED,this.handleDisconnected),window.removeEventListener("keydown",this.handleWindowKeyDown,!0),window.removeEventListener("mousedown",this.handleWindowMouseDown,!0),window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("touchstart",this.handleClose,!0),window.removeEventListener("orientationchange",this.handleOrientationchange),window.removeEventListener("wheel",this.handleWheel,!0),window.visualViewport&&window.visualViewport.removeEventListener("resize",this.handleWindowResize),this.observer&&(this.observer.disconnect(),this.observer=null)}},{key:"getAnimationOrigin",value:function(e){var t=this.refPanel.current;return t?(this.origin||(this.origin=function(e,t,n){var i=void 0;i=window.rightToLeft?document.body.clientWidth-e.right-t.offsetWidth/2:e.left+t.offsetWidth/2;var o=e.top+(e.height||t.offsetHeight)/2;return(i>=n.left+n.width/2?"right":"left")+"-"+(o>=n.top+n.height/2?"bottom":"top")}(e,t,this.props.rect)),this.origin):""}},{key:"createStyle",value:function(e){var t,n=(t={visibility:this.state.visible?"":"hidden"},w()(t,window.rightToLeft?"right":"left",0),w()(t,"top",0),t),i=this.props,o=i.placement,r=i.rect,a=i.distance,s=i.isAuto,l=i.triggerElement;if(l){var c=l.getBoundingClientRect(),u=c.top,d=c.bottom;r=Object.assign({},r,{top:u,bottom:d})}var m=P(o,e,r,a);return s&&(m=function(e,t){var n=e.left,i=e.right,o=e.top,r=t.offsetWidth,a=t.offsetHeight,s=document.body,l=s.clientWidth,c=s.clientHeight;return window.rightToLeft?(i+r+4>l&&(i=l-r-4),i=Math.max(4,i)):(n+r+4>l&&(n=l-r-4),n=Math.max(4,n)),o+a+4>c&&(o=c-a-4),o=Math.max(4,o),window.rightToLeft?{right:i,top:o}:{left:n,top:o}}(m,e)),Object.assign(n,m),n}},{key:"getPanelStyle",value:function(){var e=this.state.visible,t=this.refPanel.current;if(!t){var n,i=(n={visibility:e?"":"hidden"},w()(n,window.rightToLeft?"right":"left",0),w()(n,"top",0),n);return this.maxHeight=this.createStyle(document.body).height,i.maxHeight=this.maxHeight,i}var o=this.props,r=o.distance,a=o.isSetHeight;if(o.forceUpdate||!this.style){this.style=this.createStyle(t),a&&(this.style.height=function(e,t,n){var i=document.body.clientHeight,o=i-e-n;return e<0&&(o=i-2*n),t.offsetHeight<o?void 0:o}(this.style.top,t,r));var s=t.getBoundingClientRect().height;Math.abs(s-this.maxHeight)<2&&(this.style.height=this.maxHeight)}return this.style}},{key:"calcTransparentPlaceholder",value:function(e){if(0===this.props.offsetX)return null;var t={left:/left/.test(e)?"auto":"-"+this.props.offsetX+"px",right:/right/.test(e)?"auto":"-"+this.props.offsetX+"px"};return m.a.createElement("div",{className:"transparent-placeholder",style:t})}},{key:"getLevel",value:function(){return this.level}},{key:"render",value:function(){void 0===this.level&&(this.level=T.a(this.props.triggerElement)+1,this.showAnimation=!1);var e=this.props,t=e.children,n=e.onMouseEnter,i=e.onMouseLeave,o=e.className,r=this.state.visible,a=null;"function"==typeof t.type&&(a={isListenEvent:r});var s=m.a.cloneElement(t,a),l=this.getPanelStyle(),c=this.getAnimationOrigin(l),u=this.calcTransparentPlaceholder(c),d=T.c;return r&&(this.showAnimation&&(d+=" animation-fade-scaleY-in"),d+=" origin-"+c,o&&(d+=" "+o)),m.a.createElement("div",{ref:this.refPanel,className:d,style:l,"data-level":this.level,onMouseEnter:n,onMouseLeave:i},u,s)}}]),t}(d.PureComponent);N.placementTypes=b,N.defaultProps={placement:b.bottomLeft,distance:0,offsetX:0,isSetHeight:!1,forceUpdate:!1,autoClose:!0};var I=N,k=n(362),D={click:"click",hover:"hover"},S=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.btnDom=null,n.delayCloseTimer=null,n.checkMouseEvent=function(){return n.props.mustHover?n.props.trigger===D.hover:n.props.trigger===D.hover&&!f.isTouchScreen},n.refDropDown=m.a.createRef(),n.handleMouseEnter=n.handleMouseEnter.bind(n),n.handleMouseLeave=n.handleMouseLeave.bind(n),n.handleClick=n.handleClick.bind(n),n.handleContentClose=n.handleContentClose.bind(n),n.handleContentMouseEnter=n.handleContentMouseEnter.bind(n),n.handleContentMouseLeave=n.handleContentMouseLeave.bind(n),n}return u()(t,e),a()(t,[{key:"componentDidMount",value:function(){this.initBtnDOM(),this.props.visible&&this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.clearDelayClose()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,i=n.visible,o=n.destroyOnHide;!i&&e.visible&&!o&&void 0!==o&&this.refDropDown.current&&(1===this.refDropDown.current.getLevel()&&v.default.dispatchEvent(v.default.names.CLOSE_DROPDOWN_PANEL,{isCloseSub:!0}))}},{key:"initBtnDOM",value:function(){var e=this.props.getElement;this.btnDom=e?e():null,this.btnDom=this.btnDom||h.a.findDOMNode(this)}},{key:"getRect",value:function(){if(!this.btnDom)return null;var e=this.props.offsetX,t=this.btnDom.getBoundingClientRect(),n={bottom:t.bottom,height:t.height,left:t.left,right:t.right,top:t.top,width:t.width};return e&&(n.left-=e,n.right+=e,n.width+=2*e),n}},{key:"handleTrigger",value:function(e){this.clearDelayClose(),e&&this.initBtnDOM(),this.props.onVisibleChange(e)}},{key:"handleClick",value:function(e){var t=this.props,n=t.visible,i=t.onClick,o=t.trigger;i?i(e):o===D.hover&&!f.isTouchScreen&&(e.clientX>0||e.clientY>0)||this.handleTrigger(!n)}},{key:"startDelayClose",value:function(){var e=this;this.clearDelayClose(),this.delayCloseTimer=setTimeout((function(){e.props.onVisibleChange(!1)}),200)}},{key:"clearDelayClose",value:function(){clearTimeout(this.delayCloseTimer)}},{key:"handleMouseEnter",value:function(){var e=this.props,t=e.visible,n=e.onMouseEnter;this.checkMouseEvent()&&(this.clearDelayClose(),t||this.handleTrigger(!0)),n&&n()}},{key:"handleMouseLeave",value:function(e){this.props.visible&&this.checkMouseEvent()&&this.startDelayClose(),this.props.onMouseLeaveDropBtn&&this.props.onMouseLeaveDropBtn()}},{key:"handleContentMouseEnter",value:function(){this.checkMouseEvent()&&this.clearDelayClose()}},{key:"handleContentMouseLeave",value:function(e){if(!this.props.disableContentMouseLeave&&this.checkMouseEvent()){var t=document.getElementsByClassName("wowui-tooltip-content")[0]||document.getElementsByClassName("component-tooltip-content")[0]||document.getElementsByClassName("kd-tooltip-content")[0];if(t){var n=t.getBoundingClientRect(),i=n.left,o=n.right,r=n.top,a=n.bottom,s=e.pageX,l=e.pageY;if(s>=i&&s<=o&&l>=r&&l<=a)return}this.startDelayClose()}}},{key:"handleContentClose",value:function(){this.clearDelayClose(),this.props.onVisibleChange(!1)}},{key:"renderContent",value:function(){var e=this.getRect(),t=this.props,n=t.isSetHeight,i=t.panel,o=t.visible,r=t.placement,a=t.distance,s=t.panelClass,l=t.isAuto,c=t.offsetX,u=t.autoClose;return m.a.createElement(I,{ref:this.refDropDown,isAuto:l,className:s,triggerElement:this.btnDom,rect:e,offsetX:c,visible:o,placement:r,distance:a,isSetHeight:n,onClose:this.handleContentClose,autoClose:u,onMouseEnter:this.handleContentMouseEnter,onMouseLeave:this.handleContentMouseLeave},i)}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.children,i=e.visible,o=e.destroyOnHide;t=t||n.props.disabled;var r=this.getRect();if(!t){var a=n.props.title;a&&i&&(a=null),n=m.a.cloneElement(n,{title:a,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick})}return m.a.createElement(m.a.Fragment,null,n,!!r&&m.a.createElement(g.a,{visible:i,destroyOnHide:o},this.renderContent()))}}]),t}(d.PureComponent);S.placementTypes=I.placementTypes,S.DropdownPanel=k.default,S.triggerTypes=D,S.defaultProps={visible:!1,trigger:D.click,distance:4,offsetX:0,autoClose:!0};t.default=S},324:function(e,t,n){"use strict";n.d(t,"x",(function(){return i})),n.d(t,"z",(function(){return o})),n.d(t,"j",(function(){return r})),n.d(t,"l",(function(){return a})),n.d(t,"m",(function(){return s})),n.d(t,"k",(function(){return l})),n.d(t,"i",(function(){return c})),n.d(t,"q",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"f",(function(){return m})),n.d(t,"g",(function(){return p})),n.d(t,"B",(function(){return h})),n.d(t,"A",(function(){return f})),n.d(t,"n",(function(){return v})),n.d(t,"p",(function(){return g})),n.d(t,"o",(function(){return E})),n.d(t,"C",(function(){return w})),n.d(t,"h",(function(){return C})),n.d(t,"d",(function(){return y})),n.d(t,"e",(function(){return b})),n.d(t,"t",(function(){return T})),n.d(t,"s",(function(){return _})),n.d(t,"r",(function(){return O})),n.d(t,"D",(function(){return P})),n.d(t,"w",(function(){return N})),n.d(t,"b",(function(){return I})),n.d(t,"c",(function(){return k})),n.d(t,"y",(function(){return D})),n.d(t,"v",(function(){return S})),n.d(t,"u",(function(){return A})),n.d(t,"E",(function(){return M}));var i=0,o=10,r=11,a=13,s=12,l=15,c=14,u=2,d=5,m=8,p=1,h=9,f=32,v=19,g=20,E=21,w=40,C=7,y=3,b=4,T=26,_=27,O=12288,P=0,N=160,I=60,k=62,D=31,S=8203,A=8205,M=42},329:function(e,t,n){"use strict";n.r(t),n.d(t,"iDefault",(function(){return o})),n.d(t,"smallSize",(function(){return i})),n.d(t,"defaultFill",(function(){return u})),n.d(t,"iGreen",(function(){return r})),n.d(t,"iRed",(function(){return a})),n.d(t,"iPurple",(function(){return l})),n.d(t,"iBlue",(function(){return s})),n.d(t,"iGrey",(function(){return c}));var i=16,o="#333333",r="#00A147",a="#F05B13",s="#0A6CFF",l="#D6DDF5",c="#757575",u=[o,s]},344:function(e,t,n){"use strict";n.r(t);var i=n(238),o=n.n(i),r=n(239);t.default=Object(r.a)("symbol_cross_two",!1,(function(e){return o.a.createElement("svg",{width:e.size,height:e.size,viewBox:"0 0 16 16",fill:"none",strokeWidth:e.strokeWidth},o.a.createElement("g",{id:"group-0",stroke:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#757575",fill:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#757575"},o.a.createElement("path",{d:"M3 13L13 3M3 3L13 13",strokeLinecap:e.strokeLinecap,strokeLinejoin:e.strokeLinejoin,fill:"none",vectorEffect:"non-scaling-stroke"})))}))},3483:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventType=void 0,function(e){e.ShowCommentItemAfterJump="ShowCommentItemAfterJump",e.ShowCommentItemAfterFindLocate="ShowCommentItemAfterFindLocate"}(t.EventType||(t.EventType={}))},362:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=(n(501),n(238)),m=n.n(d),p=n(167),h=n(227),f=n(240),v=n(248),g=n(467),E=n(491),w=n(246),C="right",y="down",b="rightDown",T=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={width:null,height:null,minWidth:null,minHeight:null},n.timer=null,n.scrollSelectedChildren=function(){for(var e=n.refContent.current,t=function(t){var i=e.children[t];if(i.classList.contains("selected"))return n.timer=setTimeout((function(){i.scrollIntoViewIfNeeded(),clearTimeout(n.timer),window.__WPSENV__.altStatus&&window.postMessage(JSON.stringify({eventName:"alt_web_access",cmd:"refresh"}))}),500),"break"},i=0;i<e.childElementCount;i++){if("break"===t(i))break}},n.handleScroll=function(){var e=n.props,t=e.scrollEndBottom,i=e.onScroll;if(i){var o=n.refPanel.current,r=o.scrollTop;r+o.clientHeight+t>=o.scrollHeight&&i({scrollTop:r})}},n.scrollToTop=function(){n.refPanel.current.scrollTop=0},n.scrollToView=function(e){e.scrollIntoViewIfNeeded()},n.selectFirstItem=function(){var e=n.getHoverItem();e&&e.classList.remove("hover");var t=n.refPanel.current.getElementsByClassName("panel-item");t[0].classList.add("hover"),n.scrollToTop(),n.showPreSelectItem(t[0])},n.refPanel=m.a.createRef(),n.refContent=m.a.createRef(),n.handleDragMouseDown=n.handleDragMouseDown.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOver=n.handleMouseOver.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n.handleWindowKeyDown=n.handleWindowKeyDown.bind(n),n.officeType=Object(f.getPageOfficeType)(),n}return u()(t,e),a()(t,[{key:"componentDidMount",value:function(){if(this.props.isListenEvent&&this.bindEvents(),this.props.canResize){var e=this.refPanel.current,t=e.offsetWidth,n=e.offsetHeight;this.setState({width:t,height:n,minWidth:t,minHeight:n})}this.scrollSelectedChildren()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.isListenEvent,i=t.visible;n!==e.isListenEvent&&(n?this.bindEvents():this.unbindEvents()),i!==e.visible&&i&&this.scrollSelectedChildren()}},{key:"componentWillUnmount",value:function(){this.unbindEvents()}},{key:"bindEvents",value:function(){window.addEventListener("keydown",this.handleWindowKeyDown,!0)}},{key:"unbindEvents",value:function(){clearTimeout(this.timer),window.removeEventListener("keydown",this.handleWindowKeyDown,!0)}},{key:"handleMouseOver",value:function(){p.isTouchScreen||this.bindEvents()}},{key:"handleMouseOut",value:function(e){p.isTouchScreen||(this.props.isListenEvent||this.unbindEvents(),this.handleMouseMove(e),this.props.onMouseOut&&this.props.onMouseOut())}},{key:"handleMouseMove",value:function(e){if(this.props.onItemHover&&!p.isTouchScreen){var t=this.getHoverItem();this.props.onItemHover(t,!0)}window.__WPSENV__.altStatus&&h.default.dispatchEvent(h.default.names.EXIT_ALT_MODE,e)}},{key:"handleDragMouseDown",value:function(e){var t=this,n=document.activeElement;Object(f.stopBubble)(e);var i=e.clientX,o=e.clientY,r=e.target,a=e.currentTarget.getAttribute("data-orien");r.setCapture&&r.setCapture();var s=this.state,l=s.width,c=s.height,u=s.minWidth,d=s.minHeight;document.onmousemove=function(e){Object(f.stopBubble)(e);var n=e.clientX,r=e.clientY,s=Math.max(u,l+n-i),m=Math.max(d,c+r-o);a===C?m=c:a===y&&(s=l),t.setState({width:s,height:m},(function(){h.default.dispatchEvent(h.default.names.FREE_SCROLL_BAR_RESIZE,{target:t.refPanel.current})}))},document.onmouseup=function(e){Object(f.stopBubble)(e),document.onmousemove=null,document.onmouseup=null,r.releaseCapture&&r.releaseCapture(),n.focus()}}},{key:"handleWindowKeyDown",value:function(e){if(this.props.enabledHotKey){var t=document.activeElement,n=t.tagName;if((!("TEXTAREA"===n||"INPUT"===n||"true"===t.contentEditable)||t.hasAttribute("data-keep-wsad"))&&!window.__WPSENV__.altStatus){var i=Object(w.getKey)(e);switch(i){case w.Keys.Enter:var o=this.getHoverItem();o&&(Object(f.stopBubble)(e),o.click());break;case w.Keys.ArrowUp:case w.Keys.ArrowDown:var r=i===w.Keys.ArrowUp;this.setPreSelectItem(r,e),this.props.isPreSelectCloseDropdown&&h.default.dispatchEvent(h.default.names.CLOSE_DROPDOWN_PANEL)}}}}},{key:"getHoverItem",value:function(){return this.refPanel.current.getElementsByClassName("hover")[0]}},{key:"setPreSelectItem",value:function(e,t){var n=this.refPanel.current.getElementsByClassName("panel-item");if(n.length){Object(f.stopBubble)(t);var i=this.getHoverItem();i&&i.classList.remove("hover");var o=this.getPreSelectItem(e,n,i);o.classList.add("hover"),this.showPreSelectItem(o)}}},{key:"getPreSelectItem",value:function(e,t,n){for(var i=-1,o=0;o<t.length;o++)if(t[o]===n){i=o;break}if(e){for(var r=i-1;r>=0;r--)if(-1===t[r].className.indexOf("disabled")){i=r;break}}else for(var a=i+1;a<t.length;a++)if(-1===t[a].className.indexOf("disabled")){i=a;break}return t[Math.max(0,i)]}},{key:"showPreSelectItem",value:function(e){e.scrollIntoViewIfNeeded(),this.props.onItemHover&&this.props.onItemHover(e,!1)}},{key:"getElement",value:function(){return this.refPanel.current}},{key:"getContentElement",value:function(){return this.refContent.current}},{key:"getPanelStyle",value:function(){if(this.props.canResize){var e=this.state;return{width:e.width,height:e.height}}var t=this.props,n=t.width,i=t.minWidth,o=t.maxWidth;if(n||i||o)return{width:n,minWidth:i,maxWidth:o}}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.children,i=e.canResize,o=e.isAuto,r=e.selectable,a=e.altStartMode,s="wo-dropdown-panel";o&&(s+=" "+this.officeType),i&&(s+=" can-resize"),t&&(s+=" "+t),r&&(s+=" wo-dropdown-panel-selectable");var l=this.getPanelStyle();return m.a.createElement("div",{ref:this.refPanel,className:s,style:l,tabIndex:0,"alt-start-mode":a,onKeyDown:this.handleWindowKeyDown,onMouseMove:this.handleMouseMove,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onScroll:this.handleScroll,"data-keep-edit":!0,role:"listbox"},m.a.createElement("div",{ref:this.refContent,className:"dropdown-panel-content","data-keep-edit":!0},n),m.a.createElement("div",{className:"drag-hand rightBottom","data-orien":b,onMouseDown:this.handleDragMouseDown},m.a.createElement(v.default,{type:v.default.types.other.drag_right_bottom})),m.a.createElement("div",{className:"drag-hand right","data-orien":C,onMouseDown:this.handleDragMouseDown}),m.a.createElement("div",{className:"drag-hand bottom","data-orien":y,onMouseDown:this.handleDragMouseDown}))}}]),t}(d.PureComponent);T.Item=g.a,T.Divider=E.a,T.defaultProps={isAuto:!0,scrollEndBottom:10,enabledHotKey:!0},t.default=T},372:function(e,t,n){"use strict";var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=n(238),m=n(244),p=n.n(m),h=function(e){function t(){var e,n,i,r;o()(this,t);for(var a=arguments.length,s=Array(a),c=0;c<a;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.popup=null,i.container=null,r=n,l()(i,r)}return u()(t,e),a()(t,[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.visible,n=e.destroyOnHide;this.popup&&!t&&n&&this.unmountPopoup()}},{key:"componentWillUnmount",value:function(){this.unmountPopoup()}},{key:"getPopup",value:function(){if(this.popup)this.props.getContainer&&(this.container=this.props.getContainer(),this.container.contains(this.popup)||this.container&&this.container.appendChild(this.popup));else{this.popup=document.createElement("div"),this.popup.style.position="absolute",this.popup.style.left=0,this.popup.style.top=0,this.popup.style.zIndex=1e3;var e="component-popup",t=this.props.className;t&&(e+=" "+t),this.popup.className=e,this.popup.id="util-popup",this.container=document.body,this.props.getContainer&&(this.container=this.props.getContainer(),this.popup.style.right=0,this.popup.style.bottom=0),this.props.fullViewport&&this.popup.setAttribute("data-fullviewport","true"),this.container&&this.container.appendChild(this.popup)}return this.props.fullViewport&&this.popup.setAttribute("data-fullviewport","true"),this.popup}},{key:"unmountPopoup",value:function(){this.popup&&(this.container&&this.container.removeChild(this.popup),this.popup=null)}},{key:"componentDidCatch",value:function(e,t){if("s"===window.officeType)try{if(e&&t){if(-1===e.stack.indexOf("cross-origin"))return;window.badJsFunc(!1,{error:new Error("Plugin Center et react debugger. [stack]: "+t.componentStack)})}}catch(e){window.badJsFunc(!1,{error:new Error("Plugin Center et react ã€PopUpã€‘")})}}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.visible,i=e.destroyOnHide;if(!t||!n&&!this.popup)return!1;if(!n&&i)return!1;var o=this.getPopup();return o.style.display=n?"":"none",p.a.createPortal(t,o)}}]),t}(d.PureComponent);h.defaultProps={destroyOnHide:!0,fullViewport:!0},t.a=h},375:function(e,t,n){"use strict";n.r(t);var i=n(238),o=n.n(i),r=n(239);t.default=Object(r.a)("symbol_tick",!1,(function(e){return o.a.createElement("svg",{width:e.size,height:e.size,viewBox:"0 0 16 16",fill:"none",strokeWidth:e.strokeWidth},o.a.createElement("g",{id:"group-0",stroke:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333",fill:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333"},o.a.createElement("path",{d:"M2.5 7.38775L6.68824 11.2933C6.81053 11.401 6.99639 11.3913 7.10689 11.2716L13.4215 4.5",strokeLinecap:e.strokeLinecap,strokeLinejoin:e.strokeLinejoin,fill:"none",vectorEffect:"non-scaling-stroke"})))}))},3787:function(e,t,n){"use strict";n.d(t,"b",(function(){return w}));var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=n(238),m=n.n(d),p=n(315),h=n(1152),f=n(2488),v=n(1276),g=window.__WPSPLUGIN__,E=window.__WPSPLUGIN__.helper;function w(){return E.has(window.__WPSPLUGIN__.type.ShareFile)}var C=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClick=n.handleClick.bind(n),n}return u()(t,e),a()(t,[{key:"handleClick",value:function(){var e=this.props.onClose,t=window.APP.data.selection.getNormalRange(),n={type:v.default.Bookmark,data:{range:t}};console.log("[æ’å…¥ä¹¦ç­¾ä¿¡æ¯]",n);var i=window.APP.workspace.bookmarksManager.getBookmarks().find((function(e){var n=window.APP.data.doc.datalogics.final.getText(t.pos,t.len),i=window.APP.data.doc.datalogics.final.getText(e.pos,e.len);return e.pos===t.pos&&n.replace(/^\s*|\s*$/g,"")==i.replace(/^\s*|\s*$/g,"")})),o=i?i.name:"sharePos:"+Date.now();i||window.APP.workspace.bookmarksManager.insertBookmark(o),g.loader.loadSingleInstance({pluginType:g.helper.types.ShareFile}).then((function(e){var t=window.fileInfo,n={fid:t.id,source:"weboffice",fname:t.name+t.ext,currentTimeStamp:(new Date).getTime(),linkname:encodeURIComponent(o)};e.shareFile(n)})),e(),window.collection("commandbar","click","contextmenu_InsertBookmark")}},{key:"render",value:function(){var e=this.props.connected;return m.a.createElement(p.default,{value:f.a.INSERT_LINK,onClick:this.handleClick,title:_i18n("applications.writer.components.CommandBars.ContextMenu.Text.insertBookmark", "Share Link Directed to This Location"),disabled:!e},m.a.createElement(h.default,{size:16,className:"item-icon"}),m.a.createElement("span",{className:"item-text"},_i18n("applications.writer.components.CommandBars.ContextMenu.Text.insertBookmark", "Share Link Directed to This Location")))}}]),t}(d.PureComponent);t.a=C},385:function(e,t,n){"use strict";n.r(t);var i=n(24),o=n.n(i),r=n(1),a=n.n(r),s=n(2),l=n.n(s),c=n(22),u=n.n(c),d=n(23),m=n.n(d),p=n(238),h=n.n(p),f=n(240),v=n(252),g=n.n(v),E=function(e){function t(e){a()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.refDiv=h.a.createRef(),n.handleClick=n.handleClick.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n.handleMouseLeave=n.handleMouseLeave.bind(n),n}return m()(t,e),l()(t,[{key:"handleClick",value:function(e){this.props.onClick&&!this.props.disabled&&this.props.onClick(this.props.value,e)}},{key:"handleMouseMove",value:function(){for(var e=this.refDiv.current,t=e.parentNode.getElementsByClassName("hover"),n=0;n<t.length;n++){var i=t[n];if(i!==e){i.classList.remove("hover");break}}e.classList.add("hover")}},{key:"handleMouseOut",value:function(e){Object(f.isMouseInElement)(e,this.refDiv.current)||this.refDiv.current.classList.remove("hover")}},{key:"handleMouseLeave",value:function(){this.props.useMouseLeaveHover&&this.refDiv.current.classList.remove("hover")}},{key:"getClassName",value:function(){var e=this.props,t=e.selected,n=e.disabled,i=e.disabledTag,r=e.children,a=e.className,s="component-menu-item",l=this.refDiv.current;l&&-1!==l.className.indexOf(" hover")&&(s+=" hover"),t&&(s+=" selected"),n&&(s+=" disabled"),i&&(s+=" disabled-tag"),a&&(s+=" "+a);var c=void 0===r?"undefined":o()(r);return"string"!==c&&"number"!==c||(s+=" only-text"),a&&(s+=" "+a),s}},{key:"getElement",value:function(){return this.refDiv.current}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.children,i=e.keepEdit,o=e.dataKey,r=e.title,a=e.placement,s=e.draggable,l=e.onDragStart,c=e.onDragEnd,u=e.altHintKeep,d=e.altRenderDelay,m=e.altForceDirection,p=e.altRole,f=e.altCustom,v=e.padMustShowTooltip,E=this.getClassName();return h.a.createElement(g.a,{title:r,placement:a,padMustShow:v},h.a.createElement("div",{ref:this.refDiv,id:t,className:E,role:p,"alt-hint-keep":u,"alt-render-delay":d,"alt-force-direction":m,"alt-custom":f,"data-keep-edit":i||void 0,"data-key":o||void 0,draggable:s,onClick:this.handleClick,onMouseMove:this.handleMouseMove,onMouseOut:this.handleMouseOut,onMouseLeave:this.handleMouseLeave,onDragStart:l,onDragEnd:c},n))}}]),t}(p.PureComponent);E.defaultProps={altRole:"option",padMustShowTooltip:!1},t.default=E},3952:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.observeDom=t.getRangeStr=t.sortByFirstLetter=t.filterRevisionCommentData=t.getOnlineAllCommentAppointors=t.isFilterSelected=t.getDefaultFilters=t.FilterStatusTypes=t.FilterCommentTypes=t.FilterPersons=t.setInitSelectorPerson=t.setPersonsAppointor=t.setAsyncAllCommentAppointors=t.getAllCommentAppointors=void 0;var i=n(5),o=n(313),r=n(966),a=n(1290),s=n(1146),l=i.__importDefault(n(238)),c=[];t.getAllCommentAppointors=function(){return c};var u=function(e){return c=function(e){if(!e.length)return e;var t=i.__spreadArray([],e,!0),n=[],o=t.findIndex((function(e){return e.id==window.APP.info.userid}));o>-1&&(n.push(e[o]),t.splice(o,1));return n.concat(p(t,"name"))}(e)};t.setAsyncAllCommentAppointors=function(){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(t){switch(t.label){case 0:return e=u,[4,m()];case 1:return e.apply(void 0,[t.sent()]),[2]}}))}))};var d={id:3,value:[],name:_i18n("applications.writer.components.Common.Comments.Selector.appointorPerson", "View Specified Person Related Only")};t.setPersonsAppointor=function(e){d.value=e||[]},t.setInitSelectorPerson=function(e){return e instanceof Array&&(0,t.setPersonsAppointor)(e),e},t.FilterPersons=[{id:1,value:"all",name:_i18n("applications.writer.components.Common.Comments.Selector.allPerson", "All")},{id:2,value:"self",name:_i18n("applications.writer.components.Common.Comments.Selector.selfPerson", "only see related to me")},d],t.FilterCommentTypes=[{id:1,value:"all",name:_i18n("applications.writer.components.Common.Comments.Selector.all", "All")},{id:2,value:"comment",name:_i18n("applications.writer.components.Common.Comments.Selector.comment", "Comment")},{id:3,value:"revision",name:_i18n("applications.writer.components.Common.Comments.Selector.revision", "revising")}],t.FilterStatusTypes=[{id:1,value:"all",name:_i18n("applications.writer.components.Common.Comments.Selector.all", "All")},{id:2,value:"unresolved",name:_i18n("applications.writer.components.Common.Comments.Selector.unresolved", "To Be Solved")},{id:3,value:"resolved",name:_i18n("applications.writer.components.Common.Comments.Selector.resolved", "solved")}];t.getDefaultFilters=function(){return(0,t.setPersonsAppointor)(),{selectorPerson:"all",selectorType:"all",selectorStatus:"all"}};function m(){return i.__awaiter(this,void 0,Promise,(function(){var e,t,n,r;return i.__generator(this,(function(i){switch(i.label){case 0:return(e=window.APP.data)&&e.doc?(t=[],(n=new Set).add(window.fileInfo.creator.id).add(window.APP.info.userid),e.doc.comments.collectComments(0,e.doc.getSubDocRange(0).len).forEach((function(e){(e.content&&e.relatedUserIds||[]).forEach((function(e){return n.add(e)}))})),[4,window.__WPSENV__.reduxDispatch((0,o.loadMembers)(Array.from(n),!0))]):[2,[]];case 1:return(r=i.sent())&&r.response&&r.response.body&&r.response.body.forEach((function(e){var n=e.id,i=e.name,o=e.avatar;t.push({id:n,name:i,avatar_url:o})})),[2,t]}}))}))}function p(e,t){if(!e||!e.length||"string"!=typeof e[0][t])return e;var n=i.__spreadArray([],e,!0);return n.sort((function(e,n){return e[t].localeCompare(n[t])})),n}t.isFilterSelected=function(e){var t=!0,n=e.selectorPerson,i=e.selectorType,o=e.selectorStatus;return t&&n&&(t="all"===n),t&&i&&(t="all"===i),t&&o&&(t="all"===o),!t},t.getOnlineAllCommentAppointors=m,t.filterRevisionCommentData=function(e,t){if(!e||!e.length)return[];var n=e.reduce((function(e,t){if(t.type===r.CR_TYPE.comments){var n=(t.data||[]).filter((function(e){return!(0,s.isRefusalToAppeal)(e.comment_id)}));(t.data&&t.data[0]?(0,s.isRefusalToAppeal)(t.data[0].comment_id):0===n.length)||e.push(i.__assign(i.__assign({},t),{data:n}))}else e.push(i.__assign({},t));return e}),[]),o=t.selectorPerson,a=t.selectorType,l=t.selectorStatus,c=i.__spreadArray([],n,!0).filter((function(e){var t=[!0,!0,!0],n=t[0],i=t[1],s=t[2];if(a)switch(a){case"comment":i=e.type===r.CR_TYPE.comments;break;case"revision":i=e.type!==r.CR_TYPE.comments}if(l&&e.type===r.CR_TYPE.comments)switch(e.hasOwnProperty("isDone")||(e.isDone=e.data.every((function(e){return e.isDone}))),l){case"unresolved":s=!e.isDone;break;case"resolved":s=!!e.isDone}return o&&(n=function(e,t){var n=!0,i=new Set;switch(t){case"all":return n;case"self":i.add(window.APP.info.userid);break;default:if(t instanceof Array){if(!t.length)return n;t.forEach((function(e){return i.add(e.id)}))}}if(n=!1,e.type===r.CR_TYPE.comments)for(var o=e.data.length,a=0;a<o;a++){if((e.data[a].relatedUserIds||[]).some((function(e){return i.has(e)}))){n=!0;break}}else{var s=e.userID;s&&i.has(s)&&(n=!0)}return n}(e,o)),n&&i&&s}));return i.__spreadArray([],c,!0)},t.sortByFirstLetter=p,t.getRangeStr=function(e){var t,n=((t={})[a.NODETYPE.MENTION]=a.getMentions,t[a.NODETYPE.PICTURE]=a.getPictures,t[a.NODETYPE.HYPERLINK]=a.getHyperlinks,t[a.NODETYPE.CATALOG]=a.getCatalogs,t),i=[];return(0,a.handleTypes)(n,e,null).forEach((function(e){var t=e._nType,n=e.text;switch(t){case a.NODETYPE.TEXT:case a.NODETYPE.MENTION:case a.NODETYPE.HYPERLINK:i.push(n);break;case a.NODETYPE.PICTURE:i.push(l.default.createElement("span",{className:"placeholder"},"[".concat(_i18n("applications.writer.components.Common.Comments.Common.picture", "Picture"),"]")));break;case a.NODETYPE.CATALOG:i.push("<".concat(_i18n("applications.writer.components.Common.Comments.Common.catalog", "Contents"),">"))}})),i},t.observeDom=function(e,t,n){if(!e)return null;var i={offsetHeight:0,offsetWidth:0,offsetTop:0},o=n&&n.observeAttrs||["offsetHeight","offsetTop"],r=function(){if(e){var n=e.offsetHeight,r=e.offsetWidth,a=e.offsetTop,s={offsetHeight:n,offsetWidth:r,offsetTop:a};n===i.offsetHeight&&r===i.offsetWidth&&a===i.offsetTop||(o.some((function(e){return i[e]!==s[e]}))&&t&&t(i),i.offsetHeight=n,i.offsetWidth=r,i.offsetTop=a)}};if(void 0===window.ResizeObserver||o.includes("offsetTop")){if("undefined"!=typeof MutationObserver){var a=new MutationObserver(r);return a.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),{disconnect:function(){return a.disconnect()}}}return null}var s=new window.ResizeObserver(r);return s.observe(e),{disconnect:function(){return s.disconnect()}}}},450:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s}));var i="component-dropdown-popup",o=function(e){return parseInt(e.getAttribute("data-level"))},r=function(e){for(;e!==document.body;){var t=getComputedStyle(e);if("none"===t.display||"hidden"===t.visibility)return!1;e=e.parentNode}return!0},a=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&e!==document.body;){if(e.classList)for(var t=0;t<e.classList.length;t++)if(e.classList[t]===i)return o(e);e=e.parentNode}return 0},s=function(e){for(var t=document.getElementsByClassName(i),n=0;n<t.length;n++)if(r(t[n])&&o(t[n])===e)return!0;return!1}},467:function(e,t,n){"use strict";var i=n(13),o=n.n(i),r=n(24),a=n.n(r),s=n(1),l=n.n(s),c=n(2),u=n.n(c),d=n(22),m=n.n(d),p=n(23),h=n.n(p),f=n(238),v=n.n(f),g=n(240),E=n(252),w=n.n(E),C=n(375),y=function(e){function t(e){l()(this,t);var n=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isHover:!1},n.refDiv=v.a.createRef(),n.handleClick=n.handleClick.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n}return h()(t,e),u()(t,[{key:"handleClick",value:function(e){this.props.onClick&&this.props.onClick(this.props.value,e)}},{key:"handleMouseMove",value:function(){for(var e=this.refDiv.current,t=e.parentNode.getElementsByClassName("hover"),n=0;n<t.length;n++)if(t[n]!==e){t[n].classList.remove("hover");break}e.classList.add("hover")}},{key:"handleMouseOut",value:function(e){Object(g.isMouseInElement)(e,this.refDiv.current)||this.refDiv.current.classList.remove("hover")}},{key:"getElement",value:function(){return this.refDiv.current}},{key:"getClassName",value:function(){var e=this.props,t=e.disabled,n=e.selected,i=e.className,o=e.children,r="panel-item",s=this.refDiv.current;s&&-1!==s.className.indexOf(" hover")&&(r+=" hover"),t&&(r+=" disabled"),n&&(r+=" selected");var l=void 0===o?"undefined":a()(o);return"string"!==l&&"number"!==l||(r+=" only-text"),i&&(r+=" "+i),r}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.title,i=e.value,r=e.children,a=e.getStyle,s=e.visible,l=e.dataKey,c=e.keepEdit,u=e.draggable,d=e.selected,m=e.onMouseEnter,p=e.onMouseLeave,h=e.onDragEnter,f=e.onDragStart,g=e.onDragEnd,E=e.altHintKeep,y=e.altRole;if(!s)return!1;var b=this.getClassName(),T=a?a(i):null,_={};return m&&(_.onMouseEnter=m),p&&(_.onMouseLeave=p),v.a.createElement(w.a,o()({title:n},_),v.a.createElement("div",o()({ref:this.refDiv,id:t,className:b,style:T,role:y,"data-key":l||void 0,"data-keep-edit":c||void 0,"alt-hint-keep":E,draggable:u,onClick:this.handleClick,onMouseMove:this.handleMouseMove,onMouseOut:this.handleMouseOut,onDragStart:f,onDragEnter:h,onDragEnd:g},_),r,d&&v.a.createElement(C.default,{size:16,className:"panel-item-tick",strokeWidth:2,fill:"var(--kd-color-icon-public)"})))}}]),t}(f.PureComponent);y.defaultProps={visible:!0,altRole:"option"},t.a=y},472:function(e,t,n){"use strict";n.r(t),n.d(t,"base64ToArrayBuffer",(function(){return i})),n.d(t,"formatDecimal",(function(){return o})),n.d(t,"filterValid",(function(){return r})),n.d(t,"getStrLength",(function(){return a})),n.d(t,"isHighSurrogate",(function(){return s})),n.d(t,"isLowSurrogate",(function(){return l})),n.d(t,"isSurrogate",(function(){return c})),n.d(t,"replaceEmoji",(function(){return u})),n.d(t,"hasEmoji",(function(){return d}));var i=function(e){for(var t=window.atob(e),n=t.length,i=new Uint8Array(n),o=0;o<n;o++)i[o]=t.charCodeAt(o);return i.buffer},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(""===e)return e;var n=(e=e.toString()).indexOf(".");return n>-1&&e.length-n-1>t&&(e=Math.round(e*Math.pow(10,t))/Math.pow(10,t)),e.toString()},r=function(e){var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~ï¼@#ï¿¥â€¦â€¦&*ï¼ˆï¼‰â€”â€”|{}ã€ã€‘â€˜ï¼›ï¼šâ€â€œ'ã€‚ï¼Œã€ï¼Ÿ]","g");return e.replace(t,"")},a=function(e){for(var t=e.length,n=0,i=0;i<t;i++)0!=(65280&e.charCodeAt(i))&&n++,n++;return n},s=function(e){return e>=55296&&e<=56319},l=function(e){return e>=56320&&e<=57343},c=function(e){return e>=55296&&e<=57343};function u(e){return e.replace(/(?:[\xA9\xAE\u2122\u23E9-\u23EF\u23F3\u23F8-\u23FA\u24C2\u25B6\u2600-\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDE51\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F\uDE80-\uDEFF]|\uD83E[\uDD00-\uDDFF])/g,"")}function d(e){return/(?:[\xA9\xAE\u2122\u23E9-\u23EF\u23F3\u23F8-\u23FA\u24C2\u25B6\u2600-\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDE51\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F\uDE80-\uDEFF]|\uD83E[\uDD00-\uDDFF])/g.test(e)}},4722:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delEmojiReply=t.addEmojiReply=t.commentEmojiReply=t.emojisToList=t.emojiListOrder=void 0;var i=n(5),o=n(2183),r=n(1131);function a(e){return e?t.emojiListOrder.reduce((function(t,n){return e[n]&&t.push(Object.assign({id:n},e[n])),t}),[]):[]}function s(e,t){return i.__awaiter(this,void 0,Promise,(function(){var n,o,r,s,l,c;return i.__generator(this,(function(i){switch(i.label){case 0:return n=null,o=window.APP.commentsDataManager,e&&o?(r={comment_id:e},[4,o._getComment(r)]):[3,2];case 1:(s=i.sent())!==r&&(n=!1,l=a(s.emojis||{}),(c=l.find((function(e){return e.id===t})))&&c.users&&c.users.length&&(n=!!c.users.find((function(e){return e.id===window.APP.info.userid})))),i.label=2;case 2:return[2,n]}}))}))}function l(e){return window.__WPSENV__.reduxDispatch((0,o.addEmoji)(e))}function c(e){return window.__WPSENV__.reduxDispatch((0,o.delEmoji)(e))}t.emojiListOrder=(0,r.getEmojiListOrder)(),t.emojisToList=a,t.commentEmojiReply=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var n;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,s(e,t)];case 1:return!0===(n=i.sent())?[2,c({comment_id:e,emoji_id:t})]:!1===n?[2,l({comment_id:e,emoji_id:t})]:(window.Toast.info(_i18n("applications.writer.helpers.emojiController.noComment", "There is no comment data in the database")),[2,Promise.resolve()])}}))}))},t.addEmojiReply=l,t.delEmojiReply=c},480:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var i=n(238),o=n.n(i);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,a=void 0,a=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===r(a)?a:String(a)),i)}var o,a}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d(e);if(t){var o=d(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(u,e);var t,n,i,r=c(u);function u(){var e;return a(this,u),(e=r.apply(this,arguments)).prefixCls="kd-menu-divider",e}return t=u,(n=[{key:"render",value:function(){return o.a.createElement("div",{className:this.className(this.prefixCls)})}}])&&s(t.prototype,n),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),u}(n(303).a)},491:function(e,t,n){"use strict";var i=n(300),o=n.n(i),r=n(1),a=n.n(r),s=n(2),l=n.n(s),c=n(22),u=n.n(c),d=n(23),m=n.n(d),p=n(238),h=n.n(p),f=n(480),v=function(e){function t(){return a()(this,t),u()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return m()(t,e),l()(t,[{key:"render",value:function(){var e=o()(this.props,[]);return h.a.createElement(f.default,e)}}]),t}(p.Component);t.a=v},499:function(e,t,n){},500:function(e,t,n){},501:function(e,t,n){},5268:function(e,t,n){"use strict";var i=n(472),o={baseTextLength:4,originHeight:54,defaultAvatarHost:window.__CONFIG__.avatarHost?window.__CONFIG__.avatarHost+"/avatar/":"",getDefaultAvatar:function(e){return o.defaultAvatarHost?o.defaultAvatarHost+("string"==typeof e?Object(i.filterValid)(e):0):""}};t.a=o},580:function(e,t,n){"use strict";n.r(t);var i=n(13),o=n.n(i),r=n(1),a=n.n(r),s=n(2),l=n.n(s),c=n(22),u=n.n(c),d=n(23),m=n.n(d),p=(n(937),n(238)),h=n.n(p),f=n(227),v=n(240),g=n(666),E=n(167),w=n(840),C=n(385),y=(n(938),n(248)),b=n(81),T=n(939),_=y.default.types.size16,O=function(e){function t(){var e,n,i,o;a()(this,t);for(var r=arguments.length,s=Array(r),l=0;l<r;l++)s[l]=arguments[l];return n=i=u()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.state={isEmpty:!1,isFocus:!1},i.handleInputChange=function(){if(!i.isChineseInputting){var e=i.refInput.current.value;!!i.props.data?i.customChange(e):i.defaultChange(e)}},i.keyword="",i.defaultChange=Object(b.debounce)((function(e){if(i.refInput.current){var t=i.getContentElement();if(t){var n=i.props,o=n.flexHeight,r=n.onChange,a=e.toLowerCase();o||(a?i.keyword||(t.style.height=t.offsetHeight+"px"):t.style.height="");for(var s=[],l=t.querySelectorAll(".component-menu-item"),c=void 0,u=0;u<l.length;u++){var d=l[u],m=d.innerText.trim(),p=-1!==m.toLowerCase().indexOf(a),h="";p?(s.push(m),Object(g.removeClass)(d,"disabled")):(Object(g.addClass)(d,"disabled"),h="none"),d.style.display=h,!c&&p&&(c=d)}if(i.setState({isEmpty:!s.length}),a&&c)Object(g.addHoverItem)(c);else{var f=t.querySelector(".component-menu-item.hover");f&&Object(g.removeHoverItem)(f)}i.keyword=e,r(e,s)}else console.error("æœç´¢æ¡†å¿…é¡»åœ¨panel/panel-headerå†…æ‰æ”¯æŒæœç´¢")}}),100),i.customChange=Object(b.debounce)((function(e){var t=Object(T.search)(e,i.props.data);i.setState({isEmpty:!t.length}),i.props.onChange(e,t)}),100),i.isChineseInputting=!1,i.handleCompositionStart=function(){i.isChineseInputting=!0},i.handleCompositionEnd=function(){i.isChineseInputting=!1,i.handleInputChange()},i.handleFocus=function(){i.setState({isFocus:!0})},i.handleBlur=function(){i.setState({isFocus:!1})},i.refDiv=h.a.createRef(),i.refInput=h.a.createRef(),o=n,u()(i,o)}return m()(t,e),l()(t,[{key:"componentDidMount",value:function(){this.focus()}},{key:"focus",value:function(){this.refInput.current.focus()}},{key:"getContentElement",value:function(){return this.refDiv.current.parentElement}},{key:"render",value:function(){var e=this.state,t=e.isEmpty,n=e.isFocus,i=Object(p.classNames)({"component-menu-search":1,focus:n});return h.a.createElement("div",{className:"menu-search",ref:this.refDiv},h.a.createElement("div",{className:i},h.a.createElement(y.default,{type:_.menu_search}),h.a.createElement("input",{ref:this.refInput,type:"text",maxLength:500,"data-keep-wsad":!0,placeholder:this.props.placeholder,onCompositionStart:this.handleCompositionStart,onCompositionEnd:this.handleCompositionEnd,onChange:this.handleInputChange,onFocus:this.handleFocus,onBlur:this.handleBlur})),t&&h.a.createElement("div",{className:"component-menu-empty"},h.a.createElement("div",{className:"empty-content"},_i18n("applications.public.components.general.Menu.MenuSearch.empty", "No search results yet"))))}}]),t}(p.PureComponent);O.defaultProps={placeholder:_i18n("applications.public.components.general.Menu.MenuSearch.placeholder", "Search worksheet"),onChange:function(){}};var P=O,N=function(e){function t(e){a()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isEmpty:!1,height:null},n.setPanelHeight=function(){var e=n.props,t=e.showSearch,i=e.autoHeight;if(Object(g.checkCanSetSize)(t,i)){var o=n.refPanel.current.offsetHeight;n.setState({height:o})}},n.scrollSelectedChildren=function(){var e=n.refContent.current;if(e)for(var t=0;t<e.childElementCount;t++){var i=e.children[t];if(i.classList.contains("selected")){i.scrollIntoViewIfNeeded();break}}},n.handleSearch=function(e,t){var i=n.props.onSearch,o=void 0===i?function(){}:i;n.setState({isEmpty:!t.length}),o(e,t),n.setPreSelectItem(!0,null)},n.focus=function(){n.props.showSearch&&n.refSearch.current&&!E.isPad?n.refSearch.current.focus():n.refPanel.current.focus()},n.getStyle=function(){var e=n.props,t=e.showSearch,i=e.autoHeight,r=e.style,a=n.state.height,s={};return r&&(s=r),Object(g.checkCanSetSize)(t,i)?o()({},r,{height:a}):s},n.refPanel=h.a.createRef(),n.refSearch=h.a.createRef(),n.refContent=h.a.createRef(),n.handleKeyDown=n.handleKeyDown.bind(n),n.handleMouseMove=n.handleMouseMove.bind(n),n.handleMouseOut=n.handleMouseOut.bind(n),n.officeType=Object(v.getPageOfficeType)(),n}return m()(t,e),l()(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.refPanel.current&&(e.focus(),e.scrollSelectedChildren(),e.setPanelHeight())}),10)}},{key:"getHoverItem",value:function(){return this.refPanel.current.getElementsByClassName("hover")[0]}},{key:"handleKeyDown",value:function(e){if(this.props.enabledHotKey){var t=document.activeElement,n=t.tagName;if((!("TEXTAREA"===n||"INPUT"===n||"true"===t.contentEditable)||t.hasAttribute("data-keep-wsad"))&&!window.__WPSENV__.altStatus)switch(e.keyCode){case 13:var i=this.getHoverItem();i&&(Object(v.stopBubble)(e),i.click());break;case 38:case 40:var o=38===e.keyCode;this.setPreSelectItem(o,e);break;case 9:case 39:var r=this.getHoverItem();if(r){Object(v.stopBubble)(e);var a={visible:!0,element:r,parent:this.refPanel.current};f.default.dispatchEvent(f.default.names.SUB_MENU_VISIBLE_CHANGE,a)}break;case 37:Object(v.stopBubble)(e),this.props.onLeftArrow&&this.props.onLeftArrow()}}}},{key:"handleMouseMove",value:function(e){var t=this.refPanel.current;if(!t.contains(document.activeElement)&&t.contains(e.target)&&t.focus(),this.props.onItemHover){var n=this.getHoverItem();this.props.onItemHover(n,t)}window.__WPSENV__.altStatus&&f.default.dispatchEvent(f.default.names.EXIT_ALT_MODE,e)}},{key:"handleMouseOut",value:function(){if(this.props.onItemHover){var e=this.getHoverItem();this.props.onItemHover(e,this.refPanel.current)}}},{key:"setPreSelectItem",value:function(e,t){var n=this.refPanel.current.getElementsByClassName("component-menu-item");if(n.length){Object(v.stopBubble)(t);var i=this.getHoverItem();i&&i.classList.remove("hover");var o=this.getPreSelectItem(e,n,i);if(o.classList.add("hover"),o.scrollIntoViewIfNeeded(),i!==o){var r={visible:!1,element:i,parent:this.refPanel.current};f.default.dispatchEvent(f.default.names.SUB_MENU_VISIBLE_CHANGE,r)}this.props.onItemHover&&this.props.onItemHover(o,this.refPanel.current)}}},{key:"getPreSelectItem",value:function(e,t,n){for(var i=-1,o=0;o<t.length;o++)if(t[o]===n){i=o;break}if(e){for(var r=i-1;r>=0;r--)if(-1===t[r].className.indexOf("disabled")){i=r;break}}else for(var a=i+1;a<t.length;a++)if(-1===t[a].className.indexOf("disabled")){i=a;break}return t[Math.max(0,i)]}},{key:"preSelectFirst",value:function(){this.setPreSelectItem(!0,null),this.refPanel.current.focus()}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.isAuto,i=e.children,o=e.onScroll,r=e.onMouseEnter,a=e.showSearch,s=e.data,l=e.selectable,c=this.state.isEmpty,u=Object(p.classNames)({"wo-component-menu":1,"show-empty":c,selectable:l});n&&(u+=" "+this.officeType),t&&(u+=" "+t);var d=this.getStyle();return h.a.createElement("div",{ref:this.refPanel,className:u,tabIndex:0,style:d,onKeyDown:this.handleKeyDown,onScroll:o,onMouseMove:this.handleMouseMove,onMouseEnter:r,onMouseOut:this.handleMouseOut},a&&h.a.createElement(P,{ref:this.refSearch,data:s,onChange:this.handleSearch}),h.a.createElement("div",{ref:this.refContent,className:"menu-content"},i))}}]),t}(p.PureComponent);N.Divider=w.a,N.Item=C.default,N.Search=P,N.defaultProps={isAuto:!0,enabledHotKey:!0};t.default=N},5883:function(e,t,n){"use strict";var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.hasMentionByContents=t.pasteTextToHtml=t.htmlToNodes=t.textRangeToHtml=void 0;var r=n(5),a=n(760),s=n(805),l=n(691),c=n(1290),u=n(1808),d=n(6641),m=n(1476),p=((i={})[c.NODETYPE.TEXT]=1,i[c.NODETYPE.MENTION]=2,i[c.NODETYPE.PICTURE]=3,i[c.NODETYPE.HYPERLINK]=4,i),h=((o={})[c.NODETYPE.MENTION]=c.getMentions,o);t.textRangeToHtml=function(e){return function(e){if(!e||!e.length)return"";var t=document.createDocumentFragment();return e.forEach((function(e){switch(e.type){case c.NODETYPE.TEXT:e.text.split(/(?:\r\n)|(?:\r)|(?:\n)/g).forEach((function(e,n){if(0!==n){var i=document.createElement("br");t.appendChild(i)}if(e){var o=document.createTextNode(e);t.appendChild(o)}}));break;case c.NODETYPE.MENTION:var n=(0,u.createAtDom)(e.attrs,e.text);t.appendChild(n);break;case c.NODETYPE.PICTURE:case c.NODETYPE.HYPERLINK:}})),t}(function(e){return(0,c.handleTypes)(h,e,null).map((function(e){return function(e){var t={};switch(e._nType){case c.NODETYPE.TEXT:t={type:c.NODETYPE.TEXT,text:e.text};break;case c.NODETYPE.MENTION:t={type:c.NODETYPE.MENTION,text:e.text,attrs:e.attrs};break;case c.NODETYPE.PICTURE:t={type:c.NODETYPE.PICTURE,text:""};break;case c.NODETYPE.HYPERLINK:t={type:c.NODETYPE.HYPERLINK,text:e.text}}return t}(e)}))}(e))},t.htmlToNodes=function(e){var t=r.__spreadArray([],e.childNodes,!0),n=[],i=0,o=null,a="",s={SPAN:function(e){if((0,u.isTrueAtDom)(e)){o=c.NODETYPE.MENTION;var t=(0,u.getAtAttrs)(e);n.push({type:o,text:e.textContent,attrs:t})}else o=c.NODETYPE.TEXT,a+=e.textContent;i+=e.textContent.length},A:function(e){o=c.NODETYPE.HYPERLINK;var t=(0,d.getLinkAttrs)(e);n.push({type:o,text:e.textContent,attrs:t}),i+=e.textContent.length},IMG:function(){o=c.NODETYPE.PICTURE,n.push({type:o,text:""}),i+=1},BR:function(){o=c.NODETYPE.TEXT,a+="\r"},TEXT:function(e){o=c.NODETYPE.TEXT;var t=e.textContent.replace("/".concat(m.textSpaceCode,"/g"),"");a+=t,i+=t.length}};t.forEach((function(e){o&&o!==c.NODETYPE.TEXT&&(n.splice(n.length-1,0,{type:c.NODETYPE.TEXT,text:a}),a="");var t=(0,m.isTextNode)(e)?"TEXT":e.tagName;s[t]?s[t](e):s.TEXT(e)})),o===c.NODETYPE.TEXT&&(a.endsWith("\r")&&(a=a.slice(0,a.length-1)),n.push({type:o,text:a}));var l=function(e){var t="";return{contents:e.map((function(e){t+=e.text;var n=r.__assign({},e);switch(n.type=p[e.type],e.type){case c.NODETYPE.TEXT:break;case c.NODETYPE.MENTION:n.attrs={links:[{address:window.APP.editor.createKWProtocolAddress(e.attrs),textToDisplay:e.text}]};break;case c.NODETYPE.PICTURE:case c.NODETYPE.HYPERLINK:}return n})),content:t}}(n),h=l.contents,f=l.content;return{contents:h,count:i,content:f,nodes:n}},t.pasteTextToHtml=function(e){return(0,s.n2r)(e),(0,a.filterText)(e,l.isInvalidPlaceholderInComment)},t.hasMentionByContents=function(e){return!!(e&&e instanceof Array&&e.length)&&e.some((function(e){return e.type===p[c.NODETYPE.MENTION]}))}},6635:function(e,t,n){"use strict";var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=n(4669),m=[];function p(){m.length=0}var h=function(e){function t(){o()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.audio=document.createElement("AUDIO"),e.url=null,e.readyToPlay=!1,e.events={LOADING:"loading",START:"start",STOP:"stop",ENDED:"ended",ERROR:"error"},e.audio.oncanplay=function(){e.start()},e.audio.onerror=function(){p(),e.fire(e.events.ERROR,e.url)},e.audio.onended=function(){p(),e.fire(e.events.ENDED,e.url)},e}return u()(t,e),a()(t,[{key:"play",value:function(e){var t;this.stopAll(),t=this,m.push(t),this.url=e,this.audio.src=e,this.audio.load(),this.fire(this.events.LOADING,this.url),this.readyToPlay=!0}},{key:"start",value:function(){this.readyToPlay&&(this.fire(this.events.START,this.url),this.audio.play())}},{key:"stopPlaying",value:function(){this.readyToPlay=!1,this.audio.pause(),this.fire(this.events.STOP,this.url),this.fire(this.events.ENDED,this.url)}},{key:"stop",value:function(){this.stopPlaying(),p()}},{key:"stopAll",value:function(){m.forEach((function(e){e.stopPlaying()})),p()}}]),t}(d.a);t.a=h},6636:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(258)),a=i.__importDefault(n(6637)),s=i.__importDefault(n(260)),l=n(4722);t.default=(0,o.memo)((0,o.forwardRef)((function(e,t){var n=this,c=e.comment_id,u=e.emojis,d=e.userId,m=e.onClick,p=e.onChange,h=e.className,f=e.readOnly,v=(0,o.useState)((function(){return(0,l.emojisToList)(u)})),g=v[0],E=v[1];(0,o.useEffect)((function(){E((0,l.emojisToList)(u))}),[u]);var w=(0,o.useRef)(null),C=(0,o.useRef)(0);(0,o.useImperativeHandle)(t,(function(){return{getListDom:function(){return w&&w.current},emojiList:g}}),[g]);var y=(0,o.useCallback)((function(e){return i.__awaiter(n,void 0,void 0,(function(){return i.__generator(this,(function(t){return c?[2,(0,l.commentEmojiReply)(c,e)]:[2,Promise.resolve()]}))}))}),[c]);return(0,o.useEffect)((function(){var e=function(e){var t=e.detail;if(c===t.comment_id){var n=t.emoji_id,o=t.user_info,r=t.is_add;if(n&&o){var a=g.findIndex((function(e){return e.id===n})),s=g[a];if(r)if(s){var u=s.users||[];u.find((function(e){return e.id===o.id}))||(s.users=i.__spreadArray([o],u,!0))}else{var d={id:n,users:[o]},m=function(e,t){var n=i.__spreadArray(i.__spreadArray([],e,!0),[t],!1).reduce((function(e,t){return e[t.id]=i.__assign({},t),delete e[t.id].id,e}),{});return(0,l.emojisToList)(n).findIndex((function(e){return e.id===t.id}))}(g,d);m>-1&&g.splice(m,0,d)}else if(s&&s.users){var p=s.users.findIndex((function(e){return e.id===o.id}));p>-1&&s.users.splice(p,1),s.users=i.__spreadArray([],s.users,!0),s.users.length||g.splice(a,1)}E(i.__spreadArray([],g,!0))}}};return window.addEventListener(s.default.comments.COMMENT_EMOJI_UPDATE,e),function(){window.removeEventListener(s.default.comments.COMMENT_EMOJI_UPDATE,e)}}),[g,c]),(0,o.useEffect)((function(){if(w.current){var e=w.current.clientHeight;e!==C.current&&(C.current=e,s.default.dispatchEvent(s.default.comments.COMMENT_UPDATE_LAYOUT,{comment_id:c,emojiList:g}))}}),[g,c]),(0,o.useEffect)((function(){p&&p(g)}),[g,p]),c&&g.length?o.default.createElement("div",{className:"comment-emoji-reply-list-wrap"},o.default.createElement("div",{ref:w,className:(0,r.default)("comment-emoji-reply-list",h,{self:window.APP.info.userid===d})},g.map((function(e){return o.default.createElement(a.default,i.__assign({key:e.id},e,{readOnly:f,onClickIcon:y,onClickDetail:m}))})))):o.default.createElement("div",null)})))},6637:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(1567));t.default=(0,o.memo)((function(e){var t=this,n=e.id,a=e.users,s=e.onClickIcon,l=e.onClickDetail,c=e.readOnly,u=(0,o.useState)(!1),d=u[0],m=u[1],p=(0,o.useRef)(null),h=(0,o.useMemo)((function(){return a?a.map((function(e){return e.name})).join("ã€"):""}),[a]),f=(0,o.useState)(!1),v=f[0],g=f[1],E=(0,o.useCallback)((function(e){return i.__awaiter(t,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:if(e.stopPropagation(),!s)return[2];if(c)return[2];if(v)return console.log("æ­£åœ¨è¯·æ±‚ä¸­"),[2];g(!0),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,s(n)];case 2:return t.sent(),[3,4];case 3:return g(!1),[7];case 4:return[2]}}))}))}),[s,n,v,c]),w=(0,o.useCallback)((function(e){e.stopPropagation(),l&&l(n)}),[l,n]);return(0,o.useEffect)((function(){if(p&&p.current){var e=p.current,t=e.clientHeight,n=e.scrollHeight;m(n>t+2)}else m(!1)}),[h]),a&&a.length?o.default.createElement("div",{ref:p,className:"comment-emoji-reply-item ".concat(d?"ellipsis":"")},o.default.createElement("span",{className:"comment-emoji-reply-icon ".concat(c?"disabled":""),onClick:E},o.default.createElement(r.default,{id:n})),o.default.createElement("span",{className:"comment-emoji-reply-userNames ".concat(l?"pointer":""),onClick:w},d&&o.default.createElement("i",{className:"num"},"(",a.length<99?a.length:"99+",")"),h)):null}))},6638:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(1567)),a=i.__importDefault(n(258)),s={id:"",users:[]};function l(e,t){return e?t?e.find((function(e){return e.id===t}))||s:e.find((function(e){return e.users&&e.users.length}))||s:s}t.default=(0,o.memo)((function(e){var t=e.emojiList,n=e.selectedEmojiId,i=e.setClickEmojiId,c=e.className,u=(0,o.useState)((function(){return l(t,n)})),d=u[0],m=u[1],p=(0,o.useCallback)((function(e){i&&i(void 0),m(e)}),[i]);return(0,o.useEffect)((function(){if(d!==s){var e=t.find((function(e){return e.id===d.id}));e&&(!e||e.users&&e.users.length)||m(l(t))}}),[t,d]),(0,o.useEffect)((function(){if(n){var e=t.find((function(e){return e.id===n}));e&&m(e)}}),[t,n]),t&&t.length?o.default.createElement("div",{className:(0,a.default)("comment-emoji-reply-detail",c)},o.default.createElement("div",{className:"comment-emoji-reply-detail-header"},t.map((function(e){return e.users&&e.users.length&&o.default.createElement("span",{key:e.id,className:"header-item ".concat(d.id===e.id?"selected":""),onClick:function(){return p(e)}},o.default.createElement("span",{className:"header-item-icon"},o.default.createElement(r.default,{id:e.id})),o.default.createElement("span",{className:"header-item-num"},e.users.length<99?e.users.length:"99+"))||null}))),o.default.createElement("div",{className:"comment-emoji-reply-detail-content"},d.users&&d.users.length&&d.users.map((function(e){return o.default.createElement("div",{key:e.id,className:"content-item"},o.default.createElement("span",{className:"content-item-avatar"},o.default.createElement("img",{src:e.avatar_url})),o.default.createElement("span",{className:"content-item-name"},e.name))}))||null)):null}))},6639:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useWrapController=void 0;var i=n(238);t.useWrapController=function(){var e=(0,i.useState)(!1),t=e[0],n=e[1],o=(0,i.useState)((new Date).getTime())[1],r=(0,i.useCallback)((function(){n(!0)}),[]),a=(0,i.useCallback)((function(e){n(!!e)}),[]),s=(0,i.useCallback)((function(e){t&&(o((new Date).getTime()),e&&!e.every((function(e){return!e.users||!e.users.length}))||n(!1))}),[t]);return{visible:t,setVisible:n,handleClick:r,onVisibleChange:a,onChange:s}}},6640:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(258)),a=i.__importStar(n(167)),s=n(246),l=n(560),c=n(1170),u=n(1735),d=n(5883),m=n(1808),p=n(1476),h=i.__importDefault(n(6642)),f=i.__importDefault(n(6643)),v=i.__importDefault(n(6644));n(6645);t.default=(0,o.memo)((0,o.forwardRef)((function(e,t){var n=e.commentId,i=e.isEditable,g=e.onTextChanged,E=e.className,w=e.placeholder,C=e.onFocus,y=e.onBlur,b=(0,o.useRef)(null),T=(0,o.useRef)(!1),_=(0,o.useRef)(!1),O=(0,o.useState)(!1),P=O[0],N=O[1],I=(0,o.useMemo)((function(){return(0,c.isTempCommentId)(n)}),[n]),k=(0,o.useRef)(!1),D=(0,o.useState)(!1),S=D[0],A=D[1],M=(0,o.useCallback)((function(){return A(!S)}),[S]),L=(0,o.useCallback)((function(){var e=b.current,t=e.innerText.length;(0,p.isBrNode)(e.lastChild)||(t+=1),N(t<=1),g&&g(t)}),[g]),x=(0,o.useRef)(L);(0,o.useEffect)((function(){x.current=L}),[L]),(0,o.useEffect)((function(){_.current=!0;var e=function(e){var t=e&&e.detail&&e.detail.stopScroll||!1,n=b.current;t?(p.mockScroll.destroy(),new p.mockScroll(n).bindEvent()):new p.mockScroll(n).unbindEvent()};return window.addEventListener(l.DOCCustomEvents.comments.STOP_BODY_SCROLL,e),function(){_.current=!1,k.current&&(k.current=!1,l.DOCCustomEvents.dispatchEvent(l.DOCCustomEvents.comments.RICHTEXT_INPUT_BLUR,{isComponentDestroy:!0})),window.removeEventListener(l.DOCCustomEvents.comments.STOP_BODY_SCROLL,e),p.mockScroll.destroy()}}),[]),(0,o.useEffect)((function(){var e=new h.default({container:b.current}),t=new f.default({container:b.current}),n=new v.default({container:b.current,isEdit:!I,onTextchangeRef:x});return function(){e.destroy(),t.destroy(),n.destroy()}}),[n,S]),(0,o.useEffect)((function(){if(!I){var e=b.current,t=window.APP.data.doc.comments.getCommentByCommentId(n).body,i={pos:t.pos,len:t.len},o=(0,d.textRangeToHtml)(i);o&&o.lastChild&&!(0,p.isBrNode)(o.lastChild)&&o.appendChild(document.createElement("br")),e.innerText="",e.appendChild(o),(0,u.setSelectionEnd)(e),requestAnimationFrame((function(){if(e){var t=e.scrollHeight;e.scrollTop=t}}))}x.current()}),[n]);var R=(0,o.useCallback)((function(){return{element:b.current,get value(){return b.current?(0,d.htmlToNodes)(b.current):null},set value(e){},get isMounted(){return _.current},focus:function(){_.current&&b.current&&(a.isPad?Promise.resolve().then((function(){b.current.focus()})):b.current.focus())},update:function(){_.current}}}),[]),j=(0,o.useCallback)((function(){b.current&&(b.current.innerHTML="",x.current())}),[]);(0,o.useImperativeHandle)(t,(function(){return{getCommentInput:R,updatePlugin:M,clearContent:j,onTextchange:x.current,richTextDom:b.current}}),[R,M,j]);var H=(0,o.useCallback)((function(){var e=b.current?(0,d.htmlToNodes)(b.current).count:0;if(e>800){var t=(0,u.getCurrentRange)(),n=e-800,i=t.endOffset,o=Math.max(i-n,0);return t.setStart(t.endContainer,o),t.setEnd(t.endContainer,i),t.deleteContents(),(0,u.setRangeByNode)(t.endContainer,o,t.endContainer,o).isFixInput=!0,!0}return!1}),[]),B=(0,o.useCallback)((function(){T.current||H(),x.current()}),[H]),F=(0,o.useCallback)((function(e){if((0,m.hasTempAtDom)()||""===b.current.innerText.trim()||l.DOCCustomEvents.dispatchEvent(l.DOCCustomEvents.comments.COMMIT_AND_INSERT_NEW_COMMENT),e.preventDefault(),a.isMobile){var t=(0,u.getCurrentRange)();if(t){var n=document.createDocumentFragment(),i=document.createElement("BR");n.append(i);var o=t.commonAncestorContainer;((0,p.isTextNode)(o)&&o.textContent.length==t.endOffset&&(!o.nextSibling||(0,p.isEmptyTextNode)(o.nextSibling))||o===b.current&&o.childNodes.length===t.endOffset)&&n.append(document.createElement("BR")),(0,p.isBrNode)(o)?(0,p.insertDom)(n,o,"after"):(t.insertNode(n),t.collapse()),(0,u.setRangeByNode)(i.nextSibling||i,0),i.scrollIntoView(),x.current()}}}),[]),V=(0,o.useCallback)((function(e){(0,s.isMatchKey)(e,s.Keys.Enter)?F(e):"Escape"!==e.code&&27!==e.keyCode||(T.current||(0,s.isComposing)(e)?e.stopPropagation():(0,m.hasTempAtDom)()&&((0,m.closeAt)(!0),e.stopPropagation()))}),[F]),W=(0,o.useCallback)((function(e){((0,s.isMatchKey)(e,s.Keys.Backspace)||(0,s.isMatchKey)(e,s.Keys.Delete))&&x.current()}),[]),U=(0,o.useCallback)((function(){T.current=!0}),[]),Y=(0,o.useCallback)((function(){T.current=!1,H()}),[H]),K=(0,o.useCallback)((function(e){e.preventDefault();var t=(e.clipboardData||window.clipboardData).getData(a.isIE?"Text":"text/plain"),n=(0,u.getCurrentRange)();if(t&&n){var i=(0,d.pasteTextToHtml)(t),o=(0,d.htmlToNodes)(b.current).count;if(o>800||o+i.length>800)return;window.getSelection().deleteFromDocument(),n.insertNode(document.createTextNode(i)),n.collapse(),x.current()}}),[]),G=(0,o.useCallback)((function(e){k.current=!0,C&&C(e),window.APP.workspace.input.blur(),l.DOCCustomEvents.dispatchEvent(l.DOCCustomEvents.comments.RICHTEXT_INPUT_FOCUS)}),[C]),z=(0,o.useCallback)((function(e){k.current=!1,y&&y(e),l.DOCCustomEvents.dispatchEvent(l.DOCCustomEvents.comments.RICHTEXT_INPUT_BLUR)}),[y]);return o.default.createElement(o.default.Fragment,null,P&&o.default.createElement("span",{className:"comment_input_tip"},w||a.convertCtrl("zh-CN"===window.langName?_i18n("applications.writer.components.other.enterPlaceholder", "Press Enter to send and press Shift+Enter to wrap."):_i18n("applications.writer.components.other.otherLanguageEnterPlaceholder", "Shift+Enter line break"))),o.default.createElement("div",{className:(0,r.default)("temp_comment_input",E),ref:b,suppressContentEditableWarning:!0,contentEditable:i,onInput:B,onKeyDownCapture:V,onKeyUp:W,onCompositionStartCapture:U,onCompositionEndCapture:Y,onPaste:K,onFocus:G,onBlur:z},o.default.createElement("br",null)))})))},6641:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLinkAttrs=void 0,t.getLinkAttrs=function(e){return{textToDisplay:e.textContent,address:e.href}}},6642:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(246),o=n(1808),r=n(1735),a=n(1476),s=function(){function e(e){var t=e.container,n=this;this.handleKeyDown=function(e){var t,o=(0,i.getKey)(e),r=((t={})[i.Keys.Backspace]=n.handleBackspace,t[i.Keys.Delete]=n.handleDelete,t[i.Keys.ArrowLeft]=n.handleLeftOrUp,t[i.Keys.ArrowUp]=n.handleLeftOrUp,t[i.Keys.ArrowRight]=n.handleRightOrDown,t[i.Keys.ArrowDown]=n.handleRightOrDown,t);r[o]&&r[o]()},this.handleBackspace=function(){if(!(0,o.hasTempAtDom)()){var e=(0,r.getCurrentRange)();if(e)if(e.collapsed){var t,i=e.startContainer;if(1===e.startOffset&&1===i.textContent.length)((0,a.isNoEditableNode)(i.previousSibling)||(0,a.isNoEditableNode)(i.nextSibling))&&(t=(0,a.createTextSpace)(),(0,a.insertDom)(t,i,"after"),window.requestAnimationFrame((function(){return(0,r.setRangeByNode)(t,0)}))),(0,a.isTextSpace)(i)&&(i.remove(),t&&(0,r.setRangeByNode)(t,0))}else{var s=n.judgeIsAddTextSpaceBySelectedDel(e);if(s){var l=s.endContainer,c=(0,a.createTextSpace)();(0,a.insertDom)(c,l,"after"),window.requestAnimationFrame((function(){return(0,r.setRangeByNode)(c,0)}))}}}},this.handleDelete=function(){if(!(0,o.hasTempAtDom)()){var e=(0,r.getCurrentRange)();if(e)if(e.collapsed){var t,i=e.startContainer;if(0===e.startOffset&&1===i.textContent.length)((0,a.isNoEditableNode)(i.nextSibling)||(0,a.isNoEditableNode)(i.previousSibling))&&(t=(0,a.createTextSpace)(),(0,a.insertDom)(t,i,"before"),window.requestAnimationFrame((function(){return(0,r.setRangeByNode)(t,1)}))),(0,a.isTextSpace)(i)&&(i.remove(),t&&(0,r.setRangeByNode)(t,1))}else{var s=n.judgeIsAddTextSpaceBySelectedDel(e);if(s){var l=s.startContainer,c=(0,a.createTextSpace)();(0,a.insertDom)(c,l,"before"),window.requestAnimationFrame((function(){return(0,r.setRangeByNode)(c,1)}))}}}},this.handleLeftOrUp=function(){var e=(0,r.getCurrentRange)();e&&e.collapsed&&(0,a.isTextSpace)(e.startContainer)&&(0,r.setRangeByNode)(e.startContainer,0)},this.handleRightOrDown=function(){var e=(0,r.getCurrentRange)();e&&e.collapsed&&(0,a.isTextSpace)(e.startContainer)&&(0,r.setRangeByNode)(e.startContainer,1)},this.selectionChange=function(){var e=(0,r.getCurrentRange)();if(e&&!e.isUndo&&!e.isRedo&&(n.checkContent(),a.isChrome&&e&&n.container.contains(e.commonAncestorContainer))){var t=Array.prototype.slice.call(n.container.childNodes).filter((function(e){return(0,a.isNoEditableNode)(e)}));if(t.length&&(t.forEach((function(e){return e.classList.remove("selected")})),!e.collapsed)){var i=e.startContainer,o=e.startOffset,s=e.endContainer,l=e.endOffset;i===n.container&&(i=n.container.childNodes[o]),s===n.container&&(s=n.container.childNodes[l-1]);for(var c=i;c&&c!==s;)(0,a.isNoEditableNode)(c)&&c.classList.add("selected"),c=c.nextSibling}}},this.container=t,this.selectionChange=window.utils.Lodash.debounce(this.selectionChange,16),this.init()}return e.prototype.init=function(){this.bindEvent()},e.prototype.destroy=function(){this.unbindEvent()},e.prototype.bindEvent=function(){this.container.addEventListener("keydown",this.handleKeyDown,!1),document.addEventListener("selectionchange",this.selectionChange,!1)},e.prototype.unbindEvent=function(){this.container.removeEventListener("keydown",this.handleKeyDown,!1),document.removeEventListener("selectionchange",this.selectionChange,!1)},e.prototype.judgeIsAddTextSpaceBySelectedDel=function(e){var t=e.startContainer,n=e.startOffset,i=e.endContainer,o=e.endOffset,r=!(t!==this.container),s=!(i!==this.container);r&&(t=this.container.childNodes[n]),s&&(i=this.container.childNodes[o-1]);var l=(0,a.isNoEditableNode)(t.previousSibling),c=(0,a.isNoEditableNode)(i.nextSibling),u=(0,a.isTextNode)(t)&&0===n&&(0,a.isTextNode)(i)&&i.length===o,d=(0,a.isTextNode)(t)&&0===n&&s,m=r&&(0,a.isTextNode)(i)&&i.length===o,p=Boolean(u||d||m||r&&s),h=Boolean(c&&(!t.previousSibling||(0,a.isEmptyTextNode)(t.previousSibling)||(0,a.isBrNode)(t.previousSibling))&&p),f=Boolean(c&&l&&p),v=Boolean(l&&(!i.nextSibling||(0,a.isEmptyTextNode)(i.nextSibling)||(0,a.isBrNode)(i.nextSibling))&&p);return!!(h||f||v)&&{startContainer:t,endContainer:i}},e.prototype.checkContent=function(){var e=this;if(!(0,o.hasTempAtDom)()){var t=(0,r.getCurrentRange)();t&&this.container.contains(t.commonAncestorContainer)&&Array.prototype.slice.call(this.container.childNodes).forEach((function(t){(0,a.isNoEditableNode)(t)?e.handleCheckIsNoEditableNode(t):(0,a.isTextNode)(t)&&e.handleCheckIsTextNode(t)}))}},e.prototype.handleCheckIsNoEditableNode=function(e){var t=e.previousSibling,n=e.nextSibling;t?this.handleCheckIsNoEditableNodeHasPreviousSibling(t,e):(0,a.insertDom)((0,a.createTextSpace)(),e,"before"),n?this.handleCheckIsNoEditableNodeHasNextSibling(n,e):(0,a.insertDom)((0,a.createTextSpace)(),e,"after")},e.prototype.handleCheckIsNoEditableNodeHasPreviousSibling=function(e,t){if((0,a.isTextNode)(e)){var n=e.textContent.indexOf(a.textSpaceCode);e.textContent!==a.textSpaceCode&&-1!==n?e.deleteData(n,1):(0,a.isEmptyTextNode)(e)&&e.appendData(a.textSpaceCode)}else((0,a.isNoEditableNode)(e)||(0,a.isBrNode)(e))&&(0,a.insertDom)((0,a.createTextSpace)(),t,"before")},e.prototype.handleCheckIsNoEditableNodeHasNextSibling=function(e,t){if((0,a.isTextNode)(e)){var n=e.textContent.indexOf(a.textSpaceCode);e.textContent!==a.textSpaceCode&&-1!==n?e.deleteData(n,1):(0,a.isEmptyTextNode)(e)&&e.appendData(a.textSpaceCode)}else((0,a.isNoEditableNode)(e)||(0,a.isBrNode)(e))&&(0,a.insertDom)((0,a.createTextSpace)(),t,"after")},e.prototype.handleCheckIsTextNode=function(e){var t=e.previousSibling,n=e.nextSibling;if((0,a.isNoEditableNode)(t)||(0,a.isNoEditableNode)(n)){if((0,a.isNoEditableNode)(t)&&(0,a.isContentTextNode)(n)||(0,a.isNoEditableNode)(n)&&(0,a.isContentTextNode)(t)){var i;if(-1!==(i=e.textContent.indexOf(a.textSpaceCode))){var o=(0,r.getCurrentRange)();e.textContent===a.textSpaceCode?(o&&o.startContainer===e&&((0,a.isContentTextNode)(n)&&(0,r.setRangeByNode)(n,0),(0,a.isContentTextNode)(t)&&(0,r.setRangeByNode)(t,t.length)),e.remove()):e.deleteData(i,1)}}}else-1!==(i=e.textContent.indexOf(a.textSpaceCode))&&(e.textContent===a.textSpaceCode?e.remove():e.deleteData(i,1))},e}();t.default=s},6643:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5).__importDefault(n(260)),o=n(246),r=n(167),a=n(1808),s=n(1735),l=n(1476),c=n(342),u=window.__WPSPLUGIN__.loader.search({pluginType:c.PLUGIN_TYPE.AT}),d=function(){function e(e){var t=e.container,n=this;this.handleInput=function(e){if(!((0,s.getCurrentRange)()||{}).isFixInput){var t=e.inputType,o=!("insertText"!==t&&"insertCompositionText"!==t)||!t&&r.isIos;if(!(0,a.hasTempAtDom)()&&o&&"@"===e.data){var c=(0,s.getCurrentRange)();if(c&&c.endContainer===c.startContainer){var u=c.endContainer;u.startOffset=c.endOffset-1;var d=c.getBoundingClientRect(),m=(0,a.getAtPosition)(d);(0,a.showAt)(m,u);var p=c.cloneRange(),h=(0,l.createTextSpace)();return c.insertNode(h),h.remove(),(0,s.setRangeByRange)(p),void(r.isMobile&&(n.container.blur(),window.collection("commententrance",{permission:window.APP.isReadOnly()?"read":"edit",value:"@text_click"})))}}if((0,a.hasTempAtDom)()){var f=(0,a.getTempAtDom)(),v=f.startOffset,g=f.textContent,E=f.innerText,w=g||E||"";if("@"!==w[v])return void n.handleCloseAt();var C=w.slice(v+1);if(i.default.dispatchEvent(i.default.comments.SEARCH_AT_MODEL,{text:C,isComposing:n.preInput}),C){m=(0,a.getAtPosition)((0,s.getCurrentRange)().getBoundingClientRect());i.default.dispatchEvent(i.default.comments.SHOW_AT_MODEL,{position:m,isUpdate:!0})}}}},this.handleCompositionStart=function(){n.preInput=!0},this.handleCompositionEnd=function(){n.preInput=!1},this.onPluginConfirm=function(e){if((0,a.hasTempAtDom)()){var t=e.detail.hyperlinks;if(t&&t.length){var n=document.createDocumentFragment();t.forEach((function(e){var t=e.params,i=e.text,o=(0,a.createAtDom)(t,i+" ");o.style.marginRight="10px",n.appendChild(o)}));var i=(0,a.getTempAtDom)(),o=i.startOffset,r=i.length,c=(0,l.createTextSpace)();(0,l.isTextSpace)(i.nextSibling)?c=i.nextSibling:n.appendChild(c),i.deleteData(o,r-o),(0,l.insertDom)(n,i,"after"),(0,s.setRangeByNode)(c,1)}}},this.onPluginClose=function(){(0,a.closeAt)()},this.handleCloseAt=function(){(0,a.hasTempAtDom)()&&(0,a.closeAt)(!0)},this.handleDel=function(){if((0,a.hasTempAtDom)()){var e=(0,a.getTempAtDom)(),t=e.startOffset,i=e.textContent,o=e.innerText;1===(i||o||"").slice(t).length&&n.handleCloseAt()}},this.handleKeyDown=function(e){((0,o.isMatchKey)(e,o.Keys.Backspace)||(0,o.isMatchKey)(e,o.Keys.Delete))&&n.handleDel()},this.clickOpenAt=function(){n.container.focus();var e=(0,s.getCurrentRange)();if(e){window.getSelection().deleteFromDocument();var t=e.startContainer;if((0,l.isTextNode)(t)){var i=e.startOffset;t.insertData(i,"@"),(0,s.setRangeByNode)(t,i+1)}else{t===n.container&&1===t.childNodes.length&&(0,l.isBrNode)(t.lastChild)&&t.lastChild.remove();var o=document.createTextNode("@");e.insertNode(o),(0,s.setRangeByNode)(o,1)}var r=new InputEvent("input",{bubbles:!0,cancelable:!0,inputType:"insertText",data:"@"});n.container.dispatchEvent(r)}},this.container=t,this.handleInput=window.utils.Lodash.debounce(this.handleInput,16),this.preInput=!1,this.init()}return e.prototype.init=function(){u&&this.bindEvent()},e.prototype.destroy=function(){u&&(this.unbindEvent(),this.handleCloseAt())},e.prototype.bindEvent=function(){this.container.addEventListener("input",this.handleInput,!1),this.container.addEventListener("compositionstart",this.handleCompositionStart,!1),this.container.addEventListener("compositionend",this.handleCompositionEnd,!1),this.container.addEventListener("keydown",this.handleKeyDown,!1),window.addEventListener(i.default.comments.ON_CLICK_OPEN_AT,this.clickOpenAt),window.addEventListener(i.default.comments.ON_CONFIRM_AT,this.onPluginConfirm),window.addEventListener(i.default.comments.ON_CLOSE_AT,this.onPluginClose)},e.prototype.unbindEvent=function(){this.container.removeEventListener("input",this.handleInput,!1),this.container.removeEventListener("compositionstart",this.handleCompositionStart,!1),this.container.removeEventListener("compositionend",this.handleCompositionEnd,!1),this.container.removeEventListener("keydown",this.handleKeyDown,!1),window.removeEventListener(i.default.comments.ON_CLICK_OPEN_AT,this.clickOpenAt),window.removeEventListener(i.default.comments.ON_CONFIRM_AT,this.onPluginConfirm),window.removeEventListener(i.default.comments.ON_CLOSE_AT,this.onPluginClose)},e}();t.default=d},6644:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=n(246),r=n(1735),a=n(1476),s=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,l="delNode",c="delTextSpace",u="delTextNode",d="delNoEditableNode",m="addNode",p="addTextSpace",h="addNoEditableNode",f="changeText",v="addChartAt",g="delChartTextSpace",E="inputText",w="delFixInput",C="preInput",y=function(){function e(t){var n=t.container,i=t.isEdit,l=t.onTextchangeRef,m=this;this.observe=function(){m.observer.observe(m.container,e.ListenOption)},this.disconnect=function(){m.observer.disconnect()},this.judgeMergeTextOps=function(e,t){var n=!1;if(1===t.ops.length||1===e.ops.length){var i=t.ops[0],o=e.ops[0];if(o.type===E||i.type===E||o.type===C||i.type===C){var r=(new Date).getTime();if(1===t.ops.length&&1===e.ops.length&&i.type===o.type&&(i.type===E||i.type===C)&&i.target===o.target){var a=m.preInput&&!m.isPreInputEnd,s=!m.preInput&&r-m.lastTextTime<500;(a||s)&&(t.range=e.range,i.redo=o.redo,n=!0)}m.lastTextTime=r}}return n},this.judgeMergeTempAtOps=function(t,n){var i,o=!1;return e.hasOps(n.ops,[v])&&e.hasOps(t.ops,[p,c])&&(n.range=t.range,(i=n.ops).push.apply(i,t.ops),o=!0),o},this.judgeMergeInsertNoEditableOps=function(t,n){var i,o=!1;if(e.hasOps(n.ops,[h])){var r=e.hasOps(t.ops,[c]),s=(0,a.isTextSpace)(t.ops[0].target);1===t.ops.length&&(r||s)&&(n.range=t.range,(i=n.ops).push.apply(i,t.ops),o=!0)}return o},this.judgeMergeAddTextSpace=function(t,n){var i,o=!1;if(e.hasOps(n.ops,[u])){var r=e.hasOps(t.ops,[p]),s=e.hasOps(t.ops,[E])&&t.ops.some((function(e){return e.type===E&&(0,a.isTextSpace)(e.target)}));(r||s)&&(n.range=t.range,(i=n.ops).push.apply(i,t.ops),o=!0)}return o},this.judgeMergeDelTextSpace=function(t,n){var i,o,r=!1;if(e.hasOps(n.ops,[d]))e.hasOps(t.ops,[c])&&(n.range=t.range,(i=n.ops).push.apply(i,t.ops),r=!0);else if(e.hasOps(n.ops,[E])){e.hasOps(t.ops,[g])&&(n.range=t.range,(o=n.ops).push.apply(o,t.ops),r=!0)}return r},this.judgeMergeDelFixInput=function(e,t){var n=!1;if(1===t.ops.length&&1===e.ops.length){var i=t.ops[0],o=e.ops[0];if([E,C,v].includes(i.type)&&o.type===w&&i.target===o.target){t.range=e.range,i.redo=o.redo,i.type=o.type;var r=m.stateList[m.stateIndex-1],a=r&&r.ops[0];a&&a.type===i.type&&1===r.ops.length&&i.target===a.target&&(r.range=e.range,a.redo=o.redo,m.stateList.pop()),n=!0}}return n},this.handleListenDom=function(e){var t=(0,r.getCurrentRange)();if(t&&m.container.contains(t.commonAncestorContainer)){m.stateList.splice(m.stateIndex+1);var n=[];e.forEach((function(e){"childList"===e.type?(e.removedNodes.length&&m.handleDelNode(e,n),e.addedNodes.length&&m.handleAddNode(e,n)):"characterData"===e.type&&m.handleChangeText(e,n)}));var i={range:[t.startContainer,t.startOffset,t.endContainer,t.endOffset],ops:n};m.judgeMergeOps(i),m.stateIndex=m.stateList.length-1,m.isPreInputEnd=!1}},this.handleKeyDown=function(e){(0,o.isMatchShortCutKey)(e,[o.Keys.Ctrl,"Z"])?(e.stopPropagation(),e.preventDefault(),m.undo()):(0,o.isMatchShortCutKey)(e,[o.Keys.Ctrl,"Y"])&&(e.stopPropagation(),e.preventDefault(),m.redo())},this.handleCompositionStart=function(){m.preInput=!0},this.handleCompositionEnd=function(){m.preInput=!1,m.isPreInputEnd=!0},this.container=n,this.onTextchangeRef=l,this.preInput=!1,this.isPreInputEnd=!1,this.stateList=[],this.stateIndex=0,this.lastTextTime=0,this.observer=new s(this.handleListenDom),this.bindEvent(),i||window.requestAnimationFrame((function(){var e=(0,r.getCurrentRange)();if(!e){var t=m.container.firstChild||m.container;e={startContainer:t,startOffset:0,endContainer:t,endOffset:0}}var n=e.startContainer,i=e.startOffset,o=e.endContainer,a=e.endOffset;m.stateList.push({range:[n,i,o,a],ops:[{target:null,type:null,undo:function(){},redo:function(){}}]})}))}return e.getIndexs=function(e,t){for(var n=[],i=0;i<t.length;i++)n.push(Array.prototype.indexOf.call(e,t[i]));return n},e.removeChildren=function(e,t){for(var n=0,i=t.length;n<i;n++)e.removeChild(t[n])},e.addChildren=function(e,t,n){for(var i=0,o=t.length;i<o;i++){var r=e.childNodes[n[i]];r?e.insertBefore(t[i],r):e.appendChild(t[i])}},e.addDelChildren=function(e){var t=e.target,n=e.removedNodes,i=e.nextSibling,o=e.previousSibling;if(i)for(var r=0,s=n.length;r<s;r++)(0,a.insertDom)(n[r],i,"before");else if(o)for(r=n.length-1;r>=0;r--)(0,a.insertDom)(n[r],o,"after");else for(r=0,s=n.length;r<s;r++)t.appendChild(n[r])},e.isAddtextAt=function(e,t){var n=!1;if(e.length+1===t.length){n=!0;for(var i=void 0,o=0,r=t.length;o<r;o++)if(void 0===i){if(t[o]!==e[o]){if("@"!==t[o])return!1;i=o}}else if(t[o]!==e[o-1])return!1}return n},e.isDelChartTextSpace=function(e,t){var n=!1;if(t.length+1===e.length){n=!0;for(var i=void 0,o=0,r=e.length;o<r;o++)if(void 0===i){if(e[o]!==t[o]){if(e[o]!==a.textSpaceCode)return!1;i=o}}else if(e[o]!==t[o-1])return!1}return n},e.isInputText=function(e,t){var n=!1;return t.length===e.length+1&&(n=!0),n},e.hasOps=function(e,t){var n=t.length;if(!n)return!1;var i=new Array(n);e.forEach((function(e){return t.forEach((function(t,n){return e.type===t&&(i[n]=!0)}))}));for(var o=0;o<n;o++)if(!0!==i[o])return!1;return!0},e.prototype.destroy=function(){this.unbindEvent(),this.stateList=[],this.stateIndex=0,this.observer=null},e.prototype.bindEvent=function(){this.container.addEventListener("compositionstart",this.handleCompositionStart,!1),this.container.addEventListener("compositionend",this.handleCompositionEnd,!1),this.container.addEventListener("keydown",this.handleKeyDown,!0),this.observe()},e.prototype.unbindEvent=function(){this.container.removeEventListener("compositionstart",this.handleCompositionStart,!1),this.container.removeEventListener("compositionend",this.handleCompositionEnd,!1),this.container.removeEventListener("keydown",this.handleKeyDown,!0),this.disconnect()},e.prototype.judgeMergeOps=function(e){var t=this.stateList[this.stateIndex],n=[this.judgeMergeDelFixInput,this.judgeMergeTextOps,this.judgeMergeTempAtOps,this.judgeMergeInsertNoEditableOps,this.judgeMergeAddTextSpace,this.judgeMergeDelTextSpace];!!t&&n.some((function(n){return n(e,t)}))||this.stateList.push(e)},e.prototype.handleDelNode=function(t,n){var o=t.target,r=t.removedNodes,s=l;i.__spreadArray([],r,!0).some((function(e){return(0,a.isNoEditableNode)(e)}))?s=d:1===r.length&&((0,a.isTextSpace)(r[0])?s=c:(0,a.isTextNode)(r[0])&&(s=u));var m={type:s,target:o,undo:function(){e.addDelChildren(t)},redo:function(){e.removeChildren(o,r)}};n.push(m)},e.prototype.handleAddNode=function(t,n){var o=t.target,r=t.addedNodes,s=e.getIndexs(o.childNodes,r),l=m;1===r.length&&(0,a.isTextSpace)(r[0])?l=p:i.__spreadArray([],r,!0).some((function(e){return(0,a.isNoEditableNode)(e)}))&&(l=h);var c={type:l,target:o,undo:function(){e.removeChildren(o,r)},redo:function(){e.addChildren(o,r,s)}};n.push(c)},e.prototype.handleChangeText=function(t,n){var i=t.target,o=t.oldValue,a=i.textContent,s=f,l=((0,r.getCurrentRange)()||{}).isFixInput;this.preInput?s=C:l?s=w:e.isAddtextAt(o,a)?s=v:e.isDelChartTextSpace(o,a)?s=g:e.isInputText(o,a)&&(s=E);var c={type:s,target:i,undo:function(){i.textContent=o},redo:function(){i.textContent=a}};n.push(c)},e.prototype.removeAtDomSelected=function(){if(a.isChrome){var e=Array.prototype.slice.call(this.container.childNodes).filter((function(e){return(0,a.isNoEditableNode)(e)}));e.length&&e.forEach((function(e){return e.classList.remove("selected")}))}},e.prototype.undo=function(){if(0!==this.stateIndex){var e;if((0,a.isBrNode)(this.container.lastChild)){var t=this.container.childNodes.length;if(t>1){var n=Array.prototype.slice.call(this.container.childNodes,0,t-2);n.every((function(e){return(0,a.isTextNode)(e)&&(!e.length||(0,a.isTextSpace)(e))}))&&(e=this.container.lastChild,n.forEach((function(e){return e.remove})))}else(e=this.container.lastChild).remove()}this.disconnect();for(var i=this.stateList[this.stateIndex-1].range,o=this.stateList[this.stateIndex--],s=o.ops.length-1;s>=0;s--)o.ops[s].undo();e&&!(0,a.isBrNode)(this.container.lastChild)&&this.container.appendChild(e),r.setRangeByNode.apply(void 0,i).isUndo=!0,this.removeAtDomSelected(),this.onTextchangeRef.current&&this.onTextchangeRef.current(),this.observe()}},e.prototype.redo=function(){if(this.stateList.length-1!==this.stateIndex){this.disconnect();var e=this.stateList[++this.stateIndex],t=e.range;e.ops.forEach((function(e){e.redo()})),r.setRangeByNode.apply(void 0,t).isRedo=!0,this.removeAtDomSelected(),this.onTextchangeRef.current&&this.onTextchangeRef.current(),this.observe()}},e.ListenOption={childList:!0,subtree:!0,characterData:!0,characterDataOldValue:!0},e}();t.default=y},6645:function(e,t,n){},666:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkCanSetSize=t.removeHoverItem=t.addHoverItem=t.removeClass=t.addClass=void 0;var i=null;t.addClass=function(e,t){e.classList.add(t)};t.removeClass=function(e,t){e.classList.remove(t)};t.addHoverItem=function(e){i!==e&&(i&&(0,t.removeClass)(i,"hover"),i=e,(0,t.addClass)(e,"hover"))};t.removeHoverItem=function(e){i===e&&((0,t.removeClass)(i,"hover"),i=null)};t.checkCanSetSize=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),e&&!t}},677:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i={LOCAL:"LOCAL",FILTER:"FILTER",SELECTION:"SELECTION",SHAPE:"SHAPE"},o={CONTINUE:0,BLOCK:1,DONE:2}},691:function(e,t,n){"use strict";n.r(t),n.d(t,"isSpecialPlaceholder",(function(){return o})),n.d(t,"isInvalidPlaceholderInComment",(function(){return r})),n.d(t,"isFieldPlaceholder",(function(){return a}));var i=n(324),o=function(e){return new Set([i.g,i.f,i.j,i.l,i.m,i.k,i.i,i.q,i.a,i.d,i.e]).has(e)},r=function(e){return[i.g,i.f,i.m,i.k,i.i,i.q,i.a,i.d,i.e,i.n,i.p,i.o].includes(e)},a=function(e){return e===i.n||e===i.p||e===i.o}},698:function(e,t,n){"use strict";n.r(t),n.d(t,"getPureText",(function(){return a})),n.d(t,"getPureTextExcludeSpecialPlaceholder",(function(){return s})),n.d(t,"getDeletedTextFromString",(function(){return c})),n.d(t,"getDeletedTextFromRange",(function(){return u})),n.d(t,"getText",(function(){return d})),n.d(t,"filterSpecialPlaceholder",(function(){return m}));var i=n(691),o=n(760),r=n(324);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments[2],i=arguments[3],r=e.selection,a=e.doc,s="",l=n||r.getNormalRanges();l.length>1&&l.sort((function(e,t){return e.pos-t.pos}));for(var c=0;c<l.length;++c){var u=l[c];u.len<=0||(s+=Object(o.filterText)(a.getText(u.pos,u.len),t,i))}return s}function s(e,t){return a(e,i.isSpecialPlaceholder,t)}function l(e){return e!==r.q&&Object(i.isSpecialPlaceholder)(e)}function c(e){if(e&&1===e.length&&Object(i.isSpecialPlaceholder)(e.charCodeAt(0)))return e;var t=Object(o.filterTab)(Object(o.filterText)(e,l));return t.length>100?t.substr(0,50)+"..."+t.substr(t.length-50,50):t}function u(e,t,n){return c(a(e,void 0,[{pos:t,len:n}]))}function d(e){return a(window.APP.data,(function(e){return![13,10].includes(e)&&Object(i.isSpecialPlaceholder)(e)}),[e])}function m(e){return Object(o.filterText)(e,i.isSpecialPlaceholder)}},7141:function(e,t,n){"use strict";var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=n(238),m=n.n(d),p=n(2918),h=n(252),f=n.n(h),v=n(144),g=n.n(v),E=(n(9237),n(321)),w=n(1276),C=n(260),y=n(3787),b=n(1146),T=n(580),_=n(385),O=window.__WPSPLUGIN__.helper,P=O.types.ReportComment,N=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={visible:!1},n.handleEdit=function(){n.handleVisibleChange(!1),n.props.onEdit()},n.handleReply=function(){n.handleVisibleChange(!1),n.props.onReply()},n.handleReport=function(){var e=n.props.commentId;O.exec(P,{id:window.__WPSENV__.file_info.file.id,comment_id:e,scene:"comment"}),n.handleVisibleChange(!1)},n.handleVisibleChange=n.handleVisibleChange.bind(n),n.handleDelete=n.handleDelete.bind(n),n.handleInsertBookmark=n.handleInsertBookmark.bind(n),n}return u()(t,e),a()(t,[{key:"handleVisibleChange",value:function(e){this.props.onVisibleChange(e),this.setState({visible:e})}},{key:"handleDelete",value:function(){this.handleVisibleChange(!1),this.props.onDelete()}},{key:"handleInsertBookmark",value:function(){var e=this.props.commentRange;if(e){var t={type:w.default.Bookmark,data:{range:e}};console.log("[æ’å…¥ä¹¦ç­¾ä¿¡æ¯]",t),C.default.dispatchEvent(C.default.pcDialogs.WPS_SHOW_ALERT,t)}else window.Toast.info(_i18n("applications.writer.components.other.shareFail", "Sharing failed")),console.log("æ’å…¥ä¹¦ç­¾å¤±è´¥")}},{key:"renderPanel",value:function(){var e=this.props,t=e.showDel,n=void 0===t||t,i=e.showReply,o=void 0===i||i,r=e.showEdit,a=void 0===r||r,s=e.showBook,l=void 0!==s&&s,c=e.authorUserId,u=e.commentId,d=e.commentType,p=e.connected,h=e.delDisabled,f=e.editDisabled,v=e.replyDisabled,g=l&&Object(y.b)(),E=Object(b.checkReportVisible)({authorId:c,commentId:u}),w="text"===d&&E,C=Object(b.checkVisible)(u)===b.CommentShowType.visible;return m.a.createElement(T.default,{className:"wps-comment-more-panel"},g&&m.a.createElement(_.default,{onClick:this.handleInsertBookmark,disabled:!p},_i18n("applications.writer.components.other.insertBookmark", "Share the URL to this comment")),a&&m.a.createElement(_.default,{disabled:f||!C,onClick:this.handleEdit},_i18n("applications.writer.components.other.Comment.edit", "Edit")),n&&m.a.createElement(_.default,{disabled:h,onClick:this.handleDelete},_i18n("applications.writer.components.other.Comment.delete", "Delete")),o&&m.a.createElement(_.default,{disabled:v||!C,onClick:this.handleReply},_i18n("applications.writer.components.other.Comment.reply", "Reply")),w&&m.a.createElement(_.default,{onClick:this.handleReport},_i18n("applications.writer.components.other.Comment.report", "Report")))}},{key:"render",value:function(){var e=this.state.visible,t=this.props.children,n=this.renderPanel();return m.a.createElement(E.default,{panel:n,visible:e,onVisibleChange:this.handleVisibleChange},t||m.a.createElement("span",null,"moreBtn"))}}]),t}(d.PureComponent),I=n(9238),k=n.n(I),D=n(248),S=(n(9240),n(243)),A=n.n(S);function M(e){var t=e.connected,n=e.authorUserId,i=e.commentId,o=e.commentType,r=e.canEdit,a=e.disableReply,s=e.disableEdit,l=e.disableDelete,c=e.onReply,u=e.onEdit,p=e.onDelete,h=Object(d.useState)(!1),f=g()(h,2),v=f[0],E=f[1],w=Object(d.useCallback)((function(e){return E(!!e)}),[]),C=Object(d.useState)(!1),y=g()(C,2),T=y[0],_=y[1],O=Object(d.useCallback)((function(e){return _(!!e)}),[]),P=window.APP,I=!t,S=!1;t&&(S=P.info.userid!==n&&P.isReadOnlyComment());var M=i&&(!P.isReadOnly()||P.isReadOnlyComment()),L=u&&p&&c,x=Object(b.checkVisible)(i)===b.CommentShowType.visible;return m.a.createElement("div",{className:"comment-menu "+(t&&(v||T)?"active":""),onClick:function(e){return e.stopPropagation()}},M&&x&&r&&m.a.createElement(k.a,{comment_id:i,placement:"bottomRight",onVisible:w,trigger:"click",disabled:!t},m.a.createElement(A.a,{disabled:!t,icon:m.a.createElement(D.default,{type:D.default.types.size16.wps_comment_praise}),size:"small"})),L&&m.a.createElement(N,{onEdit:u,onDelete:p,onReply:c,onVisibleChange:O,showEdit:!(s||I)&&window.__CONFIG__.wps.hiddenDisableEditComment,delDisabled:l||S||I,editDisabled:s||I,replyDisabled:a||I,commentId:i,commentType:o,authorUserId:n},m.a.createElement(A.a,{icon:m.a.createElement(D.default,{type:D.default.types.size16.wps_more_btn}),size:"medium"})))}n(9241);var L=n(1170),x=function(e){function t(){var e,n,i,r;o()(this,t);for(var a=arguments.length,s=Array(a),c=0;c<a;c++)s[c]=arguments[c];return n=i=l()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),i.state={companyId:void 0,location:void 0},i.onMouseEnter=function(){if(!i.state.companyId){var e=i.props.commentId,t=window.APP.commentsDataManager.getCommentCache(e),n=t&&t.user_info&&t.user_info.attrs&&t.user_info.attrs.company_id,o=t&&t.user_info&&t.user_info.location;i.setState({companyId:n,location:o})}},r=n,l()(i,r)}return u()(t,e),a()(t,[{key:"render",value:function(){var e=this.props,t=e.username,n=e.avatar,i=e.time,o=e.isNormal,r=e.canEdit,a=e.disableReply,s=e.disableEdit,l=e.disableDelete,c=e.connected,u=e.isVoice,d=e.isDone,h=e.handleReply,v=e.handleEdit,g=e.handleDelete,E=e.isCooperating,w=e.isClientCmt,C=e.authorUserId,y=e.commentId,b=e.commentType,T=this.state,_=T.companyId,O=T.location,P=o?_i18n("applications.writer.components.other.comment", "Comment"):t,N={name:P,id:C,avatar:o?"":n,companyId:_};return m.a.createElement("div",{className:"comment-info",onMouseEnter:this.onMouseEnter},m.a.createElement("div",{className:"comment-user-info"},m.a.createElement(p.default,{showPanel:!Object(L.isTempCommentId)(y),companyId:_,avatar:o?"":n,userInfo:N,location:O,commentId:y,className:"comment-user-avatar"}),m.a.createElement(f.a,{title:P},m.a.createElement("span",{className:"user-name"},P))),m.a.createElement(M,{connected:c,isDone:d,isVoice:u,isCooperating:E,isClientCmt:w,canEdit:r,disableReply:a,disableEdit:s,disableDelete:l,onReply:h,onEdit:v,onDelete:g,authorUserId:C,commentId:y,commentType:b}),m.a.createElement("div",{className:"comment-time"},i))}}]),t}(d.PureComponent);t.a=x},7437:function(e,t,n){"use strict";var i=n(13),o=n.n(i),r=n(1),a=n.n(r),s=n(2),l=n.n(s),c=n(22),u=n.n(c),d=n(23),m=n.n(d),p=n(238),h=n.n(p),f=n(260),v=function(e){function t(e){a()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={didMount:!1},n.handleKeyDown=n.handleKeyDown.bind(n),n.handleCloseModal=n.handleCloseModal.bind(n),n.handleActive=n.handleActive.bind(n),n.originPos={top:0},n}return m()(t,e),l()(t,[{key:"componentDidMount",value:function(){this.props.visible&&this.show()}},{key:"shouldComponentUpdate",value:function(e,t,n){return!0}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.visible,i=t.position;if(n){var o=i===e.position;n===e.visible&&o||this.state.didMount&&o&&this.show()}}},{key:"handleCloseModal",value:function(e){this.props.visible&&!this.refs.container.contains(e.target)&&this.props.onClose()}},{key:"handleKeyDown",value:function(e){!this.props.visible||"Escape"!==e.code&&27!==e.keyCode||this.props.onClose()}},{key:"handleActive",value:function(e){var t=this,n=window.APP;if(n.data.selection.selContext.isParagraphSetting&&f.default.dispatchEvent(f.default.names.ON_EXIT_PARAGRAPH_SETTING_MODE,{noLocate:!0}),this.props.scrollToVisible(this.props.id),this.props.active){var i=n.workspace.revisionComment.dataHandler.data.find((function(e){return e.id===t.props.id})),o=i?i.range.pos:n.data.selection.begin.position;n.workspace.revisionComment.makeCommentAreaVisible(o,!0)}else this.props.onActive(e)}},{key:"getModal",value:function(){return this.refs.container}},{key:"getClassName",value:function(){var e=this.props.className,t="";return this.state.didMount&&(t+="did-mount"),e&&(t+=" "+e),t}},{key:"getStyle",value:function(){var e=this.props,t=e.position,n=e.initSize,i=e.active,r={left:0};return r=o()({},n,t),i&&(r.left=r.left||0),r}},{key:"show",value:function(){this.setState({didMount:!0})}},{key:"render",value:function(){if(!this.props.visible&&!this.state.didMount)return console.log("not did"),!1;var e=this.props,t=e.children,n=e.noInitStyle?this.props.style||{}:this.getStyle(),i=this.getClassName();return h.a.createElement("div",{ref:"container",className:i,tabIndex:"1",style:n,onKeyDown:this.handleKeyDown,onClick:this.handleActive},t)}},{key:"element",get:function(){return this.refs.container}}]),t}(h.a.Component);v.defaultProps={visible:!0,showCloseBtn:!0,transparentMask:!1},t.a=v},7530:function(e,t,n){"use strict";var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=(n(9235),n(238)),m=n.n(d),p=n(13),h=n.n(p),f=n(300),v=n.n(f),g=(n(9236),n(1578)),E=n(248),w=E.default.types.size16,C=function(e){function t(){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),a()(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.children,i=v()(e,["className","children"]),o="wps-simple-modal";return t&&(o+=" "+t),m.a.createElement(g.a,h()({className:o},i),m.a.createElement("div",{className:"modal-close-btn",onClick:i.onCancel,role:"button"},m.a.createElement(E.default,{type:w.close_white})),m.a.createElement("div",null,n))}}]),t}(d.PureComponent);C.defaultProps=g.a.defaultProps;var y=C,b=n(243),T=n.n(b),_=function(e){function t(e){o()(this,t);var n=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleOk=function(){n.props.onOk(),window.collection("comment_delete_ok")},n.calcTop=function(){var e=n.props,t=e.getContainer,i=e.anchor,o=t();return i?i.getBoundingClientRect().bottom-o.getBoundingClientRect().top:0},n}return u()(t,e),a()(t,[{key:"render",value:function(){var e=this.props,t=e.onCancel,n=e.getContainer,i={};return e.anchor&&(i.top=this.calcTop()),m.a.createElement(y,{className:"wps-comment-del-modal",bodyStyle:i,getContainer:n,onOk:this.handleOk,onCancel:t},m.a.createElement("div",{className:"message"},this.props.deleteTitle||_i18n("applications.writer.components.other.isDeleteComment", "Delete this comment?")),m.a.createElement("div",{className:"modal-btns"},m.a.createElement(T.a,{size:"large",type:"secondary",className:"cancel-btn btn",onClick:t},_i18n("applications.writer.components.other.cancel", "Cancel")),m.a.createElement(T.a,{size:"large",type:"primary",className:"delete-btn btn",onClick:this.handleOk,isAuto:!0},_i18n("applications.writer.components.other.delete", "Delete"))))}}]),t}(d.PureComponent);t.a=_},760:function(e,t,n){"use strict";n.r(t),n.d(t,"filterText",(function(){return o})),n.d(t,"filterTab",(function(){return r}));var i=n(324),o=function(e,t,n){var o="",r=[];if(e)for(var a=0;a<e.length;++a)e.charCodeAt(a)===i.n?r.push(!0):e.charCodeAt(a)===i.p?r[r.length-1]=!1:e.charCodeAt(a)===i.o?r.pop():0!==r.length&&(1!==r.length||r[0])||t&&t(e.charCodeAt(a))||(o+=n?n(e[a]):e[a]);return o},r=function(e){return e.replace(/\t/g," ")}},805:function(e,t,n){"use strict";n.r(t),n.d(t,"cleanUnknowProperties",(function(){return i})),n.d(t,"deepCopyer",(function(){return o})),n.d(t,"bSearchUpperBound",(function(){return r})),n.d(t,"assignStyle",(function(){return a})),n.d(t,"runOnce",(function(){return s})),n.d(t,"r2n",(function(){return l})),n.d(t,"n2r",(function(){return c})),n.d(t,"focusOnOtherInput",(function(){return d})),n.d(t,"addShadowRoot",(function(){return m}));var i=function(e){for(var t=Object.getOwnPropertyNames(e),n=0;n<t.length;n++){var i=t[n];(null===e[i]||void 0===e[i]||"number"==typeof e[i]&&isNaN(e[i]))&&delete e[i]}return e},o=function(e){return JSON.parse(JSON.stringify(e))},r=function(e,t,n,i,o){var r=n,a=t;if(a>r||i>e[r])return-1;for(var s=Math.floor((a+r)/2);a<r;)o(s,e,i)?r=s:a=s+1,s=Math.floor((a+r)/2);return s},a=function(e,t,n){t&&Object.assign(t,n);var i="";for(var o in t)i+=o+": "+t[o]+"; ";e.setAttribute("style",i)},s=function(e,t){var n=e;return function(){try{n&&n.apply(t||this,arguments)}catch(e){}finally{n=null}}},l=function(e){return e.replace(/(\r\n)|(\r)/g,"\n")},c=function(e){return e.replace(/(\r\n)|(\n)/g,"\r")},u=null,d=function(){u||((u=document.createElement("input")).classList.add("fake-pad-input"),a(u,{},{position:"fixed",top:0,left:0,opacity:0,"z-index":"-100"}),document.body.appendChild(u)),u.focus()},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"closed";if(e.attachShadow&&window.__CONFIG__.wps.enabledShadowDomForSvgRender){var n=e.attachShadow({mode:t});return n}return null}},812:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"c",(function(){return v}));var i=n(13),o=n.n(i),r=n(1),a=n.n(r),s=n(2),l=n.n(s),c=function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},u=500,d={START:"START",MOVE:"MOVE",END:"END",CANCEL:"CANCEL",LEAVE:"LEAVE",LONG_TAP:"LONG_TAP",TAP:"TAP",DOUBLE_TAP:"DOUBLE_TAP",FAST_DOUBLE_TAP:"FAST_DOUBLE_TAP",PRE_DOUBLE_TAP:"PRE_DOUBLE_TAP",TRIPLE_TAP:"TRIPLE_TAP",PRE_TRIPLE_TAP:"PRE_TRIPLE_TAP",SLIDE:"SLIDE",SWIPE:"SWIPE",SWIPE_LEFT:"SWIPE_LEFT",SWIPE_RIGHT:"SWIPE_RIGHT",SWIPE_UP:"SWIPE_UP",SWIPE_DOWN:"SWIPE_DOWN",PINCH:"PINCH",ROTATE:"ROTATE",FINISH:"FINISH"},m=1,p=2,h=3,f=4,v={MOUSE:"MOUSE",TOUCH:"TOUCH"},g=function(){function e(t,n,i){a()(this,e),this.lastInteractType="",this.lastInteractEndEvent=null,this.isDoubleEnd=!1,t instanceof HTMLElement?this.element=t:"string"==typeof t&&(this.element=document.querySelector(t)),this.element&&(this.selector=n,this.relatedEventTypes=i,this._initEventParams(),this._initEventListeners())}return l()(e,[{key:"_initEventParams",value:function(){this.interactInfo={},this.prevInteractInfo={},this.moveInteractInfo={},this.params={element:this.element,context:{}},this.handlers={},this.tapTimeout=null,this.longTapTimeout=null,this.doubleTapTimeout=null,this.isDoubleTap=!1,this.isTripleTap=!1,this.prevVector={}}},{key:"_initEventListeners",value:function(){this._interactStart=this._interactStart.bind(this),this._interactContinue=this._interactContinue.bind(this),this._interactEnd=this._interactEnd.bind(this),this._interactLeave=this._interactLeave.bind(this),this._interactCancel=this._interactCancel.bind(this),this.relatedEventTypes.includes(v.MOUSE)&&(this.element.addEventListener("mousedown",this._interactStart),this.element.addEventListener("mousemove",this._interactContinue),this.element.addEventListener("mouseup",this._interactEnd),this.element.addEventListener("mouseleave",this._interactLeave)),this.relatedEventTypes.includes(v.TOUCH)&&(this.element.addEventListener("touchstart",this._interactStart),this.element.addEventListener("touchmove",this._interactContinue),this.element.addEventListener("touchend",this._interactEnd),this.element.addEventListener("touchcancel",this._interactCancel))}},{key:"_isTarget",value:function(e){for(var t=e;t instanceof HTMLElement&&"BODY"!==t.tagName.toUpperCase();){if(t.matches(this.selector))return!0;t=t.parentNode}return!1}},{key:"on",value:function(e,t){return this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t),this}},{key:"off",value:function(e){this.handler[e]=[]}},{key:"destroy",value:function(){this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.doubleTapTimeout&&clearTimeout(this.doubleTapTimeout),this.relatedEventTypes.includes(v.MOUSE)&&(this.element.removeEventListener("mousedown",this._interactStart),this.element.removeEventListener("mousemove",this._interactContinue),this.element.removeEventListener("mouseup",this._interactEnd),this.element.removeEventListener("mouseleave",this._interactLeave)),this.relatedEventTypes.includes(v.TOUCH)&&(this.element.removeEventListener("touchstart",this._interactStart),this.element.removeEventListener("touchmove",this._interactContinue),this.element.removeEventListener("touchend",this._interactEnd),this.element.removeEventListener("touchcancel",this._interactCancel)),this.interactInfo=this.prevInteractInfo=this.moveInteractInfo=this.params=null}},{key:"_emit",value:function(e,t){if(this.handlers[e]||(this.handlers[e]=[]),!this.selector||this._isTarget(this.target)){this.selector&&(this.params.selector=this.selector);var n=o()({},this.params,{type:e,event:t});this.handlers[e].forEach((function(e){"function"==typeof e&&e(n)}))}}},{key:"_reset",value:function(){this.interactInfo={},this.moveInteractInfo={},this.prevVector={},this.params={element:this.element,context:{}},this.lastInteractEndEvent=null}},{key:"_checkIfDoubleTap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t=Math.abs,n=this.prevInteractInfo,i=this.interactInfo;return n&&n.time&&t(n.x-i.x)<15&&t(n.y-i.y)<15&&i.time-n.time<e}},{key:"_checkIfTripleTap",value:function(){return this.isDoubleTap&&this._checkIfDoubleTap(500)}},{key:"attachEventTarget",value:function(e){for(var t=this,n=function(n){t.element.contains(e)||t._interactContinue(n)},i=function(n){t.element.contains(e)||t._interactCancel(n)},o=!1,r=e.parentElement,a=void 0;!o&&r&&r!==document.body;)r.handleTouchEnd?(o=!0,a=r.handleTouchEnd):r=r.parentElement;e.addEventListener("touchcancel",i),e.addEventListener("touchmove",n),e.addEventListener("touchend",(function(o){t.element.contains(e)||("function"==typeof a&&a(o),console.warn("error, target node of touchEvent target has been removed!"),t._interactEnd(o)),a=null,e.removeEventListener("touchmove",n),e.removeEventListener("touchcancel",i)}),{once:!0})}},{key:"_interactStart",value:function(e){var t=this;this.lastInteractType=d.START,this.params.event=e,this.target=e.target,this.relatedEventTypes.includes(v.TOUCH)&&this.attachEventTarget(this.target);var n=e.touches,i=n&&n[0]||e,o=Date.now();this.interactInfo.x=i.pageX,this.interactInfo.y=i.pageY,this.interactInfo.time=o,this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout);var r=!0,a=n&&n.length>1;if(a&&(r=!1),e.isOneFingerTouch=r,this._emit(d.START,e),a){var s=n[1];this.prevVector={x:s.pageX-i.pageX,y:s.pageY-i.pageY},this.prevDistance=c(this.prevVector)}else this.longTapTimeout=setTimeout((function(){t._emit(d.LONG_TAP,e),t.isDoubleTap=!1,t.params.context.isLongTapped=!0,e.cancelable&&e.preventDefault()}),u),this.isTripleTap=this._checkIfTripleTap(),this.isDoubleTap=this._checkIfDoubleTap(),this.params.context.isDoubleTap=this.isDoubleTap,this.params.context.isTripleTap=this.isTripleTap,this.isTripleTap?this._emit(d.PRE_TRIPLE_TAP,e):this.isDoubleTap&&this._emit(d.PRE_DOUBLE_TAP,e),this.prevInteractInfo={x:this.interactInfo.x,y:this.interactInfo.y,time:this.interactInfo.time};this.isDoubleEnd&&this.lastInteractEndEvent&&this.lastInteractEndEvent.clientX===e.clientX&&this.lastInteractEndEvent.clientY===e.clientY&&e.timeStamp-this.lastInteractEndEvent.timeStamp<=100&&(console.error("ç‚¹å‡»å‡ºé—®é¢˜äº†ï¼Œå°è¯•é‡ç½®ï¼"),this._interactEnd(this.lastInteractEndEvent))}},{key:"_interactContinue",value:function(e){if(this.params&&this.params.event){var t=Math.abs,n=e.touches,i=n&&n[0]||e,o=!0;if(n&&n.length>1){o=!1;var r=n[1],a={x:r.pageX-i.pageX,y:r.pageY-i.pageY};if(void 0!==this.prevVector.x){if(this.prevDistance){var s=c(a);this.params.zoom=s/this.prevDistance,this.params.centrepoint={x:(r.pageX+i.pageX)/2,y:(r.pageY+i.pageY)/2},this._emit(d.PINCH,e)}this.params.angle=function(e,t){var n=c(e)*c(t);if(n){var i=(e.x*t.x+e.y*t.y)/n,o=Math.acos(Math.min(i,1));return 180*(o=e.x*t.y-t.x*e.y>0?-o:o)/Math.PI}return 0}(a,this.prevVector),this._emit(d.ROTATE,e)}this.prevVector.x=a.x,this.prevVector.y=a.y,this.params.context.isMultiTouch=!0}else{var l=i.pageX-this.interactInfo.x,u=i.pageY-this.interactInfo.y;this.params.diffX=l,this.params.diffY=u,isNaN(this.moveInteractInfo.x)?this.params.deltaX=this.params.deltaY=0:(this.params.deltaX=i.pageX-this.moveInteractInfo.x,this.params.deltaY=i.pageY-this.moveInteractInfo.y),(t(l)>15||t(u)>15)&&(this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.isDoubleTap=!1,this.isTripleTap=!1),this._emit(d.SLIDE,e),this.moveInteractInfo.x=i.pageX,this.moveInteractInfo.y=i.pageY}this.params.context.isMoved=Math.abs(this.params.diffX)>0||Math.abs(this.params.diffY)>0,e.isOneFingerTouch=o,this._emit(d.MOVE,e)}}},{key:"_interactEnd",value:function(e){var t=this;if(this.isDoubleEnd=!this.lastInteractType||this.lastInteractType===d.END,this.lastInteractType=d.END,this.lastInteractEndEvent=e,this.params&&this.params.event){this.longTapTimeout&&clearTimeout(this.longTapTimeout);var n=Math.abs,i=Date.now(),o=this.params,r=o.diffX,a=o.diffY;if(!isNaN(this.moveInteractInfo.x)&&n(r)>15||!isNaN(this.moveInteractInfo.y)&&n(a)>15)n(a)>n(r)?a<0?(this._emit(d.SWIPE_UP,e),this.params.direction=h):(this._emit(d.SWIPE_DOWN,e),this.params.direction=f):r<0?(this._emit(d.SWIPE_LEFT,e),this.params.direction=m):(this._emit(d.SWIPE_RIGHT,e),this.params.direction=p),this._emit(d.SWIPE,e),this._emit(d.FINISH,e),this.params.context.isSwiped=!0;else switch(this.params.context.isDoubleTap=this.isDoubleTap,this.params.context.isTripleTap=this.isTripleTap,!0){case this.isTripleTap:this.isDoubleTap=!1,this.isTripleTap=!1,this._emit(d.TRIPLE_TAP,e),this._emit(d.FINISH,e);break;case this.isDoubleTap:this.tapTimeout&&clearTimeout(this.tapTimeout),this._emit(d.FAST_DOUBLE_TAP,e),this.doubleTapTimeout=setTimeout((function(){t._emit(d.DOUBLE_TAP,e),t._emit(d.FINISH,e)}),0);break;default:i-this.interactInfo.time<500&&this.params.event.isOneFingerTouch&&(this.tapTimeout=setTimeout((function(){t.isDoubleTap=!1,t.isTripleTap=!1,t._emit(d.TAP,e),t._emit(d.FINISH,e)}),500))}this._emit(d.END,e),this._reset()}}},{key:"_interactCancel",value:function(e){this._emit(d.CANCEL,e),this._reset()}},{key:"_interactLeave",value:function(e){this._emit(d.LEAVE,e)}}]),e}();t.d=g},840:function(e,t,n){"use strict";var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=n(238),m=n.n(d),p=function(e){function t(){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),a()(t,[{key:"render",value:function(){var e=this.props.className,t="component-menu-divider";return e&&(t+=" "+e),m.a.createElement("div",{className:t})}}]),t}(d.PureComponent);t.a=p},9235:function(e,t,n){},9236:function(e,t,n){},9237:function(e,t,n){},9238:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(321)),a=i.__importDefault(n(580)),s=i.__importDefault(n(2165)),l=n(4722),c=n(1568);n(9239),t.default=(0,o.memo)((0,o.forwardRef)((function(e,t){var n=e.comment_id,i=e.placement,u=e.onVisible,d=e.children,m=e.trigger,p=e.onClick,h=e.disabled,f=(0,o.useState)(!1),v=f[0],g=f[1],E=(0,o.useCallback)((function(e){(0,l.commentEmojiReply)(n,e),u&&u(!1),g(!1)}),[n,u]),w=(0,o.useCallback)((function(e){n?(u&&u(!!e),g(!!e)):console.log("è¯¥è¯„è®ºæ²¡æœ‰comment_id")}),[n,u]),C=(0,o.useMemo)((function(){return o.default.createElement(a.default,{className:"wps-comment-emoji-panel"},o.default.createElement(s.default,{clickItem:E}))}),[E]);return(0,o.useImperativeHandle)(t,(function(){return{setVisible:g}}),[]),c.enableCommentEmojiReply&&o.default.createElement(r.default,{visible:v,onVisibleChange:w,trigger:m||r.default.triggerTypes.click,onClick:p,panel:C,placement:i||"topCenter",disabled:h},d||o.default.createElement("span",null,"button"))})))},9239:function(e,t,n){},9240:function(e,t,n){},9241:function(e,t,n){},9242:function(e,t,n){},9243:function(e,t,n){},9244:function(e,t,n){},9245:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importStar(n(238)),r=i.__importDefault(n(351)),a=i.__importDefault(n(6636)),s=i.__importDefault(n(6638)),l=n(6639);n(9246),t.default=(0,o.memo)((function(e){var t=e.onChange,n=(0,l.useWrapController)(),c=n.visible,u=n.handleClick,d=n.onVisibleChange,m=n.onChange,p=(0,o.useRef)(null),h=(0,o.useState)(void 0),f=h[0],v=h[1],g=(0,o.useCallback)((function(e){v(e),u()}),[u]),E=(0,o.useCallback)((function(e){!e&&v(void 0),d(e)}),[d]),w=(0,o.useCallback)((function(e){m(e),t&&t(e)}),[m,t]),C=(0,o.useCallback)((function(){var e=p&&p.current&&p.current.emojiList||[];return o.default.createElement("div",{className:"comment-emoji-reply-detail-wrap"},o.default.createElement("div",{className:"comment-emoji-reply-detail-title"},_i18n("applications.writer.components.Common.Comments.EmojiReply.emojiReplyDetail.replyDetail", "reply details")),o.default.createElement(s.default,{emojiList:e,selectedEmojiId:f,setClickEmojiId:v}))}),[f]);return o.default.createElement(o.default.Fragment,null,o.default.createElement(r.default,{visible:c,onVisibleChange:E,trigger:r.default.triggerTypes.click,panel:C(),placement:"leftBottom"},o.default.createElement(a.default,i.__assign({},e,{ref:p,onClick:g,onChange:w}))))}))},9246:function(e,t,n){},9247:function(e,t,n){},9248:function(e,t,n){},9249:function(e,t,n){},937:function(e,t,n){},938:function(e,t,n){},939:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.search=void 0;var i=n(5);t.search=function(e,t){if(!e)return t.map((function(e){return e.value}));for(var n=[],o=[],r=[],a=e.toLowerCase(),s=0;s<t.length;s++){var l=t[s],c=l.name.toLowerCase();if(c!==a){var u=c.indexOf(a);0===u?o.push(l.value):-1!==u&&r.push(l.value)}else n.push(l.value)}return i.__spreadArray(i.__spreadArray(i.__spreadArray([],n,!0),o,!0),r,!0)}},957:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),r=n(2),a=n.n(r),s=n(22),l=n.n(s),c=n(23),u=n.n(c),d=(n(1003),n(238)),m=n.n(d),p=n(240),h=n(250),f=n.n(h),v=n(248),g=function(e){function t(){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),a()(t,[{key:"renderAvators",value:function(e){var t=this.props.avatar,n=t&&t.length>0;return e.map((function(e,t){var i=!1===window.__CONFIG__.isEnableCorsAvatar?m.a.createElement("img",{src:e}):m.a.createElement("img",{crossOrigin:"anonymous",src:e});return m.a.createElement("div",{key:t,className:"avatar-img"},n?i:m.a.createElement(v.default,{type:e}))}))}},{key:"getAvators",value:function(){var e=this.props,t=e.avatar,n=e.iconType,i=[];return Array.isArray(t)?i=t:t?i.push(t):Array.isArray(n)?i=n:n?i.push(n):i=[v.default.types.other.avatar_default],i.slice(0,4)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.title,i=e.borderColor,o=e.borderOpacity,r=e.isSmall,a={};i&&(a.borderColor=Object(p.hex2Rgb)(i,o));var s=this.getAvators(),l="component-avatar avatar-length-"+s.length;return r&&(l+=" small-size"),t&&(l+=" "+t),m.a.createElement(f.a,{title:n},m.a.createElement("div",{className:l,style:a},this.renderAvators(s)))}}]),t}(d.PureComponent);g.iconTypes=v.default.types,g.defaultProps={borderOpacity:.75},t.default=g},966:function(e,t,n){"use strict";n.r(t),n.d(t,"CR_TYPE",(function(){return i})),n.d(t,"TEMP",(function(){return o})),n.d(t,"NOTIFY_TYPE",(function(){return r})),n.d(t,"DOC_TYPE",(function(){return a}));var i={revision:"revision",comments:"comments"},o="temp",r={deleteText:"DeleteText",insertText:"InsertText",setProp:"SetProp",insertComment:"InsertComment",insertComments:"InsertComments",insertCommentText:"InsertCommentText",removeComment:"RemoveComment",removeComments:"RemoveComments",deleteCommentText:"DeleteCommentText",delInsSame:"DelInsSame",updateComments:"UpdateComments"},a={head:"head",foot:"foot",main:"main"}}}]);