(window.webpackJsonp=window.webpackJsonp||[]).push([[577],{10462:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),i=n(2),o=n.n(i),l=n(22),c=n.n(l),r=n(23),u=n.n(r),d=n(238),p=n.n(d),m=n(240),S=n(252),f=n.n(S),h=n(227),v=n(82),w=n(13111),y=n.n(w),E=n(2544),_=function(e){function t(e){s()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={status:y.a.autoSave,visible:!1},n.disconnectBeforeStatus=y.a.autoSave,n.saveTimer=null,n.refFileStatus=p.a.createRef(),n.handleDocumentSaving=n.handleDocumentSaving.bind(n),n.handleDocumentSaveSuccess=n.handleDocumentSaveSuccess.bind(n),n.handleSaveVersion=n.handleSaveVersion.bind(n),n.handleClick=n.handleClick.bind(n),n.refreshCallback=null,n}return u()(t,e),o()(t,[{key:"componentDidMount",value:function(){window.addEventListener(h.default.names.cooper.ON_DOCUMENT_SAVEING,this.handleDocumentSaving),window.addEventListener(h.default.names.cooper.ON_DOCUMENT_SAVE_SUCCESS,this.handleDocumentSaveSuccess),window.addEventListener(h.default.names.file.ON_SAVE_VERSION,this.handleSaveVersion)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),clearTimeout(this.saveTimer),window.removeEventListener(h.default.names.cooper.ON_DOCUMENT_SAVEING,this.handleDocumentSaving),window.removeEventListener(h.default.names.cooper.ON_DOCUMENT_SAVE_SUCCESS,this.handleDocumentSaveSuccess),window.removeEventListener(h.default.names.file.ON_SAVE_VERSION,this.handleSaveVersion)}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.connected;if(n&&!e.connected)return clearTimeout(this.timer),void this._setStatus(this.disconnectBeforeStatus);!n&&e.connected&&(this.disconnectBeforeStatus=this.state.status,this._setStatus(y.a.disconnect),this.popToast())}},{key:"popToast",value:function(){m.isSupportOfflineEditing&&(clearTimeout(this.timer),this.timer=setTimeout((function(){window.Toast.info(_i18n("applications.public.components.commandbars.Header.HeaderLeft.FileInfo.FileStatus.offlineTips", "Disconnected from server, reconnecting ..."))}),6e3))}},{key:"handleDocumentSaving",value:function(){clearTimeout(this.saveTimer),this.handleSetStatus(y.a.saving)}},{key:"handleDocumentSaveSuccess",value:function(){var e=this;clearTimeout(this.saveTimer),this.saveTimer=setTimeout((function(){e.handleSetStatus(y.a.saveSuccess)}),500)}},{key:"handleSaveVersion",value:function(e){"ok"===e.detail.result?this.handleSetStatus(y.a.saveVSSuccess):e.detail.error&&this.handleSetStatus(y.a.saveVSFail)}},{key:"handleSetStatus",value:function(e){this.props.connected?this._setStatus(e):this.disconnectBeforeStatus=e}},{key:"_setStatus",value:function(e){this.setState({status:e}),this.refreshCallback&&this.refreshCallback(e)}},{key:"handleClick",value:function(){if(!this.getEnableStatus())return!1;h.default.dispatchEvent(h.default.names.cooper.ON_COOPER_VISIBLE_CHANGE)}},{key:"renderStatusEl",value:function(e){var t=e.title||e.text;return p.a.createElement(f.a,{title:t},p.a.createElement("span",{className:"status-text"},e.text))}},{key:"getReadOnlyStatus",value:function(){return this.readOnlyStatus?this.readOnlyStatus:this.readOnlyStatus=window.APP.isReadOnlyComment()?y.a.readOnlyComment:y.a.readOnly}},{key:"getEnableStatus",value:function(){var e=[v.default.pdf,v.default.ksheet],t=m.getPageOfficeType();return!(t===v.default.outline&&!window.__CONFIG__.isEnableCooperHistory)&&(!this.props.readonly&&!e.includes(t)&&window.__CONFIG__.isShowHistoryRecord)}},{key:"render",value:function(){var e=this.props,t=e.readonly,n=e.isAppReady,a=this.state.status,s="status-wrap";if(t&&!n)return null;t&&(a=this.getReadOnlyStatus(),s+=" is-read-only"),this.getEnableStatus()||(s+=" disable");var i=this.renderStatusEl(a);return p.a.createElement("div",{className:"file-status"},p.a.createElement("div",{className:s,onClick:this.handleClick},!!a.icon&&p.a.createElement(E.a,{size:16,fill:"var(--kd-color-icon-secondary)"}),i),p.a.createElement("div",{id:"file-status-other-tips"}))}}]),t}(d.PureComponent);t.default=_},13111:function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0});var s=n(5).__importDefault(n(82)),i="readOnly",o="readOnlyComment",l="autoSave",c="disconnect",r="saving",u="saveSuccess",d="saveVSSuccess",p="saveVSFail",m=function(e,t,n,a){void 0===n&&(n="save_success"),void 0===a&&(a=""),this.type=e,this.icon=n,this.text=t,this.title=a},S=window.officeType===s.default.whiteboard;t.default=((a={})[i]=new m(i,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.readonly", "Read-Only"),""),a[o]=new m(o,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.readonlyComment", "Can Comment"),""),a[l]=new m(l,""),a[c]=new m(c,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.disconnect", "Reconnecting..."),"disconnect",_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.disconnectTip", "Disconnected. Reconnectingâ€¦")),a[r]=new m(r,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saving", "Saving..."),"saving"),a[u]=new m(u,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveSuccess", "Saved successfully")),a[p]=new m(p,_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveFail", "Failed to save content"),"save_fail"),a[d]=new m(d,S?_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveSuccess", "Saved successfully"):_i18n("applications.public.components.commandbars.Header.FileInfo.FileStatus.saveVSSuccess", "Edition saved successfully")),a)},2544:function(e,t,n){"use strict";var a=n(238),s=n.n(a),i=n(239);t.a=Object(i.a)("cloud_sync",!1,(function(e){return s.a.createElement("svg",{width:e.size,height:e.size,viewBox:"0 0 16 16",fill:"none",strokeWidth:e.strokeWidth},s.a.createElement("g",{id:"group-0",stroke:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333",fill:e.colors&&"string"!=typeof e.colors&&e.colors[0]||"string"==typeof e.colors&&e.colors||"#333333"},s.a.createElement("path",{d:"M8.53809 8.14997L10.6851 10.1437C10.689 10.1472 10.6949 10.1472 10.6987 10.1437L14.9996 6.14997M14.9077 10.6624C14.5386 12.2618 13.1055 13.4543 11.3939 13.4543L5.0303 13.4543C2.80443 13.4543 1 11.6499 1 9.42402C1 7.55394 2.27367 5.98134 4.00086 5.52638C4.24873 3.53822 5.9447 1.99976 8 1.99976C9.81515 1.99976 11.35 3.1997 11.8547 4.84962",strokeLinecap:e.strokeLinecap,strokeLinejoin:e.strokeLinejoin,fill:"none",vectorEffect:"non-scaling-stroke"})))}))}}]);