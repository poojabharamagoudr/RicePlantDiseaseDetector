(window.webpackJsonp=window.webpackJsonp||[]).push([[567],{7253:function(e,n,t){"use strict";t.r(n);var o=t(1),i=t.n(o),r=t(2),a=t.n(r),c=t(623),s=t(240),u=t(167),f="pc",l="x",d="m",p="ipad",v=function(){function e(n){var t=this;i()(this,e),this.uploadIfNeed=function(){t.getConfig().then((function(e){var n=e.enable,o=e.interval;n&&(t.upload(),setInterval((function(){t.upload()}),1e3*o))})).catch((function(e){console.error("上报失败，无法获取配置",e)}))},this.upload=function(){if(!0===t.isUploading)return!1;var e=t.getData(),n=e.data,o=e.storeKeys;if(null===n)return!1;t.isUploading=!0;var i={office_type:s.getPageOfficeType(),version:window.__WPSENV__&&window.__WPSENV__.file_version?window.__WPSENV__.file_version:"20200101000000-0000000000"},r=f;u.isInMiniProgram?r=l:u.isMobile?r=d:u.isPad&&(r=p),i.device=r,i.data=n;var a=JSON.stringify(i);window.__WPSENV__.callAPI({method:"post",url:"/api/v3/office/jsmetric",body:a}).then((function(e){"ok"===e.body.result&&(o.forEach((function(e){t.storage.removeItem(e)})),t.storage.removeItem(c.reportIndexKey)),t.isUploading=!1})).catch((function(){console.error("数据上报失败，请稍后再试"),t.isUploading=!1}))},this.getData=function(){var e=t.getIndexCollection();if(!Array.isArray(e)||0===e.length)return{data:null};var n=[],o=[];e.forEach((function(e){var i=c.reportPrefix+"-"+e;o.push(i);var r=t.storage.getItem(i);n=n.concat(JSON.parse(r))}));var i={};return Object.values(c.TYPE).forEach((function(e){i[e]=[]})),n.forEach((function(e){var n=e.type,t=e.event,o=e.value;i[n].push({event:t,value:o})})),{data:i,storeKeys:o}},this.storage=n,this.isUploading=!1,this.uploadIfNeed()}return a()(e,[{key:"getIndexCollection",value:function(){var e=this.storage.getItem(c.reportIndexKey);return e&&Array.isArray(JSON.parse(e))?JSON.parse(e):[]}},{key:"getConfig",value:function(){return new Promise((function(e,n){window.__WPSENV__.callAPI({method:"get",url:"/api/v3/office/jsmetric/config"}).then((function(n){e(n.body)})).catch((function(e){console.error("获取配置信息失败",e),n(e)}))}))}}]),e}();n.default=v}}]);