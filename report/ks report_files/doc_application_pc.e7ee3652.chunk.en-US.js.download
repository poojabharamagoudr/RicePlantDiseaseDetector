(window.webpackJsonp=window.webpackJsonp||[]).push([[877],{10006:function(e,t,n){"use strict";var i=n(144),o=n.n(i),a=n(8),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(13),d=n.n(h),p=n(554),f=n(310),g=function(){function e(t,n){l()(this,e),this.document=t}return c()(e,[{key:"toDocumentPosition",value:function(e){return this.subdoc_offset+e}},{key:"cp2gcp",value:function(e){return this.toDocumentPosition(e)}},{key:"contain",value:function(e){return e>=this.subdoc_offset&&e<this.subdoc_offset+this.subdoc_size}},{key:"getTextSize",value:function(){return this.subdoc_size-1}}]),e}(),v=n(22),m=n.n(v),_=n(23),y=n.n(_),b=n(1103),T=n(1169),C=function(e){function t(e,n,i){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e+n,null,i))}return y()(t,e),t}(T.d),k=function(){function e(t,n){l()(this,e),Object(T.f)(this),this.document=n,this.rangeClass=new T.e(this.document,b.m);var i=this;t.forEach((function(e){i.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new C(e.pos,e.len,e.refId);this.rangeClass.attachNode(t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findRangeByRefId(e.refId)||this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.rangeClass.detachNode(t)}}]),e}(),w=n(309);function S(e,t){return t.begin==t.end?e.begin<t.begin&&t.begin<e.end:e.begin<=t.begin&&t.end<=e.end}var P=function(e){function t(e,n,i){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e+n,i))}return y()(t,e),c()(t,[{key:"name",get:function(){return this.getData().getName()},set:function(e){this.getData().setName(e)}},{key:"flag",get:function(){return this.getData().getFlag()},set:function(e){this.getData().setFlag(e)}},{key:"isPrivate",get:function(){return"_"===this.name.charAt(0)}}]),t}(T.d),I=function(){function e(){l()(this,e)}return c()(e,[{key:"config",value:function(e){this.name=e}},{key:"eq",value:function(e){return this.name===e._node.name}}]),e}(),E=function(){function e(t,n){l()(this,e),Object(T.f)(this),this.map={},this.data=[],this.doc=n,this.keyword=new I,this.rangeClass=new T.e(n,b.b,f.IT.upper,f.IT.Crossing,!0),this.rangeClass.deleteTest=S;var i=this;Object(p.default)(this),t.forEach((function(e){i.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new P(e.pos,e.len,e.data);this.rangeClass.attachNode(t),this.map[t.name]=t,this._dispatch("onBookmarksChange",t)}},{key:"doRemoveNakedRange",value:function(e){var t=e.data.getName();this.rangeClass.detachNode(this.findNode(e)),delete this.map[t],this._dispatch("onBookmarksChange")}},{key:"findNode",value:function(e){return this.keyword.config(e.data.getName()),this.rangeClass.findNode(e.pos,e.pos+e.len,this.keyword)}},{key:"getBookMark",value:function(e,t){var n=this.collectBookMarks(e,t);return n.length>0?n[0]:null}},{key:"collectBookMarks",value:function(e,t,n){return this.rangeClass.mapInRange(e,e+t,n,f.IT.strictIntersectTest)}},{key:"getBookmarkInfo",value:function(e){var t=this.map[e];if(t){var n={};if(n.range={pos:t.begin,len:t.end-t.begin},n.inComment=!1,this.doc.getSubDocType(t.begin)===w.Comment){n.inComment=!0;var i=this.doc.comments.getCommentByBookmarkPos(t.begin);n.comment_id=i.rc_id,n.commentRange={pos:i.pos,len:i.len}}return n}return null}},{key:"getBookmarkByCommentBody",value:function(e){var t=this.rangeClass.collectRanges(e.pos,e.len);if(t&&t.length>0){var n=t.filter((function(e){return-1===e.data.private.name.indexOf("_link")})),i=void 0;if(n&&n.length>0&&(i=n[0]),!i)return null;var o=!1;return i.len>e.len?e.pos>i.pos&&e.pos+e.len==i.pos+i.len&&(o=!0):o=!0,o?i:null}}}]),e}(),O=n(4581),x=n(1168),R=n(410),N=n(6109),A=n(4969),D=n(2010),M=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.rawField=e,i.doc=n,i.result="",i}return y()(t,e),c()(t,[{key:"getRawResult",value:function(){var e=this.rawField.resultBegin,t=this.rawField.resultEnd;return this.doc.getText(e,t-e)}},{key:"getCode",value:function(){var e=this.rawField.codeBegin,t=this.rawField.codeEnd;return this.doc.getText(e,t-e)}},{key:"setResult",value:function(e){this.result!=e&&(this.result=e)}},{key:"getResult",value:function(){return this.result}},{key:"getType",value:function(){return this.rawField.type}},{key:"showCodes",value:function(){return this.rawField.showCodes}},{key:"getRange",value:function(){return{pos:this.rawField.pos,len:this.rawField.len}}},{key:"getCodeRange",value:function(){var e=this.rawField.codeBegin;return{pos:e,len:this.rawField.codeEnd-e}}},{key:"getResultRange",value:function(){var e=this.rawField.resultBegin;return{pos:e,len:this.rawField.resultEnd-e}}},{key:"setParam",value:function(e){this.param=e}},{key:"getParam",value:function(){return this.param}},{key:"hasParsed",value:function(){return this.lex}},{key:"onParseFinish",value:function(e){this.lex=e}},{key:"convertGcp2Cp",value:function(e){var t=e;return(t=this.showCodes()?e-this.getCodeRange().pos:e-this.getResultRange().pos)<0&&(t=0),t}},{key:"getTextSize",value:function(){return(this.showCodes()?this.getCode():this.getResult()).length}},{key:"getText",value:function(e,t){var n=void 0,i=t;return i>(n=this.showCodes()?this.getCode():this.getResult()).length&&(i=n.length),n=n.substr(e,i)}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=e;if(this.showCodes()){var i=this.getCodeRange();(n=i.pos+n)>i.pos+i.len&&(n=i.pos+i.len)}else{var o=this.getResultRange();(n=o.pos+n)>o.pos+o.len&&(n=o.pos+o.len)}var a=this.doc.getDataLogic("final").getChpx(n,t);if("TOC"===this.rawField.type&&this.rawField.isTranslated){var r=n>0?n-1:n;a=this.doc.getDataLogic("final").getChpx(r,t)}var s=D.b.make(!0,a.pos,a.len,a.prop.duplicate());return s.pos=this.convertGcp2Cp(s.pos),s}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=e;if(this.showCodes()){var i=this.getCodeRange();(n=i.pos+n)>i.pos+i.len&&(n=i.pos+i.len)}else{var o=this.getResultRange();(n=o.pos+n)>o.pos+o.len&&(n=o.pos+o.len)}var a=this.doc.getDataLogic("final").getPapx(n,t),r=D.b.make(!0,a.pos,a.len,a.prop.duplicate());return r.pos=this.convertGcp2Cp(r.pos),r}},{key:"getGcpRange",value:function(){return{pos:this.rawField.pos,len:this.rawField.len}}},{key:"clone",value:function(){var e=new t,n=this;return Object.keys(n).forEach((function(t){e[t]=n[t]})),e}},{key:"textPartType",get:function(){return A.b.Field}}]),t}(A.a),L=function(e){function t(e,n){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return y()(t,e),c()(t,[{key:"formatResult",value:function(e){if(!this.hasParsed())return e;var t=this.section;t||(t=this.doc.sections.getSection(this.rawField.pos));var n=t.getPageNumFormat(),i=N.a.numberFormat(e,n)+"";return this.setResult(i),i}}]),t}(M),F=function(e){function t(e,n){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return y()(t,e),c()(t,[{key:"setResult",value:function(e){this.result!=e&&(this.result=e)}},{key:"formatResult",value:function(e){if(!this.hasParsed())return e;var t=this.section;t||(t=this.doc.sections.getSection(this.rawField.pos));var n=t.getPageNumFormat(),i=N.a.numberFormat(e,n)+"";return this.setResult(i),i}}]),t}(M),B=function(e){function t(e,n){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return y()(t,e),c()(t,[{key:"setTranslateStr",value:function(e){this.setResult(e)}}]),t}(M),H=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.maxLength=e.formFieldData?e.formFieldData.getMaxLength():0,i}return y()(t,e),t}(M),G=function(){function e(){l()(this,e)}return c()(e,null,[{key:"reset",value:function(){e.fieldArray=[]}},{key:"addField",value:function(t,n){var i=t.type,o=void 0;return"PAGE"==i?o=new L(t,n):"NUMPAGES"==i||"SECTIONPAGES"==i?o=new F(t,n):"PAGEREF"==i||"TOC"==i?o=new B(t,n):"FORMTEXT"==i&&(o=new H(t,n)),o&&e.fieldArray.push(o),o}},{key:"removeField",value:function(t){var n=e.fieldArray.find((function(e){return e.rawField===t}));n&&e.fieldArray.splice(e.fieldArray.indexOf(n),1)}},{key:"getFields",value:function(){return e.fieldArray}}]),e}();G.fieldArray=[];var W=G,j=function(){function e(t,n,i,o){l()(this,e),this.doc=o,this.init(t,n,i)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:T.d,methodName:"init"},{baseName:"DOCRange",base:T.d,methodName:"onExpand"},{baseName:"DOCRange",base:T.d,methodName:"onRemove"}]}}]),c()(e,[{key:"init",value:function(e,t,n){this.mixin_DOCRange_init(e,e+t,n)}},{key:"onExpand",value:function(e,t){this.mixin_DOCRange_onExpand(e,t)}},{key:"onRemove",value:function(e,t){this.mixin_DOCRange_onRemove(e,t)}},{key:"isTranslateField",value:function(){this.isTranslated=!1;var e=this.doc.getDataLogic("final").getText(this.resultBegin,this.resultEnd-this.resultBegin);return("TOC"===this.type&&0===e.indexOf("错误！未找到目录项")||"PAGEREF"===this.type&&0===e.indexOf("错误！未定义书签"))&&(this.isTranslated=!0),this.isTranslated}},{key:"getTranslateResult",value:function(){var e=this.doc.getDataLogic("final").getText(this.resultBegin,this.resultEnd-this.resultBegin);return"PAGEREF"===this.type&&this.isTranslated&&0===e.indexOf("错误！未定义书签")?_i18n("applications.writer.components.core.app.command.pageNumError", "The page number is wrong, please check the directory!"):"TOC"===this.type&&this.isTranslated&&0===e.indexOf("错误！未找到目录项")?_i18n("applications.writer.components.core.app.command.noContentEntriesError", "Please set a title for the content of the article node, and update the table of contents after completing the setting to display it correctly."):e}},{key:"sepDistance",get:function(){var e=this.getData().getSep();return e<0?this.end-this.begin:e+1},set:function(e){this.getData().setSep(e-1)}},{key:"type",get:function(){return this.getData().getType()},set:function(e){this.getData().setType(e)}},{key:"locked",get:function(){return this.getData().getLocked()},set:function(e){this.getData().setLocked(e)}},{key:"showCodes",get:function(){return this.getData().getShowCodes()},set:function(e){this.getData().setShowCodes(e)}},{key:"needUpdate",get:function(){return this.getData().getNeedUpdate()},set:function(e){this.getData().setNeedUpdate(e)}},{key:"sep",get:function(){var e=this.getData().getSep();return e<0?this.end-1:this.begin+e}},{key:"codeBegin",get:function(){return this.begin+1}},{key:"codeEnd",get:function(){return this.sep}},{key:"resultBegin",get:function(){return this.getData().getSep()<0?this.sep:this.sep+1}},{key:"resultEnd",get:function(){return this.end-1}},{key:"formFieldData",get:function(){var e=this.getData();return e.private&&e.private.formFieldData}}]),e}(),U=f.ITHintVTProto.ithintvt_beHint;function V(){return J.make(this._node,this._tree,this._originPosition)}function Y(){var e=this._node.getData().getSep();return e<0?this.end-1:this.begin+e}function z(){var e=this._node;return{showCode:e.showCode,type:e.type}}function K(e){return U(e),Object.defineProperties(e,{clone:{value:V},sep:{get:Y},attrs:{get:z}})}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={};return K(i),i.init(e,t,n),i}function X(e){return J.make(e._node,e._tree,e._originPosition)}function q(e){return"<"+e.begin+", "+e.sep+", "+e.end+">"}var J=f.ITToolkit.doAsTheToolkitDo(new function(){var e=new f.ITHintVTProto;return e.beHint=K,e.newobj=Z,e.clone=X,e.toString=q,e});x.a.buildVT(J,"FieldHint");var Q={config:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Exclude;Q.pos=e,Q.rule=t},eq:function(e){return f.IT.Include===Q.rule&&Q.pos===e.begin}},$=function(){function e(t,n){l()(this,e),W.reset(),Object(T.f)(this),Object(p.default)(this),this.rangeClass=new T.e(n,b.j,f.IT.outer,f.IT.Nesting,!0,J),this.rangeClass.attachObserver(this),this.doc=n;var i=this;t.forEach((function(e){i.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new j(e.pos,e.len,e.data,this.doc);this.rangeClass.attachNode(t)}},{key:"doRemoveNakedRange",value:function(e){this.rangeClass.detachNode(this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len))}},{key:"getField",value:function(e){return this.rangeClass.findNodeContainPos(e)}},{key:"getAllFields",value:function(){var e=[];return this.rangeClass.forEachNode((function(t){e.push(t)})),e}},{key:"getInnerField",value:function(e){var t=this.getFields({begin:e,end:e}),n=null,i=0,o=0;return t&&t.forEach((function(e){var t=e._node;(0===o||t.pos>i)&&(i=t.pos,n=t),++o})),n}},{key:"getEqField",value:function(e){return Q.config(e,f.IT.Include),this.rangeClass.findNode(e,e,Q)}},{key:"getFields",value:function(e){var t=e.begin,n=e.end;return this.rangeClass.mapInRange(t,n,(function(e){return e.clone()}),f.IT.strictIntersectTest)}},{key:"onAttachNode",value:function(e,t){t.fieldObj=W.addField(t,this.doc),this._dispatch("onAddField",t)}},{key:"onDetachNode",value:function(e,t){W.removeField(t),this._dispatch("onDeleteField",t)}}]),e}();R.a.mix(j,T.d);var ee=n(952),te=n(1804),ne=function(){function e(t,n,i,o){l()(this,e),this.init(t,n,i,o)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:T.d,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i){this.mixin_DOCRange_init(e,t,n,i)}},{key:"getShapeInfo",value:function(){var e=this.refId,t=window.APP.data.doc,n=t.getSubDocType(this.begin),i=t.layer,o=n===w.Textbox?[te.d,te.c]:[te.b,te.a],a=void 0,r=[];return o.some((function(t){if(function t(n){for(var i=n.childs,o=0,a=i.getLength();o<a;++o){r.push(o);var s=i.at(o),l=s.textRange;if(l&&l.refId===e)return!0;if(s.childs&&s.childs.getLength()>0&&t(s))return!0;r.pop()}return!1}(i.getShapeTree(t)))return a=t,!0})),{shapeTreeType:a,shapeIdxPath:r}}}]),e}(),ie=function(){function e(t,n){var i=this;l()(this,e),Object(T.f)(this),this.document=n,this.rangeClass=new T.e(n,b.t,f.IT.upper,f.IT.NonIntersect,!0),ee.a.bind(this.rangeClass,"attacher",(function(e){return new T.c(e,e.sortby,e.refIds)})),t.forEach((function(e){i.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new ne(e.pos,e.pos+e.len,void 0,e.refId);this.rangeClass.attachNode(t),this._linkAnchor(t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.rangeClass.detachNode(t)}},{key:"getTextboxAnchor",value:function(e){var t=this.document.anchors.findAnchor(e)||this.document.inlineAnchors.findAnchor(e);return t&&t.shapeData&&t.shapeData.hasTextbox&&t.body&&!t.shapeData.hasArtWord?t:null}},{key:"findBodyRange",value:function(e){var t=this.getTextboxAnchor(e);return t?{pos:t.body.pos,len:t.body.len}:null}},{key:"getTextbox",value:function(e){return this.rangeClass.findNodeContainPos(e)}},{key:"isInTextbox",value:function(e){var t=this.getTextbox(e);return!!t&&{pos:t.pos,len:t.len}}},{key:"_linkAnchor",value:function(e){if(this.document.anchors){var t=!1,n=function(n){if(n.body&&n.body.refId===e.refId)return n.body=e,t=!0};this.document.anchors.rangeClass.forEachNode(n),!t&&this.document.inlineAnchors.rangeClass.forEachNode(n)}}}]),e}();R.a.mix(ne,T.d);var oe=n(260),ae=function(e){function t(e,n,i,o,a){l()(this,t);var r=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e+n,i));return i.on(r.onAnchorDataChanged.bind(r)),r.refShapeObjId=o,r.nakedShapeData=a,r.onShapeDataChanged=r.onShapeDataChanged.bind(r),r}return y()(t,e),c()(t,[{key:"cloneData",value:function(){return this.shapeData&&this.shapeData.hasTextbox&&(this.shapeData.textRange={pos:this.body.pos,len:this.body.len,refId:this.body.refId}),{pos:this.pos,len:this.len,shapeId:this.shapeId,anchorData:this.getData(),shapeData:this.shapeData,refShapeObjId:this.refShapeObjId}}},{key:"hasVaildEffectExtents",value:function(){var e=this.effectExtents,t=e.left,n=e.top,i=e.right,o=e.bottom;return t||n||i||o}},{key:"onAnchorDataChanged",value:function(e){delete this._refShapeObj,this.pos>=0&&this.len&&window.APP.data.doc._dispatch("onChpxChanged",{pos:this.pos,len:this.len}),oe.default.dispatchEvent(oe.default.edit.ON_ANCHOR_DATA_CHANGED,{anchor:this})}},{key:"onShapeDataChanged",value:function(e){delete this._refShapeObj,this.pos>=0&&this.len&&window.APP.data.doc._dispatch("onChpxChanged",{pos:this.pos,len:this.len}),oe.default.dispatchEvent(oe.default.edit.ON_SHAPE_DATA_CHANGED,{shapeData:this.shapeData,shapeDataObj:this.shapeDataObj})}},{key:"shapeData",get:function(){var e=this;if(!this.refShape){var t=window.APP.data.doc.layer,n=this.refShape=t.findShapeByRefId(this.refShapeObjId);if(n){!function t(n){n&&n.on(e.onShapeDataChanged),n.vector&&n.vector.forEach((function(e){e&&t(e)}))}(n)}}return this.refShape&&this.refShape.private||this.nakedShapeData}},{key:"shapeDataObj",get:function(){return!this._refShapeObj&&window.APP.drawingTools&&this.shapeData&&(this._refShapeObj=window.APP.drawingTools.createShape(this.shapeData)),this._refShapeObj}},{key:"shapeId",get:function(){return this.shapeData&&this.shapeData.shapeId}},{key:"body",get:function(){if(this.shapeData&&this.shapeData.hasTextbox){if(!this._body){var e=window.APP.data.doc.textboxs,t=this.shapeData.textRange;t.refId&&(this._body=e.rangeClass.findRangeByRefId(t.refId)),this._body||(this._body=new ne(t.pos,t.pos+t.len),e.rangeClass.attachNode(this._body)),this._body&&(this._body.anchor=this)}return this._body}},set:function(e){this._body=e,e.anchor=this}},{key:"wrapMode",get:function(){return this.getData().getWrapMode()}},{key:"allowover",get:function(){return this.getData().getAllowover()}},{key:"distanceBottom",get:function(){return this.getData().getDistanceBottom()}},{key:"distanceLeft",get:function(){return this.getData().getDistanceLeft()}},{key:"distanceRight",get:function(){return this.getData().getDistanceRight()}},{key:"distanceTop",get:function(){return this.getData().getDistanceTop()}},{key:"horzAlign",get:function(){return this.getData().getHorzAlign()}},{key:"horzRel",get:function(){return this.getData().getHorzRel()}},{key:"horzRuleAlign",get:function(){return this.getData().getHorzRuleAlign()}},{key:"horzRulePctSizeWidth",get:function(){return this.getData().getHorzRulePctSizeWidth()}},{key:"layer",get:function(){return this.getData().getLayer()}},{key:"lock",get:function(){return this.getData().getLock()}},{key:"pctRelHorzPos",get:function(){return this.getData().getPctRelHorzPos()}},{key:"pctRelVertPos",get:function(){return this.getData().getPctRelVertPos()}},{key:"pctSizeHorzRel",get:function(){return this.getData().getPctSizeHorzRel()}},{key:"pctSizeVertRel",get:function(){return this.getData().getPctSizeVertRel()}},{key:"relHorzPos",get:function(){return this.getData().getRelHorzPos()}},{key:"relVertPos",get:function(){return this.getData().getRelVertPos()}},{key:"sizeHorz",get:function(){return this.getData().getSizeHorz()}},{key:"sizeHorzRel",get:function(){return this.getData().getSizeHorzRel()}},{key:"sizeVert",get:function(){return this.getData().getSizeVert()}},{key:"sizeVertRel",get:function(){return this.getData().getSizeVertRel()}},{key:"vertAlign",get:function(){return this.getData().getVertAlign()}},{key:"vertRel",get:function(){return this.getData().getVertRel()}},{key:"wrapSide",get:function(){return this.getData().getWrapSide()}},{key:"zorder",get:function(){return this.getData().getZorder()}},{key:"isHorizontalRule",get:function(){return this.getData().getIsHorizontalRule()}},{key:"flags",get:function(){return this.shapeData.flags}},{key:"effectExtents",get:function(){return this.getData().getEffectExtents?this.getData().getEffectExtents():{left:0,right:0,top:0,bottom:0}}},{key:"effectExtentLeft",get:function(){return this.effectExtents.left}},{key:"effectExtentRight",get:function(){return this.effectExtents.right}},{key:"effectExtentTop",get:function(){return this.effectExtents.top}},{key:"effectExtentBottom",get:function(){return this.effectExtents.bottom}},{key:"outlineWidth",get:function(){return this.shapeData.outline&&this.shapeData.outline.width?this.shapeData.outline.width*(1/635):0}},{key:"layoutInCell",get:function(){return this.getData().getLayoutInCell()}}]),t}(T.d),re=function(){function e(){l()(this,e)}return c()(e,[{key:"config",value:function(e){this.shapeId=e}},{key:"eq",value:function(e){return e._node.shapeId==this.shapeId}}]),e}(),se=function(){function e(){l()(this,e)}return c()(e,[{key:"config",value:function(e,t){this.shapeTreeType=e,this.shapeId=t}},{key:"eq",value:function(e){return e._node.shapeData.shapeTreeType===this.shapeTreeType&&e._node.shapeId==this.shapeId}}]),e}(),le=function(){function e(t,n,i){l()(this,e),Object(T.f)(this),this.rangeClass=new T.e(i,n,f.IT.outer,f.IT.NonIntersect,!0),this.idKeyword=new re,this.idKeyword2=new se,this.textboxs=i.textboxs,Object(p.default)(this),this.rangeClass.attachObserver(this);var o=this;t.forEach((function(e){o.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new ae(e.pos,e.len,e.anchorData,e.refShapeObjId,e.shapeData);this.rangeClass.attachNode(t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.rangeClass.detachNode(t)}},{key:"onAttachNode",value:function(e,t){this._dispatch("onAnchorInsert",t)}},{key:"onDetachNode",value:function(e,t){this._dispatch("onAnchorDelete",t)}},{key:"findAnchor",value:function(e){return this.rangeClass.findNodeContainPos(e)}},{key:"getAnchorPos",value:function(e,t,n){var i=this.rangeClass.HintVT.it_hint1,o=this.idKeyword;return o.config(e),this.rangeClass.fetchHint(i,t,t+n,o),i.good()&&i.pos}},{key:"getAnchor",value:function(e,t,n){var i=this.rangeClass.HintVT.it_hint1,o=this.idKeyword;return o.config(e),this.rangeClass.fetchHint(i,t,t+n,o),i.good()&&{anchor:i._node,pos:i.pos}}},{key:"getAnchor2",value:function(e,t,n,i){var o=this.rangeClass.HintVT.it_hint1,a=this.idKeyword2;return a.config(e,t),this.rangeClass.fetchHint(o,n,n+i,a),o.good()&&{anchor:o._node,pos:o.pos}}},{key:"getAnchors",value:function(e,t){return this.rangeClass.mapInRange(e,e+t,(function(e){return{anchor:e._node,pos:e.pos}}),f.IT.strictIntersectTest)}}]),e}(),ue=n(3828),ce=n(4575),he=n(811),de=function(){function e(t,n){l()(this,e),this.nextLayer=null}return c()(e,[{key:"insertLayerAfter",value:function(e){this.nextLayer=e}},{key:"getPapxTbl",value:function(){return this.nextLayer.getPapxTbl()}},{key:"getChpxTbl",value:function(){return this.nextLayer.getChpxTbl()}},{key:"insertText",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;this.nextLayer.insertText(e,t,n,i,o,a)}},{key:"insertParagraph",value:function(e,t,n){this.nextLayer.insertParagraph(e,t,n)}},{key:"insertPlaceholder",value:function(e,t,n){this.nextLayer.insertPlaceholder(e,t,n)}},{key:"deleteText",value:function(e,t){return this.nextLayer.deleteText(e,t)}},{key:"setTextProp",value:function(e,t,n){this.nextLayer.setTextProp(e,t,n)}},{key:"setParaProp",value:function(e,t,n){this.nextLayer.setParaProp(e,t,n)}},{key:"getText",value:function(e,t){return this.nextLayer.getText(e,t)}},{key:"getTextSize",value:function(){return this.nextLayer.getTextSize()}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include;return this.nextLayer.getChpx(e,t)}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include;return this.nextLayer.getPapx(e,t)}},{key:"getPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include;return this.nextLayer.getPap(e,t)}},{key:"update",value:function(e){this.nextLayer.update(e)}},{key:"doInsertText",value:function(e,t){this.nextLayer.doInsertText(e,t)}},{key:"doDeleteText",value:function(e,t){this.nextLayer.doDeleteText(e,t)}},{key:"doModifyChpx",value:function(e,t){this.nextLayer.doModifyChpx(e,t)}},{key:"doModifyPapx",value:function(e,t){this.nextLayer.doModifyPapx(e,t)}},{key:"doSplitPara",value:function(e,t){this.nextLayer.doSplitPara(e,t)}}]),e}(),pe=n(6104),fe=f.ITHintVTProto.ithintvt_beHint;function ge(){return Te.make(this._node,this._tree,this._originPosition)}function ve(){return this._node.prop}function me(e){return fe(e),Object.defineProperties(e,{clone:{value:ge},prop:{get:ve}})}function _e(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={};return me(i),i.init(e,t,n),i}function ye(e){return Te.make(e._node,e._tree,e._originPosition)}var be=function(e){function t(){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,f.IT.upper,f.IT.NonIntersect,!0,Te))}return y()(t,e),c()(t,[{key:"makeNode",value:function(e,t,n){var i=new f.ITRange(e,t);return i.prop=n,i}},{key:"getProps",value:function(e,t,n){return this.mapInRange(e,e+t,n||function(e){return e._node.prop},f.IT.strictIntersectTest)}},{key:"reset",value:function(e,t,n){var i=this;n.forEach((function(e){i.attachNode(i.makeNode(e.pos,e.pos+e.len,e.prop))}))}},{key:"print",value:function(){for(var e=[],t=this.tree.makeHintAtHead();t.good();)e.push("["+t.pos+", "+(t.pos+t.len)+")"),t.moveNext();return e}}]),t}(f.ITToolkit),Te=f.ITToolkit.doAsTheToolkitDo(new function(){var e=new f.ITHintVTProto;return e.beHint=me,e.newobj=_e,e.clone=ye,e});x.a.buildVT(Te,"DOCPropHint");var Ce=function(e){function t(e){l()(this,t);var n=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,f.IT.upper,f.IT.NonIntersect,!0,Te));return n.size=e,e>0&&n.attachNode(n.makeNode(0,e,null)),n}return y()(t,e),c()(t,[{key:"update",value:function(e,t,n){this.reset(e,t,n)}},{key:"makeNode",value:function(e,t,n){return this.makeNode2(e,t,this.makeProp(n))}},{key:"makeNode2",value:function(e,t,n){var i=new f.ITRange(e,t);return i.prop=n,i}},{key:"makeProp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(new he.c).initFromServer(e,t)}},{key:"getProps",value:function(e,t,n){return this.mapInRange(e,e+t,n||function(e){return e._node.prop},f.IT.strictIntersectTest)}},{key:"split",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=this.fetchHintContainPos(this.HintVT.it_hint1,e),i=n.begin,o=n.end;this.detachNode(n._node),this.attachNode(this.makeNode2(i,e,t||n._node.prop)),this.attachNode(this.makeNode2(e,o,n._node.prop))}},{key:"collectProperites",value:function(e,t){return this.mapInRange(e,e+t,(function(e){return{pos:e.pos,len:e.len,prop:e._node.prop.duplicate()}}),f.IT.strictIntersectTest)}},{key:"modifyProp",value:function(e,t,n){this.forEachHintInRange(e,e+t,(function(e){e._node.prop=n(e._node.prop.duplicate())}),f.IT.strictIntersectTest)}},{key:"safeMerge",value:function(e,t){var n=this,i=e,o=e+t,a={begin:i,end:o},r=[],s=void 0;return this.forEachHintInRange(i,o,(function(e){f.IT.calcBoundary(a,e),r.push(e._node)}),(function(e,t){return t.begin<=o&&i<t.end})),r.length>1&&(r.forEach((function(e){n.detachNode(e)})),(s=r.pop()).reset(a.begin,a.end),this.attachNode(s),a)}},{key:"safeSplit",value:function(e){e!==this.fetchHintContainPos(this.HintVT.it_hint1,e).begin&&this.split(e)}},{key:"reset",value:function(e,t,n){var i=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=n[n.length-1],r=n[0].pos,s=a.pos+a.len;this.safeSplit(r),this.safeSplit(s),this.detachNodes(r,s,f.IT.strictIntersectTest),n.forEach((function(e){var t=e.prop||i.makeProp(e.propBag,o);i.attachNode(i.makeNode2(e.pos,e.pos+e.len,t))}))}}]),t}(f.ITToolkit),ke=n(145),we=n.n(ke),Se=function(e){function t(e){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return y()(t,e),c()(t,[{key:"makeProp",value:function(e){return(new he.a).initFromServer(e)}},{key:"insert",value:function(e,n,i){if(i){var o=this.mapInRange(e,e,f.IT.mapToRangeAndNode),a=o.pop();if(a&&t.isPropEqual(a.node.prop,i))this.expand(e,n);else{if(a.begin==e){if(o.length&&t.isPropEqual(o[0].node.prop,i))return void this.expand(e,n,f.IT.lower)}else this.split(e);this.expand(e,n,f.IT.outer),this.attachNode(this.makeNode2(e,e+n,i))}}else this.expand(e,n)}},{key:"shrink",value:function(e,t){this.remove(e,t),this.tryMerge(e)}},{key:"modifyProp",value:function(e,n,i){var o=this,a=e,r=e+n;this.trySplit(a),this.trySplit(r);var s=this.mapInRange(a,r,f.IT.mapToNode,f.IT.strictIntersectTest);if(0!==s.length){for(var l=s.map((function(e){return o.detachNode(e),i(e.prop.duplicate())})),u=l[0],c=l.length,h=1;h<c;++h)t.isPropEqual(u,l[h])||(r=s[h].begin,this.attachNode(this.makeNode2(a,r,u)),a=r,u=l[h]);this.attachNode(this.makeNode2(a,e+n,u)),this.tryMerge(e),this.tryMerge(e+n)}}},{key:"reset",value:function(e,n,i){we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this,e,n,i,this.userMap),this.tryMerge(e),this.tryMerge(e+n)}},{key:"trySplit",value:function(e){var t=this.fetchHintContainPos(this.HintVT.it_hint1,e);if(e!==t.begin){var n=t.begin,i=t.end;this.detachNode(t._node),this.attachNode(this.makeNode2(n,e,t._node.prop)),this.attachNode(this.makeNode2(e,i,t._node.prop))}}},{key:"tryMerge",value:function(e){var n=this.mapInRange(e,e,f.IT.mapToNode);if(2===n.length){var i=n[0],o=n[1],a=i.prop,r=o.prop;t.isPropEqual(a,r)&&(this.detachNode(i),this.detachNode(o),this.attachNode(this.makeNode2(i.begin,o.end,r)))}}}],[{key:"isPropEqual",value:function(e,t){return!e.special&&!t.special&&Object(he.k)(e,t)}}]),t}(Ce),Pe=n(4970),Ie=n(4971);function Ee(e,t,n){return function(i){return t===he.j.Set||t===he.j.RawSet?i.setProps(e):t===he.j.RawCover?(i.clearAll(),i.setProps(e)):t===he.j.Cover?(i.clearAll(!0),i.setProps(e,n)):t===he.j.Clear?i.clearProps(e):console.log("其他模式还不支持！",t),i}}var Oe=n(3861),xe=n(1104),Re=n(4111),Ne=n(324),Ae=String.fromCharCode(Ne.q),De=function(){function e(){l()(this,e),this.mixin_BigArray_init({isString:!0})}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"BigArray",base:pe.a,methodName:"init"}]}}]),c()(e,[{key:"update",value:function(e,t,n){var i=this;n.forEach((function(e){e.len>0&&i.formatText(e.pos,e.pos+e.len,e.text)}))}},{key:"getChar",value:function(e){return this.at(e)}},{key:"getText",value:function(e,t){var n=this.slice(e,e+t);return n.length<t&&n.concat(" ".repeat(t-n.length)),n}},{key:"getTextSize",value:function(){return this.size}}]),e}(),Me=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));Object(p.default)(i),Object(Ie.a)(i),i.document=e,i.naked_textStream=n;var o=n.getTextLength();return i.core=new De(o),i.papxTbl=new Ce(o),i.chpxTbl=new Se(o),i}return y()(t,e),c()(t,[{key:"getChpxTbl",value:function(){return this.chpxTbl}},{key:"getPapxTbl",value:function(){return this.papxTbl}},{key:"update",value:function(e){var t=this;e.forEach((function(e){t.core.update(e.pos,e.len,e.textRange),t.papxTbl.update(e.pos,e.len,e.papx),t._dispatch("onBeforeChpxChanged",e),t.chpxTbl.update(e.pos,e.len,e.chpx),t._dispatch("onChpxChanged",e),t._dispatch("onPapxChanged",e)})),void 0!==this.document.docmap&&this.document.docmap.update()}},{key:"dealChpx",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this,s=t;if(void 0!==s)return void 0!==a&&(s.wo_user_id=a),s;var l=e,u=f.IT.Include;if(o&&!this.atPapxBound(l)&&(u=f.IT.Exclude),o){var c=r.getPapx(l),h=c.pos;u===f.IT.Exclude&&(--l,u=f.IT.Include);for(var d=!1;l>=h;){var p=this.document.getText(l,1);if(p!==Ae){d=!0;break}--l}d||(l=e,this.atPapxBound(l)||(u=f.IT.Exclude))}s=r.getChpx(l,u).prop,l=e;var g=["revision","vanish","symbol_char","symbol_fontname","o_math","o_math_script","o_math_align","o_math_break"];if(o&&s.asian_layout)if(this.atPapxBound(l))s.asian_layout&&delete s.asian_layout;else{var v=r.getChp(l);if(s.asian_layout){var m=v.getPropVal("asian_layout");m&&!Object(he.k)(s.asian_layout!=m)||delete s.asian_layout}}if(g.forEach((function(e){void 0!==s[e]&&delete s[e]})),void 0!==i){var _=Object(Oe.h)(i,this.document);s.setProps(_)}var y=this.getPapx(l).prop,b=this.document.stylesheet.getStyleByProp(y),T=b.chpx,C=[];return s.font_name_ascii===T.font_name_ascii&&C.push("font_name_ascii"),s.font_name_complex===T.font_name_complex&&C.push("font_name_complex"),s.font_name_asia_east===T.font_name_asia_east&&C.push("font_name_asia_east"),s.font_name_ftcbi===T.font_name_ftcbi&&C.push("font_name_ftcbi"),C.forEach((function(e){void 0!==s[e]&&delete s[e]})),n?(s.special=!0,delete s.fit_text_id,delete s.fit_text):void 0!==s.special&&delete s.special,void 0!==a&&(s.wo_user_id=a),s}},{key:"insertText",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,r=this.dealChpx(e,n,!1,i,o,a),s={name:"doInsertText",param:{pos:e,strlen:t.length,text:t,chpx:r,papx:null,isNewPara:!1}};Pe.a.recordAndExec(this,s)}},{key:"insertPlaceholder",value:function(e,t,n){var i=String.fromCharCode(t),o=this.dealChpx(e,n,!0),a={name:"doInsertText",param:{pos:e,strlen:i.length,text:i,chpx:o,papx:null,isNewPara:!1}};Pe.a.recordAndExec(this,a)}},{key:"insertParagraph",value:function(e,t,n){var i=this.dealChpx(e,t,!0);if(i.highlight_color){var o=this.getPapx(e);this.getChp(o.pos+o.len-1).highlight_color||delete i.highlight_color}var a={name:"doInsertText",param:{pos:e,strlen:1,text:"\r",chpx:i,papx:n,isNewPara:!0}};Pe.a.recordAndExec(this,a)}},{key:"deleteText",value:function(e,t){var n=e,i=t+1;e>0&&(--n,++i);var o={name:"doDeleteText",param:{pos:e,len:t,text:this.core.getText(e,t),rangeClass:this.document.collectRanges(n,i),chpxTbl:this.chpxTbl.collectProperites(e,t),papxTbl:this.papxTbl.collectProperites(e,t+1)}};return Pe.a.recordAndExec(this,o),e}},{key:"doInsertText",value:function(e,t){var n=e.pos,i=e.text,o=e.chpx,a=e.papx,r=e.isNewPara,s=e.strlen;t?this.atomInsertText(n,i,o,a,r,null):this.atomDeleteText(n,s,void 0)}},{key:"doDeleteText",value:function(e,t){var n=e.pos,i=e.len,o=e.text,a=e.rangeClass,r=e.chpxTbl,s=e.papxTbl;t?this.atomDeleteText(n,i,s):this.backwardDeleteText(n,i,o,a,r,s)}},{key:"doModifyChpx",value:function(e,t){var n=e.pos,i=e.len,o=e.chpx,a=e.mode,r=e.chpxTbl;t?this.atomModifyChpx(n,i,o,a):this.backwardModifyChpx(n,i,r)}},{key:"doModifyPapx",value:function(e,t){var n=e.pos,i=e.len,o=e.papx,a=e.mode,r=e.papxTbl;t?this.atomModifyPapx(n,i,o,a):this.backwardModifyPapx(n,i,r)}},{key:"doSplitPara",value:function(e,t){if(t){this.papxTbl.split(e.pos+1,e.papx);var n=new he.a;n.special=!0,this.chpxTbl.modifyProp(e.pos,1,Ee(n,he.j.Set));var i=this.expandPapx(e.pos,1);this._dispatch("onPapxChanged",i,{type:"splitPapx",range:{pos:e.pos-1,len:2}})}}},{key:"atomInsertText",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=this.core.getTextSize();if(void 0!==e&&e>=0&&e<=r&&t&&t.length>0)if(this._dispatch("onBeforeInsertText",e,t,n),this.core.insert(e,t),this.chpxTbl.insert(e,t.length,n),this.papxTbl.expand(e,t.length),o){var s=this.getPapx(e),l=i||s.prop;i||this.filterNewPapx(e,l),this.papxTbl.split(e+t.length,l),this._dispatch("onInsertText",e,t,n,l,a,o),this._dispatch("onPapxChanged",{pos:s.pos,len:s.len})}else this._dispatch("onInsertText",e,t,n,i,a)}},{key:"atomDeleteText",value:function(e,t,n){var i=this.core.getTextSize();if(void 0!==e&&void 0!==t&&e>=0&&e+t<=i){this._dispatch("onBeforeDeleteText",e,new Array(t));var o=this.papxTbl.safeMerge(e,t),a=this.core.getText(e,t);this.core.delete(e,t),this.chpxTbl.shrink(e,t),this.papxTbl.remove(e,t),this._dispatch("onDeleteText",e,a,n);var r=this.document.block;this.document.block=!0,o&&this._dispatch("onPapxChanged",{pos:o.begin,len:o.end-o.begin-t},{type:"mergePapx",range:{pos:e,len:t}}),this.document.block=r}}},{key:"atomModifyChpx",value:function(e,t,n,i){this._dispatch("onBeforeChpxChanged",{pos:e,len:t}),this.chpxTbl.modifyProp(e,t,Ee(n,i,he.g)),this._dispatch("onChpxChanged",{pos:e,len:t})}},{key:"atomModifyPapx",value:function(e,t,n,i){this.papxTbl.modifyProp(e,t,Ee(n,i,he.h));var o=this.expandPapx(e,t);this._dispatch("onPapxChanged",o)}},{key:"backwardInsertText",value:function(e,t){this.atomDeleteText(e,t)}},{key:"backwardDeleteText",value:function(e,t,n,i,o,a){if(this.atomInsertText(e,n,void 0,null,!1,a),i){var r=this.document;i.forEach((function(n){r.resetRangeClass(n.classType,e,t,n.ranges)}))}if(o){var s=this.getGcpRanges(e,t,o);this.chpxTbl.reset(s.pos,s.len,o),this._dispatch("onChpxChanged",s)}if(a){var l=this.getGcpRanges(e,t,a);this.papxTbl.reset(l.pos,l.len,a),this._dispatch("onPapxChanged",l,{type:"backwardDeleteText",range:{pos:e,len:t,text:n}})}}},{key:"backwardModifyChpx",value:function(e,t,n){var i=this.getGcpRanges(e,t,n);this._dispatch("onBeforeChpxChanged",i),this.chpxTbl.reset(i.pos,i.len,n),this._dispatch("onChpxChanged",i)}},{key:"backwardModifyPapx",value:function(e,t,n){var i=this.getGcpRanges(e,t,n);this.papxTbl.reset(i.pos,i.len,n,!0),this._dispatch("onPapxChanged",i)}},{key:"getGcpRanges",value:function(e,t,n){var i=e,o=e+t;return n.forEach((function(e){i>e.pos&&(i=e.pos),o<e.pos+e.len&&(o=e.pos+e.len)})),{pos:i,len:o-i}}},{key:"hasChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include;return!!this.chpxTbl.findNodeContainPos(e,t)}},{key:"getChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.chpxTbl.findNodeContainPos(e,t);return n&&n.prop}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.chpxTbl.fetchHintContainPos(this.chpxTbl.HintVT.it_hint1,e,t);return n.good()?D.b.make(!0,n.pos,n.len,n.prop.duplicate()):D.b.make()}},{key:"collectChpxs",value:function(e,t){return this.chpxTbl.getProps(e,t,(function(e){return D.b.make(!0,e.pos,e.len,e.prop.duplicate())}))}},{key:"getPrevChpx",value:function(e){return this.getChpx(e.pos,f.IT.Exclude)}},{key:"getNextChpx",value:function(e){return this.getChpx(e.pos+e.len)}},{key:"moveChpxToPrev",value:function(e){var t=this.chpxTbl.fetchHintContainPos(this.chpxTbl.HintVT.it_hint1,e.pos,f.IT.Exclude);t.good()?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood()}},{key:"moveChpxToNext",value:function(e){var t=this.chpxTbl.fetchHintContainPos(this.chpxTbl.HintVT.it_hint1,e.pos+e.len);t.good()?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood()}},{key:"hasPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include;return!!this.papxTbl.findNodeContainPos(e,t)}},{key:"getPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.papxTbl.findNodeContainPos(e,t);return n&&n.prop}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.papxTbl.fetchHintContainPos(this.papxTbl.HintVT.it_hint1,e,t);return n.good()?D.b.make(!0,n.pos,n.len,n.prop.duplicate()):D.b.make()}},{key:"collectPapxs",value:function(e,t){return this.papxTbl.getProps(e,t,(function(e){return D.b.make(!0,e.pos,e.len,e.prop.duplicate())}))}},{key:"getPrevPapx",value:function(e){return this.getPapx(e.pos,f.IT.Exclude)}},{key:"getNextPapx",value:function(e){return this.getPapx(e.pos+e.len)}},{key:"movePapxToPrev",value:function(e){var t=this.papxTbl.fetchHintContainPos(this.papxTbl.HintVT.it_hint1,e.pos,f.IT.Exclude);t.good()?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood()}},{key:"movePapxToNext",value:function(e){var t=this.papxTbl.fetchHintContainPos(this.papxTbl.HintVT.it_hint1,e.pos+e.len);t.good()?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood()}},{key:"onBeforeInsertText",value:function(e,t,n){}},{key:"onInsertText",value:function(e,t,n,i,o){}},{key:"onBeforeDeleteText",value:function(e,t,n){}},{key:"onDeleteText",value:function(e,t,n){}},{key:"onChpxChanged",value:function(e,t){}},{key:"onPapxChanged",value:function(e,t){}},{key:"onStyleChanged",value:function(e){var t=!!e.getProps().papx,n=t?this.getPapxTbl():this.getChpxTbl(),i=[],o=e.getName();n.forEachNode((function(e){var t=e.prop.getPropSelf("basestyle");t&&t.name===o&&i.push({pos:e.pos,len:e.len})})),i.length&&this._dispatch("onStyleChanged",i,e,t)}},{key:"setTextProp",value:function(e,t,n){if(n===he.j.Set){var i={revision:void 0,special:void 0};t.clearProps(i)}var o=this.chpxTbl.collectProperites(e.pos,e.len),a={name:"doModifyChpx",param:{pos:e.pos,len:e.len,chpx:t,mode:n,chpxTbl:o}};Pe.a.recordAndExec(this,a)}},{key:"setParaProp",value:function(e,t,n){var i=this.papxTbl.collectProperites(e.pos,e.len),o={name:"doModifyPapx",param:{pos:e.pos,len:e.len,papx:t,mode:n,papxTbl:i}};Pe.a.recordAndExec(this,o)}},{key:"expandPapx",value:function(e,t){var n=this.getPapx(e),i=n.pos,o=e+t;return o>n.pos+n.len&&(n=this.getPapx(o,f.IT.Exclude)),{pos:i,len:(o=n.pos+n.len)-i}}},{key:"filterNewPapx",value:function(e,t){var n=t.getPropVal("type");if(n&Re.b){var i=t.getPropVal("para_type"),o=t.getPropVal("nest_level");if(i!==xe.d&&o>0){var a=this.document.getSubDocOffset(this.document.getSubDocType(e));if(1===o&&a===e){var r=n;1===o&&(r&=~Re.b);var s=o-1,l=xe.a;r&Re.a&&(l=xe.e),t.type=r,t.para_type=l,t.nest_level=s}else i!==xe.a&&(n&Re.a?t.para_type=xe.e:t.para_type=xe.a)}}}},{key:"nickname",get:function(){return"DataLogic: TextStream"}}]),t}(de),Le=Me;R.a.mix(De,pe.a),R.a.mix(Me,D.a);var Fe=n(253),Be=n(4109),He=n(805),Ge=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.document=e,i.app=window.APP,i.naked_textStream=n,i.naked_textStream.initTrackingChanges(i),i._temporarilySwitchedOff=0,Object(p.default)(i),i}return y()(t,e),c()(t,[{key:"setTrackChanges",value:function(e){window.APP.editor.cmdExecutor.sendCommandBlock({name:"setTrackRevisions",param:{on:e}})}},{key:"doSetTrackChanges",value:function(e,t){this.naked_textStream.trackRevisions=e,this.naked_textStream.initiatorUserID=t}},{key:"setTrackRevisions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.initiatorUserID;e!==this.isTrackingChanges&&(this.naked_textStream.trackRevisions=e,this.naked_textStream.initiatorUserID=t)}},{key:"temporarilySwitchedOff",value:function(){++this._temporarilySwitchedOff}},{key:"temporarilySwitchedOn",value:function(){--this._temporarilySwitchedOff}},{key:"isTrackingEnabled",value:function(){return this.isTrackingChanges&&0===this._temporarilySwitchedOff}},{key:"insertText",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;if(this.isTrackingEnabled()&&!this._isInCommentRange(e)){var r=this._insertRevision_adjustProp(e,n,!1,i,o,a);this.nextLayer.insertText(e,t,r,i,o,a)}else this.nextLayer.insertText(e,t,n,i,o,a)}},{key:"insertParagraph",value:function(e,t,n){if(this.isTrackingEnabled()&&!this._isInCommentRange(e)){var i=this._insertRevision_adjustProp(e,t,!0);this.nextLayer.insertParagraph(e,i,n)}else this.nextLayer.insertParagraph(e,t,n)}},{key:"insertPlaceholder",value:function(e,t,n){if(this.isTrackingEnabled()&&!this._isInCommentRange(e)){var i=this._insertRevision_adjustProp(e,n,!0);this.nextLayer.insertPlaceholder(e,t,i)}else this.nextLayer.insertPlaceholder(e,t,n)}},{key:"deleteText",value:function(e,t){if(this.isTrackingEnabled()&&!this._isInCommentRange(e,t)){for(var n=e,i=e+t;n<i;){var o=this.getChpx(n);if(!o||!o.good||0==o.len)break;var a=o.prop,r=Math.min(o.len-n+o.pos,i-n);if(a&&void 0!==a.revision){var s=a.revision;s&&s.insert&&s.insert.user==this.username?(i-=r,this.nextLayer.deleteText(n,r)):(this._updateRevision(n,r,s),n+=r)}else this._updateRevision(n,r,null),n+=r}return i}return this.nextLayer.deleteText(e,t)}},{key:"setTextProp",value:function(e,t,n){if(this.isTrackingEnabled()&&!this._isInCommentRange(e.pos,e.len))for(var i=e.pos,o=e.pos+e.len;i<o;){var a=this.getChpx(i);if(!a||!a.good||0==a.len)break;var r=Math.min(a.len-i+a.pos,o-i);this._modifyChpxRevision(i,r,a.prop,t,n),i+=r}else this.nextLayer.setTextProp(e,t,n)}},{key:"setParaProp",value:function(e,t,n){if(this.isTrackingEnabled()&&!this._isInCommentRange(e.pos,e.len))if(e.len)for(var i=e.pos,o=e.pos+e.len;i<o;){var a=this.getPapx(i);if(!a||!a.good||0==a.len)break;var r=Math.min(a.len-i+a.pos,o-i);this._modifyPapxRevision(i,r,a.prop,t,n),i+=r}else{var s=this.getPapx(e.pos);if(!s||!s.good||0==s.len)return;this._modifyPapxRevision(e.pos,0,s.prop,t,n)}else this.nextLayer.setParaProp(e,t,n)}},{key:"_insertRevision_adjustProp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,r=t?t.duplicate():this.nextLayer.dealChpx(e,t,n,i,o,a,this.document.getDataLogic("final"));r&&r.revision&&delete r.revision;var s=this._txInitRevisionProp(),l=new he.b;return l.insert=s,r.revision=l.revision,r}},{key:"_updateRevision",value:function(e,t,n){var i=new he.a,o=new he.b;n&&(o.insert=n.insert,o.format=n.format),o.delete=this._txInitRevisionProp(),i.revision=o.revision,this.nextLayer.setTextProp({pos:e,len:t},i,he.j.RawSet)}},{key:"_modifyPapxRevision",value:function(e,t,n,i,o){var a=i?i.duplicate():new he.c,r=this._txInitRevisionProp();if(r.historyBag=Object(Be.d)(n),delete r.historyBag.revision,n.revision)a.revision=Object(He.deepCopyer)(n.revision),a.revision.paraFormat=r;else{var s=new he.d;s.paraFormat=r,a.revision=s.revision}var l=o;this.nextLayer.setParaProp({pos:e,len:t},a,l)}},{key:"_modifyChpxRevision",value:function(e,t,n,i,o){var a=i?i.duplicate():new he.a,r=this._txInitRevisionProp();if(r.historyBag=Object(Be.c)(n),delete r.historyBag.revision,n.revision)a.revision=Object(He.deepCopyer)(n.revision),a.revision.format=r;else{var s=new he.b;s.format=r,a.revision=s.revision}var l=o==he.j.Set?he.j.RawSet:o;this.nextLayer.setTextProp({pos:e,len:t},a,l)}},{key:"_txInitRevisionProp",value:function(){var e=new Date;return{date:Fe.formatDate("yyyy-mm-dd H:i:s",e.getTime()),user:this.username,userID:this.revisionUserId}}},{key:"_isInCommentRange",value:function(e,t){var n=function(e,t,n){return e>=t&&e<=n},i=this.document.getSubDocRange(w.Comment),o=i.pos+i.len;return n(e,i.pos,o)&&(void 0===t||n(e+t,i.pos,o))}},{key:"doModifyChpx",value:function(e,t){if(t&&(e.mode===he.j.RawSet||e.mode===he.j.Set)){var n=e.chpx&&this._onlyRevision(e.chpx),i=e.chpxTbl&&1===e.chpxTbl.length&&e.chpxTbl[0].propBag&&e.chpxTbl[0].propBag.revision;if(t&&n&&n.delete&&!n.insert&&!n.format&&i){var o=new he.b(i);e.chpx.revision.insert=o.insert,e.chpx.revision.format=o.format}else if(t&&null===n&&i&&i.format){var a=new he.b(i);e.chpx.revision={},e.chpx.revision.format=a.format}}this.nextLayer.doModifyChpx(e,t)}},{key:"_onlyRevision",value:function(e){var t=["mixMarks"],n=Object.getOwnPropertyNames(e),i=void 0;return n.some((function(n){return!t.find((function(e){return e===n}))&&("revision"===n?(i=e.revision,!1):(i=!1,!0))})),i}},{key:"isTrackingChanges",get:function(){return this.naked_textStream.isTrackingChanges}},{key:"username",get:function(){return this.app.info&&this.app.info.username}},{key:"userid",get:function(){return this.app.info&&this.app.info.userid}},{key:"revisionUserId",get:function(){return Object(Be.a)(this.userid)}},{key:"initiatorUserID",get:function(){return this.naked_textStream.initiatorUserID}}]),t}(de),We=Ge,je=n(336),Ue=1,Ve=2,Ye=3,ze=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.document=e,i.nextLayer=null,i}return y()(t,e),c()(t,[{key:"insertLayerAfter",value:function(e){this.nextLayer=e}},{key:"splitFitTextAfterInsert",value:function(e,t,n){var i=this.getFitTextRange(e,t);if(e!==i.pos&&e!==i.pos+i.len){var o={begin:i.begin,end:e,pos:i.pos,len:e-i.begin},a=this.getTypoWidth(o),r={begin:e,end:i.end,pos:e,len:i.end-e},s=this.getTypoWidth(r);if(n(),o.len){var l=new he.a;l.fit_text=a,this.nextLayer.setTextProp(o,l,he.j.Set)}if(r.len){var u=new he.a;u.fit_text=s,this.nextLayer.setTextProp({pos:r.pos+1,len:r.len},u,he.j.Set)}}else n()}},{key:"insertText",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,r=n||this.getInsertChp(e);if(!r.fit_text_id||r.fit_text<=0)this.nextLayer.insertText(e,t,n,i,o,a);else if(t.length>1||!this.isFitTextSeparateChar(t.charCodeAt(0)))this.nextLayer.insertText(e,t,n,i,o,a);else{var s=this.nextLayer,l=function(){s.insertText(e,t,n,i,o,a)};this.splitFitTextAfterInsert(e,r.fit_text_id,l)}}},{key:"insertParagraph",value:function(e,t,n){var i=t||this.getInsertChp(e);if(!i.fit_text_id||i.fit_text<=0)this.nextLayer.insertParagraph(e,t,n);else{t&&t.fit_text_id&&delete t.fit_text_id;var o=this.nextLayer;this.splitFitTextAfterInsert(e,i.fit_text_id,(function(){o.insertParagraph(e,t,n)}))}}},{key:"isFitTextSeparateChar",value:function(e){return e===Ne.z||e===Ne.B}},{key:"getInsertChp",value:function(e){var t=this.document.getDataLogic("final");return t.getChp(e,t.atPapxBound(e)?f.IT.Include:f.IT.Exclude)}},{key:"getFitTextRange",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ye,i=this.document.getDataLogic("final"),o=e;if(n&Ue)for(;!i.atPapxBound(o);){var a=i.getChpx(o,f.IT.Exclude);if(a.prop.fit_text_id!==t)break;o=a.pos}var r=o,s=e;if(n&Ve)for(;!i.atPapxBound(s);){var l=i.getChpx(s);if(l.prop.fit_text_id!==t)break;s=l.pos+l.len}return{begin:r,end:s,pos:r,len:s-r}}},{key:"getTypoWidth",value:function(e){var t=window.APP.data.typoinfo.collectTextLines(e);if(t.length&&t[0].glyphGroupInfos){var n=t[0],i=n.range.begin,o=n.glyphGroupInfos,a=0;return o.forEach((function(t){if(!(i+t.beginOffset>=e.end||i+t.endOffset<=e.begin))if(i+t.beginOffset>=e.begin&&i+t.endOffset<=e.end)a+=t.widthSum;else for(var n=Math.max(0,e.begin-i-t.beginOffset),o=Math.min(t.endOffset-t.beginOffset,e.end-i-t.beginOffset),r=n;r<o;++r)a+=t.widths[r]})),Math.round(Object(je.Px2Ti)(a))}}}]),t}(de),Ke=ze,Ze=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.pureTextStream=new Le(e,n),i.revisionTextStream=new We(e,n),i.fitTextLayer=new Ke(e,n),n.init(e,i.revisionTextStream),i.revisionTextStream.insertLayerAfter(i.pureTextStream),i.fitTextLayer.insertLayerAfter(i.revisionTextStream),i.insertLayerAfter(i.fitTextLayer),i}return y()(t,e),c()(t,[{key:"getPureTextStream",value:function(){return this.pureTextStream}},{key:"getRevisionTextStream",value:function(){return this.revisionTextStream}},{key:"getFitTextLayer",value:function(){return this.fitTextLayer}},{key:"setTrackingChanges",value:function(e){e?this.revisionTextStream.temporarilySwitchedOn():this.revisionTextStream.temporarilySwitchedOff()}}]),t}(de),Xe=Ze,qe=n(400),Je=function(){function e(t){l()(this,e),this.naked_layer=t}return c()(e,[{key:"getShapeTree",value:function(e){var t=void 0;switch(e){case te.c:t=this.inlineShapeTree;break;case te.b:t=this.headerShapeTree;break;case te.a:t=this.inlineHeaderShapeTree;break;case te.d:default:t=this.shapeTree}return t}},{key:"getShapeId",value:function(e,t,n){var i=-1;return 1===t&&(i=n),i}},{key:"getEmbedShapeId",value:function(e,t){return t}},{key:"getShapeMimeDataId",value:function(e,t){switch(e){case te.c:return this.inlineShapeTree.getShapeMimeDataId(t)}return null}},{key:"findShapeByRefId",value:function(e){var t=void 0;return this.naked_layer.vector.find((function(n){return!!(t=n.vector.find((function(t){return t.objID===e})))})),t}},{key:"root",get:function(){return this.naked_layer.getRoot()}},{key:"layer",get:function(){return this.naked_layer.getLayer()}},{key:"shapeTree",get:function(){return new Qe(this.naked_layer.getShapeTree())}},{key:"headerShapeTree",get:function(){return new Qe(this.naked_layer.getInHeaderShapeTree())}},{key:"inlineHeaderShapeTree",get:function(){return new Qe(this.naked_layer.getInlineInHeaderShapeTree())}},{key:"inlineShapeTree",get:function(){return new Qe(this.naked_layer.getInlineShapeTree())}}]),e}(),Qe=function(){function e(t){l()(this,e),this.naked_shape_tree=t,null!=t.getChilds()&&(this.childs=new $e(t.getChilds()))}return c()(e,[{key:"getShapeMimeDataId",value:function(e){return this.childs.getShapeMimeDataId(e)}},{key:"getShapeIndex",value:function(e){return this.childs.getShapeIndex(e)}},{key:"group",get:function(){return this.naked_shape_tree.getGroup()}},{key:"layer",get:function(){return this.naked_shape_tree.getLayer()}},{key:"shape",get:function(){return this.naked_shape_tree.getShape()}},{key:"shapetree",get:function(){return this.naked_shape_tree.getShapeTree()}}]),e}(),$e=function(){function e(t){l()(this,e),this.naked_childs=t}return c()(e,[{key:"getLength",value:function(){return this.naked_childs.length}},{key:"at",value:function(e){var t=this.naked_childs[e];return t&&new et(t)}},{key:"getValue",value:function(e){var t=this.naked_childs.find((function(t){return t.getShapeId()===e}));return t?new et(t):null}},{key:"getShapeMimeDataId",value:function(e){for(var t=0;t<this.naked_childs.length;++t)if(this.naked_childs[t].private.shapeId==e)return this.naked_childs[t].private.mimeDataId;return null}},{key:"getShapeIndex",value:function(e){return this.naked_childs.findIndex((function(t){return t.getShapeId()===e}))}}]),e}(),et=function(){function e(t){l()(this,e),this.naked_child=t}return c()(e,[{key:"setCacheRectByDocRect",value:function(e){this.naked_child._cache_rect=qe.a.initByDocRect(e)}},{key:"childs",get:function(){var e=this.naked_child.getChilds();return e&&new $e(e)}},{key:"rect",get:function(){if(void 0===this.naked_child._cache_rect){var e=this.naked_child.getRect()||{left:0,right:0,top:0,bottom:0},t=this.anchor&&this.anchor.rect&&this.anchor.rect.size;0===e.right&&0===e.bottom&&t&&(e.right=t.width,e.bottom=t.height),this.naked_child._cache_rect=qe.a.initByDocRect(e)}return this.naked_child._cache_rect}},{key:"shape",get:function(){return this.naked_child.getShape()}},{key:"shapeId",get:function(){return this.naked_child.getShapeId()}},{key:"anchor",get:function(){return new tt(this.naked_child.getAnchor())}},{key:"textRange",get:function(){return this.naked_child.getTextRange()}},{key:"group",get:function(){return this.naked_child.getGroup()}}]),e}(),tt=function(){function e(t){l()(this,e),this.naked_shape_anchor=t}return c()(e,[{key:"isReset",get:function(){return this.naked_shape_anchor.isReset}},{key:"horiLineWidth",get:function(){return Object(je.Ti2Px)(this.naked_shape_anchor.horilineWidth)}},{key:"rect",get:function(){return void 0===this.naked_shape_anchor._cache_rect&&(this.naked_shape_anchor._cache_rect=qe.a.initByOriginAndSize({x:Object(je.Ti2Px)(this.naked_shape_anchor.x),y:Object(je.Ti2Px)(this.naked_shape_anchor.y)},{width:this.naked_shape_anchor.width,height:this.naked_shape_anchor.height})),this.naked_shape_anchor._cache_rect}}]),e}(),nt=n(30),it=n.n(nt),ot=n(5742),at=n(3858),rt=n(6108),st=n(2502),lt=n(6115),ut=n(7209),ct=n(4112),ht={grid_snapMode:0,grid_width:0,grid_height:0,width:12240,height:15840,header2Top:720,footer2Bottom:720,orientation:lt.g.PageOrientation_Portrait,gutterMargin:0,margin:{left:1800,right:1800,top:1440,bottom:1440},isFirstDifference:0,isOddEvenDifference:0,evenHeader:null,oddHeader:null,evenFooter:null,oddFooter:null,firstHeader:null,firstFooter:null,markType:2,textFlow:0,columns:{count:1,equalWidth:!0,hasCompartLine:!1,space:0,bidi:!1},appendPrevSec:1,startNum:0,numberFormat:0,withSecIndex:!1,lineNumbering:null,multiplePages:lt.f.MultiplePages_Normal,rtlGutter:lt.d.GutterPlacement_Latin,borderLeft:{},borderTop:{},borderRight:{},borderBottom:{},borderDistanceFrom:lt.b.BorderMeasureFrom_Text,borderPageDepth:!1,borderApplyTo:lt.a.BorderApplyTo_AllPage},dt={location:rt.e,numStart:1,numRestart:rt.b,numFormat:st.b,layoutColumns:0},pt={location:rt.a,numStart:1,numRestart:rt.b,numFormat:st.O,suppressEndnotes:!1},ft={styleType:lt.c.BorderStyleType_None,color:{},margin:0,style:ut.l,lineWidth:0,artStyle:0,artLineWidth:0},gt=function(){function e(t){l()(this,e),this.naked_columns=t}return c()(e,[{key:"getColumns",value:function(){var e={count:this.naked_columns.count,equalWidth:this.naked_columns.equalWidth,hasCompartLine:this.naked_columns.hasCompartLine,bidi:this.naked_columns.bidi};if(e.equalWidth)e.space=this.naked_columns.space;else{e.items=[];for(var t=0;t<e.count;++t)e.items.push({width:this.naked_columns.items[t].width,space:this.naked_columns.items[t].space})}return e}},{key:"columns",get:function(){return this.getColumns()}}]),e}(),vt=function(){function e(t){l()(this,e),this.data=t}return c()(e,[{key:"location",get:function(){return void 0!==this.data.location?this.data.location:dt.location}},{key:"numStart",get:function(){return void 0!==this.data.numStart?this.data.numStart:dt.numStart}},{key:"numRestart",get:function(){return void 0!==this.data.numRestart?this.data.numRestart:dt.numRestart}},{key:"numFormat",get:function(){return void 0!==this.data.numberFormat?this.data.numberFormat:dt.numFormat}},{key:"layoutColumns",get:function(){return void 0!==this.data.layoutColumns?this.data.layoutColumns:dt.layoutColumns}}]),e}(),mt=function(){function e(t){l()(this,e),this.data=t}return c()(e,[{key:"location",get:function(){return void 0!==this.data.location?this.data.location:pt.location}},{key:"numStart",get:function(){return void 0!==this.data.numStart?this.data.numStart:pt.numStart}},{key:"numRestart",get:function(){return void 0!==this.data.numRestart?this.data.numRestart:pt.numRestart}},{key:"numFormat",get:function(){return void 0!==this.data.numberFormat?this.data.numberFormat:pt.numFormat}},{key:"suppressEndnotes",get:function(){return void 0!==this.data.suppressEndnotes?this.data.suppressEndnotes:pt.suppressEndnotes}}]),e}(),_t=function(){function e(t){l()(this,e),this.data=t}return c()(e,[{key:"styleType",get:function(){return void 0!==this.data.styleType?this.data.styleType:ft.styleType}},{key:"style",get:function(){return void 0!==this.data.style?this.data.style:ft.style}},{key:"lineWidth",get:function(){return void 0!==this.data.lineWidth?this.data.lineWidth:ft.lineWidth}},{key:"artStyle",get:function(){return void 0!==this.data.artStyle?this.data.artStyle:ft.artStyle}},{key:"artLineWidth",get:function(){return void 0!==this.data.artLineWidth?this.data.artLineWidth:ft.artLineWidth}},{key:"color",get:function(){return void 0!==this.data.color?this.data.color:ft.color}},{key:"margin",get:function(){return void 0!==this.data.margin?this.data.margin:ft.margin}}]),e}(),yt=function(e){function t(e){l()(this,t);var n=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.initFromServer(e),n}return y()(t,e),c()(t,[{key:"duplicate",value:function(){var e=new t;return this.copy(e,this),e}},{key:"initFromServer",value:function(e){if(e&&e.private&&e.private.props){var t=e.private.props;if(void 0!==t.grid&&(void 0!==t.grid.snapMode&&(this.grid_snapMode=t.grid.snapMode),void 0!==t.grid.width&&(this.grid_width=t.grid.width),void 0!==t.grid.height&&(this.grid_height=t.grid.height)),void 0!==t.page&&(void 0!==t.page.width&&(this.width=t.page.width),void 0!==t.page.height&&(this.height=t.page.height),void 0!==t.page.header2Top&&(this.header2Top=t.page.header2Top),void 0!==t.page.footer2Bottom&&(this.footer2Bottom=t.page.footer2Bottom),void 0!==t.page.orientation&&(this.orientation=t.page.orientation),void 0!==t.page.gutterMargin&&(this.gutterMargin=t.page.gutterMargin),void 0!==t.page.margin)){var n=t.page.margin;void 0!==n.left&&void 0!==n.right&&void 0!==n.top&&void 0!==n.bottom&&(this.margin={left:n.left,right:n.right,top:n.top,bottom:n.bottom})}void 0!==t.headerFooters&&(void 0!==t.headerFooters.isFirstDifference&&(this.isFirstDifference=t.headerFooters.isFirstDifference),void 0!==t.headerFooters.isOddEvenDifference&&(this.isOddEvenDifference=t.headerFooters.isOddEvenDifference)),void 0!==t.markType&&(this.markType=t.markType),void 0!==t.textFlow&&(this.textFlow=t.textFlow),void 0!==t.columns&&(this.columns=new gt(t.columns).columns),void 0!==t.pageNumber&&(void 0!==t.pageNumber.appendPrevSec&&(this.appendPrevSec=t.pageNumber.appendPrevSec),void 0!==t.pageNumber.start&&(this.startNum=t.pageNumber.start),void 0!==t.pageNumber.numberFormat&&(this.numberFormat=t.pageNumber.numberFormat),void 0!==t.pageNumber.withSecIndex&&(this.withSecIndex=t.pageNumber.withSecIndex)),void 0!==t.lineNumbering&&(this.lineNumbering=d()({},t.lineNumbering)),void 0!==t.multiplePages&&(this.multiplePages=t.multiplePages),void 0!==t.rtlGutter&&(this.rtlGutter=t.rtlGutter),this.footnotePr=new vt(t.footnote||{}),this.endnotePr=new mt(t.endnote||{});var i=t.pageBorder;void 0!==i&&(this.borderLeft=new _t(i.left||{}),this.borderTop=new _t(i.top||{}),this.borderRight=new _t(i.right||{}),this.borderBottom=new _t(i.bottom||{}),void 0!==i.distanceFrom&&(this.borderDistanceFrom=i.distanceFrom),void 0!==i.depth&&(this.borderPageDepth=i.depth),void 0!==i.applyTo&&(this.borderApplyTo=i.applyTo))}return this}},{key:"clearAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e);else for(var t in this)delete this[t]}},{key:"def",get:function(){return ht}}]),t}(he.e),bt=function(e){function t(e,n,i,o){l()(this,t);var a=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e+n,i));return a.expired=!0,a.document=o,a.headersfooters=o.headersfooters,a.sepx=new yt(i),a.update(),i.on(a.onDataChanged.bind(a)),a}return y()(t,e),c()(t,[{key:"getSnapMode",value:function(){var e=this.sepx.getPropVal("grid_snapMode");return this._mapGridMode(e)}},{key:"_mapGridMode",value:function(e){switch(e){case 0:return at.c;case 3:return at.a;case 1:return at.b;case 7:return at.d;default:return at.c}}},{key:"getGridWidth",value:function(){return this.sepx.getPropVal("grid_width")}},{key:"getSrcGridWidth",value:function(){return.0048828125*this.getGridWidth()}},{key:"getGridHeight",value:function(){return this.sepx.getPropVal("grid_height")}},{key:"getPageOrientation",value:function(){return this.sepx.getPropVal("orientation")}},{key:"getPageMargin",value:function(){var e=this.sepx.getPropVal("margin");return{top:Math.abs(e.top),bottom:Math.abs(e.bottom),left:e.left,right:e.right}}},{key:"getOriginPageMargin",value:function(){return this.sepx.getPropVal("margin")}},{key:"getPageWidth",value:function(){return this.sepx.getPropVal("width")}},{key:"getPageHeight",value:function(){return this.sepx.getPropVal("height")}},{key:"getPageHeader2Top",value:function(){return this.sepx.getPropVal("header2Top")}},{key:"getPageFooter2Bottom",value:function(){return this.sepx.getPropVal("footer2Bottom")}},{key:"isFirstDiff",value:function(){return this.sepx.getPropVal("isFirstDifference")}},{key:"isOddEvenDiff",value:function(){return this.sepx.getPropVal("isOddEvenDifference")}},{key:"getMarkType",value:function(){return this.sepx.getPropVal("markType")}},{key:"getTextFlow",value:function(){return this.sepx.getPropVal("textFlow")}},{key:"hasCompartLine",value:function(){return this.sepx.getPropVal("columns").hasCompartLine}},{key:"getColumnsCount",value:function(){return this.sepx.getPropVal("columns").count}},{key:"getColumnsBidi",value:function(){return this.sepx.getPropVal("columns").bidi}},{key:"getColumnItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=e,n=this.sepx.getPropVal("columns");t>=n.count&&(t=0);var i=0,o=0;if(n.equalWidth){var a=this.getPageMargin(),r=this.getPageWidth(),s=r-a.left-a.right;i=(s-n.space*(n.count-1))/n.count,o=n.space}else i=n.items[t].width,o=n.items[t].space;return{columnWidth:i,space:o}}},{key:"getAppendPrevSection",value:function(){return this.sepx.getPropVal("appendPrevSec")}},{key:"getPageNumStart",value:function(){return this.sepx.getPropVal("startNum")}},{key:"getPageNumFormat",value:function(){return this.sepx.getPropVal("numberFormat")}},{key:"getLineNumbering",value:function(){return this.sepx.getPropVal("lineNumbering")}},{key:"getFootnotePr",value:function(){return this.sepx.getPropVal("footnotePr")}},{key:"getEndnotePr",value:function(){return this.sepx.getPropVal("endnotePr")}},{key:"getHeaderFooterRange",value:function(e){var t=void 0;switch(e){case ot.b:t=this.sepx.getPropVal("evenHeader");break;case ot.f:t=this.sepx.getPropVal("oddHeader");break;case ot.a:t=this.sepx.getPropVal("evenFooter");break;case ot.e:t=this.sepx.getPropVal("oddFooter");break;case ot.d:t=this.sepx.getPropVal("firstHeader");break;case ot.c:t=this.sepx.getPropVal("firstFooter")}return this.headersfooters.rangeClass.findRangeByRefId(t)}},{key:"getGutterMargin",value:function(){return this.sepx.getPropVal("gutterMargin")}},{key:"getMultiPages",value:function(){return this.sepx.getPropVal("multiplePages")}},{key:"getGutterPlacment",value:function(){return this.sepx.getPropVal("rtlGutter")}},{key:"getBorderApplyTo",value:function(){return this.sepx.getPropVal("borderApplyTo")}},{key:"getBorderPageDepth",value:function(){return this.sepx.getPropVal("borderPageDepth")}},{key:"getBorderDistanceFrom",value:function(){return this.sepx.getPropVal("borderDistanceFrom")}},{key:"getBorder",value:function(e){switch(e){case ct.d:return this.sepx.getPropVal("borderTop");case ct.b:return this.sepx.getPropVal("borderLeft");case ct.a:return this.sepx.getPropVal("borderBottom");case ct.c:return this.sepx.getPropVal("borderRight");default:return null}}},{key:"getHeaderFooterRangeByPos",value:function(e){var t=this.getHeaderFooterRange(ot.b);return t&&t.pos<=e&&t.pos+t.len>=e||(t=this.getHeaderFooterRange(ot.f))&&t.pos<=e&&t.pos+t.len>=e||(t=this.getHeaderFooterRange(ot.a))&&t.pos<=e&&t.pos+t.len>=e||(t=this.getHeaderFooterRange(ot.e))&&t.pos<=e&&t.pos+t.len>=e||(t=this.getHeaderFooterRange(ot.d))&&t.pos<=e&&t.pos+t.len>=e||(t=this.getHeaderFooterRange(ot.c))&&t.pos<=e&&t.pos+t.len>=e?t:void 0}},{key:"updateHeaderFooterRange",value:function(e,t){if(void 0===this.sepx.getPropSelf(t)||void 0!==e[t])if(void 0===e[t]);else{var n=it()({},t,e[t].refId);this.sepx.setProps(n)}else{var i=it()({},t,void 0);this.sepx.setProps(i)}}},{key:"update",value:function(){if(this.expired){var e=this.data.getProps().headerFooters;this.updateHeaderFooterRange(e,"firstHeader"),this.updateHeaderFooterRange(e,"firstFooter"),this.updateHeaderFooterRange(e,"oddHeader"),this.updateHeaderFooterRange(e,"oddFooter"),this.updateHeaderFooterRange(e,"evenHeader"),this.updateHeaderFooterRange(e,"evenFooter"),this.expired=!1}}},{key:"onDataChanged",value:function(e){this.expired=!0,this.sepx=new yt(e),this.document._dispatch("onSectionxChanged",this)}},{key:"doWaterMarkOp",value:function(e,t){var n=window.APP.api;n.isConnected()&&!n.hasBlocking()&&(e.pos=this.pos,window.APP.editor.cmdExecutor.sendCommandBlock({name:"doWaterMarkOp",param:e},(function(e){window.APP.workspace.refreshForcedly(),"function"==typeof t&&t(e)})))}}]),t}(T.d),Tt=function(){function e(t,n,i,o){l()(this,e),this.init(t,n,i,o)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRCAttacher",base:T.a,methodName:"init"},{baseName:"DOCRCAttacher",base:T.a,methodName:"attach"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i){this.mixin_DOCRCAttacher_init(e,t,i),this.sections=n}},{key:"attach",value:function(e){this.mixin_DOCRCAttacher_attach(e),this.sections.length++}}]),e}(),Ct=function(){function e(t,n,i){l()(this,e),this.init(t,n,i)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRCDetacher",base:T.b,methodName:"init"},{baseName:"DOCRCDetacher",base:T.b,methodName:"detach"}]}}]),c()(e,[{key:"init",value:function(e,t,n){this.mixin_DOCRCDetacher_init(e,n),this.sections=t}},{key:"detach",value:function(e){this.mixin_DOCRCDetacher_detach(e),this.sections.length--}}]),e}(),kt=function(){function e(t,n){var i=this;l()(this,e),Object(T.f)(this),this.length=0,this.document=n,this.rangeClass=new T.e(this.document,b.r,f.IT.outer,f.IT.NonIntersect,!0),ee.a.bind(this.rangeClass,"attacher",(function(e){return new Tt(e,e.sortby,i)})),ee.a.bind(this.rangeClass,"detacher",(function(e){return new Ct(e,i)}));var o=this;t.forEach((function(e){o.doInsertNakedRange(e)})),this.rangeClass.attachObserver(this)}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new bt(e.pos,e.len,e.data,this.document);this.rangeClass.attachNode(t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.rangeClass.detachNode(t)}},{key:"onAttachNode",value:function(e,t){this.document._dispatch("onSectionxChanged",t)}},{key:"onDetachNode",value:function(e,t){this.document._dispatch("onSectionxChanged",t)}},{key:"getSection",value:function(e){var t=void 0,n=this.rangeClass.pointKeyword;if(e>=this.document.getMainTextLength())t=this.rangeClass.tree.getPrevNode();else for(var i=e;;){n.config(i,f.IT.Include),t=this.rangeClass.seekHint(this.rangeClass.HintVT.it_hint1,n)._node;var o=this.document.textStream.pureTextStream.getChpx(t.end-1).prop.revision;if(!o||!o.delete)break;if((i=t.end)>=this.document.getMainTextLength()){t=this.rangeClass.tree.getPrevNode();break}}return t.isTree()?null:(t.update(),t)}},{key:"isOnlyOneSection",value:function(){for(var e=this.rangeClass.tree.getNextNode(),t=0;e.nonTree()&&(++t,e=e.getNextNode(),!(t>1)););return 1===t}},{key:"indexOf",value:function(e){var t=0;return this.rangeClass.forEachNode((function(n){if(n===e)return!0;++t})),t}},{key:"getSectionIndexByPos",value:function(e){return this.indexOf(this.getSection(e))}},{key:"getItem",value:function(e){var t=void 0,n=0;return this.rangeClass.forEachHint((function(i){if(n===e)return t=i._node,{stop:!0};++n})),t}}]),e}();R.a.mix(Tt,T.a),R.a.mix(Ct,T.b);var wt=n(4110),St=n(167),Pt=function(){function e(t){l()(this,e),this.naked_autonums=t,this.cached={},this.galleryCached={},this.overrideCached={},t.on(this.onAutoNumListChanged.bind(this))}return c()(e,[{key:"findAutoNum",value:function(e){var t=this._findAutoNum(e).autoNum;return t&&t.levels.length?t:null}},{key:"findListGalleryInfo",value:function(e){return this._findAutoNum(e).galleryInfo||{}}},{key:"_findAutoNum",value:function(e){var t=this;if(-1===e)return{};var n=this.cached[e],i=this.galleryCached[e];if(n)return{autoNum:n.private,galleryInfo:i};var o=this.naked_autonums.private,a=o.autoNums,r=o.autoNumOverrides,s=void 0,l=void 0;return a.some((function(n){var i=n.autoNum,o=n.listGalleryIndex,a=n.listGalleryType;if(i.getListId()===e)return l={listGalleryIndex:o,listGalleryType:a},t.galleryCached[e]=l,s=t.cache(e,i,null),!0}))||r.some((function(n){var i=n.autoNum,o=n.listGalleryIndex,a=n.listGalleryType;if(i.getListId()===e)return l={listGalleryIndex:o,listGalleryType:a},t.galleryCached[e]=l,s=t.cache(e,i.getAbstract(),i),!0})),{autoNum:s,galleryInfo:l}}},{key:"cache",value:function(e,t,n){var i=this;return t.on(this.onAutoNumChanged.bind(this)),n&&(n.private.overrideLevels.forEach((function(e,n){var o=t.private.levels[n];e.isInitFromServer||(e.chpx=(new he.a).initFromServer(e.chpx),e.papx=(new he.c).initFromServer(e.papx),i._convertLevel(e),e.isInitFromServer=!0),o.isInitFromServer||(o.chpx=(new he.a).initFromServer(o.chpx),o.papx=(new he.c).initFromServer(o.papx),i._convertLevel(o),o.isInitFromServer=!0),wt.a.union(e.chpx,o.chpx),wt.a.union(e.papx,o.papx)})),n.on(this.onAutoNumChanged.bind(this))),t.private.levels.forEach((function(e){e.isInitFromServer||(e.chpx=(new he.a).initFromServer(e.chpx),e.papx=(new he.c).initFromServer(e.papx),i._convertLevel(e),e.isInitFromServer=!0)})),this.cached[e]=t,t.private}},{key:"getOverrideAutoNum",value:function(e){var t=this,n=this.overrideCached[e];if(n)return n.private;var i=this.naked_autonums.private.autoNumOverrides,o=void 0;return i.some((function(n){var i=n.autoNum;if(i.getListId()===e)return o=t.overrideCached[e]=i,!0})),o&&o.private}},{key:"onAutoNumChanged",value:function(e){this.cached[e.getListId()]=void 0,this.galleryCached[e.getListId()]=void 0,this.overrideCached[e.getListId()]&&(this.overrideCached[e.getListId()]=void 0)}},{key:"onAutoNumListChanged",value:function(e){this.cached={},this.galleryCached={},this.overrideCached={}}},{key:"_convertLevel",value:function(e){if((St.isMacOs||St.isMobile||St.isIPad)&&61623===e.xst.charCodeAt(0)){e.xst=String.fromCharCode(61548);for(var t=window.APP.data.doc.fonttable,n=0;n<t.length;++n){if("Wingdings"===t.get(n).name){e.chpx.font_name_ascii=n,e.chpx.font_name_complex=n,e.chpx.font_name_ftcbi=n;break}}}}}]),e}(),It={WOType_Delete:n(3486).WOType_Delete},Et=function(){function e(t){l()(this,e),Object(p.default)(this),this.watchObjMap={},this.doc=t,this.doc.attachObserver(this)}return c()(e,[{key:"watch",value:function(e,t){this.watchObjMap[e]=t}},{key:"disWatch",value:function(e){this.watchObjMap[e]=null}},{key:"getShapeIdByPos",value:function(e){for(var t in this.watchObjMap)if(this.watchObjMap[t]&&this.watchObjMap[t].pos==e)return t;return null}},{key:"_isWatch",value:function(e){return null!=this.watchObjMap[e]}},{key:"onTrigger",value:function(e,t,n){this._isWatch(t)&&this.watchObjMap[t].opType==n&&this.watchObjMap[t].cb&&this._dispatch(this.watchObjMap[t].cb)}}]),e}(),Ot=n(4976),xt=n(1731),Rt=n(6106),Nt=n(1631),At=function(e){function t(e,n,i,o,a){l()(this,t);var r=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e+n,null));return r.good=!0,r.prop=i,r.cellList=o,r.doc=a,r}return y()(t,e),c()(t,[{key:"duplicate",value:function(){var e=this.prop?this.prop.duplicate():null;return new t(this.pos,this.len,e,this.cellList,this.doc)}},{key:"cells",get:function(){return this.prop.table_row.tableCells}},{key:"cellDatas",get:function(){var e=this.cells,t=this.cellList.mapInRange(this.pos,this.pos+this.len,f.IT.mapToRange,f.IT.strictIntersectTest);if(t.length&&t.length<e.length){var n=t[t.length-1],i=this.doc.getDataLogic("final").collectPapxs(n.begin,n.end-n.begin);if(i&&i.length>0){var o=i[i.length-1];t[t.length-1].end=o.pos,t.push({begin:o.pos,end:o.pos+o.len})}}return t}}]),t}(f.ITRange),Dt=function(){function e(t,n){l()(this,e),t.attachObserver(this),this.stream=t,this.doc=n,this.rowLists=[],this.cellLists=[]}return c()(e,[{key:"checkTapxLists",value:function(e){return this.rowLists[e]||(this.rowLists[e]=new f.ITToolkit(f.IT.upper,f.IT.Nesting,!0,Te)),this.cellLists[e]||(this.cellLists[e]=new f.ITToolkit(f.IT.upper,f.IT.Nesting,!0)),!!this.rowLists[e]&&!!this.cellLists[e]}},{key:"getTapx",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,i=this.stream.getPapx(e,n);if(!i.good)return D.b.make();var o=i.prop.getPropVal("nest_level"),a=i.prop.getPropVal("para_type"),r=arguments.length>2&&arguments[2]?arguments[2]:Math.max(1,o);this.checkTapxLists(r);var s=this.rowLists[r].findNodeContainPos(e,n);if(s)return s;var l=this.doc.getLimitedRange(n===f.IT.Exclude&&e>0?e-1:e),u=l.pos+l.len,c=null;if(o<r)c=new At(i.pos,i.len,null,this.cellLists[r],this.doc);else{var h=!0,d=function(e,t){return e||(e=[]),o===r&&(a===xe.b?e.push(t.pos+t.len):a===xe.d&&(e.tap=t.prop)),e},p=function(e,t,n){return o=e.prop.getPropVal("nest_level"),a=e.prop.getPropVal("para_type"),!(o<r||e.pos+e.len<=l.pos)&&(o!==r||a!==xe.d)},g=function(e,t,n){return h&&(h=!1,n.reverse()),o=e.prop.getPropVal("nest_level"),a=e.prop.getPropVal("para_type"),o>=r&&!n.tap&&e.pos+e.len<=u},v=this.stream.getCompatiblePapx(e,p,d,g,n);v.good&&(c=new At(v.pos,v.len,v.prop.tap.duplicate(!0),this.cellLists[r],this.doc)),this.cellLists[r].detachNodes(v.pos,v.pos+v.len,f.IT.strictIntersectTest),this.rowLists[r].detachNodes(v.pos,v.pos+v.len,f.IT.strictIntersectTest);var m=v.pos;v.prop.forEach((function(e){t.cellLists[r].attachNode(new f.ITRange(m,e)),m=e}))}if(c&&c.prop){var _=this.getTapx(c.pos,f.IT.Exclude,r);_&&_.prop&&!Object(Nt.g)(_,c)&&(c.prop.table_row.horzAlignMode=_.prop.table_row.horzAlignMode)}return this.rowLists[r].attachNode(c),c}},{key:"collectTapxs",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.checkTapxLists(i);var a=this.rowLists[i].mapInRange(e,e+t,f.IT.mapToNode,f.IT.strictIntersectTest),r=[],s=e;if(a.forEach((function(e){e.pos>s&&n.updateTapxs(s,e.pos-s,i).forEach((function(e){r.push(e)}));r.push(e),s=e.pos+e.len})),s<e+t){var l=this.updateTapxs(s,e+t-s,i);l.forEach((function(e){r.push(e)}))}return o=o||function(e){return e.duplicate()},a.splice(0,a.length),r.forEach((function(e){a.push(o(e))})),a}},{key:"updateTapxs",value:function(e,t,n){for(var i=[],o=e;o<e+t;){var a=this.getTapx(o,f.IT.Include,n);if(a.len<=0){console.log("invalid situation at position:"+o);break}i.push(a),o=a.pos+a.len}return i}},{key:"onBeforeInsertText",value:function(e,t,n,i){}},{key:"onInsertText",value:function(e,t,n,i){if(!(n.length<=0))for(var o={},a=1;a<this.rowLists.length;++a){var r=this.rowLists[a],s=this.cellLists[a];r&&(r.fetchInfoContainPos(o,t)&&(s.detachNodes(o.begin,o.end,f.IT.strictIntersectTest),r.detachNode(o.node)),r.expand(t,n.length),s.expand(t,n.length))}}},{key:"onBeforeDeleteText",value:function(e,t,n){}},{key:"onDeleteText",value:function(e,t,n){if(this.obsoleteRange(t,n.length),!(n.length<=0))for(var i=1;i<this.rowLists.length;++i){var o=this.rowLists[i];o&&o.remove(t,n.length);var a=this.cellLists[i];a&&a.remove(t,n.length)}}},{key:"onChpxChanged",value:function(e,t){this.obsoleteRange(t.pos,t.len)}},{key:"onPapxChanged",value:function(e,t){this.obsoleteRange(t.pos,t.len)}},{key:"onSettingsChanged",value:function(){this.rowLists.forEach((function(e){return e.detachAllNodes()})),this.cellLists.forEach((function(e){return e.detachAllNodes()}))}},{key:"obsoleteRange",value:function(e,t){var n=this;if(!(t<=0))for(var i=function(i){var o=n.rowLists[i],a=n.cellLists[i];if(!o)return"continue";o.mapInRange(e,e+t,f.IT.mapToRangeAndNode,f.IT.strictIntersectTest).forEach((function(e){a.mapInRange(e.begin,e.end,f.IT.mapToNode,f.IT.strictIntersectTest).forEach((function(e){a.detachNode(e)})),o.detachNode(e.node)}))},o=1;o<this.rowLists.length;++o)i(o)}},{key:"print",value:function(){for(var e=0;e<this.rowLists.length;++e)this.rowLists[e]&&(console.log("Layer: "+e+":"),this.rowLists[e].forEachNode((function(e){var t="";e.prop?(t+="Row: ["+e.begin+", "+e.end+") Cells:",e.cellDatas.forEach((function(e){t+=" ["+e.begin+", "+e.end+")"}))):t+="Not in table: ["+e.begin+", "+e.end+")",console.log(t)})))}}]),e}(),Mt=function(){function e(t,n){l()(this,e),n.attachObserver(this),this.prime=t,this.hiddens=new f.ITToolkit(f.IT.upper,f.IT.NonIntersect,!0)}return c()(e,[{key:"getHiddenRanges",value:function(e,t){return this.hiddens.mapInRange(e,t,f.IT.mapToNode,f.IT.strictIntersectTest)}},{key:"getSpaceAfterPos",value:function(e,t,n){var i,o=this.getTextAround(n.pos,t,n,(function(e,t){return{found:!0}}),(i=" ",function(e,n){for(var o=n.index,a=0;a<t&&e[o+a]===i;a++);var r=!1;return a<t&&(r=!0),{found:r,index:o+a}}));return o&&o.text?e+o.text.length:null}},{key:"show",value:function(e,t){var n=e,i=e+t,o=this.hiddens.detachNodes(n,i,f.IT.strictIntersectTest).boundary;o.begin<n&&this.hiddens.attachNode(new f.ITRange(o.begin,n)),o.end>i&&this.hiddens.attachNode(new f.ITRange(i,o.end))}},{key:"hide",value:function(e,t){var n=this.hiddens.detachNodes(e,e+t).boundary;this.hiddens.attachNode(new f.ITRange(n.begin,n.end))}},{key:"getText",value:function(e,t){var n=this,i=e,o="",a=i,r=i+t;return this.hiddens.forEachHintInRange(a,r,(function(e){i<e.pos&&(o+=n.prime.getText(i,e.pos-i)),i=e.end}),f.IT.strictIntersectTest),i<r&&(o+=this.prime.getText(i,r-i)),{text:o,range:{begin:a,end:r}}}},{key:"getComplementary",value:function(e){var t=[];return t.push({begin:e.begin,end:e.end,pos:e.begin,len:e.end-e.begin}),this.hiddens.forEachHintInRange(e.begin,e.end,(function(e){var n=t.pop();e.begin>=n.begin&&e.end<=n.end?(e.begin>n.begin&&t.push({begin:n.begin,end:e.begin,pos:n.begin,len:e.begin-n.begin}),e.end<n.end&&t.push({begin:e.end,end:n.end,pos:e.end,len:n.end-e.end})):e.end<n.end?t.push({begin:e.end,end:n.end,pos:e.end,len:n.end-e.end}):e.begin>n.begin&&t.push({begin:n.begin,end:e.begin,pos:n.begin,len:e.begin-n.begin})}),f.IT.strictIntersectTest),t}},{key:"transformIndexBasedOnGetTextResult2OriginGCP",value:function(e,t){for(var n=this.getComplementary(e),i=t,o=0;o<n.length;++o){var a=n[o],r=a.end-a.begin;if(!(i+1>r))return a.begin+i;i-=r}return-1}},{key:"amendPosition",value:function(e){var t=e.position,n=e.glyphTail,i=window.APP.data.doc.getLimitedRange(t).pos;return n&&(t-=1),t=Math.max(i,t)}},{key:"getSentenceByPunctuation",value:function(e){var t=this.amendPosition(e),n=window.APP.data.doc.textStream.getPapx(t),i=n.pos,o=n.len,a=this.getText(i,o),r=a.text,s=r.length,l=this.positionToFragmentIndex(t,a),u=/[\s\‒\–\—\―|$&~=\\\/⁄@+*!?({[\]})<>‹›«».;:^‘’“”'",،、`·\•†‡°″¡¿※#№÷×%‰\−‱¶′‴§_‖¦\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/,c=/[\u0e00-\u0e7f]\./,h=r[l];if((!u.test(h)||!(l-1<0)&&c.test(r[l-1]+h))&&r){for(var d=l,p=l,f=1,g=1,v=!1,m=!1;(!v||!m)&&!(l-f<0&&l+g>=s);f++,g++){if(!v&&l-f>=0){var _=r[l-f];u.test(_)&&(l-f-1<0||!c.test(r[l-f-1]+_))&&(d=l-f,v=!0)}if(!m&&l+g<s){var y=r[l+g];u.test(y)&&(l+g-1<0||!c.test(r[l+g-1]+y))&&(p=l+g,m=!0)}}d=d===l?0:d+1,p===l&&(p=s);var b={text:r.slice(d,p),range:{begin:this.fragmentIndexToPosition(d,a),end:this.fragmentIndexToPosition(p,a)}};return{fragment:b,index:this.positionToFragmentIndex(t,b),limit:i+o}}}},{key:"getCutRangeForIndex",value:function(e,t,n){var i=0,o=0,a=void 0,r=null;for(a=0;a<e.length;a++)if(i=o,t<(o+=e[a])){r={begin:this.fragmentIndexToPosition(i,n),end:this.fragmentIndexToPosition(o,n)};break}return a>=e.length&&console.warn("⚠️[BigBang] Get Cut Range for index is NOT ILLegal"),r}},{key:"testGetSentenceByPunctuation",value:function(){this.hide(5,2),this.hide(15,3);var e=window.APP.data.doc.textStream.getPapx(0),t=e.pos,n=e.len,i=this.getText(t,n);console.log("---- Hide Papx: ",i);for(var o=0;o<n;o++)this.getSentenceByPunctuation(o)}},{key:"getTextAround",value:function(e,t,n,i,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:f.IT.Include,r=this.getFragmentAround(e,t,n,i,o,a),s={found:!1,index:r.indexOfPosition},l=s,u=null,c=-1,h=-1;for((u=o(r.text,l)).found&&(u.index<=l.index?a===f.IT.Include?(c=u.index,l=u,(u=o(r.text,l)).found?h=u.index:l=u):(h=u.index,l=u):h=u.index);-1===c;){if((u=i(r.text,l)).found){c=u.index,l=s;break}var d=this.getFragmentReverse(r.range.begin,t,n);if(0===d.text.length){c=0;break}(l=u).index=d.text.length,r.range.begin=d.range.begin,r.text=d.text+r.text}for(;-1===h;){var p=this.getFragment(r.range.end,t,n);if(0===p.text.length){h=r.text.length;break}if(r.range.end=p.range.end,r.text=r.text+p.text,(u=o(r.text,l)).found){h=u.index;break}l=u}return r.range.end=this.fragmentIndexToPosition(h,r),r.range.begin=this.fragmentIndexToPosition(c,r),r.text=r.text.slice(c,h),r}},{key:"positionToFragmentIndex",value:function(e,t){var n=e,i={begin:t.range.begin,end:e};return this.hiddens.forEachHintInRange(t.range.begin,e,(function(t){f.IT.calcBoundary(i,t),n-=Math.min(t.end,e)-t.begin})),n-Math.min(t.range.begin,i.begin)}},{key:"fragmentIndexToPosition",value:function(e,t){var n=e,i=0,o=t.range.begin,a=!1;return this.hiddens.forEachHintInRange(t.range.begin,t.range.end,(function(e){a||(o<e.begin?i=e.begin-o:(i=0,o=e.end),i>=n?(o+=n,a=!0):(n-=i,o=e.end))})),a||(o+=n),o}},{key:"getFragmentAround",value:function(e,t,n,i,o,a){var r=this.getFragmentReverse(e,t,n),s=this.getFragment(e,t,n);return{text:r.text+s.text,range:{begin:r.range.begin,end:s.range.end},indexOfPosition:r.text.length}}},{key:"getFragment",value:function(e,t,n){var i=e,o=[],a={begin:i,end:i},r=t;if(t<=0)return{text:"",range:a};this.hiddens.pointKeyword.config(i,f.IT.Include);var s=this.hiddens.seekHint(this.hiddens.HintVT.it_hint1,this.hiddens.pointKeyword),l=0,u=0,c=n.pos+n.len;s.begin<=i&&i<s.end&&(i=s.end,s.moveNext());do{u=s.good()?Math.min(s.begin,c):c,u=i+(l=Math.min(u-i,r)),o.push(this.prime.getText(i,l)),i=s.end,r-=l,s.moveNext()}while(u<c&&i<c&&r);return a.end=u,{text:o.join(""),range:a}}},{key:"getFragmentReverse",value:function(e,t,n){var i=e,o=[],a={begin:i,end:i},r=t;if(!t)return{text:"",range:a};this.hiddens.pointKeyword.config(i);var s=this.hiddens.seekHint(this.hiddens.HintVT.it_hint1,this.hiddens.pointKeyword),l=0,u=0,c=n.pos;u=s.begin<i&&i<=s.end?s.begin:i,s.movePrev(),i=s.end;do{i=s.good()?Math.max(s.end,c):c,i=u-(l=Math.min(u-i,r)),o.push(this.prime.getText(i,l)),u=s.begin,r-=l,s.movePrev()}while(i>c&&u>c&&r);return a.begin=i,{text:o.reverse().join(""),range:a}}},{key:"onInsertText",value:function(e,t,n,i,o){this.hiddens.expand(t,n.length)}},{key:"onDeleteText",value:function(e,t,n){this.hiddens.remove(t,n.length)}}]),e}(),Lt=n(2292);function Ft(e,t){var n=e.length,i=e[0],o=e[n-1],a=0;t.pos>i.pos&&(a=t.pos-i.pos,i.pos+=a,i.len-=a),o.len=Math.min(o.len,t.pos+t.len-o.pos)}var Bt=function(){function e(){l()(this,e)}return c()(e,null,[{key:"obsoleted_getSegments",value:function(e){var t=this;if(!e)return[];var n=this.doc,i=this.collectPapxs(e.pos,e.len),o=[];if(0==i.length)return[];Ft(i,e);var a=void 0,r=void 0;return i.forEach((function(e){var i=e.pos,s=i+e.len,l=t.collectChpxs(i,e.len),u=n.getSubDocType(i),c=!1,h=e.prop.getPropVal("nest_level");if(h>0){var d=!1;r&&r.prop&&(d=h!=r.prop.getPropVal("nest_level")),(!r||i>=r.end||d)&&(r=t.specTable.getTapx(i,h));var p=r.cellDatas,f=r.cells,g=0;if(p)for(var v=p.length;g<v;++g)if(i<p[g].end){f[g]&&Lt.a.isTransposeCoor(f[g].textDirection)&&(c=!0);break}}else if(u===w.Textbox||u===w.TextboxInHF){var m=n.textboxs.rangeClass.findNodeContainPos(i),_=m&&m.anchor,y=_&&_.shapeData&&m.anchor.shapeData.textOrientation;Lt.a.isTransposeCoorOrientation(y)&&(c=!0)}else(!a||i>=a.end)&&(a=t.doc.sections.getSection(i)),a&&Lt.a.isTransposeCoor(a.getTextFlow())&&(c=!0);Ft(l,e),l.forEach((function(t){var n=Math.max(i,t.pos),a=Math.min(s,t.pos+t.len),r=new Rt.a({pos:n,len:a-n},t.prop,e.prop);c&&(r.isTransposeCoor=!0),o.push(r)}))})),o}},{key:"adapt",value:function(t,n){return t.specTable=new Dt(t,n),t.specHidden=new Mt(n.getDataLogic("prime"),n),t.getSegments=e.obsoleted_getSegments,t}}]),e}(),Ht=function(){function e(t,n){l()(this,e),this.init(t,n)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCDataLogic",base:D.a,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t){this.mixin_DOCDataLogic_init(e),this.doc=t,this.useMergePap=!1}},{key:"getChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getChp(e,t);if(n){var i=this.useMergePap?this.upstream.getPap(e,t):this.upstream.getOriginPap(e,t);n=wt.a.getChpWithStyle(n,i,this.doc)}return n}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getChpx(e,t);if(n.good){var i=this.useMergePap?this.upstream.getPap(e,t):this.upstream.getOriginPap(e,t);n.prop=wt.a.getChpWithStyle(n.prop,i,this.doc)}return n}},{key:"collectChpxs",value:function(e,t){for(var n=e,i=t,o=[],a=this.upstream.getChpx(n),r=this.upstream.getPapx(n);a.good;a=this.upstream.getNextChpx(a)){a.prop=wt.a.getChpWithStyle(a.prop,r.prop,this.doc),o.push(a);var s=a.pos+a.len-n;if(n+=s,(i-=s)<=0)break;n>=r.pos+r.len&&this.upstream.movePapxToNext(r)}return o}},{key:"getPrevChpx",value:function(e){return this.getChpx(e.pos,f.IT.Exclude)}},{key:"getNextChpx",value:function(e){return this.getChpx(e.pos+e.len)}},{key:"moveChpxToPrev",value:function(e){if(this.upstream.moveChpxToPrev(e),e.good){var t=this.upstream.getPap(e.pos,f.IT.Exclude);e.prop=wt.a.getChpWithStyle(e.prop,t,this.doc)}}},{key:"moveChpxToNext",value:function(e){if(this.upstream.moveChpxToNext(e),e.good){var t=this.upstream.getPap(e.pos+e.len);e.prop=wt.a.getChpWithStyle(e.prop,t,this.doc)}}},{key:"getPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getPap(e,t);return n&&(n=wt.a.getPapWithStyle(n,this.doc)),n}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getPapx(e,t);return n.good&&(n.prop=wt.a.getPapWithStyle(n.prop,this.doc)),n}},{key:"collectPapxs",value:function(e,t){for(var n=e,i=t,o=[],a=this.upstream.getPapx(n);a.good;a=this.upstream.getNextPapx(a)){a.prop=wt.a.getPapWithStyle(a.prop,this.doc),o.push(a);var r=a.pos+a.len-n;if(n+=r,(i-=r)<=0)break}return o}},{key:"getPrevPapx",value:function(e){return this.getPapx(e.pos,f.IT.Exclude)}},{key:"getNextPapx",value:function(e){return this.getPapx(e.pos+e.len)}},{key:"movePapxToPrev",value:function(e){this.upstream.movePapxToPrev(e),e.good&&(e.prop=wt.a.getPapWithStyle(e.prop,this.doc))}},{key:"movePapxToNext",value:function(e){this.upstream.movePapxToNext(e),e.good&&(e.prop=wt.a.getPapWithStyle(e.prop,this.doc))}},{key:"getChpxWithPap",value:function(e,t){var n=this.upstream.getChpx(e,f.IT.Include);return n.good&&(n.prop=wt.a.getChpWithStyle(n.prop,t,this.doc)),n}},{key:"nickname",get:function(){return"DataLogic: styled"}}]),e}(),Gt=Ht;R.a.mix(Ht,D.a);var Wt=function(){function e(t,n){l()(this,e),this.init(t,n)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCStyledDataLogic",base:Gt,methodName:"init"},{baseName:"DOCStyledDataLogic",base:Gt,methodName:"getChpx"},{baseName:"DOCStyledDataLogic",base:Gt,methodName:"getPapx"}]}}]),c()(e,[{key:"init",value:function(e,t){this.mixin_DOCStyledDataLogic_init(e,t),this.chpxTable=new be,this.papxTable=new be}},{key:"getChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.getChpx(e,t),i=null;return n.good&&(i=n.prop),n.free(),i}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.chpxTable.fetchHintContainPos(this.chpxTable.HintVT.it_hint1,e,t),i=null;return n.good()?i=D.b.make(!0,n.pos,n.len,n.prop.duplicate()):(i=this.mixin_DOCStyledDataLogic_getChpx(e,t)).good&&(this.chpxTable.reset(i.pos,i.len,[i]),i.prop=i.prop.duplicate()),i}},{key:"collectChpxs",value:function(e,t){var n=this,i=t,o=e;0===i&&(i=1);var a=o+i,r=[],s=null,l=null,u=function(e){return l?(l.pos<=e&&e<l.pos+l.len||n.upstream.movePapxToNext(l),l.prop):(l=n.useMergePap?n.upstream.getPapx(e):n.upstream.getOriginPapx(e)).prop};for(s=this.getChpxFast(o,u);s.good&&(r.push(s),!(a<=(o=s.pos+s.len)));s=this.getChpxFast(o,u));return l&&l.free(),r}},{key:"moveChpxToPrev",value:function(e){var t=this.getPrevChpx(e);t.good?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood(),t.free()}},{key:"moveChpxToNext",value:function(e){var t=this.getNextChpx(e);t.good?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood(),t.free()}},{key:"getPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.getPapx(e,t),i=null;return n.good&&(i=n.prop),n.free(),i}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.papxTable.fetchHintContainPos(this.papxTable.HintVT.it_hint1,e,t),i=null;return n.good()?i=D.b.make(!0,n.pos,n.len,n.prop.duplicate()):(i=this.mixin_DOCStyledDataLogic_getPapx(e,t)).good&&(this.papxTable.reset(i.pos,i.len,[i]),i.prop=i.prop.duplicate()),i}},{key:"collectPapxs",value:function(e,t){var n=t,i=e;0===n&&(n=1);var o=i+n,a=[],r=null;for(r=this.getPapx(i);r.good&&(a.push(r),!(o<=(i=r.pos+r.len)));r=this.getPapx(i));return a}},{key:"movePapxToPrev",value:function(e){var t=this.getPrevPapx(e);t.good?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood(),t.free()}},{key:"movePapxToNext",value:function(e){var t=this.getNextPapx(e);t.good?(e.good=!0,e.pos=t.pos,e.len=t.len,e.prop=t.prop):e.noGood(),t.free()}},{key:"onBeforeInsertText",value:function(e,t,n,i){this._dispatch("onBeforeInsertText",t,n,i)}},{key:"onInsertText",value:function(e,t,n,i){this.onInsertChpx(t,n.length),this.onInsertPapx(t,n.length),this._dispatch("onInsertText",t,n,i)}},{key:"onBeforeDeleteText",value:function(e,t,n){this._dispatch("onBeforeDeleteText",t,n)}},{key:"onDeleteText",value:function(e,t,n){this.onDeleteChpx(t,n.length),this.onDeletePapx(t,n.length),this._dispatch("onDeleteText",t,n)}},{key:"onChpxChanged",value:function(e,t){this.onSetPapx(t.pos,t.len),this.onSetChpx(t.pos,t.len),this._dispatch("onChpxChanged",t)}},{key:"onPapxChanged",value:function(e,t){this.onSetPapx(t.pos,t.len),this.onSetChpx(t.pos,t.len),this._dispatch("onPapxChanged",t)}},{key:"onSettingsChanged",value:function(){this.papxTable.detachAllNodes(),this.chpxTable.detachAllNodes(),this._dispatch("onSettingsChanged")}},{key:"onStyleChanged",value:function(e,t,n,i){var o=this;i?t.forEach((function(e){o.onSetPapx(e.pos,e.len)})):t.forEach((function(e){o.onSetChpx(e.pos,e.len)}))}},{key:"getChpxFast",value:function(e,t){var n=this.chpxTable.fetchHintContainPos(this.chpxTable.HintVT.it_hint1,e,f.IT.Include),i=null;return n.good()?i=D.b.make(!0,n.pos,n.len,n.prop.duplicate()):(i=this.getChpxWithPap(e,t(e))).good&&(this.chpxTable.reset(i.pos,i.len,[i]),i.prop=i.prop.duplicate()),i}},{key:"onInsertChpx",value:function(e,t){if(!(t<=0)){var n=this.getInvalidChpxRange(e,t),i=n.begin,o=n.end;this.chpxTable.expand(e,t),this.obsoleteChpxRange(i,o-i)}}},{key:"onInsertPapx",value:function(e,t){if(!(t<=0)){var n=this.getInvalidPapxRange(e,t),i=n.begin,o=n.end;this.papxTable.expand(e,t),this.obsoletePapxRange(i,o-i)}}},{key:"onDeleteChpx",value:function(e,t){if(!(t<=0)){var n=this.upstream.getChpx(e,f.IT.Exclude),i=this.upstream.getChpx(e,f.IT.Include),o=n.good?n.pos:e,a=i.good?i.pos+i.len:e;this.chpxTable.remove(e,t),this.obsoleteChpxRange(o,a-o)}}},{key:"onDeletePapx",value:function(e,t){if(!(t<=0)){var n=this.upstream.getPapx(e,f.IT.Exclude),i=this.upstream.getPapx(e,f.IT.Include),o=n.good?n.pos:e,a=i.good?i.pos+i.len:e;this.papxTable.remove(e,t),this.obsoletePapxRange(o,a-o)}}},{key:"onSetChpx",value:function(e,t){if(!(t<=0)){var n=this.getInvalidChpxRange(e,t),i=n.begin,o=n.end;this.obsoleteChpxRange(i,o-i)}}},{key:"onSetPapx",value:function(e,t){if(!(t<=0)){var n=this.getInvalidPapxRange(e,t),i=n.begin,o=n.end;this.obsoletePapxRange(i,o-i)}}},{key:"getInvalidChpxRange",value:function(e,t){var n=this.upstream.collectChpxs(e,t);if(n.length<=0)return console.log("Collected chpxs failed!"),{begin:e,end:e};var i=n[0].pos,o=n[n.length-1].pos+n[n.length-1].len;return n.forEach((function(e){e.free()})),{begin:i,end:o}}},{key:"getInvalidPapxRange",value:function(e,t){var n=this.upstream.collectPapxs(e,t);if(n.length<=0)return console.log("Collected papxs failed!"),{begin:e,end:e};var i=n[0].pos,o=n[n.length-1].pos+n[n.length-1].len;return n.forEach((function(e){e.free()})),{begin:i,end:o}}},{key:"obsoleteChpxRange",value:function(e,t){var n=this,i=t,o=e;i<=0||(o>0&&(--o,++i),this.chpxTable.getProps(o,i,(function(e){return e._node})).forEach((function(e){n.chpxTable.detachNode(e)})))}},{key:"obsoletePapxRange",value:function(e,t){var n=this;t<=0||this.papxTable.getProps(e,t,(function(e){return e._node})).forEach((function(e){n.papxTable.detachNode(e)}))}},{key:"nickname",get:function(){return"DataLogic: styled(cached)"}}]),e}(),jt=Wt;R.a.mix(Wt,Gt);var Ut=n(2180),Vt=n(1417),Yt=n(3332),zt={},Kt=String.fromCharCode(Ne.q),Zt=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,f.IT.upper,f.IT.NonIntersect,!1));return i.doc=e,i.api=n,i.docmapInvalidRanges=new Vt.default(f.IT.inner),i.doc.textStream.getPureTextStream().attachObserver(i),i.mapListId2Items={},i.queryingAutoNumInfos=[],i._dealRange({begin:0,end:-1}),Object(p.default)(i),i.bFirstGetItems=!0,i._doQueryAutoNumString(),i.reQueryCount=0,i.maxReQueryCount=10,i}return y()(t,e),c()(t,[{key:"clearAll",value:function(){this.docmapInvalidRanges.reset(),this.doc.textStream.getPureTextStream().detachObserver(this)}},{key:"fetchInitItems",value:function(){this.bFirstGetItems?this.bFirstGetItems=!1:this.processInvalidRanges();var e=this.doc.subdocs[w.MainText];return this._collectItems(0,e.getTextSize(),!0)}},{key:"_needFetchAutoNum",value:function(){for(var e in this.mapListId2Items)if(void 0!==this.mapListId2Items[e].minBegin)return!0;return!1}},{key:"hasInvalidRanges",value:function(){return!this.docmapInvalidRanges.empty()||this._needFetchAutoNum()}},{key:"_doQueryAutoNumString",value:function(){if(!window.__WPSENV__.cache_preview){var e=[];for(var t in this.mapListId2Items){var n=this.mapListId2Items[t].minBegin;if(void 0!==n){for(var i=[],o={listId:parseInt(t),autoNums:i},a=0;a<this.mapListId2Items[t].items.length;++a){var r=this.mapListId2Items[t].items[a],s={pos:r.begin,len:r.len};s.pos>=n&&this._isAutoNumCalcRequired(s)&&i.push(s)}i.length>0&&(e.push(o),this.queryingAutoNumInfos.push({listId:o.listId,minBegin:n})),delete this.mapListId2Items[t].minBegin}}if(e.length>0){var l={autoNumInfos:e};this.api.queryCommandQueue("autoNums",l)}}}},{key:"_isAutoNumCalcRequired",value:function(e){var t=this.doc.getDataLogic("final"),n=t.getPapx(e.pos);return 1!==n.len||t.getChar(n.pos).charCodeAt(0)!==Ne.m}},{key:"processInvalidRanges",value:function(){this.docmapInvalidRanges.empty()||this.docmapInvalidRanges.doInTurn(this._dealRange.bind(this)),this.queryingAutoNumInfos.length>0||this._doQueryAutoNumString()}},{key:"_isInvalidCharCode",value:function(e){return e===Ne.d||e===Ne.e||e===Ne.b||e===Ne.c||e===Ne.t||e===Ne.s||e===Ne.z||e===Ne.j||e===Ne.l||e===Ne.m||e===Ne.k||e===Ne.i||e===Ne.a||e===Ne.f||e===Ne.g}},{key:"_isInResult",value:function(e){for(var t=0;t<e.length;++t)if(e[t])return!1;return!0}},{key:"getItemText",value:function(e,t){var n="",i=e,o=this.doc.fields.getFields({begin:e,end:t});if(o.length>0&&o[0].pos<i){i=o[0].pos;var a=o[0].sep;void 0!==a&&(i=a+1)}for(var r=this.doc.getDataLogic("final"),s=[],l=0;i<t;){var u=i,c=r.getChpx(i),h=c.pos+c.len;if(h===i){console.log("怎么走不动！");break}i=h;var d=c.prop,p=this.doc.getText(c.pos,c.len);if(p.length<=0)console.log("怎么取不到文本！");else{if(d.getPropVal("special")){var f=p.charCodeAt(0);if(f===Ne.n){s.push(!0);continue}if(f===Ne.o){s.length>0&&s.splice(s.length-1,1);continue}if(f===Ne.p){s.length>0&&(s[s.length-1]=!1);continue}if(!this._isInResult(s))continue;if(this._isInvalidCharCode(f))continue}else if(!this._isInResult(s))continue;if(!(d.getPropVal("vanish")||d.getPropVal("revision")&&d.getPropVal("revision").delete)&&i>=e){l||(l=c.pos-e);var g=window.APP.data.doc,v=window.APP.data.typoinfo.textLineRanges;if(p.indexOf(Kt)>=0)for(var m=p;m.length>0;){var _=m.indexOf(Kt);if(0===_){var y=g.footnotes.getNote(u),b=v.findNodeContainPos(u);y?b&&(n+=Object(Yt.f)(y,!0,b.viewPage,g)):(y=g.endnotes.getNote(u))&&b&&(n+=Object(Yt.f)(y,!1,b.viewPage,g)),m=m.substring(1),++u}else n+=m.substring(0,_),m=m.substring(_),u+=_}else n+=p;if(n.length>300){n=n.substr(0,300)+"...";break}}}}return{textPos:l,text:n}}},{key:"update",value:function(){void 0!==this._dispatch&&this._dispatch("onDataUpdate")}},{key:"_reQueryAutoNumStrings",value:function(){for(var e=0;e<this.queryingAutoNumInfos.length;++e)this.mapListId2Items[this.queryingAutoNumInfos[e].listId]&&(void 0===this.mapListId2Items[this.queryingAutoNumInfos[e].listId].minBegin||this.mapListId2Items[this.queryingAutoNumInfos[e].listId].minBegin>this.queryingAutoNumInfos[e].minBegin)&&(this.mapListId2Items[this.queryingAutoNumInfos[e].listId].minBegin=this.queryingAutoNumInfos[e].minBegin);this.queryingAutoNumInfos=[],this._dispatch("onDataUpdate")}},{key:"onQueryAutoNumStringBack",value:function(e,t){var n=this;if(0!==e)return this.reQueryCount=Math.min(this.maxReQueryCount,++this.reQueryCount),void setTimeout((function(){n._reQueryAutoNumStrings()}),1e3*this.reQueryCount);this.reQueryCount=0;for(var i=t.autoNumInfos,o=0;o<i.length;++o){var a=i[o],r=this.mapListId2Items[a.listId];if(void 0===r)break;for(var s=a.autoNums,l=0,u=-1;l<s.length;++l){var c=s[l];if(r.items[u+1].begin!==c.pos){for(var h=0;h<r.items.length;++h)if(r.items[h].begin===c.pos){if(u=h,c.string){r.items[u].listString=c.string,r.items[u].fontName=c.fontName;var d=(0===c.pos?[]:this._collectItems(0,c.pos,!0)).length;this._dispatch("onItemAutoNumChanged",d,r.items[u])}break}if(h===r.items.length)break}else{if(!c.string)continue;r.items[u+1].listString=c.string,r.items[u+1].fontName=c.fontName;var p=(0===c.pos?[]:this._collectItems(0,c.pos,!0)).length;this._dispatch("onItemAutoNumChanged",p,r.items[u+1]),++u}}if(l<s.length)break}o<i.length?this._reQueryAutoNumStrings():this.queryingAutoNumInfos=[]}},{key:"onInsertText",value:function(e,t,n,i){var o=t+n.length;o>this.doc.subdocs[w.MainText].getTextSize()||(this.expand(t,n.length),this.docmapInvalidRanges.expand(t,n.length),this.docmapInvalidRanges.todo({begin:t,end:o}))}},{key:"onDeleteText",value:function(e,t,n){var i=t,o=this.doc.subdocs[w.MainText].getTextSize();i>o||(i<o&&++i,this.remove(t,n.length),this.docmapInvalidRanges.remove(t,n.length),this.docmapInvalidRanges.todo({begin:t,end:i}))}},{key:"onBeforeDeleteText",value:function(e,t,n){}},{key:"onBeforeInsertText",value:function(e,t,n,i){}},{key:"onSetProp",value:function(e,t){var n=t.pos+t.len,i=this.doc.subdocs[w.MainText].getTextSize();n>i||(n<i&&++n,this.docmapInvalidRanges.todo({begin:t.pos,end:n}))}},{key:"onChpxChanged",value:function(e,t){this.onSetProp(e,t)}},{key:"onPapxChanged",value:function(e,t){this.onSetProp(e,t)}},{key:"_isParaEndHidden",value:function(e){var t=this.doc.getDataLogic("final").getChpx(e-1).prop;return t.getPropVal("vanish")||t.getPropVal("revision")&&t.getPropVal("revision").delete}},{key:"_getDocmapItemRange",value:function(e,t){var n=t,i=this._isParaEndHidden(n);if(!i)return{begin:e,end:n};var o=this.doc.getDataLogic("final").collectChpxs(e,n-e);if(0!==o.length){for(var a=0;a<o.length;a++){var r=o[a].prop;if(!(i=r.getPropVal("vanish")||r.getPropVal("revision")&&r.getPropVal("revision").delete))break}if(a!==o.length){for(;;){if(!this.doc.textStream.getPapxTbl().fetchInfoContainPos(zt,n))return;if(n=zt.end,!this.doc.containConcernRanges(n-1,n))break;if(0!==zt.node.prop.getPropVal("nest_level"))break;if(!this._isParaEndHidden(n))break}return{begin:e,end:n}}}}},{key:"_collectItems",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.mapInRange(e,e+t,f.IT.mapToNode,n&&f.IT.strictIntersectTest)}},{key:"_insertDocmapItem",value:function(e,t,n,i,o){var a=(0===e?[]:this._collectItems(0,e,!0)).length,r=new f.ITRange(e,t);r.level=n,r.listLvl=i,r.listId=o,this.attachNode(r),this._insertAutoNum(r),void 0!==this._dispatch&&this._dispatch("onItemInsert",a,r)}},{key:"_insertAutoNum",value:function(e){if(-1!==e.listId)if(void 0===this.mapListId2Items[e.listId]){var t=[];t.push(e),this.mapListId2Items[e.listId]={minBegin:e.begin,items:t}}else void 0!==this.mapListId2Items[e.listId].minBegin?this.mapListId2Items[e.listId].minBegin>e.begin&&(this.mapListId2Items[e.listId].minBegin=e.begin):this.mapListId2Items[e.listId].minBegin=e.begin,this.mapListId2Items[e.listId].items.push(e)}},{key:"_markInvalidAutoNum",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1!==e.listId){var n=this.mapListId2Items[e.listId];if(n?void 0!==n.minBegin?n.minBegin>e.begin&&(n.minBegin=e.begin):n.minBegin=e.begin:console.log("mapListId2Items有问题。"),t){for(var i=0;i<n.items.length;++i)if(n.items[i]===e){n.items.splice(i,1);break}0===n.items.length&&delete this.mapListId2Items[e.listId]}}}},{key:"_collectAndDeleteInvalidItems",value:function(e,t){var n=[],i=this._collectItems(e,t-e);if(0===i.length)return n;for(var o=0;o<i.length;++o){var a=i[o];if(!(a.len>0&&(a.begin>=t||a.end<=e))){var r=(0===a.begin?[]:this._collectItems(0,a.begin,!0)).length;0!==a.len&&this._isAutoNumCalcRequired(a)?n.push({item:a,index:r}):(this._markInvalidAutoNum(a),void 0!==this._dispatch&&this._dispatch("onItemDelete",r,a),this.detachNode(a))}}return n}},{key:"_dealRange",value:function(e){var t=e.begin,n=e.end,i=this.doc.subdocs[w.MainText].getTextSize(),o=-1===n,a=[];o?n=i:a=this._collectAndDeleteInvalidItems(t,n);for(var r=0,s=t,l=this.doc.getDataLogic("final");t<n&&this.doc.containConcernRanges(t,t+1)&&this.doc.textStream.getPapxTbl().fetchInfoContainPos(zt,t);){var u=zt.node.prop,c=u.getPropVal("nest_level");if(0===c){var h=void 0,d=this.doc.stylesheet.getStyleByProp(u);if(d&&void 0!==d&&d.papx&&(h=d.papx),c=0,void 0!==h&&(c=h.getPropVal("nest_level")),0===c){var p=l.getPapx(t).prop,f=p.getPropVal("list_id"),g=p.getPropVal("list_level"),v=p.getPropVal("out_line_level");if(v<9&&!p.text_frame){var m=this._getDocmapItemRange(zt.begin,zt.end);if(void 0!==m){for(var _=-1,y=0,b=0;b<a.length;++b)if(a[b].item.begin!==m.begin||a[b].item.end!==m.end){if(a[b].item.begin>=m.end)break;this._markInvalidAutoNum(a[b].item),void 0!==this._dispatch&&this._dispatch("onItemDelete",a[b].index-r,a[b].item),this.detachNode(a[b].item),++r,a.splice(b,1),--b}else _=b,y=r;if(-1!==_){var T=!1,C=a[_].item.listLvl!==g||a[_].item.listId!==f;C&&(a[_].item.listId!==f?(this._markInvalidAutoNum(a[_].item),T=!0):this._markInvalidAutoNum(a[_].item,!1)),a[_].item.level=v,a[_].item.listLvl=g,a[_].item.listId=f,C&&(delete a[_].item.listString,delete a[_].item.fontName),T&&this._insertAutoNum(a[_].item),void 0!==this._dispatch&&this._dispatch("onItemChanged",a[_].index-y,a[_].item),a.splice(_,1)}else this._isAutoNumCalcRequired({pos:m.begin})&&this._insertDocmapItem(m.begin,m.end,v,g,f),--r;t=m.end}else t=zt.end}else t=zt.end}else t=zt.end}else t=zt.end}if(a.length>0){for(var k=0;k<a.length;++k)this._markInvalidAutoNum(a[k].item),void 0!==this._dispatch&&this._dispatch("onItemDelete",a[k].index-r,a[k].item),this.detachNode(a[k].item),++r;a.splice(0,a.length)}if(t<n){var S=n-t;o&&(this.docmapInvalidRanges.expand(t,S),this.docmapInvalidRanges.todo({begin:t,end:n})),S>5e3&&(S=5e3);this.api.queryRange({gcpCurrent:t,length:S},!1)}return{doneRange:{begin:s,end:t},stop:s===t}}}]),t}(f.ITToolkit),Xt=n(4806),qt=n(3487),Jt=n(4578),Qt=n(3859),$t=function(){function e(t,n){l()(this,e),this.init(t),this.doc=n,this.viewSettings=n.viewSettings,this.viewSettings.attachObserver(this)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCDataLogic",base:D.a,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e){this.mixin_DOCDataLogic_init(e)}},{key:"getChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getChp(e,t);return this.getRevisedChp(n)}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getChpx(e,t);return n.good&&(n.prop=this.getRevisedChp(n.prop)),n}},{key:"collectChpxs",value:function(e,t){var n=this,i=this.upstream.collectChpxs(e,t);return i.forEach((function(e){e.good&&(e.prop=n.getRevisedChp(e.prop))})),i}},{key:"getPrevChpx",value:function(e){return this.getChpx(e.pos,f.IT.Exclude)}},{key:"getNextChpx",value:function(e){return this.getChpx(e.pos+e.len)}},{key:"moveChpxToPrev",value:function(e){this.upstream.moveChpxToPrev(e),e.good&&(e.prop=this.getRevisedChp(e.prop))}},{key:"moveChpxToNext",value:function(e){this.upstream.moveChpxToNext(e),e.good&&(e.prop=this.getRevisedChp(e.prop))}},{key:"getPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include;return this.getPapx(e,t).prop}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream,i=function(e,t){if(!e){var n={},i=t.prop.para_type;return i!=xe.b&&i!=xe.d||(n.broken=!0),n}return e},o=function(e,t,i){var o=e.prop.para_type;if(e.prop.nest_level!=t.prop.nest_level)return!1;if(o==xe.b||o==xe.d)return!1;var a=n.getChp(e.pos+e.len,f.IT.Exclude);return Object(Qt.b)(a)},a=function(e,t,i){var o=e.prop.para_type;if(i.broken)return!1;if(e.prop.nest_level!=t.prop.nest_level)return!1;o!=xe.b&&o!=xe.d||(i.broken=!0);var a=n.getChp(e.pos,f.IT.Exclude);return Object(Qt.b)(a)},r=this.upstream.getCompatiblePapx(e,o,i,a,t),s=null;if(r.good){var l=this.upstream.getPap(r.pos+r.len,f.IT.Exclude),u=this.getRevisedPap(l);s=D.b.make(!0,r.pos,r.len,u)}else s=D.b.make();return s}},{key:"collectPapxs",value:function(e,t){var n=this;if(Object(Qt.c)()){for(var i=[],o=e;o<e+t;){var a=this.getPapx(o);if(!a.good)break;i.push(a),o=a.pos+a.len}return i}var r=this.upstream.collectPapxs(e,t);return r.forEach((function(e){e.good&&(e.prop=n.getRevisedPap(e.prop))})),r}},{key:"getPrevPapx",value:function(e){return this.getPapx(e.pos,f.IT.Exclude)}},{key:"getNextPapx",value:function(e){return this.getPapx(e.pos+e.len)}},{key:"movePapxToPrev",value:function(e){this.upstream.movePapxToPrev(e),e.good&&(e.prop=this.getRevisedPap(e.prop))}},{key:"movePapxToNext",value:function(e){this.upstream.movePapxToNext(e),e.good&&(e.prop=this.getRevisedPap(e.prop))}},{key:"getRevisedChp",value:function(e){if(!e||!e.revision||!e.revision.format)return e&&e.duplicate();if(this.doc.viewSettings.getRevisionsView()==Jt.b){var t=e.revision.format.historyBag.duplicate();return t.revision=e.revision,t}return Object(Be.c)(e)}},{key:"getRevisedPap",value:function(e){if(!e||!e.revision||!e.revision.paraFormat)return e&&e.duplicate();if(this.doc.viewSettings.getRevisionsView()==Jt.b){var t=e.revision.paraFormat.historyBag.duplicate();return t.revision=e.revision,t}return Object(Be.d)(e)}},{key:"getOriginPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getPap(e,t);return this.getRevisedPap(n)}},{key:"getOriginPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getPapx(e,t);return n.good&&(n.prop=this.getRevisedPap(n.prop)),n}},{key:"onSettingsChanged",value:function(){this._dispatch("onSettingsChanged")}},{key:"onRevisionsViewChanged",value:function(e,t){return this.onSettingsChanged()}},{key:"onRevisionsModeChanged",value:function(e,t){return this.onSettingsChanged()}},{key:"nickname",get:function(){return"DataLogic: revised"}}]),e}(),en=$t;R.a.mix($t,D.a);var tn=n(1403),nn=function(){function e(t){l()(this,e),this.doc=t,this.finalDataLogic=t.getDataLogic("final"),this.finalDataLogic.attachObserver(this),this.todoList=new Vt.default;var n=t.getSubDocRange(w.MainText);this.todoList.todo({begin:n.pos,end:n.pos+n.len}),this.font_color={}}return c()(e,[{key:"initFontColors",value:function(e){var t=this;this.font_color={},!e||e.length<=0||e.forEach((function(e){if(e.count>0){var n=new tn.a(e.color).color;t.font_color[n]||(t.font_color[n]=0),t.font_color[n]+=e.count}}))}},{key:"getMostUsedColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t;this.update();var i=[];for(var o in this[e]){var a=this[e][o];a>0&&i.push({color:o,count:a})}i.sort((function(e,t){return t.count-e.count})),(n<=0||n>i.length)&&(n=i.length);for(var r=[],s=0;s<n;++s){var l=i[s];r.push(l.color)}return r}},{key:"filter",value:function(e){return this.doc.getSubDocType(e)===w.MainText}},{key:"getAutoColor",value:function(e){switch(e){case"font_color":default:return"#000000"}}},{key:"onBeforeInsertText",value:function(e,t,n,i){this.filter(t)&&(this.todoList.expand(t,n.length),this.todoList.todo({begin:t,end:t+n.length}))}},{key:"onBeforeDeleteText",value:function(e,t,n){this.filter(t)&&(this.invalidRange(t,n.length),this.todoList.remove(t,n.length))}},{key:"onBeforeChpxChanged",value:function(e,t){this.filter(t.pos)&&this.invalidRange(t.pos,t.len)}},{key:"invalidRange",value:function(e,t){var n=this,i=[],o=e;this.todoList.forEachHintInRange(e,e+t,(function(e){e.begin>o&&i.push({pos:o,len:e.begin-o}),o=e.end}),f.IT.strictIntersectTest),e+t>o&&i.push({pos:o,len:e+t-o});var a=this.finalDataLogic;i.forEach((function(e){a.collectChpxs(e.pos,e.len).forEach((function(t){var i=t.prop.getPropSelf("font_color"),o=Math.min(e.pos+e.len,t.pos+t.len)-Math.max(e.pos,t.pos);n.decreaseColorCount("font_color",i,o)}))})),this.todoList.todo({begin:e,end:e+t})}},{key:"update",value:function(){var e=this,t=this.finalDataLogic;this.todoList.doInTurn((function(n){return t.collectChpxs(n.begin,n.end-n.begin).forEach((function(t){var i=t.prop.getPropSelf("font_color"),o=Math.min(n.end,t.pos+t.len)-Math.max(n.begin,t.pos);e.increaseColorCount("font_color",i,o)})),{doneRange:n}}))}},{key:"decreaseColorCount",value:function(e,t,n){var i=t;!this[e]||n<=0||(i=i||this.getAutoColor(e),this[e][i]?(this[e][i]-=n,this[e][i]<=0&&(this[e][i]<0&&console.log("DOCColorManager: The number of this color is Wrong!",e,i),delete this[e][i])):console.log("DOCColorManager: Did not collect this color?",e,i))}},{key:"increaseColorCount",value:function(e,t,n){if(this[e]&&!(n<=0)){var i=t;i=i||this.getAutoColor(e),this[e][i]||(this[e][i]=0),this[e][i]+=n}}},{key:"getActiveColors",value:function(e,t){var n=this,i=[],o=e.selection.getNormalRanges();1===o.length&&0===o[0].len?i.push({pos:o[0].pos,len:o[0].len,prop:e.selection.selInfo.getChpx()}):o.forEach((function(e){var t=n.finalDataLogic.collectChpxs(e.pos,e.len);i=i.concat(t)}));var a=[];return i.forEach((function(e){var i=e.prop.getPropSelf(t)||n.getAutoColor(t);i&&a.push(i)})),(a=[].concat(r()(new Set(a)))).length>0&&a}}]),e}(),on=n(684),an=function(){function e(t){l()(this,e),this.naked_settings=t}return c()(e,[{key:"getDefaultTabSize",value:function(){return this.naked_settings.private.defaultTabWidth}},{key:"getDoNotUseIndentAsTabStop",value:function(){return this.naked_settings.private.doNotUseIndentAsTabStop}},{key:"getNotabForIndent",value:function(){return this.naked_settings.private.notabForIndent}},{key:"getFarEastLineBreakLevel",value:function(){return this.naked_settings.private.farEastLineBreakLevel}},{key:"getFELineBreak11",value:function(){return this.naked_settings.private.feLineBreak11}},{key:"getDiffSBMB",value:function(){return this.naked_settings.private.bDiffSBMB}},{key:"getDocFieldsDefSorting",value:function(){return this.naked_settings.private.docFieldDefSorting}},{key:"getMathPtr",value:function(){return this.naked_settings.private.mathPtr}},{key:"getKerningPuncType",value:function(){var e=this.naked_settings.private.kerningPuncType;return void 0===e||e}},{key:"getSplitPgBreakAndParaMark",value:function(){return this.naked_settings.private.splitPgBreakAndParaMark}},{key:"getFormFieldShadingShow",value:function(){var e=this.naked_settings.private.isShowFormFieldShade;return void 0!==e&&e}},{key:"getFootnotePr",value:function(){return this.naked_settings.private.footnotePr}},{key:"getEndnotePr",value:function(){return this.naked_settings.private.endnotePr}},{key:"getJustificationMode",value:function(){return this.naked_settings.private.justificationMode}},{key:"getIsMegerParaSpacing",value:function(){var e=this.naked_settings.private.noMegerParaSpacing;return void 0===e||!e}},{key:"getSnapTextToGridInTable",value:function(){var e=this.naked_settings.private.dontSnapTextToGridInTable;return void 0===e||!e}},{key:"getWord79LineBreakRule",value:function(){return this.naked_settings.private.useWord97LineBreakRule}},{key:"getGutterPos",value:function(){var e=this.naked_settings.private.gutterPos;return void 0!==e?e:0}},{key:"getAutoApplyAsYouTypeAdjustWordWrap",value:function(){return this.getValue("autoApplyAsYouTypeAdjustWordWrap")}},{key:"getValue",value:function(e){return this.naked_settings.private[e]}}]),e}(),rn=n(1319),sn=n(698),ln=function(){function e(t,n,i,o){l()(this,e),this.doc=o,this.init(t,n,i),i.on(this.onDataChanged.bind(this))}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:T.d,methodName:"init"},{baseName:"DOCRange",base:T.d,methodName:"onExpand"},{baseName:"DOCRange",base:T.d,methodName:"onRemove"}]}}]),c()(e,[{key:"init",value:function(e,t,n){this.mixin_DOCRange_init(e,e+t,n),this._name=n.getName()}},{key:"onExpand",value:function(e,t){this.mixin_DOCRange_onExpand(e,t)}},{key:"onRemove",value:function(e,t){this.mixin_DOCRange_onRemove(e,t)}},{key:"onDataChanged",value:function(e){this.data=e;var t=e.getName();t!=this._name&&(this.doc.documentFields.onNameChange(this._name,t),this._name=t),this.doc.documentFields.onChange({pos:this.pos,len:this.len},!0)}},{key:"name",get:function(){return this._name}},{key:"hidden",get:function(){return!!this.data.getIsHidden()}},{key:"print",get:function(){return!!this.data.getIsPrint()}},{key:"readonly",get:function(){return!!this.data.getIsReadonly()}}]),e}(),un=function(e){function t(e){l()(this,t);var n=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.rangeClass));return n.documentFields=e,n}return y()(t,e),c()(t,[{key:"detach",value:function(e){this.tree.remove(e),this.documentFields.doRemoveNode(e)}}]),t}(rn.c),cn=function(e){function t(e){l()(this,t);var n=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.rangeClass,e.rangeClass.sortby));return n.documentFields=e,n}return y()(t,e),c()(t,[{key:"attach",value:function(e,n){we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).call(this,e,n),this.documentFields.doInsertNode(e)}}]),t}(rn.b);function hn(e,t){var n=t.pos,i=t.len;return 0===i?e.begin<n&&n<e.end:f.IT.containTest(e,t)&&e.end-e.begin>i}var dn=function(){function e(t,n){var i=this;l()(this,e),Object(T.f)(this),Object(p.default)(this),this.rangeClass=new T.e(n,b.g,f.IT.outerupper,f.IT.Nesting,!0),this.doc=n,this.rangeClass.deleteTest=hn,ee.a.bind(this.rangeClass,"detacher",(function(e){return new un(i)})),ee.a.bind(this.rangeClass,"attacher",(function(e){return new cn(i)})),this._size=0,this._nameToFieldMap={},this._indexToNameMap,this._sendUpdateMessage=!1,t.forEach((function(e){i.doInsertNakedRange(e,!0)}))}return c()(e,[{key:"_prepareIndexToNameMap",value:function(){if(!this._indexToNameMap){var e=[];switch(this.rangeClass.forEachHint((function(t){var n=t._node;e.push(n.name)})),this.doc.settings.getDocFieldsDefSorting()){case 0:e.sort()}var t={},n=0;e.forEach((function(e){++n,t[n]=e})),this._indexToNameMap=t}}},{key:"doInsertNakedRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new ln(e.pos,e.len,e.data,this.doc,this);t||(this._sendUpdateMessage=!0),this.rangeClass.attachNode(n),t||(this._sendUpdateMessage=!1)}},{key:"doRemoveNakedRange",value:function(e){var t=this._nameToFieldMap[e.data.getName()];t&&(this._sendUpdateMessage=!0,this.rangeClass.detachNode(t),this._sendUpdateMessage=!1)}},{key:"doInsertNode",value:function(e){++this._size,this._nameToFieldMap[e.name]=e,this._indexToNameMap=null,this.onChange({pos:e.pos,len:e.len})}},{key:"doRemoveNode",value:function(e){delete this._nameToFieldMap[e.name],--this._size,this._indexToNameMap=null,this.onChange({pos:e.pos,len:e.len})}},{key:"onChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._indexToNameMap=null,(this._sendUpdateMessage||t)&&this._dispatch("onFontUpdate",[e]),oe.default.dispatchEvent(oe.default.documentField.DOC_DOCUMENTFIELDS_DATA_UPDATE)}},{key:"getField",value:function(e){return this.rangeClass.findNodeContainPos(e)}},{key:"getFields",value:function(e){var t=e.begin,n=e.end;return this.rangeClass.mapInRange(t,n,(function(e){return e.clone()}),f.IT.strictIntersectTest)}},{key:"getNameByIndex",value:function(e){return this._prepareIndexToNameMap(),this._indexToNameMap[e]}},{key:"getFieldByName",value:function(e){return this._nameToFieldMap[e]}},{key:"getValueByName",value:function(e){var t=this.getFieldByName(e);return t?Object(sn.getPureTextExcludeSpecialPlaceholder)(window.APP.data,[{pos:t.pos,len:t.len}]):""}},{key:"getSize",value:function(){return this._size}},{key:"getAllNames",value:function(){this._prepareIndexToNameMap();for(var e=[],t=1,n=this._size;t<=n;++t)e.push(this._indexToNameMap[t]);return e}},{key:"extendDocumentFields",value:function(e,t,n){var i=t,o=t+n,a=this.rangeClass;e.forEach((function(e){var t=e.pos,n=t+e.len;a.detachNode(e),e.reset(Math.min(i,t),Math.max(o,n)),a.attachNode(e)}))}},{key:"deleteDocumentField",value:function(e){this.rangeClass.detachNode(e)}},{key:"onNameChange",value:function(e,t){this._nameToFieldMap[t]=this._nameToFieldMap[e],delete this._nameToFieldMap[e],this._indexToNameMap=null}}]),e}();R.a.mix(ln,T.d);var pn=n(5744),fn=function(){function e(t){l()(this,e);var n=t.pos,i=n+t.len;this.init(n,i,t)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:f.ITRange,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n){this.mixin_ITRange_init(e,t),this.data=n}},{key:"getData",value:function(){return this.data}},{key:"cloneData",value:function(){return{pos:this.pos,len:this.len,data:this.data}}}]),e}();R.a.mix(fn,f.ITRange);var gn=function(){function e(t,n){l()(this,e),this.manager=t,this.breaks=[],this.init(n)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:T.d,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e){this.mixin_DOCRange_init(e.pos,e.pos+e.len,e.data,e.refId),this._initData(e.data)}},{key:"release",value:function(){this._releaseData()}},{key:"getTopMath",value:function(){return this.isTopMath()?this:this.manager.getMath(this.pos,!0)}},{key:"isTopMath",value:function(){return 0===this.data.getArgType()}},{key:"getAlignPoint",value:function(){if(!this.isTopMath()){var e=this.getTopMath(),t=e.getAlignPoint();return(t=e.begin+t-this.begin)>=0?t:-1}var n=this.manager.document.getDataLogic("prime").collectChpxs(this.begin,this.len).find((function(e){return e.prop.getPropVal("o_math_align")}));return n?n.pos-this.begin:-1}},{key:"getBreaks",value:function(){var e=this;if(this.isTopMath())return this.breaks;var t=this.getTopMath();console.assert(t);var n=[];return t.getBreaks().forEach((function(t){e.begin<=t.begin&&t.begin<e.end&&n.push(t)})),n}},{key:"getFunctions",value:function(){var e=this,t=[];return this.data.getFunctions().forEach((function(n){var i=e._getFunction(n);i&&t.push(i)})),t}},{key:"addFunctionData",value:function(e){var t=this,n=e.pos,i=(e.len,e.data);this.data.writeLock();var o=this.data.getFunctions(),a=o.findIndex((function(e){var i=t._getFunction(e);return!!i&&n<i.begin}));-1===a?o.push(i):o.splice(a,0,i)}},{key:"removeFunctionData",value:function(e){e.pos,e.len;var t=e.data;this.data.writeLock();var n=this.data.getFunctions(),i=n.indexOf(t);i>=0&&n.splice(i,1)}},{key:"_initData",value:function(e){var t=this;e.getBreaks().forEach((function(e){var n=new fn(e);t.manager.attachMathBreak(n),t.breaks.push(n)})),e.on(this.onDataChanged.bind(this))}},{key:"_releaseData",value:function(){var e=this;this.breaks.forEach((function(t){e.manager.detachMathBreak(t)})),this.breaks=[]}},{key:"_getFunction",value:function(e){return this.manager.getMathFunctionByObjId(e.objID)}},{key:"onDataChanged",value:function(e){this._releaseData(),this._initData(e)}}]),e}();R.a.mix(gn,T.d);var vn=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.pos,n.pos+n.len,n.data,n.refId));return i.manager=e,i}return y()(t,e),c()(t,[{key:"getParentMath",value:function(){return this.manager.getMath(this.begin,!1)}},{key:"isTextFunction",value:function(){var e=this.getType();return e===pn.v||e===pn.l||e===pn.o}},{key:"getType",value:function(){return this.getData().getType()}},{key:"getChar",value:function(){return this.getData().getChar()}},{key:"getBBarTop",value:function(){return this.getData().getBBarTop()}},{key:"getElement",value:function(){return this._getMath(this.getData().getElement())}},{key:"getMaths",value:function(){var e=this;return this.getData().getMaths().map((function(t){return e._getMath(t)}))}},{key:"getDen",value:function(){return this._getMath(this.getData().getDen())}},{key:"getNum",value:function(){return this._getMath(this.getData().getNum())}},{key:"getFName",value:function(){return this._getMath(this.getData().getFName())}},{key:"getSub",value:function(){return this._getMath(this.getData().getSub())}},{key:"getSup",value:function(){return this._getMath(this.getData().getSup())}},{key:"getDeg",value:function(){return this._getMath(this.getData().getDeg())}},{key:"getLim",value:function(){return this._getMath(this.getData().getLim())}},{key:"getRows",value:function(){var e=this;return this.getData().getRows().map((function(t){return t.map((function(t){return e._getMath(t)}))}))}},{key:"getBegChar",value:function(){return this.getData().getBegChar()}},{key:"getEndChar",value:function(){return this.getData().getEndChar()}},{key:"getSepChar",value:function(){return this.getData().getSepChar()}},{key:"getBGrow",value:function(){return this.getData().getBGrow()}},{key:"getShapeType",value:function(){return this.getData().getShapeType()}},{key:"getBMaxDist",value:function(){return this.getData().getBMaxDist()}},{key:"getBObjDist",value:function(){return this.getData().getBObjDist()}},{key:"getRowSpacing",value:function(){return this.getData().getRowSpacing()}},{key:"getRowSpacingRule",value:function(){return this.getData().getRowSpacingRule()}},{key:"getAlign",value:function(){return this.getData().getAlign()}},{key:"getFracType",value:function(){return this.getData().getFracType()}},{key:"getBCharTop",value:function(){return this.getData().getBCharTop()}},{key:"getBAlignTop",value:function(){return this.getData().getBAlignTop()}},{key:"getBHideSub",value:function(){return this.getData().getBHideSub()}},{key:"getBHideSup",value:function(){return this.getData().getBHideSup()}},{key:"getLimLocType",value:function(){return this.getData().getLimLocType()}},{key:"getBHideDeg",value:function(){return this.getData().getBHideDeg()}},{key:"getBAlignScripts",value:function(){return this.getData().getBAlignScripts()}},{key:"getColGap",value:function(){return this.getData().getColGap()}},{key:"getColGapRule",value:function(){return this.getData().getColGapRule()}},{key:"getColSpacing",value:function(){return this.getData().getColSpacing()}},{key:"getBPlcHoldHidden",value:function(){return this.getData().getBPlcHoldHidden()}},{key:"getColsAlign",value:function(){return this.getData().getColsAlign()}},{key:"getBreaks",value:function(){return this.getData().getBreaks()}},{key:"getBDiff",value:function(){return this.getData().getBDiff()}},{key:"getBNoBreak",value:function(){return this.getData().getBNoBreak()}},{key:"getBOpEmulator",value:function(){return this.getData().getBOpEmulator()}},{key:"getBShow",value:function(){return this.getData().getBShow()}},{key:"getBTransp",value:function(){return this.getData().getBTransp()}},{key:"getBZeroAsc",value:function(){return this.getData().getBZeroAsc()}},{key:"getBZeroDesc",value:function(){return this.getData().getBZeroDesc()}},{key:"getBZeroWid",value:function(){return this.getData().getBZeroWid()}},{key:"_getMath",value:function(e){return this.manager.getMathByObjId(e.objID)}}]),t}(T.d),mn=function(){function e(t,n,i){l()(this,e),Object(T.f)(this),Object(p.default)(this),this.document=n,this.manager=i,this.rangeClass=new T.e(this.document,b.o,f.IT.outer,f.IT.Nesting,!0),this.rangeClass.attachObserver(this),this.objIds={};var o=this;t.forEach((function(e){o.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new gn(this.manager,e);this.rangeClass.attachNode(t),this.objIds[e.data.objID]=t}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findRangeByRefId(e.refId)||this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.rangeClass.detachNode(t),delete this.objIds[t.data.objID],t.release()}},{key:"getRangeByObjId",value:function(e){return this.objIds[e]}},{key:"onAttachNode",value:function(e,t){this.objIds[t.data.objID]=t,this._dispatch("onAddMath",t)}},{key:"onDetachNode",value:function(e,t){delete this.objIds[t.data.objID],this._dispatch("onDeleteMath",t)}}]),e}(),_n=function(){function e(t,n,i){l()(this,e),Object(T.f)(this),Object(p.default)(this),this.document=n,this.manager=i,this.rangeClass=new T.e(this.document,b.p,f.IT.outer,f.IT.Nesting,!0),this.rangeClass.attachObserver(this),this.objIds={};var o=this;t.forEach((function(e){o.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new vn(this.manager,e);return this.rangeClass.attachNode(t),t}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findRangeByRefId(e.refId)||this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);t&&this.rangeClass.detachNode(t)}},{key:"getRangeByObjId",value:function(e){return this.objIds[e]}},{key:"onAttachNode",value:function(e,t){this.objIds[t.data.objID]=t,this._dispatch("onAddMathFunction",t)}},{key:"onDetachNode",value:function(e,t){delete this.objIds[t.data.objID],this._dispatch("onDeleteMathFunction",t)}}]),e}(),yn=function(){function e(t,n,i){l()(this,e),this.document=i,this.mathBreaks=new f.ITToolkit(f.IT.outer,f.IT.Crossing),this.document.attachObserver(this),this._init(t,n),this._isMathEdit=!1}return c()(e,[{key:"_init",value:function(e,t){this.maths=new mn(e,this.document,this),this.mathFunctions=new _n(t,this.document,this)}},{key:"getMath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.collectMathsByRange({begin:e,end:e});return t?n[0]:n[n.length-1]}},{key:"getMathRangeClass",value:function(){return this.maths}},{key:"getMathFunctionRangeClass",value:function(){return this.mathFunctions}},{key:"collectMathFunctionsByRange",value:function(e){var t=e.begin,n=e.end;return this.mathFunctions.rangeClass.mapInRange(t,n,(function(e){return e._node}),f.IT.strictIntersectTest)}},{key:"collectMathsByRange",value:function(e){var t=e.begin,n=e.end,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.maths.rangeClass.mapInRange(t,n,(function(e){return e._node}),(function(e,t){return f.IT.strictIntersectTest(e,t)&&(!i||t._node.isTopMath())}))}},{key:"getMathByObjId",value:function(e){return this.maths.getRangeByObjId(e)}},{key:"getMathFunctionByObjId",value:function(e){return this.mathFunctions.getRangeByObjId(e)}},{key:"onInsertText",value:function(e,t,n){this.mathBreaks.expand(t,n.length)}},{key:"onDeleteText",value:function(e,t,n){this.mathBreaks.remove(t,n.length)}},{key:"onCmdInsertText",value:function(e,t,n){this.isMathEdit()&&this._ensureMathValidOnTextInsert(t,n.length)}},{key:"onCmdDeleteText",value:function(e,t,n){}},{key:"attachMathBreak",value:function(e){this.mathBreaks.attachNode(e)}},{key:"detachMathBreak",value:function(e){this.mathBreaks.detachNode(e)}},{key:"createTextFunc",value:function(e,t,n,i){var o=Object(T.g)({type:i});o.objID=o;var a={pos:t,len:n,data:o};this.mathFunctions.insertRange(a),e.addFunctionData(a)}},{key:"setMathEdit",value:function(e){this._isMathEdit=e}},{key:"isMathEdit",value:function(){return window.APP.data.selection.inOMath||this._isMathEdit}},{key:"_ensureMathValidOnTextInsert",value:function(e,t){var n=this.document.getBodyRange(e),i=this.getMath(e+t);if(i||(i=e===n.begin?null:this.getMath(e-1,!0))){var o=null;i.begin===e+t?o={pos:e,len:i.len+t}:i.isTopMath()&&i.end===e&&(o={pos:i.begin,len:i.len+t});var a=null,r=i.getFunctions(),s=function(e){return r.find((function(t){return t.begin<=e&&e<t.end}))},l=s(e+t);if(l&&l.isTextFunction()){if(l.begin!==e+t)return;a={pos:e,len:l.len+t}}else(l=s(e-1))&&l.isTextFunction()?a={pos:l.pos,len:l.len+t}:this.createTextFunc(i,e,t,pn.v);a&&(this.getMathFunctionRangeClass().rangeClass.detachNode(l),l.reset(a.pos,a.pos+a.len),this.getMathFunctionRangeClass().rangeClass.attachNode(l)),o&&(this.getMathRangeClass().rangeClass.detachNode(i),i.reset(o.pos,o.pos+o.len),this.getMathRangeClass().rangeClass.attachNode(i))}}}]),e}(),bn=["share_hint","vanish","special","language","east_asia_language","complex_language","revision","wo_user_id"],Tn=["type","para_type"];function Cn(e,t){for(var n in e)-1==t.indexOf(n)&&delete e[n];return e}function kn(e,t){return e&&t==w.Comment?Cn(e,bn):e}function wn(e,t){return e&&t==w.Comment?Cn(e,Tn):e}var Sn=function(){function e(t,n){l()(this,e),this.init(t),this.doc=n}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCDataLogic",base:D.a,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e){this.mixin_DOCDataLogic_init(e)}},{key:"getChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getChp(e,t),i=this.doc.getSubDocType(e);return kn(n,i)}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getChpx(e,t),i=this.doc.getSubDocType(e);return n.good&&(n.prop=kn(n.prop,i)),n}},{key:"collectChpxs",value:function(e,t){var n=this.upstream.collectChpxs(e,t),i=this.doc.getSubDocType(e);return n.forEach((function(e){e.good&&(e.prop=kn(e.prop,i))})),n}},{key:"getPrevChpx",value:function(e){return this.getChpx(e.pos,f.IT.Exclude)}},{key:"getNextChpx",value:function(e){return this.getChpx(e.pos+e.len)}},{key:"moveChpxToPrev",value:function(e){this.upstream.moveChpxToPrev(e);var t=this.doc.getSubDocType(e.pos);e.good&&(e.prop=kn(e.prop,t))}},{key:"moveChpxToNext",value:function(e){this.upstream.moveChpxToNext(e);var t=this.doc.getSubDocType(e.pos);e.good&&(e.prop=kn(e.prop,t))}},{key:"getPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getPap(e,t),i=this.doc.getSubDocType(e);return wn(n,i)}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IT.Include,n=this.upstream.getPapx(e,t),i=this.doc.getSubDocType(e);return n.good&&(n.prop=wn(n.prop,i)),n}},{key:"collectPapxs",value:function(e,t){var n=this.upstream.collectPapxs(e,t),i=this.doc.getSubDocType(e);return n.forEach((function(e){e.good&&(e.prop=wn(e.prop,i))})),n}},{key:"getPrevPapx",value:function(e){return this.getPapx(e.pos,f.IT.Exclude)}},{key:"getNextPapx",value:function(e){return this.getPapx(e.pos+e.len)}},{key:"movePapxToPrev",value:function(e){this.upstream.movePapxToPrev(e);var t=this.doc.getSubDocType(e.pos);e.good&&(e.prop=wn(e.prop,t))}},{key:"movePapxToNext",value:function(e){this.upstream.movePapxToNext(e);var t=this.doc.getSubDocType(e.pos);e.good&&(e.prop=wn(e.prop,t))}},{key:"nickname",get:function(){return"DataLogic: comment"}}]),e}(),Pn=Sn;R.a.mix(Sn,D.a);var In=n(623),En=function(){function e(t,n,i,o){l()(this,e),this.init(t,n,i,o)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:T.d,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i){this.mixin_DOCRange_init(e,t,Object(T.g)(n),i)}},{key:"getUserId",value:function(){var e=this.data.getUserId();return 4294967295===e?-1:e}}]),e}();function On(e){var t=e._node;return{pos:t.pos,len:t.len,userId:t.getUserId()}}R.a.mix(En,T.d);var xn,Rn=function(){function e(t,n){var i=this;l()(this,e),Object(T.f)(this),this.rangeClass=new T.e(n,b.f,f.IT.inner,f.IT.NonIntersect,!0);this.rangeClass.deleteTest=function(e,t){return 1!=n.getProtType()&&3!=n.getProtType()&&f.IT.containTest(e,t)},t.forEach((function(e){i.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new En(e.pos,e.pos+e.len,e.data,e.refId);this.rangeClass.attachNode(t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.rangeClass.detachNode(t)}},{key:"getAllExceptions",value:function(e){var t=e||On;return this.rangeClass.map(t)}},{key:"getExceptions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:On;if(!e)return this.getAllExceptions(t);var n=this.rangeClass.mapInRange(e.pos,e.pos+e.len,t,f.IT.strictIntersectTest);return n}}]),e}(),Nn=n(2295),An=function(){function e(t){l()(this,e),this.document=t}return c()(e,[{key:"appendSubdoc",value:function(e,t){var n=new g(this.document,t);return n.subdoc_type=e,n.subdoc_offset=t.pos,n.subdoc_size=t.len,this.document.subdocs.push(n),this}},{key:"initTextStream",value:function(e){return this.document.textStream=new Xe(this.document,e),this.document.textStream.getPureTextStream().attachObserver(this.document),this}},{key:"initSections",value:function(e){return this.document.sections=new kt(e,this.document),this}},{key:"initBookmarks",value:function(e){return this.document.bookmarks=new E(e,this.document),this}},{key:"initComments",value:function(e){return this.document.comments=new O.DOCComments(e,this.document),this}},{key:"initCommentBodys",value:function(e){return this.document.commentBodys=new O.DOCCommentBodys(e,this.document),this}},{key:"initFootnotes",value:function(e){return this.document.footnotes=new Yt.d(e,this.document),this}},{key:"initFootnoteBodys",value:function(e){return this.document.footnoteBodys=new Yt.c(e,this.document),this}},{key:"initEndnotes",value:function(e){return this.document.endnotes=new Yt.b(e,this.document),this}},{key:"initEndnoteBodys",value:function(e){return this.document.endnoteBodys=new Yt.a(e,this.document),this}},{key:"initFields",value:function(e){return this.document.fields=new $(e,this.document),this}},{key:"initAnchors",value:function(e){return this.document.anchors=new le(e,b.a,this.document),this}},{key:"initInlineAnchors",value:function(e){return this.document.inlineAnchors=new le(e,b.n,this.document),this}},{key:"initTheme",value:function(e){return this.document.theme=ue.a.buildGetInstance(e.getTheme(),e.getThemeFontLanguage(),e.getThemeAgent()),this}},{key:"initFontTable",value:function(e){return this.document.fonttable=new ce.a(e,this.document.theme),this}},{key:"initDocumentLayer",value:function(e){return this.document.layer=new Je(e),this}},{key:"initContentControls",value:function(e){return this.document.contentControls=new Ot.b(e,this.document),this}},{key:"initRepeatSecItems",value:function(e){return this.document.repeatSecItems=new Ot.c(e,this.document),this}},{key:"initHeadersFooters",value:function(e){return this.document.headersfooters=new k(e,this.document),this}},{key:"initTextboxs",value:function(e){return this.document.textboxs=new ie(e,this.document),this}},{key:"initSettings",value:function(e){return this.document.settings=new an(e),this.document.viewSettings=new Qt.a(this.document.docInfo),this}},{key:"initDocumentFields",value:function(e){return this.document.documentFields=new dn(e,this.document),this}},{key:"initMathManager",value:function(e,t){return this.document.mathManager=new yn(e,t,this.document),this}},{key:"initProtectExceptions",value:function(e){return this.document.protectExceptions=new Rn(e,this.document),this}}]),e}(),Dn=function(e,t){switch(e){case w.MainText:case w.Textbox:case w.Footnote:case w.Endnote:return t?te.c:te.d;case w.HeaderFooter:case w.TextboxInHF:return t?te.a:te.b}},Mn=function(){function e(t,n,i,o){l()(this,e),Object(p.default)(this),this.concernRanges=[],this.findRanges=[],this.recordHighlightRanges=[],this.applyConcernRangesOps(i),this.bReadOnly=void 0!==t.private.readonly&&!1!==t.private.readonly,this.protType=t.private.protType,this.subdocs=[],this.sections=null,this.bookmarks=null,this.comments=null,this.fields=null,this.size=0;var a=new An(this);a.initTheme(t),this.docInfo=o,this.templateType=this.docInfo.woFileType||Ut.a,this.isTemplate=!isNaN(this.templateType)&&this.templateType!==Ut.a,this.templateIndex=this.docInfo.woTemplateIdx,this.templateVersion=this.docInfo.woTemplateVersion||1,this.isPalaceMuseumTemplate=this.templateType===Ut.b,this.isEnhancedTemplate=this.templateType===Ut.c,this.compatMode=this.docInfo.compatMode||0,this.isTXTDocument=7===this.docInfo.openFormat,this.stylesheet=new he.f(t.getStyleSheet()).stylesheet,this.autoNumMgr=new Pt(t.getAutoNumbers()),this.dataWatcher=new Et(this),this.block=!1;var r=t.getRangeClasses(),s=r.subdocument,u=r.headersFooters,c=r.section,h=r.bookmark,d=r.commentBody,f=r.comment,g=r.field,v=r.textboxBody,m=r.anchor,_=r.inlineAnchor,y=r.contentControl,b=r.repeatSecItem,T=r.documentField,C=r.math,k=r.mathFunction,S=r.docProtectedException,P=r.footnote,I=r.footnoteBody,E=r.endnote,x=r.endnoteBody;a.appendSubdoc(w.MainText,s.mainText).appendSubdoc(w.Footnote,s.footnote).appendSubdoc(w.HeaderFooter,s.headerFooter).appendSubdoc(w.Macro,s.macro).appendSubdoc(w.Comment,s.comment).appendSubdoc(w.Endnote,s.endnote).appendSubdoc(w.Textbox,s.textBox).appendSubdoc(w.TextboxInHF,s.headerTextBox).initTextStream(t.getTextStream()).initHeadersFooters(u).initSections(c).initBookmarks(h).initCommentBodys(d).initComments(f).initFootnoteBodys(I).initFootnotes(P).initEndnoteBodys(x).initEndnotes(E).initFields(g).initDocumentLayer(t.getDocumentLayer()).initTextboxs(v).initAnchors(m).initInlineAnchors(_).initFontTable(t.getFontTable()).initContentControls(y).initRepeatSecItems(b).initSettings(t.getDocsettings()).initDocumentFields(T).initMathManager(C,k).initProtectExceptions(S),this.useLowPerformanceMode=this.typoMode===on.TYPO_MODE.MODE_PC&&window.__CONFIG__.wps.useLowPerformanceMode,this.useCoreTypo=o.useCoreTypo||this.useLowPerformanceMode||!this.footnotes.rangeClass.tree.empty()||!this.endnotes.rangeClass.tree.empty(),this.useCoreMeasure=this.useLowPerformanceMode,window.collection("document","hasdirtyuserlist",o.dirtyUserList?"1":"0"),this.updateTextStream(n),this.initDataLogic(),this.revisions=new Xt.a(this.getDataLogic("prime"),this),this.colorManager=new nn(this),this.commentBubbles=new O.DOCCommentBubbles(this),this.reviewMgr=new qt.a(this),this.attachObserver(this.footnotes),this.attachObserver(this.endnotes),this.reportOpenException(),this.isEmptyDocOnStart=this.isEmptyMainDoc()}return c()(e,[{key:"initDataLogic",value:function(){this.datalogics={},this.datalogics.prime=this.textStream.getPureTextStream(),this.datalogics.comment=new Pn(this.textStream.getPureTextStream(),this),this.datalogics.revised=new en(this.datalogics.comment,this),this.datalogics.final=Bt.adapt(new jt(this.datalogics.revised,this),this)}},{key:"getReadOnly",value:function(){return this.bReadOnly}},{key:"getProtType",value:function(){return this.protType}},{key:"clearAll",value:function(e){this.clearFindResults(),this.clearRecordHighlight(),this.commentBubbles.clearAll(e),this.docmap&&(this.docmap.clearAll(),delete this.docmap)}},{key:"getDocInfo",value:function(){return this.docInfo}},{key:"getTypoModeSyncState",value:function(){return!!this.docInfo.woSyncTypoMode}},{key:"applyConcernRangesOps",value:function(e){var t=[],n=[],i=this;return e.forEach((function(e){var o=e.type,a=e.rangeId,r=e.range;switch(o){case 1:for(var s=-1,l=0;l<i.concernRanges.length;++l)if(r.pos+r.len<i.concernRanges[l].pos){s=l;break}-1===s?(i.concernRanges.push(r),t.push(r)):(i.concernRanges.splice(s,0,r),t.splice(s,0,r));break;case 2:var u=i.concernRanges[a],c=r.pos,h=r.pos+r.len,d=u.pos,p=u.pos+u.len;c<d?t.push({pos:c,len:d-c}):c>d&&n.push({pos:d,len:c-d}),h<p?n.push({pos:h,len:p-h}):h>p&&t.push({pos:p,len:h-p}),u.pos=r.pos,u.len=Math.max(p,h)-u.pos;break;case 3:for(var f=i.concernRanges[e.rangeIds[0]],g=f.pos,v=f.pos+f.len,m=1;m<e.rangeIds.length;m++){var _=i.concernRanges[e.rangeIds[m]],y=_.pos,b=_.pos+_.len;g>y&&(g=y),v<b&&(v=b)}f.pos=g,f.len=v-g,window.__WPSENV__.cache_preview&&i.concernRanges.splice(e.rangeIds[1],e.rangeIds.length-1)}})),{incrRanges:t,reduRanges:n}}},{key:"updateConcernRanges",value:function(e,t,n){var i=t.length,o=e,a=e+i;this.concernRanges.forEach((function(e){var t=e.pos,r=e.pos+e.len;n?o>=t?o<=r&&(r+=i):(t+=i,r+=i):t<a&&r>o?t<=o?r=r-i<o?o:o+(r-a):(t=o,r=r-a>0?o+(r-a):t):t>=a&&(t-=i,r-=i),e.pos=t,e.len=r-t}))}},{key:"intersectConcernRanges",value:function(e,t){for(var n=0;n<this.concernRanges.length;n++){var i=this.concernRanges[n];if(!(e>=i.pos+i.len||t<i.pos))return!0}return!1}},{key:"containConcernRanges",value:function(e,t){for(var n=0;n<this.concernRanges.length;n++){var i=this.concernRanges[n];if(i.pos<=e&&i.pos+i.len>=t)return!0}return!1}},{key:"hasFindResults",value:function(){return this.findRanges.length>0}},{key:"clearFindResults",value:function(){this.findRanges=[]}},{key:"updateFindResults",value:function(e,t,n){Object(Nn.adjustRangeOnTextChanging)(e,t,n,this.findResults)&&oe.default.dispatchEvent(oe.default.names.DOC_FINDRESULTS_CHANGED)}},{key:"clearRecordHighlight",value:function(){this.recordHighlightRanges=[]}},{key:"updateRecordHighlights",value:function(e,t,n){if(this.recordHighlightRanges&&this.recordHighlightRanges.length){var i=this.recordHighlightRanges.findIndex((function(t){return t.pos>=e})),o=-1!==i?i:this.recordHighlightRanges.length-1,a=e+t.length;if(!n)for(;o<this.recordHighlightRanges.length;){var r=this.recordHighlightRanges[o],s=r.pos+r.len;if(e<=r.pos&&s<=a)this.recordHighlightRanges.splice(o,1);else{if(s>=a)break;o+=1}}if(!(o>=this.recordHighlightRanges.length)){var l=this.recordHighlightRanges[o],u=l.pos,c=l.pos+l.len;e>=c?o+=1:n&&e<=u||a<=u||(e>=u||!n&&a<=c)&&this.recordHighlightRanges.splice(o,1);for(var h=o;h<this.recordHighlightRanges.length;++h){var d=this.recordHighlightRanges[h];n?d.pos+=t.length:d.pos-=t.length}}}}},{key:"handleContentControlsChanged",value:function(e,t,n){var i=this;this.block||this.isTemplate&&(this.ctrlStateList||(this.ctrlStateList={}),this.contentControls.collect(e,t).forEach((function(n){e>=n.begin&&e+t<=n.end+1&&n.title&&(i.ctrlStateList[n.title]=d()({},i.ctrlStateList[n.title]||{},{isModified:!0}))})))}},{key:"update",value:function(e,t,n){e&&this.updateTextStream(e),t&&(this.docInfo=t)}},{key:"hasRange",value:function(e){for(var t=0;t<this.concernRanges.length;++t){var n=this.concernRanges[t];if(e.pos===n.pos&&e.len===n.len)return!0}return!1}},{key:"getRangeClass",value:function(e){switch(e){case b.r:return this.sections;case b.b:return this.bookmarks;case b.j:return this.fields;case b.c:return this.comments;case b.a:return this.anchors;case b.n:return this.inlineAnchors;case b.e:return this.contentControls;case b.q:return this.repeatSecItems;case b.m:return this.headersfooters;case b.t:return this.textboxs;case b.g:return this.documentFields;case b.o:return this.mathManager.getMathRangeClass();case b.p:return this.mathManager.getMathFunctionRangeClass();case b.f:return this.protectExceptions;case b.k:return this.footnotes;case b.h:return this.endnotes}return null}},{key:"updateTextStream",value:function(e){this.textStream.update(e)}},{key:"resetRangeClass",value:function(e,t,n,i){var o=this.getRangeClass(e);o&&o.reset(t,n,i)}},{key:"collectRanges",value:function(e,t){var n=this.bookmarks.rangeClass.collectRanges(e,t),i=this.fields.rangeClass.collectRanges(e,t),o=this.comments.rangeClass.collectRanges(e,t),a=this.anchors.rangeClass.collectRanges(e,t),r=this.inlineAnchors.rangeClass.collectRanges(e,t),s=this.contentControls.rangeClass.collectRanges(e,t),l=this.repeatSecItems.rangeClass.collectRanges(e,t),u=this.footnotes.rangeClass.collectRanges(e,t),c=this.endnotes.rangeClass.collectRanges(e,t),h=[];return n.length>0&&h.push({classType:b.b,ranges:n}),i.length>0&&h.push({classType:b.j,ranges:i}),o.length>0&&h.push({classType:b.c,ranges:o}),a.length>0&&h.push({classType:b.a,ranges:a}),r.length>0&&h.push({classType:b.n,ranges:r}),s.length>0&&h.push({classType:b.e,ranges:s}),l.length>0&&h.push({classType:b.q,ranges:l}),u.length>0&&h.push({classType:b.k,ranges:u}),c.length>0&&h.push({classType:b.h,ranges:c}),h}},{key:"getDataLogic",value:function(e){return this.datalogics[e]}},{key:"getPropsWithSection",value:function(e){return this.getDataLogic("final").getSegments(e)}},{key:"getText",value:function(e,t){return this.textStream.getText(e,t)}},{key:"getTextSize",value:function(){return this.textStream.getTextSize()}},{key:"getBodyRange",value:function(e){var t=this.locateStory(e),n=new f.Range(t.toDocumentPosition(0),t.toDocumentPosition(t.getTextSize())),i={begin:0,end:0};return t.subdoc_type?(i.begin=n.begin,i.end=n.end,i):t.subdoc_type==w.MainText?(i.begin=this.concernRanges[0].pos,i.end=i.begin+this.concernRanges[0].len,i):i}},{key:"getCustomAttribute",value:function(e){var t=this,n=e;return new Promise((function(e,i){var o={names:[]};n.forEach((function(e){t.docInfo.hasOwnProperty(e)||o.names.push(e)})),o.names.length>0?window.APP.data.api.queryCommandQueue("docProperties",o,(function(n){n.success?(t.updateDocProperties(n.result),e()):i()})):e()})).then((function(){return n.reduce((function(e,n){return e[n]=t.docInfo[n],e}),{})}),(function(){return console.error("docProperties exec fail"),{}}))}},{key:"getSubDocType",value:function(e){return this.subdocs.findIndex((function(t){return t.subdoc_offset+t.subdoc_size>e}))}},{key:"isRangeContainSubDocNode",value:function(e,t){var n=e+t;return this.subdocs.findIndex((function(t,i){if(i===w.MainText)return!1;var o=t.subdoc_offset-1;return e<=o&&n>o||void 0}))>=0}},{key:"locateStory",value:function(e){return this.subdocs.find((function(t,n,i){return t.subdoc_offset+t.subdoc_size>e}))}},{key:"getSubDocOffset",value:function(e){return this.subdocs[e].subdoc_offset}},{key:"getSubDocSize",value:function(e){return this.subdocs[e].subdoc_size}},{key:"isEmptyMainDoc",value:function(){return this.getMainTextLength()<=1}},{key:"getMainTextLength",value:function(){return this.getTextLengthInSubDoc(w.MainText)}},{key:"getTextLengthInSubDoc",value:function(e){return!this.subdocs[e].subdoc_size||isNaN(this.subdocs[e].subdoc_size)?this.textStream.getTextSize():this.subdocs[e].subdoc_size-1}},{key:"getSubDocRange",value:function(e){var t=this.subdocs[e];return{pos:t.subdoc_offset,len:t.subdoc_size-1,subdoc_type:e}}},{key:"getValidDocRanges",value:function(){var e=[];switch(this.typoMode){case on.TYPO_MODE.MODE_PC:e.push({pos:0,len:this.getTextSize()});break;case on.TYPO_MODE.MODE_WEB:case on.TYPO_MODE.MODE_MOBILE:var t=this.getSubDocRange(w.MainText);e.push({pos:t.pos,len:t.len})}return e}},{key:"onInsertText",value:function(e,t,n,i,o,a,r){this.subdocs.forEach((function(e){e.contain(t)?e.subdoc_size+=n.length:e.subdoc_offset>t&&(e.subdoc_offset+=n.length)})),this.updateConcernRanges(t,n,!0),this.updateFindResults(t,n,!0),this.updateRecordHighlights(t,n,!0),this._dispatch("onInsertText",t,n,i,o,a,r),this.handleContentControlsChanged(t,n.length,0),this.fireContentChange(t)}},{key:"onDeleteText",value:function(e,t,n,i){this.subdocs.forEach((function(e){e.contain(t)?e.subdoc_size-=n.length:e.subdoc_offset>t&&(e.subdoc_offset-=n.length)}));var o=this.dataWatcher.getShapeIdByPos(t);o&&this._dispatch("onTrigger",o,It.WOType_Delete),this.updateConcernRanges(t,n,!1),this.updateFindResults(t,n,!1),this.updateRecordHighlights(t,n,!1),this.handleContentControlsChanged(t,n.length,1),this._dispatch("onDeleteText",t,n,i),this.fireContentChange(t)}},{key:"onBeforeDeleteText",value:function(e,t,n){this._dispatch("onBeforeDeleteText",t,n);var i=e.getChar(t);if(i&&i.length>0){var o=i.charCodeAt(0);Ne.f!=o&&Ne.g!=o||(window.APP.data.doc.isDeleteShape=!0)}}},{key:"onBeforeInsertText",value:function(e,t,n,i){this._dispatch("onBeforeInsertText",t,n,i)}},{key:"dealDrawingUpdate",value:function(e){if(1===e.len){var t=function e(t){t.private.group||t.isCanvasShape||t.isCanvasLayers?t.childShapes.forEach((function(t){e(t)})):window.APP.data.shapeManager.addDelayRenderShapeId(t.getId())},n=this.anchors.findAnchor(e.pos);n&&(n.shapeDataObj?t(n.shapeDataObj):n.shapeData&&window.APP.data.shapeManager.addDelayRenderShapeId(n.shapeId));var i=this.inlineAnchors.findAnchor(e.pos);i&&(i.shapeDataObj?t(i.shapeDataObj):i.shapeData&&window.APP.data.shapeManager.addDelayRenderShapeId(i.shapeId))}}},{key:"updateShapeDrawingInfo",value:function(e,t){var n=this.inlineAnchors.getAnchor(e,t.pos,t.len);n||(n=this.anchors.getAnchor(e,t.pos,t.len)),n&&this._dispatch("onChpxChanged",{pos:n.pos,len:1})}},{key:"onChpxChanged",value:function(e,t){this._dispatch("onChpxChanged",t),this.handleContentControlsChanged(t.pos,t.len,2),this.dealDrawingUpdate(t),this.firePropChange("chpx")}},{key:"onPapxChanged",value:function(e,t,n){this._dispatch("onPapxChanged",t,n),this.handleContentControlsChanged(t.pos,t.len,2),this.dealDrawingUpdate(t),this.firePropChange("papx")}},{key:"onStyleChanged",value:function(e,t,n,i){this._dispatch("onStyleChanged",t,n,i)}},{key:"getEmbedDrawing",value:function(e){var t=!0,n=this.inlineAnchors.findAnchor(e);return n||(t=!1,n=this.anchors.findAnchor(e)),{anchor:n,shapeTreeType:Dn(this.getSubDocType(e),t)}}},{key:"getDCFontTable",value:function(){return this.fonttable}},{key:"getSettings",value:function(){return this.settings}},{key:"getDCFont",value:function(e){return this.getDCFontTable()[e]}},{key:"getCommentMapInMainText",value:function(){var e=this.getSubDocRange(w.MainText);return Object(O.getBubblesByRange)(this,e.pos,e.len).reduce((function(e,t){return t&&Array.isArray(t.data)&&t.data.length&&t.data.forEach((function(t){e[t.comment_id||t.rc_id]=t})),e}),{})}},{key:"getContentControlsInMainText",value:function(){var e=this.getSubDocRange(w.MainText),t=e.pos,n=e.len;return this.contentControls.collect(t,n)}},{key:"getContentControlsByProp",value:function(e,t){return this.getContentControlsInMainText().find((function(n){return n[e]===t}))}},{key:"getUserRelativeRanges",value:function(e){var t=this.getDataLogic("prime"),n=t.getChpx(e).prop.wo_user_id;if(null!=n){var i=t.getPapx(e),o=i.pos,a=i.pos+i.len,r=t.getCompatibleChpx(e,(function(e,t,i){return e.pos>=o&&e.prop.wo_user_id===n}),null,(function(e,t,i){return e.pos+e.len<a&&e.prop.wo_user_id===n}));return{begin:r.pos,end:r.pos+r.len}}}},{key:"defFontSize",value:function(){var e=this.stylesheet.findStyle(xt.n);if(void 0===e)return 200;var t=this.stylesheet.getStyle(e);if(void 0===t||void 0===t.chpx)return 200;var n=t.chpx.font_size_normal;void 0===n&&(n=t.chpx.def.font_size_normal);var i=t.chpx.character_scale;void 0===i&&(i=t.chpx.def.character_scale);var o=t.chpx.spacing;return void 0===o&&(o=t.chpx.def.spacing),parseInt(n*i/100+2*o)}},{key:"isSubdocEmpty",value:function(e){if(-1===this.getSubDocType(e))return!0;var t=this.getLimitedRange(e);return t&&t.len<=1}},{key:"fireContentChange",value:function(e){var t=this.isSubdocEmpty(e);void 0!==this.backupEmpty&&t===this.backupEmpty||(this.backupEmpty=t,oe.default.dispatchEvent(oe.default.content.MODIFY,{isEmpty:t}))}},{key:"firePropChange",value:function(e){oe.default.dispatchEvent(oe.default.content.PROP_CHANGE,{type:e})}},{key:"isContainLastParaBreak",value:function(e,t){if(0===t)return console.log("请传个长度进来！"),!1;var n=this.getMainTextLength();if(e<n)return e+t>=n;var i=void 0;switch(this.getSubDocType(e)){case w.HeaderFooter:i=this.headersfooters.rangeClass;break;case w.Textbox:case w.TextboxInHF:i=this.textboxs.rangeClass;break;case w.Comment:i=this.commentBodys.rangeClass}if(i){var o=i.mapInRange(e,e+t,(function(e){return e._node.cloneData()}));if(o.length<=0)return console.log("怎么找不到呢！"),!1;for(var a=0;a<o.length;++a)if(0!==o[a].len&&o[a].pos<=e&&e<o[a].pos+o[a].len&&e+t>=o[a].pos+o[a].len)return!0;return!1}return console.log("这个子文档还不支持！"),!1}},{key:"limitInSubdoc",value:function(e,t){var n=t,i=e,o=!1,a=this.getMainTextLength();if(i<=a)n>a&&(n=a),i===a&&(n=--i);else{var r=this.getSubDocType(i),s=void 0;switch(r){case w.HeaderFooter:s=this.headersfooters.rangeClass;break;case w.Textbox:case w.TextboxInHF:s=this.textboxs.rangeClass;break;case w.Comment:s=this.commentBodys.rangeClass}if(s){var l=s.mapInRange(i,n,(function(e){return e._node.cloneData()}));if(l.length<=0)return i=0,n=0,o=!0,console.log("怎么找不到呢！"),{begin:i,end:n,isOutOfValidSubDocRange:o};for(var u=0;u<l.length;++u)if(0!==l[u].len&&i<l[u].pos+l[u].len)return l[u].pos<=i&&n>=l[u].pos+l[u].len&&(n=l[u].pos+l[u].len),{begin:i,end:n,isOutOfValidSubDocRange:o};n=--i}else if(r===w.Footnote||r===w.Endnote){var c=this.getSubDocRange(r),h=c.pos+c.len;n>h&&(n=h)}else i=0,n=0,o=!0,console.log("这个子文档还不支持！")}return{begin:i,end:n,isOutOfValidSubDocRange:o}}},{key:"getLimitedRange",value:function(e){var t=this.getSubDocType(e),n=void 0;switch(t){case w.HeaderFooter:n=this.headersfooters.rangeClass;break;case w.Textbox:case w.TextboxInHF:n=this.textboxs.rangeClass;break;case w.Comment:n=this.commentBodys.rangeClass;break;case w.Footnote:n=this.footnoteBodys.rangeClass;break;case w.Endnote:n=this.endnoteBodys.rangeClass}if(n){var i=n.fetchHintContainPos(n.HintVT.it_hint1,e);if(i.good())return{pos:i.pos,len:i.len}}return this.getSubDocRange(t)}},{key:"gcpToCp",value:function(e){var t=this.getSubDocType(e);return-1===t?{cp:e,subDocType:w.MainText}:{cp:e-this.getSubDocRange(t).pos,subDocType:t}}},{key:"cpToGcp",value:function(e,t){return e+this.getSubDocRange(t).pos}},{key:"getDocmap",value:function(e){if(null!=e)return void 0===this.docmap&&(this.docmap=new Zt(this,e)),this.docmap}},{key:"isFirstLineInPapxWithHint",value:function(e,t){return!!t&&e===t._node.begin}},{key:"getHeaderFooterRange",value:function(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=null,o=this.sections.getSection(e);o.nonTree()&&!(i=o.getHeaderFooterRange(t))&&n;)o=o.getPrevNode();return i}},{key:"getDocumentStart",value:function(){if(this.isPalaceMuseumTemplate)for(var e=this.getSubDocRange(w.MainText),t=this.contentControls.collect(e.pos,e.len),n=0;n<t.length;++n)if("text"===t[n].title)return t[n].begin+1;return 0}},{key:"getMaxPageWidth",value:function(){var e=0;return this.sections.rangeClass.forEachHint((function(t){var n=t&&t._node;n&&(e=Math.max(e,Math.round(Object(je.Ti2Px)(n.getPageWidth()))))})),e}},{key:"getWatermark",value:function(){return this.secDocInfo&&this.secDocInfo.isOutwardDoc&&this.secDocInfo.watermarkText?{type:1,value:this.secDocInfo.watermarkText,fillstyle:"rgba(192, 192, 192, 0.6)",font:"bold 20px Serif",rotate:-45*Math.PI/180,horizontal:50,vertical:100}:null}},{key:"reportOpenException",value:function(){var e=this.docInfo.openFormat||0,t=this.docInfo.fileFormat||0;e!==t&&(12===t&&7===e?window.report(In.TYPE.COUNT,"wps_open_docx_as_txt",1):72===t&&7===e?window.report(In.TYPE.COUNT,"wps_open_doc_as_txt",1):window.report(In.TYPE.DURATION,"wps_open_exception",1e4*t+e))}},{key:"updateDocProperties",value:function(e){var t=this;e.docProps.forEach((function(e){t.docInfo[e.name]=e.value}))}},{key:"typoMode",get:function(){return window.APP.data.typoMode}},{key:"findResults",get:function(){return this.findRanges},set:function(e){this.findRanges=e}},{key:"allowContentControl",get:function(){return 11!==this.compatMode}}]),e}(),Ln=(xn=void 0,function(e){return e&&(xn=e),xn}),Fn=function(){function e(){if(l()(this,e),Ln())return Ln();this.fontServer=window.APP.fontServer,Ln(this)}return c()(e,[{key:"init",value:function(e){if(this.doc=e,this.fontServer.init(this.doc),!St.isMobile&&this.doc.useCoreTypo){var t=Math.min(this.doc.concernRanges[0].len,1e3),n=this.doc.getPropsWithSection({pos:0,len:t});this.loadSegments(n)}}},{key:"_checkIsNotNeededLoadFont",value:function(e){var t=this.doc;if(t.isRangeContainSubDocNode(e.span.pos,e.span.len))return!0;if(e.chpx.getPropVal("vanish"))return!0;var n=t.getSubDocType(e.span.pos);if(St.isMobile){if(n!==w.MainText)return console.log("font not in selected region ignore"),!0}else if(n!==w.MainText&&n!==w.HeaderFooter)return console.log("font not in selected region ignore"),!0;return!1}},{key:"loadSegments",value:function(e){var t=this,n=this.doc;e.forEach((function(e){if(!t._checkIsNotNeededLoadFont(e)){[{fontName:"font_name_ascii",cs:!1},{fontName:"font_name_asia_east",cs:!1},{fontName:"font_name_complex",cs:!0},{fontName:"font_name_ftcbi",cs:!0}].forEach((function(i){var o=i.fontName,a=i.cs,r=e.chpx.getPropVal(o),s=n.fonttable.getName(r);if(s){var l=t.getFontBold(e.chpx,a),u=t.getFontItalic(e.chpx,a),c={};c.family=s,c.bold=l,c.italic=u,t.fontServer.load(c,e)}}))}}))}},{key:"load",value:function(e){var t=this,n=e.glyphPoss,i=e.glyphArrays,o={};i.forEach((function(e,i){if(e.isVisible()&&e.font){var a=n[i],r=e.len,s=e.font,l=s.fontFamily,u=""!==s.fontWeight&&void 0!==s.fontWeight,c=""!==s.fontStyle&&void 0!==s.fontStyle,h=(u?3:0)|(c?1:0);o[l]||(o[l]={});var d=o[l][h];d?a-d.pos-d.len<8?d.len=a+r-d.pos:(t.fontServer.load(d,{pos:d.pos,len:d.len}),d.pos=a,d.len=r):o[l][h]={family:l,bold:u,italic:c,pos:a,len:r}}})),Object.keys(o).forEach((function(e){var n=o[e];Object.keys(n).forEach((function(e){t.fontServer.load(n[e],{pos:n[e].pos,len:n[e].len})}))}))}},{key:"getFontBold",value:function(e,t){return 1==t?e.bold_cs:e.bold}},{key:"getFontItalic",value:function(e,t){return 1==t?e.italic_cs:e.italic}}]),e}(),Bn=n(7155),Hn=function(){function e(){l()(this,e)}return c()(e,[{key:"init",value:function(e){this.doc=e}},{key:"load",value:function(e){var t=e.glyphGroups,n=e.begin,i=e.end,o=this.doc.mathManager.collectMathsByRange({begin:n,end:i});if(o&&o.length){var a=[];o.forEach((function(e){if(a.length){var t=a[a.length-1],n=e.pos,i=n+e.len;if(n>=t.pos+t.len||i<=t.pos)a.push({pos:e.pos,len:e.len});else{var o=Math.max(i,t.pos+t.len);t.pos=Math.min(t.pos,n),t.len=o-t.pos}}else a.push({pos:e.pos,len:e.len})})),window.APP.data.typoinfo.mathCache?a.forEach((function(e){t.setGlyphGroupFlag((function(e){e.isField()&&e.isHidden()||e.setMathFlag()}),{begin:e.pos,end:e.pos+e.len})})):window.APP.initMathsCache(a)}}}]),e}(),Gn=n(7121),Wn=n(723),jn=function(){function e(){l()(this,e)}return c()(e,[{key:"init",value:function(e){this.doc=e,this.specHidden=this.doc.getDataLogic("final").specHidden}},{key:"load",value:function(e){var t=e.glyphGroups,n=e.glyphPoss,i=e.glyphArrays,o=e.glyphBuff,a=e.begin,r=e.end;this.specHidden.show(a,r-a),this.updateHidden(i,n,o),this.updateField(t,{begin:a,end:r})}},{key:"updateHidden",value:function(e,t,n){var i=this;e.forEach((function(e,o){var a=e.chpx,r=a.getPropVal("vanish"),s=Object(Qt.b)(a);if((r||s)&&(r&&e.setHiddenFlag(),s&&e.setRevisionHiddenFlag(),n.buffs.slice(e.begin,e.end).forEach((function(e){e.mi&&delete e.mi})),i.specHidden.hide(t[o],e.len)),e.charInfo.isPlaceHolder){var l=n.getCharCode(t[o]);Wn.a.isPageBreak(l)&&(e.papx.nest_level>0||e.papx.text_frame)&&(e.setHiddenFlag(),i.specHidden.hide(t[o],e.len)),(e.isDrawing()||Wn.a.isComment(l)||Wn.a.isControl(l)||Wn.a.isMathArgEnd(l)||Wn.a.isMathFunction(l)||Wn.a.isFieldSep(l))&&(e.setSpecHiddenFlag(),i.specHidden.hide(t[o],e.len));var u=i.doc.getSubDocType(e.begin);e.isEmbedDrawing()&&u===w.Comment&&(e.setSpecHiddenFlag(),i.specHidden.hide(t[o],e.len))}}))}},{key:"updateField",value:function(e,t){var n=this,i=t.begin,o=t.end,a=this.doc.fields.getFields({begin:i,end:o});if(0!==a.length){var r=new Vt.default;r.todo({begin:i,end:o}),a.forEach((function(t){if(r.have(t)&&"EQ"!=t._node.type){e.setGlyphGroupFlag((function(e){e.setFieldFlag(),"TOC"===t._node.type&&e.setInTocFieldFlag()}),{begin:t.begin,end:t.end});var a=void 0,s=void 0,l=void 0;!1^t.attrs.showCode?(a=t.sep,s=t.end,l=t.begin):(a=t.begin,s=!t._node.type||t.sep<=t.begin?t.end:t.sep+1,l=t.end-1),n.specHidden.hide(a,s-a),n.specHidden.hide(l,1),e.setGlyphGroupFlag((function(e){e.setHiddenFlag()}),{begin:a,end:s}),l>=i&&l<o&&e.setGlyphGroupFlag((function(e){e.setHiddenFlag()}),{begin:l,end:l+1}),r.done({begin:Math.max(a,i),end:Math.min(s,o)})}"EQ"==t._node.type&&(n.specHidden.hide(t.begin,1),n.specHidden.hide(t.end-1,1),e.setGlyphGroupFlag((function(e){e.setFieldFlag(),e.setHiddenFlag()}),{begin:t.begin,end:t.begin+1}),e.setGlyphGroupFlag((function(e){e.setHiddenFlag()}),{begin:t.end-1,end:t.end}))}))}}}]),e}(),Un=n(5737),Vn=n(7128);function Yn(e,t,n,i,o){var a=i[t];if(e<=a.begin||e>=a.end)console.error("documentField invalid split pos");else{o.detachNode(a);var r=a.clone();r.reset(e,a.end),a.reset(a.begin,e),o.attachNode(r),o.attachNode(a),i.splice(t+1,0,r),n.splice(t+1,0,e)}}function zn(e,t){return!t||t.length<=0?[e]:[e].concat(r()(t)).sort((function(e,t){var n=e.pos,i=t.pos;if(n===i){var o=n+e.len-(i+t.len);return 0==o?e.name<t.name?-1:1:o}return i-n}))}var Kn=function(){function e(){l()(this,e)}return c()(e,[{key:"init",value:function(e){this.doc=e}},{key:"load",value:function(e){var t=e.glyphGroups,n=e.glyphArrays,i=e.glyphPoss,o=e.begin,a=e.end;this.doc.documentFields.getFields({begin:o,end:a}).forEach((function(e){var o=e._node;if(!(o.len<=0))for(var a=o.pos,r=a+o.len,s=n.length,l=function(e,t,n){for(var i=0,o=e.length,a=-1;i<o;){var r=i+o>>1,s=e[r];if(s<t)i=r+1;else{if(!(s>=n)){a=r;break}o=r}}for(a<0&&(a=Math.min(i,e.length-1));a>0&&e[a]>t;)--a;return a}(i,a,r);l<s&&!(i[l]>=r);++l){var u=n[l];a>i[l]?(Yn(a,l,i,n,t),++s):(r<i[l]+u.len&&(Yn(r,l,i,n,t),++s),u.documentFields=zn(o,u.documentFields))}}))}}]),e}();function Zn(e,t,n,i,o){e.getNotes({begin:t,end:n}).forEach((function(e){i.setGlyphGroupFlag(o,{begin:e.begin,end:e.end})}))}var Xn=function(){function e(){l()(this,e)}return c()(e,[{key:"init",value:function(e){this.doc=e}},{key:"load",value:function(e){var t=e.glyphGroups,n=e.begin,i=e.end,o=this.doc,a=o.footnotes,r=o.endnotes;Zn(a,n,i,t,(function(e){e.setFootnoteFlag()})),Zn(r,n,i,t,(function(e){e.setEndnoteFlag()}))}}]),e}(),qn=Un.a,Jn=St.isMobile?300:1e3,Qn=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.init(e,n),i}return y()(t,e),c()(t,[{key:"init",value:function(e,n){we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.shouldLimitValidationStep=!!St.isMobile,this.resetValidationStep(),this.todoList=new Vt.default,this.update(n)}},{key:"creatLoaders",value:function(){return[new Bn.a,new jn,new Kn,new Hn,new Xn,new Gn.a,new Fn]}},{key:"afterOpen",value:function(){this.shouldLimitValidationStep=!1,this.resetValidationStep(),!St.isMobile&&this.doc.useCoreTypo&&window.APP.fontServer.preload()}},{key:"setValidationStep",value:function(e){this.validationStep=e}},{key:"resetValidationStep",value:function(){this.validationStep=this.shouldLimitValidationStep?Jn:1e3}},{key:"createDataLogic",value:function(){return this.doc.getDataLogic("final")}},{key:"getBodyRange",value:function(e){return this.doc.getBodyRange(e)}},{key:"needQueryData",value:function(){return!0}},{key:"load",value:function(e,n){we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).call(this,e,n),this.glyphGroups.mergeGlyphGroup(this.glyphBuff,this.doc.getDataLogic("prime"),{begin:e,end:n})}},{key:"update",value:function(e){var t=this;e.forEach((function(e){t.todo(e)}))}},{key:"todo",value:function(e){var t=e.pos,n=e.pos+e.len;this.todoList.todo({begin:t,end:n}),this.glyphGroups.dropGroups(t,n)}},{key:"getValidateStep",value:function(e){var t=0;return this.shouldLimitValidationStep?this.todoList.have(e)&&(t=Jn):t=this.validationStep,t}},{key:"validate",value:function(e){var t=this,n=!1;return this.todoList.doEach(e,(function(i){var o=i.begin,a=Math.min(i.end,e.end);if(o>=a)return null;var r=qn?performance.now():0,s=t.glyphGroups.findNodeContainPos(o,f.IT.Exclude);return s&&s.needNextGlyph?(s.needNextGlyph=!1,t.glyphGroups.detachNode(s),t.load(s.begin,a)):t.load(o,a),qn&&Object(Un.b)("DOCTypoGlyphPool","["+o+","+a+")",r),n=!0,{begin:o,end:a}})),n}},{key:"onInsertText",value:function(e,t,n,i){var o=t,a=n.length;this.glyphBuff.onInsert(o,a),this.glyphGroups.expand(o,a),this.todoList.expand(o,a),o>0&&(o-=1,a+=1),this.todo({pos:o,len:a})}},{key:"onDeleteText",value:function(e,t,n,i){var o=n.length;if(!(o<=0)){var a=t,r=o;a>0&&(--a,++r),this.todo({pos:a,len:r}),this.glyphBuff.onRemove(t,o),this.glyphGroups.remove(t,o),this.todoList.remove(t,o)}}},{key:"onChpxChanged",value:function(e,t){this.todo(t)}},{key:"onPapxChanged",value:function(e,t){this.todo(t)}},{key:"onFontUpdate",value:function(e,t){var n=this;t.forEach((function(e){e.len&&n.todo(e)}))}},{key:"onSettingsChanged",value:function(){this.todo({pos:0,len:this.size})}}]),t}(Vn.a),$n=n(1737),ei=n(1033),ti=n(6117),ni=n(2939),ii=function(){function e(t,n){l()(this,e),this.selection=t,this.data=this.selection.data,this.begin=new $n.a(this.selection,0),this.end=new $n.a(this.selection,0),n&&this.setRange(n.begin,n.end,void 0===n.bSelAllCell)}return c()(e,[{key:"setRange",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e)this.begin=this.end=null;else{var i=e!==t;if(this.isReverse=!1,null!=t&&("number"==typeof e&&"number"==typeof t?this.isReverse=e>t:void 0!==e.position&&void 0!==t.position&&(this.isReverse=e.position>t.position)),i=i&&!this.isReverse,this.begin=new $n.a(this.selection,e,this.isReverse),this.end=null==t?new $n.a(this.selection,this.begin):new $n.a(this.selection,t,i),null===this.begin.position||null===this.end.position||void 0===this.begin.position||void 0===this.end.position)return;n&&(this.begin.position!==this.end.position?this.adjustRange():this.adjustPoint())}}},{key:"isPosition",value:function(){return!this.begin||!this.end||this.begin.position===this.end.position&&this.begin.glyphTail===this.end.glyphTail}},{key:"getNormalRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={pos:0,len:0};if(this.begin){var n=this.begin.position,i=this.end.position;if(n>i){var o=n;n=i,i=o}t={pos:n,len:i-n}}if(e&&0===t.len){var a=this.data.doc.textStream.getPapx(t.pos);t.pos=a.pos,t.len=a.len}return t}},{key:"adjustPoint",value:function(){var e=this.getNormalRange(),t=e.pos,n=t;this.data.doc.fields.getFields({begin:t,end:t}).forEach((function(e){n>e.begin&&n<=e.sep+1&&"TOC"!==e._node.type&&"FORMTEXT"!==e._node.type&&(n=Math.min(n,e.begin))})),t!==n&&(this.begin=new $n.a(this.selection,n),this.end=new $n.a(this.selection,n)),this.extendParagraphSetting(t,t+e.len)}},{key:"adjustRange",value:function(){var e=this.getNormalRange(),t=e.pos,n=e.pos+e.len,i={begin:t,end:n};this.extendParaBreak(t,n,i),this.extendField(t,n,i),this.extendByTable(t,n,i),this.extendAsianCombine(t,n,i),this.extendParagraphSetting(t,n,i),i.begin===t&&i.end===n||(this.begin.position<=this.end.position?(i.begin!==t&&(this.begin=new $n.a(this.selection,i.begin)),i.end!==n&&(this.end=new $n.a(this.selection,i.end,i.end!==i.begin&&i.end>0))):(i.end!==n&&(this.begin=new $n.a(this.selection,i.end,!0)),i.begin!==t&&(this.end=new $n.a(this.selection,i.begin))))}},{key:"extendParaBreak",value:function(e,t,n){if(this.isReverse){var i=this.data.doc.getDataLogic("final").getPapx(t-1);if(i&&i.prop){var o=i.pos,a=i.pos+i.len,r=i.prop.getPropVal("para_type");r!==xe.b&&r!==xe.c&&e<=o&&t===a-1&&(n.begin=e,n.end=t+1)}}}},{key:"extendField",value:function(e,t,n){this.data.doc.fields.getFields({begin:e,end:t}).forEach((function(e){var t=n.begin,i=n.end;(t<=e.begin&&i>=e.begin&&i<e.end||t>=e.begin&&t<e.end&&i>=e.end)&&(n.begin=Math.min(n.begin,e.begin),n.end=Math.max(n.end,e.end))}))}},{key:"extendByTable",value:function(e,t,n){var i=this.data.doc.getDataLogic("final"),o=i.getPap(e).getPropVal("nest_level"),a=i.getPap(t,f.IT.Exclude).getPropVal("nest_level");if(o>0&&a>0)for(var r=Object(Nt.f)(i,e,t),s=void 0,l=void 0,u=e;u<t;){if(l=(s=i.getPapx(u)).pos+s.len,s.prop.getPropVal("para_type")===xe.b&&l<=t){var c=s.prop.getPropVal("nest_level");c>r?this.extendRow(u,u,c,n):this.extendCell(u,u,c,n)}else if(s.prop.getPropVal("para_type")===xe.d&&l<t)this.extendRow(u,u,s.prop.getPropVal("nest_level"),n);else if(s.prop.getPropVal("para_type")===xe.c&&l<=t){var h=s.prop.getPropVal("nest_level");this.extendCell(u,u+1,h,n)}u=l}else o>0?this.extendRowBegin(e,a+1,n):a>0&&this.extendRowEnd(t,o+1,n)}},{key:"extendRow",value:function(e,t,n,i){this.extendRowBegin(e,n,i),this.extendRowEnd(t,n,i)}},{key:"extendRowBegin",value:function(e,t,n){var i=this.data.doc.getDataLogic("final").specTable.getTapx(e,f.IT.Include,t);i.prop?n.begin=Math.min(n.begin,i.begin):console.log("Wrong situation")}},{key:"extendRowEnd",value:function(e,t,n){var i=this.data.doc.getDataLogic("final").specTable.getTapx(e,f.IT.Exclude,t);i.prop?n.end=Math.max(n.end,i.end):console.log("Wrong situation")}},{key:"extendCell",value:function(e,t,n,i){var o=this.data.doc.getDataLogic("final").specTable,a=o.getTapx(e,f.IT.Include,n);if(a.prop){var r=a.cellDatas,s=r.findIndex((function(t){return e<t.end}));s>=0&&s<r.length&&(i.begin=Math.min(i.begin,r[s].begin))}var l=o.getTapx(t,f.IT.Exclude,n);if(l.prop){var u=l.cellDatas,c=t===e?u.findIndex((function(e){return t<e.end})):u.findIndex((function(e){return t<=e.end}));c>=0&&c<u.length&&(i.end=Math.max(i.end,u[c].end))}}},{key:"extendAsianCombine",value:function(e,t,n){if(n.begin!==n.end&&!this.selection.isComposing){var i=this.data.doc.getDataLogic("final"),o=i.getChpx(n.begin);if(this.isAsianCombine(i,o)){for(var a=n.begin;!i.atPapxBound(a)&&(o=i.getChpx(a,f.IT.Exclude),this.isAsianCombine(i,o));)a=o.pos;n.begin=a}if(o=i.getChpx(n.end,f.IT.Exclude),this.isAsianCombine(i,o)){for(var r=n.end;!i.atPapxBound(r)&&(o=i.getChpx(r,f.IT.Include),this.isAsianCombine(i,o));)r=o.pos+o.len;n.end=r}}}},{key:"extendDroplistControl",value:function(e,t,n){var i=this.data.selection;if(i.activeCtrls&&1===i.activeCtrls.length){var o=i.activeCtrls[0],a=o.ctrl.begin,r=o.ctrl.end,s=!(e-1!==a&&e!==a||t+1!==r&&t!==r);o.ctrl.isDropdownList&&s&&(n.begin=a,n.end=r)}}},{key:"extendParagraphSetting",value:function(e,t,n){if(this.selection.selContext.isParagraphSetting){var i=this.data.doc.textStream.getPapx(t>e?t-1:t),o=i.len,a=i.pos;n?(n.begin=a,n.end=a+o):(this.begin=new $n.a(this.selection,a),this.end=new $n.a(this.selection,a+o))}}},{key:"isAsianCombine",value:function(e,t){if(t.prop.getPropVal("o_math")||t.prop.getPropVal("fit_text_id"))return!1;var n=t.prop.getPropVal("asian_layout");if(!n||!n.combine&&2!==n.type)return!1;var i,o=e.getChar(t.pos);return!(!o||(i=o.charCodeAt(0),i===Ne.g||i===Ne.B||i===Ne.j||i===Ne.l||i===Ne.k||i===Ne.m||i===Ne.i||i===Ne.q||i===Ne.a||i===Ne.f))}}]),e}(),oi=function(){function e(t,n){l()(this,e),this.selection=t,this.reset(),this.setRanges(n)}return c()(e,[{key:"reset",value:function(){this._ranges=[]}},{key:"isPosition",value:function(){return 1===this._ranges.length&&this._ranges[0].isPosition()}},{key:"setRanges",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&this.reset(),e?e&&e.length?e.forEach((function(e){t._ranges.push(new ii(t.selection,e))})):e instanceof ii?this._ranges.push(e):this._ranges.push(new ii(this.selection,e)):this._ranges.length||this._ranges.push(new ii(this.selection))}},{key:"getNormalRanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._ranges.map((function(t){return t.getNormalRange(e)}))}},{key:"getActiveNormalRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.activeRange.getNormalRange(e)}},{key:"getBegin",value:function(){return this._ranges[0].begin}},{key:"getEnd",value:function(){return this._ranges[this._ranges.length-1].end}},{key:"activeRange",get:function(){return this._ranges[this._ranges.length-1]}}]),e}(),ai=function(){function e(t){l()(this,e),this.selection=t,this.reset(),this.setAreas()}return c()(e,[{key:"reset",value:function(){this._areas=[]}},{key:"isPosition",value:function(){return 1===this._areas.length&&this._areas[0].isPosition()}},{key:"setAreas",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&this.reset(),e?e&&e.length?e.forEach((function(e){t._areas.push(new oi(t.selection,e))})):this._areas.push(new oi(this.selection,e)):this._areas.length||this._areas.push(new oi(this.selection)),this.selection.begin=this.getBegin(),this.selection.end=this.getEnd()}},{key:"getNormalRanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];return this._areas.forEach((function(n){n.getNormalRanges(e).forEach((function(e){t.push(e)}))})),t}},{key:"getBegin",value:function(){return this.activeArea.getBegin()}},{key:"getEnd",value:function(){return this.activeArea.getEnd()}},{key:"activeArea",get:function(){return this._areas[this._areas.length-1]}}]),e}(),ri=n(7757),si=n.n(ri),li=n(7758),ui=n.n(li),ci=n(760),hi=n(2009),di=n(227),pi=n(1238),fi=St.isPad,gi=0,vi=1,mi=2,_i=function(){function e(t,n){l()(this,e),this.selection=t,this.data=this.selection.data,this.data.doc.attachObserver(this),this.coopRanges=[],this.conveneList=[],this.coopInfo=n,this.cooperCenter=di.default.cooper.getCooperCenter(),this.cachedParam={isCacheSendSelChanged:!1,isEditing:!1}}return c()(e,[{key:"onCmdExec",value:function(){this.cachedParam.isEditing=!0,this.cachedParam.isCacheSendSelChanged=!0}},{key:"getCooperatorColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return-1===e?"#F05B13":this.coopInfo.getUserColor(e)||"#F05B13"}},{key:"getRevisionColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return-1===e?"#fc0d1b":this.coopInfo.getRevisionColor(e)||"#fc0d1b"}},{key:"onInsertText",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.coopRanges.forEach((function(e){e.range&&(t<e.range.pos&&t+length>=e.range.pos?e.range.pos=t+n.length:e.range.pos>=t&&(e.range.pos+=n.length))}))}},{key:"onDeleteText",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.coopRanges.forEach((function(e){if(e.range){var i=n.length;t<e.range.pos&&t+i>=e.range.pos?e.range.pos=t:e.range.pos>t&&(e.range.pos-=n.length)}}))}},{key:"sendSelectionChangeToOtherUsers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(t!==vi&&this.coopRanges.length>200)||window.APP.isEditMode&&!window.APP.isReadOnly()){var i=n.text,o=n.cellRanges,a=n.isNewConvene,r=n.isInitialSend,s=n.isEditing,l=n.noticeTime,u=void 0===l?Date.now():l,c=n.isReadOnly;if(!window.APP.isPaginationMode()||e){var h=this.selection.selAreas.activeArea.getActiveNormalRange();if(this.data.api.isWholeIdle()){var d=window.g_rpt.getCurrentVersion(),p=this.selection.selContext,f=p.commentId,g=p.isCommentEditable,v=p.isReplyComment,m=this.cachedParam.isEditing||s||g,_=this.selection.begin.glyphTail||this.selection.end.glyphTail,y={pos:h.pos,len:h.len,glyphTail:_,dataVersion:d,isEditing:m,outOfCooper:e,cells:o||this.getSelectedCells(),isInitialSend:r,isNewConvene:a,isReadOnly:c,isInEditMode:window.APP.isEditMode&&!window.APP.isReadOnly()};return f&&(y.commentId=f,v&&(y.isReplyComment=v)),void 0!==t&&(y.conveneType=t,t===vi&&(y.timeRemain=16e3-(Date.now()-u))),void 0!==i&&(y.text=i||""),this.data.api.sendSelectionChange(y),this.cachedParam.isEditing=!1,this.cachedParam.isCacheSendSelChanged=!1,this.conveneList&&this.updateConveneListRange({range:y,userid:window.APP.info.userid}),!0}return this.cachedParam.isCacheSendSelChanged=!0,!1}}}},{key:"updateCompositionRange",value:function(){di.default.dispatchEvent(oe.default.names.DOC_COOPRANGE_UPDATED)}},{key:"setCooperationSelections",value:function(e,t,n,i,o){var a=this,r=[],s=null,l=void 0,u=window.g_rpt.getLastLocalCommand();this.selection.isComposing&&u&&u.param&&u.param.isComposing&&(s=u.param),e.forEach((function(e){var n=e.id;t.userid;var o=e.name,u=e.avatar,c=e._color,h=e._latesttime,d=e.permission,p=null;if(e._range){p=Object.assign({},e._range),s&&void 0!==s.pos&&s.pos<p.pos+p.len&&n!==t.userid&&(p.pos+=s.strlen);var f=a.data.doc.limitInSubdoc(p.pos,p.pos+p.len),g=f.begin,v=f.end,m=f.isOutOfValidSubDocRange;p.isInvalid=m||!!p.commentId,p.pos=g,p.len=v-g}var _={userid:n,nickname:o,pic:u,color:c,latesttime:h,range:p,permission:d};r.push(_),n===i&&(l=_),a.updateConveneListRange(_)})),(!n||r.length||i)&&(this.coopRanges=r,this.selection._dispatch("onCooperationSelectionsChanged",{changedUserId:i,changedCoopRange:l}),oe.default.dispatchEvent(oe.default.cooperation.COOPERATOR_SELECTION_CHANGE,{changedCoopRange:i&&r.find((function(e){return e.userid===i})),quit:o}))}},{key:"convene",value:function(){var e=this.getSelectedText(),t=this.selection.selInfo.getSelectionInfo(),n=t.isPoint,i=t.inTable,o=this.selection.selInfo.hasTable(),a=window.APP.info,r=this.coopInfo.coopInfos.find((function(e){return e.userid===a.userid})),s=this.getSelectedCells(t);this.sendSelectionChangeToOtherUsers(!1,vi,{text:e,cellRanges:s,isNewConvene:!0});var l=window.g_rpt.getCurrentVersion(),u=this.cachedParam.isEditing,c={pos:t.begin,len:t.end-t.begin,cells:s,dataVersion:l,isEditing:u,outOfCooper:!1,conveneType:vi,isNewConvene:!0};void 0!==e&&(c.text=e||"");var h={nickname:r.username,userid:r.userid,color:r.color,pic:a.avatar,range:c,noticeTime:Date.now()};this.updateConveneListWhenConvenedBySelf(h),n&&i?window.collection("convene","value","table"):!i&&o?window.collection("convene","value","tablearea"):n?window.collection("convene","value","text"):n||window.collection("convene","value","textarea")}},{key:"getSelectedCells",value:function(e){var t=e||this.selection.selInfo&&this.selection.selInfo.getSelectionInfo()||{},n=[];return!t.tableSelected&&t.wholeCellSelected&&t.cells.forEach((function(e){e.forEach((function(e){n.push({pos:e.begin,len:e.end-e.begin})}))})),n}},{key:"jumpConvene",value:function(e){return this.jumpToUser(e,!0)}},{key:"locate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selection.begin,n=arguments[1],i=n.glyphTail,o=void 0!==i&&i,a=n.isConvene,r=void 0!==a&&a,s=n.delaySetPosition,l=void 0===s?500:s,u=n.isClick,c=void 0===u||u,h=n.documentFieldNames,d=n.moveTop,p=void 0!==d&&d;return new Promise((function(n){var i=t;"number"==typeof i&&(i=new $n.a(e.selection,i,o)),window.APP.workspace.scrollToPos(i.pos,!p||"moveTop");var a=window.APP.data.selection.selInfo.isInTable(i.position);if(St.isMobile&&a){var s=window.APP.workspace.waterdrop._cursor.left,u=window.APP.workspace.element.clientWidth,d=0;(s>u||s<0)&&(d=s-u/2);var f={x:d,y:0},g=i.pos.position;g>1&&(g-=1),oe.default.dispatchEvent(oe.default.mobile.ON_UPDATE_TABLE_VIEW,{position:g,offset:f})}var v=function(){var t=!1;e.selection.checkIfSelectionBeyondLimitation(i).result||(t=e.selection.setPosition(i,i,{isClick:c,documentFieldNames:h,shouldBlur:fi}),window.APP.workspace.makesureCursorVisible(),e.sendSelectionChangeToOtherUsers(!1,r?mi:gi)),window.APP.workspace.onScroll(),n(t)};l?setTimeout((function(){v()}),l):v()}))}},{key:"jumpToUser",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n&&window.collection("convene","value","visitconvener");var i=null,o=null;if(i=n?this.conveneList.find((function(t){return t.userid===e})):e===window.APP.info.userid?{range:window.APP.data.selection.getNormalRange(),nickname:window.APP.info.username}:this.coopRanges.find((function(t){return t.userid===e})),!(o=i.range))return Promise.resolve({});var a=o,r=a.pos,s=a.len,l=o.glyphTail||0!==s;if(l){var u=this.selection.selInfo.isInTable(o.pos+o.len);l=l&&!u}window.APP.data.selection.selContext.isParagraphSetting&&oe.default.dispatchEvent(oe.default.names.ON_EXIT_PARAGRAPH_SETTING_MODE,{noLocate:!0}),oe.default.dispatchEvent(oe.default.cooperation.SHOW_COOPERATOR_NAME_TIP,{userID:-1}),Object(pi.typoToPositionWithLoading)(r+s).then((function(){var a=new $n.a(t.selection,r+s,l);t.locate(a,{isConvene:n,delaySetPosition:0}).then((function(){return"read"!==i.permission&&t.showHighLight(t.getCooperatorColor(e),o),oe.default.dispatchEvent(oe.default.cooperation.SHOW_COOPERATOR_NAME_TIP,{userID:e}),{position:a}}))}),(function(){}))}},{key:"getSelectedText",value:function(){var e=this.selection.getNormalRange(),t="";return t=e.len>0?Object(sn.getPureText)(this.data,ci.filterText,[e]).substr(0,4):(t=this.data.glyphpool.getBackwardVisibleText(e.pos,14)).substring(Math.max(0,t.length-4),t.length)}},{key:"updateConveneList",value:function(e,t){var n=t.conveneType,i=t.timeRemain,o=void 0===i?16e3:i,a=this.coopRanges.find((function(t){return t.userid===e}));if(a){var r=a.range;r&&(r.conveneType=n,r.conveneType===vi&&(a.noticeTime=Date.now()+o-16e3,this.addConveneItem(a)))}}},{key:"updateConveneListWhenConvenedBySelf",value:function(e){e.range.conveneType===vi&&this.addConveneItem(e)}},{key:"addConveneItem",value:function(e){if(St.isMobile&&window.APP.data.doc.gcpToCp(e.range.pos).subDocType===w.HeaderFooter)return;var t=e.userid,n=this.conveneList.find((function(e){return e.userid===t}));if(e.range.isNewConvene||!n){var i=window.APP.data.selection.selCoop.onLineCooperators;this.conveneList=this.conveneList.filter((function(e){return e.userid!==t})),e.noticeTime||(e.noticeTime=Date.now()),this.conveneList.push(e),this.conveneList=this.conveneList.slice(-3).filter((function(e){return i.get(e.userid+"")})),oe.default.dispatchEvent(oe.default.cooperation.ON_CONVENE_LIST_UPDATE,{notice:e})}}},{key:"updateConveneListRange",value:function(e){var t=e.userid,n=e.range;if(n){var i=this.conveneList.findIndex((function(e){return e.userid===t}));if(-1!==i){var o=this.conveneList[i];this.conveneList[i]=d()({},o,{range:n})}}}},{key:"sendCooperationInfoWhenNewCooperatorOnline",value:function(){var e=this.conveneList.find((function(e){return e.userid===window.APP.info.userid}));if(e)if(Date.now()-e.noticeTime<14e3){var t={text:e.range.text,cellRanges:e.range.cells,isNewConvene:!1,noticeTime:e.noticeTime};this.sendSelectionChangeToOtherUsers(!1,vi,t)}else window.APP.isEditMode&&this.sendSelectionChangeToOtherUsers();else this.sendSelectionChangeToOtherUsers(!1,gi)}},{key:"showDefaultHighLight",value:function(e){this.showHighLight("rgb(170,210,255)",e)}},{key:"showHighLight",value:function(e,t){if(t.len>0){var n={ranges:[Object.assign({color:e},t)],time:2e3};t.cells&&t.cells.length>0&&(t.cells.forEach((function(t){t.color=e})),n.ranges=t.cells),oe.default.dispatchEvent(hi.a.HIGHLIGHT.BLINK,{affair:"blink",params:n})}}},{key:"onLineCooperators",get:function(){var e=new Map;return this.cooperCenter.getCooperationUsers().forEach((function(t,n){e.set(n,t)})),e}}]),e}(),yi=function(){function e(t){l()(this,e),this.selection=t,this.data=this.selection.data,this.activeRevisionInfo={activeRevision:null,hoverRevision:null}}return c()(e,[{key:"activateRevision",value:function(e){var t=e.revision,n=void 0===t?null:t,i=e.gcp,o=e.range,a=e.type,r=void 0===a?"active":a,s=n;s||(s=o?this.data.doc.revisions.getLastChpxRevision({pos:o.pos,exactRange:o}):this.data.doc.revisions.getLastChpxRevision({pos:i})),"active"===r?this.selection.isComposing&&s&&this.selection.end.position===s.end?this.inActivateRevision():this.activeRevisionInfo.activeRevision=s:"hover"===r&&(this.activeRevisionInfo.hoverRevision=s)}},{key:"inActivateRevision",value:function(){this.activeRevisionInfo.activeRevision=null,this.activeRevisionInfo.hoverRevision=null}}]),e}(),bi=n(1170),Ti={},Ci=function(){function e(t){l()(this,e),this.selection=t,this.subdocType=w.MainText,this.nLayoutIndex=0,this._shapeIdxPathOfTextbox=null,this.isChangedByEdit=!1,this.isChangedByFuncKeys=!1,this.isParagraphSetting=!1,this.isCommentEditable=!1}return c()(e,[{key:"validateSubdocType",value:function(e,t){if(void 0===e||void 0===t||null===e||null===t)return!0;var n="number"==typeof e?e:e.position,i="number"==typeof t?t:t.position,o=this.selection.data.doc.getSubDocType(n),a=this.selection.data.doc.getSubDocType(i);if(o<0||a<0||o!==a)return!1;if(n>i){var r=n;n=i,i=r}return a!==w.Textbox&&a!==w.TextboxInHF||(this.selection.data.doc.textboxs.rangeClass.fetchInfoContainPos(Ti,n),i>=Ti.begin&&i<=Ti.end)}},{key:"setSubdocType",value:function(e){var t=e===w.HeaderFooter||e===w.TextboxInHF,n=this.isInHeaderFooter!==t;this.subdocType=e,n&&this._setInHeaderFooter(t)}},{key:"_setInHeaderFooter",value:function(e){this.setInHeaderFooterPurely(e),this.isInHeaderFooter&&!window.APP.isReadOnly()&&oe.default.dispatchEvent(hi.a.HEADER_FOOTER.SHOW_HIT_TIP,{affair:"showHitTip",params:{isShow:!1}}),oe.default.dispatchEvent(hi.a.HEADER_FOOTER.SWITCH_MODE,e)}},{key:"setInHeaderFooterPurely",value:function(e){window.APP.isMobileMode()||(this._isInHeaderFooterPurely=e)}},{key:"setHeaderfooterLayoutIndex",value:function(e){this.nLayoutIndex=e}},{key:"isInComment",value:function(){return this.subdocType===w.Comment||this.isInTempComment}},{key:"getCommentRcId",value:function(){return this.commentRcId}},{key:"setCommentRcId",value:function(e){this.commentRcId=e}},{key:"getCommentId",value:function(e){return this.commentId}},{key:"setCommentId",value:function(e){this.commentId=e}},{key:"getCommentType",value:function(){return this.commentType}},{key:"setCommentType",value:function(e){this.commentType=e}},{key:"setIsReplyComment",value:function(e){this.isReplyComment=e}},{key:"setCommentEditable",value:function(e){this.isCommentEditable=e}},{key:"setCommentPos",value:function(e){this.commentPos=e}},{key:"isInMath",value:function(){return this.selection.inOMath}},{key:"isInHeaderFooter",get:function(){return this.subdocType===w.HeaderFooter||this._isInHeaderFooterPurely}},{key:"isInMainText",get:function(){return this.subdocType===w.MainText}},{key:"isInFooter",set:function(e){this._isInFooter=e},get:function(){return this._isInFooter}},{key:"headerfooterLayoutIndex",get:function(){return this.nLayoutIndex}},{key:"isInTextbox",get:function(){return this.subdocType===w.Textbox||this.subdocType===w.TextboxInHF}},{key:"shapeIdxPathOfTextbox",set:function(e){this._shapeIdxPathOfTextbox=e},get:function(){return this._shapeIdxPathOfTextbox}},{key:"isInTempComment",get:function(){return Object(bi.isInTempComment)()}},{key:"isInFootnoteOrEndnote",get:function(){return this.subdocType===w.Footnote||this.subdocType===w.Endnote}},{key:"isInFootnote",get:function(){return this.subdocType===w.Footnote}},{key:"isInEndnote",get:function(){return this.subdocType===w.Endnote}}]),e}(),ki=n(1917),wi=n(1639),Si=0;function Pi(e,t){for(var n=e,i=1,o=t.length;i<o&&(n=n.childShapes[t[i]]);++i);return n}var Ii=function(){function e(t){var n=this;l()(this,e),this.data=t,ui()((function(e){n.selInfo=new e.default(n)})),this.selCoop=new _i(this,ni.a),this.selAreas=new ai(this),this.selContext=new Ci(this),this.selRevision=new yi(this),this.activeShapeIdxPath=void 0,this._selShapeIdxPaths=void 0,this.activeShapeTreeType=void 0,this.activeCommentParaData=null,this.activeCtrls=[],this.inOMath=!1,this.notifySelectionThrottleChanged=window.utils.Lodash.throttle(this.notifySelectionThrottleChanged.bind(this),300),window.g_rpt.getTransDepositedContainer().addItem(this),Object(p.default)(this),this.makeNewVer()}return c()(e,[{key:"afterOpen",value:function(){var e=this;this.selCoop.coopInfo.afterOpen(),this.selAlter||si()((function(t){e.selAlter=new t.default(e)}))}},{key:"makeNewVer",value:function(){this.ver=Si,Si++,this.tran=null}},{key:"transDepositedClone",value:function(){if(this.begin&&this.end){var e=this.begin.position,t=this.end.position;this.compositionState&&(t=e,this.compositionState=this.compositionState==ki.a.CompositionEnd?ki.a.CompositionInit:ki.a.CompositionUpdate);var n={begin:e,end:t,layoutIndex:this.data.selection.selContext.headerfooterLayoutIndex},i=this._selShapeIdxPaths,o=this.activeShapeIdxPath,a=this.activeShapeTreeType;if(o&&(n.shapeIdxPath=o),i&&(n.selShapeIdxPaths=i),(i||o)&&(n.shapeTreeType=a),this.selAreas&&this.selAreas.activeArea&&this.selAreas.activeArea._ranges&&this.selAreas.activeArea._ranges.length>1){var r=[];this.selAreas.activeArea._ranges.forEach((function(e){r.push({begin:e.begin.position,end:e.end.position})})),n.rangeArea=r}return{ver:this.ver,objRgs:[n]}}}},{key:"transDepositedInstall",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){if(this.selCoop.cachedParam.isCacheSendSelChanged=!0,!(t.isSelf||e.ver==this.ver&&n))return;this.ver=e.ver}var i=e.objRgs,o=i[0].rangeArea,a=this.data.doc.limitInSubdoc(i[0].begin,i[0].end),r=a.begin,s=a.end;if(o)if(r>s){var l=o[0];r=Math.max(l.begin,l.end);var u=o[o.length-1];s=Math.min(u.begin,u.end)}else{var c=o[0];r=Math.min(c.begin,c.end);var h=o[o.length-1];s=Math.max(h.begin,h.end)}if(void 0!==this.backupUndoRedoSel){this.backupUndoRedoSel.begin=r,this.backupUndoRedoSel.end=s,this.backupUndoRedoSel.layoutIndex=i[0].layoutIndex;var d=i[0],p=d.shapeTreeType,f=d.shapeIdxPath,g=d.selShapeIdxPaths;this.backupUndoRedoSel.shapeTreeType=p,this.backupUndoRedoSel.shapeIdxPath=f,this.backupUndoRedoSel.selShapeIdxPaths=g}else this.selContext.setHeaderfooterLayoutIndex(i[0].layoutIndex),this.setPosition(r,s,{isSend:!1,updateOnly:!0});this.tran=t}},{key:"getRangedSelection",value:function(){var e=this.begin,t=this.end,n=void 0,i=void 0,o=!1;return e?t?t.position>e.position?(n=e,i=t):t.position<e.position?(n=t,i=e):t.glyphTail&&!e.glyphTail?(n=e,i=t):e.glyphTail&&!t.glyphTail?(n=t,i=e):(n=e,i=t,o=!0):(n=e,i=e,o=!0):(n=t,i=t,o=!0),{begin:n,end:i,isSame:o}}},{key:"calearCache",value:function(e){ti.a.calearCache(e)}},{key:"clearCache",value:function(){ti.a.reset()}},{key:"clearActiveCtrls",value:function(){this.data.selection.activeCtrls=[],this.data.selection.activeDateCtrls=[]}},{key:"clearAll",value:function(e){this.selContext.isInHeaderFooter&&this.clearActiveCtrls(),e||this.setRanges([{begin:0,end:0}],{}),this.clearCache(),e&&window.g_rpt.getTransDepositedContainer().clearAll(),this.selectionThrottleChangedNotifyTid&&clearTimeout(this.selectionThrottleChangedNotifyTid)}},{key:"update",value:function(e){window.APP.isFirstScreenRendered&&(e&&(e.isComposing=this.isComposing),this._dispatch("onSelectionChanged",e))}},{key:"updateCompositionState",value:function(e){this.compositionState=e||ki.a.CompositionInit,this.isComposing=!1,e&&(this.isComposing=[ki.a.CompositionStart,ki.a.CompositionUpdate].includes(e))}},{key:"triggerManualEvents",value:function(e){e&&(this.needUpdatePosition=!0)}},{key:"clearManualState",value:function(){delete this.needUpdatePosition}},{key:"_needUpdatePosition",value:function(){return!!this.needUpdatePosition}},{key:"validateSelection",value:function(e,t){var n=e||this.getNormalRange(),i=this.data.doc.getSubDocType(n.pos),o=this.data.doc.getValidDocRanges(),a=o.some((function(e){var t=e||{},i=t.pos,o=t.len;return i<=n.pos&&i+o>=n.pos+n.len}));switch(!0){case!a&&i===w.Textbox:var r=this.data.doc.textboxs.getTextbox(n.pos)||{};if(r&&r.anchor){var s=r.anchor,l=s.begin,u=s.end;this.setPosition(l,u,{isSend:!0,preventScroll:!0})}break;case!a&&o.length>0:var c=o[0].pos;if(!isNaN(t))c=o.some((function(e){return e.pos<=t&&t<e.pos+e.len}))?t:c;this.setPosition(c,null,{isSend:!0,preventScroll:!0});break;default:this.setPosition(n.pos,n.pos+n.len,{preventScroll:!0})}}},{key:"notifySelectionChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.notifySelectionSyncChanged(e),this.notifySelectionThrottleChanged(e)}},{key:"notifySelectionThrottleChanged",value:function(e){var t=this,n=window.APP;n.isFileOpened&&(this.selectionThrottleChangedNotifyTid=setTimeout((function(){if(t.selectionThrottleChangedNotifyTid=null,t.selInfo){var i=t.selInfo.getSelectionInfo(),o=(i.ctrls||[]).map((function(e){return{refId:e.refId,begin:e.begin,end:e.end,pos:e.pos,len:e.len,type:e.type,title:e.title,tag:e.tag,color:e.color,appearance:e.appearance,lockContent:e.lockContent,lockControl:e.lockControl,placeholderText:e.type===wi.DocpartObj?"":e.placeholderText,showPlcHdr:e.showPlcHdr,isDate:e.isDate,isDropdownList:e.isDropdownList,isModified:e.isModified,isRichText:e.isRichText,isPureText:e.isPureText,isPicture:e.isPicture,isComboBox:e.isComboBox,isCheckBox:e.isCheckBox,isRepeatSec:e.isRepeatSec,isRepeatItem:e.isRepeatItem,displayFormat:e.displayFormat,entries:e.entries&&e.entries.map((function(e){return e}))}}));e.selectionInfo=d()({},i,{ctrls:o}),n.functionStatus.handleSelectionChange(),oe.default.dispatchEvent(oe.default.names.DOC_SELECTION_CHANGED,e)}}),16))}},{key:"notifySelectionSyncChanged",value:function(e){window.APP.isFileOpened&&oe.default.dispatchEvent(oe.default.names.DOC_SELECTION_SYNC_CHANGED,e)}},{key:"_afterSetSelection",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t&&(this.selContext.ipChpx=void 0),this.selInfo&&(this.selInfo.info=n),this.selContext.chpx=void 0,this.selContext.papx=void 0,this.inOMath||this.selectionHasMath(this.begin,this.end),this.activeShapeIdxPath=e.shapeIdxPath,this.activeShapeTreeType=e.shapeTreeType,this._selShapeIdxPaths=e.selShapeIdxPaths,this.selContext.activeDocumentFieldNames=window.APP.isEditMode?e.documentFieldNames:null,!window.APP.isPaginationMode())if(e.isComment)this.selRevision.inActivateRevision();else{var i=this.begin.position>this.end.position?this.end.position:this.begin.position;this.selRevision.activateRevision({gcp:i,range:e.revisionRange})}e.isManualRangeSelect?this.isManualRangeSelect=!0:e.updateOnly||(this.isManualRangeSelect=!1),window.APP.workspace.updateDisabled||this._dispatch("onSelectionChanged",{activateCtrl:e.activateCtrl,activateCatalog:e.activateCatalog,applyFormat:e.applyFormat,updateOnly:e.updateOnly,preventScroll:e.preventScroll,preventFocus:e.preventFocus,shouldBlur:e.shouldBlur,isComposing:e.isComposing||this.isComposing,isClick:e.isClick,isTripleTap:e.isTripleTap,activeContentControlUpdated:e.activeContentControlUpdated,isSelectFormatControl:e.isSelectFormatControl,isComment:e.isComment,isEditing:e.isEditing,revisionData:e.revisionData,notRenderSelectDrop:e.notRenderSelectDrop,isMoving:e.isMoving});var o=this.isComposing&&!this._needUpdatePosition();if(e.isSend&&!o){var a=this.selCoop.conveneList.find((function(e){return e.userid===window.APP.info.userid&&Date.now()-e.noticeTime<15e3}));if(a){var r=this.selCoop.getSelectedText();this.selCoop.sendSelectionChangeToOtherUsers(void 0,void 0,{text:r})}else this.selCoop.sendSelectionChangeToOtherUsers(void 0,void 0,{isEditing:e.isEditing})}this.notifySelectionChanged({updateOnly:e.updateOnly,isClick:e.isClick,isEditing:e.isEditing,dragMark:e.dragMark}),e.isSend&&!e.isKeepVer&&this.makeNewVer()}},{key:"updateSelectionContext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selContext.isChangedByFuncKeys=Boolean(e.isChangedByFuncKeys),this.selContext.isChangedByEdit=Boolean(e.isEditing||e.updateOnly)}},{key:"setPosition",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=e,a=t;if(this.selContext.isInFooter=o&&o.isInFooter,this.data.api.hasBlocking())return!1;if(this._FormatContentAutoInsertText(o))return!1;this.updateSelectionContext(n);var r=void 0;if((r=this.checkIfSelectionBeyondLimitation(o,a,n)).result&&(n.activeContentControlUpdated=!1,r.adjustRange?(n.shapeId=void 0,n.preventScroll=!1,o=r.adjustRange.begin,a=r.adjustRange.end,n.shouldBlur=0===r.adjustRange.begin&&r.adjustRange.begin===r.adjustRange.end):(o=this.begin,a=this.end,n.shouldBlur=!0)),(r=this.checkIfSelectionAcrossComment(o,a,n)).result&&r.adjustRange&&(o=r.adjustRange.begin,a=r.adjustRange.end),void 0!==this.backupMargins){var s=this.backupMargins;delete this.backupMargins,window.APP.editor.setSectionMargins(s)}var l=null!==this.begin?this.begin.position:void 0,u=null!==this.end?this.end.position:void 0,c=this.data.doc.templateType;if(this.activeOMath=null,this.inOMath=!1,c===Ut.c||c===Ut.b){var h=this._adjustRangeInTemplate(o,a);o=h.begin,a=h.end}else{var d=this._adjustRangeForFormatContent(o,a,n);o=d.result?d.begin:o,a=d.result?d.end:a;var p=this._adjustRangeForMath(o,a,n);p.inOMath&&(this.inOMath=!0),p.result?(o=p.begin,a=p.end):p.activeOMath&&(this.activeOMath={pos:p.begin,len:p.end-p.begin});var f=this._adjustRangeForTranslate(o,a,n);f.result&&(o=f.begin,a=f.end);var g=this._adjustForField(o,a,n);g.result&&(o=g.begin,a=g.end)}var v=a;if(null==v&&(v=o),!this.selContext.validateSubdocType(o,a))return!1;if(this.data.doc.isPalaceMuseumTemplate){var m=-1,_=-1;if(null!=o&&(m="number"==typeof o?o:o.position,!this.data.doc.contentControls.isInTextContentControl(m)))return!1;if(null!=a&&(_="number"==typeof a?a:a.position,!this.data.doc.contentControls.isInTextContentControl(_)))return!1}if(void 0!==o&&void 0!==a&&null!==o&&null!==a){var y=this.data.getSelCellRanges(o,a,n.validCrossCells),b=[y];this.selAreas.setAreas(b)}else this.selAreas.setAreas({begin:o,end:a});if(this.adjustSelContext(o,a,n),null!=v){var T=-1,C=void 0;if("number"==typeof v?(C=v,T=this.data.doc.getSubDocType(v)):v instanceof $n.a?(C=v.position,T=this.data.doc.getSubDocType(C)):this.selContext.isInHeaderFooter?(this.selContext.setHeaderfooterLayoutIndex(v.layoutIndex),C="number"==typeof o?o:o.position,T=this.data.doc.getSubDocType(C)):(C="number"==typeof o?o:o.position,T=this.data.doc.getSubDocType(C)),this.selContext.setSubdocType(T),T==w.Textbox||T==w.TextboxInHF)if(v.shapeIdxPathOfTextbox)this.selContext.shapeIdxPathOfTextbox=v.shapeIdxPathOfTextbox,this.selContext.shapeTreeTypeOfTextbox=v.shapeTreeTypeOfTextbox;else{var k=this.data.doc.textboxs.getTextbox(this.getNormalRange().pos);if(k){var S=k.getShapeInfo(),P=S.shapeTreeType,I=S.shapeIdxPath;this.selContext.shapeIdxPathOfTextbox=I,this.selContext.shapeTreeTypeOfTextbox=P}}else this.selContext.shapeIdxPathOfTextbox=null,this.selContext.shapeTreeTypeOfTextbox=-1}else this.selContext.shapeIdxPathOfTextbox=null,this.selContext.shapeTreeTypeOfTextbox=-1;var E=!1;if(this.begin&&this.end&&this.begin.position===l&&this.end.position===u||(E=!0),!n.documentFieldNames){var O=void 0,x=void 0;o=this.begin,a=this.end;var R=this.getPosNum(o),N=this.getPosNum(a);if(R>N){var A=o;o=a,a=A}if("number"==typeof o){var D=new $n.a(this,o,!1);O=D.pos.glyphGroupInfo}else if(o instanceof $n.a)if(o.glyphTail){var M=new $n.a(this,o.position+1,!1);O=M.pos&&M.pos.glyphGroupInfo||o.pos.glyphGroupInfo}else O=o.pos.glyphGroupInfo;else O=o&&o.glyphGroupInfo;if(R!==N&&a)if("number"==typeof a){var L=new $n.a(this,a-1,!0);x=L.pos.glyphGroupInfo}else if(a instanceof $n.a)if(a.glyphTail)x=a.pos.glyphGroupInfo;else{var F=new $n.a(this,a.position-1,!0);x=F.pos&&F.pos.glyphGroupInfo||a.pos.glyphGroupInfo}else x=a&&a.glyphGroupInfo;else x=O;if(O&&O.documentFieldNames||x&&x.documentFieldNames){var B=this._getDocumentFieldNames(O,x);B&&B.length&&(n.documentFieldNames=B)}}if(this._afterSetSelection(n,E,i),this.selInfo){var H=this.selInfo.getChpx();if(H&&H.getPropVal("spacing")>=4096&&this.updateInsertPointChpx(ei.Font_Spacing,0),H&&H.script_pos&&0!==H.script_pos){var G=this.getNormalRange();if(0===G.len){var W=this.data.doc.getDataLogic("final");W.atPapxBound(G.pos)?this.data.doc.getText(G.pos,1).charCodeAt(0)===Ne.q&&this.updateInsertPointChpx(ei.Font_Superscript,!1):this.data.doc.getText(G.pos-1,1).charCodeAt(0)===Ne.q&&this.updateInsertPointChpx(ei.Font_Superscript,!1)}}}if(Object(bi.isInTempComment)()){var j=Object(bi.getTempData)(),U=j.tempRcId,V=j.tempCommentId,Y=j.tempReplyId;this.enterCommentBody(U,V,!!Y,!0)}return!0}},{key:"setRanges",value:function(e,t,n){var i=this;this.selAreas.setAreas([e]),this._afterSetSelection(t,!0,n),!this.inOMath&&e.length>0&&e.forEach((function(e){i.selectionHasMath(e.begin,e.end),i.hasOMath}))}},{key:"setBegin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setPosition(e,this.end,t)}},{key:"setEnd",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setPosition(this.begin,e,t)}},{key:"getPosNum",value:function(e){var t=-1;return"number"==typeof e?t=e:e&&void 0!==e.position&&(t=e.position,e.glyphTail&&++t),t}},{key:"_getDocumentFieldNames",value:function(e,t){if(e==t)return e.documentFieldNames;if(e){if(t){if(e.documentFieldNames&&t.documentFieldNames){for(var n=e.documentFieldNames,i=t.documentFieldNames,o=[],a=n.length-1,r=i.length-1;a>=0&&r>=0&&n[a]==i[r];)o.splice(0,0,n[a]),--a,--r;return o.length?o:null}return null}return e.documentFieldNames}return t?t.documentFieldNames:null}},{key:"checkIfSelectionBeyondLimitation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e,o=null==t?e:t,a=window.APP.formatContentController,r=a.isRestrictEditMode,s=this.data.fieldManager,l=s.getField(void 0!==i.position?i.position:i);if(null==l&&(l=s.getField(void 0!==o.position?o.position-1:o-1)),l&&"FORMTEXT"===l.getType())return{result:!1};if(!r)return{result:!1};if(!i&&0!==i)return{result:!1};var u=a.move2NextClosestController(i,o);i=i.position||i;var c=0,h=!0;if((o=o.position||o)>=i?c=o-1-i:(c=i-1-o,h=!1),c<1){if(0===c)return{result:!a.checkIsInContentControl(i-1),adjustRange:u};var d=n.mouseStart;if(d)return{result:!a.checkIsInContentControl(i),adjustRange:u};var p=a.getOuterMostControl(i);if(p){var f=p.begin;return i<=f?{result:!0,adjustRange:{begin:f+1,end:f+1}}:{result:!1}}var g=this.begin.position,v=this.end.position;if(g===v){var m=a.getOuterMostControl(g);if(m&&m.end===i)return{result:!0,adjustRange:{begin:m.end-1,end:m.end-1}}}return{result:!0,adjustRange:u}}var _=a.getOuterMostControl(i),y=a.getOuterMostControl(o);if(!_&&!y)return{result:!0,adjustRange:u};if(h){if(!_)return{result:!0,adjustRange:u};if(!y)return{result:!0,adjustRange:{begin:i,end:_.end-1}};if(_.begin!==y.begin)return{result:!0,adjustRange:{begin:i,end:_.end-1}}}else{if(!y)return{result:!0,adjustRange:{begin:i,end:_.begin+1}};if(!_)return{result:!0,adjustRange:u};if(_.begin!==y.begin)return{result:!0,adjustRange:{begin:i,end:_.begin+1}}}return{result:!1}}},{key:"adjustSelContext",value:function(e,t,n){var i=e.position||e,o=null!=t?t.position||t:i;if(isNaN(i)||isNaN(o))return!1;var a=Math.min(i,o),r=this.data.doc.getSubDocType(a)===w.Comment,s=this.selContext;if(r){var l=this.data.doc.commentBodys.getCommentByPos(a);if(!l)return!1;if(!s.isInComment()||s.getCommentRcId()!==l.rc_id||l.comment_id&&s.getCommentId()!==l.comment_id){var u=window.APP.editor.cmdExecutor.getCurrentLocalCommand(),c=n.isEditing||u&&"insertComment"===u.name;this.enterCommentBody(l.rc_id,l.comment_id,l.isReply,c)}}else s.isInComment()&&this.exitCommentBody();return!0}},{key:"checkIfSelectionAcrossComment",value:function(e,t,n){if(!n.isClick)return{result:!1};var i=e.position||e,a=null!=t?t.position||t:i,r=i>a,s=r?[a,i]:[i,a],l=o()(s,2);i=l[0],a=l[1];var u=this.data.doc.getSubDocType(i),c=this.data.doc.getSubDocType(a);if(u===w.Comment&&c===w.Comment){var h=this.selContext.getCommentRcId(),d=this.data.doc.comments.getCommentByRcId(h);if(d)return i>=d.body.begin&&(a<d.body.end||i!==a&&a===d.body.end)?{result:!0,adjustRange:{begin:e,end:t}}:(i===a?i=a=Math.max(d.body.begin,Math.min(i,d.body.end-1)):(i=Math.max(i,d.body.begin),a=Math.min(a,d.body.end)),{result:!0,adjustRange:r?{begin:a,end:i}:{begin:i,end:a}})}return{result:!1}}},{key:"getShapeId",value:function(e){var t=this.data.doc.getEmbedDrawing(e);return t&&t.anchor&&t.anchor.shapeId?t.anchor.shapeId:null}},{key:"getNormalRange",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.selAreas.activeArea.getNormalRanges(e),n=t[0].pos,i=n+t[0].len,o=t.length,a=1;a<o;++a)t[a].pos<n&&(n=t[a].pos),t[a].pos+t[a].len>i&&(i=t[a].pos+t[a].len);return{pos:n,len:i-n}}},{key:"getNormalRanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.selAreas.getNormalRanges(e)}},{key:"getCmdExecuteRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getNormalRange(e);if(1===t.len){var n=this.data.doc.textboxs.findBodyRange(t.pos);n&&(t.pos=n.pos,t.len=n.len)}return t}},{key:"getCmdExecuteRanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.selAreas.getNormalRanges(e);if(t&&1===t.length&&1===t[0].len){var n=this.data.doc.textboxs.findBodyRange(t[0].pos);n&&(t=[{pos:n.pos,len:n.len}])}return t}},{key:"getActiveAreaNormalRanges",value:function(){return this.selAreas.activeArea.getNormalRanges()}},{key:"isStartActive",value:function(){return!(!this.begin||!this.end)&&this.begin.position>this.end.position}},{key:"getLeftTopPoint",value:function(){return this.begin.position>this.end.position?this.begin:this.end}},{key:"onCmdExec",value:function(){this.selCoop.onCmdExec(),this.selContext.chpx=void 0,this.selContext.papx=void 0,this.notifySelectionChanged({isExecCmd:!0})}},{key:"_updateIpChpx",value:function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1];switch(e){case ei.Font_Bold:this.selContext.ipChpx.isBold=t;break;case ei.Font_Italic:this.selContext.ipChpx.isItalic=t;break;case ei.Font_Underline:void 0!==t&&(this.selContext.ipChpx.underlineType=t),void 0!==(arguments.length<=2?void 0:arguments[2])&&(this.selContext.ipChpx.underlineColor=arguments.length<=2?void 0:arguments[2]);break;case ei.Font_StrikeThrough:this.selContext.ipChpx.isStrikeThrough=t,t&&this.selContext.ipChpx.isDoubleStrikeThrough&&(this.selContext.ipChpx.isDoubleStrikeThrough=!1);break;case ei.Font_FontSize:this.selContext.ipChpx.fontSize=t,this.selContext.ipChpx.growUp=0;break;case ei.Font_Superscript:this.selContext.ipChpx.scriptPos=t?1:0;break;case ei.Font_Subscript:this.selContext.ipChpx.scriptPos=t?-1:0;break;case ei.Font_Name:this.selContext.ipChpx.fontName=t;break;case ei.Font_Color:this.selContext.ipChpx.fontColor=t;break;case ei.Font_GrowUp:this.selContext.ipChpx.growUp+=t?1:-1;break;case ei.Font_AllCaps:this.selContext.ipChpx.isAllCaps=Number(t),this.selContext.ipChpx.isSmallCaps&&t&&(this.selContext.ipChpx.isSmallCaps=0);break;case ei.Font_SmallCaps:this.selContext.ipChpx.isSmallCaps=Number(t),this.selContext.ipChpx.isAllCaps&&t&&(this.selContext.ipChpx.isAllCaps=0);break;case ei.Font_DoubleStrikeThrough:this.selContext.ipChpx.isDoubleStrikeThrough=t,t&&this.selContext.ipChpx.isStrikeThrough&&(this.selContext.ipChpx.isStrikeThrough=!1);break;case ei.Font_EmphasisMark:this.selContext.ipChpx.emphasisMark=t;break;case ei.Font_Hidden:this.selContext.ipChpx.isHidden=t;break;case ei.Font_Scaling:this.selContext.ipChpx.scaling=t;break;case ei.Font_Spacing:this.selContext.ipChpx.spacing=t;break;case ei.Font_HighlightColor:this.selContext.ipChpx.highlightColor=t}}},{key:"updateInsertPointChpx",value:function(){if(this._dispatch("onBeforeUpdateChpx"),arguments.length<2)return!1;var e=this.getNormalRange();return 0===e.len&&(void 0===this.selContext.ipChpx&&(this.selContext.ipChpx={},this.selContext.ipChpx.pos=e.pos,this.selContext.ipChpx.growUp=0),this._updateIpChpx.apply(this,arguments),this.notifySelectionChanged(),!0)}},{key:"updateIpChpx",value:function(){if(arguments.length<2)return!1;var e=this.getNormalRange();return void 0===this.selContext.ipChpx&&(this.selContext.ipChpx={},this.selContext.ipChpx.pos=e.pos,this.selContext.ipChpx.growUp=0),this._updateIpChpx.apply(this,arguments),!0}},{key:"selectionComposingRenderCheck",value:function(){if(!this.isComposing)return!1;var e=this.getNormalRange(),t=e.pos,n=e.len,i=window.g_rpt.getLastLocalCommand();if(!i||!i.param||!i.param.isComposing)return!1;var o=i.param.pos,a=i.param.strlen||i.param.string.length;return t===o&&a===n}},{key:"extendCommentRangeWithTable",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.getTableRange(t),a=this.getTableRange(n>0?t+n-1:t),r=null;if(o&&a&&o.begin===a.begin&&o.end===a.end&&(r={pos:o.begin,len:o.end-o.begin}),!r)return null;if(r){var s=Math.min(r.pos,t),l=Math.max(r.pos+r.len,t+n);return i&&this.setPosition(s,l,{isSend:!0}),{pos:s,len:l-s-2}}return null}},{key:"getTableRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=void 0;t&&(n=1);var i=Object(Nt.c)(this.data.doc,e,n);if(!i)return null;var o=i.range;return{begin:o.pos,end:o.pos+o.len}}},{key:"_adjustInRange",value:function(e,t,n){var i=e.min,a=e.max,r=t>n?[Math.min(t,a),Math.max(n,i)]:[Math.max(t,i),Math.min(n,a)],s=o()(r,2);return{begin:s[0],end:s[1]}}},{key:"_adjustRangeInTemplate",value:function(e,t){var n=e instanceof Object?e.position:"number"==typeof e?e:null,i=t instanceof Object?t.position:"number"==typeof t?t:null;if(null===n||null===i||n===i)return{begin:e,end:t};if(this.data.doc.getSubDocType(Math.min(n,i))!==w.MainText)return{begin:e,end:t};var a=this.begin.position!==this.end.position?[this.begin.position,this.end.position,n,i]:[this.begin.position,n,i],r=a.filter((function(e){return a.indexOf(e)!==a.lastIndexOf(e)})),s=o()(r,1)[0];isNaN(s)&&(s=this.begin.position>=n&&this.begin.position<=i?this.begin.position:n);var l=function(e){return e.isRichText},u=this.data.doc.contentControls.collect(s,1).filter(l).sort((function(e,t){return t.begin-e.begin})),c=this.data.doc.getContentControlsInMainText().filter(l).sort((function(e,t){return t.end-e.end})),h=o()(u,1)[0],d=c.find((function(e){return e.end<=s})),p=c.sort((function(e,t){return e.begin-t.begin})).find((function(e){return e.begin>s})),f=this.data.doc.getSubDocRange(w.MainText),g=f.pos,v=g,m=g+f.len,_=h?h.begin+1:v,y=h?h.end-1:m,b=d?d.end:v,T=p?p.begin:m;return v=Math.max(_,b,v),m=Math.min(y,T,m),this._adjustInRange({min:v,max:m},n,i)}},{key:"_adjustRangeForFormatContent",value:function(e,t,n){var i=window.APP.formatContentController,o=i.adjustCtrlSpecialRange(e,t,n);o.result&&(e=o.begin,t=o.end);var a=i.rangeSelectAutoAddDefaultFormatContent(e,t);return a.result||(a=i.getEmptyControlRange(e,t,n)).result?a:o.result?o:{result:!1}}},{key:"selectMathFunction",value:function(e){if(e<0)return!1;var t,n,i=this.data.doc.mathManager,o=function(e,t){var n=e.pos,i=n+e.len,o=t.pos,a=o+t.len;return n==o&&i==a?e instanceof gn?-1:1:n<=o&&i>=a?-1:1},a=(t=e,n=i.collectMathFunctionsByRange({begin:t,end:t+1}).filter((function(e){switch(e.getType()){case pn.v:case pn.o:case pn.l:return!1;default:return!0}})),[].concat(r()(n),r()(i.collectMathsByRange({begin:t,end:t+1}))).sort(o));if(a&&a.length>1){var s=a[a.length-1];if(!(s instanceof gn))return this.setPosition(s.begin,s.end),!0;if(e===s.end-1&&a.length>=3){var l=a[a.length-2];return this.setPosition(l.begin,l.end),!0}}return!1}},{key:"_adjustRangeForMath",value:function(e,t,n){var i=this.data.doc.mathManager,o=void 0!==e.position?e.position:e,a=t?void 0!==t.position?t.position:t:o,s=!1;if(o>a){var l=o;o=a,a=l,s=!0}var u=!1,c=function(e,t){var n=e.pos,i=n+e.len,o=t.pos,a=o+t.len;return n==o&&i==a?e instanceof gn?-1:1:n<=o&&i>=a?-1:1},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t?e+t:e+1,o=i.collectMathFunctionsByRange({begin:e,end:n}).filter((function(e){switch(e.getType()){case pn.v:case pn.o:case pn.l:return!1;default:return!0}}));return[].concat(r()(o),r()(i.collectMathsByRange({begin:e,end:e+1}))).sort(c)},d=!1;if(o!==a){var p=o,f=!0,g=h(o);if(d=g.length>0,g.length>1){g.splice(0,1);for(var v=g.length-1;v>=0;){var m=g[v];if(!(a>(m instanceof gn?m.end-1:m.end)))break;--v}if(v<0)u=!0,o=Math.min(o,g[0].pos);else if(v<g.length-1||v===g.length-1&&!(g[v]instanceof gn)){var _=g[v];_ instanceof gn&&(_=g[v+1]),f=_.end<a,o=Math.min(_.pos,o),a=Math.max(_.end,a),u=!0}}var y=f&&h(a-1);if(d=d||y&&y.length>0,y&&y.length>1){y.splice(0,1);for(var b=y.length-1;b>=0;){if(!(p<y[b].pos))break;--b}if(b<0)u=!0,a=Math.max(y[0].end,a);else if(b<y.length-1||b===y.length-1&&!(y[b]instanceof gn)){var T=y[b];T instanceof gn&&(T=y[b+1]),a=Math.max(T.end,a),u=!0}}}else{var C=h(o);if(d=C.length>0,C.length>1){var k=C[C.length-1];if(k instanceof gn)return{activeOMath:!0,begin:k.pos,end:k.end-(k.len>1?1:0),inOMath:d}}}return{result:u,begin:s?a:o,end:s?o:a,inOMath:d}}},{key:"_adjustRangeForTranslate",value:function(e,t,n){for(var i=this.data.doc.fields,o=void 0!==e.position?e.position:e,a=t?void 0!==t.position?t.position:t:o,r=i.getFields({begin:o,end:a}),s=!1,l=0;l<r.length;++l){var u=r[l]._node;o===a&&u.begin===o||(u.begin<=o&&u.end>=o||u.begin<=a&&u.end>=a)&&u.isTranslated&&(u.begin<o&&(o=u.begin),u.end>a&&(a=u.end),s=!0)}return{result:s,begin:o,end:a}}},{key:"_adjustForField",value:function(e,t,n){var i=this.data.doc.fields,o=void 0!==e.position?e.position:e,a=t?void 0!==t.position?t.position:t:o;if(window.APP.formatContentController.isRestrictEditMode){var r=this.data.fieldManager,s=0;s=a>=o?a-1-o:o-1-a;var l=r.getField(o);if(null==l&&(l=r.getField(a-1)),l&&"FORMTEXT"===l.getType()){var u=l.getRange(),c=u.pos,h=u.pos+u.len,d=l.getResultRange(),p=d.pos,f=d.pos+d.len;if(s<0){if(o===c)return{result:!0,begin:p,end:p};if(o===h)return{result:!0,begin:f,end:f}}else{if(o===c)return a>=h&&(a=f),{result:!0,begin:p,end:a};if(a>=h)return o===h-1&&(o=f),{result:!0,begin:o,end:f}}return{result:!1}}}for(var g=i.getFields({begin:o,end:a}),v=!1,m=0;m<g.length;++m){var _=g[m]._node;if(o===a&&o===_.resultEnd){a=++o,v=!0;break}}return{result:v,begin:o,end:a}}},{key:"selectionHasMath",value:function(e,t){var n=this,i=this.data.doc.mathManager,o=function(e,t){var n=e.pos,i=n+e.len,o=t.pos,a=o+t.len;return n==o&&i==a?e instanceof gn?-1:1:n<=o&&i>=a?-1:1},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t?e+t:e+1,a=i.collectMathFunctionsByRange({begin:e,end:n}).filter((function(e){switch(e.getType()){case pn.v:case pn.o:case pn.l:return!1;default:return!0}}));return[].concat(r()(a),r()(i.collectMathsByRange({begin:e,end:e+1}))).sort(o)};this.hasOMath=!1;var s=e.hasOwnProperty("position")?e.position:e,l=t.hasOwnProperty("position")?t.position:t;((s<l?a(s,l-s):a(l,s-l)).length>0&&(this.hasOMath=!0),!this.hasOMath&&this.selInfo&&this.selInfo.info&&this.selInfo.info.cellsSelected)&&this.selInfo.info.cells.forEach((function(e){var t=e&&e[0]&&a(e[0].begin,e[0].end-e[0].begin);t&&t.length>0&&(n.hasOMath=!0)}))}},{key:"_FormatContentAutoInsertText",value:function(e){return window.APP.formatContentController.insertEmptyDefaultContent(this.begin,e)}},{key:"isRangeSelection",value:function(){return this.getNormalRange().len>0}},{key:"activeCommentPara",value:function(e,t){this.activeCommentParaData=t}},{key:"activeAllComments",value:function(e){this.activeAllCommentsData=e}},{key:"hoverCommentPara",value:function(e,t){this.hoverCommentParaData=t}},{key:"inactiveCommentPara",value:function(){this.activeCommentParaData=null}},{key:"inactiveCommentAllPara",value:function(){this.activeAllCommentsData=null}},{key:"outCommentPara",value:function(){this.hoverCommentParaData=null}},{key:"enterCommentBody",value:function(e,t,n,i){var o=Object(bi.isInTempComment)()?Object(bi.getTempComment)():this.data.doc.comments.getCommentByRcId(e);this.clearActiveCtrls(),this.selContext.setSubdocType(w.Comment),this.selContext.setCommentRcId(e),this.selContext.setCommentId(t),this.selContext.setCommentType(o.comment_type),this.selContext.setIsReplyComment(n),this.selContext.setCommentEditable(i),this.selContext.setCommentPos(o.pos)}},{key:"exitCommentBody",value:function(){this.selContext.setSubdocType(w.MainText),this.selContext.setCommentRcId(""),this.selContext.setCommentId(""),this.selContext.setCommentType(""),this.selContext.setIsReplyComment(!1),this.selContext.setCommentEditable(!1),this.selContext.setCommentPos(null)}},{key:"activeShape",get:function(){var e=this.activeShapeIdxPath;if(e){var t=this.data.doc.layer.getShapeTree(this.activeShapeTreeType).childs.at(e[0]).shapeId,n=this.data.typoinfo.embedShapeRanges,i=this.data.typoinfo.shapeCardRanges,o=this.begin.position,a=this.begin.pos.line.viewPage,r=n?n.mapInRange(o,o+1,f.IT.mapToNode,f.IT.strictIntersectTest):[];i&&(r=r.concat(i.mapInRange(o,o+1,f.IT.mapToNode,f.IT.strictIntersectTest)));var s=r.find((function(e){return e.viewPage===a&&e.id===t}));return s&&Pi(s,e)}return null}},{key:"selShapeIdxPaths",get:function(){var e=this._selShapeIdxPaths;return e&&e.length?e:this.activeShapeIdxPath?[this.activeShapeIdxPath]:this.selContext.shapeIdxPathOfTextbox?[this.selContext.shapeIdxPathOfTextbox]:null}},{key:"selShapes",get:function(){var e=this.selShapeIdxPaths;if(e){var t=this.begin.pos.line.viewPage,n=t.layers,i=[],o=this.data.doc.layer.getShapeTree(this.activeShapeIdxPath?this.activeShapeTreeType:this.selContext.shapeTreeTypeOfTextbox),a=e.map((function(e){return o.childs.at(e[0]).shapeId})),r=function(t){t.forEach((function(t){a.forEach((function(n,o){n===t.id&&i.push(Pi(t,e[o]))}))}))};!function e(t){window.APP.isWebMode()||window.APP.isMobileMode()?t.shapeCards&&r(t.shapeCards):(t.topCards&&r(t.topCards),t.bottomCards&&r(t.bottomCards)),t.childLayers&&t.childLayers.forEach((function(t){e(t)}))}(n);var s=t.embed_shape_map;s&&Object.keys(s).forEach((function(t){var n=a.indexOf(parseInt(t));n>=0&&i.push(Pi(s[t],e[n]))}));for(var l=i.length-1;l>=0;--l)void 0===i[l]&&i.splice(l,1);return i.length&&i}return null}},{key:"activeTextboxShape",get:function(){var e=this;if(this.selContext.shapeIdxPathOfTextbox){var t=this.begin.pos.line.viewPage,n=t.layers,i=this.data.doc.layer.getShapeTree(this.selContext.shapeTreeTypeOfTextbox).childs.at(this.selContext.shapeIdxPathOfTextbox[0]).shapeId,o=void 0,a=function(t){t.forEach((function(t){i===t.id&&(o=Pi(t,e.selContext.shapeIdxPathOfTextbox))}))};if(function e(t){window.APP.isWebMode()||window.APP.isMobileMode()?t.shapeCards&&a(t.shapeCards):(t.topCards&&a(t.topCards),t.bottomCards&&a(t.bottomCards)),t.childLayers&&t.childLayers.forEach((function(t){e(t)}))}(n),!o){var r=t.embed_shape_map[i];o=r&&Pi(r,this.selContext.shapeIdxPathOfTextbox)}return o}return null}}]),e}(),Ei=n(1807);function Oi(e){return{border:e.border,borderSize:e.border_size,borderType:e.border_type,borderColor:e.border_color}}function xi(e){var t=e.chpx;return{border:t.getPropVal("border"),borderSize:t.getPropVal("border_size"),borderType:t.getPropVal("border_type"),borderColor:t.getPropVal("border_color")}}function Ri(e,t){return e.borderSize===t.borderSize&&e.borderType===t.borderType&&e.borderColor===t.borderColor}function Ni(e){return 0!==e.border_type}function Ai(e){return 0!==e.chpx.getPropVal("border_type")}var Di=function(){function e(t,n){l()(this,e),this.doc=t,this.glyphpool=n}return c()(e,[{key:"createEnclosure",value:function(e,t,n){var i=e.rect.top+e.baseline-t.metrics.ascent,o=i+t.metrics.height;return{rect:qe.a.initByRawRect({top:i,bottom:o,left:t.x,right:t.x+t.widthSum}),border:n}}},{key:"expandEnclosure",value:function(e,t,n){var i=t.rect.top+t.baseline-n.metrics.ascent,o=i+n.metrics.height,a=e.rect;a.top=Math.min(a.top,i),a.bottom=Math.max(a.bottom,o),a.right=n.x+n.widthSum}},{key:"createBorderForMath",value:function(e,t,n,i,o){var a=t.oMath,r=t.orgGlyphGroups,s=t.beginOffset,l=t.endOffset,u=t.x,c=t.y,h=e.range.pos+s,d=r[n].pos-h,p=i>=r.length?l:r[i].pos-h,f=d<=0&&p>=l,g=a.locateRect(d,p-d),v=u+g.x,m=v+g.width,_=f?1+e.rect.top:c+e.baseline-a.baseline+g.y,y=f?e.rect.size.height-1+e.rect.top:_+g.height;return{rect:qe.a.initByRawRect({top:_,bottom:y,left:v,right:m}),border:o}}},{key:"getFirstGlyphGroup",value:function(e){var t=this.glyphpool.getGlyphIterator(e),n=t.glyphGroup;return t.free(),n}},{key:"process",value:function(e,t){if(!(e instanceof Ei.a&&e.sublines&&e.sublines.length>0)){for(var n=[],i=void 0,o=void 0,a=0,r=t.length;a<r;++a)if(o=t[a])if(o.oMath){var s=o.orgGlyphGroups,l=o.oMath.getFirstSlice(),u=l===o.oMath?s[0]:this.getFirstGlyphGroup(l.pos);if(Ai(u)){var c=xi(u);if(i){if(Ri(c,i.border)){i.rect.right=o.x+o.widthSum;continue}n.push(i),i=null}i=this.createBorderForMath(e,o,0,s.length,c);continue}!i||Ai(s[0])&&Ri(xi(s[0]),i.border)||(n.push(i),i=null);for(var h=-1,d=void 0,p=0,f=s.length;p<f;++p){var g=s[p];if(Ai(g)){var v=xi(g);if(h<0)h=p;else if(!Ri(v,d)){if(i){var m=this.createBorderForMath(e,o,h,p,d);i.rect.right=m.rect.right,n.push(i),i=null}else n.push(this.createBorderForMath(e,o,h,p,d));h=p}d=v}else{if(0==h&&i){var _=this.createBorderForMath(e,o,h,p,d);i.rect.right=_.rect.right,n.push(i),i=null,h=-1}else h>=0&&(n.push(this.createBorderForMath(e,o,h,p,d)),h=-1);d=null}}0===h&&i?i.rect.right=o.x+o.widthSum:h>=0&&(i=this.createBorderForMath(e,o,h,s.length,d))}else if(Ni(o)){var y=Oi(o);i&&Ri(i.border,y)?this.expandEnclosure(i,e,o):(i&&n.push(i),i=this.createEnclosure(e,o,y))}else i&&(n.push(i),i=null);return i&&(n.push(i),i=null),n.length&&(e.enclosures=n),n}}},{key:"deepCopyer",value:function(e){var t=Object(He.deepCopyer)(e);return t.rect=qe.a.copy(t.rect),t}},{key:"initFromRaw",value:function(e,t){return this.process(e,t)}}]),e}(),Mi=n(5740),Li=n(3484),Fi=function(){function e(t,n){var i=this;if(l()(this,e),n){if(null!=n.offsetX&&(this.offsetX=Object(je.Ti2Px)(n.offsetX)),null!=n.x&&(this.x=Object(je.Ti2Px)(n.x)),null!=n.y&&(this.y=Object(je.Ti2Px)(n.y)),null!=n.beginOffset&&(this.beginOffset=n.beginOffset),null!=n.endOffset&&(this.endOffset=n.endOffset),n.widths){var o=[],a=0;n.widths.forEach((function(e){var t=Object(je.Ti2Px)(e);o.push(t),a+=t})),this.widths=o,this.widthSum=a}if(n.isRealAsia&&(this.isRealAsia=!0),n.metrics){var r=n.metrics;this.metrics={measureAscent:Object(je.Ti2Px)(r.measureAscent),measureDescent:Object(je.Ti2Px)(r.measureDescent),ascent:Object(je.Ti2Px)(r.ascent),descent:Object(je.Ti2Px)(r.descent),height:Object(je.Ti2Px)(r.height),external:Object(je.Ti2Px)(r.external)}}if(this.font={fontStyle:"normal",fontWeight:"normal",fontSize:"10",fontFamily:""},n.isItalic&&(this.font.fontStyle="italic"),n.isBold&&(this.font.fontWeight="bold"),null!=n.fontSize&&(this.font.fontSize=""+Object(je.Ti2Px)(n.fontSize)),null!=n.coreFontName&&(this.font.fontFamily=n.coreFontName),n.chpx){var s=n.chpx,u=s.emphasis_type;u&&(this.emphasis_type=u),(u=s.character_scale)&&(this.character_scale=u),(u=s.revision)&&(this.revision=u),null!=(u=s.font_color)&&(this.font_color=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.toString(16),i=8-n.length,o="00000000",a=o.substring(0,i),r=a+n,s=t?r.substring(6,8):r.substring(2,4),l=r.substring(4,6),u=t?r.substring(2,4):r.substring(6,8);return"#"+s+l+u}(s.font_color,!0)),(u=s.font_size_normal)&&(this.font_size_normal=u),(u=s.font_size_cs)&&(this.font_size_cs=u),(u=s.script_pos)&&(this.script_pos=u),(u=s.position)&&(this.advance_pos=u),(u=s.wo_user_id)&&(this.wo_user_id=u),(u=s.underline_type)&&(this.underline=1,this.underline_type=u,null!=s.underline_color&&(this.underline_color=new tn.a(s.underline_color).color)),(u=s.strike)&&(this.strike=u),(u=s.double_strike)&&(this.double_strike=u),this.border=0!=s.border_type,this.border_type=s.border_type,this.border_size=Math.round(Object(je.Ti2Px)(s.border_draw_width)),this.border_color=null!=s.border_color?new tn.a(s.border_color).color:"#000000",this.shading_back_color=null!=s.shading_back_color?new tn.a(s.shading_back_color).color:"#ffffff",this.shading_fill_color=null!=s.shading_fill_color?new tn.a(s.shading_fill_color).color:null,this.shading_texture=s.shading_texture,null!=s.highlight_color&&(this.highlight_color=new tn.a(s.highlight_color).colorEx),(u=s.small_caps)&&(this.small_caps=u),(u=s.caps)&&(this.caps=u)}null!=n.charFlag&&(this.charFlag=n.charFlag)}else{var c=t.glyphGroup,h=t.offsetX,d=t.x,p=t.y,f=t.beginOffset,g=t.endOffset,v=t.widths,m=t.widthsSum;this.offsetX=h,this.x=d,this.y=p,this.beginOffset=f,this.endOffset=g,this.widths=v,this.widthSum=m,this.metrics=c.metrics,c.fontMetrics&&(this.fontMetrics=c.fontMetrics);var _=c.chpx;if(c.isCombine&&(this.isCombine=!0),c.documentFields&&(this.documentFieldNames=c.documentFields.map((function(e){return e.name})),c.documentFields.some((function(e){if(e.hidden)return i.isDocumentFieldHidden=!0,!0}))),this.chpx=_,_){var y=_.getPropVal("emphasis_type");y&&(this.emphasis_type=y),(y=_.getPropVal("character_scale"))&&(this.character_scale=y),(y=_.getPropVal("font_color"))&&(this.font_color=y),(y=_.getPropVal("font_size_normal"))&&(this.font_size_normal=y),(y=_.getPropVal("font_size_cs"))&&(this.font_size_cs=y),(y=_.getPropVal("script_pos"))&&(this.script_pos=y),(y=_.getPropVal("position"))&&(this.advance_pos=y),(y=_.getPropVal("wo_user_id"))&&(this.wo_user_id=y),(y=_.underline)&&(this.underline=y,(y=_.underline_type)&&(this.underline_type=y),(y=_.underline_color)&&"#ffffffffff000000"!=y&&(this.underline_color=y)),(y=_.strike)&&(this.strike=y),(y=_.double_strike)&&(this.double_strike=y),(y=_.revision)&&(this.revision=y),this.border=_.getPropVal("border"),this.border_type=_.getPropVal("border_type"),this.border_size=_.getPropVal("border_size"),this.border_color=_.getPropVal("border_color"),this.shading_back_color=_.getPropVal("shading_back_color"),this.shading_fill_color=_.getPropVal("shading_fill_color"),this.shading_texture=_.getPropVal("shading_texture");var b=_.getProp("highlight_color");b.def||(this.highlight_color=b.val),(y=_.getPropVal("small_caps"))&&(this.small_caps=y),(y=_.getPropVal("caps"))&&(this.caps=y)}this.font=c.font,c.charInfo.isRealAsia?this.isRealAsia=!0:c.charInfo.isRtl&&(this.isRTLChar=!0),c.shape&&(this.shape=c.shape),c.shapeInfo&&(this.shapeInfo=c.shapeInfo),this.charFlag=c.charFlag,this.customCharFlag=c.customCharFlag}}return c()(e,[{key:"isVisible",value:function(){var e=this.charFlag;return 0==(e&Mi.m)&&(0==(e&Mi.C)&&(0==(this.customCharFlag&Mi.A)&&0==(this.customCharFlag&Mi.f)))}},{key:"isRevisionHidden",value:function(){return 0!=(this.customCharFlag&Mi.A)}},{key:"isEmbedDrawing",value:function(){return this.getCharRngFlag()==Li.d}},{key:"isSpace",value:function(){return this.getCharRngFlag()==Li.l}},{key:"getCharRngFlag",value:function(){return 15&this.charFlag}},{key:"isField",value:function(){return 0!=(this.charFlag&Mi.i)}},{key:"isInTOCField",value:function(){return 0!=(this.charFlag&Mi.E)}},{key:"isSpec",value:function(){return 0!=(this.charFlag&Mi.B)}},{key:"isTab",value:function(){return this.getCharRngFlag()==Li.m}},{key:"isLineBreak",value:function(){return this.getCharRngFlag()==Li.f}},{key:"isParaBreak",value:function(){return this.getCharRngFlag()==Li.h}},{key:"isTickCharBox",value:function(){return 0!=(this.customCharFlag&Mi.G)}},{key:"isTickCharSymbol",value:function(){return 0!=(this.customCharFlag&Mi.H)}},{key:"isFootnote",value:function(){return this.zone&&this.zone.isFootnote}},{key:"isEndnote",value:function(){return this.zone&&this.zone.isEndnote}},{key:"isNotePlaceholder",value:function(){return this.zone&&this.zone.isNotePlaceholder}}]),e}();var Bi=n(3334),Hi=function(){function e(t,n){l()(this,e),this.doc=t,this.glyphpool=n}return c()(e,[{key:"initEmbedShapes",value:function(e){this.isMobile=window.APP.isMobileMode()||window.APP.isWebMode(),this.linebase=e}},{key:"preProcess",value:function(e,t,n){var i=this.doc.getEmbedDrawing(t).anchor;if(i&&null!=i.shapeId){var o=i.shapeId,a=this.linebase.viewPage.embed_shape_map;if(a){var r=a[o];if(r){e.shape=r;var s=d()({},r.size);if(r.renderScale&&(s.width/=r.renderScale,s.height/=r.renderScale),r.anchor.hasVaildEffectExtents()){var l=r.visualRotation;if(0!==l){var u=qe.a.initByOriginAndSize({x:0,y:0},s);Object(Bi.b)(l,u),s.width=u.width,s.height=u.height}var c=r.anchor.effectExtents,h=c.left,p=c.top,f=c.right,g=c.bottom;s.width+=Object(je.Ti2Px)(h+f),s.height+=Object(je.Ti2Px)(p+g)}else if(r.isPresetDrawing){var v=r.innerBoundary,m=v&&v.size;m&&(m.width||m.height)&&(s=d()({},m))}else{var _=r.innerBoundary;if(_){var y=qe.a.initByOriginAndSize({x:0,y:0},s),b=r.rotation;0!==b&&Object(Bi.b)(b,y);var T=Math.min(y.left,_.left),C=Math.max(y.right,_.width),k=Math.min(y.top,_.top);s={width:C-T,height:Math.max(y.bottom,_.bottom)-k}}}r.renderScale&&(s.width*=r.renderScale,s.height*=r.renderScale),e.shapeWidth=e.isTransposeCoor?s.height:s.width}}}else console.error("[EMBED SHAPE] Get Anchor ShapeId Error")}},{key:"process",value:function(e,t,n,i){var o=n,a=e.shape;if(a){var r=d()({},a.size);a.renderScale&&(r.width/=a.renderScale,r.height/=a.renderScale);var s=0,l=0;if(a.anchor.hasVaildEffectExtents()){var u=a.visualRotation;if(0!==u){var c=qe.a.initByOriginAndSize({x:0,y:0},r);Object(Bi.b)(u,c),r.width=c.width,r.height=c.height,s=-c.left,l=-c.top}var h=a.anchor.effectExtents;r.width+=Object(je.Ti2Px)(h.left+h.right),r.height+=Object(je.Ti2Px)(h.top+h.bottom),s+=Object(je.Ti2Px)(h.left),l+=Object(je.Ti2Px)(h.top)}else if(a.isPresetDrawing){var p=a.innerBoundary,f=p&&p.size;f&&(f.width||f.height)&&(r=d()({},f),s=-p.left,l=-p.top)}else{var g=a.innerBoundary,v=g&&g.size;if(v&&(v.width||v.height)){var m=a.innerBoundary;if(m){var _=qe.a.initByOriginAndSize({x:0,y:0},r),y=a.rotation;0!==y&&Object(Bi.b)(y,_);var b=Math.min(_.left,m.left),T=Math.max(_.right,m.width),C=Math.min(_.top,m.top);r={width:T-b,height:Math.max(_.bottom,m.bottom)-C},s+=Math.max(-m.left,-_.left),l+=Math.max(-m.top,-_.top)}}}a.renderScale&&(s*=a.renderScale,l*=a.renderScale,r.width*=a.renderScale,r.height*=a.renderScale);var k=void 0,w=(i.papx||i.parent.papx).getProp("vertical_align_mode"),S=w.def&&e.isTransposeCoor?"middle":w.val,P=e.isTransposeCoor?r.width:r.height;k="top"==S||1==S?i.baseline:"middle"==S||2==S?i.baseline-P/2:i.baseline-P,e.chpx&&e.chpx.position&&(k-=Object(je.Ti2Px)(e.chpx.position)),t.y+=k,i.auto_num&&(o+=i.auto_num.line.rect.width),t.x+=s,t.y+=l,a.generateRect(t,{x:o,y:k},i)}}}]),e}(),Gi=n(3862);function Wi(e,t,n){for(var i=t,o=n-1,a=void 0;o>i;)a=e[i],e[i]=e[o],e[o]=a,++i,--o}var ji=function(){function e(){l()(this,e)}return c()(e,[{key:"orderByBidiLevel",value:function(e,t){var n=0;if(e.forEach((function(e){var t=e.bidiLevel;t&&(n=Math.max(t,n))})),0===n)return e;t.forEach((function(e){e.bidiLevel=2}));for(var i=e.filter((function(e){return void 0!==e.bidiLevel})),o=i.length,a=1;a<=n;++a){for(var r=-1,s=0;s<o;++s){i[s].bidiLevel>=a?r<0&&(r=s):r>=0&&(Wi(i,r,s),r=-1)}r>=0&&Wi(i,r,o)}return i}}]),e}(),Ui=function(){function e(t,n){l()(this,e),this.doc=t,this.glyphpool=n}return c()(e,[{key:"isSkipChar",value:function(e){var t=this.glyphpool.glyphBuff.getCharCode(e.begin),n=!1;return t!=Ne.A&&t!=Ne.r&&t!=Ne.B&&t!=Ne.l&&t!=Ne.j&&t!=Ne.k&&t!=Ne.m&&t!=Ne.i&&t!=Ne.h&&t!=Ne.d&&t!==Ne.e&&t!==Ne.b&&t!==Ne.c||(n=!0),n}},{key:"isNatureGlyph",value:function(e){var t=!1;return e.isEmbedDrawing()&&(t=!0),t}},{key:"process",value:function(e,t){for(var n=null,i=0,o=0,a=0,r=t.length;a<r;++a)if((n=t[a])&&n&&!n.isHidden()&&!n.isSpecHidden()&&n.isClusterStart()&&(n.isCharBox()||!this.isSkipChar(n))&&!this.isNatureGlyph(n)){var s=n.metrics;i=Math.max(i,s.ascent),o=Math.max(o,s.descent)}e.strongAscent=Math.max(e.strongAscent||0,i),e.strongDescent=Math.max(e.strongDescent||0,o);var l=e.parent;l&&l instanceof Ei.a&&(l.strongAscent=Math.max(l.strongAscent||0,e.strongAscent),l.strongDescent=Math.max(l.strongDescent||0,e.strongDescent))}}]),e}();function Vi(e){return e&&(e.isFootnote||e.isEndnote||e.isNotePlaceholder)}var Yi=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.doc=e,i.glyphpool=n,i.shapeTypo=new Hi(i.doc,i.glyphpool),i.coreTypoPCModeAppend=i.isHandlerCoreTypoPCMode&&new Ui(i.doc,i.glyphpool),i}return y()(t,e),c()(t,[{key:"process",value:function(e,t,n,i,o){this.shapeTypo.initEmbedShapes(e),e.papx||(e.papx=this.doc.getDataLogic("final").getPapx(t).prop);var a=e.papx;this.isRTL=a.getPropVal("bidi")&&!e.isOMathPara,this.horizontalAlign=a.getPropVal("horizontal_align_mode"),this.doc.useCoreTypo&&(window.APP.isPCMode()||window.APP.isPaginationMode())&&e.initZones();var r=e.zones;this.renderZones=this.orderByLogicDir(r),this.isRTL&&e.is_para_first&&this.processParaFirstNoteZone(r),this.glyphGroupsMap=this.getGlyphGroupsByLogicDir(r,e.viewPage.parent.mathCache,e.viewPage),this.lastEffectIndex=this.findLastEffectIndex(e);var s=this.survey(e,t,n),l=this.adapt(e,s),u=this.calcOffset(e,l);this.typo(e,l,u,o);var c=l.glyphGroupInfos;if(1==c.length&&c[0].oMath&&c[0].oMath.repeatOpLen){var h=c[0].oMath.repeatOpLen;c[0].endOffset=c[0].oMath.len+h;var d=e.viewPage.parent;d.detachLine(e),e.range.reset(t,c[0].oMath.end+h),d.attachTextLine(e)}return c}},{key:"survey",value:function(e,t,n){var i=!(e.viewPage instanceof Gi.a&&e.viewPage.isMoc),o=this.isHandlerCoreTypoPCMode,a=null;switch(this.horizontalAlign){case he.i.Adjustify:case he.i.LowAdjustify:case he.i.CenterAcross:case he.i.MiddleAdjustify:case he.i.HighAdjustify:this.getIsNeedAdjust(e)&&(a=this.isAdjustifyWordSignal.bind(this));break;case he.i.FullAdjustify:this.getIsNeedFullAdjust(e)&&(a=this.isFullAdjustifyWordSignal.bind(this))}for(var r=[],s=new Map,l=this.renderZones,u=this.glyphGroupsMap,c=0,h=0,d=this.lastEffectIndex,p=!0,f=null,g=void 0,v=void 0,m=e.lineMdInfo,_=e.range.pos,y=0,b=void 0,T=0,C=l.length;T<C;++T){var k=l[T],w=u.get(k),S=k.getGlyphBuff().getBuffs(),P=k.getPartRange(),I=P.pos+P.len,E=k.typoRange.pos-P.pos;c+=k.getLeftTypoWidth()+k.getRightTypoWidth();for(var O=0,x=w.length;O<x;++O){var R=w[O],N=R.begin,A=N+R.len,D=Math.max(P.pos,N),M=Math.min(I,A);i&&this.shapeInit(R,e),o&&this.tabInit(R,e,k.getGlyphPool(),c);var L=this.getGlyphWidths(R,D,M,E,S,m,k),F=L.widths,B=L.sum;if((T<d.zoneIndex||T==d.zoneIndex&&O<=d.groupIndex)&&(c+=B),k.isNoteZone){var H=k.textPart.getGcpRange(),G=H.pos;g=G,v=G+H.len}else if(k.isTextPartZone){var W=k.textPart.getGcpRange();if(v=(g=W.pos+N)+R.len,k.brokenBefore){var j=k.typoRange;g+=j.pos,v=O===w.length-1?g+j.len:g+R.len}if(k.brokenAfter&&O===w.length-1){var U=k.typoRange;v=W.pos+U.pos+U.len}}else k.isEqZone?(g=k.typoRange.pos+_,v=k.typoRange.pos+k.typoRange.len+_):(g=Math.max(t,N),v=Math.min(n,A));var V=0;if(M-D==1){var Y=S.at(R.begin),z=void 0;Y&&(z=Y.mi),V=z&&void 0!==z.dispOffset?z.dispOffset:0}var K=new Fi({glyphGroup:R,beginOffset:g-_,endOffset:v-_,widths:F,widthsSum:B});if(k.isNoteZone&&(K.beginPartOffset=D,K.endPartOffset=M),R.oMath&&(K.oMath=R.oMath,K.orgGlyphGroups=R.orgGlyphGroups),K.charDispOffsetX=V,R.isLayoutRTL()&&(K.isLayoutRTL=!0),R.isTab()&&(K.tabPos=R.tabPos),K.zone=k,K.isField()){if((!b||b.begin>=v||b.end<=g)&&(b=this.doc.fields.getField(g)),b&&"HYPERLINK"===b.type){var Z=this.doc.getText(b.pos,b.len);/kw:(mention|link|filelink)\S+/.test(Z)&&(K.isKWProtocolHyperlink=!0)}b&&"FORMTEXT"===b.type&&b.doc.settings.getFormFieldShadingShow()&&(K.shading_back_color="#c0c0c0")}r.push(K);var X=y++;if(R.isVisible()&&(!p||!R.isSpace())){p=!1;var q=a&&a(w,T,O,d,K,e);q&&(q.adjustify&&!k.isTranslatedZone?(h+=q.end-q.begin,s.set(X,q)):q.reset&&(h=0,f=null,s.clear()))}}this.coreTypoPCModeAppend&&this.coreTypoPCModeAppend.process(e,w)}return{totalWidth:c,adjustifyNum:h,startAdjustifyIndex:f,adjustifyMap:s,glyphGroupInfos:r}}},{key:"adapt",value:function(e,t){var n=t.adjustifyNum,i=t.startAdjustifyIndex,o=t.adjustifyMap,a=t.glyphGroupInfos,r=t.totalWidth;return e.zones.forEach((function(e){var t=e.adaptGlyphGroupInfos&&e.adaptGlyphGroupInfos(r,a);t&&(r=t.totalWidth)})),{totalWidth:r,adjustifyNum:n,startAdjustifyIndex:i,adjustifyMap:o,glyphGroupInfos:a}}},{key:"calcOffset",value:function(e,t){var n=e.rect.size.width,i=this.horizontalAlign,o=t.totalWidth,a=t.adjustifyNum,r=t.startAdjustifyIndex;e.auto_num&&(o+=e.auto_num.line.rect.size.width);var s=0,l=0;switch(i){case he.i.Right:s=n-o;break;case he.i.Center:s=(n-o)/2;break;case he.i.Adjustify:case he.i.LowAdjustify:case he.i.CenterAcross:case he.i.MiddleAdjustify:case he.i.HighAdjustify:l=a?(n-o)/a:0;break;case he.i.FullAdjustify:a?l=a?(n-o)/a:0:e.isOMathPara||(s=(n-o)/2);break;case he.i.Auto:case he.i.Left:default:s=0}return{offsetX:Math.max(s,0),adjustifyDiff:Math.max(l,0),startAdjustifyIndex:r}}},{key:"typo",value:function(e,t,n,i){var o=n.offsetX,a=this.horizontalAlign,r=n.adjustifyDiff,s=t.glyphGroupInfos,l=t.adjustifyMap,u=i.x,c=i.y,h=this.isRTL;if(e.auto_num){var d=e.auto_num.line.rect.size.width,p=e.auto_num.jcOffset;a==he.i.Center&&(p=e.auto_num.jcOffset/2),e.auto_num_pos={x:h?e.rect.right-o-d:e.rect.left+o+p,y:i.y},o+=d+p}h&&(o=e.rect.width-o),e.homePos=o;var f={ascent:0,descent:0,height:0};s.metrics=f;for(var g=!(e.viewPage instanceof Gi.a&&e.viewPage.isMoc),v=this.metricsHandler,m=function(e){if(e.oMath){var t=e.oMath.baseline,n=e.oMath.height;return{ascent:t,descent:n-t,height:n}}return e.metrics},_=0,y=s.length;_<y;++_){var b=s[_],T=l.get(_);if(T){var C=T.end-T.begin;b.widthSum+=r*C;for(var k=b.widths,w=T.begin,S=T.end;w<S;++w)k[w]+=r}if(h?o-=b.widthSum:b.zone.needAddLeftTypoWidth(b)&&(o+=b.zone.getLeftTypoWidth()),b.offsetX=o,b.x=u+o,b.y=c,v(f,m(b)),g)b.oMath?this.shapeComposeForMath(b,o,e):this.shapeCompose(b,{x:b.x,y:b.y},o,e);h||(o+=b.widthSum,b.zone.needAddRightTypoWidth(b)&&(o+=b.zone.getRightTypoWidth()))}if(s.sort((function(e,t){return e.beginOffset-t.beginOffset})),2===s.length&&s[0].oMath&&!s[1].oMath){var P=s[0].oMath.data;if(P&&P.marginRight>0){var I=P.marginRight;P.marginRight=0,P.width-=I,s[0].widthSum-=I,s[0].widths[0]-=I,o-=I,s[1].x-=I}}e.endPos=o,e.glyphGroupInfos=s}},{key:"metricsHandler",value:function(e,t){var n=e.ascent,i=e.descent,o=e.height;e.ascent=n>t.ascent?n:t.ascent,e.descent=i>t.descent?i:t.descent,e.height=o>t.height?o:t.height}},{key:"getGlyphWidths",value:function(e,t,n,i,o,a,r){var s=this;if(r.isEqZone){for(var l=r.getWidth(),u=[],c=0;c<r.typoRange.len-1;c++)u.push(0);return u.push(l),{widths:u,sum:l}}if(e.oMath){var h=e.oMath.width;return{widths:[h],sum:h}}if(n-t==1){var d=void 0;if(e.typomi)d=e.typomi;else{var p=o.at(t);d=p?p.mi:d}var f=t+i,g=(d?this.getGlyphFinalWidth(f,d.width,a):0)||e.shapeWidth||0;return{widths:[g],sum:g+this.getGlyphOffsetRight(e)}}var v=[],m=0;return o.forEach(t,n,(function(e,t,n){var o=t[n].mi,r=e+i,l=o?s.getGlyphFinalWidth(r,o.width,a):0;v.push(l),m+=l})),{widths:v,sum:m}}},{key:"getGlyphFinalWidth",value:function(e,t,n){var i=t;if(!n)return i;var o=n.dxList.find((function(t){if(t.idx==e)return t}));return o&&(i+=o.dx),i}},{key:"getGlyphOffsetRight",value:function(e){return e&&e.shapeWidth?2:0}},{key:"getLastGroup",value:function(){var e=this.glyphGroupsMap,t=this.renderZones,n=e.get(t[t.length-1]);return n[n.length-1]}},{key:"getPrevGlyphGroup",value:function(e){var t=e.groupIndex,n=e.zoneIndex,i=this.renderZones,o=i[n],a=this.glyphGroupsMap.get(o);if(t<=0&&n>0){var r=i[n-1],s=this.glyphGroupsMap.get(r);return{glyphGroup:s[s.length-1],zoneIndex:n-1,groupIndex:s.length-1}}return{glyphGroup:a[t-1],groupIndex:t-1,zoneIndex:n}}},{key:"getNextGlyphGroup",value:function(e){var t=e.groupIndex,n=e.zoneIndex,i=this.renderZones,o=i[n],a=this.glyphGroupsMap.get(o);if(t>=a.length-1&&n+1<=i.length-1){var r=i[n+1];return{glyphGroup:this.glyphGroupsMap.get(r)[0],zoneIndex:n+1,groupIndex:0}}return{glyphGroup:a[t+1],zoneIndex:n,groupIndex:t+1}}},{key:"orderByLogicDir",value:function(e){for(var t=[].concat(r()(e)),n=!this.isRTL,i=-1,o=0,a=t.length;o<a;++o){t[o].rtlText===n?i<0&&(i=o):i>=0&&(Wi(t,i,o),i=-1)}return i>=0&&Wi(t,i,t.length),t}},{key:"getGlyphGroupsByLogicDir",value:function(e,t,n){var i=this,o=this.isRTL,a=new Map,r=function(t){var n=window.APP.data.doc.getEmbedDrawing(t.begin).anchor;if(n&&null!=n.shapeId){var i=n.shapeId,o=e[0].parent.viewPage.embed_shape_map;if(o){var a=o[i];a&&(t.shape=a,t.shapeWidth=t.isTransposeCoor?a.size.height:a.size.width)}}else console.error("[EMBED SHAPE] Get Anchor ShapeId Error")},s=function(e){var t=e.pos,o=i.doc,a=void 0,r=void 0;if(e.isFootnote())a=o.footnotes.getNote(t),r=!0;else if(e.isEndnote())a=o.endnotes.getNote(t),r=!1;else{a=(r=o.getSubDocType(t)===w.Footnote)?o.footnoteBodys.getRefByPos(t):o.endnoteBodys.getRefByPos(t)}return a?Object(Yt.f)(a,r,n,o):" "};return e.forEach((function(e){for(var n=e.getGlyphGroupsForCompose(),l=[],u=0,c=n.length;u<c;++u){var h=n[u];if(h&&h.isMath()){var d=(t||window.APP.data.typoinfo.mathCache).get(h.begin,h.len,n.find((function(e){return e.isEmbedDrawing()}))?r:null,s);if(d){var p=d.pos,f=d.len+p,g=h.clone(),v=[h];g.unSetSpecHiddenFlag(),g.orgGlyphGroups=v,g.reset(p,f),g.oMath=d,n.splice(u,1,g);for(var m=u+1;m<c;){var _=n[m];if(!(_&&_.isMath()&&_.begin<f))break;v.push(_),n.splice(m,1),--c}l.push(g)}}}n=i.orderByBidiLevel(n,l),o&&(n=n.reverse()),a.set(e,n)})),a}},{key:"findLastEffectIndex",value:function(e){for(var t=this.renderZones,n=e.papx.getPropVal("word_wrap"),i=t.length-1;i>=0;--i){var o=t[i],a=this.glyphGroupsMap.get(o);if(void 0!==a&&0!==a.length){var r=a.length-1,s=void 0;if(i==t.length-1&&(s=a[r]).end-s.begin==1){var l=o.getGlyphBuff().getCharCode(s.end-1);Wn.a.isLineBreak(l)&&--r}for(;r>=0;--r)if(s=a[r],(n||!s.isSpace())&&s.isVisible())return{zoneIndex:i,groupIndex:r}}}return{}}},{key:"adjustWordForEQ",value:function(e,t,n,i,o){var a={adjustify:!1},r=e[n];if(o.zones[t].isEqZone)return i.zoneIndex!=t&&(a.adjustify=!0,a.begin=0,a.end=1),a;if(!r.isFarEast()){var s=void 0,l=void 0;if(t+1<i.zoneIndex&&(s=o.zones[t+1]),t>1&&(l=o.zones[t-1]),(s&&s.isEqZone||l&&l.isEqZone)&&n===e.length-1){var u=e[e.length-1].len;return a.adjustify=!0,a.begin=u-1,a.end=u,a}}return a}},{key:"isAdjustifyWordSignal",value:function(e,t,n,i,o,a){if(i.zoneIndex<0||i.groupIndex<0||i.zoneIndex<t||i.zoneIndex==t&&i.groupIndex<n)return{adjustify:!1};var r=e[n];if(r.isTab())return{reset:!0};var s=o.widths.length,l=r.chpx.getPropVal("fit_text_id");if(l){var u={adjustify:!1};if(n!=i.groupIndex||i.zoneIndex!==t){var c={zoneIndex:t,groupIndex:n};this.getNextGlyphGroup(c).glyphGroup.chpx.getPropVal("fit_text_id")!==l&&(u.adjustify=!0,u.begin=s-1,u.end=s)}return u}var h=this.adjustWordForEQ(e,t,n,i,a);if(h.adjustify)return h;if(r.isMath())return{adjustify:!1};if(r.isSpace())return{adjustify:!0,begin:0,end:s};var d={};if(r.isEmbedDrawing()){var p=n<i.groupIndex;return d.adjustify=p,p&&(d.begin=0,d.end=s),d}if(r.isFarEast()&&!Vi(this.renderZones[t])){if(this.isRTL){var f=0===t&&0===n,g=!(f&&1==s);d.adjustify=g,g&&(d.begin=0,d.end=f?s-1:s)}else{var v=n===i.groupIndex&&i.zoneIndex===t,m=!(v&&1==s);d.adjustify=m,m&&(d.begin=0,d.end=v?s-1:s)}return d}if(d.adjustify=!1,this.isRTL){if(0!==n||0!==t){var _={zoneIndex:t,groupIndex:n},y=this.getPrevGlyphGroup(_),b=y.glyphGroup,T=y.zoneIndex;b.isFarEast()&&!Vi(this.renderZones[T])&&(d.adjustify=!0,d.begin=s-1,d.end=s)}}else if(n!=i.groupIndex||i.zoneIndex!==t){var C={zoneIndex:t,groupIndex:n},k=this.getNextGlyphGroup(C),w=k.glyphGroup,S=k.zoneIndex;w.isFarEast()&&!Vi(this.renderZones[S])&&(d.adjustify=!0,d.begin=s-1,d.end=s)}return d}},{key:"isFullAdjustifyWordSignal",value:function(e,t,n,i,o,a){if(i.zoneIndex<0||i.groupIndex<0||i.zoneIndex<t||i.zoneIndex==t&&i.groupIndex<n)return{adjustify:!1};var r=e[n];if(r.charInfo&&r.charInfo.isArabic)return{adjustify:!1};var s=o.widths.length,l=r.chpx.getPropVal("fit_text_id");if(l){var u={adjustify:!1};return(n==i.groupIndex&&t===i.zoneIndex||this.getNextGlyphGroup({zoneIndex:t,groupIndex:n}).glyphGroup.chpx.getPropVal("fit_text_id")!==l)&&(u.adjustify=!0,u.begin=s-1,u.end=s),u}if(Vi(this.renderZones[t]))return{adjustify:!1};if(r.isTab())return{reset:!0};var c=this.adjustWordForEQ(e,t,n,i,a);if(c.adjustify)return c;if(r.isMath())return{adjustify:!1};if(r.isSpace())return{adjustify:!0,begin:0,end:s};var h={};if(r.isEmbedDrawing()){var d=n<i.groupIndex;return h.adjustify=d,d&&(h.begin=0,h.end=s),h}if(this.isRTL){var p=0===t&&0===n,f=!(p&&1==s);h.adjustify=f,f&&(h.begin=0,h.end=p?s-1:s)}else{var g=t===i.zoneIndex&&n===i.groupIndex,v=!(g&&1==s);h.adjustify=v,v&&(h.begin=0,h.end=g?s-1:s)}return h}},{key:"getIsNeedAdjust",value:function(e){if(e.isOMathPara)return!1;if(e.inEqZone)return!1;var t=this.getLastGroup();if((!t||t.end-t.begin<=1)&&this.renderZones.length<=1&&this.glyphGroupsMap.get(this.renderZones[0]).length<=1)return!1;var n=e.zones[e.zones.length-1],i=n.getPartRange(),o=i.pos+i.len,a=n.getGlyphBuff().getCharCode(o-1);return!Wn.a.isLineBreak(a)}},{key:"getIsNeedFullAdjust",value:function(e){return!e.isOMathPara&&(e.zones.length>1||this.glyphGroupsMap.get(e.zones[0]).length>1||this.getLastGroup().len>1)}},{key:"tabInit",value:function(e,t,n,i){e.isTab()&&(e.tabPos=i,n.glyphBuff.getMi(e.pos)&&(e.tabPos=i))}},{key:"shapeInit",value:function(e,t){if(e.isEmbedDrawing()&&!e.isHidden()&&!e.isRevisionHidden()){var n=e.begin,i=Math.min(t.rect.width,t.parent.rect.width);this.shapeTypo.preProcess(e,n,i)}}},{key:"shapeCompose",value:function(e,t,n,i){e.isEmbedDrawing()&&e.isVisible()&&this.shapeTypo.process(e,t,n,i)}},{key:"shapeComposeForMath",value:function(e,t,n){var i=e.oMath,o=i.getEmbeds(),a=n.rect.top+n.baseline-i.baseline;o&&o.forEach((function(t){var i=t.rectForTopMath&&t.rectForTopMath(),o={x:e.x+(i?i.x:0),y:a+(i?i.y:0)};t.data.shape.generateRect(o,o,n)}))}},{key:"processParaFirstNoteZone",value:function(e){for(var t=0,n=e.length;t<n;++t){var i=e[t];if(!i.isNoteZone)break;this.renderZones.splice(this.renderZones.indexOf(i),1),this.renderZones.splice(t,0,i)}}},{key:"isHandlerCoreTypoPCMode",get:function(){return this.doc.useCoreTypo&&(window.APP.isPCMode()||window.APP.isPaginationMode())}}]),t}(ji),zi=n(1590),Ki=n(4113),Zi=n(2503),Xi=n(4582),qi=Zi.alphabetic,Ji=Zi.middle,Qi=Zi.bottom,$i=function(e){function t(){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return y()(t,e),c()(t,[{key:"init",value:function(){we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this),this.strike=!0,this.strikeColor=Ki.a,this.revisionDeletion=!1,this.revisionInsertion=!1,this.revisionFormating=!1,this.revisionUserId="",this.revisionUser=""}},{key:"getItem",value:function(){return Object.assign({strikeType:this.strikeType,strikeColor:this.strikeColor,strikeLineWidth:this.strikeLineWidth,revisionDeletion:this.revisionDeletion,revisionInsertion:this.revisionInsertion,revisionFormating:this.revisionFormating,revisionUserId:this.revisionUserId,revisionUser:this.revisionUser},we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getItem",this).call(this))}}]),t}(Ki.b),eo=function(e){function t(){l()(this,t);var e=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.preInfo={strikeColor:Ki.a,strikeType:"single",fontSize:0,scriptPos:0,revisionDeletion:!1,revisionUserId:"",revisionUser:""},e}return y()(t,e),c()(t,[{key:"initItem",value:function(){this.item=new $i}},{key:"recordPreInfo",value:function(e){Object.assign(this.preInfo,{strikeColor:e.strikeColor,strikeType:e.strikeType,fontSize:e.fontSize,scriptPos:e.scriptPos,revisionDeletion:e.revisionDeletion,revisionUserId:e.revisionUserId,revisionUser:e.revisionUser})}},{key:"isType",value:function(e){return!e.isShape&&(e.revisionDeletion||e.strike||e.doubleStrike)}},{key:"isDifferent",value:function(e){return this.preInfo.revisionDeletion!==e.revisionDeletion||e.revisionDeletion?this.preInfo.revisionDeletion!==e.revisionDeletion||this.preInfo.fontSize!==e.fontSize||this.preInfo.scriptPos!==e.scriptPos||this.preInfo.revisionUserId!==e.revisionUserId||this.preInfo.revisionUser!==e.revisionUser:this.preInfo.revisionDeletion!==e.revisionDeletion||this.preInfo.strikeColor!==e.strikeColor||this.preInfo.strikeType!==e.strikeType||this.preInfo.fontSize!==e.fontSize||this.preInfo.scriptPos!==e.scriptPos||this.preInfo.revisionUser!==e.revisionUser||this.preInfo.revisionUserId!==e.revisionUserId}},{key:"moveNext",value:function(e){we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"moveNext",this).call(this,e),this.item.strikeType=e.strikeType,this.item.strikeColor=e.strikeColor,this.item.strikeLineWidth=e.strikeLineWidth,this.item.revisionDeletion=e.revisionDeletion,this.item.revisionInsertion=e.revisionInsertion,this.item.revisionFormating=e.revisionFormating,this.item.revisionUserId=e.revisionUserId,this.item.revisionUser=e.revisionUser}},{key:"calcYPos",value:function(e){var t=e.y,n=e.metrics,i=e.scriptPos,o=e.vertAlignMode,a=i>0||i<0?Xi.a:1,r=n.measureAscent*a,s=n.measureDescent*a;switch(o){case qi:t-=r;break;case Ji:t-=(r+s)/2;break;case Qi:t-=r+s}return t+=(r+s)/2,Object(Xi.b)(i,o,n,t).scriptPosY}}]),t}(Ki.c),to=n(7211),no=new to.default,io=new eo,oo=function(){function e(t,n){l()(this,e),this.doc=t,this.glyphpool=n}return c()(e,[{key:"process",value:function(e,t){if(!(e instanceof Ei.a&&e.sublines&&e.sublines.length>0||e.tablecells)){var n=t.filter((function(t){return t.zone.renderWithOutLine(e)}));this._process(e,n)}}},{key:"_process",value:function(e,t){no.init(),io.init();for(var n=void 0,i=!1,o=void 0,a=0,r=t.length;a<r;++a){var s=t[a],l=s.oMath,u=l&&s.orgGlyphGroups&&s.orgGlyphGroups.find((function(e){return e.isVisible()}));if((s&&s.isVisible()||u)&&(!s.zone||!s.zone.isEqZone||s.zone.error)){var c=!l&&s.revision,h=s.shape||s.shapeInfo,d=s.isSpec()&&Wn.a.isPageBreak(this.glyphpool.glyphBuff.getCharCode(s.beginOffset+e.range.pos)),p=d?0:u?u.chpx.underline:s.underline,f=!d&&!l&&(!h&&s.strike),g=!d&&!l&&(!h&&s.double_strike);if(c||p!==zi.wpsUnderlineNone||f||g){if(void 0===o){for(var v=e.papx||e.parent.papx,m=e.parent,_=m.textflow;m&&!_;)_=(m=m.parent).textflow;var y=_?_.corX:"T2B";o=v.vertical_align_mode||("T2B"===y||"B2T"===y?Zi.middle:Zi.alphabetic)}var b=this.doc.viewSettings.getRevisionsShowMarkup(),T=s.beginOffset+e.range.pos,C=s.endOffset+e.range.pos,k=b&&c&&c.insert,w=b&&c&&c.delete,S=b&&c&&c.format,P=(k||w||S||{}).userID,I=(k||w||S||{}).user,E=Object(je.Ti2Px)(s.font_size_normal||s.font_size_cs)||14,O=.04*E||1,x=s.x,R=s.widthSum;if(l){var N=l.getContentRect();x+=N.x,R=N.width}var A={metrics:s.metrics,scriptPos:s.script_pos,fontSize:E,x:x,y:s.y,widthSum:R,isShape:h,beginPosition:T,endPosition:C,underline:p,underlineType:p?u?u.chpx.underline_type:s.underline_type:zi.wpsUnderlineNone,underlineColor:(u?u.chpx.underline_color:s.underline_color)||(u?u.chpx.font_color:s.font_color)||"#000",underlineWidth:O,strike:f,doubleStrike:g,strikeType:!0===f?"single":!0===g?"double":"single",strikeColor:s.font_color||"#000",strikeLineWidth:O,revisionInsertion:!!k,revisionDeletion:!!w,revisionFormating:S,revisionUserId:P,revisionUser:I,vertAlignMode:o,isLast:a===r-1};no.process(A),io.process(A),i=!0}else i&&(n||(n={underlineType:zi.wpsUnderlineNone,strike:f,doubleStrike:g,revisionInsertion:!1,revisionDeletion:!1,revisionFormating:!1}),no.process(n),io.process(n))}}e.underlineInfos=no.getItems(e),e.strikeInfos=io.getItems()}}]),e}(),ao=function(){function e(t,n){l()(this,e),this.doc=t,this.glyphpool=n,this.shadingBackColorInfos=[],this.highlightColorInfos=[],this.coopSelColorInfos=[],this.documentFields=[]}return c()(e,[{key:"isInfoConsistent",value:function(e,t){var n=Object.keys(),i=Object.keys();return n.length==i.length&&n.every((function(n){return e[n]===t[n]}))}},{key:"updateColorBlock",value:function(e,t,n,i,o,a){var r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=t.x,l=t.widthSum,u=t.endOffset+this.linebase.range.pos,c=t.isLayoutRTL,h=!e||o.maxPos!==t.beginOffset+this.linebase.range.pos||c!=o.isLayoutRTL||(c?Math.abs(s+l-o.range.left)>.5:Math.abs(s-o.range.right)>.5),p=s,f=s;!isNaN(s)&&l&&(f+=l),r&&0===l&&Wn.a.isLineBreak(this.glyphpool.glyphBuff.getCharCode(t.endOffset+this.linebase.range.pos-1))&&(c?p-=8:f+=8),h?i.push(d()({},a,{maxPos:u,range:{left:p,right:f},isLayoutRTL:c})):(o.maxPos=u,c?o.range.left=p:o.range.right=f)}},{key:"addColorBlockForOMath",value:function(e,t,n,i,o,a){var r=e.oMath,s=e.orgGlyphGroups,l=e.beginOffset,u=e.endOffset,c=e.x,h=e.y,p=this.linebase.range.pos+l,f=s[t].pos-p,g=n>=s.length?u:s[n].pos-p,v=r.locateRect(f,g-f),m=c+v.x,_=m+v.width,y=d()({},i,{maxPos:this.linebase.range.pos+u,range:{left:m,right:_}});a||(y.range.top=h+this.linebase.baseline-r.baseline+v.y-this.linebase.rect.top,y.range.bottom=y.range.top+v.height),y.color&&"#ffffffffff000000"==y.color||o.push(y)}},{key:"getFirstGlyphGroup",value:function(e){var t=this.glyphpool.getGlyphIterator(e),n=t.glyphGroup;return t.free(),n}},{key:"processMath",value:function(e,t,n,i,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=e.orgGlyphGroups,s=r.length,l=-1,u=null,c=null;if(a){var h=e.oMath.getFirstSlice(),d=h===e.oMath?r[0]:this.getFirstGlyphGroup(h.pos);t(d)&&(c=n(d))}for(var p=0;p<s;++p){var f=r[p];if(t(f)){var g=n(f);l<0?l=p:i(g,u)||(this.addColorBlockForOMath(e,l,p,u,o,!1),l=p),u=g}else c?(l<0?l=p:i(c,u)||(this.addColorBlockForOMath(e,l,p,u,o,!1),l=p),u=c):(l>=0&&(this.addColorBlockForOMath(e,l,p,u,o,0===l),l=-1),u=null)}l>=0&&this.addColorBlockForOMath(e,l,s,u,o,!0)}},{key:"processShadingBackColor",value:function(e,t){if(e.oMath)this.processMath(e,(function(e){var t=e.chpx,n=t.getPropVal("shading_back_color"),i=t.getPropVal("shading_fill_color");return!("#ffffff"==n&&!i)}),(function(e){var t=e.chpx;return{shadingBackColor:t.getPropVal("shading_back_color"),shadingFillColor:t.getPropVal("shading_fill_color"),shadingTexture:t.getPropVal("shading_texture")}}),(function(e,t){return e.shadingBackColor===t.shadingBackColor&&e.shadingFillColor===t.shadingFillColor&&e.shadingTexture===t.shadingTexture}),this.shadingBackColorInfos,!0);else{var n=e.shading_back_color,i=e.shading_fill_color;if("#ffffff"!=n||i){var o=e.shading_texture,a=this.shadingBackColorInfos.length-1,r=this.shadingBackColorInfos[a],s=r&&r.shadingBackColor==n&&r.shadingFillColor==i;this.updateColorBlock(s,e,t,this.shadingBackColorInfos,r,{shadingBackColor:n,shadingFillColor:i,shadingTexture:o})}}}},{key:"processDocumentField",value:function(t,n){if(t.oMath)this.processMath(t,(function(e){return e.documentFields}),(function(e){return{documentFieldNames:e.documentFields.map((function(e){return e.name}))}}),(function(t,n){return e._documentFieldNamesEqual(t.documentFieldNames,n.documentFieldNames)}),this.documentFields);else{var i=t.documentFieldNames;if(i){var o=this.documentFields.length-1,a=this.documentFields[o],r=a&&e._documentFieldNamesEqual(a.documentFieldNames,i);this.updateColorBlock(r,t,n,this.documentFields,a,{documentFieldNames:i},!0)}}}},{key:"processHighlightColor",value:function(t,n){if(t.oMath)this.processMath(t,(function(e){return!e.chpx.getProp("highlight_color").def}),(function(e){return{color:e.chpx.getPropVal("highlight_color")}}),(function(e,t){return e.color===t.color}),this.highlightColorInfos,!0);else{var i=t.highlight_color;if(i&&"#ffffffffff000000"!=i){var o=this.highlightColorInfos.length-1,a=this.highlightColorInfos[o],r=t.fontMetrics||t.metrics,s=a&&a.color==i&&e.isMetricsEqual(a.metrics,r);this.updateColorBlock(s,t,n,this.highlightColorInfos,a,{color:i,metrics:r})}}}},{key:"_getUserIdByStyleTag",value:function(e){var t=ni.a.styleTags.find((function(t){return t.tagid===e}));if(t)return t.userid}},{key:"processCoopSelColor",value:function(t,n){if(t.oMath)this.processMath(t,(function(e){return e.wo_user_id}),(function(e){return{tagid:e.wo_user_id}}),(function(e,t){return e.tagid===t.tagid}),this.coopSelColorInfos);else{var i=this.coopSelColorInfos.length-1,o=this.coopSelColorInfos[i],a=t.fontMetrics||t.metrics,r=t.wo_user_id,s=o&&o.tagid==r&&e.isMetricsEqual(o.metrics,a),l={tagid:r,metrics:a};this.updateColorBlock(s,t,n,this.coopSelColorInfos,o,l)}}},{key:"process",value:function(e,t){var n=t.filter((function(t){return t.zone.renderWithOutLine(e)}));this._process(e,n)}},{key:"_process",value:function(e,t){var n=!1;this.linebase=e;for(var i=0,o=t.length;i<o;++i){var a=t[i],r=t[i+1],s=a.script_pos;(s<0||s>0)&&(n=!0),this.processCoopSelColor(a,r),this.processHighlightColor(a,r),this.processShadingBackColor(a,r),this.processDocumentField(a,r)}this.shadingBackColorInfos.length&&(e.shadingBackColorInfos=this.shadingBackColorInfos,this.shadingBackColorInfos=[]),this.highlightColorInfos.length&&(e.highlightColorInfos=this.highlightColorInfos,this.highlightColorInfos=[]),this.coopSelColorInfos.length&&(e.coopSelColorInfos=this.coopSelColorInfos,this.coopSelColorInfos=[]),this.documentFields.length?(e.documentFields=this.documentFields,this.documentFields=[]):delete e.documentFields;var l=e.papx;l&&l.shading_back_color&&(e.shading_back_color=l.shading_back_color),this.highlightColorInfos.hasScriptPos=n,this.shadingBackColorInfos.hasScriptPos=n,this.coopSelColorInfos.hasScriptPos=n}},{key:"processCoolSel",value:function(e,t){var n=!1;this.linebase=e;for(var i=0,o=t.length;i<o;++i){var a=t[i],r=t[i+1],s=a.script_pos;(s<0||s>0)&&(n=!0),this.processCoopSelColor(a,r)}var l=void 0;return this.coopSelColorInfos.length&&(l=this.coopSelColorInfos,this.coopSelColorInfos=[],l.hasScriptPos=n),l}}],[{key:"isMetricsEqual",value:function(e,t){return!(!e||!t)&&(e.ascent==t.ascent&&e.descent==t.descent)}},{key:"_documentFieldNamesEqual",value:function(e,t){if(e.length!=t.length)return!1;for(var n=0,i=e.length;n<i;++n)if(e[n]!=t[n])return!1;return!0}}]),e}(),ro=n(626),so=n(6116),lo=function(){function e(t){l()(this,e),this.doc=t}return c()(e,[{key:"process",value:function(e){var t=e.range,n=t.pos,i=t.len,o=n+i,a=e.glyphGroupInfos,r=this.doc.documentFields.getFields({begin:n,end:o});if(delete e.documentFieldBrackets,r&&r.length){var s={};r.forEach((function(e){var t=e._node,i=t.pos,r=t.len,l=t.name,u=i+r;if(0===r){s.cursor||(s.cursor=[]);var c=Object(so.a)(i-n,a).pos;s.cursor.push({name:l,pos:c})}else i>=n&&i<o&&(s.start||(s.start=[]),s.start.push(l)),u>n&&u<=o&&(s.end||(s.end=[]),s.end.push(l))})),(s.cursor||s.start||s.end)&&(e.documentFieldBrackets=s)}}}]),e}(),uo=function(){function e(t,n){l()(this,e),this.doc=t,this.glyphpool=n,this.enclosurer=new Di(this.doc,this.glyphpool),this.linestyle=new oo(this.doc,this.glyphpool),this.colorblock=new ao(this.doc,this.glyphpool),this.documentFieldBracket=new lo(this.doc),this.setTypoMode()}return c()(e,[{key:"setTypoMode",value:function(e){this.chartypo=new Yi(this.doc,this.glyphpool)}},{key:"appendEmbedShapes",value:function(e){this.embedShapes=e}},{key:"process",value:function(e,t,n){if(this.doc.useCoreMeasure)return!1;if(e.range.len<=0)return!1;if(!e.isUpdateRequired&&!window.APP.forceCompose)return!1;var i=this.glyphpool,o=e.range.pos,a=o+e.range.len,r=i.glyphBuff,s=this.chartypo.process(e,o,a,r,n);return this.enclosurer.process(e,s),this.linestyle.process(e,s),this.colorblock.process(e,s),this.documentFieldBracket.process(e),e.isUpdateRequired=!1,this.doc.useCoreTypo&&e.renderInfo&&this.expireRenderInfo(e),!0}},{key:"expireRenderInfo",value:function(e){for(var t=e,n=null;t;){for(t.renderInfo&&(t.renderInfo.expired=!0),n=t.parent;n;)n.renderInfo&&(n.renderInfo.expired=!0),n=(t=n).parent;t=t.outer}}},{key:"initGlyphGroupInfosFromRaw",value:function(e,t){var n=[],i=!1,o={ascent:0,descent:0,height:0};n.metrics=o,e.glyphGroupInfos&&e.glyphGroupInfos.forEach((function(e){var a=new Fi(null,e);!i&&a.wo_user_id&&(i=!0),a.isEmbedDrawing()&&(t.viewPage.glyphGroupInfoForEmbed||(t.viewPage.glyphGroupInfoForEmbed=[]),t.viewPage.glyphGroupInfoForEmbed.push({glyphGroupInfo:a,linebase:t})),n.push(a),o.ascent=Math.max(o.ascent,a.metrics.ascent),o.descent=Math.max(o.descent,a.metrics.descent),o.height=Math.max(o.height,a.metrics.height)})),t.glyphGroupInfos=n,this.enclosurer.process(t,n),this.colorblock.process(t,n),this.linestyle.process(t,n)}},{key:"linkEmbed",value:function(e){var t=this.chartypo.shapeTypo;e.forEach((function(e){var n=e.glyphGroupInfo,i=e.linebase;t.initEmbedShapes(i),t.preProcess(n,n.beginOffset+i.range.pos);var o=ro.a.add(i.position2parent,i.offset4child),a=o.x+n.offsetX+n.x,r=o.y;t.process(n,{x:a,y:r},n.offsetX,i)}))}}]),e}(),co=function(){function e(t){l()(this,e),t.attachObserver(this),this.ranges=new f.ITToolkit(f.IT.upper,f.IT.NonIntersect)}return c()(e,[{key:"attachAutoNum",value:function(e){this.ranges.attachNode(e)}},{key:"detachAutoNum",value:function(e){this.ranges.detachNode(e)}},{key:"collectAutoNums",value:function(e){var t=e.begin,n=e.end;return this.ranges.mapInRange(t,n,f.IT.mapToNode,f.IT.strictIntersectTest)}},{key:"onInsertText",value:function(e,t,n,i,o){this.ranges.expand(t,n.length)}},{key:"onBeforeDeleteText",value:function(e,t,n){var i=t,o=t+n.length,a=0,r=0;this.ranges.mapInRange(i,o,f.IT.mapToNode,(function(e,t){return a=t.begin,r=t.end,i<a&&a<=o||i<r&&r<=o})).forEach((function(e){e.space.service.deleted.add(e)}))}},{key:"onDeleteText",value:function(e,t,n){this.ranges.remove(t,n.length)}}]),e}(),ho=n(3855);function po(e,t,n){var i=n.getOverrideAutoNum(e);if(!i)return null;var o=i.overrideLevels;if(t>=o.length)return null;var a=o[t].overrideFormat;return{listId:e,level:t,overrideStart:ho.e&a,overrideLevel:ho.b&a}}var fo=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l()(this,e),this.init(t,n)}return c()(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.level=e,this.index=0,this.isVirtual=t}},{key:"setList",value:function(e){this.list=e}},{key:"toString",value:function(){for(var e="",t=this.level;t>1;)e+="   ",t--;return t&&(e+="|--"),e+"◻:["+(this.level+1)+", "+this.index+"]up["+(this.up&&this.up.pos)+"]"}},{key:"up",get:function(){return this.list.getParentAutoNum(this)}}]),e}(),go=function(){function e(t,n,i,o,a,r){l()(this,e),this.init(t,n,i,o,a,r)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"AutoNumNodeBase",base:fo,methodName:"init"},{baseName:"ITRange",base:f.ITRange,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i,o,a){var r=Math.min(o.levels.length-1,i);this.mixin_AutoNumNodeBase_init(r),this.mixin_ITRange_init(e.pos,e.pos+e.len),this.index=-1,this.format=o,this.listId=t,this.rawListId=n,this.space=a}},{key:"setOverridInfo",value:function(e){this.overrideInfo=e}},{key:"getPrevOfSpace",value:function(){for(var e=this.getPrevNode();e.nonTree()&&e.space!==this.space;)e=e.getPrevNode();return e.nonTree()?e:null}},{key:"getRealPrev",value:function(){return this.list.getRealPrev(this)}},{key:"getRealNext",value:function(){return this.list.getRealNext(this)}},{key:"toString",value:function(){for(var e="",t=this.level;t>1;)e+="   ",t--;return t&&(e+="|--"),e+"◼:"+this.formatText+"["+this.pos+":"+this.level+":"+this.index+"]up["+(this.up&&this.up.pos)+"]"}},{key:"nfc",get:function(){return this.format.levels[this.level].nfc}},{key:"followChar",get:function(){return this.format.levels[this.level].charFollow}},{key:"justifyCode",get:function(){return this.format.levels[this.level].jc}},{key:"text",get:function(){return this.formatText||(this.formatText=this.space.service.formatAutoNumNode(this)),this.formatText}}]),e}();function vo(e,t){var n=t.service.mgr,i=e.prop.getPropVal("list_id"),o=e.prop.getPropVal("list_level"),a=n.findAutoNum(i);if(!a)return null;var r=po(i,o,n),s=new go(e,a.listId,i,o,a,t);return s.setOverridInfo(r),s}R.a.mix(go,fo,f.ITRange);var mo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;l()(this,e),this._next=t,this._head=t||this}return c()(e,[{key:"insert",value:function(e,t){t._next=e._next,e._next=t}},{key:"insertList",value:function(e,t,n){n._next=e._next,e._next=t._next}},{key:"delete",value:function(e,t){console.assert(e._next===t),e._next=t._next,t._next=null}},{key:"deleteList",value:function(e,t,n){e._next=n._next,n._next=null}},{key:"push",value:function(e){this.insert(this.head,e)}},{key:"pop",value:function(){var e=this.head._next;return e&&this.delete(this.head,e),e}},{key:"find",value:function(e){for(var t=this.head._next;t&&!e(t);)t=t._next;return t}},{key:"clear",value:function(){this._next=null}},{key:"head",get:function(){return this._head}}]),e}(),_o=function(){function e(){l()(this,e),this.isHead=!0,this._next=null,this._prev=null}return c()(e,[{key:"insert",value:function(e,t){var n=e._next;t._prev=e,t._next=n,e._next=t,n&&(n._prev=t)}},{key:"delete",value:function(e,t){var n=t._next;t._next=t._prev=null,e._next=n,n&&(n._prev=e)}},{key:"find",value:function(e){for(var t=this._next;t&&e(t);)t=t._next;return t}},{key:"some",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.head,n=t._next;n&&!e(n);)n=n._next}},{key:"rsome",value:function(e,t){for(var n=t._prev;!n.isHead&&!e(n);)n=n._prev}},{key:"head",get:function(){return this}}]),e}(),yo=function(){function e(t){l()(this,e),this._parent=null,this._childs=[],this._data=t,this._index=-1}return c()(e,[{key:"getParent",value:function(){return this._parent}},{key:"isOrphan",value:function(){return!this._parent||this._parent.getChildCount()<=this._index}},{key:"getChildCount",value:function(){return this._childs.length}},{key:"getChilds",value:function(){return this._childs}},{key:"getFirstChild",value:function(){return this._childs[0]}},{key:"getLastChild",value:function(){return this._childs[this._childs.length-1]}},{key:"getPrevChild",value:function(e){return this._childs[e.getIndex()-1]}},{key:"getNextChild",value:function(e){return this._childs[e.getIndex()+1]}},{key:"getIndex",value:function(){return this._index}},{key:"spliceChild",value:function(e){return this._childs.splice(e)}},{key:"concatChild",value:function(e){return this._childs=this._childs.concat(e)}},{key:"getRoot",value:function(){for(var e=this;e._parent;)e=e._parent;return e}},{key:"getLevel",value:function(){return this.getAutoNum().level}},{key:"getAutoNum",value:function(){return this._data}},{key:"show",value:function(){var e=this.getAutoNum().toString()+"\n";return this.getChilds().forEach((function(t){e+=t.show()})),e}},{key:"makesureChild",value:function(t){if(!this._childs.length){var n=t,i=this.getLevel()+1;i&&(n=this.getAutoNum()).level<0&&(n=t);var o=n,a=o.list,r=o.overrideInfo,s=o.space,l=o.format,u=new fo(i,!0);u.setList(a),u.space=s,u.format=l,u.link=t.link||t,r&&(u.overrideInfo=po(r.listId,i,s.service.mgr)),this.addChild(e.makeTreeNode(u))}}},{key:"addChild",value:function(e){var t=this.getChilds().length;if(t){var n=this.getLastChild();n.getAutoNum().isVirtual&&!n.getChilds().length&&this._childs.pop()}return!(!(t=this.getChilds().length)||!e.getAutoNum().isVirtual)||(this._addChild(e),e.update())}},{key:"merge",value:function(e,t){if(this.getLevel()===e.getLevel()+1){var n=!1;return e.addChild(this)&&(t(this),this.spliceChild(0).forEach((function(n){n.merge(e,t)})),n=!0),n}return e.makesureChild(this.getAutoNum()),this.merge(e.getLastChild(),t)}},{key:"update",value:function(){var e=this.getAutoNum(),t=e.format.levels[e.level]||{},n=this.getParent().getPrevChild(this),i=n&&n.getAutoNum();!i&&t.noRestart&&e.list.rsome((function(n){return n.level<=t.restartAfterLevel-1||n.level===e.level&&(i=n,!0)}),e.link||e);var o=this._calcOverrideAutoNum(e),a=-1!=o;if(!a)if(i)o=i.index+1,i.usingOverride&&(a=!0,e.overrideInfo=i.overrideInfo);else{o=0;for(var r=this.getParent();r.getLevel()>=0;){var s=r.getAutoNum();if(s.overrideInfo){a=!0,e.overrideInfo=s.overrideInfo;break}r=r.getParent()}}return this.isUpdate=this.isParentUpdate(),e.usingOverride=a,e.index!==o&&(e.index=o,this.isUpdate=!0),this.isUpdate&&(e.formatText=null),this.isUpdate}},{key:"isParentUpdate",value:function(){var e=this.getParent();return this._oldParent!==e||e.isUpdate}},{key:"_addChild",value:function(e){return this._childs.push(e),e._parent&&(e._oldParent=e._parent),e._parent=this,e._index=this._childs.length-1,e._index}},{key:"_calcOverrideAutoNum",value:function(e){if(!e.overrideInfo||!e.overrideInfo.overrideStart)return-1;var t=e.list.overrides,n=e.overrideInfo.listId;if(t.has(n)){var i=t.get(n).begin;if(!(e.begin<=i))return-1;t.delete(n)}var o=e.overrideInfo.level,a=e.space.service.mgr.getOverrideAutoNum(n);if(a&&o<a.overrideLevels.length&&a.overrideLevels[o].overrideFormat&ho.e)return t.set(e.overrideInfo.listId,e.link||e),0;return-1}},{key:"free",value:function(){}}],[{key:"makeTreeNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=new e(t);return t&&(t._tree=n),n}}]),e}(),bo=function(e){function t(e,n,i){l()(this,t);var o=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null));return o.id=t.id++,o.key=e,o.mgr=i,o.isGroup=!0,console.assert(n.length),o._childs=n,o._level=o._childs[0].getLevel(),o}return y()(t,e),c()(t,[{key:"getLevel",value:function(){return this._level}},{key:"has",value:function(e){var t=e.getIndex();return t>=this.getFirstChild().getIndex()&&t<=this.getLastChild().getIndex()}},{key:"forEach",value:function(e){this._childs.forEach(e)}},{key:"spliceChild",value:function(e){var t=e-this.getFirstChild().getIndex();return this._childs.splice(t)}},{key:"merge",value:function(e,t){var n=this.getChildCount();if(console.assert(n),!n)return!1;if(this.getLevel()===e.getLevel()+1){var i=!1;return this._childs.shift().merge(e,t)?(this._childs.forEach((function(n){n.merge(e,t)})),i=!0):e.concatChild(this._childs),this._childs=[],i}return e.makesureChild(this.getFirstChild().getAutoNum()),this.merge(e.getLastChild(),t)}},{key:"free",value:function(){this.mgr.freeTreeNodeGroup(this)}}]),t}(yo);bo.id=0;var To=function(){function e(t,n){l()(this,e),this.updateNodes=[],this.list=n,this._branchs=new mo(yo.makeTreeNode(t)),this.onAutoNumChanged=function(){},this._treeNodeGroups=new Map,this.orphanManager=new Co(this),this.opTime=0}return c()(e,[{key:"insertAutoNum",value:function(e,t){var n=performance.now();this._insert(e._tree,yo.makeTreeNode(t)),this.opTime+=performance.now()-n}},{key:"deleteAutoNum",value:function(e,t){var n=performance.now();this._delete(e._tree,t._tree),this.opTime+=performance.now()-n}},{key:"getParentAutoNum",value:function(e){return e._tree.getParent().getAutoNum()}},{key:"build",value:function(){var e=performance.now();this._build(),e=performance.now()-e,console.log("ANL elapse: operate: "+this.opTime.toFixed(2)+", build: "+e.toFixed(2)+", total: "+(this.opTime+e).toFixed(2)),this.opTime=0,this._fireChanged(),console.assert(0===this.orphanManager.groups.size)}},{key:"on",value:function(e){e&&(this.onAutoNumChanged=e)}},{key:"_fireChanged",value:function(){var e=this;this.updateNodes.forEach((function(t){var n=t.getAutoNum();t.isUpdate=!1,n.isVirtual||e.onAutoNumChanged(t.getAutoNum())})),this.updateNodes=[]}},{key:"_insert",value:function(e,t){this.branchs.insert(this.slice(e),t)}},{key:"_delete",value:function(e,t){for(var n=this.slice(e),i=this.slice(t),o=n._next;o&&(o.isGroup&&this.orphanManager.freeTreeNodeGroup(o),o!==i);)o=o._next;this.branchs.deleteList(n,n._next,i)}},{key:"_build",value:function(){for(var e=this.branchs.head,t=this.branchs.pop();t;)this.merge(e,t),t=this.branchs.pop()}},{key:"slice",value:function(e){var t=new mo,n=t,i=function(e){t.insert(n,e),n=e};this._spliceChild(e,0,i);for(var o=e;o.getParent();){var a=o.getParent();if(o.isOrphan()&&(a=this.orphanManager.findTreeNodeGroup(o)),!a)break;this._spliceChild(a,o.getIndex()+1,i),o=a}return this.branchs.insertList(o,t.head,n),o}},{key:"_spliceChild",value:function(e,t,n){var i=e.spliceChild(t);if(i.length>=2){var o=this.orphanManager.makeTreeNodeGroup(e,i);n(o)}else i.forEach((function(e){e._oldParent=e.getParent(),e._parent=null,n(e)}))}},{key:"merge",value:function(e,t){var n=this;t.merge(e,(function(e){e.getAutoNum().isVirtual||n.updateNodes.push(e)})),t.free()}},{key:"show",value:function(){return this.root.show()}},{key:"branchs",get:function(){return this._branchs}},{key:"root",get:function(){return this.branchs.head}}]),e}(),Co=function(){function e(t){l()(this,e),this.tree=t,this.groups=new Map}return c()(e,[{key:"makeTreeNodeGroup",value:function(e,t){var n=new bo(null,t,this);if(e.isGroup){var i=e;n.key=i.key,n._nextGroup=i._nextGroup,n._prevGroup=i,e._nextGroup=n}else{var o=n.key=this.getKey(e),a=this.groups.get(o);if(a){var r=a._nextGroup;a._nextGroup=n,n._prevGroup=a,n._nextGroup=r,r&&(r._prevGroup=n)}else a={_prevGroup:null,_nextGroup:null},n._nextGroup=null,n._prevGroup=a,a._nextGroup=n,this.groups.set(o,a)}return n}},{key:"freeTreeNodeGroup",value:function(e){var t=e._prevGroup,n=e._nextGroup;t._nextGroup=n,n&&(n._prevGroup=t),e._prevGroup=e._nextGroup=null,this.groups.get(e.key)._nextGroup||this.groups.delete(e.key)}},{key:"findTreeNodeGroup",value:function(e){for(var t=this.groups.get(this.getKey(e.getParent()))._nextGroup;t;){if(t.has(e))return t;t=t._nextGroup}return null}},{key:"getKey",value:function(e){return e}}]),e}(),ko=function(e){function t(e){l()(this,t);var n=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.listId=e,n.level=-1,n.pos=-1,n.index=0,n.autoNumTree=new To(n),n.overrides=new Map,n}return y()(t,e),c()(t,[{key:"getParentAutoNum",value:function(e){return this.autoNumTree.getParentAutoNum(e)}},{key:"insertAutoNum",value:function(e){var t=this.findRealPrevByPos(e.pos);this.onBeforeInsertAutoNum(t,e),this.insert(t,e),e.setList(this)}},{key:"deleteAutoNum",value:function(e){var t=this.getPrevFromList(e);this.onBeforeDeleteAutoNum(t,e),this.delete(t,e)}},{key:"onBeforeInsertAutoNum",value:function(e,t){this.autoNumTree.insertAutoNum(e,t)}},{key:"onBeforeDeleteAutoNum",value:function(e,t){this.autoNumTree.deleteAutoNum(e,t)}},{key:"update",value:function(e){this.autoNumTree.on(e),this.autoNumTree.build()}},{key:"findRealPrevByPos",value:function(e){var t=this.head;return this.some((function(n){return e<=n.pos||(t=n,!1)})),t}},{key:"getRealPrev",value:function(e){var t=this.getPrevFromList(e);return t.isHead?null:t}},{key:"getRealNext",value:function(e){return this.getNextFromList(e)}},{key:"getPrevFromList",value:function(e){return e._prev}},{key:"getNextFromList",value:function(e){return e._next}},{key:"show",value:function(){for(var e=this.head._next,t="";e;)t+=e.toString()+"\n",e=e._next;return"\n"+t}},{key:"delete",value:function(e,n){we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this,e,n),n.setList(null),n.overrideInfo&&this.overrides.get(n.overrideInfo.listId)===n&&this.overrides.delete(n.overrideInfo.listId)}}]),t}(_o);var wo=n(772),So=function(){function e(t){l()(this,e),this.space=t}return c()(e,[{key:"config",value:function(e){this.pos=e}},{key:"eq",value:function(e){return e.begin<=this.pos&&this.pos<e.end&&e._node.space==this.space}}]),e}(),Po=function(){function e(t){l()(this,e),this.lists=new Map,this.service=t,this.ranges=t.center.ranges,this.spaceKeyword=new So(this),this.pointKeyword=new f.PointKeyword}return c()(e,[{key:"notify",value:function(e){var t=this.getList(e),n=null;if(t)for(n=t.next;!n;n=n.next)this.service._dispatch("onAutoNumChanged",n.pos)}},{key:"getList",value:function(e){return this.lists.has(e)||this.lists.set(e,function(e){return new ko(e)}(e)),this.lists.get(e)}}]),e}();function Io(e,t){var n=e._node,i=Io.keyPos,o=Io.listId;if(n.space==Io.space&&(null==o||o==n.listId)){if(!t.good())return!0;if(Math.abs(e.pos-i)<Math.abs(t.pos-i))return!0}return!1}Io.config=function(e,t,n){Io.keyPos=e,Io.space=t,Io.listId=n};var Eo=function(e){function t(e,n){l()(this,t);var i=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.subdoc=n,i.updatedPos=e.doc.getSubDocOffset(n),i}return y()(t,e),c()(t,[{key:"isAutoNumCalcRequired",value:function(e){return!this.isAloneSectionBreakOrMergeCell(e)}},{key:"isAloneSectionBreakOrMergeCell",value:function(e){if(1!==e.len)return!1;var t=this.service.doc.getDataLogic("final");if(t.getChar(e.pos).charCodeAt(0)===Ne.m)return!0;if(e.prop.getPropVal("para_type")!==xe.b)return!1;var n=t.specTable.getTapx(e.pos),i=n.cells,o=n.cellDatas.findIndex((function(t){return t.begin<=e.pos&&t.end>e.pos}));console.assert(o>=0);var a=i[o];return a.vertMerge==wo.e.MIDDLE||a.vertMerge==wo.e.LAST}},{key:"push",value:function(e){if(e>=this.updatedPos){for(var t=this.service,n=t.center,i=t.dataLogic,o=t.doc.getSubDocRange(this.subdoc),a=i.getPapx(this.updatedPos),r=o.pos+o.len,s=null,l=null,u=50,c=new Set;a.good&&a.end<=r&&(u||this.updatedPos<e);)a.prop.hasAutoNum()&&this.isAutoNumCalcRequired(a)&&(l=vo(a,this))&&((s=this.getList(l.listId)).insertAutoNum(l),n.attachAutoNum(l),c.add(s)),--u,this.updatedPos=a.pos+a.len,i.movePapxToNext(a);c.forEach((function(e){e.update()})),a.free()}return this}},{key:"isUpdated",value:function(e){return e<this.updatedPos}},{key:"getUpdatedPos",value:function(){return this.updatedPos}},{key:"getAutoNumNodeByPos",value:function(e){return this.spaceKeyword.config(e),this.ranges.findNode(e,e,this.spaceKeyword)}},{key:"findRealPrev",value:function(e,t){for(var n=this.getList(t),i=n.next;i&&(i.isVirtual||e>i.pos);)i.isVirtual||(n=i),i=i.next;return n}},{key:"findRealNext",value:function(e,t){for(var n=this.getList(t).next;n&&(n.isVirtual||e>n.pos);)n=n.next;return n}},{key:"onExpand",value:function(e,t){e<this.updatedPos&&(this.updatedPos+=t)}},{key:"onRemove",value:function(e,t){e<this.updatedPos&&(this.updatedPos-=Math.min(this.updatedPos-e,t))}}]),t}(Po);function Oo(e){var t=Math.floor(e%1e5/1e4),n=Math.floor(e%1e4/1e3),i=Math.floor(e%1e3/100),o=Math.floor(e%100/10),a=e%10;return 0!==t?[t,n,i,o,a]:0!==n?[n,i,o,a]:0!==i?[i,o,a]:0!==o?[o,a]:[a]}var xo={elements:["〇","一","二","三","四","五","六","七","八","九"],units:["","十","百","千","万"],getFormatedElement:function(e){var t=this;if(0==e)return this.elements[0];var n=Oo(e),i=0,o="";if(n.forEach((function(a,r){0===i&&""!==o&&(o+=t.elements[0]),a>0&&((0!==r||e<10||e>=20)&&(o+=t.elements[a]),o+=t.units[n.length-1-r]),i=a})),o.length>2){var a=[];o.split("").forEach((function(e,n,i){n>0&&e===t.elements[0]&&i[n-1]===e||a.push(e)})),a.length>1&&a[a.length-1]===this.elements[0]&&(a.length-=1),o=a.join("")}return o}},Ro={elements:["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","⑰","⑱","⑲","⑳"],getFormatedElement:function(e){return e<=this.elements.length?this.elements[e-1]:e}};function No(e,t){if(e<=t.length)return t[e-1];var n=Math.floor((e-1)/t.length)+1;return t[(e-1)%t.length].repeat(n)}function Ao(e,t){for(var n="",i=e,o=t.length;i>0;)n=t[(i-1)%o]+n,i=Math.floor((i-1)/o);return n}var Do={39:xo,37:xo,11:xo,10:xo,18:Ro,28:Ro,38:{elements:["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],units:["","拾","佰","仟","万"],getFormatedElement:function(e){var t=this;if(0==e)return this.elements[0];var n=Oo(e),i=0,o="";if(n.forEach((function(e,a){0===i&&""!==o&&(o+=t.elements[0]),e>0&&(o+=t.elements[e],o+=t.units[n.length-1-a]),i=e})),o.length>2){var a=[];o.split("").forEach((function(e,n,i){n>0&&e===t.elements[0]&&i[n-1]===e||a.push(e)})),a.length>1&&a[a.length-1]===this.elements[0]&&(a.length-=1),o=a.join("")}return o}},0:{getFormatedElement:function(e){return e}},22:{elements:["01","02","03","04","05","06","07","08","09"],getFormatedElement:function(e){return e<10?this.elements[e-1]:e}},30:{elements:["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],getFormatedElement:function(e){return e<=this.elements.length?this.elements[e-1]:e}},23:{getFormatedElement:function(e){return null}},24:{elements:["가","나","다","라","마","바","사","아","자","차","카","타","파","하"],getFormatedElement:function(e){return this.elements[(e-1)%this.elements.length]}},46:{elements:["أ‌","ب","ت","ث","ج‌","ح","خ","د","ذ‌","ر","ز‌","س","ش","ص‌","ض‌","ط","ظ‌","ع","غ","ف","ق‌","ك","ل","م","ن‌","ه‌","و","ي"],getFormatedElement:function(e){return No(e,this.elements)}},49:{elements:["क","ख","ग","घ","ङ","च","छ","ज","झ","ञ","ट","ठ","ड","ड","ण","त","थ","द","ध","न","ऩ","प","फ","ब","भ","म","य","र","ऱ","ल","ळ","ऴ","व","श","ष","स","ह"],getFormatedElement:function(e){return No(e,this.elements)}},14:{elements:["０","１","２","３","４","５","６","７","８","９"],getFormatedElement:function(e){for(var t="",n=e.toString(),i=0;i<n.length;++i)t+=this.elements[parseInt(n[i])];return t}},4:{elements:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],getFormatedElement:function(e){return Ao(e,this.elements)}},3:{elements:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],getFormatedElement:function(e){return Ao(e,this.elements)}},2:{elements:["i","ii","iii","iv","v","vi","vii","viii","ix","x","xx","xxx","xl","l","lx","lxx","lxxx","xc","c","cc","ccc","cd","d","dc","dcc","dccc","cm","m"],getFormatedElement:function(e){var t=e,n="",i=parseInt(t/1e3);return 0!==i&&(n+=this.elements[i+27-1]),t%=1e3,0!==(i=parseInt(t/100))&&(n+=this.elements[i+18-1]),t%=100,0!==(i=parseInt(t/10))&&(n+=this.elements[i+9-1]),0!==(i=t%10)&&(n+=this.elements[i-1]),n}},1:{elements:["I","II","III","IV","V","VI","VII","VIII","IX","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","M"],getFormatedElement:function(e){var t=e,n="",i=parseInt(t/1e3);return 0!==i&&(n+=this.elements[i+27-1]),t%=1e3,0!==(i=parseInt(t/100))&&(n+=this.elements[i+18-1]),t%=100,0!==(i=parseInt(t/10))&&(n+=this.elements[i+9-1]),0!==(i=t%10)&&(n+=this.elements[i-1]),n}}},Mo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments[2],i=arguments[3],o=Do[n],a=o?o.getFormatedElement(e):Do[0].getFormatedElement(e);return t&&0!==t.length?255==n?t.replace("%"+(i||1),""):23!=n||a?null!=a?t.replace("%"+(i||1),a):t:t.replace("%"+(i||1),t.substr(0,1)):""};function Lo(e,t){return t<e.levels.length?e.levels[t]:e.levels[e.levels.length-1]}function Fo(e,t,n,i){if(e.usingOverride&&e.overrideInfo&&(e.overrideInfo.overrideLevel||0===e.overrideInfo.overrideLevel)){var o=i.mgr.getOverrideAutoNum(e.overrideInfo.listId),a=Lo(t,n);return o?function(e,t){var n=e.overrideLevels,i=e.abstract.private.levels,o=Math.min(t,n.length-1),a=n[o],r=i[o];if(a.startAt=a.overrideFormat?a.startAt:r.startAt,ho.b&a.overrideFormat)return a;var s=Object.assign({},r);return ho.e&a.overrideFormat&&(s.startAt=a.startAt,s.overrideFormat=a.overrideFormat),s}(o,n):a}return Lo(t,n)}var Bo=function(e){function t(e,n,i){l()(this,t);var o=m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return e.attachObserver(o),e.viewSettings.attachObserver(o),o.dataLogic=n,o.expireRanges=new Vt.default,o.spaces=[],o.deleted=new Set,o}return y()(t,e),c()(t,[{key:"clearAll",value:function(){this.expireRanges.reset()}},{key:"pull",value:function(){var e=this,t=this.dataLogic,n=this.center,i=0,o=null,a=null,r=null,s=this.expireRanges.detachAllNodes(),l=[],u=new Set;Array.from(this.deleted).sort((function(e,t){return t.index-e.index})).forEach((function(e){a=e.space.getList(e.listId),n.detachAutoNum(e),a.deleteAutoNum(e),u.add(a)})),this.deleted.clear(),s.forEach((function(e){l=l.concat(t.collectPapxs(e.pos,e.len))})),l.forEach((function(t){if(i=t.pos,o=e.getSpaceByPos(i),r=o.getAutoNumNodeByPos(i),!e.compat(r,t)&&(r&&(a=o.getList(r.listId),n.detachAutoNum(r),a.deleteAutoNum(r),u.add(a)),t.prop.hasAutoNum()&&o.isAutoNumCalcRequired(t))){if(!(r=vo(t,o)))return;(a=o.getList(r.listId)).insertAutoNum(r),n.attachAutoNum(r),u.add(a)}})),u.forEach((function(t){t.update((function(t){e._dispatch("onAutoNumChanged",t.pos)}))}))}},{key:"push",value:function(e){return this.getSpaceByPos(e).push(e)}},{key:"getAutoNumNodeByPos",value:function(e){return this.push(e).getAutoNumNodeByPos(e)}},{key:"formatAutoNumNode",value:function(e){var t=e,n=t.format,i=Fo(t,n,t.level,this),o=0,a=i,r=a.legal,s=a.nfc,l=a.xst;for(s=this.getNfc(r,s);t.level>=0;){var u=t,c=u.level,h=u.index;t.isVirtual||(n=t.format),o=(i=Fo(t,n,c,this)).startAt,s=this.getNfc(r,i.nfc),l=Mo(h+o,l,s,c+1),t=t.up}return l}},{key:"getNfc",value:function(e,t){var n=void 0;if(e)switch(t){case st.e:n=st.e;break;case st.f:case 255:n=st.Q;break;default:n=st.b}else n=t;return n}},{key:"compat",value:function(e,t){if(e&&(e.begin!=t.pos||e.len!=t.len))return!1;var n=t.prop;if(!n.hasAutoNum())return!e;if(e){var i=n.getPropVal("list_id");return n.getPropVal("list_level")==e.level&&i==e.rawListId}return!1}},{key:"getSpaceByPos",value:function(e){var t=this.doc.getSubDocType(e),n=this.spaces[t];return n||(n=this.spaces[t]=new Eo(this,t)),n}},{key:"findRealPrev",value:function(e){this.getSpaceByPos(e).findRealPrev(e)}},{key:"findNextPrev",value:function(e){this.getSpaceByPos(e).findNextPrev(e)}},{key:"onInsertText",value:function(e,t,n,i){var o=this.getSpaceByPos(t),a=n.length;this.expireRanges.expand(t,a),o.isUpdated(t)&&this.expireRanges.todo({begin:t,end:t+a+1}),this.spaces.forEach((function(e){e.onExpand(t,a)}))}},{key:"onDeleteText",value:function(e,t,n){this.expireRanges.remove(t,n.length);var i=n.length;this.spaces.forEach((function(e){e.onRemove(t,i)}))}},{key:"onPapxChanged",value:function(e,t){var n=t.pos,i=t.len,o=this.getSpaceByPos(n);o.isUpdated(n)&&this.expireRanges.todo({begin:n,end:Math.min(o.getUpdatedPos(),n+i)})}},{key:"onStyleChanged",value:function(e,t,n,i){var o=this;i&&t.forEach((function(t){return o.onPapxChanged(e,t)}))}},{key:"onRevisionsViewChanged",value:function(){var e=this;this.doc.revisions.rangeSet.forEachNode((function(t){e.expireRanges.todo({begin:t.begin,end:t.end+1}),e.center.collectAutoNums({begin:t.begin,end:t.end+1}).forEach((function(t){return e.deleted.add(t)}))}))}}]),t}(function(){function e(t,n){l()(this,e),this.doc=t,this.mgr=t.autoNumMgr,this.center=n,Object(p.default)(this)}return c()(e,[{key:"notify",value:function(e){this.spaces.forEach((function(t){t.notify(e)}))}}]),e}()),Ho=n(4103),Go=n(1285),Wo=n(80),jo=n.n(Wo),Uo=function(){function e(){l()(this,e),this.keys=[],this.values=[]}return c()(e,[{key:"set",value:function(e,t){for(var n=0;n<this.keys.length;n++)if(this.keys[n]===e)return void(this.values[n]=t);this.keys.push(e),this.values.push(t)}},{key:"forEach",value:function(e){for(var t=0;t<this.keys.length;t++)e(this.values[t],this.keys[t],this)}}]),e}(),Vo=0,Yo=function e(){l()(this,e),this.nEMSize=0,this.nAscent=0,this.nDescent=0,this.nHeight=0,this.nUnderlinePos=0,this.nUnderlineWidth=0,this.nDescentPading=0,this.nDeletionPos=0,this.nDeletionWidth=0,this.nAscender=0,this.nDescender=0,this.nLineGap=0},zo=function e(){l()(this,e),this.version,this.xAvgCharWidth,this.usWeightClass,this.usWidthClass,this.fsType,this.ySubscriptXSize,this.ySubscriptYSize,this.ySubscriptXOffset,this.ySubscriptYOffset,this.ySuperscriptXSize,this.ySuperscriptYSize,this.ySuperscriptXOffset,this.ySuperscriptYOffset,this.yStrikeoutSize,this.yStrikeoutPosition,this.sFamilyClass,this.panose={},this.signature={},this.achVendID=[],this.fsSelection,this.usFirstCharIndex,this.usLastCharIndex,this.sTypoAscender,this.sTypoDescender,this.sTypoLineGap,this.usWinAscent,this.usWinDescent,this.ulCodePageRange1,this.ulCodePageRange2,this.sxHeight,this.sCapHeight,this.usDefaultChar,this.usBreakChar,this.usMaxContext},Ko=function e(){l()(this,e),this.fontMeasure=new Yo,this.flag=0,this.fontStyle=Vo,this.avgWidth=0,this.os2=new zo,this.ttf=!1},Zo=function(){function e(){l()(this,e),this.readInt=function(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},this.readShort=function(e,t){return e[t]+(e[t+1]<<8)},this.fontFace=new Ko,this.kerningPairs=[],this.horiAdvMap=new Uo,this.vertAdvMap=new Uo,this.horiWidthMap={},this.vertWidthMap={}}return c()(e,[{key:"readString",value:function(e,t,n){for(var i="",o=t;o<t+n;o++)i+=String.fromCharCode(e[o]);return i}},{key:"getFontHeight",value:function(e,t){var n=this.fontFace.fontMeasure.nAscent,i=this.fontFace.fontMeasure.nDescent,o=this.fontFace.fontMeasure.nHeight,a=this.fontFace.fontMeasure.nEMSize;return t.isCJKFont=this.isCJKFont(),{ascent:n,descent:i,height:o,emsize:a}}},{key:"getFontHoriWidth",value:function(e,t){var n=e.charCodeAt(0),i=this.fontFace.fontMeasure.nEMSize,o=this.horiWidthMap[n];if(null==o)for(var a=this.horiAdvMap.keys,r=this.horiAdvMap.values,s=!1,l=0;l<a.length;l++){var u=r[l].charRanges,c=r[l].chars;u.length%2!=0&&console.log("charRanges invalide");for(var h=0;h<u.length;h+=2){var d=u[h],p=u[h+1];if(n>=d&&n<p){o=a[l],this.horiWidthMap[n]=o,s=!0;break}}if(s)break;for(var f=0;f<c.length;f++)if(c[f]==n){o=a[l],this.horiWidthMap[n]=o,s=!0;break}if(s)break}var g=void 0,v=!0;return null!=o&&-100!=o||(o=this.fontFace.avgWidth,v=!1,this.horiWidthMap[n]=-100),null!=o&&(g=t*o/i),{width:g,bFindChar:v}}},{key:"getFontVertWidth",value:function(){}},{key:"isCJKFont",value:function(){return 4063232&this.fontFace.os2.signature.fsCsb[0]}},{key:"fromBinary",value:function(e){var t=0;if("WPSFM1.0"!==this.readString(e,t,"WPSFM1.0".length))return!1;t+="WPSFM1.0".length;var n=this.readInt(e,t);t+=4,n!==e.length&&console.log("DOCFontMetrics:fromBinary: bytesLen !== buffer.length");var i=this.fontFace,o=i.fontMeasure,a=i.os2;o.nEMSize=this.readInt(e,t),t+=4,o.nAscent=this.readInt(e,t),t+=4,o.nDescent=this.readInt(e,t),t+=4,o.nHeight=this.readInt(e,t),t+=4,o.nUnderlinePos=this.readInt(e,t),t+=4,o.nUnderlineWidth=this.readInt(e,t),t+=4,o.nDescentPading=this.readInt(e,t),t+=4,o.nDeletionPos=this.readInt(e,t),t+=4,o.nDeletionWidth=this.readInt(e,t),t+=4,o.nAscender=this.readInt(e,t),t+=4,o.nDescender=this.readInt(e,t),t+=4,o.nLineGap=this.readInt(e,t),t+=4,this.fontFace.flag=this.readInt(e,t),t+=4,this.fontFace.fontStyle=this.readInt(e,t),t+=4,this.fontFace.avgWidth=this.readInt(e,t),t+=4,a.version=this.readShort(e,t),t+=2,a.xAvgCharWidth=this.readShort(e,t),t+=2,a.usWeightClass=this.readShort(e,t),t+=2,a.usWidthClass=this.readShort(e,t),t+=2,a.fsType=this.readShort(e,t),t+=2,a.ySubscriptXSize=this.readShort(e,t),t+=2,a.ySubscriptYSize=this.readShort(e,t),t+=2,a.ySubscriptXOffset=this.readShort(e,t),t+=2,a.ySubscriptYOffset=this.readShort(e,t),t+=2,a.ySuperscriptXSize=this.readShort(e,t),t+=2,a.ySuperscriptYSize=this.readShort(e,t),t+=2,a.ySuperscriptXOffset=this.readShort(e,t),t+=2,a.ySuperscriptYOffset=this.readShort(e,t),t+=2,a.yStrikeoutSize=this.readShort(e,t),t+=2,a.yStrikeoutPosition=this.readShort(e,t),t+=2,a.sFamilyClass=this.readShort(e,t),t+=2,a.panose.bFamilyType=e[t++],a.panose.bSerifStyle=e[t++],a.panose.bWeight=e[t++],a.panose.bProportion=e[t++],a.panose.bContrast=e[t++],a.panose.bStrokeVariation=e[t++],a.panose.bArmStyle=e[t++],a.panose.bLetterform=e[t++],a.panose.bMidline=e[t++],a.panose.bXHeight=e[t++],a.signature.fsUsb=[],a.signature.fsUsb[0]=this.readInt(e,t),t+=4,a.signature.fsUsb[1]=this.readInt(e,t),t+=4,a.signature.fsUsb[2]=this.readInt(e,t),t+=4,a.signature.fsUsb[3]=this.readInt(e,t),t+=4,a.signature.fsCsb=[],a.signature.fsCsb[0]=this.readInt(e,t),t+=4,a.signature.fsCsb[1]=this.readInt(e,t),t+=4,a.achVendID[0]=e[t++],a.achVendID[1]=e[t++],a.achVendID[2]=e[t++],a.achVendID[3]=e[t++],a.fsSelection=this.readShort(e,t),t+=2,a.usFirstCharIndex=this.readShort(e,t),t+=2,a.usLastCharIndex=this.readShort(e,t),t+=2,a.sTypoAscender=this.readShort(e,t),t+=2,a.sTypoDescender=this.readShort(e,t),t+=2,a.sTypoLineGap=this.readShort(e,t),t+=2,a.usWinAscent=this.readShort(e,t),t+=2,a.usWinDescent=this.readShort(e,t),t+=2,a.ulCodePageRange1=this.readInt(e,t),t+=4,a.ulCodePageRange2=this.readInt(e,t),t+=4,a.sxHeight=this.readShort(e,t),t+=2,a.sCapHeight=this.readShort(e,t),t+=2,a.usDefaultChar=this.readShort(e,t),t+=2,a.usBreakChar=this.readShort(e,t),t+=2,a.usMaxContext=this.readShort(e,t),t+=2,this.fontFace.ttf=this.readInt(e,t),t+=4;var r=this.readInt(e,t);t+=4;for(var s=0;s<r;s++){var l={};l.wFirst=this.readShort(e,t),t+=2,l.wSecond=this.readShort(e,t),t+=2,l.iKernAmount=this.readInt(e,t),t+=4,this.kerningPairs.push(l)}var u=this.readInt(e,t);t+=4;for(var c=0;c<u;c++){var h=this.readInt(e,t);t+=4;var d={chars:[],charRanges:[]},p=this.readInt(e,t);t+=4;for(var f=0;f<p;f++)d.chars.push(this.readShort(e,t)),t+=2;var g=this.readInt(e,t);t+=4;for(var v=0;v<g;v++)d.charRanges.push(this.readShort(e,t)),t+=2,d.charRanges.push(this.readShort(e,t)),t+=2;this.horiAdvMap.set(h,d)}var m=this.readInt(e,t);t+=4;for(var _=0;_<m;_++){var y=this.readInt(e,t);t+=4;var b={chars:[],charRanges:[]},T=this.readInt(e,t);t+=4;for(var C=0;C<T;C++)b.chars.push(this.readShort(e,t)),t+=2;var k=this.readInt(e,t);t+=4;for(var w=0;w<k;w++)b.charRanges.push(this.readShort(e,t)),t+=2,b.charRanges.push(this.readShort(e,t)),t+=2;this.vertAdvMap.set(y,b)}return!0}}]),e}(),Xo=n(1145),qo=n(2181),Jo={SimSun:"宋体",SimSunEn:"SimSun",HYShuSongErKW:"汉仪书宋二KW",HYShuSongErKWEn:"HYShuSongErKW",FangZhengShuSongJT:"方正书宋简体",FangZhengShuSongJTEn:"FZShuSong-Z01S",SongTiSCJian:"宋体-简",SongTiSCJianEn:"Songti SC",STSong:"华文宋体",STSongEn:"STSong",STZhongsong:"华文中宋",STZhongsongEn:"STZhongsong",SiYuanSong:"思源宋体 CN",SiYuanSongEn:"Source Han Serif CN",SimHei:"黑体",SimHeiEn:"SimHei",HYZhongHeiKW:"汉仪中黑KW",HYZhongHeiKWfEn:"HYZhongHeiKW",STXihei:"华文细黑",STXiheiEn:"STXihei",SiYuanHei:"思源黑体 CN",SiYuanHeiEn:"Source Han Sans CN",SiYuanHeiRegular:"思源黑体 CN Regular",SiYuanHeiRegularEn:"Source Han Sans CN Regular",DoQingHei:"冬青黑体简体中文",DoQingHeiW3:"冬青黑体简体中文 W3",DoQingHeiW4:"冬青黑体简体中文 W4",DoQingHeiW5:"冬青黑体简体中文 W5",DoQingHeiW6:"冬青黑体简体中文 W6",DoQingHeiEn:"Hiragino Sans GB",DoQintHeiW3En:"Hiragino Sans GB W3",DoQintHeiW6En:"Hiragino Sans GB W6",SCHeitiLight:"黑体-简",SCHeitiLightEn:"Heiti SC",FZHTJW:"方正黑体简体",FZHTJWEn:"FZHei-B01S",STHeiti:"华文黑体",STHeitiEn:"STHeiti",YaHei:"微软雅黑",YaHeiEn:"Microsoft YaHei",HYQiHeiKW:"汉仪旗黑KW 55S",HYQiHeiKWEn:"HYQiHeiKW 55S",PingFang:"苹方-简",PingFangEn:"PingFang SC",HYFangSongKW:"汉仪仿宋KW",HYFangSongKWEn:"HYFangSongKW",STFangsong:"华文仿宋",STFangsongEn:"STFangsong",FangSong:"仿宋",FangSongEn:"FangSong",FZFSJW:"方正仿宋简体",FZFSJWEn:"FZFangSong-Z02S",FangSongGB2312:"仿宋_GB2312",SongTiGB2312:"宋体_GB2312",FZKTJW:"方正楷体简体",FZKTJWEn:"FZKai-Z03S",KaiTiGB2312:"楷体_GB2312",KaiTiGB2312En:"KaiTi_GB2312",HYKaiTiKW:"汉仪楷体KW",HYKaiTiKWEn:"HYKaiTiKW",KaiTi:"楷体",KaiTiEn:"KaiTi",STKaiTi:"华文楷体",STKaiTiEn:"STKaiti",FZXiaoBiaoSong:"方正小标宋简体",FZXiaoBiaoSongEn:"FZXiaoBiaoSong-B05S",DengXian:"等线",HYZhongDengXianKW:"汉仪中等线KW",HYZhongDengXianKWEn:"HYZhongDengXianKW",Wingdings:"Wingdings",WPSSpecial1:"WPS Special 1",FZChaoCuHei_GBK:"方正超粗黑_GBK",FZLiShu_GBK:"方正隶书_GBK",FZSongS_SIP_2010603:"方正宋体S-超大字符集(SIP)",FZSongS_2010603:"方正宋体S-超大字符集",FZWeiBei_GBK:"方正魏碑_GBK",FZXiHeiYi_GBK:"方正细黑一_GBK",FZXingKai_GBK:"方正行楷_GBK",FZYaoTi_GBK:"方正姚体_GBK",FZLanTingDaHei_GBK:"方正兰亭大黑_GBK",KingsoftConfetti:"Kingsoft Confetti",KingsoftExtra:"Kingsoft Extra",KingsoftSign:"Kingsoft Sign",KingsoftStress:"Kingsoft Stress",KingsoftMark:"Kingsoft Mark",KingsoftMath:"Kingsoft Math",JSTina:"-JS Tina",AtNoonRegular:"4711_AtNoon_Regular",ArialUnicodeMs:"Arial Unicode MS",KwangMD:"4803_Kwang_MD",AmeriGarmndBT:"AmeriGarmnd BT",GentiumBasic:"Gentium Basic",GentiumBookBasic:"Gentium Book Basic",Nyala:"Nyala",AngsanaNews:"Angsana News",AngsanaNew:"Angsana New",AngsanaNewBold:"AngsanaNew,Bold",AppleChancery:"Apple Chancery",CourierNew:"Courier New",ArabicTransparent:"Arabic Transparent",Arial:"Arial",ArialBoldMT:"Arial BoldMT",BenguiatBkBT:"Benguiat Bk BT",BookmanOldStyle:"Bookman Old Style",C39HrP48DmTt:"C39HrP48DmTt",Calibri:"Calibri",ArialRoundedMTBold:"Arial Rounded MT Bold",CenturyGothic:"Century Gothic",SegoeUI:"Segoe UI",Corbel:"Corbel",Candara:"Candara",GillSansMT:"Gill Sans MT",LucidaSans:"Lucida Sans",LucidaSansUnicode:"Lucida Sans Unicode",AgencyFB:"Agency FB",ErasLightITC:"Eras Light ITC",ErasMediumITC:"Eras Medium ITC",MaiandraGD:"Maiandra GD",TrebuchetMS:"Trebuchet MS",TwCenMT:"Tw Cen MT",MicrosoftSansSerif:"Microsoft Sans Serif",Century:"Century",DFKaiSB:"DFKai-SB",MicrosoftJhengHeiLight:"Microsoft JhengHei Light",MicrosoftJhengHei:"Microsoft JhengHei",DFKaiShuSBEstdBF:"DFKaiShu SB Estd BF",DavidTransparent:"David Transparent",David:"David",Dialog:"Dialog",FBD2:"FBD2",FixedMiriamTransparent:"Fixed Miriam Transparent",MiriamFixed:"Miriam Fixed",Foreign1:"Foreign1",Foreign2:"Foreign2",Geneva:"Geneva",GothicE:"GothicE",HGP:"HGPｺﾞｼｯｸM",MSGothic:"MS Gothic",HGS:"HGS創英角ｺﾞｼｯｸUB",HG:"HG丸ｺﾞｼｯｸM-PRO",HG2:"HGｺﾞｼｯｸE",Hei:"Hei",Helvetica:"Helvetica",KH2skj:"KH2s_kj",LucidaGrande:"Lucida Grande",MSOutlook:"MS Outlook",Symbol:"Symbol",MSShellDlg:"MS Shell Dlg",MSShellDlg2:"MS Shell Dlg 2",Tahoma:"Tahoma",Monaco:"Monaco",Cambria:"Cambria",MonotypeSorts:"Monotype Sorts",Webdings:"Webdings",MTExtra:"MT Extra",Nff:"Nff[8b_GB2312",OpenSans:"Open Sans",STSongLight:"STSong-Light",Segoe:"Segoe",SegoeUIWPC:"Segoe UI WPC",SymbolMT:"SymbolMT",THSarabunPSK:"TH SarabunPSK",THSarabunPSK2:"TH Sarabun PSK",THSarabunPSK3:"THSarabunPSK",THSarabunPSKBold:"THSarabunPSK,Bold",THSarabunPSKBold2:"THSarabunPSK-Bold",THSarabunPSKBoldItalic:"THSarabunPSK-BoldItalic",TimesNewRomanPSBoldMT:"Times New RomanPS BoldMT",TimesNewRomanPSMT:"Times New RomanPSMT",TimesNewRomanPSMT2:"TimesNewRomanPSMT",Wingdings3:"Wingdings 3",Wingdings2:"Wingdings 2",Rod:"Rod",TimesRoman:"Times-Roman",TimesNewRoman:"Times New Roman",layiji:"_Layiji MaHaNiYom V 1.2",droid:"droid",unknown:"unknown",zypyyb:"zypyyb",eiia:"ËÎÌå",aeiia:"ÐÂËÎÌå",ChuangYiJianFangSong:"创艺简仿宋",FangZhengLanTingHeiJianTi:"方正兰亭超细黑简体",FangZhengShuTi:"方正舒体",FangZhengYaoTi:"方正姚体",ChuangYiJianSongTi:"创艺简宋体",ChuangYiJianBiaoSong:"创艺简标宋",HuaWenCaiYun:"华文彩云",HuaWenXingKai:"华文行楷",HuaWenLiShu:"华文隶书",SongTi18030:"宋体-18030",XiaoBiaoSong:"小标宋",CaiHongXiaoBiaoSong:"彩虹小标宋",SongTiFangZhengChaoDa:"宋体-方正超大字符集",CaiHongCuFangSong:"彩虹粗仿宋",WenXingBiaoSong:"文星标宋",WenXingJianDaBiaoSong:"文星简大标宋",WenDingCSKaiTi:"文鼎CS楷体",WenDingZhongXingShu:"文鼎中行書",PMingLiU:"PMingLiU",WenDingZhongLi:"文鼎中隸",MingLiU:"MingLiU",WenDingDaBiaoSongJian:"文鼎大标宋简",WenDingXiaoBiaoSongJian:"文鼎小标宋简",WenDingTeCuSongJian:"文鼎特粗宋简",WenDingCuLi:"文鼎粗隸",XinSongTi18030:"新宋体-18030",FangZhengShuSongGBK:"方正书宋_GBK",FangZhengFangSongGBK:"方正仿宋_GBK",FangZhengFangSongGB2312:"方正仿宋_GB2312",FangZhengLanTingHei:"方正兰亭黑_GBK",FangZhengDaBiaoSongJian:"方正大标宋简体",FangZhengXiaoBiaoSongGBK:"方正小标宋_GBK",FangZhengXinBaoSongJianTi:"方正新报宋简体",FangZhengKaiTiGBK:"方正楷体_GBK",FangZhengShuZhuJianTi:"方正水柱简体",FangZhengShuZhuFanTi:"方正水柱繁体",FangZhengHuPo:"方正琥珀",FangZhengHuPoJianTi:"方正琥珀简体",FangZhengXiYuanJianTi:"方正细圆简体",FangZhengZongYiJianTi:"方正综艺简体",FangZhengXingKaiJianTi:"方正行楷简体",FangZhengWeiBeiJianTi:"方正魏碑简体",FangZhengHeiTiGBK:"方正黑体_GBK",FangZhengHeiTi:"方正黑體",HanZhenGuangBiao:"汉真广标",HanDingJianZhongKai:"汉鼎简中楷",HanDingJianShuSongEr:"汉鼎简书宋二",HanDingJianDaSong:"汉鼎简大宋",HanDingJianDaHei:"汉鼎简大黑",HuaKangZhongYuanTi:"華康中圓體",HuaKangZhongYuanTi2:"華康中圓體(P)",HuaKangZhongMingTi:"華康中明體",HuaKangZhongKaiTi:"華康中楷體",HuaKangZhongHeiTi:"華康中黑體",HuaKangFangSongTi:"華康仿宋體",HuaKangLiZhongSong:"華康儷中宋",HuaKangLiCuHei:"華康儷粗黑",HuaKangMoZiTi:"華康墨字體",HuaKangWaWaTi:"華康娃娃體",HuaKangBuDingTi:"華康布丁體W7",HuaKangKaiShuTi:"華康楷書體",HuaKangBiaoSongTi:"華康標宋體",HuaKangBiaoKaiTi:"華康標楷體",HuaKangCuYuanTi:"華康粗圓體",HuaKangCuHeiTi:"華康粗黑體",HuaKangXiYuanTi:"華康細圓體",HuaKangXiMingTi:"華康細明體",HuaKangXingShuTi:"華康行書體",HuaKangXingKaiTi:"華康行楷體W5",HuaKangLiShuTi:"華康隸書體",HuaKangWeiBeiTi:"華康魏碑體",HuaXin:"华新",STHupo:"华文琥珀",STXinwei:"华文新魏"},Qo=new Map;Object.keys(Jo).forEach((function(e){Qo.set(Jo[e],e)}));var $o=n(1805),ea=n(1474),ta={DO_NOTHING_STRAGETY:[],STRAGETY_1:[Jo.HYShuSongErKW,Jo.HYShuSongErKWEn],STRAGETY_2:[Jo.HYShuSongErKW,Jo.HYShuSongErKWEn],STRAGETY_3:[Jo.HYShuSongErKW,Jo.HYShuSongErKWEn],STRAGETY_4:[Jo.HYZhongHeiKW,Jo.HYZhongHeiKWfEn],STRAGETY_5:[Jo.HYZhongHeiKW,Jo.HYZhongHeiKWfEn],STRAGETY_6:[Jo.HYZhongHeiKW,Jo.HYZhongHeiKWfEn],STRAGETY_7:[Jo.HYQiHeiKW,Jo.HYQiHeiKWEn],STRAGETY_8:[Jo.HYQiHeiKW,Jo.HYQiHeiKWEn],STRAGETY_9:[Jo.HYQiHeiKW,Jo.HYQiHeiKWEn],STRAGETY_10:[Jo.HYFangSongKW,Jo.HYFangSongKWEn],STRAGETY_11:[Jo.HYFangSongKW,Jo.HYFangSongKWEn],STRAGETY_12:[Jo.HYKaiTiKW,Jo.HYKaiTiKWEn],STRAGETY_13:[Jo.HYKaiTiKW,Jo.HYKaiTiKWEn],STRAGETY_14:[Jo.FZXiaoBiaoSong,Jo.FZXiaoBiaoSongEn],STRAGETY_16:[Jo.HYZhongDengXianKW,Jo.HYZhongDengXianKWEn],STRAGETY_17:[Jo.WPSSpecial1],STRAGETY_21:[Jo.SimSun,Jo.SimSunEn,Jo.HYShuSongErKW,Jo.HYShuSongErKWEn,Jo.FangZhengShuSongJT,Jo.FangZhengShuSongJTEn],STRAGETY_22:[Jo.STSong,Jo.STSongEn,Jo.HYShuSongErKW,Jo.HYShuSongErKWEn,Jo.FangZhengShuSongJT,Jo.FangZhengShuSongJTEn],STRAGETY_23:[Jo.HYShuSongErKW,Jo.HYShuSongErKWEn,Jo.FangZhengShuSongJT,Jo.FangZhengShuSongJTEn],STRAGETY_24:[Jo.DoQingHei,Jo.DoQingHeiEn,Jo.SCHeitiLight,Jo.SCHeitiLightEn,Jo.HYZhongHeiKW,Jo.HYZhongHeiKWfEn,Jo.FZHTJW,Jo.FZHTJWEn],STRAGETY_25:[Jo.SimHei,Jo.SimHeiEn,Jo.HYZhongHeiKW,Jo.HYZhongHeiKWfEn,Jo.FZHTJW,Jo.FZHTJWEn],STRAGETY_26:[Jo.HYZhongHeiKW,Jo.HYZhongHeiKWfEn,Jo.FZHTJW,Jo.FZHTJWEn],STRAGETY_27:[Jo.YaHei,Jo.YaHeiEn,Jo.HYQiHeiKW,Jo.HYQiHeiKWEn],STRAGETY_28:[Jo.PingFang,Jo.PingFangEn,Jo.HYQiHeiKW,Jo.HYQiHeiKWEn],STRAGETY_29:[Jo.HYQiHeiKW,Jo.HYQiHeiKWEn],STRAGETY_30:[Jo.FangSong,Jo.FangSongEn,Jo.HYFangSongKW,Jo.HYFangSongKWEn,Jo.FZFSJW,Jo.FZFSJWEn],STRAGETY_31:[Jo.HYFangSongKW,Jo.HYFangSongKWEn,Jo.FZFSJW,Jo.FZFSJWEn],STRAGETY_32:[Jo.KaiTi,Jo.KaiTiEn,Jo.HYKaiTiKW,Jo.HYKaiTiKWEn,Jo.FZHTJW,Jo.FZFSJWEn],STRAGETY_33:[Jo.HYKaiTiKW,Jo.HYKaiTiKWEn,Jo.FZKTJW,Jo.FZKTJWEn],STRAGETY_34:[Jo.FZXiaoBiaoSong,Jo.FZXiaoBiaoSongEn],STRAGETY_36:[Jo.DengXian,Jo.HYZhongDengXianKW,Jo.HYZhongDengXianKWEn],STRAGETY_40:[Jo.Wingdings,Jo.WPSSpecial1],STRAGETY_41:[Jo.ArialUnicodeMs],STRAGETY_42:[Jo.GentiumBasic,Jo.GentiumBookBasic,Jo.Nyala],STRAGETY_43:[Jo.AngsanaNew],STRAGETY_44:[Jo.CourierNew],STRAGETY_45:[Jo.Arial],STRAGETY_46:[Jo.TimesNewRoman],STRAGETY_47:[Jo.BookmanOldStyle,Jo.TimesNewRoman],STRAGETY_48:[Jo.ArialRoundedMTBold,Jo.CenturyGothic,Jo.SegoeUI,Jo.Corbel,Jo.YaHei,Jo.YaHeiEn,Jo.Candara,Jo.GillSansMT,Jo.LucidaSans,Jo.LucidaSansUnicode,Jo.AgencyFB,Jo.ErasLightITC,Jo.ErasMediumITC,Jo.MaiandraGD,Jo.TrebuchetMS,Jo.TwCenMT,Jo.Arial,Jo.ArialUnicodeMs,Jo.MicrosoftSansSerif],STRAGETY_49:[Jo.BookmanOldStyle,Jo.Nyala],STRAGETY_50:[Jo.MicrosoftJhengHeiLight,Jo.ArialUnicodeMs,Jo.MicrosoftJhengHei],STRAGETY_51:[Jo.David,Jo.TimesNewRoman],STRAGETY_52:[Jo.MiriamFixed,Jo.TimesNewRoman],STRAGETY_53:[Jo.MSGothic],STRAGETY_54:[Jo.YaHei,Jo.YaHeiEn,Jo.ArialUnicodeMs,Jo.SimSun,Jo.SimSunEn],STRAGETY_55:[Jo.CourierNew,Jo.Arial],STRAGETY_56:[Jo.Symbol,Jo.TimesNewRoman],STRAGETY_57:[Jo.MicrosoftSansSerif],STRAGETY_58:[Jo.Tahoma],STRAGETY_59:[Jo.CourierNew,Jo.Cambria],STRAGETY_60:[Jo.Wingdings,Jo.Symbol,Jo.Webdings,Jo.MTExtra],STRAGETY_61:[Jo.SimSun,Jo.SimSunEn],STRAGETY_62:[Jo.THSarabunPSK2],STRAGETY_63:[Jo.Symbol,Jo.Webdings,Jo.Wingdings2,Jo.Rod],STRAGETY_64:[Jo.SimSun,Jo.SimHeiEn,Jo.TimesNewRoman],STRAGETY_65:[Jo.ArialUnicodeMs,Jo.YaHei,Jo.YaHeiEn,Jo.SimSun,Jo.SimSunEn],STRAGETY_66:[Jo.Arial,Jo.ArialUnicodeMs,Jo.MicrosoftSansSerif],STRAGETY_67:[Jo.FangZhengLanTingHeiJianTi,Jo.FangZhengShuTi,Jo.FangZhengXinBaoSongJianTi,Jo.FangZhengYaoTi],STRAGETY_68:[Jo.FangZhengShuTi,Jo.FangZhengXinBaoSongJianTi,Jo.FangZhengYaoTi,Jo.SimHei,Jo.SimHeiEn,Jo.SimSun,Jo.SimSunEn],STRAGETY_69:[Jo.ArialUnicodeMs,Jo.YaHei,Jo.YaHeiEn,Jo.FZKTJW,Jo.FZKTJWEn,Jo.SongTiFangZhengChaoDa,Jo.FangZhengLanTingHeiJianTi,Jo.FangZhengShuTi,Jo.FZXiaoBiaoSong,Jo.FZXiaoBiaoSongEn],STRAGETY_70:[Jo.ArialUnicodeMs,Jo.MicrosoftJhengHei,Jo.PMingLiU],STRAGETY_71:[Jo.ArialUnicodeMs,Jo.MicrosoftJhengHei,Jo.MingLiU],STRAGETY_72:[Jo.HuaXin],STRAGETY_73:[Jo.KingsoftConfetti],STRAGETY_74:[Jo.KingsoftExtra],STRAGETY_75:[Jo.KingsoftMark],STRAGETY_76:[Jo.KingsoftMath],STRAGETY_77:[Jo.KingsoftSign],STRAGETY_78:[Jo.KingsoftStress],STRAGETY_79:[Jo.FZChaoCuHei_GBK],STRAGETY_80:[Jo.FangZhengKaiTiGBK],STRAGETY_81:[Jo.FangZhengFangSongGBK],STRAGETY_82:[Jo.FangZhengHeiTiGBK],STRAGETY_83:[Jo.FZLiShu_GBK],STRAGETY_84:[Jo.FZSongS_SIP_2010603],STRAGETY_85:[Jo.FZSongS_2010603,Jo.SimSun,Jo.SimSunEn,Jo.HYShuSongErKW,Jo.HYShuSongErKWEn],STRAGETY_86:[Jo.FangZhengShuSongGBK],STRAGETY_87:[Jo.FZWeiBei_GBK],STRAGETY_88:[Jo.FZXiaoBiaoSong],STRAGETY_89:[Jo.FangZhengXiaoBiaoSongGBK],STRAGETY_90:[Jo.FZXiHeiYi_GBK],STRAGETY_91:[Jo.FZXingKai_GBK],STRAGETY_92:[Jo.FZYaoTi_GBK],STRAGETY_93:[Jo.FZLanTingDaHei_GBK],STRAGETY_94:[Jo.STZhongsong],STRAGETY_95:[Jo.HuaWenCaiYun],STRAGETY_96:[Jo.STFangsong],STRAGETY_97:[Jo.STHupo],STRAGETY_98:[Jo.STKaiTi],STRAGETY_99:[Jo.HuaWenLiShu],STRAGETY_100:[Jo.STSong],STRAGETY_101:[Jo.STXihei],STRAGETY_102:[Jo.STXinwei],STRAGETY_103:[Jo.HuaWenXingKai]},na={DO_NOTHING_DOWNLOAD:"",DOWN_LOAD_1:"汉仪书宋二KW",DOWN_LOAD_2:"汉仪中黑KW",DOWN_LOAD_3:"汉仪旗黑KW 55S",DOWN_LOAD_4:"汉仪仿宋KW",DOWN_LOAD_5:"汉仪楷体KW",DOWN_LOAD_6:"方正小标宋简体",DOWN_LOAD_7:"汉仪中等线KW",DOWN_LOAD_8:"WPS Special 1",DOWN_LOAD_9:"华新",DOWN_LOAD_10:"Kingsoft Confetti",DOWN_LOAD_11:"Kingsoft Extra",DOWN_LOAD_12:"Kingsoft Mark",DOWN_LOAD_13:"Kingsoft Math",DOWN_LOAD_14:"Kingsoft Sign",DOWN_LOAD_15:"Kingsoft Stress",DOWN_LOAD_16:"方正仿宋_GBK",DOWN_LOAD_17:"方正黑体_GBK",DOWN_LOAD_18:"方正兰亭大黑_GBK",DOWN_LOAD_20:"方正超粗黑_GBK",DOWN_LOAD_21:"方正姚体_GBK",DOWN_LOAD_22:"方正行楷_GBK",DOWN_LOAD_23:"方正细黑一_GBK",DOWN_LOAD_24:"方正小标宋_GBK",DOWN_LOAD_25:"方正魏碑_GBK",DOWN_LOAD_26:"方正书宋_GBK",DOWN_LOAD_27:"方正宋体S-超大字符集",DOWN_LOAD_28:"方正宋体S-超大字符集(SIP)",DOWN_LOAD_29:"方正隶书_GBK",DOWN_LOAD_30:"方正楷体_GBK",DOWN_LOAD_31:"华文中宋",DOWN_LOAD_32:"华文彩云",DOWN_LOAD_33:"华文仿宋",DOWN_LOAD_34:"华文琥珀",DOWN_LOAD_35:"华文楷体",DOWN_LOAD_36:"华文隶书",DOWN_LOAD_37:"华文宋体",DOWN_LOAD_38:"华文细黑",DOWN_LOAD_39:"华文新魏",DOWN_LOAD_40:"华文行楷"},ia={DO_NOTHING_STRAGETY:"DO_NOTHING_DOWNLOAD",STRAGETY_1:"DOWN_LOAD_1",STRAGETY_2:"DOWN_LOAD_1",STRAGETY_3:"DOWN_LOAD_1",STRAGETY_4:"DOWN_LOAD_2",STRAGETY_5:"DOWN_LOAD_2",STRAGETY_6:"DO_NOTHING_DOWNLOAD",STRAGETY_7:"DOWN_LOAD_3",STRAGETY_8:"DOWN_LOAD_3",STRAGETY_9:"DOWN_LOAD_3",STRAGETY_10:"DOWN_LOAD_4",STRAGETY_11:"DOWN_LOAD_4",STRAGETY_12:"DOWN_LOAD_5",STRAGETY_13:"DOWN_LOAD_5",STRAGETY_14:"DOWN_LOAD_6",STRAGETY_16:"DOWN_LOAD_7",STRAGETY_17:"DOWN_LOAD_8",STRAGETY_21:"DOWN_LOAD_1",STRAGETY_22:"DOWN_LOAD_1",STRAGETY_23:"DOWN_LOAD_1",STRAGETY_24:"DOWN_LOAD_2",STRAGETY_25:"DOWN_LOAD_2",STRAGETY_26:"DO_NOTHING_DOWNLOAD",STRAGETY_27:"DOWN_LOAD_3",STRAGETY_28:"DOWN_LOAD_3",STRAGETY_29:"DOWN_LOAD_3",STRAGETY_30:"DOWN_LOAD_4",STRAGETY_31:"DOWN_LOAD_4",STRAGETY_32:"DOWN_LOAD_5",STRAGETY_33:"DOWN_LOAD_5",STRAGETY_34:"DOWN_LOAD_6",STRAGETY_36:"DOWN_LOAD_7",STRAGETY_40:"DOWN_LOAD_8",STRAGETY_41:"DO_NOTHING_DOWNLOAD",STRAGETY_42:"DO_NOTHING_DOWNLOAD",STRAGETY_43:"DO_NOTHING_DOWNLOAD",STRAGETY_44:"DO_NOTHING_DOWNLOAD",STRAGETY_45:"DO_NOTHING_DOWNLOAD",STRAGETY_46:"DO_NOTHING_DOWNLOAD",STRAGETY_47:"DO_NOTHING_DOWNLOAD",STRAGETY_48:"DO_NOTHING_DOWNLOAD",STRAGETY_49:"DO_NOTHING_DOWNLOAD",STRAGETY_50:"DO_NOTHING_DOWNLOAD",STRAGETY_51:"DO_NOTHING_DOWNLOAD",STRAGETY_52:"DO_NOTHING_DOWNLOAD",STRAGETY_53:"DO_NOTHING_DOWNLOAD",STRAGETY_54:"DO_NOTHING_DOWNLOAD",STRAGETY_55:"DO_NOTHING_DOWNLOAD",STRAGETY_56:"DO_NOTHING_DOWNLOAD",STRAGETY_57:"DO_NOTHING_DOWNLOAD",STRAGETY_58:"DO_NOTHING_DOWNLOAD",STRAGETY_59:"DO_NOTHING_DOWNLOAD",STRAGETY_60:"DO_NOTHING_DOWNLOAD",STRAGETY_61:"DO_NOTHING_DOWNLOAD",STRAGETY_62:"DO_NOTHING_DOWNLOAD",STRAGETY_63:"DO_NOTHING_DOWNLOAD",STRAGETY_64:"DO_NOTHING_DOWNLOAD",STRAGETY_65:"DO_NOTHING_DOWNLOAD",STRAGETY_66:"DO_NOTHING_DOWNLOAD",STRAGETY_67:"DO_NOTHING_DOWNLOAD",STRAGETY_68:"DO_NOTHING_DOWNLOAD",STRAGETY_69:"DO_NOTHING_DOWNLOAD",STRAGETY_70:"DO_NOTHING_DOWNLOAD",STRAGETY_71:"DO_NOTHING_DOWNLOAD",STRAGETY_72:"DOWN_LOAD_9",STRAGETY_73:"DOWN_LOAD_10",STRAGETY_74:"DOWN_LOAD_11",STRAGETY_75:"DOWN_LOAD_12",STRAGETY_76:"DOWN_LOAD_13",STRAGETY_77:"DOWN_LOAD_14",STRAGETY_78:"DOWN_LOAD_15",get STRAGETY_79(){return"DO_NOTHING_DOWNLOAD"},get STRAGETY_80(){return $o.privileges.font_founder_official?"DOWN_LOAD_30":"DO_NOTHING_DOWNLOAD"},get STRAGETY_81(){return $o.privileges.font_founder_official?"DOWN_LOAD_16":"DO_NOTHING_DOWNLOAD"},get STRAGETY_82(){return $o.privileges.font_founder_official?"DOWN_LOAD_17":"DO_NOTHING_DOWNLOAD"},get STRAGETY_83(){return $o.privileges.font_founder_official?"DOWN_LOAD_29":"DO_NOTHING_DOWNLOAD"},get STRAGETY_84(){return"DO_NOTHING_DOWNLOAD"},get STRAGETY_85(){return"DO_NOTHING_DOWNLOAD"},get STRAGETY_86(){return $o.privileges.font_founder_official?"DOWN_LOAD_26":"DO_NOTHING_DOWNLOAD"},get STRAGETY_87(){return $o.privileges.font_founder_official?"DOWN_LOAD_25":"DO_NOTHING_DOWNLOAD"},get STRAGETY_88(){return $o.privileges.font_founder_official?"DOWN_LOAD_6":"DO_NOTHING_DOWNLOAD"},get STRAGETY_89(){return $o.privileges.font_founder_official?"DOWN_LOAD_24":"DO_NOTHING_DOWNLOAD"},get STRAGETY_90(){return"DO_NOTHING_DOWNLOAD"},get STRAGETY_91(){return"DO_NOTHING_DOWNLOAD"},get STRAGETY_92(){return"DO_NOTHING_DOWNLOAD"},get STRAGETY_93(){return $o.privileges.font_founder_official?"DOWN_LOAD_18":"DO_NOTHING_DOWNLOAD"},STRAGETY_94:"DOWN_LOAD_31",STRAGETY_95:"DOWN_LOAD_32",STRAGETY_96:"DOWN_LOAD_33",STRAGETY_97:"DOWN_LOAD_34",STRAGETY_98:"DOWN_LOAD_35",STRAGETY_99:"DOWN_LOAD_36",STRAGETY_100:"DOWN_LOAD_37",STRAGETY_101:"DOWN_LOAD_38",STRAGETY_102:"DOWN_LOAD_39",STRAGETY_103:"DOWN_LOAD_40"},oa=function(){function e(t){l()(this,e),this._fontServer=t}return c()(e,[{key:"_getFontFallBackStragety",value:function(e){var t=Qo.get(e);if(!t)return"DO_NOTHING_STRAGETY";var n="_"+(t[0].toLowerCase()+t.substring(1))+"FallBackStragety";return this[n]?this[n]():"DO_NOTHING_STRAGETY"}},{key:"isFontNeedFallBack",value:function(e){return Qo.has(e)}},{key:"getFontFallBackReplaceFontArray",value:function(e){var t=this._getFontFallBackStragety(e);return ta[t]}},{key:"getFontFallBackDownLoadFontName",value:function(e){var t=this._getFontFallBackStragety(e),n=ia[t];return na[n]}},{key:"checkFontNeed2DownLoad",value:function(e){return this.getFontFallBackDownLoadFontName(e)!==na.DO_NOTHING_DOWNLOAD}},{key:"getSystemOnLoadFontName",value:function(e){var t=this;if(!this.isFontNeedFallBack(e))return"";var n=this.getFontFallBackReplaceFontArray(e),i="";return n.some((function(e){if(!t.fontServer.isFontEffectiveByCSS(e)&&t.fontDraw.isFontAlreadyInSystem(e))return i=e,!0})),i}},{key:"isRemoteFontResourceAvailable",value:function(e){return!!ea.huawenFonts.includes(e)||this.fontDraw.serverFontMap.has(e)}},{key:"testAllFallBackFunc",value:function(){var e=this;Qo.forEach((function(t,n){console.log("字体名字: ",n,e.getFontFallBackReplaceFontArray(n))}))}},{key:"testPrefineDefineFontLocalExist",value:function(){var e=this,t=[Jo.SimSun,Jo.KaiTi,Jo.SimHei,Jo.YaHei,Jo.FangSong],n=[Jo.SongTiSCJianEn,Jo.DoQingHeiEn,Jo.SCHeitiLightEn,Jo.PingFangEn],i=[],o=[];t.forEach((function(t){i.push(e.getSystemOnLoadFontName(t))})),n.forEach((function(t){o.push(e.getSystemOnLoadFontName(t))})),console.log("测试1组，字体为: ",t),console.log("对应的结果为: ",i),console.log("测试2组，字体为: ",n),console.log("对应的结果为: ",o)}},{key:"_wingdingsFallBackStragety",value:function(){return St.isMobile||St.isPad||St.isLinux?"STRAGETY_17":"DO_NOTHING_STRAGETY"}},{key:"_symbolFallBackStragety",value:function(){return"DO_NOTHING_STRAGETY"}},{key:"_simSunFallBackStragety",value:function(){return this.useCoreTypo?St.isWindows?"STRAGETY_1":St.isMobile?"STRAGETY_3":St.isMacOs&&!St.isMobile?"STRAGETY_2":St.isLinux?"STRAGETY_1":"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_21":St.isMobile?"STRAGETY_23":St.isMacOs&&!St.isMobile?"STRAGETY_22":"DO_NOTHING_STRAGETY"}},{key:"_simSunFallBackCommonStragety",value:function(){return this.useCoreTypo?"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_21":St.isMobile?"STRAGETY_23":St.isMacOs&&!St.isMobile?"STRAGETY_22":"DO_NOTHING_STRAGETY"}},{key:"_simHeiFallBackStragety",value:function(){return this.useCoreTypo?St.isWindows?"STRAGETY_5":St.isMobile?"STRAGETY_6":St.isMacOs&&!St.isMobile?"STRAGETY_4":St.isLinux?"STRAGETY_5":"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_25":St.isMobile?"STRAGETY_26":St.isMacOs&&!St.isMobile?"STRAGETY_24":"DO_NOTHING_STRAGETY"}},{key:"_simHeiFallBackCommonStragety",value:function(){return this.useCoreTypo?"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_25":St.isMobile?"STRAGETY_26":St.isMacOs&&!St.isMobile?"STRAGETY_24":"DO_NOTHING_STRAGETY"}},{key:"_yaHeiFallBackStragety",value:function(){return this.useCoreTypo?St.isWindows?"STRAGETY_7":St.isMobile?"STRAGETY_9":St.isMacOs&&!St.isMobile?"STRAGETY_8":St.isLinux?"STRAGETY_7":"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_27":St.isMobile?"STRAGETY_29":St.isMacOs&&!St.isMobile?"STRAGETY_28":"DO_NOTHING_STRAGETY"}},{key:"_yaHeiFallBackCommonStragety",value:function(){return this.useCoreTypo?"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_27":St.isMobile?"STRAGETY_29":St.isMacOs&&!St.isMobile?"STRAGETY_28":"DO_NOTHING_STRAGETY"}},{key:"_fangSongFallBackStragety",value:function(){return this.useCoreTypo?St.isWindows?"STRAGETY_10":"STRAGETY_11":St.isWindows?"STRAGETY_30":"STRAGETY_31"}},{key:"_fangSongFallBackCommonStragety",value:function(){return this.useCoreTypo?"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_30":"STRAGETY_31"}},{key:"_kaiTiFallBackStragety",value:function(){return this.useCoreTypo?St.isWindows?"STRAGETY_12":"STRAGETY_13":St.isWindows?"STRAGETY_32":"STRAGETY_33"}},{key:"_kaiTiFallBackCommonStragety",value:function(){return this.useCoreTypo?"DO_NOTHING_STRAGETY":St.isWindows?"STRAGETY_32":"STRAGETY_33"}},{key:"_fZXiaoBiaoSongFallBackStragety",value:function(){return $o.privileges.font_founder_official?"STRAGETY_88":this.useCoreTypo?window.__CONFIG__.wps.useXiaoBiaoSong?"STRAGETY_14":"DO_NOTHING_STRAGETY":window.__CONFIG__.wps.useXiaoBiaoSong?"STRAGETY_34":"DO_NOTHING_STRAGETY"}},{key:"_hYZhongDengXianKWFallBackStragety",value:function(){return this.useCoreTypo?"STRAGETY_16":"STRAGETY_36"}},{key:"_hYZhongDengXianKWFallBackCommonStragety",value:function(){return this.useCoreTypo?"STRAGETY_16":"STRAGETY_36"}},{key:"_hYZhongDengXianKWEnFallBackStragety",value:function(){return this._hYZhongDengXianKWFallBackStragety()}},{key:"_dengXianFallBackStragety",value:function(){return this._hYZhongDengXianKWFallBackCommonStragety()}},{key:"_fZXiaoBiaoSongEnFallBackStragety",value:function(){return this._fZXiaoBiaoSongFallBackStragety()}},{key:"_simSunEnFallBackStragety",value:function(){return this._simSunFallBackStragety()}},{key:"_hYShuSongErKWFallBackStragety",value:function(){return this._simSunFallBackStragety()}},{key:"_hYShuSongErKWEnFallBackStragety",value:function(){return this._simSunFallBackStragety()}},{key:"_fangZhengShuSongJTFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_fangZhengShuSongJTEnFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_songTiSCJianFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_songTiSCJianEnFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_sTSongFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.STSong)?"STRAGETY_100":this._simSunFallBackCommonStragety()}},{key:"_sTSongEnFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_sTZhongsongFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.STZhongsong)?"STRAGETY_94":this._simSunFallBackCommonStragety()}},{key:"_sTZhongsongEnFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_siYuanSongFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_siYuanSongEnFallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_songTiGB2312FallBackStragety",value:function(){return this._simSunFallBackCommonStragety()}},{key:"_simHeiEnFallBackStragety",value:function(){return this._simHeiFallBackStragety()}},{key:"_hYZhongHeiKWFallBackStragety",value:function(){return this._simHeiFallBackStragety()}},{key:"_hYZhongHeiKWfEnFallBackStragety",value:function(){return this._simHeiFallBackStragety()}},{key:"_sTXiheiFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.STXihei)?"STRAGETY_101":this._simHeiFallBackCommonStragety()}},{key:"_sTXinweiFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.STXinwei)?"STRAGETY_102":"DO_NOTHING_STRAGETY"}},{key:"_sTXiheiEnFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_siYuanHeiFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_siYuanHeiEnFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_siYuanHeiRegularFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_siYuanHeiRegularEnFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiEnFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiW3FallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiEnW3FallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiW4FallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiW5FallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiW6FallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_doQingHeiEnW6FallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_sCHeitiLightFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_sCHeitiLightEnFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_fZHTJWFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_fZHTJWEnFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_sTHeitiFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_sTHeitiEnFallBackStragety",value:function(){return this._simHeiFallBackCommonStragety()}},{key:"_yaHeiEnFallBackStragety",value:function(){return this._yaHeiFallBackStragety()}},{key:"_hYQiHeiKWFallBackStragety",value:function(){return this._yaHeiFallBackStragety()}},{key:"_hYQiHeiKWEnFallBackStragety",value:function(){return this._yaHeiFallBackStragety()}},{key:"_pingFangFallBackStragety",value:function(){return this._yaHeiFallBackCommonStragety()}},{key:"_pingFangEnFallBackStragety",value:function(){return this._yaHeiFallBackCommonStragety()}},{key:"_fangSongEnFallBackStragety",value:function(){return this._fangSongFallBackStragety()}},{key:"_hYFangSongKWFallBackStragety",value:function(){return this._fangSongFallBackStragety()}},{key:"_hYFangSongKWEnFallBackStragety",value:function(){return this._fangSongFallBackStragety()}},{key:"_sTFangsongFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.STFangsong)?"STRAGETY_96":this._fangSongFallBackCommonStragety()}},{key:"_sTHupoFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.STHupo)?"STRAGETY_97":"DO_NOTHING_STRAGETY"}},{key:"_sTFangsongEnFallBackStragety",value:function(){return this._fangSongFallBackCommonStragety()}},{key:"_fZFSJWFallBackStragety",value:function(){return this._fangSongFallBackCommonStragety()}},{key:"_fZFSJWEnFallBackStragety",value:function(){return this._fangSongFallBackCommonStragety()}},{key:"_fangSongGB2312FallBackStragety",value:function(){return this._fangSongFallBackCommonStragety()}},{key:"_kaiTiEnFallBackStragety",value:function(){return this._kaiTiFallBackStragety()}},{key:"_fZKTJWFallBackStragety",value:function(){return this._kaiTiFallBackCommonStragety()}},{key:"_fZKTJWEnFallBackStragety",value:function(){return this._kaiTiFallBackCommonStragety()}},{key:"_kaiTiGB2312FallBackStragety",value:function(){return this._kaiTiFallBackCommonStragety()}},{key:"_kaiTiGB2312EnFallBackStragety",value:function(){return this._kaiTiFallBackCommonStragety()}},{key:"_hYKaiTiKWFallBackStragety",value:function(){return this._kaiTiFallBackStragety()}},{key:"_hYKaiTiKWEnFallBackStragety",value:function(){return this._kaiTiFallBackStragety()}},{key:"_sTKaiTiFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.STKaiTi)?"STRAGETY_98":this._kaiTiFallBackCommonStragety()}},{key:"_sTKaiTiEnFallBackStragety",value:function(){return this._kaiTiFallBackCommonStragety()}},{key:"_jSTinaFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_40"}},{key:"_atNoonRegularFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_41"}},{key:"_kwangMDFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_41"}},{key:"_ameriGarmndBTFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_42"}},{key:"_angsanaNewsFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_43"}},{key:"_angsanaNewBoldFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_43"}},{key:"_appleChanceryFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_44"}},{key:"_arabicTransparentFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_45"}},{key:"_arialBoldMTFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_benguiatBkBTFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_47"}},{key:"_c39HrP48DmTtFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_calibriFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile||St.isPad?"DO_NOTHING_STRAGETY":"STRAGETY_48"}},{key:"_centuryFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_49"}},{key:"_dFKaiSBFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_50"}},{key:"_dFKaiShuSBEstdBFFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_davidTransparentFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_51"}},{key:"_dialogFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_fBD2FallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_fixedMiriamTransparentFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_52"}},{key:"_foreign1FallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_foreign2FallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_genevaFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_45"}},{key:"_gothicEFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_44"}},{key:"_hGPFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_53"}},{key:"_hGSFallBackStragety",value:function(){return this._hGPFallBackStragety()}},{key:"_hGFallBackStragety",value:function(){return this._hGPFallBackStragety()}},{key:"_hG2FallBackStragety",value:function(){return this._hGPFallBackStragety()}},{key:"_heiFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_54"}},{key:"_helveticaFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_45"}},{key:"_kH2skjFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_lucidaGrandeFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_55"}},{key:"_mSOutlookFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_56"}},{key:"_mSShellDlgFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_57"}},{key:"_mSShellDlg2FallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_58"}},{key:"_monacoFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_59"}},{key:"_monotypeSortsFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_60"}},{key:"_nffFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_61"}},{key:"_openSansFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_sTSongLightFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_segoeFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_45"}},{key:"_segoeUIWPCFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_symbolMTFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_43"}},{key:"_tHSarabunPSKFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_62"}},{key:"_tHSarabunPSK3FallBackStragety",value:function(){return this._tHSarabunPSKFallBackStragety()}},{key:"_tHSarabunPSKBoldFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_43"}},{key:"_tHSarabunPSKBold2FallBackStragety",value:function(){return this._tHSarabunPSKFallBackStragety()}},{key:"_tHSarabunPSKBoldItalicFallBackStragety",value:function(){return this._tHSarabunPSKFallBackStragety()}},{key:"_timesNewRomanPSBoldMTFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_timesNewRomanPSMTFallBackStragety",value:function(){return this._timesNewRomanPSBoldMTFallBackStragety()}},{key:"_timesRomanFallBackStragety",value:function(){return this._timesNewRomanPSBoldMTFallBackStragety()}},{key:"_timesNewRomanPSMT2FallBackStragety",value:function(){return this._timesNewRomanPSBoldMTFallBackStragety()}},{key:"_wingdings3FallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_63"}},{key:"_layijiFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_41"}},{key:"_droidFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_64"}},{key:"_unknownFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_zypyybFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_65"}},{key:"_eiiaFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_46"}},{key:"_aeiiaFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_66"}},{key:"_chuangYiJianFangSongFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_67"}},{key:"_chuangYiJianSongTiFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_67"}},{key:"_chuangYiJianBiaoSongFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_68"}},{key:"_ArialYaHeiSimSunCommonStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_65"}},{key:"_huaWenCaiYunFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.HuaWenCaiYun)?"STRAGETY_95":this._ArialYaHeiSimSunCommonStragety()}},{key:"_huaWenXingKaiFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.HuaWenXingKai)?"STRAGETY_103":this._ArialYaHeiSimSunCommonStragety()}},{key:"_huaWenLiShuFallBackStragety",value:function(){return this.isRemoteFontResourceAvailable(Jo.HuaWenLiShu)?"STRAGETY_99":this._ArialYaHeiSimSunCommonStragety()}},{key:"_songTi18030FallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_xiaoBiaoSongFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_caiHongXiaoBiaoSongFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_69"}},{key:"_caiHongCuFangSongFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_69"}},{key:"_wenXingBiaoSongFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_wenXingJianDaBiaoSongFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_wenDingCSKaiTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_wenDingZhongXingShuFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_70"}},{key:"_wenDingZhongLiFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_71"}},{key:"_wenDingDaBiaoSongJianFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_wenDingXiaoBiaoSongJianFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_wenDingTeCuSongJianFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_wenDingCuLiFallBackStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_70"}},{key:"_xinSongTi18030FallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengShuSongGBKFallBackStragety",value:function(){return $o.privileges.font_founder_official?"STRAGETY_86":this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_69"}},{key:"_fangZhengFangSongGBKFallBackStragety",value:function(){return $o.privileges.font_founder_official?"STRAGETY_81":this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengLanTingHeiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengDaBiaoSongJianFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengXiaoBiaoSongGBKFallBackStragety",value:function(){return $o.privileges.font_founder_official?"STRAGETY_89":this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengXinBaoSongJianTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengKaiTiGBKFallBackStragety",value:function(){return $o.privileges.font_founder_official?"STRAGETY_80":St.isMobile||this.useCoreTypo?"DO_NOTHING_STRAGETY":"STRAGETY_69"}},{key:"_fangZhengShuZhuJianTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengShuZhuFanTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_ArialJhengHeiPMingLiUCommonStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_70"}},{key:"_ArialJhengHeiMingLiUCommonStragety",value:function(){return this.useCoreTypo||St.isMobile?"DO_NOTHING_STRAGETY":"STRAGETY_71"}},{key:"_fangZhengHuPoFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_fangZhengHuPoJianTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengXiYuanJianTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengZongYiJianTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengXingKaiJianTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengWeiBeiJianTiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_fangZhengHeiTiGBKFallBackStragety",value:function(){return $o.privileges.font_founder_official?"STRAGETY_82":St.isMobile||this.useCoreTypo?"DO_NOTHING_STRAGETY":"STRAGETY_69"}},{key:"_fangZhengHeiTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_hanZhenGuangBiaoFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_hanDingJianZhongKaiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_hanDingJianShuSongErFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_hanDingJianDaSongFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_hanDingJianDaHeiFallBackStragety",value:function(){return this._ArialYaHeiSimSunCommonStragety()}},{key:"_huaKangZhongYuanTiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangZhongYuanTi2FallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangZhongMingTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangZhongKaiTiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangZhongHeiTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangFangSongTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangLiZhongSongFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangLiCuHeiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangMoZiTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangWaWaTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangBuDingTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangKaiShuTiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangBiaoSongTiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangBiaoKaiTiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangCuYuanTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangCuHeiTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangXiYuanTiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangXiMingTiFallBackStragety",value:function(){return this._ArialJhengHeiMingLiUCommonStragety()}},{key:"_huaKangXingShuTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangXingKaiTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangLiShuTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaKangWeiBeiTiFallBackStragety",value:function(){return this._ArialJhengHeiPMingLiUCommonStragety()}},{key:"_huaXinFallBackStragety",value:function(){return St.isMobile?"STRAGETY_72":"DO_NOTHING_STRAGETY"}},{key:"_kingsoftConfettiFallBackStragety",value:function(){return"STRAGETY_73"}},{key:"_kingsoftExtraFallBackStragety",value:function(){return"STRAGETY_74"}},{key:"_kingsoftMarkFallBackStragety",value:function(){return"STRAGETY_76"}},{key:"_kingsoftMathFallBackStragety",value:function(){return"STRAGETY_76"}},{key:"_kingsoftSignFallBackStragety",value:function(){return"STRAGETY_77"}},{key:"_kingsoftStressFallBackStragety",value:function(){return"STRAGETY_78"}},{key:"_fZChaoCuHei_GBKFallBackStragety",value:function(){return"STRAGETY_79"}},{key:"_fZLiShu_GBKFallBackStragety",value:function(){return"STRAGETY_83"}},{key:"_fZSongS_SIP_2010603FallBackStragety",value:function(){return"STRAGETY_84"}},{key:"_fZSongS_2010603FallBackStragety",value:function(){return"STRAGETY_85"}},{key:"_fZWeiBei_GBKFallBackStragety",value:function(){return"STRAGETY_87"}},{key:"_fZXiHeiYi_GBKFallBackStragety",value:function(){return"STRAGETY_90"}},{key:"_fZXingKai_GBKFallBackStragety",value:function(){return"STRAGETY_91"}},{key:"_fZYaoTi_GBKFallBackStragety",value:function(){return"STRAGETY_92"}},{key:"_fZLanTingDaHei_GBKFallBackStragety",value:function(){return"STRAGETY_93"}},{key:"_fangZhengFangSongGB2312FallBackStragety",value:function(){return this._fangSongFallBackCommonStragety()}},{key:"fontServer",get:function(){return this._fontServer}},{key:"useCoreTypo",get:function(){return this.fontServer.doc.useCoreTypo}},{key:"fontDraw",get:function(){return this.fontServer.docFontDraw}}]),e}(),aa={DoQingHeiW3:"冬青黑体简体中文 W3",DoQingHeiW6:"冬青黑体简体中文 W6"},ra=new Map;Object.keys(aa).forEach((function(e){ra.set(aa[e],e)}));var sa={DO_NOTHING_STRAGETY:[],STRAGETY_1:["冬青黑体简体中文","Hiragino Sans GB"]},la=function(){function e(t){l()(this,e),this._fontServer=t}return c()(e,[{key:"_getFontSystemFallBackName",value:function(e){var t=ra.get(e);if(!t)return"DO_NOTHING_STRAGETY";var n="_"+(t[0].toLowerCase()+t.substring(1))+"SystemFallBackStragety";return this[n]?this[n]():"DO_NOTHING_STRAGETY"}},{key:"getFontSystemFallBackReplaceFontArray",value:function(e){var t=this._getFontSystemFallBackName(e);return sa[t]}},{key:"getSpecialSystemOnLoadFontName",value:function(e){var t=this,n=this.getFontSystemFallBackReplaceFontArray(e),i="";return n.some((function(e){if(t.fontDraw.isFontAlreadyInSystem(e))return i=e,!0})),i}},{key:"_doQingHeiWCommonSystemFallBackStragety",value:function(){return"STRAGETY_1"}},{key:"_doQingHeiW3SystemFallBackStragety",value:function(){return this._doQingHeiWCommonSystemFallBackStragety()}},{key:"_doQingHeiW6SystemFallBackStragety",value:function(){return this._doQingHeiWCommonSystemFallBackStragety()}},{key:"fontServer",get:function(){return this._fontServer}},{key:"useCoreTypo",get:function(){return this.fontServer.doc.useCoreTypo}},{key:"fontDraw",get:function(){return this.fontServer.docFontDraw}}]),e}(),ua=n(1143),ca=n(3480),ha=n(676),da=function(){function e(t){l()(this,e),this.fontServer=t,this.cssDataCaches=new Map,this.fontResourcesCaches=new Map}return c()(e,[{key:"_getFontCssKey",value:function(e){return e+"_css"}},{key:"_getFontResKey",value:function(e,t){return e+"_"+t}},{key:"_getFontPrefaces",value:function(e){return e+"_preface"}},{key:"downloadCssFile",value:function(e,t){var n=this;return new Promise((function(i,o){var a=t.name,r=e+"/"+t.cssConfig,s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE&&200===s.status)try{var e=s.responseText,t=n._getFontCssKey(a);return n.cssDataCaches.set(t,e),i({familyName:a,key:t,data:e})}catch(e){o(e.message+" "+e.name+" "+e.fileName+" "+e.lineNumber+" "+e.columnNumber+" "+e.stack)}},s.open("GET",r),s.responseType="text",s.send()}))}},{key:"downloadFontResource",value:function(e,t,n){var i=this,o=this.fontServer.downloadQueue[e]||{},a=new Promise((function(a,r){var s=new XMLHttpRequest;s.onabort=function(){r("promise reject: download font resource: abort")},s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE)if(200===s.status)try{var n=s.response,l=i._getFontResKey(e,t);i.fontResourcesCaches.set(l,n),a({familyName:e,faceName:t,key:l,data:n})}catch(e){r(e.message+" "+e.name+" "+e.fileName+" "+e.lineNumber+" "+e.columnNumber+" "+e.stack)}else St.isMobile&&(o.aborted||(r("promise reject: download font resource: network error"),o.fail=!0))},St.isMobile&&(s.onprogress=function(e){e.lengthComputable&&o&&(o.total=e.total,o.completed=e.loaded)}),s.open("GET",n),s.responseType="arraybuffer",St.isMobile&&o.aborted?r("promise reject: download font resource: mobile abort"):s.send(),St.isMobile&&(o.xhr=s)}));return St.isMobile&&Object(ha.enableFinally)(a).finally((function(){o.downloading=!1})),a}},{key:"cacheFontResourceAndCssResource",value:function(){var e=this;this.cacheResource(this.fontResourcesCaches).then((function(){return e.cacheResource(e.cssDataCaches)}))}},{key:"cacheResource",value:function(e){var t=e.keys();return new Promise((function(n,i){!function e(t,o){var a=o.next();if(a.done)return n();ca.has(a.value).then((function(){console.log("%c------ "+a.value+" already cached ------","color: #ccc;"),setTimeout((function(){e(t,o)}),500)})).catch((function(){ca.write(a.value,t.get(a.value),(function(n){n?(console.error(a.value+" cache fail"),i("promise reject: cache resource: storage write error")):(console.log("%c------ "+a.value+" cache success ------","color: green;"),setTimeout((function(){e(t,o)}),500))}),!0)}))}(e,t)}))}},{key:"requestFontResource",value:function(e,t){var n=this,i=void 0,o=void 0,a=t.name,r=t.faces.map((function(t){return i=t.fn,o=e+"/"+i,n.downloadFontResource(a,i,o)}));return Promise.all(r)}},{key:"_saveFontPreface",value:function(e){var t=this;return new Promise((function(n,i){var o=e.name,a=e.cssConfig,r=e.faces,s=[];r.forEach((function(e){s.push(e.fn)}));var l={name:o,cssFileName:a,faces:s};ca.write(t._getFontPrefaces(o),l,(function(e){if(e)return i(e);n(l)}),!0)}))}},{key:"addFont",value:function(e,t){return Promise.all([this._saveFontPreface(e),this.downloadCssFile(t,e),this.requestFontResource(t,e)])}},{key:"getFontPrefaceData",value:function(e){var t=this;return new Promise((function(n,i){ca.read(t._getFontPrefaces(e),(function(t,o,a){return o?n({familyName:e,key:a,data:o}):i({familyName:e,key:a})}))}))}},{key:"getFontData",value:function(e){var t=this,n=this.fontServer.docFontDraw.serverFontMap.get(e).faces,i=void 0,o=n.map((function(n){return i=t._getFontResKey(e,n.fn),t.fontResourcesCaches.has(i)?Promise.resolve({familyName:e,faceName:n.fn,key:i,data:t.fontResourcesCaches.get(i)}):new Promise((function(o,a){ca.read(t._getFontResKey(e,n.fn),(function(r,s,l){return s?(t.fontResourcesCaches.set(i,s),o({familyName:e,faceName:n.fn,key:l,data:s})):a({familyName:e,faceName:n.fn,key:l})}))}))}));return Promise.all(o)}},{key:"getCSSData",value:function(e){var t=this,n=this._getFontCssKey(e);return this.cssDataCaches.has(n)?Promise.resolve({familyName:e,key:n,data:this.cssDataCaches.get(n)}):new Promise((function(i,o){ca.read(n,(function(a,r,s){return r?(t.cssDataCaches.set(n,r),i({familyName:e,key:s,data:r})):o({familyName:e,key:s})}))}))}},{key:"generateGetFontDataArray",value:function(e){var t=this,n=this.fontServer.docFontDraw.serverFontMap.get(e).faces;return Promise.all(n.map((function(n){return new Promise((function(i,o){ca.read(t._getFontResKey(e,n.fn),(function(t,a,r){return a?i({familyName:e,faceName:n.fn,key:r,data:a}):o({familyName:e,faceName:n.fn,key:r})}))}))})))}},{key:"isFontInStorage",value:function(e){var t=this,n=this.fontServer.docFontDraw.serverFontMap;return this.fontServer._requestServerFontList().then((function(){if(n.has(e)){var i=n.get(e).faces.map((function(n){var i=t._getFontResKey(e,n.fn);return t.fontResourcesCaches.has(i)?Promise.resolve():ca.has(i)})),o=t._getFontCssKey(e),a=void 0;return a=t.cssDataCaches.has(o)?Promise.resolve():ca.has(o),Promise.all([a].concat(r()(i)))}return Promise.reject("promise reject: fontFamily not found in remote resource list")}))}}]),e}(),pa=n(2182),fa=n(1292),ga=0,va=1,ma=2,_a=3,ya=function(){function e(t){l()(this,e),this._serverFontMap=new Map,this._fontServerUrlPrefix=null,this._serverFontListState=ga,this._fontServer=t,this._docFontChecker=new pa.a,this._alreadyInSystemFontMap=pa.b}return c()(e,[{key:"isServerFontNeedLoading",value:function(){switch(this._serverFontListState){case ga:case _a:return!0;case va:case ma:default:return!1}}},{key:"isFontRequestNeedCache",value:function(){switch(this._serverFontListState){case ga:case _a:case va:return!0;case ma:default:return!1}}},{key:"isServerFontCanLoad",value:function(e){return fa.founderFontList.includes(e)?this.fontServer.checkIsFounderFontAvailable(e):!!this.serverFontMap.has(e)}},{key:"isFontAlreadyInSystem",value:function(e){return this._docFontChecker.checkFontEfficiencyVersion(e)}},{key:"isFontAlreadyInSystemIncludeEnglishName",value:function(e){if(this.isFontAlreadyInSystem(e))return!0;var t=Xo.a.getPureFontName(e);return!!t&&this.isFontAlreadyInSystem(t)}},{key:"isFontAlreadyInSystemSpecialSolve",value:function(e){return""!==this.fontServer.docSystemFontFallBack.getSpecialSystemOnLoadFontName(e)}},{key:"startLoadServerFont",value:function(e){return this.fontServer.fontStorage.addFont(this.serverFontMap.get(e),this.fontServerPrefix)}},{key:"initFontServerPrefix",value:function(e){if(e){var t=e.lastIndexOf("/");return this._fontServerUrlPrefix=e.substring(0,t),this._fontServerUrlPrefix}}},{key:"startLoadServerFontList",value:function(e){var t=this,n=this._serverFontMap;return new Promise((function(i,o){t._serverFontListState=va,window.__WPSENV__.reduxDispatch(e).then((function(e){e.error?(t._serverFontListState=_a,o(e.error)):(e.response.body.forEach((function(e){n.set(e.name,e)})),t._serverFontListState=ma,i())}))}))}},{key:"updateAlreadyInSystemCacheMap",value:function(e){return this.removeAlreadyInSystemFontCache(e),this.isFontAlreadyInSystem(e)}},{key:"removeAlreadyInSystemFontCache",value:function(e){e?this._alreadyInSystemFontMap.delete(e):this._alreadyInSystemFontMap.clear()}},{key:"getDynamicInsertCSSFontClassName",value:function(e){return"dynamic-insert-font-draw-css-info-"+e}},{key:"getFontNotReadyReplaceFamilyName",value:function(e){return"replacing-family-name-progress-"+e}},{key:"getFontNotReadyReplaceClassFlag",value:function(e){return"replacing-family-name-progress-class-"+e}},{key:"fontServer",get:function(){return this._fontServer}},{key:"fontServerPrefix",get:function(){return this._fontServerUrlPrefix}},{key:"serverFontMap",get:function(){return this._serverFontMap}}]),e}(),ba=n(5743),Ta=n(5738),Ca=n(3857),ka=n(1910),wa=n(1318),Sa=n(4577),Pa=n(7759),Ia=n.n(Pa),Ea=n(2700),Oa=wa.c.DOCCharTypeFastDetecter,xa=1,Ra=2,Na=3,Aa=4,Da={NOT_EXIST:0,ERROR_RETRY_01:2,ERROR_RETRY_02:3,ERROR_RETRY_03:4,ERROR_RETYR_END:5,ERROR_WAITING2_RESTART:6,ERROR_REPLACING_CSS:7,INIT:8,FONT_WAITING2_START_DOWNLOAD:9,CHECKING:10,PREPARE_LOAD:11,PRE_INSERT_CSS:12,FINISH:13,NOT_IN_LOCAL_FALL_BACK_LIST:14,IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE:15,FONT_ALREADY_IN_SYSTEM:16,FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME:17,FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE:18},Ma=1,La=2,Fa=3,Ba=4,Ha=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),Ga=function(){function e(t){if(l()(this,e),this._requestServerFontList=function e(){var t=this.docFontDraw;if(t.isServerFontNeedLoading()){var n=this;t.initFontServerPrefix(window.__CONFIG__.wps.cdnFontsJson),e.requestPromise=t.startLoadServerFontList(Object(Ea.a)()).then((function(){console.log("request ServerFont list finish");var e=n.loadingFontsCache.length;console.log("now start to refetch cached font when font is preparing, the fonts are"),console.log(n.loadingFontsCache),n.loadingFontsCache.forEach((function(e,t,i){n._startRefetchFontDraw(e)}));var t=n.loadingFontsCache.splice(0,e);console.log("remove fonts are",t,"new length: ",n.loadingFontsCache.length),console.log("now fonts",n.loadingFontsCache)}))}return e.requestPromise||Promise.resolve()},this.mapFontName=function(e){if("default"===e.toLowerCase())return"default";var t=e;return t=t.toLowerCase(),t=(t=ua.base64.encode(t)).replace(/\//g,"_")},this._toJavaInt=function(e){return e>2147483647||e<-2147483648?4294967295&e:e},this._decimalToHex=function(e){var t=e;t<0&&(t=4294967295+t+1);var n=Number(t).toString(16);return n="00000000".substr(0,8-n.length)+n},Ha())return Ha();Object(p.default)(this),this.metricsMap={},this.metricsStateMap={},this.fontRangesMap={},this.localMetricsMapForEmphasis={},this.localMetricsMap={},this.drawStateMap={},this.drawResStateMap={},this.drawRangesMap={},this.loadingFontsCache=[],this.downLoadingFontsMap=new Map,this.downloadQueue={},this.docFontFallBack=new oa(this),this.fontStorage=new da(this),this.docFontDraw=new ya(this),this.docSystemFontFallBack=new la(this),this.isDelayTasksRequired=St.isMobile,this.delayTasks=[],this.usedFonts=new Set,this.docNormalCharMeasurer=new Ca.a,this.DRAWFONT_STATE=Da,this.founderFontPrivilege=$o.privileges.font_founder_official,Ha(this),this.setupDebugTools(),this.checkPrivilege()}var t,n,i;return c()(e,[{key:"init",value:function(e){this.doc&&this.doc.detachObserver(this),this.doc=e,this.doc.attachObserver(this),St.isMobile||this._requestServerFontList()}},{key:"checkPrivilege",value:function(){Object($o.getPrivileges)().then((function(e){var t=this;if(e.font_founder_official&&e.font_founder_official!==this.founderFontPrivilege){var n=!1;fa.founderFontList.forEach((function(e){void 0!==t.drawStateMap[e]&&t.drawStateMap[e]!==Da.FONT_ALREADY_IN_SYSTEM&&(delete t.drawStateMap[e],n=!0)})),n&&this._onFontUpdate([{pos:0,len:this.doc.getMainTextLength()}]),this.founderFontPrivilege=e.font_founder_official}})).catch(Function.prototype)}},{key:"execTask",value:function(e,t){if(this.isDelayTasksRequired)this.delayTasks.push({func:e,params:t});else try{"function"==typeof e&&void 0!==t&&e.apply(this,t)}catch(e){console.error("任务执行失败……",e.message)}}},{key:"afterOpen",value:function(){var e=this;St.isMobile?(this.isDelayTasksRequired=!1,this._requestServerFontList(),this.delayTasks.forEach((function(t){var n=t.func,i=t.params;e.execTask(n,i)})),this.delayTasks=[]):window.APP.isPreview||Ia()((function(t){e.fontFamiliesInfo=t,e.fontFamiliesInfo.getAvailableFonts(!1)}))}},{key:"setupDebugTools",value:function(){var e=this;window.isDebugger&&(this.clearAllLocalStorage=function(){var t=e.fontStorage.fontResourcesCaches,n=e.fontStorage.cssDataCaches;t.clear(),n.clear(),ca.clear((function(){console.log("%c清除完毕，清除完毕！！！！！！！！！！！！！","color:red")}))},this.printFontUseState=function(){var t=Object.keys(e.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE})),n={};t.forEach((function(t){n[t]=e.docFontFallBack.getSystemOnLoadFontName(t)})),console.log("-------------回落在系统里面的字体映射表------------------",n),(t=Object.keys(e.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.FONT_ALREADY_IN_SYSTEM}))).length>0&&console.log("-----------字体本身就在系统里面的有-------------",t),t=Object.keys(e.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME})),n={},t.forEach((function(e){n[e]=Xo.a.getPureFontName(e)})),t.length>0&&console.log("-----------字体本身不在系统里面，但是英文名字在系统里面-------------",n),t=Object.keys(e.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE})),n={},t.forEach((function(t){n[t]=e.docSystemFontFallBack.getSpecialSystemOnLoadFontName(t)})),t.length>0&&console.log("-----------字体本身不在系统里面，但是经过特殊替换后对应的字体名字在系统里面-------------",n),t=Object.keys(e.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.FINISH})),n={},t.forEach((function(t){n[t]=e.docFontFallBack.getFontFallBackDownLoadFontName(t)})),t.length>0&&console.log("---------------通过下载生效的字体样式列表-------------",n),(t=Object.keys(e.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.NOT_IN_LOCAL_FALL_BACK_LIST}))).length>0&&console.log("---------------不在回落策略中的字体有----------------",t)})}},{key:"checkIsFounderFontAvailable",value:function(e){if(fa.founderFontList.includes(e)&&$o.privileges.font_founder_official&&this.docFontDraw.serverFontMap.has(e))return!0;return!1}},{key:"getFontHeight",value:function(e,t){var n=e.family,i=e.bold,o=e.italic,a=e.size,r=n+"_"+this.getFontStyle(i,o),s=this.getFontMetrics(r);if(s){var l=s.getFontHeight(a,t);if(l)return l}else{var u=this.mapFontFaceToKey(e),c=this.localMetricsMap[u];if(c)return c.height}}},{key:"getFontHoriWidth",value:function(e,t){var n=t.family,i=t.bold,o=t.italic,a=t.size,r=n+"_"+this.getFontStyle(i,o),s=this.getFontMetrics(r);if(s){var l=s.getFontHoriWidth(e,a);if(l&&l.width&&l.bFindChar)return l}else{var u=this.mapFontFaceToKey(t),c=this.localMetricsMap[u];if(c&&c[e])return c[e].horiWidth}return null}},{key:"getFontActualPaintBoxRelativeCenterPos",value:function(e,t){var n=this.getEmphasizeMeasureData(t,e);return n?n.centerPos:null}},{key:"getFontActualPaintBoxSize",value:function(e,t){var n=this.getEmphasizeMeasureData(t,e);return n?n.size:null}},{key:"isFontResReady",value:function(){var e=this.getMetricsNotInStateList(),t=this.getDrawResNotInStateList(),n=e.length+t.length===0;return console.log("isFontResReady",e,t,this.drawStateMap,n),n}},{key:"isFontEffectiveByCSS",value:function(e){return this.drawStateMap[e]===Da.FINISH}},{key:"isFontNeedReplace2FallBackFont",value:function(e){return this.drawStateMap[e]===Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE}},{key:"isFontNeedReplace2EnglishFontName",value:function(e){return this.drawStateMap[e]===Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME}},{key:"isFontNeedReplace2SpecialSoveFontName",value:function(e){return this.drawStateMap[e]===Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE}},{key:"getMissingFontFamilies",value:function(){var e=this,t=[],n=[];Object.keys(this.drawStateMap).forEach((function(i){var o=[Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE,Da.FONT_WAITING2_START_DOWNLOAD].includes(e.drawStateMap[i]),a=e.drawStateMap[i]===Da.NOT_IN_LOCAL_FALL_BACK_LIST;o?t.push(i):a&&n.push(i)}));var i=[],o=t.map((function(t){return e.fontStorage.isFontInStorage(t).catch((function(){i.push(t)}))}));return Promise.all(o).then((function(){return i.concat(n)}))}},{key:"getCurrentDownLoadErrorFont",value:function(){var e=this;return St.isMobile?Object.keys(this.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.ERROR_WAITING2_RESTART})):Object.keys(this.drawStateMap).filter((function(t){return e.drawStateMap[t]>=Da.ERROR_RETRY_01&&e.drawStateMap[t]<Da.ERROR_RETYR_END}))}},{key:"getCurrentDownLoadErrorFontRes",value:function(){var e=this;return Object.keys(this.drawResStateMap).filter((function(t){return e.drawResStateMap[t]===Fa}))}},{key:"getCurrentWait2DownLoadFont",value:function(){var e=this,t=Object.keys(this.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.FONT_WAITING2_START_DOWNLOAD})),n=[],i=t.map((function(t){var i=e.docFontFallBack.getFontFallBackDownLoadFontName(t);return e.fontStorage.isFontInStorage(i).catch((function(){n.push(t)}))}));return Promise.all(i).then((function(){return n}))}},{key:"getCurrentWait2DownLoadFontRes",value:function(){var e=this,t=Object.keys(this.drawStateMap).filter((function(t){return e.drawStateMap[t]===Da.FONT_WAITING2_START_DOWNLOAD})),n=new Set,i=[],o=t.map((function(t){var i=e.isAllowFallback?e.docFontFallBack.getFontFallBackDownLoadFontName(t):t;return e.fontStorage.isFontInStorage(i).catch((function(){n.add(i)}))}));return Promise.all(o).then((function(){return n.forEach((function(e){return i.push(e)})),i}))}},{key:"getCurrentWait2DownLoadCertainFontResAllFonts",value:function(e){var t=this;return Object.keys(this.drawStateMap).filter((function(n){return t.drawStateMap[n]===Da.FONT_WAITING2_START_DOWNLOAD&&t.docFontFallBack.getFontFallBackDownLoadFontName(n)===e}))}},{key:"getCurrentWait2DownLoadWebFonts",value:function(){var e=this,t=Object.keys(this.drawStateMap),n=this.docFontDraw.serverFontMap,i=t.filter((function(e){var t=fa.founderFontList.includes(e);return!!n.has(e)&&(!t||$o.privileges.font_founder_official)})),o=i.map((function(t){return e.checkFontResourceAvailable(t,!0)}));return Promise.all(o).then((function(e){var t=[];return e.forEach((function(e,n){e||t.push(i[n])})),t}))}},{key:"getMetricsNotInStateList",value:function(){var e=this;return Object.keys(this.metricsStateMap).filter((function(t){switch(e.metricsStateMap[t]){case xa:return!0;default:return!1}}))}},{key:"getDrawResNotInStateList",value:function(){var e=this;return Object.keys(this.drawStateMap).filter((function(t){return e.isFontNotInState(t)}))}},{key:"isFontNotInState",value:function(e){switch(this.drawStateMap[e]){case Da.INIT:case Da.CHECKING:case Da.PREPARE_LOAD:case Da.PRE_INSERT_CSS:case Da.ERROR_RETRY_01:case Da.ERROR_RETRY_02:case Da.ERROR_RETRY_03:return!0;default:return!1}}},{key:"addFontHeightMetrics",value:function(e,t){var n=this.mapFontFaceToKey(e);this.localMetricsMap[n]||(this.localMetricsMap[n]={}),this.localMetricsMap[n].height=t}},{key:"clearInvalidFontHeightMetics",value:function(){var e=this;Object.keys(this.localMetricsMap).forEach((function(t){var n=e.localMetricsMap[t];n&&n.height&&!n.height.height&&(e.localMetricsMap[t]=void 0)}))}},{key:"addFontHoriWidthMetrics",value:function(e,t,n){var i=this.mapFontFaceToKey(e);this.localMetricsMap[i]||(this.localMetricsMap[i]={});var o=this.localMetricsMap[i];o[t]||(o[t]={}),o[t].horiWidth=n}},{key:"addFontActualPaintBoxRelativeCenterPos",value:function(e,t){this.localMetricsMapForEmphasis[e]||(this.localMetricsMapForEmphasis[e]={}),this.localMetricsMapForEmphasis[e].centerPos=t}},{key:"addFontActualPaintBoxSize",value:function(e,t,n){this.localMetricsMapForEmphasis[e]||(this.localMetricsMapForEmphasis[e]={}),this.localMetricsMapForEmphasis[e].size={width:t,height:n}}},{key:"getMetricsLocalKey",value:function(e){var t=this.docNormalCharMeasurer.parseFontFace(e);return this.mapFontFaceToKey(t)}},{key:"getEmphasisMetricsLocalKey",value:function(e,t){return this.getMetricsLocalKey(e)+"_"+t}},{key:"getFontFace",value:function(e){var t=e.family,n=e.bold,i=e.italic,o=t+"_"+this.getFontStyle(n,i),a=this.getFontMetrics(o);return a?a.fontFace:null}},{key:"preload",value:function(){var e=this,t=[];for(var n in qo.a){[{family:n,bold:!1,italic:!1},{family:n,bold:!0,italic:!1},{family:n,bold:!1,italic:!0},{family:n,bold:!0,italic:!0}].forEach((function(n){t.push(new Promise((function(t){e._loadFontMetricsInfo(n,void 0,(function(){t()}))})))}))}Promise.all(t).then((function(){e._onFontUpdate(e.doc.concernRanges)}))}},{key:"requestLoadFontResource",value:function(e,t){this.execTask(this._loadFontDrawInfo,[e,t])}},{key:"requestLoadEmphasize",value:function(e,t,n){this.execTask(this._loadEmphasize,[e,t,n])}},{key:"requestLoadFontResourceToPreview",value:function(e){this.execTask(this._loadFontDrawInfoToPreview,[e])}},{key:"beforeHandleFontNameEmphasizeFileterTarget",value:function(e){var t=this;if(!window.APP.isEnableEmphasisMeasurer())return null;var n=this.getFontName(e),i=window.APP.data.selection.getNormalRange(),o=i.pos,a=i.len;if(i.len<=0)return null;var r=this.doc.getDataLogic("final").collectChpxs(o,a),s=[],l={};return r.forEach((function(e){var i=e.pos;if(!t.checkCurrentPosExistEmphasize(i))return!1;var o=e.prop.getProp("emphasis_type").val,a=e.prop.getProp("east_asia_language").val,r=Object(Ta.a)(a,o).renderText;return!l[r]&&(l[r]=!0,!t.checkIsEmphasizeMeasureExist(n,r)&&void s.push(r))})),s}},{key:"prepareEmphasizeFontInfoForSetFamily",value:(i=jo()(regeneratorRuntime.mark((function e(t){var n,i,o,a,r,s,l,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.beforeHandleFontNameEmphasizeFileterTarget(t),i=this.getFontName(t),n&&!(n.length<=0)){e.next=4;break}return e.abrupt("return");case 4:o=this.docNormalCharMeasurer.emphasizeMeasurer,(a={}).fontSize=Sa.c,a.fontStyle="",a.fontWeight="",a.fontFamily=i,r=0;case 11:if(!(r<n.length)){e.next=33;break}if(s=n[r],l=this.getEmphasizeMeasureKey(i,s),o.getMeasurerState(l)===Sa.d.INIT){e.next=17;break}return e.abrupt("continue",30);case 17:return o.updateEmphasisMeasurerState(l,Sa.d.IN_PROGRESS),e.prev=18,e.next=21,o.startMeasurer(a,s);case 21:u=e.sent,this.addFontActualPaintBoxRelativeCenterPos(l,u.centerPoint),this.addFontActualPaintBoxSize(l,u.width,u.height),o.updateEmphasisMeasurerState(l,Sa.d.FINISH),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(18),o.updateEmphasisMeasurerState(l,Sa.d.ERROR);case 30:++r,e.next=11;break;case 33:case"end":return e.stop()}}),e,this,[[18,27]])}))),function(e){return i.apply(this,arguments)})},{key:"beforeHandleEmphasizeMaskFileterTarget",value:function(e){var t=this;if(!window.APP.isEnableEmphasisMeasurer())return null;var n=window.APP.data.selection.getNormalRange(),i=n.pos,o=n.len;if(n.len<=0)return null;var a=this.doc.getDataLogic("final").collectChpxs(i,o),r=[],s={};return a.forEach((function(n){var i=n.pos,o=t.doc.getText(i,1),a=Oa.getUnicodeCharItem(o.charCodeAt(0)),l=ka.a.getFontIndex({},a.charClass,n.prop),u=t.doc.fonttable.getName(l),c=t.getFontName(u),h=n.prop.getProp("east_asia_language").val,d=Object(Ta.a)(h,e).renderText,p=t.getEmphasizeMeasureKey(c,d);return!s[p]&&(s[p]=!0,!t.checkIsEmphasizeMeasureExist(c,d)&&void r.push({fontFamily:u,renderText:d}))})),r}},{key:"prepareEmphasizeFontInfoForSetEmphasisMask",value:(n=jo()(regeneratorRuntime.mark((function e(t){var n,i,o,a,r,s,l,u,c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==ba.a){e.next=2;break}return e.abrupt("return");case 2:if((n=this.beforeHandleEmphasizeMaskFileterTarget(t))&&!(n.length<=0)){e.next=5;break}return e.abrupt("return");case 5:i=this.docNormalCharMeasurer.emphasizeMeasurer,(o={}).fontSize=Sa.c,o.fontStyle="",o.fontWeight="",a=0;case 11:if(!(a<n.length)){e.next=37;break}if(r=n[a],s=r.renderText,l=r.fontFamily,u=this.getFontName(l),o.fontFamily=u,c=this.getEmphasizeMeasureKey(u,s),i.getMeasurerState(c)===Sa.d.INIT){e.next=21;break}return e.abrupt("continue",34);case 21:return i.updateEmphasisMeasurerState(c,Sa.d.IN_PROGRESS),e.prev=22,e.next=25,i.startMeasurer(o,s);case 25:h=e.sent,this.addFontActualPaintBoxRelativeCenterPos(c,h.centerPoint),this.addFontActualPaintBoxSize(c,h.width,h.height),i.updateEmphasisMeasurerState(c,Sa.d.FINISH),e.next=34;break;case 31:e.prev=31,e.t0=e.catch(22),i.updateEmphasisMeasurerState(c,Sa.d.ERROR);case 34:++a,e.next=11;break;case 37:case"end":return e.stop()}}),e,this,[[22,31]])}))),function(e){return n.apply(this,arguments)})},{key:"getEmphasizeMeasureKey",value:function(e,t){return e+"_"+t}},{key:"checkIsEmphasizeMeasureExist",value:function(e,t){var n=this.getEmphasizeMeasureKey(e,t);return null!==this.localMetricsMapForEmphasis[n]&&void 0!==this.localMetricsMapForEmphasis[n]}},{key:"getEmphasizeMeasureData",value:function(e,t){var n=this.getEmphasizeMeasureKey(e,t);return this.localMetricsMapForEmphasis[n]}},{key:"_onFontUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.length&&this._dispatch("onFontUpdate",e)}},{key:"load",value:function(e,t){var n=this;!St.isMobile&&this.doc.useCoreTypo&&this._loadFontMetricsInfo(e,t,(function(e){e&&e.newLoaded&&n._onFontUpdate(e.ranges)})),this.execTask(this._loadFontDrawInfo,[e,t])}},{key:"startLoadWaitingFont",value:function(){var e=this;this.getCurrentWait2DownLoadFont().then((function(t){t.forEach((function(t,n){e._fetchFontDrawMappingExist(t)}))}))}},{key:"startLoadErrorFont",value:function(){var e=this;this.getCurrentDownLoadErrorFont().forEach((function(t){e._fetchFontDrawMappingExist(t)}))}},{key:"_loadFontMetricsInfo",value:function(e,t,n){var i=e.family,o=e.bold,a=e.italic,r=i+"_"+this.getFontStyle(o,a);this.metricsStateMap[r]==xa?(this.addFontRange(r,t),n&&n()):this.metricsStateMap[r]==Ra||this.metricsStateMap[r]==Na?n&&n():(this.metricsStateMap[r]=xa,this.fontRangesMap[r]=new Vt.default,this.addFontRange(r,t),this.fetchFontMetrics(i,o,a,!0,n))}},{key:"_updateFontResState",value:function(e,t){if(this.drawResStateMap[e]=t,this.isAllowFallback)switch(t){case La:this._refetchWaitingLoadFinish(e),this._refretchWaiting2DownLoadFonts(e)}}},{key:"_updateFontErrorDrawState",value:function(e){var t=this;if(St.isMobile)this.drawStateMap[e]=Da.ERROR_WAITING2_RESTART;else switch(this.drawStateMap[e]){case Da.ERROR_RETRY_01:this.drawStateMap[e]=Da.ERROR_RETRY_02,setTimeout((function(){t._fetchFontDrawMappingExist(e)}),2e3);break;case Da.ERROR_RETRY_02:this.drawStateMap[e]=Da.ERROR_RETRY_03,setTimeout((function(){t._fetchFontDrawMappingExist(e)}),2e3);break;case Da.ERROR_RETRY_03:this.drawStateMap[e]=Da.ERROR_RETYR_END,this.isEnableDrawRangeCache&&this.getAndRemoveDrawRanges(e);break;default:this.drawStateMap[e]=Da.ERROR_RETRY_01,setTimeout((function(){t._fetchFontDrawMappingExist(e)}),2e3)}}},{key:"updateFontDrawStateCheck",value:function(e){return!this.drawStateMap[e]}},{key:"_updateFontDrawState",value:function(e,t){var n=this.docFontDraw,i=this.drawStateMap[e];switch(t){case Da.ERROR_REPLACING_CSS:case Da.NOT_EXIST:this.drawStateMap[e]=t,this.isEnableDrawRangeCache&&this.getAndRemoveDrawRanges(e);break;case Da.NOT_IN_LOCAL_FALL_BACK_LIST:this.drawStateMap[e]=t,this.isEnableDrawRangeCache&&this.getAndRemoveDrawRanges(e),oe.default.dispatchEvent(oe.default.names.DOC_FONT_MISSING,{fontName:e});break;case Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE:this.drawStateMap[e]=t,this.isEnableDrawRangeCache&&this.getAndRemoveDrawRanges(e);break;case Da.FONT_WAITING2_START_DOWNLOAD:this.drawStateMap[e]=t,oe.default.dispatchEvent(oe.default.names.DOC_FONT_WAIT_TO_LOAD,{fontName:e});break;case Da.FINISH:this.drawStateMap[e]=t,this.clearLocalMetricsByFontFamily(e),n.updateAlreadyInSystemCacheMap(e),oe.default.dispatchEvent(oe.default.names.DOC_FONT_LOAD_CHANGE,{fontName:e}),this.isEnableDrawRangeCache?this._onFontUpdate(this.getAndRemoveDrawRanges(e)):this._onFontUpdate([{pos:0,len:this.doc.textStream.getTextSize()}]);break;case Da.FONT_ALREADY_IN_SYSTEM:case Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME:case Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE:this.drawStateMap[e]=t,this.isEnableDrawRangeCache&&this.getAndRemoveDrawRanges(e);break;case Da.CHECKING:case Da.PREPARE_LOAD:case Da.PRE_INSERT_CSS:if(i>=Da.ERROR_RETRY_01&&i<=Da.ERROR_WAITING2_RESTART)return;this.drawStateMap[e]=t;break;default:this.drawStateMap[e]=t}}},{key:"_startRefetchFontDraw",value:function(e){this._fetchFontDraw(e,!0)}},{key:"_insertFontDrawCSSInfo",value:function(e,t){"undefined"!=typeof FontFace?this._insertFontDrawCSSInfoCommon(e,t):this._insertFontDrawCSSInfoForNotSupportFontFace(e,t)}},{key:"_fixFontFaceSpaceFontNameProblem",value:function(e){var t=e;if(St.isIos)if(St.isSafari&&!St.isIosChrome){var n=new RegExp("version/(\\d+)"),i=St.agent.match(n);t=i&&parseInt(i[1])>=13?e:'"'+e+'"'}else{var o=St.iosVersion,a=St.isIPad;t=o<13&&!a?'"'+e+'"':e}else if(St.isMacOs)if(St.isSafari){var r=new RegExp("version/(\\d+)"),s=St.agent.match(r);t=s&&parseInt(s[1])>=13?e:'"'+e+'"'}else t=e;else St.isFirefox&&(t='"'+e+'"');return t}},{key:"_insertFontDrawCSSInfoCommon",value:function(e,t){var n=this,i=e.fontResData,o=this;i.forEach((function(e){var i=e.data,a=n._fixFontFaceSpaceFontNameProblem(t);new FontFace(a,i).load().then((function(e){return document.fonts.add(e),o._updateEmphasizeInfo(t)})).then((function(){o._updateFontDrawState(t,Da.FINISH)})).catch((function(e){console.error("出现了异常啦！！！！！！！",t),console.error(e.message),o._updateFontDrawState(t,Da.ERROR_REPLACING_CSS)}))}))}},{key:"_insertFontDrawCSSInfoForNotSupportFontFace",value:function(e,t){var n=this,i=e.cssData,o=e.fontResData,a=i.familyName,r=i.data,s=window.document.getElementsByTagName("head")[0],l=this.docFontDraw;o.forEach((function(e){var n=e.data,i=e.faceName,o=new Blob([n],{type:"application/x-font-woff"}),s=URL.createObjectURL(o);r=r.replace(i,s),t!==a&&(r=(r=r.replace(a,t)).replace("}","font-display: swap; }"))}));var u=document.createElement("style"),c=l.getDynamicInsertCSSFontClassName(t);u.className=c,u.type="text/css",u.innerHTML=r,s.appendChild(u);var h=40,d=setInterval((function(){document.getElementsByClassName(c).length>0?(clearInterval(d),n._updateFontDrawState(t,Da.FINISH)):--h<=0&&(clearInterval(d),n._updateFontDrawState(t,Da.ERROR_REPLACING_CSS))}),50)}},{key:"_downLoadFont",value:function(e,t){var n=this,i=this.docFontDraw;console.log("%c------- "+t+" does not exist in localForage, start to download -------","color: red;");var o=function(){if(console.log("%c-----------------downLoadFont familyName finished------------------------","color: green;",e,t),St.isMobile){var i=!0;for(var o in n.downloadQueue)if(n.downloadQueue[o].downloading){i=!1;break}i&&(oe.default.dispatchEvent(oe.default.mobile.FONT_DOWNLOAD.ON_FONT_RESOURCE_DOWNLOAD_FINISHED),n.fontStorage.cacheFontResourceAndCssResource())}else n.fontStorage.cacheFontResourceAndCssResource()};return i.startLoadServerFont(t).then((function(i){n._updateFontDrawState(e,Da.PRE_INSERT_CSS),n._updateFontResState(t,La),n._changeCSSStyle({cssData:i[1],fontResData:i[2]},e)})).catch((function(i){console.log("%cdownload ERROR: ","color:red;",i),"abort"===i?(n._updateFontResState(t,Ba),n._updateFontDrawState(e,Da.FONT_WAITING2_START_DOWNLOAD)):(oe.default.dispatchEvent(oe.default.mobile.FONT_DOWNLOAD.ON_FONT_RESOURCE_DOWNLOAD_ERROR,{fontFamilyName:e}),n._updateFontResState(t,Fa),n._updateFontErrorDrawState(e))})).then((function(e){return o(),Promise.resolve(e)})).catch((function(e){return o(),Promise.reject(e)}))}},{key:"_changeCSSStyle",value:function(e,t){this._insertFontDrawCSSInfo(e,t)}},{key:"_startLoadFonts",value:function(e,t){var n=null;switch(this.drawResStateMap[e]){case Ma:return this.downLoadingFontsMap.has(e)||(n=new Set,this.downLoadingFontsMap.set(e,n)),(n=this.downLoadingFontsMap.get(e)).add(t),!1;default:return!0}}},{key:"_refetchWaitingLoadFinish",value:function(e){var t=this;if(this.downLoadingFontsMap.has(e)){var n=this.downLoadingFontsMap.get(e);this.downLoadingFontsMap.delete(e),console.log("_refetchWaitingLoadFinish",e,n),n.forEach((function(e){t._startRefetchFontDraw(e)})),n.clear()}}},{key:"_refretchWaiting2DownLoadFonts",value:function(e){var t=this,n=this.getCurrentWait2DownLoadCertainFontResAllFonts(e);console.log("_refretchWaiting2DownLoadFonts",n),n.forEach((function(e){t._startRefetchFontDraw(e)}))}},{key:"_fetchFontDrawWithoutFallback",value:function(e){var t=this;if(!this.docFontDraw.isFontAlreadyInSystem(e))return this.docFontDraw.isFontAlreadyInSystemIncludeEnglishName(e)?(this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME),void oe.default.dispatchEvent(oe.default.names.DOC_FONT_WAIT_TO_REPLACE,{originalFont:e,font:Xo.a.getPureFontName(e)})):this.docFontDraw.isFontAlreadyInSystemSpecialSolve(e)?(this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE),void oe.default.dispatchEvent(oe.default.names.DOC_FONT_WAIT_TO_REPLACE,{originalFont:e,font:this.docSystemFontFallBack.getSpecialSystemOnLoadFontName(e)})):void this.fontStorage.isFontInStorage(e).then((function(){t._fetchFontDrawMappingExist(e)})).catch((function(){St.isMobile?t._requestServerFontList().then((function(){t.docFontDraw.isServerFontCanLoad(e)?t.checkFontResourceCanDirectDownLoad(e)?t._fetchFontDrawMappingExist(e):t._updateFontDrawState(e,Da.FONT_WAITING2_START_DOWNLOAD):t._updateFontDrawState(e,Da.NOT_EXIST)})):t._fetchFontDrawMappingExist(e)}));this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM)}},{key:"_fetchFontDraw",value:function(e,t){var n=this;if(this.docFontFallBack.isFontNeedFallBack(e)){if(this._flagAlreadyInSystemFont(e))return;var i="",o=function(){n.fontStorage.isFontInStorage(i).then((function(){n._fetchFontDrawMappingExist(e)})).catch((function(){St.isMobile&&!t?n.docFontFallBack.checkFontNeed2DownLoad(e)?n._requestServerFontList().then((function(){var t=n.docFontFallBack.getFontFallBackDownLoadFontName(e);n.docFontDraw.serverFontMap.has(t)?n.checkFontResourceCanDirectDownLoad(t)?n._fetchFontDrawMappingExist(e):n._updateFontDrawState(e,Da.FONT_WAITING2_START_DOWNLOAD):n._updateFontDrawState(e,Da.NOT_EXIST)})):n._updateFontDrawState(e,Da.NOT_EXIST):n._fetchFontDrawMappingExist(e)}))};if(this.checkIsFounderFontAvailable(e))return i=e,o();if(this._flagFallBackArrayInSystemFont(e))return;if(""===(i=this.docFontFallBack.getFontFallBackDownLoadFontName(e)))return void this._fetchFontDrawMappingExist(e);o()}else this._updateFontDrawState(e,Da.NOT_IN_LOCAL_FALL_BACK_LIST)}},{key:"preLoadSystemFont",value:function(e){this._flagAlreadyInSystemFont(e),this._flagFallBackArrayInSystemFont(e)}},{key:"_flagFallBackArrayInSystemFont",value:function(e){var t=this.drawStateMap[e];return(!t||t===Da.INIT)&&(""!==this.docFontFallBack.getSystemOnLoadFontName(e)&&(this._updateFontDrawState(e,Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE),!0))}},{key:"_flagAlreadyInSystemFont",value:function(e){var t=this.drawStateMap[e];if(t&&t!==Da.INIT)return!1;if(this.doc.useCoreTypo){if(!qo.b.isMappingExist(e)&&this.docFontDraw.isFontAlreadyInSystem(e))return this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM),!0;if(!qo.b.isMappingExist(e)&&this.docFontDraw.isFontAlreadyInSystemIncludeEnglishName(e))return this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME),!0;if(!qo.b.isMappingExist(e)&&this.docFontDraw.isFontAlreadyInSystemSpecialSolve(e))return this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE),!0}else{if(this.docFontDraw.isFontAlreadyInSystem(e))return this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM),!0;if(this.docFontDraw.isFontAlreadyInSystemIncludeEnglishName(e))return this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME),!0;if(this.docFontDraw.isFontAlreadyInSystemSpecialSolve(e))return this._updateFontDrawState(e,Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE),!0}return!1}},{key:"checkFontResourceAvailable",value:function(e,t){var n="";n=t?this.docFontDraw.isFontAlreadyInSystem(e):this.docFontFallBack.getSystemOnLoadFontName(e);var i=t?e:this.docFontFallBack.getFontFallBackDownLoadFontName(e);return""===i||n||this.downloadQueue[i]&&this.downloadQueue[i].downloading?Promise.resolve(!0):this.fontStorage.isFontInStorage(i).then((function(){return!0})).catch((function(){return!1}))}},{key:"checkFontResourceCanDirectDownLoad",value:function(e){if(window.APP.isPreview&&window.__CONFIG__.wps.svgPreview.autoDownloadFontResourceInMobile)return!0;var t=this.docFontDraw.serverFontMap;return!!t.has(e)&&(!!window.__CONFIG__.wps.mobile.shouldAutoDownloadFontResource||(!(!window.APP.isPreview||!window.__CONFIG__.wps.svgPreview.autoDownloadFontResourceInMobile)||t.get(e).faces[0].sz<102400))}},{key:"_fetchFontDrawMappingExist",value:function(e,t){var n=this,i=this.isAllowFallback&&!t?this.docFontFallBack.getFontFallBackDownLoadFontName(e):e,o=this.docFontDraw;return this._updateFontDrawState(e,Da.CHECKING),o.isFontRequestNeedCache()?(console.log("server font list is not ready, the font need to be cached",e,i),void this.loadingFontsCache.push(e)):o.isServerFontCanLoad(i)?this._startLoadFonts(i,e)?(this._updateFontDrawState(e,Da.PREPARE_LOAD),this._updateFontResState(i,Ma),this.fontStorage.isFontInStorage(i).then((function(){n.getResourceFromLocal(e,i)})).catch((function(){n._downLoadFont(e,i)}))):void console.log("current font is being downloaded",i,e):void this._updateFontDrawState(e,Da.NOT_EXIST)}},{key:"getResourceFromLocal",value:function(e,t){var n=this;console.log("------- %c"+t+" already exist in localForage -------","color: green;");try{Promise.all([this.fontStorage.getCSSData(t),this.fontStorage.getFontData(t)]).then((function(i){var a=o()(i,2),r=a[0],s=a[1];n._updateFontDrawState(e,Da.PRE_INSERT_CSS),n._updateFontResState(t,La),n._changeCSSStyle({cssData:r,fontResData:s},e)}))}catch(e){console.error("apply font resource failed",e)}}},{key:"_loadFontDrawInfoWithOutCacheRange",value:function(e){switch(this.drawStateMap[e]){case Da.PREPARE_LOAD:case Da.CHECKING:case Da.INIT:case Da.PRE_INSERT_CSS:case Da.FONT_WAITING2_START_DOWNLOAD:case Da.ERROR_RETRY_01:case Da.ERROR_RETRY_02:case Da.ERROR_RETRY_03:case Da.ERROR_WAITING2_RESTART:case Da.FINISH:case Da.NOT_EXIST:case Da.NOT_IN_LOCAL_FALL_BACK_LIST:case Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE:case Da.ERROR_RETYR_END:case Da.ERROR_REPLACING_CSS:case Da.FONT_ALREADY_IN_SYSTEM:case Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME:case Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE:break;default:this._updateFontDrawState(e,Da.INIT),this._fetchFontDraw(e)}}},{key:"_loadFontDrawInfoNeedCacheRange",value:function(e,t){if(t)switch(this.drawStateMap[e]){case Da.PREPARE_LOAD:case Da.CHECKING:case Da.INIT:case Da.PRE_INSERT_CSS:case Da.FONT_WAITING2_START_DOWNLOAD:case Da.ERROR_RETRY_01:case Da.ERROR_RETRY_02:case Da.ERROR_RETRY_03:case Da.ERROR_WAITING2_RESTART:this.addDrawRange(e,t);break;case Da.FINISH:case Da.NOT_EXIST:case Da.NOT_IN_LOCAL_FALL_BACK_LIST:case Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE:case Da.ERROR_RETYR_END:case Da.ERROR_REPLACING_CSS:case Da.FONT_ALREADY_IN_SYSTEM:case Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME:case Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE:break;default:this.drawRangesMap[e]=new Vt.default,this._updateFontDrawState(e,Da.INIT),this.addDrawRange(e,t),this._fetchFontDraw(e)}}},{key:"_loadFontDrawInfo",value:function(e,t){var n=e.family;this.isEnableDrawRangeCache?this._loadFontDrawInfoNeedCacheRange(n,t):this._loadFontDrawInfoWithOutCacheRange(n)}},{key:"_loadEmphasize",value:function(e,t,n){var i=this;if(window.APP.isEnableEmphasisMeasurer()){var o=this.getFontName(e),a=this.docNormalCharMeasurer.emphasizeMeasurer,r=this.getEmphasizeMeasureKey(o,t);switch(a.getMeasurerState(r)){case Sa.d.INIT:var s={};s.fontSize=Sa.c,s.fontStyle="",s.fontWeight="",s.fontFamily=o,this.fontRangesMap[r]=new Vt.default,this.addFontRange(r,n),a.updateEmphasisMeasurerState(r,Sa.d.IN_PROGRESS),a.startMeasurer(s,t).then((function(e){i.addFontActualPaintBoxRelativeCenterPos(r,e.centerPoint),i.addFontActualPaintBoxSize(r,e.width,e.height),a.updateEmphasisMeasurerState(r,Sa.d.FINISH);var t=i.getAndRemoveFontRanges(r);i._onFontUpdate(t)})).catch((function(){a.updateEmphasisMeasurerState(r,Sa.d.ERROR),i.getAndRemoveFontRanges(r)}));break;case Sa.d.IN_PROGRESS:this.fontRangesMap[r]&&this.addFontRange(r,n)}}}},{key:"_loadFontDrawInfoToPreview",value:function(e){switch(this.drawStateMap[e]){case Da.PREPARE_LOAD:case Da.CHECKING:case Da.INIT:case Da.PRE_INSERT_CSS:case Da.FONT_WAITING2_START_DOWNLOAD:case Da.ERROR_RETRY_01:case Da.ERROR_RETRY_02:case Da.ERROR_RETRY_03:case Da.ERROR_WAITING2_RESTART:case Da.FINISH:case Da.NOT_EXIST:case Da.NOT_IN_LOCAL_FALL_BACK_LIST:case Da.IN_LOCAL_FALL_BACK_LIST_NEED_REPLACE:case Da.ERROR_RETYR_END:case Da.ERROR_REPLACING_CSS:case Da.FONT_ALREADY_IN_SYSTEM:break;case Da.FONT_ALREADY_IN_SYSTEM_ENGLISH_NAME:oe.default.dispatchEvent(oe.default.names.DOC_FONT_WAIT_TO_REPLACE,{originalFont:e,font:Xo.a.getPureFontName(e)});break;case Da.FONT_ALREADY_IN_SYSTEM_SPECIAL_SOLVE:oe.default.dispatchEvent(oe.default.names.DOC_FONT_WAIT_TO_REPLACE,{originalFont:e,font:this.docSystemFontFallBack.getSpecialSystemOnLoadFontName(e)});break;default:this._updateFontDrawState(e,Da.INIT),this._fetchFontDrawWithoutFallback(e)}}},{key:"parseMetricsKey2EmphasizeInfo",value:function(e,t){var n=e.split("_");t.fontFamily=n[0],t.renderText=n[n.length-1]}},{key:"_updateEmphasizeInfo",value:(t=jo()(regeneratorRuntime.mark((function e(t){var n,i,o,a,r,s,l,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.docNormalCharMeasurer.emphasizeMeasurer,i={},o={},a=this.localMetricsMapForEmphasis,e.t0=regeneratorRuntime.keys(a);case 5:if((e.t1=e.t0()).done){e.next=28;break}if(r=e.t1.value,this.parseMetricsKey2EmphasizeInfo(r,i),i.fontFamily===t){e.next=10;break}return e.abrupt("continue",5);case 10:if(s=i.renderText,l=this.getEmphasizeMeasureKey(t,s),n.getMeasurerState(l)!==Sa.d.INIT){e.next=15;break}return e.abrupt("continue",5);case 15:return o.fontSize=Sa.c,o.fontStyle="",o.fontWeight="",o.fontFamily=t,n.updateEmphasisMeasurerState(l,Sa.d.IN_PROGRESS),e.next=22,n.startMeasurer(o,s);case 22:u=e.sent,this.addFontActualPaintBoxRelativeCenterPos(l,u.centerPoint),this.addFontActualPaintBoxSize(l,u.width,u.height),n.updateEmphasisMeasurerState(l,Sa.d.FINISH),e.next=5;break;case 28:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"checkCurrentPosExistEmphasize",value:function(e){var t=this.doc.getDataLogic("final").getChp(e);if(!t)return!1;var n=t.getProp("emphasis_type").val;if(n===ba.a)return!1;var i=t.getProp("east_asia_language").val;return!!Object(Ta.a)(i,n).renderText}},{key:"_getFontNotReadyReplaceName",value:function(e){switch(this.drawStateMap[e]){case Da.PREPARE_LOAD:case Da.PRE_INSERT_CSS:return this.docFontDraw.getFontNotReadyReplaceFamilyName(e);default:return e}}},{key:"getFontName",value:function(e,t){if(t){var n=this._getFontNameByUnicodeRange(t),i=n.result,o=n.familyName;if(i)return o}return this.checkIsFounderFontAvailable(e)?e:this._getFontNameByFamilyName(e)}},{key:"fallbackByChar",value:function(e,t,n){if(e.bUseCJKFont&&!Object(Xo.b)(n)){var i=this.doc.fonttable.getReservedFontFtc(ce.b.ea);return this.doc.fonttable.getName(i)}return n}},{key:"getFontNameForRender",value:function(e){var t=e;return/[\s|\(|\)]+/.test(t)?"'"+t+"'":t}},{key:"_getFontNameByUnicodeRange",value:function(e){var t=!1,n="";if(!St.isAndroid)return{result:t,familyName:n};switch(e.usrType){case wa.b.usrLatinXA:case wa.b.usrLatinXB:t=!0,n="sans-serif"}return{result:t,familyName:n}}},{key:"_getFontNameByFamilyName",value:function(e){var t=this,n=e;if(this.isFontNeedReplace2FallBackFont(e))n=this.docFontFallBack.getSystemOnLoadFontName(e);else if(this.isFontNeedReplace2EnglishFontName(e))n=Xo.a.getPureFontName(e);else if(this.isFontNeedReplace2SpecialSoveFontName(e))n=this.docSystemFontFallBack.getSpecialSystemOnLoadFontName(e);else if(!St.isMobile&&this.doc.useCoreTypo){var i=Xo.a.getFontName(e),o=i.fontName;i.ret||(n=o)}else if(!this.docFontDraw.isFontAlreadyInSystem(e)){var a=Xo.a.getMatchListByFamilyName(e);a&&a.length&&a.some((function(e){if(t.docFontDraw.isFontAlreadyInSystem(e))return n=e,!0}))}return n}},{key:"addFontRange",value:function(e,t){t&&this.fontRangesMap[e].todo({begin:t.pos,end:t.pos+t.len})}},{key:"addDrawRange",value:function(e,t){this.drawRangesMap[e].todo({begin:t.pos,end:t.pos+t.len})}},{key:"getAndRemoveFontRanges",value:function(e){for(var t=this.fontRangesMap[e],n=t.tree.makeHintAtHead(),i=[];n.good();n.moveNext())i.push({pos:n.pos,len:n.len});return t.done(t),this.fontRangesMap[e].reset(),delete this.fontRangesMap[e],i}},{key:"getAndRemoveDrawRanges",value:function(e){var t=this.drawRangesMap[e];if(!t)return[];for(var n=t.tree.makeHintAtHead(),i=[];n.good();n.moveNext())i.push({pos:n.pos,len:n.len});return t.done(t),this.drawRangesMap[e].reset(),delete this.drawRangesMap[e],i}},{key:"getDrawRanges",value:function(e){var t=this.drawRangesMap[e];if(!t)return[];for(var n=t.tree.makeHintAtHead(),i=[];n.good();n.moveNext())i.push({pos:n.pos,len:n.len});return t.done(t),i}},{key:"getFontStyle",value:function(e,t){return e?t?"bold_italic":"bold":t?"italic":"normal"}},{key:"mapFontFaceToKey",value:function(e){var t=this.getFontStyle(e.bold,e.italic);return e.family+"_"+t+"_"+e.size}},{key:"getFontMetrics",value:function(e){return this.metricsMap[e]}},{key:"clearLocalMetrics",value:function(e){for(var t in this.localMetricsMap)-1!=t.indexOf(e)&&(this.localMetricsMap[t]=null)}},{key:"clearLocalMetricsByFontFamily",value:function(e){var t=new RegExp(e+"_");for(var n in this.localMetricsMap){var i=n.match(t);i&&0===i.index&&(this.localMetricsMap[n]=null)}}},{key:"clearLocalMetricsForEmphasisByFontFamily",value:function(e){var t=new RegExp(e+"_");for(var n in this.localMetricsMapForEmphasis){var i=n.match(t);i&&0===i.index&&(this.localMetricsMapForEmphasis[n]=null)}}},{key:"fetchFontMetrics",value:function(e,t,n,i,o){var a=this.getFontStyle(t,n),r=e+"_"+a,s=e;if(this.docFontFallBack.isFontNeedFallBack(s)&&!this.docFontDraw.isFontAlreadyInSystem(s)&&!this.docFontDraw.isFontAlreadyInSystemIncludeEnglishName(s)&&!this.docFontDraw.isFontAlreadyInSystemSpecialSolve(s)){var l=this.docFontFallBack.getSystemOnLoadFontName(s);""!==l?s=l:this.docFontFallBack.checkFontNeed2DownLoad(s)&&(s=this.docFontFallBack.getFontFallBackDownLoadFontName(s))}var u=qo.b.mapping(s,!0),c=Xo.a.getFontName(u),h=c.fontName;c.ret||console.log("no font metrics for "+s+", use default font 'SimSun' instead");var d=this.mapFontName(h),p=new XMLHttpRequest,f=this;p.onload=function(){if(200===p.status){var e=new FileReader;e.onload=function(e){var t=e.target.result,n=new Uint8Array(t),i=f.parseBinaryMetrics(n);if(null!=i)return f.metricsMap[r]=i,f.metricsStateMap[r]=Ra,f.clearLocalMetrics(r),void(o&&o({newLoaded:!0,ranges:f.getAndRemoveFontRanges(r)}));f.metricsStateMap[r]=Aa,o&&o()},e.readAsArrayBuffer(p.response)}else 404==p.status?(console.info("Failed to download font metrics for "+s+", status="+p.status),f.metricsStateMap[r]=Na,o&&o()):(console.error("Failed to download font metrics for "+s+", status="+p.status),f.metricsStateMap[r]=Aa,o&&o())};var g=window.__CONFIG__.wps.cdnFontsMetrics;g+="/"+d+"/"+a+".bin",p.open("GET",g,i),p.responseType="blob",p.send()}},{key:"parseBinaryMetrics",value:function(e){var t=new Zo;return t.fromBinary(e)?t:null}},{key:"fetchWebFont",value:function(e,t){}},{key:"onInsertText",value:function(e,t,n,i,o){for(var a in this.fontRangesMap)this.fontRangesMap[a].expand(t,n.length);for(var r in this.drawRangesMap)this.drawRangesMap[r].expand(t,n.length)}},{key:"onDeleteText",value:function(e,t,n){for(var i in this.fontRangesMap)this.fontRangesMap[i].remove(t,n.length);for(var o in this.drawRangesMap)this.drawRangesMap[o].remove(t,n.length)}},{key:"isEnableDrawRangeCache",get:function(){return!window.APP.isPreview&&(!!St.isMobile||!this.doc.useCoreMeasure)}},{key:"isAllowFallback",get:function(){return!window.APP.isPreview}}]),e}(),Wa=n(2701),ja=function(){function e(t){l()(this,e),this.fieldMgr=t}return c()(e,[{key:"parse",value:function(e,t){if(null!=t&&null!=t&&e.setParam(t),e.lex)e.lex.reParse(e.getCode());else{var n=new Wa.a;n.parse(e.getCode()),e.onParseFinish(n)}}}]),e}(),Ua=n(6118),Va=function(e){function t(e){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return y()(t,e),c()(t,[{key:"parse",value:function(e,t){var n=e.section;n||(n=e.doc.sections.getSection(e.rawField.pos));var i=n.getPageNumFormat(),o="\\*";o+=Object(Ua.a)(i).fmtStr,o+=" ";var a=new Wa.a;a.parse(e.getCode()+o),e.onParseFinish(a),e.formatResult(t)}}]),t}(ja),Ya=function(e){function t(e){return l()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return y()(t,e),c()(t,[{key:"parse",value:function(e,n){e.hasParsed()||we()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"parse",this).call(this,e,n),e.formatResult(n)}}]),t}(ja),za=function(){function e(t){l()(this,e),this.fieldMgr=t,this.parsers={}}return c()(e,[{key:"getParser",value:function(e){if(this.parsers[e])return this.parsers[e];var t=this.createParser(e);return this.parsers[e]=t,t}},{key:"createParser",value:function(e){var t=void 0;return e&&("PAGE"==e?t=new Va(this.fieldMgr):"NUMPAGES"!=e&&"SECTIONPAGES"!=e||(t=new Ya(this.fieldMgr))),t}}]),e}(),Ka=function(){function e(t,n){l()(this,e),this.doc=t,this.typoInfo=n,this.fieldRanges=t.fields,this.parserFactory=new za(this),this.invalidFields=[],Object(p.default)(this),this.typoInfo.attachObserver(this)}return c()(e,[{key:"clearAll",value:function(){this.typoInfo.detachObserver(this)}},{key:"getField",value:function(e){var t=this.fieldRanges.getField(e);return t&&t.fieldObj}},{key:"parseField",value:function(e,t){this.parserFactory.getParser(e.getType()).parse(e,t)}},{key:"markInvalid",value:function(e){this.invalidFields.push(e)}},{key:"getInvalidFields",value:function(){return this.invalidFields}},{key:"resetInvalidFields",value:function(){this.invalidFields=[]}},{key:"updateInvalidFields",value:function(){var e=this;this.invalidFields.forEach((function(t){e.parseField(t)})),this.resetInvalidFields()}},{key:"onFieldChanged",value:function(e){"NUMPAGES"==e.getType()?this.pageCountChanged=!0:"SECTIONPAGES"==e.getType()&&(this.secPageCountChanged=!0),this._dispatch("onFieldChanged",e)}},{key:"updatePageCountField",value:function(e){var t=this,n=this.getPageCountFields();return!(n.length<=0)&&(this.pageCountChanged=!1,n.forEach((function(n){var i=n.getResult();t.parseField(n,e),i!==n.getResult()&&t.onFieldChanged(n)})),this.pageCountChanged)}},{key:"updateSectionPageCountField",value:function(e,t,n,i){var o=this,a=this.getSectionPageCoutFields(e,n,i);return!(a.length<=0)&&(this.secPageCountChanged=!1,this.typoInfo.secPageCountCache.get(e.section)!=t&&a.forEach((function(e){var n=e.getResult();o.parseField(e,t),n!==e.getResult()&&o.onFieldChanged(e)})),this.secPageCountChanged)}},{key:"getPageCountFields",value:function(){var e=W.getFields(),t=[];return e.forEach((function(e){"NUMPAGES"==e.getType()&&t.push(e)})),t}},{key:"getSectionPageCoutFields",value:function(e,t,n){var i=W.getFields(),o=[],a=function(t,n){if(!n)return!1;if(t.host&&t.host.viewPage.section!==e.section)return!1;var i=!1;return(t.host&&t.host.has_textbox&&n.begin<=t.host.begin&&n.end>t.host.end||n.begin<=t.rawField.begin&&n.end>t.rawField.end)&&(i=!0),i};return i.forEach((function(e){"SECTIONPAGES"==e.getType()&&(a(e,t)||a(e,n))&&o.push(e)})),o}}]),e}(),Za=function(){function e(t){l()(this,e),this.doc=t}return c()(e,[{key:"getCharCode",value:function(e){var t=this.doc.getText(e,1);return t?t.charCodeAt(0):0}},{key:"getChar",value:function(e){return this.doc.getText(e,1)}},{key:"getMi",value:function(e){return null}}]),e}(),Xa=function(){function e(t,n){l()(this,e),this.doc=t,this.seek(n)}return c()(e,[{key:"isHidden",value:function(){if(!this.chpx)return!1;var e=this.chpx.prop.getPropVal("vanish");if(!e){var t=this.pos;this.doc.fields.getFields({begin:t,end:t+1}).forEach((function(n){e=n.sep<=n.begin||!(t>n.sep&&t<n.end-1)}))}return e}},{key:"isSpecHidden",value:function(){var e=this.charCode;return e===Ne.a||e===Ne.f}},{key:"isSeparator",value:function(){if(0===this.pos)return!1;var e=this.doc.getSubDocType(this.pos);return this.pos===this.doc.getSubDocOffset(e)}},{key:"isSpec",value:function(){if(!this.chpx)return!1;var e=this.chpx.prop.getPropVal("special");return e||(e=this.charCode===Ne.a),e}},{key:"seek",value:function(e){if(!this.chpx||e<this.chpx.pos||e>=this.chpx.pos+this.chpx.len){var t=this.doc.getDataLogic("final");this.chpx=t.getChpx(e)}this.pos=e}},{key:"next",value:function(){this.seek(this.pos+1)}},{key:"prev",value:function(){this.seek(this.pos-1)}},{key:"free",value:function(){}},{key:"charCode",get:function(){var e=this.doc.getText(this.pos,1);return e?e.charCodeAt(0):0}}]),e}(),qa=function(){function e(t){l()(this,e),this.doc=t,this.glyphBuff=new Za(this.doc),window.APP.fontServer.init(t),window.APP.fontServer.attachObserver(this)}return c()(e,[{key:"clearAll",value:function(){window.APP.fontServer.detachObserver(this)}},{key:"update",value:function(){}},{key:"todo",value:function(){}},{key:"validate",value:function(){}},{key:"onInsertText",value:function(){}},{key:"onDeleteText",value:function(){}},{key:"onChpxChanged",value:function(){}},{key:"onPapxChanged",value:function(){}},{key:"onFontUpdate",value:function(){}},{key:"getGlyphIterator",value:function(e){return new Xa(this.doc,e)}},{key:"getBodyRange",value:function(e){return this.doc.getBodyRange(e)}},{key:"getBackwardVisibleText",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=this.glyphBuff,i="",o=e-1,a=this.getGlyphIterator(o),r=this.getBodyRange(o),s=r?r.begin:0;o>=s&&i.length<t;)a.seek(o),a.isHidden()||a.isSpecHidden()||(i=n.getChar(o)+i),--o;return i}}]),e}(),Ja=n(984),Qa=n(14),$a=n(1733),er=!0;function tr(e){return St.isMobile?"pages"===e.woTypoMode?on.TYPO_MODE.MODE_PAGINATION:on.TYPO_MODE.MODE_MOBILE:e.woTemplate&&"web"===e.woTemplateTypoMode?on.TYPO_MODE.MODE_WEB:on.TYPO_MODE.MODE_PC}var nr=function(){function e(t,n){l()(this,e),this.api=n,this.mimeDataMap={},this.updateTypoMode(t.docInfo)}return c()(e,[{key:"clearAll",value:function(e){this.resetGlobalBlink(),this.selection.clearAll(e),this.autonum.clearAll(),this.doc.clearAll(e),this.glyphpool.clearAll(),this.shapeManager.clearAll(e),this.fieldManager.clearAll()}},{key:"afterOpen",value:function(){this.selection.afterOpen(),this.glyphpool.afterOpen(),this.fontServer.afterOpen()}},{key:"init",value:function(e){this.naked_data=e,this.wordStat=e.wordStat,this.updateCache(e),this.initModel(),this.initFont(),this.initGlyphpool(),this.initCompose(),this.initTypoinfo(),this.initSelection(),this.initAutonum(),this.initShape(),this.initFieldManager()}},{key:"initModel",value:function(){this.doc=new Mn(this.naked_data.naked_doc,this.naked_data.textStream,this.naked_data.concernRanges,this.naked_data.docInfo)}},{key:"initFont",value:function(){window.APP.fontServer=this.fontServer=new Ga(this.doc)}},{key:"initGlyphpool",value:function(){this.glyphpool=this.doc.useCoreMeasure?new qa(this.doc):new Qn(this.doc,this.doc.concernRanges)}},{key:"initCompose",value:function(){this.compose=new uo(this.doc,this.glyphpool)}},{key:"initTypoinfo",value:function(){}},{key:"initSelection",value:function(){this.selection=new Ii(this)}},{key:"initAutonum",value:function(){this.autonumCenter=new co(this.doc),this.autonum=new Bo(this.doc,this.doc.getDataLogic("final"),this.autonumCenter)}},{key:"initShape",value:function(){this.shapeManager=Ho.a.buildGetInstance()}},{key:"initFieldManager",value:function(){this.fieldManager=new Ka(this.doc,this.typoinfo)}},{key:"update",value:function(e){this.naked_data=e,this.wordStat=e.wordStat;var t=this.doc.applyConcernRangesOps(this.naked_data.concernRanges),n=this.doc.concernRanges[0];if(n.pos!=this.doc.subdocs[0].subdoc_offset||n.len>this.doc.subdocs[0].subdoc_size-1)throw console.error("update concern range error...",e,this.doc.concernRanges),new Error("concern range error!");this.doc.update(this.naked_data.textStream,this.naked_data.docInfo,t),this.updateCache(e),this._updateDirtyShapes(e),void 0!==e.typoInfo&&this.typoinfo.update(e.typoInfo),this.glyphpool.update(t.incrRanges),this.instantPatchShapeRefreshCode()}},{key:"updateTypoMode",value:function(e){window.APP.typoMode=this.typoMode=this.getCurrentTypoMode(e)}},{key:"getCurrentTypoMode",value:function(e){return function(e){var t=tr(e),n=window.APP.config;if(isNaN(n.typoMode)){if(St.isMobile)if(er&&Object(Qa.hasQuery)("newFile"))t=on.TYPO_MODE.MODE_MOBILE,er=!1;else if(e.woSyncTypoMode)Ja.deleteStatus(Ja.types.TYPOMODE,!0);else{var i=parseInt(Ja.getStatus(Ja.types.TYPOMODE,!0));t=isNaN(i)?window.__CONFIG__.wps.mobile.isOpenIntoPagesMode?on.TYPO_MODE.MODE_PAGINATION:on.TYPO_MODE.MODE_MOBILE:i}}else t=n.typoMode;return t}(e||this.doc.docInfo)}},{key:"getDocumentTypoMode",value:function(){return tr(this.doc.docInfo)}},{key:"updateWordStat",value:function(e){e&&(this.wordStat=e)}},{key:"updateCache",value:function(e){this.cache||(this.cache={typoinfo:{}});var t=e.typoInfo;if(void 0!==t){var n=-1,i=(this.cache.typoinfo.typoPageInfo||[]).splice(0,t.pageCount);i=t.typoPageInfo.reduce((function(e,t){if(t)if(void 0===t.oldPageIndex)e[t.pageIndex]=t;else if(t.oldPageIndex<e.length){var i=e[t.oldPageIndex];if(void 0!==t.mainTextPagesOffset&&(i.mainTextPagesOffset=void 0!==i.mainTextPagesOffset?i.mainTextPagesOffset+t.mainTextPagesOffset:t.mainTextPagesOffset),void 0!==t.headerOffset&&(i.headerOffset=void 0!==i.headerOffset?i.headerOffset+t.headerOffset:t.headerOffset),void 0!==t.footerOffset&&(i.footerOffset=void 0!==i.footerOffset?i.footerOffset+t.footerOffset:t.footerOffset),void 0!==t.footnotesOffset)if(i.footnotesOffset)for(var o=i.footnotesOffset,a=t.footnotesOffset,s=0,l=o.length;s<l;++s)o[s]+=a[s]||0;else i.footnotesOffset=[].concat(r()(t.footnotesOffset));if(void 0!==t.endnotesOffset)if(i.endnotesOffset)for(var u=i.endnotesOffset,c=t.endnotesOffset,h=0,d=u.length;h<d;++h)u[h]+=c[h]||0;else i.endnotesOffset=[].concat(r()(t.endnotesOffset))}return n=Math.max(n,t.pageIndex+1),e}),i),n=-1!==n?n:t.pageCount,this.cache.typoinfo.typoPageInfo=i.splice(0,n)}}},{key:"instantPatchShapeRefreshCode",value:function(){window.APP.data.doc.isDeleteShape&&requestAnimationFrame((function(){setTimeout((function(){window.APP.workspace.refreshForcedly(),window.APP.data.doc.isDeleteShape=!1}))}))}},{key:"_getHrc",value:function(e,t){if(void 0!==e.layoutIndex&&(void 0!==e.pageIdx||void 0!==e.isInFooter||void 0!==e.isInTextbox))return e;if(e.pos){var n=e.pos;return void 0!==n.layoutIndex||void 0===n.pageIdx&&void 0===n.isInFooter&&void 0===e.isInTextbox?n:void console.log("大哥，错了！")}if("number"==typeof e){var i=Go.b.locate(this,e,t,this.typoinfo);return void 0!==i.layoutIndex||void 0===i.pageIdx&&void 0===i.isInFooter&&void 0===e.isInTextboxx?i:void console.log("大哥，错了！")}console.log("大哥，错了！")}},{key:"getSelCellRanges",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===e||void 0===t)return{begin:e,end:t};if("number"==typeof e&&"number"==typeof t&&e===t)return{begin:e,end:t};var i=e;if("number"!=typeof e){if(void 0===e.position)return console.log("大哥，错了！"),{begin:e,end:t};i=e.position}var a=t;if("number"!=typeof t){if(void 0===t.position)return console.log("大哥，错了！"),{begin:e,end:t};a=t.position}var r=i>a;if(r){var s=i;i=a,a=s}var l=this._getHrc(e,r&&a!==i);if(void 0===l)return{begin:e,end:t};var u=this._getHrc(t,!r&&a!==i);if(void 0===u)return{begin:e,end:t};var c=l.line,h=u.line;if(!(c&&h&&c.range&&h.range))return{begin:e,end:t};!r&&c.range.pos>h.range.pos&&(r=!0),r?(c.range.pos===a&&c.range.len>0&&++a,h.range.pos+h.range.len===i&&h.range.len>0&&--i):(h.range.pos===a&&h.range.len>0&&++a,c.range.pos+c.range.len===i&&c.range.len>0&&--i);var d=this.doc.getDataLogic("final"),p=d.getPap(i);if(!p)return{begin:e,end:t};var f=p.getPropVal("nest_level"),g=d.getPap(a>i?a-1:a);if(!g)return{begin:e,end:t};var v=g.getPropVal("nest_level");if(f<=0||v<=0)return{begin:e,end:t};var m=p.getPropVal("para_type")===xe.d,_=g.getPropVal("para_type")===xe.d;if(m||_)return{begin:e,end:t};var y=this.typoinfo.getSelCellRanges(l,u,i,a,r,n);if(void 0===y)return{begin:e,end:t};if("sameCell"===y)return Object($a.getCellRangeByPos)(this.doc,e.position,1);if(y.length>1)for(var b=0,T=y.length-1;b<T;b++)for(var C=Math.min(y[b].begin,y[b].end),k=Math.max(y[b].begin,y[b].end),w=y[b].begin>y[b].end,S=b+1,P=y.length;S<P;S++){var I=Math.min(y[S].begin,y[S].end),E=Math.max(y[S].begin,y[S].end);if(!(k<I||C>E)){var O=w?[Math.max(k,E),Math.min(C,I)]:[Math.min(C,I),Math.max(k,E)],x=o()(O,2);y[b].begin=x[0],y[b].end=x[1],y.splice(S,1),b--,T=y.length-1;break}}return y}},{key:"setGlobalBlink",value:function(e){this._global_blink=e}},{key:"getGlobalBlink",value:function(){return this._global_blink}},{key:"resetGlobalBlink",value:function(){this._global_blink=null}},{key:"getPageOuterRect",value:function(e){if(this.typoinfo&&this.typoinfo.layout_pages&&(e>0&&e<=this.typoinfo.layout_pages.length))return this.typoinfo.layout_pages[e-1].outer_rect}},{key:"getPages",value:function(){if(this.typoinfo&&this.typoinfo.layout_pages)return this.typoinfo.layout_pages.length}},{key:"getPageRange",value:function(e){if(this.typoinfo&&this.typoinfo.layout_pages&&e>0&&e<=this.typoinfo.layout_pages.length){var t=this.typoinfo.layout_pages[e-1];return{begin:t.begin,end:t.end}}}},{key:"_updateDirtyShapes",value:function(e){var t=this;if(e.typoInfo&&e.typoInfo.typoPageInfo&&this.typoinfo&&this.typoinfo._layout_pages){for(var n=0,i=1,o=2,a=window.APP.workspace.canvasHandler&&window.APP.workspace.canvasHandler.canvasPool||[],r={},s=0;s<a.length;++s)a[s].layout_index>=0&&(r[a[s].layout_index]=a[s]);if(0!==r.length){var l=function(e,t){r[e.pageIndex]&&(e.typoDrawingInfos&&e.typoDrawingInfos.forEach((function(i){t[i.id]={pageIndex:e.pageIndex,layer:i.isBehindText?n:o}})),e.typoEmbedDrawingInfos&&e.typoEmbedDrawingInfos.forEach((function(n){t[n.id]={pageIndex:e.pageIndex,layer:i}})))},u={},c=[];if(e.typoInfo.typoPageInfo.forEach((function(e){c.push(e.pageIndex),l(e,u)})),0!==u.length){var h={};if(this.typoinfo._layout_pages.some((function(e){if(!e||!(e.pageIndex in c))return!1;l(e,h)})),0!==h.length){Object.keys(u).forEach((function(e){if(e in h&&u[e].layer!==h[e].layer){var a=r[h[e].pageIndex],s=void 0;switch(h[e].layer){case n:s=a.bottomCTX;break;case i:s=a.context;break;case o:s=a.topCTX}var l=function(e,n){var i=null;return t.typoinfo.layout_pages.some((function(t){return!(!t||t.layout_index!==n)&&(t.embed_shape_map&&e in t.embed_shape_map?(i=t.embed_shape_map[e].viewRect,!0):void(t.shapeArray&&t.shapeArray.some((function(t){if(t&&t.id===e)return i=t.viewRect,!0}))))})),i}(parseInt(e,10),h[e].pageIndex);l&&s&&s.clearRect&&s.clearRect(l.left,l.top,l.width,l.height)}}))}}}}}}]),e}();t.a=nr},10011:function(e,t,n){"use strict";var i={};n.r(i),n.d(i,"getVisibleIds",(function(){return ce}));var o=n(13),a=n.n(o),r=n(8),s=n.n(r),l=n(80),u=n.n(l),c=n(1),h=n.n(c),d=n(2),p=n.n(d),f=(n(676),n(1473),n(7146)),g=(n(1318),n(22)),v=n.n(g),m=n(23),_=n.n(m),y=n(535),b=n(811),T=function(e){function t(e){h()(this,t);var n=v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.private=e.data,n.private.objId=e.id,n.opFunc={},n.opFunc.doInsertText=n.doInsertText,n.opFunc.doDeleteText=n.doDeleteText,n.opFunc.doModifyChpx=n.doModifyChpx,n.opFunc.doModifyPapx=n.doModifyPapx,n.opFunc.doInsertRange=n.doInsertRange,n.opFunc.doRemoveRange=n.doRemoveRange,n.opFunc.doSplitPara=n.doSplitPara,n}return _()(t,e),p()(t,[{key:"isMainObject",value:function(){return!0}},{key:"init",value:function(e,t){this.doc=e,this.textStream=t}},{key:"initTrackingChanges",value:function(e){this.private.trackingChanges&&this.private.trackingChanges.init(e)}},{key:"getTextLength",value:function(){return this.private.textLength}},{key:"getObjID",value:function(){return this.private.objId}},{key:"forward",value:function(e){this.doOperation(e,!0)}},{key:"backward",value:function(e){this.doOperation(e,!1)}},{key:"preOperation",value:function(e){"doModifyChpx"===e.name&&e.param.chpxTbl&&e._chpxTbl?(delete e.param.chpxTbl,e.param.chpxTbl=e._chpxTbl):"doModifyPapx"===e.name&&e.param.papxTbl&&e._papxTbl&&(delete e.param.papxTbl,e.param.papxTbl=e._papxTbl)}},{key:"doOperation",value:function(e,t){var n=e.data;n.name in this.opFunc&&(t||this.preOperation(n),this.opFunc[n.name].call(this,n.param,t))}},{key:"doInsertText",value:function(e,t){"chpxPropBag"in e&&(e.chpx=(new b.a).initFromServer(e.chpxPropBag),delete e.chpxPropBag),"papxPropBag"in e&&(e.papx=(new b.c).initFromServer(e.papxPropBag),delete e.papxPropBag),this.textStream.doInsertText(e,t)}},{key:"doDeleteText",value:function(e,t){this.textStream.doDeleteText(e,t)}},{key:"doModifyChpx",value:function(e,t){e.chpx&&!e.propBag||(e.chpx=(new b.a).initFromServer(e.propBag),delete e.propBag),this.textStream.doModifyChpx(e,t)}},{key:"doModifyPapx",value:function(e,t){e.papx&&!e.propBag||(e.papx=(new b.c).initFromServer(e.propBag),delete e.propBag),this.textStream.doModifyPapx(e,t)}},{key:"doSplitPara",value:function(e,t){"papxPropBag"in e&&(e.papx=(new b.c).initFromServer(e.papxPropBag),delete e.papxPropBag),this.textStream.doSplitPara(e,t)}},{key:"doInsertRange",value:function(e,t){var n=this.doc.getRangeClass(e.classType);n&&n.doInsertRange(e,t)}},{key:"doRemoveRange",value:function(e,t){var n=this.doc.getRangeClass(e.classType);n&&n.doRemoveRange(e,t)}},{key:"isTrackingChanges",get:function(){return this.private.trackingChanges.trackRevisions}},{key:"trackRevisions",get:function(){return this.private.trackingChanges.trackRevisions},set:function(e){this.private.trackingChanges.trackRevisions=e}},{key:"initiatorUserID",set:function(e){this.private.trackingChanges.initiatorUserID=e},get:function(){return this.private.trackingChanges.initiatorUserID}}]),t}(y.AbsCustomObject),C=function(e){function t(e){h()(this,t);var n=v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.private=e.data,n.private.objId=e.id,n}return _()(t,e),p()(t,[{key:"init",value:function(e){this.textStream=e,this.on((function(e,t){}))}},{key:"trackRevisions",get:function(){return this.private.trackRevisions},set:function(e){this.private.trackRevisions=e}},{key:"initiatorUserID",get:function(){return this.private.initiatorUserID},set:function(e){this.private.initiatorUserID=e}}]),t}(y.AbsTopObject),k=n(4955),w=function(){function e(t,n){h()(this,e),this.cmd=t,this.type=n}return p()(e,[{key:"getType",value:function(){return this.type}},{key:"getPos",value:function(){return this.cmd.param.pos}},{key:"setPos",value:function(e){return this.cmd.param.pos=e}},{key:"getLen",value:function(){return null==this.cmd.param.len?0:this.cmd.param.len}},{key:"setLen",value:function(e){e<0&&(this.cmd.param.pos=-1),null!=this.cmd.param.len&&(this.cmd.param.len=e)}},{key:"isValid",value:function(){return this.getLen()>=0&&this.getPos()>=0}},{key:"clone",value:function(){return new this.constructor(JSON.parse(JSON.stringify(this.cmd)),this.type)}}]),e}(),S=function(e){function t(e,n){return h()(this,t),v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _()(t,e),p()(t,[{key:"getLen",value:function(){return null!=this.cmd.param.strlen?this.cmd.param.strlen:this.cmd.param.string.length}},{key:"setLen",value:function(){console.error("不可修改")}}]),t}(w),P=function(e){function t(e,n){return h()(this,t),v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _()(t,e),p()(t,[{key:"getLen",value:function(){return this.cmd.param.paraCount}},{key:"setLen",value:function(){console.error("不可修改")}}]),t}(w),I=function(e){function t(e,n){return h()(this,t),v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _()(t,e),p()(t,[{key:"getPos",value:function(){return this.cmd.param.pos+this.cmd.param.len}},{key:"getLen",value:function(){return void 0!==this.cmd.param.strlen?this.cmd.param.strlen:0}},{key:"setLen",value:function(){console.error("不可修改")}}]),t}(w),E=function(e){function t(e,n){return h()(this,t),v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _()(t,e),p()(t,[{key:"getLen",value:function(){return 1}},{key:"setLen",value:function(){console.error("不可修改")}}]),t}(w),O=function(e){function t(e,n){return h()(this,t),v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _()(t,e),p()(t,[{key:"getPos",value:function(){return this.cmd.param.to_pos}},{key:"setPos",value:function(e){return this.cmd.param.to_pos=e}},{key:"getLen",value:function(){return 1}},{key:"setLen",value:function(){console.error("不可修改")}}]),t}(w),x=function(e){function t(e,n){return h()(this,t),v()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _()(t,e),p()(t,[{key:"getPos",value:function(){return this.cmd.param.to}},{key:"getLen",value:function(){return 0}},{key:"setLen",value:function(){console.error("不可修改")}}]),t}(w),R=function(){function e(t,n){h()(this,e),this.cmd=t,this.type=n}return p()(e,[{key:"getType",value:function(){return this.type}},{key:"getShapeTreeType",value:function(){return this.cmd.param.shapeTreeType}},{key:"getShapeIdxPath",value:function(){return this.cmd.param.shapeIdxPath}},{key:"setShapeIdxPath",value:function(e){this.cmd.param.shapeIdxPath=e}},{key:"getPos",value:function(){return this.cmd.param.pos}},{key:"setPos",value:function(e){this.cmd.param.pos=e}},{key:"isValid",value:function(){return!this.cmd.param.shapeIdxPath.some((function(e){return e<0}))}},{key:"clone",value:function(){return new this.constructor(JSON.parse(JSON.stringify(this.cmd)),this.type)}}]),e}(),N=function(e){this.param=e,this.res=[]};N.prototype._DeleteInner=function(e,t){t.getPos()+t.getLen()<=e.getPos()||this._MoveByDel(e,t)||this._Abridge(e,t)},N.prototype._MoveByDel=function(e,t){return e.getPos()+e.getLen()<=t.getPos()&&(1&this.param&&t.setPos(t.getPos()-e.getLen()),!0)},N.prototype._Abridge=function(e,t){return!(t.getPos()>=e.getPos()+e.getLen()||t.getPos()+t.getLen()<=e.getPos())&&(t.getPos()<e.getPos()?4&this.param&&t.setLen(t.getLen()-(Math.min(t.getPos()+t.getLen(),e.getPos()+e.getLen())-e.getPos())):(4&this.param&&t.setLen(t.getLen()-(Math.min(t.getPos()+t.getLen(),e.getPos()+e.getLen())-t.getPos())),1&this.param&&t.setPos(e.getPos())),!0)},N.prototype._InsertInner=function(e,t){t.getPos()+t.getLen()<e.getPos()||this._MoveByInsert(e,t)||this._Expand(e,t)||this._ExpandTail(e,t)||this._SplitByInsert(e,t)},N.prototype._MoveByInsert=function(e,t){return e.getPos()<=t.getPos()&&(1&this.param&&t.setPos(t.getPos()+e.getLen()),!0)},N.prototype._Expand=function(e,t){return console.assert(e.getPos()>t.getPos()),e.getPos()<t.getPos()+t.getLen()&&(2&this.param?(t.setLen(t.getLen()+e.getLen()),!0):!(8&this.param))},N.prototype._ExpandTail=function(e,t){return console.assert(e.getPos()>=t.getPos()+t.getLen()),!!(16&this.param&&e.getPos()==t.getPos()+t.getLen())&&(t.setLen(t.getLen()+e.getLen()),!0)},N.prototype._SplitByInsert=function(e,t){if(console.assert(e.getPos()>t.getPos()&&e.getPos()<=t.getPos()+t.getLen()),e.getPos()!=t.getPos()+t.getLen()&&8&this.param){var n=t.clone();n.setLen(e.getPos()-t.getPos());var i=t.clone();i.setPos(e.getPos()+e.getLen()),i.setLen(t.getLen()-n.getLen()),this.res.push(i),this.res.push(n)}},N.prototype.Delete=function(e,t,n){if(e.isValid()&&t.isValid()){this.res=n;var i=t.clone();this._DeleteInner(e,i),0!=this.res.length||i.getPos()==t.getPos()&&i.getLen()==t.getLen()||this.res.push(i)}},N.prototype.Insert=function(e,t,n){if(e.isValid()&&t.isValid()){this.res=n;var i=t.clone();this._InsertInner(e,i),0!=this.res.length||i.getPos()==t.getPos()&&i.getLen()==t.getLen()||this.res.push(i)}},N.prototype.ShapeOp=function(e,t,n){if(e.isValid()&&t.isValid()&&e.getShapeTreeType()===t.getShapeTreeType()){this.res=n;var i=t.clone(),o=e.getShapeIdxPath(),a=i.getShapeIdxPath();if(257===this.param)for(var r=0,s=Math.min(o.length,a.length);r<s;++r){if(o[r]>a[r])return;if(o[r]<a[r])return void(r===o.length-1&&(--a[r],this.res.push(i)));if(r===o.length-1)return a[r]=-1,void this.res.push(i)}else if(256===this.param)for(var l=0,u=Math.min(o.length,a.length);l<u;++l){if(o[l]>a[l])return;if(o[l]<=a[l])return void(l===o.length-1&&(++a[l],this.res.push(i)))}else if(258===this.param){var c=o.length-1;if(c>=a.length)return;var h=o[c],d=e.getPos(),p=a[c];h===p?(a[c]=d,this.res.push(i)):h>d?p>=d&&p<h&&(++a[c],this.res.push(i)):p>h&&p<=d&&(--a[c],this.res.push(i))}}};var A=function(){var e={0:{}};e[0][0]=this.GetTransFuncExcSamPos("Insert",1),e[0][1]=this.GetTransFunc("Delete",1),e[0][4]=this.GetDoNothingFunc(),e[1]={},e[1][0]=this.GetTransFunc("Insert",7),e[1][1]=this.GetTransFunc("Delete",5),e[1][4]=this.GetDoNothingFunc(),this.mstMap=e;var t={0:{}};t[0][0]=this.GetTransFunc("Insert",1),t[0][1]=this.GetTransFunc("Delete",1),t[0][5]=this.GetDoNothingFunc(),t[0][6]=this.GetDoNothingFunc(),t[0][7]=this.GetDoNothingFunc(),t[1]={},t[1][0]=this.GetTransFunc("Insert",7),t[1][1]=this.GetTransFunc("Delete",5),t[1][5]=this.GetDoNothingFunc(),t[1][6]=this.GetDoNothingFunc(),t[1][7]=this.GetDoNothingFunc(),t[2]={},t[2][0]=this.GetTransFunc("Insert",7),t[2][1]=this.GetTransFunc("Delete",7),t[2][5]=this.GetDoNothingFunc(),t[2][6]=this.GetDoNothingFunc(),t[2][7]=this.GetDoNothingFunc(),t[3]={},t[3][0]=this.GetTransFunc("Insert",23),t[3][1]=this.GetTransFunc("Delete",7),t[3][5]=this.GetDoNothingFunc(),t[3][6]=this.GetDoNothingFunc(),t[3][7]=this.GetDoNothingFunc(),t[4]={},t[4][5]=this.GetTransFunc("ShapeOp",256),t[4][6]=this.GetTransFunc("ShapeOp",257),t[4][7]=this.GetTransFunc("ShapeOp",258),t[4][0]=this.GetDoNothingFunc(),t[4][1]=this.GetDoNothingFunc(),this.svtMap=t};(A.prototype=new k.a).GetTransFuncExcSamPos=function(e,t){return function(n,i,o){return n.getPos()!=i.getPos()&&new N(t)[e](n,i,o)}},A.prototype.GetTransFunc=function(e,t){return function(n,i,o){return new N(t)[e](n,i,o)}},A.prototype.GetDoNothingFunc=function(e,t){return function(e,t,n){}},A.prototype.OpTrsOp=function(e,t,n,i){var o=i[t.getType()];if(null==o&&null==(o=i[2]))return!1;var a=o[e.getType()];return null!=a&&a.call(this,e,t,n)},A.prototype.getCmdMainId=function(){return window.APP.data.doc.textStream.getPureTextStream().naked_textStream.getObjID()};var D={formatOp:function(e,t){t.push(new w(e,2))},selectionRange:function(e,t){t.push(new w(e,2))},deleteText:function(e,t){t.push(new w(e,1))},insertText:function(e,t){if(e.param.len>0){var n=JSON.parse(JSON.stringify(e));n.param.isBackspace=!1,t.push(new w(n,1)),e.isOpNeedMerge=!0}t.push(new S(e,0))},insertParagraph:function(e,t){if(e.param.len>0){var n=JSON.parse(JSON.stringify(e));n.param.isBackspace=!1,t.push(new w(n,1)),e.isOpNeedMerge=!0}t.push(new P(e,0))},insertComment:function(e,t){if(t.push(new w(e,3)),e.param.auxOps)H(e.name,e.param.auxOps,t);else{var n={};n.name=e.name,n.param={},n.param.pos=e.param.pos+e.param.len,n.param.strlen=1,n.isOpNeedMerge=!0,t.push(new S(n,0))}},deleteComment:function(e,t){t.push(new w(e,1))},insertPicture:function(e,t){if(e.param.len>0){var n=JSON.parse(JSON.stringify(e));n.param.isBackspace=!1,t.push(new w(n,1)),e.isOpNeedMerge=!0}t.push(new E(e,0))},deletePicture:function(e,t){t.push(new w(e,1))},movePicture:function(e,t){if(e.param.len&&1!==e.param.len)return console.assert(!1,"TODO: movePicture op.param.len must be 1"),t.push(new w(e,2)),t;var n=JSON.parse(JSON.stringify(e));n.param.isBackspace=!1,e.pos>=e.to_pos?(t.push(new w(n,1)),t.push(new O(e,0)),e.isOpNeedMerge=!0,e.mergeTo_to_pos=!0):(t.push(new O(e,0)),t.push(new w(n,1)),n.isOpNeedMerge=!0,n.mergeTo_to_pos=!1)},insertTable:function(e,t){t.push(new S(e,0))},insertRowAbove:function(e,t){t.push(new S(e,0))},insertRowBelow:function(e,t){t.push(new I(e,0))},insertColumnLeft:function(e,t){t.push(new S(e,0))},insertColumnRight:function(e,t){t.push(new S(e,0))},deleteColumn:function(e,t){t.push(new w(e,1))},deleteTable:function(e,t){t.push(new w(e,1))},insertHyperlink:function(e,t){t.push(new S(e,0))},deleteHyperlink:function(e,t){t.push(new S(e,0))},editHyperlink:function(e,t){t.push(new S(e,0))},insertSeparator:function(e,t){t.push(new S(e,0))},addContentControl:function(e,t){t.push(new S(e,0))},deleteContentControl:function(e,t){t.push(new w(e,1))},moveContent:function(e,t){t.push(new w(e,1)),t.push(new x(e,0))},selShapeItem:function(e,t){t.push(new R(e,4))}};A.prototype.getWrapOps=function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n],o=D[i.name];if(null==o){if("doSplitPara"===i.name)continue;console.assert(!1,"没有"+i.name+"的操作变换方法"),t.push(new w(i,2))}else o(i,t)}return t};var M={doDeleteText:function(e,t){t.push(new w(e,1))},doInsertText:function(e,t){t.push(new S(e,0))},doInsertShape:function(e,t){t.push(new R(e,5))},doDeleteShape:function(e,t){t.push(new R(e,6))},doMoveShape:function(e,t){t.push(new R(e,7))}};A.prototype.getWrapOpDones=function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n],o=M[i.name];null!=o&&o(i,t)}return t};var L={insertText:function(e,t){return e.param.pos==t.param.pos&&(e.param.len=t.param.len,!0)},insertParagraph:function(e,t){return e.param.pos==t.param.pos&&(e.param.len=t.param.len,!0)},insertComment:function(){return!0},insertPicture:function(e,t){return e.param.pos==t.param.pos&&(e.param.len=t.param.len,!0)},movePicture:function(e,t){return t.mergeTo_to_pos?e.param.to_pos=t.param.to_pos:e.param.pos=t.param.pos,!0},insertSeparator:function(e,t){return e.param.pos==t.param.pos&&(e.param.len=t.param.len,!0)}};A.prototype.getOpsFromWraper=function(e,t){t.splice(0,t.length);for(var n=0;n<e.length;++n){var i=e[n].cmd;if(i.isOpNeedMerge)if(delete i.isOpNeedMerge,(0,L[i.name])(t[t.length-1],i))continue;t.push(i)}return t},A.prototype.getOpsDoneFromWraper=function(e,t){t.splice(0,t.length);for(var n=0;n<e.length;++n){var i=e[n].cmd;t.push(i)}},A.prototype.transOthersSltRg=function(e,t,n){for(var i=!1,o=[],a=null,r=0;r<e.length;++r){var s=e[r];for(var l in s.mainOperstes)if(s.mainOperstes.hasOwnProperty(l)){var u=s.mainOperstes[l];u.length<=0||(o[r]=this.getWrapOpDones(u),a!=l&&(console.assert(null==a,"只能会有一个main对象"),a=l))}}for(var c=0;c<n.length;++c)for(var h=n[c],d=h.dataVersion<t?0:h.dataVersion-t,p=new w({name:"selectionRange",param:h},2),f=d;f<o.length;++f){var g=o[f];if(void 0!==g)for(var v=0;v<g.length;++v){var m=[];this.OpTrsOp(g[v],p,m,this.svtMap),m.length>0&&(console.assert(1==m.length),n[c].pos=m[0].cmd.param.pos,n[c].len=m[0].cmd.param.len,i=!0)}}return i},A.prototype.reverse=function(e){for(var t=[],n=e.length-1;n>=0;--n){var i=e[n],o={param:{}};"doInsertText"==i.name?(o.name="doDeleteText",o.param.pos=i.param.pos,o.param.len=i.param.strlen,t.push(o)):"doDeleteText"==i.name?(o.name="doInsertText",o.param.pos=i.param.pos,o.param.strlen=i.param.len,t.push(o)):"doInsertShape"==i.name?(o.name="doDeleteShape",o.param.shapeTreeType=i.param.shapeTreeType,o.param.shapeIdxPath=[].concat(s()(i.param.shapeIdxPath)),t.push(o)):"doDeleteShape"==i.name?(o.name="doInsertShape",o.param.shapeTreeType=i.param.shapeTreeType,o.param.shapeIdxPath=[].concat(s()(i.param.shapeIdxPath)),t.push(o)):"doMoveShape"==i.name&&(o.name="doMoveShape",o.param.shapeTreeType=i.param.shapeTreeType,o.param.shapeIdxPath=[].concat(s()(i.param.shapeIdxPath)),o.param.pos=i.param.shapeIdxPath[i.param.shapeIdxPath.length-1],o.param.shapeIdxPath[o.param.shapeIdxPath.length-1]=i.param.pos,t.push(o))}return t},A.prototype.getLocalCmds=function(e){var t=[];return null==e||e.forEach((function(e){t.push(e.localCommand)})),t};var F=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return k.b(e,new A,t,n)},B={insertComment:!1},H=function(e,t,n){t.forEach((function(t){var i={name:e,isOpNeedMerge:!0,param:{}};switch(t.name){case"doInsertText":i.param.pos=t.param.pos,i.param.strlen=t.param.strlen,n.push(new S(i,0));break;case"doDeleteText":i.param.pos=t.param.pos,i.param.len=t.param.len,i.param.isBackspace=!1,n.push(new w(i,1))}}))},G=function(){function e(){h()(this,e),this.arr=[]}return p()(e,[{key:"transDepositedGetArray",value:function(){return this.arr}},{key:"addItem",value:function(e){this.arr.push(e)}},{key:"clearAll",value:function(){this.arr=[]}}]),e}(),W=function(){function e(){h()(this,e)}return p()(e,[{key:"createObjectForSvr",value:function(e,t,n){switch(t){case"wps.TextStream":return new T(n);case"wps.TrackingChanges":return new C(n)}}},{key:"createTopObjectForSvr",value:function(e,t,n){return this.createObjectForSvr(e,t,n)}}]),e}(),j=function(){function e(){h()(this,e)}return p()(e,[{key:"mergeLocalCommand",value:function(e,t){switch(e.name){case"insertText":return"insertText"==t.name&&e.param.pos+e.param.strlen==t.param.pos&&(e.param.string=e.param.string.substr(0,e.param.strlen),e.param.string+=t.param.string,e.param.strlen+=t.param.strlen,!0);case"deleteText":return!("deleteText"!=t.name||t.param.pos>e.param.pos)&&(e.param.pos>t.param.pos&&(e.param.pos=t.param.pos),e.param.string=t.param.string+e.param.string,e.param.len+=t.param.len,!0);default:return!1}}},{key:"canMergeLocalCommand",value:function(e,t){if(!e)return!1;if(null!=e.canMerge&&0==e.canMerge)return!1;if(e.param.isComposing!=t.param.isComposing)return!1;switch(e.name){case"insertText":return"insertText"==t.name&&e.param.pos+e.param.strlen==t.param.pos;case"deleteText":return!("deleteText"!=t.name||t.param.pos>=e.param.pos)}return!1}},{key:"sendCommand",value:function(e){null!=e&&window.APP.api.sendCommandQueue(e.name,e.param)}},{key:"hasCommandQueue",value:function(){return window.APP.api.hasCommands()}},{key:"needAuxOps",value:function(e){return function(e){return!!B[e.name]}(e)}},{key:"exportAuxOpsToCommand",value:function(e,t){!function(e,t){var n=[];e.operates.forEach((function(e){e.data.forEach((function(e){"doInsertText"!==e.name&&"doDeleteText"!==e.name||n.push(e)}))})),n.length>0&&(t.param.auxOps=n)}(e,t)}}]),e}(),U=new W,V=new j,Y=n(1913),z=n(260),K=n(167),Z=n(2009),X=n(3479),q=n(684),J=n(227),Q=n(2291),$=function(){function e(){h()(this,e)}return p()(e,null,[{key:"load",value:function(){var t=Object(Q.a)();window.collection("webassembly","support",t?1:0),t&&e.start()}},{key:"start",value:function(){var e=window.Jieba=new Worker(window.__CONFIG__.pathRoot+"/weboffice-static/js/jieba.js");e.onmessage=function(t){var n=t.data.event,i=t.data.message,o=t.data.result;"success"===n?"worker-ready"===i?e.postMessage({command:"init",config:{cdn:window.__CONFIG__.wps.cdnLexerDicts,isLog:window.isDebugger}}):"init-completed"===i?window.InitJiebaCompleted=!0:"cut-result"===i&&e.cut&&e.cut.callback&&(e.cut.callback(o),e.cut.callback=null):"log"===n||"warn"===n&&window.isDebugger&&console.warn(i)},e.cut=function(t,n){!t||t.length<=0?n&&n(null):(e.postMessage({command:"cut",sentence:t}),e.cut.callback=function(e){n&&n(e)})}}}]),e}(),ee=n(7733),te=n.n(ee),ne=n(3851),ie=n(7734),oe=n.n(ie),ae=n(4104),re=n(1033),se=function(e){return 0===e.length||e.match(/^[ \r\t]+$/g)},le=!1,ue=null;function ce(e,t){var n=[];t.forEach((function(t,i){var o=e[t];(function(e,t){t&&(le=!1,ue=null);var n=e.info;if(!n)return!0;if(!0===n.redo||!0===n.undo||n.commands&&1===n.commands.length){var i=void 0;if(i=n.redo||n.undo?n.mgrdata:n.commands[0].param.mgrdata,le)return ue&&ue.push(e.revision),void 0===i&&(le=!1,ue=null),!1;if(i)le=!0,e.mergedRevisions=ue=[];else if(""===i)return le=!0,!1;return!0}return le=!1,ue=null,!0})(o,0===i)&&(!function(e){var t=e.info,n=e.action;if(t&&t.commands&&t.commands.length&&1===t.commands.length&&n){var i=t.commands[0].param.mgrdata;if(i){var o=t.commands[0].param.mgrop;if(o){var r=window.APP.util().cmdParsers[o](a()({},t.commands[0].param,{string:i}));e.action=r}else e.action=i}}}(o),n.push(t))}));var i=function(e,t){var n=Array.from(t).sort((function(e,t){return e-t})),i=void 0,o=n.filter((function(t){var n=e[t];if(n.info&&n.info.queryCommands&&0!==n.info.queryCommands.length)return!1;if(!n.info||!n.info.commands||!n.info.commands.length||1!==n.info.commands.length)return!0;if(n.commands&&!n.action)return!1;var o=n.info.commands[0],a=o.name,r=o.param;if(a===ae.default.insertComment&&!r.string)return i=n,!1;if(i&&a===ae.default.deleteComment&&!r.string&&i.info.commands[0].name===ae.default.insertComment){var s=n.user,l=i.user;if(s&&l&&s.id===l.id&&!i.info.commands[0].param.string)return!1}return i=null,!(a===ae.default.formatOp&&r.opType>=107&&r.opType<=112)&&(a!==ae.default.insertText&&a!==ae.default.deleteText||!se(void 0!==r.mgrdata?r.mgrdata:r.string)?![re.Font_Spacing,re.Font_Scaling,re.Font_AllCaps,re.Font_SmallCaps].includes(r.opType):!(!r.delStr||se(r.delStr)))}));return t.filter((function(e){return o.includes(e)}))}(e,n);return i.length>0?i:t}var he=new(function(){function e(){h()(this,e),this.cmdParsers=null}return p()(e,[{key:"historyFilter",value:function(){return i}},{key:"commandParser",value:function(){var e=this;return new Promise((function(t){oe()((function(n){e.cmdParsers=n.cmdParsers,t(n)}))}))}},{key:"getAlreadyColors",value:function(e){var t=e.isFont,n=e.limit,i=window.APP.data.doc.colorManager,o=[];return t&&(o=i.getMostUsedColors("font_color",n)),o}},{key:"getActiveColors",value:function(e){var t=e.isFont,n=window.APP.data,i=n.doc.colorManager,o=[];return t&&(o=i.getActiveColors(n,"font_color")),o}}]),e}()),de=n(2698),pe=n(14),fe=n(309),ge=n(1417),ve=function(){function e(t){h()(this,e),this.todoList=new ge.default,this.doc=t,this.doc.attachObserver(this)}return p()(e,[{key:"onInsertText",value:function(e,t,n,i,o){this.todoList.expand(t,n.length),this.todoList.todo({begin:t,end:t+n.length})}},{key:"onDeleteText",value:function(e,t,n){this.todoList.todo({begin:t,end:t+n.length}),this.todoList.remove(t,n.length)}},{key:"todo",value:function(e){var t=this;e.forEach((function(e){t.todoList.todo({begin:e.pos,end:e.pos+e.len})}))}},{key:"getRangesAndDetachObserver",value:function(){for(var e=this.todoList.tree.makeHintAtHead(),t=[];e.good();e.moveNext())t.push({pos:e.pos,len:e.len});return this.doc.detachObserver(this),t}}]),e}(),me=n(324),_e=n(2939),ye=n(7735),be=n.n(ye),Te=n(7736),Ce=n.n(Te),ke=n(7737),we=n.n(ke),Se=n(3480),Pe=n(984),Ie=n(24),Ee=n.n(Ie),Oe=n(600),xe=function(){function e(t,n){h()(this,e),this.startTime=performance.now(),this.endTime=null,this.renderSuccess=!1,this.renderFinish=!1,this.id=t.id,this.shape_tree_type=t.shape_tree_type,this.statusChangedCallback=n,this.isPresetDrawing=t.isPresetDrawing,this.invokeStatusChangeCallback=Object(Oe.debounce)(this.invokeStatusChangeCallback.bind(this),3e3),this.report=Object(Oe.debounce)(this.report.bind(this),3e3)}return p()(e,[{key:"done",value:function(){this.updateStatus(!0),this.report()}},{key:"fail",value:function(){this.updateStatus(!1)}},{key:"updateStatus",value:function(e){this.renderSuccess=e,this.renderFinish=!0,this.endTime=performance.now(),this.invokeStatusChangeCallback()}},{key:"report",value:function(){var e={event:"reading_pic1",times:Math.round(this.duration)};this.isPresetDrawing?e.presetDrawing=!0:e.value=Math.round(this.sourceSize),window.collection("experience",e)}},{key:"invokeStatusChangeCallback",value:function(){this.statusChangedCallback()}},{key:"duration",get:function(){return this.endTime-this.startTime}},{key:"sourceSize",get:function(){if(!window.APP.data)return 0;var e=window.APP.data.shapeManager.getShapeFromMap(this.shape_tree_type,this.id);return e&&"gif"===e.format?e.originalSourceSize/1e3||0:e&&e.sourceSize/1e3||0}}]),e}(),Re=function(){function e(t){var n=this;h()(this,e),this.shapeRenderInfos=[],this.firstScreenShapes=[],this.firstScreenPagesIndex=[],this.hasCollectionReported=!1,this.isShutdown=!1,this.handleScroll=Object(Oe.throttle)((function(){var e=n.app.workspace&&n.app.workspace.currentUsedPage;e&&n.firstScreenPagesIndex.some((function(t){return!e.includes(t)}))&&(n.clearAll(),window.collection("experience",{event:"reading_lcp_cancel"}))}),300),this.app=t,window.addEventListener(z.default.names.DOC_WORKSPACE_SCROLL,this.handleScroll)}return p()(e,[{key:"recordRenderShape",value:function(e){if(this.hasCollectionReported||this.isShutdown)return{done:function(){},fail:function(){}};var t=this.getShapeRecordInfo(e);return t||(t=new xe(e,this.reportCollection.bind(this)),this.shapeRenderInfos.push(t),t)}},{key:"initialShapeRenderCollection",value:function(){var e=this,t=this.app.workspace.getVisiblePages();this.firstScreenPagesIndex=t.map((function(t){return t.layers&&e.getShapeFromLayoutPage(t).forEach((function(n){e.firstScreenShapes.push({pageIndex:t.layout_index,id:n.id,shape_tree_type:n.shape_tree_type})})),t.layout_index})),this.reportCollection()}},{key:"getShapeRecordInfo",value:function(e){return this.shapeRenderInfos.find((function(t){return t.id===e.id&&t.shape_tree_type===e.shape_tree_type}))}},{key:"reportCollection",value:function(){var e=this;if(!this.hasCollectionReported&&!this.isShutdown){var t=[];if(this.firstScreenShapes.every((function(n){var i=e.getShapeRecordInfo(n);return!(!i||!i.renderFinish)&&(t.push(i),i.renderFinish)}))){window.collection("experience",{event:"reading_pic1_quantity",value:this.firstScreenShapes.length});var n=this.hasShapeChanged(),i=performance.now();if(this.firstScreenShapes.length>0&&!n){var o=1;t.forEach((function(e){o=Math.max(e.endTime)})),i=o;var a=t.filter((function(e){return e.renderSuccess})).length,r=this.firstScreenShapes.length-a;window.collection("experience",{event:"reading_pic1_undraw",value:Math.round(100*r/this.firstScreenShapes.length)/100}),window.collection("experience",{event:"reading_pic0",value:r})}n?window.collection("experience",{event:"reading_lcp_cancel"}):window.collection("experience",{event:"reading_lcp",times:Math.round(i)}),this.clearAll(),this.hasCollectionReported=!0}}}},{key:"clearAll",value:function(){window.removeEventListener(z.default.names.DOC_WORKSPACE_SCROLL,this.handleScroll),this.firstScreenPagesIndex.length=0,this.firstScreenShapes.length=0,this.shapeRenderInfos.length=0,this.isShutdown=!0}},{key:"getShapeFromLayoutPage",value:function(e){var t,n=[],i=e.layers;i&&(n=[].concat(s()(i.embedShapes||[]),s()(i.bottomCards||[]),s()(i.topCards||[])),i.getShapeCards&&(t=n).push.apply(t,s()(i.getShapeCards())));var o=[];return e.decorativePage&&e.decorativePage.layers&&(o=[].concat(s()(e.decorativePage.layers.embedShapes||[]),s()(e.decorativePage.layers.bottomCards||[]),s()(e.decorativePage.layers.topCards||[]))),n.concat(o)}},{key:"hasShapeChanged",value:function(){for(var e=this,t=this.app.data.typoinfo.layout_pages,n=function(n){var i=e.firstScreenPagesIndex[n],o=t[i],a=e.getShapeFromLayoutPage(o),r=e.firstScreenShapes.filter((function(e){return e.pageIndex===i}));return a.length!==r.length?{v:!0}:{v:!r.every((function(e){return a.some((function(t){return t.id===e.id&&t.shape_tree_type===e.shape_tree_type}))}))}},i=0;i<this.firstScreenPagesIndex.length;i++){var o=n(i);if("object"===(void 0===o?"undefined":Ee()(o)))return o.v}return!1}},{key:"handleShapeRequestFail",value:function(e,t){var n=this.getShapeRecordInfo({id:e,shape_tree_type:t});n&&n.fail()}}]),e}(),Ne=function e(t){h()(this,e),this.app=t,this.shape=new Re(this.app)},Ae=n(7742),De=n.n(Ae),Me=n(1643),Le=n(6100),Fe=n(7749),Be=n.n(Fe),He=n(7750),Ge=n.n(He),We=n(7751),je=n.n(We),Ue=n(2175),Ve=n.n(Ue),Ye=n(7754),ze=n.n(Ye),Ke=n(1914),Ze=n(1238),Xe=n(4109),qe=!1;function Je(e,t){e.forEach((function(e){for(var n in e)for(var i=e[n].objRgs,o=function(e){var n=i[e],o=[{name:"selectionRange",param:{pos:n.begin,len:n.end-n.begin,layoutIndex:n.layoutIndex}}],a=n.shapeIdxPath,r=n.selShapeIdxPaths,s=n.shapeTreeType;if((r||a)&&(r||[a]).forEach((function(e){o.push({name:"selShapeItem",param:{shapeTreeType:s,shapeIdxPath:e}})})),F(t,o,!1)){var l=o[0].param;if(n.begin=l.pos,n.end=l.pos+l.len,o.length>1){for(var u=[],c=1,h=o.length;c<h;++c){var d=o[c].param.shapeIdxPath;d.some((function(e){return e<0}))||u.push(d)}0===u.length?(delete n.shapeIdxPath,delete n.selShapeIdxPaths,delete n.shapeTreeType):1===u.length?(n.shapeIdxPath=u[0],delete n.selShapeIdxPaths):(n.selShapeIdxPaths=u,delete n.shapeIdxPath)}}},a=0;a<i.length;++a)o(a)}))}var Qe=function(){function e(){var t,n=this;h()(this,e),this.isPreview=!1,this.isReadonlyOnLocal=!1,this.customRenderManager=new ze.a,this.isHighlightMode=!1,this.isInHistoryReview=Object(pe.hasQuery)("version"),this.handleUnload=function(){n.isPreview||n.editor&&n.editor.closeLastTransact(),Object(Le.storeReadPosition)()},this.locCooperRecord=function(e){je.a.click(e)},this.scheduler=new we.a,this.info={},this.newRange=null,this.isNewDoc=!1,this.popStateStack=null,this.config={},this.view={},window.APP=this,this.api=f.a.buildGetInstance(this),(t=window.g_rpt).setCustomFactory(U),t.setCommandProc(V),t.setTransDepositedContainer(new G),this.isFilePermissionConfirmed=!1,this.isFirstTimeHandleBookmark=!0,this.isFirstScreenRendered=!1,this.isAppRecovered=!1,this.applyLocalOperation=!0,this.userAclUpdate=null,this.dumpPic=window.location.search.indexOf("dumpPic")>=0,this._currentClipBoardInfo=null,this.lazyLoadCoreModulesCache={},this.collection=new Ne(this),this.isExecutingCmd=!1,this.cmdUserId=null,this.functionStatus=new De.a(this),this.initURLConfigs(),this.pluginMgr=Ve.a,this.isCmdResponse=!1}var t,n,i;return p()(e,[{key:"util",value:function(){return he}},{key:"toggleReadonlyOnLocal",value:function(e){this.isReadonlyOnLocal=e,this.workspace.switchIndicatorVisibility(!e)}},{key:"isReadOnly",value:function(){return!!(this.data&&this.data.doc&&this.data.doc.getReadOnly())||(!!this.isReadonlyOnLocal||(this.isPreview||this.isAclRead||!this.canEdit()||this.dumpPic))}},{key:"isReadOnlyComment",value:function(){return!(Object(de.b)()||!this.isReadOnly()||!this.isAclComment)}},{key:"supportReadOnlyComment",value:function(){return!(!window.__CONFIG__.wps.enableReadOnlyComment||window.__WPSENV__.cache_preview||this.data&&this.data.doc&&this.data.doc.getReadOnly())}},{key:"isEmbed",value:function(){return!1}},{key:"isLogin",value:function(){return this.info&&this.info.userid&&"-1"!==this.info.userid&&!this.info.userid.startsWith("fake")}},{key:"clearAll",value:function(){this.openApi&&this.openApi.eventRefire.onDocumentDestroy(),this.blinkIntervalID&&(clearInterval(this.blinkIntervalID),this.blinkIntervalID=null),this.blinkCallbackTimeoutID&&(clearTimeout(this.blinkCallbackTimeoutID),this.blinkCallbackTimeoutID=null),this.viewUIL.clearAll(!0),this.todoList.clear(),this.customRenderManager.clearAll(),window.removeEventListener(J.default.names.ON_BEFORE_UNLOAD,this.handleUnload)}},{key:"rebuild",value:function(){this.data&&(this.clearAll(),this._lastData={selRange:this.data.selection.getNormalRange(),appState:{isCooperationMode:this.isCooperationMode},isEditMode:!!this.isEditMode,commentStatus:this.commentShowStatus,isRebuildForEncodingChange:window.__WPS_TEXT_ENCODING_SELECT_TIME__-Date.now()<1e4},this.commentsDataManager=null,this.coreComponentsGetterPromise=null,this.renderComponentGetterPromise=null,this.updaterComponentGetterPromise=null,this.newRange=null,this.oldNewRange=null,this.data=null,this.view={})}},{key:"recover",value:function(){if(this._lastData){var e=this._lastData.selRange,t=0,n=this.data.doc.getMainTextLength(),i={updateOnly:K.isPad&&this._lastData.isRebuildForEncodingChange};if(t>e.pos||t+n<e.pos+e.len?this.data.selection.setPosition(0,0,i):this.data.selection.setPosition(e.pos,e.pos+e.len,i),this.isEditMode=this._lastData.isEditMode,this._lastData.appState.isCooperationMode&&this.appApi.switchToCooperationMode(!0),this._lastData.commentStatus){var o=this._lastData.commentStatus;this.appApi.setCommentShowStatus(o)}this._lastData=null,this.isAppRecovered=!0}}},{key:"preloadUIL",value:function(){this.initViewUIL(),this.viewUIL.preload&&this.viewUIL.preload()}},{key:"initViewUIL",value:function(){}},{key:"init",value:(i=u()(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.rebuild(),this.todoList=new Be.a,this.initData(t,this.api),this.preloadUIL(),this.data.init(t),e.next=7,this.initView();case 7:this.recover(),this.defaultPageCount=this.data.typoinfo.pageCount,!this.isPreview&&this.initTemplate(),this.notifyTrackChange(this.data.doc.textStream.getRevisionTextStream().isTrackingChanges);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"createDocumentMapManager",value:function(){return null}},{key:"initOverBase",value:function(e){if(void 0!==e.woReviewHighlightMode&&(this.isHighlightMode=e.woReviewHighlightMode),!this.isAppRecovered)if(this.editor.isPalaceMuseumTemplate){var t=this.data.doc.getContentControlsInMainText();if(t[1]&&"text"===t[1].data.private.title){var n=t[1].begin+1;this.data.selection.setPosition(n,n)}}else if(this.restrictEditHandler.restrictState={isRestrictProtectOn:e.protectOn,restrictType:e.protectType},this.formatContentController.isRestrictEditMode)this.formatContentController.selectFirstControl();else{var i=this.data.doc.getDocumentStart();this.data.selection.setPosition(i,i,{updateOnly:!0})}window.APP.workspace.changeShapeBtn&&window.APP.workspace.changeShapeBtn.update({isEditMode:!this.isReadOnly()&&this.isEditMode})}},{key:"handleBookmark",value:function(e){var t=this.getLinkName();if(t){var n=this.initializedBookmarkInfo;if(console.log("【书签信息】",n),n&&t){var i=n.range,o=n.inComment,a=n.commentRange,r=o?a:i,s=this.data.typoinfo.getLayoutPageCache(this.data.typoinfo.pageCount-1);if(s){var l=r.pos+r.len,u=s.end;l>u&&this.data.api.queryRange({gcpCurrent:u,length:l-u})}this.restrictEditHandler.restrictState={protectOn:e.protectOn,protectType:e.protectType};var c=function(){var e=0,t=r.pos,n=r.len;Object(Ze.typoToPositionWithLoading)(t).then((function(){!function i(){window.APP.data.selection.setPosition(t,t+n,{isSend:!0}),window.APP.data.selection.begin.position===t?window.APP.workspace.makesureCursorVisible(!0):e<10&&(e+=1,setTimeout((function(){i()}),250))}()}))};if(K.isMobile){if(!o){var h={blink:{range:{pos:r.pos,len:r.len},color:"#ffffff",isOnlyOnce:!0}};this.setSelectionHightLight(h.blink,{blinkTime:20,intervalTime:60,totalTime:300},c)}}else c();Object(pe.removeQuery)("linkname")}}}},{key:"setBookmarkHandled",value:function(){this.isFirstTimeHandleBookmark=!1}},{key:"getLinkName",value:function(){var e="",t=window.location.search;if(-1===t.indexOf("linkname=")&&(t=window._parent.location.search),t=decodeURIComponent(t),/linkname=/.test(t)){var n=t.match(/linkname=([^?|&]+)/);e=n&&n[1]}return e}},{key:"getBookmarkInfo",value:function(){var e=this.getLinkName();if(e)return this.data.doc.bookmarks.getBookmarkInfo(e)}},{key:"setSelectionHightLight",value:function(e,t,n){var i=this;if(e.color&&e.range&&t.blinkTime){var o={ranges:[{pos:e.range.pos,len:e.range.len,color:e.color}],time:t.blinkTime},a=window.utils.Lodash.throttle((function(e){z.default.dispatchEvent(Z.a.HIGHLIGHT.BLINK,{affair:"blink",params:e})}),t.blinkTime);if(t.intervalTime&&t.totalTime){if(t.intervalTime>t.totalTime)return void console.warn("间隔时间请小于总时间哦");if(t.blinkTime>t.intervalTime)return void console.warn("高亮时间请小于间隔时间哦，否则会闪烁错乱");this.blinkIntervalID&&clearInterval(this.blinkIntervalID),this.blinkCallbackTimeoutID&&clearTimeout(this.blinkCallbackTimeoutID),e.isImmediately&&a(o),this.blinkIntervalID=setInterval((function(){a(o)}),t.intervalTime),this.blinkCallbackTimeoutID=setTimeout((function(){i.blinkIntervalID&&clearInterval(i.blinkIntervalID),i.blinkIntervalID=null,n&&n()}),t.totalTime)}else a(o),n&&n()}else console.warn("blink error")}},{key:"getWatermark",value:function(){return this._watermark}},{key:"setWatermark",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(this._watermark=e,t&&this.workspace&&this.workspace.refreshForcedly())}},{key:"focusInput",value:function(){this.workspace.input.focus()}},{key:"blurInput",value:function(e){this.workspace.input.blur(e)}},{key:"update",value:function(e){}},{key:"updateWordStat",value:function(e){this.data&&this.data.updateWordStat(e)}},{key:"updateComponent",value:function(){this.data&&this.data.typoinfo.updateComponent(!0,{})}},{key:"loadInfo",value:function(e){this.info=Object.assign(this.info,e),z.default.dispatchEvent(z.default.names.DOC_APP_INFO_LOADED,e)}},{key:"setServicesLoader",value:function(e){this.servicesLoader=e}},{key:"load",value:function(e,t,n,i,o){this.api.openFile(e,t,n,i,o)}},{key:"getWordStat",value:function(e){var t=e.wordStat;return e&&e.queryResult&&e.queryResult.forEach((function(e){"wordStat"===e.name&&(t=e.result)})),t}},{key:"isAllowChangeSelection",value:function(e){var t=this.data.doc.getSubDocType(e);return t===fe.MainText||!this.isWebMode()||this.isWebMode()&&(t===fe.Comment||t===fe.Footnote||t===fe.Endnote)}},{key:"changeSelectionByLocalCommand",value:function(e,t){if(e.find((function(e){return"insertComment"===e.name}))){var n=(this.data.doc.comments.getLocalComment()||{}).body;n&&(t.pos=n.pos+n.len-1,t.len=0)}}},{key:"handleCmdResponseInPreviewMode",value:function(e){e.queryResult&&this.onQueryCommandResult(e.queryResult)}},{key:"handleCmdResponse",value:function(e,t){var n=this;if(e.onlyChangeDocProps)return this.data.doc.docInfo=e.docInfo,this.onExecCommandResult(e.execResult),void J.default.cooper.onDocumentSaveSuccess();if(e.broadcastCmdMsg)this.onBroadcastExecDetail(e);else{this.cmdUserId=e.cmdUserId;var i=fe.MainText;e.wordStat=this.getWordStat(e);var o=e.queryResult,a=e.execResult;if(!(o&&o.length>0&&o.every((function(e){return"processData"===e.name})))){this.editor&&a&&a.length>0&&this.editor.reportPaste(a[0]),this.updateStateByDocInfo(e),this.checkPreviewLimit(e),void 0!==e.error&&this.onCmdError(e);var r=window.g_rpt.needSendToSvr;window.g_rpt.needSendToSvr=!1,this.applyLocalOperation=a&&a.length,this.workspace.saveSelection(),this.updateShapeCache(e),this.clearNewObjForGroupShape(e);var l={begin:-1,end:-1};this.data.selection.backupUndoRedoSel=l,this.workspace.disableUpdate(!0);var u=window.g_rpt.applyServerVersions(e);this.workspace.enableUpdate(!0),this.afterApplyServerVersions();var c=this.data.selection.getNormalRange(),h=this.data.selection.isStartActive();if(!this.data.doc.useCoreTypo){var d=this.data.doc;d.footnotes.rangeClass.tree.empty()&&d.endnotes.rangeClass.tree.empty()||(this.data.doc.useCoreTypo=!0,this.data.typoinfo.changeToCoreTypo&&this.data.typoinfo.changeToCoreTypo())}"concernRanges"in e?this.update({typoInfo:e.typoInfo,textStream:e.textStream,concernRanges:e.concernRanges,wordStat:e.wordStat,docInfo:e.docInfo}):e.wordStat&&this.updateWordStat(e.wordStat);var p=null;if(-1!==l.begin){this.data.selection.selContext.setHeaderfooterLayoutIndex(l.layoutIndex);var f=K.isMobile&&this.isCardMode?l.begin:l.end;if(i=this.data.doc.getSubDocType(l.begin),this.isAllowChangeSelection(l.begin)){var g=l.shapeIdxPath,v=l.selShapeIdxPaths;(g||v)&&(p={shapeTreeType:l.shapeTreeType,shapeIdxPath:g,selShapeIdxPaths:v});this.data.selection.setPosition(l.begin,f,{isSend:!1,updateOnly:!0})}c=this.data.selection.getNormalRange(),h=this.data.selection.isStartActive()}delete this.data.selection.backupUndoRedoSel;var m=function(e){return null==e?[]:k.c(e,new A)}(u),_=void 0,y=e.execResult;if(y&&y.length){var b=e.selStart,T=e.selEnd;if(b>0&&T>0&&b===T&&y.some((function(e){return"insertDatetime"===e.cmdName})))this.data.doc.getDataLogic("final").getText(T-1,1).charCodeAt(0)===me.e&&(e.selStart=b-1,e.selEnd=T-1)}var C=!1,w=!this.data.selection.selContext.shapeIdxPathOfTextbox&&this.data.selection.selShapeIdxPaths,S=void 0,P=this.data.selection.activeShapeTreeType;if(void 0!==e.selStart&&e.selStart>=0&&void 0!==e.selEnd&&e.selEnd>=0)_={pos:e.selStart,len:e.selEnd-e.selStart},C=!0;else if(this.data.selection.tran){var I=ne.c(this.data.selection.tran,u,!0);if(I.applyVersions.length>0||I.resetBaseVersions.length>0){var E=[{name:"selectionRange",param:c}];if(p&&(p.selShapeIdxPaths||[p.shapeIdxPath]).forEach((function(e){E.push({name:"selShapeItem",param:{shapeTreeType:p.shapeTreeType,shapeIdxPath:e}})})),F(I,E,!1),_=E[0].param,p){S=[];for(var O=1,x=E.length;O<x;++O){var R=E[O].param.shapeIdxPath;R.some((function(e){return e<0}))||S.push(R)}0===S.length?S=null:P=p.shapeTreeType}}else _=c,p&&(S=p.selShapeIdxPaths||[p.shapeIdxPath],P=p.shapeTreeType)}else{var N=u&&0===u.localCommitedVersion.length&&u.applyVersions.length&&u.applyVersions[u.applyVersions.length-1],D=N&&N.extRanges.get(window.APP.data.selection),M=!1;if(D){var L=D.beginRgs&&D.beginRgs.objRgs&&D.beginRgs.objRgs[0]||{begin:-1,end:-1},B=L.begin,H=L.end;B===c.pos&&H===c.len+c.pos&&function(e,t){var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var o=0,a=n.length;o<a;++o){var r=n[o],s=e[r],l=t[r];if(Array.isArray(s)){if(!Array.isArray(l))return!1;if(s.length!==l.length)return!1;for(var u=0,c=s.length;u<c;++u)if(s[u]!==l[u])return!1}else if(s!==l)return!1}return!0}(D.beginRgs.objRgs[0],D.endRgs.objRgs[0])&&(M=!0)}var G=[{name:"selectionRange",param:c}];if(w&&w.forEach((function(e){G.push({name:"selShapeItem",param:{shapeTreeType:n.data.selection.activeShapeTreeType,shapeIdxPath:e}})})),F(u,G,!e.bSendedCmdBlock),_=G[0].param,w){S=[];for(var W=1,j=G.length;W<j;++W){var U=G[W].param.shapeIdxPath;U.some((function(e){return e<0}))||S.push(U)}0===S.length&&(S=null)}if(M){var V=D.endRgs.objRgs[0];V.begin=_.pos,V.end=_.pos+_.len,S?(V.shapeTreeType=this.data.selection.activeShapeTreeType,S.length>1?V.selShapeIdxPaths=[].concat(s()(S)):V.shapeIdxPath=S[0]):(delete V.shapeIdxPath,delete V.selShapeIdxPaths,delete V.shapeTreeType)}}this.data.selection.tran=null,ne.a(u,Je),ne.b(u,Je);var Y=!1;if(this.data.selection.isComposing&&(_.len=this.data.selection.getNormalRange().len),a&&a.length>0){var Z=a[a.length-1];-1!==["insertRowAbove","insertRowBelow","insertColumnLeft","insertColumnRight"].indexOf(Z.cmdName)&&(_.pos=e.selStart,_.len=0,Y=!0)}this.api.clearCommands(),m.forEach(this.reApplyLocalCmd,this),window.g_rpt.needSendToSvr=r,this.afterReapplyLocalCmd(m,_),m[0]&&"deleteComment"===m[0].name&&(_.pos=m[0].param.pos,_.len=m[0].param.len);var X=_.pos,q=_.pos+_.len,Q=this.data.doc.limitInSubdoc(X,q);if(X=Q.begin,q=Q.end,h){var $=X;X=q,q=$}if(this.workspace.disableUpdate(!1,!0),i=this.data.doc.getSubDocType(X),this.changeSelection(X,q,e,t,S,P)&&e.bSendedCmdBlock&&C&&u.applyVersions.length>0){var ee=u.applyVersions[u.applyVersions.length-1];ee.isSelf&&ee.commitExtObjects(window.g_rpt.transDepositedContainer.transDepositedGetArray())}var te=J.default.cooper.getCooperCenter().getCooperationUsers(),ie=[];te.forEach((function(e){null!=e._range&&ie.push(e._range)})),function(e,t,n){null!=e&&(new A).transOthersSltRg(e.applyVersions,t,n)}(u,e.baseDataVer,ie),this.data.selection.selCoop.setCooperationSelections(te,this.info),this.workspace.enableUpdate(!1,!0),this.oldNewRange=null,this.data.selection.update({isEditing:!0,updateOnly:!0,instant:!0,isDisableForce:Y}),e.versions[0]&&!e.versions[0].self&&this.workspace.restoreSelection(),e.queryResult&&this.onQueryCommandResult(e.queryResult),e.replaceResult&&z.default.dispatchEvent(z.default.names.DOC_REPLACE_RESULT,e.replaceResult),e.execResult&&(e.cmdUserId&&this.data.doc.reviewMgr.updateCmdUserId(e.cmdUserId),this.onExecCommandResult(e.execResult,{subDocTypeToResponse:i}));var oe=e.execResult&&e.execResult.find((function(e){return"modifyComments"===e.cmdName}));if(this.data.doc.reviewMgr.onModifyComments(oe),0==this.isReadOnly()&&t&&J.default.cooper.onDocumentSaveSuccess(),this.uilManager){var ae=this.uilManager.undoRedoHandler;ae&&(ae.state.isUndoRedo=!1)}this.cmdUserId&&(this.isExecutingCmd=!1),this.cmdUserId=null,this.viewUIL.typoUpdate(),this.viewUIL.onCmdResponse(),e.typoInfo&&this.data.doc.useCoreTypo&&this.updateComponent(),this.applyLocalOperation=!0,"concernRanges"in e&&z.default.dispatchEvent(z.default.document.ON_DOC_DATA_LOAD)}}}},{key:"onCmdResponse",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isPreview)this.handleCmdResponseInPreviewMode(e);else{this.isCmdResponse=!0;try{this._mockResponseError(),this.handleCmdResponse(e,t)}catch(t){if(window.__CONFIG__.wps.isEnableCmdExceptionReload&&z.default.dispatchEvent(z.default.names.ON_CORE_ERROR),!this.isCmdExceptionOccurred){var n=JSON.stringify(a()({type:"response",name:"edit_blocking",cmd:e.execResult&&e.execResult.reduce((function(e,t){return e.push(t.cmdName),e}),[]).join(",")||""},this.getCoreErrorContext())),i={message:n,stack:t.stack,toString:function(){return n}};window.badJsFunc(!1,{error:i}),console.error(window.isDebugger?t:new Error(n)),this.isCmdExceptionOccurred=!0}this.api.queryInit()}this.isCmdResponse=!1}}},{key:"changeSelection",value:function(e,t,n,i,o,a){if(!this.isAllowChangeSelection(e))return!1;var r={isSend:this.data.selection.selCoop.cachedParam.isCacheSendSelChanged,updateOnly:!0,selectionShapes:n.selectionShapes,preventScroll:!i||n.selectionShapes,isGlyphTail:n.glyphTail,isKeepVer:!0};o&&(r.selShapeIdxPaths=o,r.shpaeTreeType=a);var s=this.data.selection.selInfo&&this.data.selection.selInfo.getValidActiveDocumentFieldNames();return s&&s.length?r.documentFieldNames=s:r.documentFieldNames=[],this.data.selection._dispatch("onUILOperationTriggered",e,t,r),this.data.selection.notifySelectionChanged({fromServer:!0}),!0}},{key:"reApplyLocalCmd",value:function(e){var t=this.workspace.updateDisabled;t||this.workspace.disableUpdate();var n={},i=this.data.selection.selInfo.getValidActiveDocumentFieldNames();if(i&&i.length?n.documentFieldNames=i:n.documentFieldNames=[],this.data.selection.setPosition(e.param.pos,e.param.pos+e.param.len,n)){if("deleteText"===e.name||(e.param.rgs=this.data.selection.getNormalRanges(e.param.isExpendPara)),t||this.workspace.enableUpdate(),this.editor.cmdExecutor.exec(e,!0)&&this.api.pushCommand(e),e.param&&e.param.extendDocumentFieldNames&&e.param.extendDocumentFieldNames.length){var o=this.data.doc.documentFields,a=[];e.param.extendDocumentFieldNames.forEach((function(e){var t=o.getFieldByName(e);t&&a.push(t)})),a.length&&o.extendDocumentFields(a,e.param.pos,e.param.strlen)}}else console.warn("reapply local cmd failed!",e)}},{key:"onQueryCommandResult",value:function(e){if(e)for(var t=0;t<e.length;++t)this.handleQueryCommandResult(e[t])}},{key:"onExecCommandResult",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&0!==e.length)for(var i=n.subDocTypeToResponse,o=["paste","smartPaste"],a=["insertBreak","undo","redo","insertRowAbove","insertRowBelow","insertColumnLeft","insertColumnRight"],r=0;r<e.length;++r){var s=e[r].cmdName;if(-1!==o.indexOf(s)){var l=void 0;void 0!==e[r].gcp&&void 0!==e[r].ccp&&(l={pos:e[r].gcp,len:e[r].ccp});var u="paste"===s?J.default.names.edit.COPY_PASTE_SUCCESS:z.default.names.SELECTIVE_PASTE_SUCCESS;J.default.dispatchEvent(u,{range:l}),this.workspace.makesureCursorVisible(),l&&this.data.doc.inlineAnchors.rangeClass.collectRanges(l.pos,l.len).some((function(e){if(e.shapeData.extData&&e.shapeData.extData.isBrokenImg)return t.workspace.showToast("error",_i18n("applications.writer.components.core.event.uil.view.pasteBrokenImage", "Image pasting failed, please open the original image and \"copy\" and paste it, or use \"insert image\"")),!0}));break}if(-1!==a.indexOf(s))this.workspace.makesureCursorVisible();else if("replaceBookmarkContent"===s)z.default.dispatchEvent(z.default.names.DOC_REPLACE_RESULT,e);else if("protectDoc"===s||"unprotectDoc"===s){if(!e[r].error){this.restrictEditHandler.restrictState={isRestrictProtectOn:e[r].protectOn,restrictType:"protectDoc"===s?e[r].protectType:X.txDocProtNone};var c=this.data.selection.getNormalRange();this.changeSelection(c.pos,c.pos+c.len,{},!1)}window.g_rpt.lockCurVersion(),window.g_rpt.lockCurrentUndoSteps()}else if("setDocProps"===s)this.viewUIL.onDocSetProps(e[r]);else if("setTrackRevisions"===s){if(!e[r].error){var h=this.data.doc.textStream.getRevisionTextStream();h.doSetTrackChanges(e[r].trackRevisions,e[r].userId),this.notifyTrackChange(h.isTrackingChanges,h.initiatorUserID)}}else"setRevisionSettings"===s&&(e[r].error||this.editor.viewSettings.doSetRevisionSettings(e[r]));"undo"!==s&&"redo"!==s||(z.default.dispatchEvent(z.default.names.DOC_UNDO_REDO,{type:s}),i!==fe.MainText&&i!==fe.Comment&&i!==fe.Footnote&&i!==fe.Endnote&&this.isWebMode()&&this.workspace.showToast("warn","undo"===s?_i18n("applications.writer.components.core.event.uil.view.undoTip", "Undo Operation in Non-Body Area"):_i18n("applications.writer.components.core.event.uil.view.redoTip", "Redo Operation in Non-Body Area")))}}},{key:"onBroadcastExecDetail",value:function(e){if(e.command){var t=e.userId,n=e.command,i=n.name;if("insertInks"===i)(this.isMobileMode()||this.isWebMode())&&J.default.dispatchEvent(z.default.cooperation.ON_NOTIFY_TIPS,{cmdName:i,userid:t});else if("formatOp"===i){var o=n.param;o.opType!==re.Sec_Margins&&o.opType!==re.Sec_PageOrientation&&o.opType!==re.Sec_PageSize&&o.opType!==re.Sec_LineNumbering||J.default.dispatchEvent(z.default.cooperation.ON_NOTIFY_TIPS,{cmdName:i,type:o.opType,userid:t})}}}},{key:"handleQueryCommandResult",value:function(e){switch(this.api.executeQueryCmdCallback(e),e.name){case"autoNums":this.data.doc.docmap&&this.data.doc.docmap.onQueryAutoNumStringBack(e.error,e.result);break;case"copy":this.uilManager.clipboardHandler.onServerCopy(e);break;case"copyFormat":0!==e.error?(this.uilManager.editHandler.state.formats=void 0,z.default.dispatchEvent(z.default.formatPainter.ON_FORMAT_PAINTER_RESET)):this.uilManager.editHandler.state.formats=e.result.formats;break;case"docProperties":e.error||this.data.doc.updateDocProperties(e.result)}}},{key:"hasPreparedRange",value:function(){return null!=this.newRange}},{key:"appendSendInfo",value:function(e){if(this.data){if(!this.isPreview){var t=0;this.workspace&&(t=this.data.typoinfo.getCurrentPos(this.workspace.getCurrentRect()));var n={pos:t,len:0};this.transRange(n,!0),e.currentPos=n.pos}null!=this.newRange&&(e.newRange={gcpCurrent:this.newRange.gcpCurrent,length:this.newRange.length},e.currentPos>=e.newRange.gcpCurrent&&e.currentPos<e.newRange.gcpCurrent+e.newRange.length||(e.currentPos=e.newRange.gcpCurrent+parseInt(e.newRange.length/2)),this.oldNewRange=this.newRange,this.newRange=null),this.data.api.hasQueryCommands()&&(e.queryCommands=this.data.api.gainQueryCommands());var i=this.data.doc.textStream.getRevisionTextStream(),o=window.APP.info.userid;i.isTrackingChanges&&e.commands&&e.commands.forEach((function(e){e.param&&(e.param.woRevisionUserName=i.username,e.param.woRevisionUserId=i.revisionUserId,e.param.woRevisionUserProviderId=Object(Xe.b)(o))}))}else console.warn("数据未准备好，此处有问题，此时不应该调这个函数，不知道什么时候会触发")}},{key:"prepareRange",value:function(e,t){if(null!=e){if(!this.oldNewRange||this.oldNewRange.gcpCurrent!=e.gcpCurrent||this.oldNewRange.length!=e.length){var n=this.transRange({pos:e.gcpCurrent,len:e.length},!0),i=void 0,o=void 0;t&&null!==this.newRange?(i=Math.min(this.newRange.gcpCurrent,n.pos),o=Math.max(this.newRange.gcpCurrent+this.newRange.length,n.pos+n.len)-i):(i=n.pos,o=n.len),this.newRange={gcpCurrent:i,length:o}}}else this.newRange=null}},{key:"onTypoChanged",value:function(e){console.log("onTypoChaned:",e)}},{key:"updateRanges",value:function(e,t,n,i){var o=t,a=e,r=e+o;i.forEach((function(e){var t=e.pos,i=e.pos+e.len;n?a>=t?a<=i&&(i+=o):(t+=o,i+=o):t<r&&i>a?t<=a?i=i-o<a?a:a+(i-r):(t=a,i=i-r>0?a+(i-r):t):t>=r&&(t-=o,i-=o),e.pos=t,e.len=i-t}))}},{key:"getLocalVersionOps",value:function(){for(var e=window.g_rpt,t=[],n=[],i=e.curVersion;i>e.baseVersion;i--){var o=e.getTransact(i);o&&n.push(o)}for(var a=n.length-1;a>=0;a--)for(var r=n[a],s=0;s<r.operates.length;s++){var l=r.operates[s];t.push(l)}return t}},{key:"transRange",value:function(e,t){for(var n=[e],i=this.getLocalVersionOps(),o=0;o<i.length;o++)for(var a=i[o].data,r=0;r<a.length;r++){var s=a[r];switch(s.name){case"doInsertText":this.updateRanges(s.param.pos,s.param.strlen,!t,n);break;case"doDeleteText":this.updateRanges(s.param.pos,s.param.len,!!t,n)}}return n[0]}},{key:"updateShapeCache",value:function(e){var t=this;e.shapePics&&e.shapePics.forEach((function(e){t.data.shapeManager.addDelayRenderShapeId(e.shapeId)}))}},{key:"afterApplyServerVersions",value:function(){this.data.doc.comments._updateRcId(),this.data.doc.comments.idCacheMgr.clear(),this.data.doc.commentBubbles.idMgr.clear()}},{key:"afterReapplyLocalCmd",value:function(e,t){this.changeSelectionByLocalCommand(e,t),this.data.doc.comments.idCacheMgr.clearLocalId(),this.data.doc.commentBubbles.idMgr.clearLocalId()}},{key:"updateDocInfo",value:function(e){if(e.docInfo&&e.docInitInfo){for(var t in e.docInitInfo)e.docInfo[t]=e.docInitInfo[t];delete e.docInitInfo}Object(pe.hasQuery)("usecore")&&(e.docInfo.useCoreTypo=!0)}},{key:"onOpen",value:(n=u()(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isFileOpened=!1,J.default.dispatchEvent(z.default.document.ON_DOC_BEFORE_OPEN),t.wordStat=this.getWordStat(t),window.tester.record(window.tester.actions.init_core_start),n=window.g_rpt.applyServerInitData(t),this.updateDocInfo(t),e.next=8,this.init({naked_doc:n,typoInfo:t.typoInfo,textStream:t.textStream,concernRanges:t.concernRanges,wordStat:t.wordStat,docInfo:t.docInfo});case 8:this.data.doc.secDocInfo=t.secDocInfo,this.checkPreviewLimit(t),window.tester.record(window.tester.actions.render_end),this.isFirstScreenRendered=!0,setTimeout((function(){J.default.dispatchEvent(z.default.document.ON_DOC_AFTER_INIT)}));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"afterOpen",value:(t=u()(regeneratorRuntime.mark((function e(t){var n,i,o,a,r,s,l,u,c,h,d,p,f,g,v=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.addEventListener(J.default.names.ON_BEFORE_UNLOAD,this.handleUnload),window.__WPSENV__.reduxDispatch(Object(Y.fileRenderDone)()),this.initializedBookmarkInfo=this.getBookmarkInfo(),e.next=5,this.viewUIL.afterOpen();case 5:if(!this.isPreview){e.next=8;break}return Object(Le.jumpPosition)(),e.abrupt("return");case 8:window.__CONFIG__.wps.isEnterRevisionMode&&!window.APP.data.doc.textStream.getRevisionTextStream().isTrackingChanges&&(null!=this.api._permissions?this.editor.cmdExecutor.sendCommandBlock({name:"setTrackRevisions",param:{on:!0}}):window.addEventListener(J.default.names.file.SET_FILE_PERMISSIONS,(function(){v.editor.cmdExecutor.sendCommandBlock({name:"setTrackRevisions",param:{on:!0}})}))),this.initOver(t.docInfo),this.loadJieBa(),this.workspace.restoreGcp(),J.default.dispatchEvent(J.default.names.edit.COPY_PASTE_SUCCESS),this.workspace.onAfterFirstRender(),this.viewUIL.typoUpdate(),J.default.dispatchEvent(z.default.document.ON_DOC_AFTER_OPEN),this.isFileOpened=!0,this.formatContentController.showAllBorderOfContentControls(),this.collection.shape.initialShapeRenderCollection(),Object(Le.jumpPosition)(),this.customRenderManager.afterOpen(),n=this.scheduler,i=n.PRIORITY,o=n.taskName,a=i.LowPriority,r=o.status_clearExpireItems,s=o.storage_clearExpireItems,this.scheduler.scheduleCallback(a,{callback:Pe.clearExpireItems,name:r}),this.scheduler.scheduleCallback(a,{callback:Se.clearExpireItems,name:s}),this.scheduler.unlock(),this.checkIsOldCommentBookmark(),qe&&this.openApi&&this.openApi.eventRefire.onDocumentReopen(),qe=!0,(l=Object(Ke.getQueryIndexInfo)())&&l.cursor&&(u=l.cursor,c=u.startGcp,h=u.endGcp,d=function(){window.APP.data.selection.setPosition(c,h,{isSend:!0}),window.APP.data.selection.begin.position===c&&window.APP.workspace.makesureCursorVisible(!0)},p=Math.max(c,h),f=Object(Ze.typoToPositionWithLoading)(p),g=function e(t){t.detail.isClick&&(f.cancel(),window.removeEventListener(z.default.names.DOC_SELECTION_CHANGED,e))},f.then((function(){d(),window.removeEventListener(z.default.names.DOC_SELECTION_CHANGED,g)})),window.addEventListener(z.default.names.DOC_SELECTION_CHANGED,g));case 32:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onSessionReady",value:function(){this.data.shapeManager&&this.data.shapeManager.setSessionReady()}},{key:"beforeSendCommandBlock",value:function(){this.editor&&this.editor.closeLastTransact()}},{key:"initData",value:function(e,t){}},{key:"initComment",value:function(){}},{key:"initTemplate",value:function(){}},{key:"onPermissionChange",value:function(e,t){this.isFilePermissionConfirmed=!0,this.viewUIL&&"function"==typeof this.viewUIL.onPermissionChange&&this.viewUIL.onPermissionChange(e,t)}},{key:"isSecurityDoc",value:function(){return this.api._permissions&&1===this.api._permissions.doctype}},{key:"canEdit",value:function(){return this.api._permissions&&!0===this.api._permissions.edit}},{key:"canCopy",value:function(){return this.api._permissions&&!0===this.api._permissions.copy}},{key:"canPrint",value:function(){return this.api._permissions&&!0===this.api._permissions.print}},{key:"canDownload",value:function(){var e=window.fileInfo.user_acl.download;return this.api._permissions?!!this.api._permissions.download&&e:e}},{key:"canSaveAs",value:function(){return this.api._permissions&&!0===this.api._permissions.saveAs}},{key:"canScreenShot",value:function(){return this.api._permissions&&this.api._permissions.screen_shot}},{key:"isAuth",value:function(){return this.api._permissions&&this.api._permissions.auth}},{key:"canOffline",value:function(){return this.api._permissions&&this.api._permissions.offline}},{key:"isPrivilege",value:function(){return this.api._permissions&&this.api._permissions.full}},{key:"getSecurityDocPermission",value:function(){return this.api._securityDocPermission}},{key:"copyControl",value:function(){return this.api._permissions&&this.api._permissions.copyControl}},{key:"coreDataInvalid",value:function(){var e=!(this.data&&this.data.selection);return e&&console.warn("数据加载未完成，请稍后再试"),e}},{key:"isPCMode",value:function(){return this.typoMode===q.TYPO_MODE.MODE_PC}},{key:"isWebMode",value:function(){return this.typoMode===q.TYPO_MODE.MODE_WEB}},{key:"isMobileMode",value:function(){return this.typoMode===q.TYPO_MODE.MODE_MOBILE}},{key:"isAdaptMode",value:function(){return this.isWebMode()&&window.__CONFIG__.wps.isAdaptWebView}},{key:"isPaginationMode",value:function(){return this.typoMode===q.TYPO_MODE.MODE_PAGINATION}},{key:"isEnableComposition",value:function(){return!1}},{key:"isCommentDisabledInRestrictEditMode",value:function(){var e=this.restrictEditHandler||{},t=e.isRestrictProtectOn,n=e.restrictType;return e.isInReadonlyProtectMode?this.data.selection.selInfo.info.isSelectionRangeNonEditable:t&&![X.txDocProtComment,X.txDocProtRevisions].includes(n)}},{key:"initBidi",value:function(e){var t=this;this.createBidi?this.data.glyphpool.hasInitBidi||this.data.glyphpool.initBidiLoader():this.initCreateBidi?this.bidiTodoRanges.todo(e):(this.bidiTodoRanges=new ve(this.data.doc),this.bidiTodoRanges.todo(e),this.initCreateBidi=!0,te()((function(e){e.initBidi(window.__CONFIG__.wps.cdnBidiData,(function(){t.createBidi=e.createBidi,t.data.glyphpool.initBidiLoader(),t.data.fontServer._onFontUpdate(t.bidiTodoRanges.getRangesAndDetachObserver()),delete t.bidiTodoRanges}))})))}},{key:"initMathsCache",value:function(e){var t=this;this.data.typoinfo.mathCache||(this.initCreateMathsCache?this.mathsTodoRanges.todo(e):(this.mathsTodoRanges=new ve(this.data.doc),this.mathsTodoRanges.todo(e),this.initCreateMathsCache=!0,be()((function(e){t.data.typoinfo.mathCache=e.createMathsCache(t.data.typoinfo),t.data.fontServer._onFontUpdate(t.mathsTodoRanges.getRangesAndDetachObserver()),delete t.mathsTodoRanges,delete t.initCreateMathsCache}))))}},{key:"loadJieBa",value:function(){window.Jieba||$.load()}},{key:"initThaiDict",value:function(){var e=this;this.thaiDict||this._initThaiDict||(this._initThaiDict=!0,Ce()((function(t){e.thaiDict=t.createThaiDict(),delete e._initThaiDict})))}},{key:"initDrawing",value:function(e,t){var n=this;if(!this.drawingTools){if(this.initDrawingTools)return this.drawingRanges.todo(e),void(t&&this.shapesForStartFetchingImg.push(t));this.drawingRanges=new ve(this.data.doc),this.drawingRanges.todo(e),this.initDrawingTools=!0,this.shapesForStartFetchingImg=[],t&&this.shapesForStartFetchingImg.push(t);var i=this.data.doc.useCoreTypo&&(this.isPaginationMode()||this.isPCMode());Ge()((function(e){n.drawingTools=e,n.data.fontServer._onFontUpdate(n.drawingRanges.getRangesAndDetachObserver()),delete n.initDrawingTools,n.shapesForStartFetchingImg.forEach((function(e){e.startFetchingImg(),i&&e.afterInitDrawingTool&&e.afterInitDrawingTool()})),delete n.shapesForStartFetchingImg}))}}},{key:"updateStateByDocInfo",value:function(e){var t=e.queryResult,n=e.execResult,i=e.docInfo;if(i){if(void 0!==i.protectOn&&void 0!==i.protectType){var o=function(e){return"protectDoc"===e.name||"unprotectDoc"===e.name||"protectState"===e.name};if(!(t&&t.some(o)||n&&n.some(o))){var a=i.protectOn,r=i.protectType;this.restrictEditHandler.setRestrictState(a,r)}}if(void 0!==i.trackRevisions){var s=function(e){return"setTrackRevisions"===e.name||"trackRevisionsState"===e.name};if(!(t&&t.some(s)||n&&n.some(s))){var l=this.data.doc.textStream.getRevisionTextStream(),u=i.trackRevisions;l.setTrackRevisions(u)}}}}},{key:"checkPreviewLimit",value:function(e){if("docPreviewLimit"in e){var t=this.data.doc.concernRanges[1].pos-1;e.docPreviewLimit.endPos<t&&(this.data.doc.previewPages=e.docPreviewLimit.pageCount,this.data.doc.previewPos=e.docPreviewLimit.endPos)}}},{key:"onCmdError",value:function(e){this.data.doc.previewPages>0&&!this.hasShowPreviewError&&-14===e.error?(this.hasShowPreviewError=!0,console.error("over preview pages")):-14!==e.error&&(console.error("server error!",e),-201===e.error&&this.workspace.showToast("error",_i18n("applications.writer.components.core.event.uil.view.argsCheckError", "The kernel parameter verification failed, please contact the kernel students to complete the parameters")))}},{key:"isEnableEmphasisMeasurer",value:function(){return!1}},{key:"notifyTrackChange",value:function(e,t){J.default.dispatchEvent(z.default.revision.REVISION_TRACK_CHANGE,{isTrackingChanges:e,initiatorUserID:t})}},{key:"getCoreErrorContext",value:function(){try{return{cooperCount:this.data.selection.selCoop.onLineCooperators.size,isSessionSlow:this.api.currentSessionLatency>500,isCoreTypo:this.data.doc.useCoreTypo,subDocType:this.data.selection.selContext.subdocType,isInTable:this.data.selection.selInfo.info.inTable}}catch(e){return{}}}},{key:"mockCoreError",value:function(e){this.mockCoreErrorType=e}},{key:"handleMockError",value:function(e){throw new Error(e)}},{key:"_mockResponseError",value:function(){"response"===this.mockCoreErrorType&&this.handleMockError("mock response error")}},{key:"isAllowCmd",value:function(e,t){if(!this.isAclComment)return!1;switch(e){case"insertComment":case"insertNewComment":case"modifyNewComment":case"resetComment":return!0;case"deleteComment":case"deleteComments":case"modifyComments":return!0;case"insertTextForSel":case"insertText":case"deleteText":case"deleteTextForSel":case"insertTextForPCComposing":case"closeComposingTransact":case"insertParagraph":case"insertNHyperlink":if(t&&t.commentId)return!0}return!1}},{key:"checkIsOldCommentBookmark",value:function(){var e=this.data.doc.getSubDocRange(fe.Comment),t=e.pos,n=e.len,i=[],o=this.data.doc.bookmarks.collectBookMarks(t,n);o&&o.length&&o.forEach((function(e){var t=e.getData().getName();(t.startsWith("_T")||t.startsWith("_V"))&&0==t.lastIndexOf("_")&&i.push(Object(Me.decodeBkName)(t).comment_id)})),i.length&&this.editor.getCommentUserInfo({commentIds:i})}},{key:"clearNewObjForGroupShape",value:function(e){e.versions&&e.versions.forEach((function(e){if(["groupShapes","ungroupShape","deleteShapes"].includes(e.command.name))for(var t=e.newObjs,n=0;n<t.length;){var i=t[n].id;window.g_rpt.getServerObjectByID(i)?t.splice(n,1):++n}}))}},{key:"isFieldLink",value:function(e){var t=this.data.doc.fields.getField(e);if(t&&"HYPERLINK"===t.type){var n=this.data.doc.getText(t.pos,t.len);if(/kw:(filelink)\S+/.test(n))return!0}return!1}},{key:"isCmdExecutingByCurrentUser",get:function(){return this.isExecutingCmd&&!!this.cmdUserId}},{key:"userAclUpdate",set:function(e){this._userAclUpdate=e},get:function(){return this._userAclUpdate}},{key:"isAclRead",get:function(){return"read"===this.api._acl}},{key:"isAclComment",get:function(){if(!window.__WPSENV__.store.getState().public.user.isLogin)return!1;if(this.isReadOnly()&&!this.supportReadOnlyComment())return!1;try{var e=window.__WPSENV__.file_info.file.user_acl,t=this.api._permissions;return(e.update||e.comment)&&(t.edit||t.comment)}catch(e){return!this.isReadOnly()}}},{key:"isPermanentOffline",get:function(){return this.api.isRPCOffline()}},{key:"coreComponentsGetterPromise",get:function(){return this._coreComponentsGetterPromise||(this._coreComponentsGetterPromise=Promise.all([this.updaterComponentGetterPromise,this.renderComponentGetterPromise])),this._coreComponentsGetterPromise},set:function(e){this._coreComponentsGetterPromise=e}},{key:"workspace",get:function(){return this.view.workspace}},{key:"updater",get:function(){return this.view.updater}},{key:"editor",get:function(){return this.view.uilManager&&this.view.uilManager.editHandler}},{key:"uilManager",get:function(){return this.view.uilManager}},{key:"events",get:function(){return this.view.events}},{key:"formatContentController",get:function(){return this.view.formatContentController}},{key:"restrictEditHandler",get:function(){return this.view.restrictEditHandler}},{key:"appApi",get:function(){return this.view.appApi}},{key:"openApi",get:function(){return this.view.openApi}},{key:"services",get:function(){return this.view.services}},{key:"userTagId",get:function(){var e=this;if(void 0===this._userTagId){var t=_e.a.coopInfos.find((function(t){return t.userid===e.info.userid}));this._userTagId=t?t.tagid:void 0}return this._userTagId}},{key:"isCommentEnabled",get:function(){var e=window.__CONFIG__.wps,t=e.disableRevisionComment;return!e.disableComment&&!t},set:function(e){window.__CONFIG__.wps.disableComment=!e,z.default.dispatchEvent(z.default.comments.COMMENT_ENABLED_STATUS_CHANGE,{enable:e}),this.appApi.showComments({checked:e});var t=this.data.selection;t.setPosition(t.begin,t.end)}},{key:"readOnlyError",get:function(){return"The file is read-only and can't be modified!"}}]),e}();t.a=Qe},10025:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(2009),d=n(676),p=function(){function e(t,n){o()(this,e),this.app=t,this.dom_container=n,this.handle=this.handle.bind(this)}return r()(e,[{key:"handle",value:function(e){var t=e.type,n=e.detail,i=n.affair,o=n.params;return i?this[i](o):this[t](e)}},{key:"getUilContainer",value:function(){return this.uilContainer||(this.uilContainer=Object(d.createElement)({type:"div",classname:"doc-uil-dom-wrapper",parent:this.dom_container})),this.uilContainer}}]),e}(),f=n(1477),g=function(e){function t(e,n){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return c()(t,e),r()(t,[{key:"listen",value:function(){window.addEventListener(h.a.HEADER_FOOTER.SHOW_HIT_TIP,this.handle),window.addEventListener("keyup",this.handle)}},{key:"shouldRenderTip",value:function(e){if(!this._params)return!0;var t=window.APP.uilManager;if(t){if(t.isInOperation())return!1;if(!t.uiHandler.state.isAllowUpdateHeaderFooterTip)return!1}return this._params.isShow!==e.isShow||(this._params.isHeader!==e.isHeader||!(!(e.isShow&&this._params.pos&&e.pos)||this._params.pos.x===e.pos.y&&this._params.pos.y===e.pos.y))}},{key:"removeListen",value:function(){window.removeEventListener(h.a.HEADER_FOOTER.SHOW_HIT_TIP,this.handle),window.removeEventListener("keyup",this.handle)}},{key:"showHitTip",value:function(e){this.uilContainer=this.getUilContainer(),this.shouldRenderTip(e)&&this.app.frontUtil.ReactDom.render(this.app.frontUtil.HeaderFooterHitTip(e),this.uilContainer),this._params=e}},{key:"keyup",value:function(e){switch(e.keyCode){case f.a.ESC:this.app&&this.app.data&&this.app.data.selection.selContext.isInHeaderFooter&&this.app.editor.leaveCurrentHeaderFooter()}}}],[{key:"registeAndListen",value:function(e,n){var i=new t(e,n);return i.listen(),i}}]),t}(p),v=function(e){function t(e,n){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return c()(t,e),r()(t,[{key:"listen",value:function(){window.addEventListener(h.a.HIGHLIGHT.BLINK,this.handle)}},{key:"removeListen",value:function(){window.removeEventListener(h.a.HIGHLIGHT.BLINK,this.handle)}},{key:"showBlink",value:function(e,t){e&&0!==e.length?(this.app.data.setGlobalBlink(e),window.APP.forceCompose=!0,this.app.workspace.refreshDryly(!0),t&&t()):console.error("[UIL] Try to apply high light blink, but no range got")}},{key:"hideBlink",value:function(e){this.app.data.resetGlobalBlink(),this.app.workspace.refreshDryly(!0,(function(){requestAnimationFrame((function(){window.APP.forceCompose=!1,e&&e()}))}))}},{key:"blink",value:function(e){var t=this,n=e.ranges,i=e.time,o=e.show_cb,a=e.hide_cb;this.showBlink(n,o),setTimeout((function(){t.hideBlink(a)}),i||100)}}],[{key:"registeAndListen",value:function(e,n){var i=new t(e,n);return i.listen(),i}}]),t}(p),m=function(){function e(t){o()(this,e),this._app=t,this._dom_container=null,this._isReady=!1,this._needShowAll=!0,this.isTemplate=this._app.data.doc.isTemplate,this._isMoving=!1}return r()(e,[{key:"onContentControlsInitFinish",value:function(){this._dom_container=this._app.workspace.container,this._isReady=!0,this.canShowContentControl}},{key:"getRenderUilHeight",value:function(e,t){var n=this._app.formatContentController.getTextControlFirstLine(t).papx.getPropVal("bidi");return this._app.isPCMode()?n?e[2].y-e[1].y:e[e.length-2].y-e[0].y:n?e[1].y-e[0].y:e[e.length-2].y-e[0].y}},{key:"canShowContentControl",get:function(){return!this.isTemplate&&!this._app.isReadOnly&&this._app.isEditMode}},{key:"showAll",get:function(){return this._needShowAll},set:function(e){this._needShowAll=e}},{key:"isMoving",get:function(){return this._isMoving},set:function(e){this._isMoving=e}}]),e}(),_=function(){function e(t,n){o()(this,e),this.registerUilEventsAndHandler(t,n)}return r()(e,[{key:"registerUilEventsAndHandler",value:function(e,t){this.highlight=v.registeAndListen(e,t),e.isPCMode()&&(this.headerfooter=g.registeAndListen(e,t)),this.formatContentManager=new m(e)}},{key:"clearAll",value:function(){this.highlight&&this.highlight.removeListen(),this.headerfooter&&this.headerfooter.removeListen()}}]),e}();t.a=_},10033:function(e,t,n){"use strict";var i=n(13),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(260),c=n(1809),h=0,d=1,p=2,f=3,g=4,v=0,m=40,_=80,y=0,b=20,T=40,C=function(){function e(t){r()(this,e),this.lastMoveEvent=null,this.container=t,this.scroller=new c.default(t,{easing:"linear"}),this._direction=h,this.onResize(),this.throttleScrollBy=window.utils.Lodash.throttle(this.scrollBy.bind(this),300)}return l()(e,[{key:"onResize",value:function(){this.container.cacheDOMAttr?(this._rect=this.container.cacheDOMAttr.rect,this._offsetHeight=this.container.cacheDOMAttr.offsetHeight,this._offsetWidth=this.container.cacheDOMAttr.offsetWidth):(this._rect=this.container.getBoundingClientRect(),this._offsetHeight=this.container.offsetHeight,this._offsetWidth=this.container.offsetWidth)}},{key:"scrollBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,n=this.container.scrollTop,i=this.container.scrollLeft;e===f||e===g?this.scroller.toX(i+t):e!==d&&e!==p||this.scroller.toY(n+t)}},{key:"_setupScrollTimeout",value:function(e,t){var n=this;this._scrollKeeper&&clearTimeout(this._scrollKeeper),this._scrollKeeper=setTimeout((function(){n.throttleScrollBy(e,t),n._setupScrollTimeout(e,t)}),300)}},{key:"_resetScrollTimeout",value:function(){this._scrollKeeper&&(clearTimeout(this._scrollKeeper),this._scrollKeeper=null),this._direction=h}},{key:"_getStepByDistance",value:function(e){var t=v;return e<y?t=v:e<T?t=_:e<b&&(t=m),t}},{key:"_getScrollDirection",value:function(e,t){var n=t-this._rect.top,i=this._getStepByDistance(n);if(i!==v)return{step:i,direction:d};var o=this._offsetHeight-n;if((i=this._getStepByDistance(o))!==v)return{step:i,direction:p};var a=e-this._rect.left;if((i=this._getStepByDistance(a))!==v)return{step:i,direction:f};var r=this._offsetWidth-a;return(i=this._getStepByDistance(r))!==v?{step:i,direction:g}:{step:v,direction:h}}},{key:"scrollIfNeeded",value:function(e,t){this._direction!==e&&this._resetScrollTimeout(),t!==v&&(this._direction=e,this.throttleScrollBy(e,t),this._setupScrollTimeout(e,t))}},{key:"updateIfNeeded",value:function(e){var t=e.touches?e.touches[0]:e,n="hidden"===getComputedStyle(this.container).overflowX,i=this._getScrollDirection(t.clientX,t.clientY),o=i.direction,a=i.step,r=!isNaN(e.movementY);switch("mousemove"===e.type&&r&&((0===e.movementY||e.movementY>0&&o===d||e.movementY<0&&o===p)&&(o=h),(0===e.movementX||e.movementX>0&&o===f||e.movementX<0&&o===g)&&(o=h)),o){case d:this.scrollIfNeeded(o,-1*a);break;case f:n||this.scrollIfNeeded(o,-1*a);break;case p:this.scrollIfNeeded(o,a);break;case g:n||this.scrollIfNeeded(o,a);break;case h:default:this._resetScrollTimeout()}}},{key:"toX",value:function(t,n){var i=Date.now();this.scroller.toX(t,n).then((function(){e.scrollInfo.durationKey===i&&(e.scrollInfo.isDuration=!1)})),e.scrollInfo={passive:!0,isDuration:!0,durationKey:i}}},{key:"toY",value:function(t,n){var i=Date.now();this.scroller.toY(t,n).then((function(){e.scrollInfo.durationKey===i&&(e.scrollInfo.isDuration=!1)})),e.scrollInfo={passive:!0,isDuration:!0,durationKey:i}}},{key:"startPassiveScroll",value:function(){e.scrollInfo.isDuration||(e.scrollInfo={passive:!0})}},{key:"handleScroll",value:function(){e.scrollInfo.isDuration||(e.scrollInfo.passive=!1)}},{key:"deperacted_isPassiveScroll",value:function(){return e.scrollInfo.passive}},{key:"clear",value:function(){this._resetScrollTimeout()}}]),e}();C.scrollInfo={passive:!1,isDuration:!1};var k=C,w=n(1583),S=n(400),P=n(676),I=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n||t,this.data=i,this._element=Object(P.createElement)({type:"div",style:"position: absolute; top: 0; left: 0; overflow: visible; width: 100%;",id:"template-shape-change-button",parent:this.container})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.DOCShapeChangeBtn(e),this._element)}}]),e}(),E=n(1285),O=n(7768),x=n(309),R=n(984),N=n(3488),A=n.n(N),D=function(){function e(t,n){r()(this,e),this.selectionSvgs=[],this.app=t,this.componentRefs=[],this.initDataConfig(n),this.initWorkspace(),this.initCanvasContainer(),this.initCanvasHandler(),this.initUilDom(),this.initBookmark(),this.initCacheDOMAttr(),this.initScrollerHelper(),this.isApplyServerVersions=!1,this.uilOperation=!1}return l()(e,[{key:"isUpdateDisabledBecauseOfThis",value:function(e){}},{key:"getCurrentRect",value:function(){var e=this.element.cacheDOMAttr.scrollTop,t=this.element.cacheDOMAttr.rect,n=S.a.initByRawRect({left:0,right:t.width,top:e,bottom:e+t.height});return n.offsetTop=t.top,n}},{key:"getCurrentTypoRect",value:function(){var e=this.getCurrentRect(),t=this.config.zoom;return e.top=e.top/t,e.bottom=e.bottom/t,e.offsetTop=e.offsetTop/t,e}},{key:"getCursorTop",value:function(e){var t=this.data.selection.getRangedSelection(),n=t.begin,i=t.end;return e?n.pos.posY:i.pos.posY}},{key:"initDataConfig",value:function(e){this.data=e,this.data.typoinfo.attachObserver(this),this.data.selection.attachObserver(this),this.data.doc.attachObserver(this),this.config=w.a.getInstance()}},{key:"afterOpen",value:function(){this.initIndicator(),this.initCoopSels(),this.initPageNumTip(),this.initDateTimeFloatMenus(),this.initCatalogFloatMenus(),this.initTableFloatMenus(),this.initContentBlockFloatMenus(),this.initSelectivePasteFloatMenu(),this.initDrawingResizer(),this.initDrawingPreviewer(),this.initDrawingAdjustHandler(),this.initCursorTypeConfig(),this.initShapeChangeBtn(),this.initFormatContentProperty()}},{key:"initWorkspace",value:function(){}},{key:"initCanvasContainer",value:function(){this.horizontalCenterOffset=0}},{key:"initCanvasHandler",value:function(){var e=this,t=this.app.viewUIL.loader,n=t.moduleTypes,i=t.getViewModule(n.renderer),o=i.promise,a=i.result,r=function(t){console.info("--- [view] - renderer");var n=t.defaultManager();if(e.canvasHandler=new n(e,e.data),e.useCommentRender){var i=t.commentManager();e.commentRenderHandler=new i(e.data)}[e.input,e.waterdrop].forEach((function(t){t&&t.init(e.canvasHandler)}))};a?r(a):o.then((function(e){return r(e)}))}},{key:"initIndicator",value:function(){}},{key:"initRevisionComment",value:function(){}},{key:"initTutorialText",value:function(){}},{key:"initCoopSels",value:function(){}},{key:"initPageNumTip",value:function(){}},{key:"initShapeChangeBtn",value:function(){!this.changeShapeBtn&&this.data.doc.isPalaceMuseumTemplate&&(this.changeShapeBtn=new I(this.element,this.domScaleContainer,this.data),this.componentRefs.push(this.changeShapeBtn))}},{key:"initFormatContentProperty",value:function(){}},{key:"initScrollerHelper",value:function(){this.scrollerHelper||(this.scrollerHelper=new k(this._workspace))}},{key:"initUilDom",value:function(){}},{key:"initCursorTypeConfig",value:function(){}},{key:"initBookmark",value:function(){}},{key:"resize",value:function(e){}},{key:"_refresh",value:function(e){var t=e.isForce,n=e.dry_callback;this.updateDisabled||(this.canvasHandler&&this.canvasHandler.refreshCanvas(null,t)&&this.updateContainer(),n&&n())}},{key:"asyncRefresh",value:function(){var e=this;setTimeout((function(){e.refreshDryly(!1)}))}},{key:"refreshDryly",value:function(e){}},{key:"refreshContinently",value:function(e){var t=this;this._throttleRefresh||(this._throttleRefresh=window.utils.Lodash.throttle((function(){t._refresh({dry_callback:e})}),16)),this._throttleRefresh(!1)}},{key:"refreshImmediately",value:function(e){this._refresh({isForce:!1,dry_callback:e})}},{key:"refreshForcedly",value:function(){this._refresh({isForce:!0})}},{key:"throttleForceRefresh",value:function(){var e=this;this._throttleForceRefresh||(this._throttleForceRefresh=A()((function(){e._refresh({isForce:!0})}),100)),this._throttleForceRefresh()}},{key:"updateContainer",value:function(){}},{key:"shouldUpdateContainer",value:function(e){var t=JSON.stringify(e);return(!this._lastStyleStr||this._lastStyleStr!==t)&&(this._lastStyleStr=t,!0)}},{key:"scaleDomContainer",value:function(){}},{key:"initDateTimeFloatMenus",value:function(){}},{key:"initCatalogFloatMenus",value:function(){}},{key:"initTableFloatMenus",value:function(){}},{key:"initContentBlockFloatMenus",value:function(){}},{key:"initSelectivePasteFloatMenu",value:function(){}},{key:"initDrawingResizer",value:function(){}},{key:"initDrawingPreviewer",value:function(){}},{key:"initDrawingAdjustHandler",value:function(){}},{key:"focusWithoutScroll",value:function(){var e=this.element.scrollLeft,t=this.element.scrollTop;this.input.focus(),this.element.scrollLeft=e,this.element.scrollTop=t}},{key:"checkIsSelOutTexttFormField",value:function(){var e=this.data.fieldManager;if(e&&this.data.selection){var t=e.getField(this.data.selection.begin.position);if(null==t&&(t=e.getField(this.data.selection.begin.position-1)),t&&"FORMTEXT"===t.getType())return!1}return!0}},{key:"_checkShouldHideIndicator",value:function(){var e=window.APP.formatContentController;if(!e)return!1;var t=e.isRestrictEditMode,n=!e.checkIsInContentControl();return t&&n&&this.checkIsSelOutTexttFormField()}},{key:"switchIndicatorVisibility",value:function(e){var t=this,n=e;n&&this._checkShouldHideIndicator()&&(n=!1),this.cursorUpdateFrame=requestAnimationFrame((function(){t.waterdrop&&t.waterdrop.switchCursorVisibility(n)}))}},{key:"switchIndicatorState",value:function(e){var t=this;this._checkShouldHideIndicator()?this.switchIndicatorVisibility(!1):(this.switchIndicatorVisibility(!0),this.indicatorUpdateFrame=requestAnimationFrame((function(){t.waterdrop&&t.waterdrop.switchIndicatorState(e)})))}},{key:"updateIndicator",value:function(){}},{key:"clearAll",value:function(e){this.unMount=!0,this.sizeUnobservers&&(this.sizeUnobservers.forEach((function(e){e()})),this.sizeUnobservers=null),this.disableUpdate(),window.cancelAnimationFrame(this.cursorUpdateFrame),window.cancelAnimationFrame(this.indicatorUpdateFrame);var t=this.data,n=t.typoinfo,i=t.selection;t.doc.detachObserver(this),n.detachObserver(this),i.detachObserver(this),this.componentRefs.forEach((function(e){e&&e.clearAll&&e.clearAll()})),this.element.removeEventListener("scroll",this._handleWorkspaceElementScroll)}},{key:"isTypoFinished",value:function(e){return!!this.data.typoinfo.textLineRanges.findNodeContainPos(e)}},{key:"makeContentVisible",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!1,o=new Promise((function(o,a){var r=t.data.doc.getSubDocType(e);if((t.app.isWebMode()||t.app.isMobileMode())&&r!==x.MainText&&r!==x.Comment)a(!1);else{var s=void 0,l=e;if(r===x.Comment){if(!(s=t.data.doc.commentBodys.getCommentByPos(l)))return void a(!1);l=s.pos}var u=n.isTimeLimited,c=void 0===u||u,h=n.timeLimit,d=void 0===h?250:h,p=n.diffX,f=void 0===p?0:p,g=n.diffY,v=void 0===g?0:g,m=n.horizontal,_=void 0===m||m,y=n.adjustWhenInvisible,b=t.app.view.updater,T=(t.app.isPCMode()||t.app.isPaginationMode())&&t.data.doc.useCoreTypo,C=Date.now(),k=t.isTypoFinished(l);!function n(){t.locateTimeoutID=setTimeout((function(){if(i)o(!1);else{if(!k){if(T)E.b.locate(t.data,l,!1,t.data.typoinfo);else{var r=t.app.data.typoinfo.pageCount+1;b.updateToPage?b.updateToPage(r):b.updatePages({from:r,to:r})}if(!(k=t.isTypoFinished(l)))return void(c&&Date.now()-C>d?a(!1):n())}var u=E.b.locate(t.data,l,!1,t.data.typoinfo)||{},h=u.line,p=u.posX,g=u.posY,m=t.data.typoinfo.verticalPadding,w=void 0===m?0:m,S=t.config.zoom,P=t.element.cacheDOMAttr.scrollLeft,I=g*S,O=p*S,x=0;void 0!==g&&0!==h.range.pos&&(x=g!==w?g*S-v:0);var R=P;void 0!==p&&S>1&&0===t.horizontalCenterOffset&&(R=p*S-f);var N=!0,A=!0;if(y){var D=t.app.appApi,M=D.isKeyboardActive,L=D.keyboardHeight,F=t.element.cacheDOMAttr,B=F.clientHeight,H=F.clientWidth,G=F.scrollTop,W=F.scrollLeft;N=O<W||O>W+H,A=I<G||I>G+B-(M?L:0)}if(!T){var j=t.getCurrentRect();j.top+=g,j.bottom+=g,t.data.typoinfo.updater.updateViewport(j)}t.updateContainer(!1),requestAnimationFrame((function(){_&&N&&t.scrollTo({scrollLeft:R}),A&&t.scrollTo({scrollTop:x}),o({gcp:e,realGCP:l,context:{comment:s}})}))}}),50)}()}})),a=function(){i=!0};return{promise:o,cancel:a}}},{key:"makesureCursorVisible",value:function(){}},{key:"getPictureControl",value:function(){return null}},{key:"getTextControl",value:function(){return null}},{key:"saveSelection",value:function(){this.app.isFirstScreenRendered&&(this.input||this.initIndicator(),this.input.save(this.data.selection.begin))}},{key:"restoreSelection",value:function(){this.app.isFirstScreenRendered&&this.input.restore(this.data.selection.begin)}},{key:"disableUpdate",value:function(e,t){e&&(this.isApplyServerVersions=!0),t&&(this.uilOperation=!0),this.updateDisabled=!0}},{key:"enableUpdate",value:function(e,t){e&&(this.isApplyServerVersions=!1),t&&(this.uilOperation=!1),this.updateDisabled=!1}},{key:"isElementAcceptable",value:function(e){return this.waterdrop.isWaterDrop(e)}},{key:"getScaleValue",value:function(){return this.config.zoom}},{key:"scale",value:function(){}},{key:"scrollResize",value:function(){}},{key:"getPageCurrent",value:function(){}},{key:"getVisiblePages",value:function(){for(var e,t,n=this.data.typoinfo,i=this.app.isWebMode(),o=this.getCurrentRect(),a=this.getScaleValue(),r=[],s=0;s<n.pageCount;s++)(e=n.layout_pages[s])&&((t=i?e.rect:e.outer_rect).bottom*a<=o.top||t.top*a>=o.bottom||r.push(e));return r}},{key:"getPageFitValue",value:function(){}},{key:"getZoomDiff",value:function(){if(this.config.zoom>1||this.app.isWebMode()||this.app.isMobileMode()||!this.data.typoinfo.outer_rects.length)return this.horizontalCenterOffset;var e=this.container.cacheDOMAttr.clientWidth,t=this.data.typoinfo.outer_rects[0],n=t.left,i=t.top,o=t.width,a=t.height,r=S.a.initByOriginAndSize({x:n,y:i},{width:o,height:a}).vpsc_rect;return(e-r.width)/2-r.origin.x+this.horizontalCenterOffset}},{key:"scrollWorkspace",value:function(e){var t=this.scrollTop;this.scrollerHelper.toY(t+e)}},{key:"onScroll",value:function(){}},{key:"onViewportChanged",value:function(){}},{key:"onContainerChanged",value:function(e){this.updateContainer(!1)}},{key:"onSelectionChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.app.data.selection.getNormalRange();if(e){var i=window.__CONFIG__.wps,o=i.disableRevisionComment,a=i.useLowPerformanceMode;o||a||this.revisionComment&&this.revisionComment.selectionChange(n,t)}t&&!0===t.isEditing&&!0===t.updateOnly&&!0===t.instant&&u.default.dispatchEvent(u.default.content.EDIT),this.updateIndicator({selection:e,updateOnly:t&&t.updateOnly,instant:t&&t.instant,shouldBlur:t&&t.shouldBlur||this.shouldBlur||this.app.isRightContextMenu,preventScroll:t&&t.preventScroll,preventFocus:t&&t.preventFocus,isComposing:t&&t.isComposing,notRenderSelectDrop:t&&t.notRenderSelectDrop,isMoving:t&&t.isMoving})}},{key:"onSectionxChanged",value:function(){u.default.dispatchEvent(u.default.names.DOC_SECTION_CHANGE)}},{key:"handleScrollIntoView",value:function(){}},{key:"scrollIntoView",value:function(){}},{key:"getFormatContentManager",value:function(){return this.uil.formatContentManager}},{key:"onFontUpdate",value:function(){}},{key:"showToast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"success",t=arguments[1],n=arguments[2],i=arguments[3];window.Toast[e]&&window.Toast[e](t,n,i)}},{key:"hideToast",value:function(){window.Toast.close()}},{key:"observeSizeChange",value:function(e,t){this.sizeUnobservers||(this.sizeUnobservers=[]),this.sizeUnobservers.push(Object(O.observeSizeChange)(e,t,window))}},{key:"initCacheDOMAttr",value:function(){var e=this;this.updateCacheSize(),this.throttleUpdateWorkspace=window.utils.Lodash.throttle(this.updateWorkspaceCacheSize.bind(this),16),this.throttleUpdateContainer=window.utils.Lodash.throttle(this.updateCacheSize.bind(this),16),this.observeSizeChange(this.element,this.throttleUpdateWorkspace),this.observeSizeChange(window.document.body,this.throttleUpdateContainer),this.observeSizeChange(this.container,this.throttleUpdateContainer),this._handleWorkspaceElementScroll=function(){e.element.cacheDOMAttr.scrollTop=e.element.scrollTop,e.element.cacheDOMAttr.scrollLeft=e.element.scrollLeft},this.element.addEventListener("scroll",this._handleWorkspaceElementScroll)}},{key:"updateWorkspaceCacheSize",value:function(){}},{key:"updateCacheSize",value:function(){document.body.cacheDOMAttr={clientWidth:document.body.clientWidth,clientHeight:document.body.clientHeight,scrollTop:document.body.scrollTop,scrollLeft:document.body.scrollLeft};var e=this.container.cacheDOMAttr;this.container.cacheDOMAttr={scrollTop:this.container.scrollTop,scrollLeft:this.container.scrollLeft,clientWidth:this.container.clientWidth,clientHeight:this.container.clientHeight,offsetWidth:this.element.offsetWidth,offsetHeight:this.element.offsetHeight,rect:this.element.getBoundingClientRect()},this.updateWorkspaceCacheSize();var t=this.container.cacheDOMAttr;e&&e.clientWidth===t.clientWidth&&e.clientHeight===t.clientHeight||u.default.dispatchEvent(u.default.names.ON_PAGE_CONTAINER_SIZE_CHANGE,o()({},t))}},{key:"onAfterFirstRender",value:function(){this.canvasHandler&&this.canvasHandler.onAfterFirstRender&&this.canvasHandler.onAfterFirstRender()}},{key:"storeGcp",value:function(){try{var e=JSON.parse(R.getStatus(R.types.STORE_GCP,!0));if(!e||(Date.now()-new Date(e.timestamp))/1e3>3){var t=this.data.selection.begin,n=void 0!==t.isInFooter?{scrollTop:this.element.scrollTop}:{gcp:t.position};R.setStatus(R.types.STORE_GCP,JSON.stringify(o()({timestamp:Date.now()},n)),!0)}}catch(e){}}},{key:"allowRestoreGcp",value:function(){R.setStatus(R.types.STORE_GCP_SWITCH,!0,!0)}},{key:"restoreGcp",value:function(){try{var e=JSON.parse(R.getStatus(R.types.STORE_GCP,!0));if(e){var t=e.timestamp,n=e.scrollTop,i=e.gcp;if(!0===R.getStatus(R.types.STORE_GCP_SWITCH,!0)&&(Date.now()-new Date(t))/1e3<=300)if(i){var o=this.data.doc.getLimitedRange(this.data.selection.begin.position);o.pos+o.len-1<i&&(i=o.pos+o.len-1),this.data.selection.setPosition(i),this.makesureCursorVisible()}else n&&this.element.scrollTo({scrollTop:n})}setTimeout((function(){R.deleteStatus(R.types.STORE_GCP,!0),R.deleteStatus(R.types.STORE_GCP_SWITCH,!0)}),3e3)}catch(e){R.deleteStatus(R.types.STORE_GCP,!0),R.deleteStatus(R.types.STORE_GCP_SWITCH,!0)}}},{key:"toggleCooparationAvatarVisibleState",value:function(e){u.default.dispatchEvent(u.default.cooperation.ON_AVATAR_VISIBLE_CHANGE,{visible:e})}},{key:"scrollTo",value:function(e){var t=e.scrollTop,n=e.scrollLeft;if(void 0===t&&void 0===n)return console.error("参数错误，至少包含scrollTop、scrollLeft其中一参数",e),!1;this.scrollerHelper.startPassiveScroll(),void 0!==t&&(this.element.scrollTop=t),void 0!==n&&(this.element.scrollLeft=n)}},{key:"isEditable",value:function(e){var t=e||document.activeElement;return t&&-1!==["INPUT","TEXTAREA"].indexOf(t.tagName)}},{key:"element",get:function(){return this._workspace}},{key:"container",get:function(){return this._cvsContainer}},{key:"domScaleContainer",get:function(){return this._domScaleContainer}},{key:"wpsWrap",get:function(){return this._wpsWrap}},{key:"scrollTop",get:function(){return this.element.cacheDOMAttr.scrollTop}},{key:"scrollLeft",get:function(){return this.element.cacheDOMAttr.scrollLeft}},{key:"updateDisabled",get:function(){return this._updateDisabled},set:function(e){this._updateDisabled=e}},{key:"useCommentRender",get:function(){return!1}}]),e}();t.a=D},10039:function(e,t,n){"use strict";n.d(t,"a",(function(){return D}));var i=n(80),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(240),c=n(260),h=n(336),d=n(7216),p=n(676),f=n(167),g=n(3489),v=n(14),m=n(227),_=n(7217),y=n(3488),b=n.n(y),T=n(4972),C=n(805),k=n(4967),w=1,S=2,P=4,I=8,E=16,O=32,x=64,R=function(){function e(t){var n=this,i=t.app;r()(this,e),this.pageContainerDom=document.querySelector(".preview-page-container"),this.pageListDom=this.pageContainerDom.querySelector(".pages-list"),this.noCopyDom=document.createElement("div"),this.dpiInfo=this.getDPI(),this.scaleValue=1,this.pageList=[],this.fontList=[],this.isExportEnd=!1,this.config={zoom:1},this.adjustScaleDone=!1,this.replaceFontInSvg=function(e){var t=e.detail,i=t.originalFont,o=t.font;n.fontList.forEach((function(e,t){var a=e[i];a&&a.forEach((function(e){var i=n.pageList[t].querySelectorAll('[font-family="'+e+'"]');i&&i.length>0&&i.forEach((function(e){e.setAttribute("font-family",o)}))}))}))},this.onCopy=function(e){return n.app.canCopy()},this.onContextMenu=function(e){return n.app.canCopy()},this.setPermissions=function(e){!1===(e.detail||{}).copy||window.fileInfo.user_acl&&!1===window.fileInfo.user_acl.copy?(document.body.classList.add("no-copy"),window.addEventListener("contextmenu",u.stopBubble,{capture:!0}),f.isMobile&&n.pageListDom.appendChild(n.noCopyDom)):(document.body.classList.remove("no-copy"),window.removeEventListener("contextmenu",u.stopBubble,{capture:!0}),f.isMobile&&n.noCopyDom.remove())},this.app=i,this.onKeydown=this.onKeydown.bind(this),this.onKeyup=this.onKeyup.bind(this),this.pageContainerDom.oncopy=this.onCopy,this.pageContainerDom.oncontextmenu=this.onContextMenu,this.onScroll=b()(this.onScroll.bind(this),300),this.pageContainerDom.addEventListener("scroll",this.onScroll),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),window.addEventListener(c.default.names.DOC_FONT_WAIT_TO_REPLACE,this.replaceFontInSvg),window.removeEventListener("contextmenu",u.stopBubble),window.addEventListener(m.default.names.file.SET_FILE_PERMISSIONS,this.setPermissions),this.noCopyDom.className="no-copy-box",this.pageListDom.focus({preventScroll:!0})}return l()(e,[{key:"adjustScale",value:function(e){if(f.isMobile&&!this.adjustScaleDone){this.adjustScaleDone=!0;var t=document.getElementById("viewport"),n=(window.innerWidth-20)/e;n=n.toFixed(2),f.isAndroid&&(f.isInQQMiniProgram||f.isWpsClient||f.isMobileQQBrowser||f.isInWeixin&&!f.isInMiniProgram)?this.pageContainerDom.style.transform="scale("+n+")":t.content="width=device-width, initial-scale="+n}}},{key:"clearAll",value:function(){this.pageContainerDom.removeEventListener("scroll",this.onScroll),window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("keyup",this.onKeyup),window.removeEventListener(c.default.names.DOC_FONT_WAIT_TO_REPLACE,this.replaceFontInSvg),window.removeEventListener(m.default.names.file.SET_FILE_PERMISSIONS,this.setPermissions),window.cancelAnimationFrame(this.appendPageFrame),this.pageList=[],[this.pageListDom].forEach((function(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}))}},{key:"refreshForcedly",value:function(){}},{key:"asyncRefresh",value:function(){}},{key:"getFontMapFromSvg",value:function(e){for(var t=/font-family=\"\'?([^"]+)\'?\"/g,n={},i=void 0,o=function(){var e=i[1];e.split(",").forEach((function(t){var i=t.replace(/\'/g,"").trim();n[i]||(n[i]=new Set),n[i].add(e)}))};i=t.exec(e);)o();return n}},{key:"requestPages",value:function(){var e=this,t=this.dpiInfo,n=t.dpiX,i=t.dpiY;return new Promise((function(t){var o=window.__CONFIG__.wps.svgPreview,a=o.revisionsView,r=o.revisionsMode,s=o.showMarkup,l=o.showComments,u=o.showInsAndDel,g=o.showFormatting,m=o.displayDocumentFields;s=s?1:0,l=l?1:0,u=u?1:0,g=g?1:0,Object.values(T).includes(m)||(m=T.wpsNotDisplayDocumentFileds);var _=parseInt(Object(v.getQuery)("wpsPreview"),2);isNaN(_)||(a=_&w?1:0,r=_&P?0:_&I?1:2,s=_&S?1:0,l=_&E?1:0,u=_&O?1:0,g=_&x?1:0);var y={pageIndex:0,dpiX:n,dpiY:i,revisionsView:a,showMarkup:s,revisionsMode:r,showComments:l,showInsAndDel:u,showFormatting:g,showDocumentFieldFlag:m},b=function t(n,i){var o=document.createDocumentFragment(),a=Object(h.Ti2Px)(n.coreRect.width),r=document.createElement("div");r.classList.add("page");var s=function(e){var t=e.replace(/font-family=\"([^"]+\s[^"]+)\"/g,(function(e,t){var n=t.split(","),i='font-family="';return n.forEach((function(e,t){t>0&&(i+=","),i+=-1!==e.indexOf(" ")?"'"+e+"'":e})),i+='"'}));return t=t.replace(/\n/g,""),window.__CONFIG__.wps.forceReplaceSimSunGB2312&&window.__CONFIG__.wps.svgPreview.replaceSimsunGB2321WithSimsun&&(t=t.replace(/font-family=\"仿宋_GB2312\"/g,'font-family="仿宋"')),t}(n.svg),l=document.createElement("div");l.classList.add("wps-custom-shadow-root");var u=Object(C.addShadowRoot)(l),g=u||r;g.innerHTML=s,u&&r.appendChild(l);for(var v=g.childNodes,m=0;m<v.length;m++){var _=v[m];"svg"!==_.nodeName&&_.parentNode.removeChild(_)}var b=g.firstChild;i.pageList.push(b);var T=Math.round(i.dpiInfo.dpiY*Object(h.Mm2Ti)(parseFloat(b.getAttribute("height")))/1440),k=Math.round(i.dpiInfo.dpiX*Object(h.Mm2Ti)(parseFloat(b.getAttribute("width")))/1440);b.setAttribute("width","100%"),b.setAttribute("height","100%"),b.setAttribute("viewBox","0 0 "+k+" "+T),b.setAttribute("data-height",T),b.setAttribute("data-width",k),b.setAttribute("data-content-width",a);var w=i.scaleValue;if(f.isMobile&&(w=(window.innerWidth-20)/k),r.style.height=T*w+"px",r.style.width=k*w+"px",i.adjustScale(parseFloat(r.style.width)),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.type&&n.value){var i=e.querySelector("defs"),o=Object(d.a)(n);i.appendChild(o.patternElement),Object(p.createElementNS)({namespaceURI:"http://www.w3.org/2000/svg",type:"rect",parent:e,temp:!0,attributes:{x:0,y:0,width:"100%",height:"100%",fill:"url(#"+o.patternId+")"},style:{pointerEvents:"none"}})}}(b,{width:k,height:T},i.app.getWatermark()),f.isMobile){var S=document.createElement("div");S.classList.add("page-num"),S.innerHTML=n.pageIdx+1,r.appendChild(S)}o.appendChild(r),o.appendChild(document.createElement("div")),i.pageListDom.appendChild(o),c.default.dispatchEvent(c.default.preview.ON_PAGE_APPENDED),e.isExportEnd=n.isExportEnd,n.isExportEnd||(i.appendPageFrame=window.requestAnimationFrame((function(){y.pageIndex=n.pageIdx+1,e.app.api.queryCommandQueue("exportLayoutPageSvg",y,(function(e){!e.error&&e.result.svg&&t(e.result,i)}))})));var P=i.getFontMapFromSvg(s);e.fontList[y.pageIndex]=P,Object.keys(P).forEach((function(e){i.app.data.fontServer.requestLoadFontResourceToPreview(e)}))};e.app.api.queryCommandBlock("exportLayoutPageSvg",y,(function(n){n.error||(t(),n.result.svg&&b(n.result,e))}))}))}},{key:"getCurrentPageIndex",value:function(){for(var e=this.pageContainerDom.offsetHeight,t=this.pageListDom.querySelectorAll(".page"),n=1,i=0;i<t.length;i++){var o=t[i].getBoundingClientRect();if(o.top-20>=0||o.bottom>0&&o.bottom<e||o.top-20<0&&o.bottom>=e){n=i+1;break}}return n}},{key:"processPagesVisibility",value:function(){for(var e=this.pageContainerDom.clientHeight,t=this.pageContainerDom.scrollTop,n=this.pageList,i=this.pageListDom.style.transform?parseFloat(this.pageListDom.style.transform.match(/\((.+)\)/)[1]):1,o=void 0,a=void 0,r=0;r<n.length;r++){var s=n[r],l=s.parentNode.host&&s.parentNode.host.parentNode||s.parentNode,u=parseFloat(l.style.height)*i;a=(o=l.offsetTop)+u,o>=t&&o<t+e||a>t&&a<=t+e||o<=t&&a>=t+e?l.classList.remove("unvisible"):l.classList.add("unvisible")}}},{key:"getPageAmount",value:function(){return this.pageList.length}},{key:"getPageFitValue",value:function(){var e=this.pageContainerDom.offsetWidth,t=this.pageContainerDom.offsetHeight,n=this.getCurrentPageIndex(),i=this.pageList[n-1],o=i.getAttribute("data-width"),a=i.getAttribute("data-height"),r=i.getAttribute("data-content-width");return{pagew:function(){return Math.round((e-40)/o*100)},wordw:function(){return Math.round((e-40)/r*100)},totalpage:function(){var n=0;return n=e/t>=o/a?(t-40)/a:(e-40)/o,Math.round(100*n)}}}},{key:"scale",value:function(e){for(var t=this.pageList,n=0;n<t.length;n++){var i=t[n],o=i.getAttribute("data-width"),a=i.getAttribute("data-height"),r=i.parentNode.host&&i.parentNode.host.parentNode||i.parentNode;r.style.height=a*e+"px",r.style.width=o*e+"px"}this.pageContainerDom.scrollLeft=(this.pageContainerDom.scrollWidth-this.pageContainerDom.clientWidth)/2,this.pageContainerDom.scrollTop=this.pageContainerDom.scrollTop*e/this.scaleValue,this.scaleValue=e,this.config.zoom=e,this.processPagesVisibility()}},{key:"getDPI",value:function(){var e=document.createElement("div");e.style.width="1in",e.style.height="1in";var t=document.getElementsByTagName("body")[0];t.appendChild(e);var n=document.defaultView.getComputedStyle(e,null),i=n.getPropertyValue("width"),o=n.getPropertyValue("height");return t.removeChild(e),{dpiX:Math.round(parseFloat(i)),dpiY:Math.round(parseFloat(o))}}},{key:"scrollToPage",value:function(e){var t=this,n=this.pageList[e];n?this.pageContainerDom.scrollTop=n.parentNode.offsetTop:this.isExportEnd||setTimeout((function(){t.scrollToPage(e)}),300)}},{key:"onScroll",value:function(e){this.processPagesVisibility(),c.default.dispatchEvent(c.default.names.DOC_WORKSPACE_SCROLL,e),Object(k.storeReadPosition)({throttle:!0})}},{key:"onKeydown",value:function(e){if(!this.app.canCopy()){var t=e.keyCode===g.e||"KeyC"===e.code,n=e.keyCode===g.p||"KeyF"===e.code;(e.metaKey||e.ctrlKey)&&(t||n)&&(e.stopPropagation(),e.preventDefault())}Object(_.altModeKeydownHandler)(e)}},{key:"onKeyup",value:function(e){Object(_.tryEnterAltModeOnKeyup)(e)}},{key:"hideToast",value:function(){window.Toast.close()}}]),e}(),N=n(6121),A=n.n(N),D=function(){function e(t){r()(this,e),this.app=t}var t,n,i;return l()(e,[{key:"init",value:(i=o()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initWorkspace(),window.tester.record(window.tester.actions.init_core_end),e.next=4,this.triggerViewUpdate(!0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"afterOpen",value:(n=o()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.initOpenApi(),this.data.fontServer.afterOpen();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"initOpenApi",value:function(){var e=this;A()((function(t){e.view.openApi=new t.default(e.app),c.default.dispatchEvent(c.default.view.ON_OPENAPI_INIT)}))}},{key:"clearAll",value:function(e){this.view.workspace.clearAll(e)}},{key:"initWorkspace",value:function(){this.view.workspace=new R({app:this.app,data:this.data})}},{key:"triggerViewUpdate",value:(t=o()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.view.workspace.requestPages();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"data",get:function(){return this.app.data}},{key:"view",get:function(){return this.app.view},set:function(e){this.app.view=e}}]),e}()},10042:function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var i,o=n(80),a=n.n(o),r=n(144),s=n.n(r),l=n(1),u=n.n(l),c=n(2),h=n.n(c),d=n(30),p=n.n(d),f=n(684),g=n(7762),v=n.n(g),m=n(7763),_=n.n(m),y=n(7764),b=n.n(y),T=n(7765),C=n.n(T),k=n(7766),w=n.n(k),S=n(7767),P=n.n(S),I=(i={},p()(i,f.TYPO_MODE.MODE_PC,{updater:_.a,renderer:v.a,uil:b.a,revisionComment:C.a}),p()(i,f.TYPO_MODE.MODE_WEB,{updater:_.a,renderer:v.a,uil:b.a,revisionComment:C.a}),p()(i,f.TYPO_MODE.MODE_MOBILE,{updater:_.a,renderer:v.a,uil:w.a}),p()(i,f.TYPO_MODE.MODE_PAGINATION,{updater:_.a,renderer:v.a,uil:P.a}),i),E=function(){function e(t){u()(this,e),this.typoMode=t,this.moduleTypes={updater:"updater",renderer:"renderer",uil:"uil",revisionComment:"revisionComment"},this.cachedModulesMap=new Map,this.cachedViewModulesMap={}}return h()(e,[{key:"updateTypoMode",value:function(e){this.typoMode=e,this.viewCoreModulesPromise=null,this.viewUILModulesPromise=null}},{key:"getViewModule",value:function(e){var t=this,n=this.typoMode,i=I[n];this.cachedViewModulesMap[n]||(this.cachedViewModulesMap[n]={});var o=this.cachedViewModulesMap[n];if(!o[e]){var a=i[e],r=this.cachedModulesMap.get(a);o[e]=r?{result:r}:{promise:new Promise((function(n){i[e]((function(i){n(i),t.cachedModulesMap.set(a,i),o[e].result=i}))}))}}return o[e]}},{key:"_getModulesPromise",value:function(e){var t=this;return Promise.all(e.map((function(e){var n=t.getViewModule(e),i=n.promise,o=n.result;return o?Promise.resolve(o):i})))}},{key:"getViewCoreModulesPromise",value:function(){if(!this.viewCoreModulesPromise){var e=this.moduleTypes,t=e.updater,n=e.renderer;this.viewCoreModulesPromise=this._getModulesPromise([t,n])}return this.viewCoreModulesPromise}},{key:"getViewUILModulesPromise",value:function(){if(!this.viewUILModulesPromise){var e=this.moduleTypes.uil;this.viewUILModulesPromise=this._getModulesPromise([e])}return this.viewUILModulesPromise}}]),e}(),O=n(4114),x=n(6121),R=n.n(x),N=n(13),A=n.n(N),D=n(167),M=n(260),L=n(2699),F=n(984),B={commentBubble:!0,commentPanel:!1},H=function(){function e(t){u()(this,e),this.viewportHeight=window.innerHeight,this._keyboardHeight=D.isMobile||D.isPad?D.isInMiniProgram?360:320:0,this.app=t,this.app.isEditMode=!D.isMobile,this.app.isCommentState=!1,this.app.isCooperationMode=!1,this.app.isCardMode=!1,this.app.isPrevModeEdit=!1,this.app.inkPencilType=L.d.MARKER,this.app.inkPencilParams={selectColor:L.e[0],hightLightColor:L.e[1],strokeSize:L.c.strokeSize},this.app.isInkCleanManual=!1,this.isKeyboardAccessible=!0,this.isKeyboardActive=!1,this.app.commentShowStatus=B,this.initialSetting()}return h()(e,[{key:"initialSetting",value:function(){var e=F.getStatus(F.types.READING_MODE_FONT_SIZE),t=F.getStatus(F.types.READING_MODE_LINE_SPACING);this.app.setting={readingFontSize:e||100,readingLineSpacing:t||1}}},{key:"updateReadingSetting",value:function(e){var t=e.fontSizePercentage,n=e.lineSpacingPercentage;isNaN(t)&&isNaN(n)||(isNaN(t)||t===this.readingFontSize||(this.app.setting.readingFontSize=t,F.setStatus(F.types.READING_MODE_FONT_SIZE,t)),isNaN(n)||n===this.readingLineSpacing||(this.app.setting.readingLineSpacing=n,F.setStatus(F.types.READING_MODE_LINE_SPACING,n)))}},{key:"setInkPencilType",value:function(e){this.app.inkPencilType=e}},{key:"setInkPencilParams",value:function(e){this.app.inkPencilParams=e}},{key:"setInkCleanManualStatus",value:function(e){this.app.isInkCleanManual=e}},{key:"setCommentShowStatus",value:function(e){this.app.commentShowStatus=Object.assign(this.app.commentShowStatus,e),M.default.dispatchEvent(M.default.comments.ON_COMMENT_SHOW_STATUS_UPDATE,A()({},this.app.commentShowStatus))}},{key:"getCommentShowStatus",value:function(){return this.app.commentShowStatus}},{key:"getInkCleanManualStatus",value:function(){return this.app.isInkCleanManual}},{key:"getInkPencilType",value:function(){return this.app.inkPencilType}},{key:"getInkPencilParams",value:function(){return this.app.inkPencilParams}},{key:"switchToCommentState",value:function(e){this.app.isCommentState!==!!e&&(this.app.isCommentState=!!e,this.app.workspace.refreshDryly())}},{key:"switchToEditMode",value:function(){this.app.isEditMode=!0,this.app.isCardMode=!1,this._onModeChanged()}},{key:"switchToReadonlyMode",value:function(){this.app.isEditMode=!1,this.app.isCardMode=!1,this._onModeChanged();var e=this.app.data.selection.end;this.app.data.selection.setPosition(e,e)}},{key:"switchToCardMode",value:function(){this.app.isEditMode=!1,this.app.isCardMode=!0,this.app.blurInput(!0)}},{key:"_onModeChanged",value:function(){M.default.dispatchEvent(M.default.mobile.ON_MODE_CHANGED,{isEditMode:this.app.isEditMode})}},{key:"switchToCooperationMode",value:function(e){this.app.isCooperationMode=e,this.app.workspace.refreshContinently(),M.default.dispatchEvent(M.default.names.DOC_COOPERATION_MODE_TOGGLED)}},{key:"showComments",value:function(e){var t=e.checked,n=e.stored,i=e.isTemplate,o=e.includeCommentTips;(void 0===o||o)&&M.default.dispatchEvent(M.default.comments.SHOW_COMMENTS_TIPS,{checked:t}),M.default.dispatchEvent(M.default.comments.SHOW_COMMENTS,{checked:t,isTemplate:i}),M.default.dispatchEvent(M.default.comments.CHECKED_COMMENTS_DROPDOWN,{checked:t}),n&&window.sessionStorage.setItem("commentsVisible",t?"1":"0")}},{key:"getLocateCommentId",value:function(){return this.locateCommentId}},{key:"setLocateCommentId",value:function(e){this.locateCommentId=e}},{key:"readingFontSize",get:function(){return this.app.setting.readingFontSize}},{key:"readingLineSpacing",get:function(){return this.app.setting.readingLineSpacing}},{key:"isKeyboardActive",get:function(){return this.app.isKeyboardActive},set:function(e){this.app.isKeyboardActive=e}},{key:"isKeyboardAccessible",get:function(){return this.app.isKeyboardAccessible},set:function(e){this.app.isKeyboardAccessible=e}},{key:"isKeyboardReady",get:function(){return this.isKeyboardAccessible&&!this.isKeyboardActive}},{key:"keyboardHeight",set:function(e){var t=this._keyboardHeight!==e;this._keyboardHeight=e,t&&M.default.dispatchEvent(M.default.mobile.ON_KEYBOARD_HEIGHT_UPDATED)},get:function(){return this._keyboardHeight}},{key:"preventScroll",get:function(){return this.app.preventScroll},set:function(e){this.app.preventScroll=e}}]),e}(),G=n(227),W=n(6122),j=n(623),U=function(){function e(t){var n=this;u()(this,e),this.onConnected=function(){n.isConnected||(n.isReconnected=!0)},this.onDisconnected=function(){n.isConnected=!1,n.isReconnected=!1},this.onAppReady=function(){n.isAppReady=!0},this.onDocSetProps=function(e){var t=e.error;if(0===t){var i=e.userId,o=n.app.info.userid,a=n.getTargetTypoModeInfo(e),r=a.typoMode,s=a.operation;if(void 0!==r&&(n.isChangingViewMode||n.onViewModeChanged(r,!0),i!==o)){var l=(n.data.selection.selCoop.coopInfo.coopInfos.find((function(e){return e.userid===i}))||{}).username;l&&window.Toast.info((l.length>10?l.slice(0,10)+"...":l)+s)}M.default.dispatchEvent(M.default.names.DOC_SET_PROPS,{error:t,result:e})}},this.app=t,this.isConnected=!0,this.isReconnected=!1,this.isAppReady=!1,this.isChangingViewMode=!1,this.loader=new E(this.app.typoMode),this.hasReportTypo=!1,window.addEventListener(G.default.names.network.ON_CONNECTED,this.onConnected),window.addEventListener(G.default.names.network.ON_DISCONNECTED,this.onDisconnected),window.addEventListener(G.default.names.network.ON_APP_READY,this.onAppReady)}var t,n,i,o,r;return h()(e,[{key:"initUpdater",value:function(){var e=this,t=this.loader.moduleTypes,n=this.loader.getViewModule(t.updater),i=n.promise,o=n.result,a=function(t){console.info("--- [view] - updater");var n=t.defaultUpdater();e.view.updater=new n(e.data,e.view.workspace)};o?a(o):i.then((function(e){return a(e)}))}},{key:"initUIL",value:function(){var e=this,t=this.loader.getViewModule(this.loader.moduleTypes.uil).result,n=function(t){console.info("--- [view] - uil"),e.view.uilManager=new t.default(e.app)};return this.prevState&&this.restore({}),t?(n(t),Promise.resolve()):this.loader.getViewUILModulesPromise().then((function(e){var t=s()(e,2),i=t[0];t[1];n(i)}))}},{key:"initAppApi",value:function(){this.view.appApi=new H(this.app)}},{key:"initOpenApi",value:function(){var e=this;R()((function(t){e.view.openApi=new t.default(e.app),M.default.dispatchEvent(M.default.view.ON_OPENAPI_INIT)}))}},{key:"initViewComponents",value:function(){Object(O.f)(this.app.typoMode),this.loader.updateTypoMode(this.app.typoMode),this.initWorkspace(),this.initControllers(),this.initUpdater(),this.initServices(),this.initAppApi()}},{key:"afterOpen",value:(r=a()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.view.workspace.afterOpen(),this.data.afterOpen(),e.next=4,this.initUIL();case 4:this.view.workspace.updateIndicator({selection:this.data.selection,updateOnly:!0}),this.initOpenApi(),this.resetTypoMode();case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"onPermissionChange",value:function(e,t){if(this.view.uilManager&&this.view.uilManager.onPermissionChange(),(!e||!e.edit)&&t.edit&&this.view.workspace&&this.view.workspace.canvasHandler&&this.view.workspace.canvasHandler.afterFirstRender){var n=!1;this.app.workspace.getFormatContentManager().showAll&&(n=this.app.formatContentController.showAllBorderOfContentControls()),n||this.view.workspace.refreshForcedly()}this.resetTypoMode()}},{key:"typoUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isCoreModulesCached)return!1;var t=e.onUpdate,n=e.isFirstRender,i=this.view,o=i.workspace,a=i.updater,r=0,s=!this.hasReportTypo&&window.APP.typoMode===f.TYPO_MODE.MODE_PC;s&&(r=Date.now());var l=void 0,u=void 0;if(s){var c=a.updatePages({from:0,to:0}),h=c.hasUpdate;l=h}else{var d=this.getTypoUpdateRect(),p=a.updateViewport(d),g=p.hasUpdate,v=p.updatedPages;l=g,u=v}return r>0&&(window.report(j.TYPE.DURATION,"wps_firstlayouttime",Date.now()-r),this.hasReportTypo=!0),t&&t(l),l&&(n||o.updateIndicator({selection:this.data.selection,updateOnly:!0})),o.onScroll(u),!0}},{key:"triggerViewUpdate",value:function(e){var t=this;return this.loader.getViewCoreModulesPromise().then((function(){window.tester.record(window.tester.actions.init_core_end),t.isCoreModulesCached=!0,t.typoUpdate({isFirstRender:e}),console.info("--- [view] - typoUpdate")}))}},{key:"preload",value:function(){this.loader.getViewCoreModulesPromise()}},{key:"init",value:(o=a()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initViewComponents(),e.next=3,this.triggerViewUpdate(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"backup",value:function(){var e=this.view.uilManager&&this.view.uilManager.getPositionOnVisible({isInMainText:!0})||{},t=e.position,n=void 0===t?0:t,i=e.posX,o=this.view.workspace,a=o.config,r=o.scrollLeft,s=a.zoom;this.prevState={selRange:this.data.selection.getNormalRange(),visibleArea:{gcp:n,diffX:i*s-r},commentStatus:this.app.appApi.getCommentShowStatus()}}},{key:"clearAll",value:function(e){for(var t in this.view.services){var n=this.view.services[t];n&&n.clearAll&&n.clearAll(e)}[this.view.updater,this.view.formatContentController,this.view.uilManager,this.view.workspace,this.view.openApi,this.data].forEach((function(t){return t&&t.clearAll(e)})),this.view={},this.isCoreModulesCached=!1}},{key:"refreshData",value:function(){this.data.updateTypoMode(),this.data.initGlyphpool(),this.data.initCompose(),this.data.initTypoinfo(),this.data.initFieldManager()}},{key:"restore",value:(i=a()(regeneratorRuntime.mark((function e(t){var n,i,o,a,r,s,l,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.prevState,i=n.visibleArea,o=i.gcp,a=i.diffX,r=n.selRange,s=n.commentStatus,!this.app.api.hasBlocking()&&this.view.restrictEditHandler.queryDocProtectState(),!t.isMakeSureCursorVisible){e.next=18;break}return l="layout",this.app.isMobileMode()?l+=W.a.Mobile:this.app.isPaginationMode()?l+=W.a.Print:this.app.isPCMode()?l+=W.a.PagePC:l+=W.a.WebPC,(u=this.app.isMobileMode()||this.app.isPaginationMode())&&window.collection("layoutlocate","show",l),e.prev=7,c=Date.now(),e.next=11,this.view.workspace.makeContentVisible(o,{diffX:a,horizontal:u,timeLimit:u?250:1e3}).promise;case 11:u||window.collection("layoutduration",l+"_switch_duration",Date.now()-c),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(7),M.default.dispatchEvent(M.default.view.VISUAL_VIEWPORT_LOCATE_TIMEOUT),window.collection("layoutlocate","show",l+"_"+(u?"locate":"beginning"));case 18:this.data.selection.validateSelection(r,o),this.app.appApi.setCommentShowStatus(s),s.commentBubble||this.app.appApi.showComments({checked:!1,includeCommentTips:!1});case 21:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e){return i.apply(this,arguments)})},{key:"retryVisualViewportLocate",value:function(){var e=this.prevState.visibleArea,t=e.gcp,n=e.diffX;return this.view.workspace.makeContentVisible(t,{isTimeLimited:!1,diffX:n})}},{key:"mountModule",value:function(e){}},{key:"execCommand",value:function(e,t){return!0}},{key:"onCmdResponse",value:function(){if(this.isReconnected){var e=this.data.getCurrentTypoMode();this.app.typoMode!==e&&this.onViewModeChanged(e,!0),this.isReconnected=!1}}},{key:"updateDocTypoMode",value:function(e){var t=this;return new Promise((function(n,i){var o=void 0;switch(e){case f.TYPO_MODE.MODE_PC:o=[{name:"woTemplateTypoMode",val:""},{name:"woTemplate",val:0}];break;case f.TYPO_MODE.MODE_WEB:o=[{name:"woTemplateTypoMode",val:"web"}],t.data.doc.docInfo.woTemplate||o.push({name:"woTemplate",val:1});break;case f.TYPO_MODE.MODE_MOBILE:o=[{name:"woTypoMode",val:""}];break;case f.TYPO_MODE.MODE_PAGINATION:o=[{name:"woTypoMode",val:"pages"}]}t.view.uilManager.editHandler.setDocProps(o,(function(e){e.success?n(!0):i(!1)}))||i(!1)}))}},{key:"beforeViewModeChanged",value:function(e,t){window.Toast.info(_i18n("applications.writer.components.core.event.uil.view.loading", "Loading..."),null,6),M.default.dispatchEvent(M.default.view.BEFORE_VIEW_MODE_CHANGED,{prevTypoMode:e,currentTypoMode:t})}},{key:"afterViewModeChanged",value:(n=a()(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return e.next=3,this.afterOpen();case 3:return this.view.workspace.onAfterFirstRender(),this.typoUpdate(),e.next=7,this.restore(n);case 7:setTimeout((function(){window.Toast.close()}),600),M.default.dispatchEvent(M.default.view.AFTER_VIEW_MODE_CHANGED,{typoMode:this.app.typoMode,result:t});case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"changeViewMode",value:function(e){this.app.typoMode=e}},{key:"onViewModeChanged",value:(t=a()(regeneratorRuntime.mark((function e(t,n){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isMakeSureCursorVisible:!0};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.app.typoMode&&!this.isChangingViewMode){e.next=2;break}return e.abrupt("return",!1);case 2:if(this.beforeViewModeChanged(this.app.typoMode,t),this.isChangingViewMode=!0,i=!0,n){e.next=15;break}return e.prev=6,e.next=9,this.updateDocTypoMode(t);case 9:i=e.sent,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),i=!1;case 15:if(i){e.next=20;break}console.error("版式切换：同步文档属性错误……"),window.Toast.info(_i18n("applications.writer.components.core.event.uil.view.loadingError", "Loading failed. Try again later.")),e.next=27;break;case 20:return this.backup(),this.clearAll(!1),this.changeViewMode(t),this.refreshData(),this.initViewComponents(),e.next=27,this.triggerViewUpdate();case 27:return e.next=29,this.afterViewModeChanged(i,o);case 29:return this.isChangingViewMode=!1,e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(e,n){return t.apply(this,arguments)})},{key:"resetTypoMode",value:function(){var e=this;setTimeout((function(){if(e.app.isFileOpened){var t=e.app.data.getCurrentTypoMode(),n=e.app.data.getDocumentTypoMode();if(!e.app.isReadOnly()&&t!==n)delete e.app.config.typoMode,t!==e.app.data.getCurrentTypoMode()&&e.onViewModeChanged(n,!0)}}),16)}},{key:"data",get:function(){return this.app.data}},{key:"view",get:function(){return this.app.view},set:function(e){this.app.view=e}}]),e}()},10043:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(260),l=n(144),u=n.n(l),c=n(410),h=n(310),d=function(){function e(t,n,i){o()(this,e),this.init(t,n,i)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:h.ITRange,methodName:"init"}]}}]),r()(e,[{key:"init",value:function(e,t,n){this.mixin_ITRange_init(e,t),this.data=n}},{key:"cloneData",value:function(){return{pos:this.pos,len:this.len,data:this.data}}}]),e}();c.a.mix(d,h.ITRange);var p=d,f=n(1103),g=n(1169),v=n(1643),m=n(2294),_=n(167),y=n(723),b=n(309),T=n(1104),C=n(1146),k=function(){function e(t,n){o()(this,e);var i=void 0;this.app=t,this.ccm=n,this.data=t.data,this.document=this.data.doc,this._reqKeys={},i=new g.e(this.document,f.u,h.IT.upper,h.IT.Crossing),this.emptyCommentRangeClass=i,this.activeParaRange=null,this.localIds={},i=new g.e(this.document,f.u,h.IT.outer),this.localCommentRangeClass=i,this.data.doc.attachObserver(this),this._paraActiveInfo={active:!1,isPara:!0}}return r()(e,[{key:"clearAll",value:function(){this.data.doc.detachObserver(this),this.emptyCommentRangeClass.clearAll(),this.localCommentRangeClass.clearAll()}},{key:"getCommentByLocalId",value:function(e){var t=void 0,n=void 0;return this.localCommentRangeClass.forEachNode((function(n){if(n.data.local_id===e)return t=n,!0})),t&&(n=this.document.comments.getCommentByCommentEnd(t.end)),n}},{key:"getComments",value:function(e,t){var n=this,i=[],o=this.data.doc;if(i=o.comments.collectByPlaceHolder(e,t).map((function(e){for(var t=e.pos,i=e.len,a=e.body,r=void 0,s="text",l=o.bookmarks.rangeClass.collectRanges(a.pos,a.len),u=0;u<l.length;++u){var c=l[u].data.getName();if(Object(v.isValidCommentBkName)(c)){var h=Object(v.decodeBkName)(c);if(h){r=h.comment_id,s=h.type;break}}}var d={comment_id:r,user_info:{name:e.author},rc_id:e.rc_id,time:Object(v.getTime)(e.date),content:{type:s,text:e.content},range:{pos:t,len:i}};if(r)Object.assign(d,{comment_id:r});else{var f=void 0,g=t+i-1,_=t+i,y=n.localCommentRangeClass.findNodeEqualRange(g,_);if(y&&(f=y.data.local_id),!f){f=m.getRandomId();var b=new p(g,_,{local_id:f});n.localCommentRangeClass.attachNode(b),n.localIds[f]=b}Object.assign(d,{local_id:f})}return d})),0!==Object.keys(this._reqKeys).length){var a=this.emptyCommentRangeClass.collectRanges(e,t);i=i.concat(a.map((function(e){var t=e.data,n=t.key,i=t.user_info,o=t.content,a=t.time;return{key:n,user_info:{name:i.name,avatar:i.avatar},time:a,content:{type:o.type}}})))}return(i=i.filter((function(e){return!Object(C.isCommentHide)(e)}))).length&&i.sort((function(e,t){if(_.isMobile)return e.time-t.time;var n=e.range.pos,i=t.range.pos,o=n+e.range.len,a=i+t.range.len;return o!==a?o-a:n!==i?n-i:e.time-t.time})),i}},{key:"insertEmptyComment",value:function(e,t){var n=this,i=m.getRandomKey(),o={key:i,user_info:{name:this.username,avatar:this.avatar},time:Object(v.getTime)(),content:{type:"voice"},correlationID:t},a=void 0,r=e;if(r)a=new p(r.pos,r.pos+r.len,o);else{if(this.app.isEditMode)r=this.getCommentRange(),a=new p(r.pos,r.pos+r.len,o);else{var s=this.app.data.doc.getSubDocRange(b.MainText),l=s.pos+s.len-1;r={pos:l,len:0},a=new p(l,l,o)}r=this.app.data.selection.extendCommentRangeWithTable(this.app,r.pos,r.len,!0)||r}return this.emptyCommentRangeClass.attachNode(a),this._reqKeys[i]=a,window.APP.isPaginationMode()||this.app.updater.onCommentPreview(r.pos+r.len),this.app.viewUIL.typoUpdate(),this.app.isEditMode?setTimeout((function(){n.ccm&&n.ccm.focusEmptyComment(o)})):this.app.isEditMode||this.app.workspace.revisionComment.handleCommentsDataChange({detail:{type:"InsertComments",isEmptyComment:!0,range:a,rc_id:i}}),i}},{key:"insertComment",value:function(e,t,n,i){var o=void 0,a=void 0;if(e&&this._reqKeys[e]){var r=this._reqKeys[e];o=r.pos,a=r.len,this.emptyCommentRangeClass.detachNode(r),delete this._reqKeys[e]}else if(n)o=n.pos,a=n.len;else{var s=this.getCommentRange();o=s.pos,a=s.len}var l="voice"==t.content.type,u=Object(v.encodeBkName)(t.comment_id,t.content.type),c=l?t.content.voicetext:t.content.text,h=this.app.workspace.revisionComment.isShowComment,d={pos:o,len:a,string:c,author:this.username,date:Object(v.getTime)(t.time),bkName:u,submit:i,commentId:t.comment_id,commentType:t.content.type,contents:t.contents};t.isAll?this.data.doc.comments.insertDocComment(d):t.isReply?(d.replyId=t.p_comment_id,this.data.doc.comments.insertCommentReply(d)):this.data.doc.comments.insertComment(d),_.isMobile&&h&&!this.app.uilManager.uiHandler.state.commentPanel.isShow&&(this.app.viewUIL.typoUpdate(),this.ccm&&this.ccm.focusComment(t))}},{key:"modifyComment",value:function(e){var t=e.text,n=void 0===t?"":t,i=e.replyId,o=void 0===i?"":i,a=e.contents,r=e.commentId,l=this.findCommentById(r);if(!l||void 0===l.pos||void 0===l.len)return console.log("有问题, 没有评论？？？"),s.default.dispatchEvent(s.default.comments.ON_CANCEL_REPLY_ITEM),!1;var u={commentId:r,pos:l.pos,len:l.len,replyId:o,isReply:!!o,contents:a,string:n};return this.data.doc.comments.modifyComment(u)}},{key:"findComment",value:function(e){return e?"local"==e.uuIdType?this.findCommentByLocalId(e.uuId):"comment"==e.uuIdType?this.findCommentById(e.uuId):null:null}},{key:"findCommentById",value:function(e){if(!e)return null;var t=this.data.doc.bookmarks.map,n=null;for(var i in t){if(!(i.indexOf("_link")>=0))if(i.startsWith("_T")||i.startsWith("_V")){var o=Object(v.decodeBkName)(i);if((o?o.comment_id:"")===e){n=t[i];break}}}return n?this.data.doc.comments.getCommentByBookmarkPos(n.pos):null}},{key:"findCommentByLocalId",value:function(e){return e?this.data.doc.comments.getCommentByRcId(e):null}},{key:"findCommentByRange",value:function(e,t){return this.data.doc.comments.getCommentByRange(e,t)}},{key:"removeCommentByKey",value:function(e){if(e&&this._reqKeys[e]){var t=this._reqKeys[e];this.emptyCommentRangeClass.detachNode(t),delete this._reqKeys[e],this.app.updater.onCommentPreview(t.pos+t.len),this.app.viewUIL.typoUpdate()}}},{key:"removeCommentById",value:function(e){this.removeComment(this.findCommentById(e))}},{key:"removeCommentByLocalId",value:function(e){this.removeComment(this.findCommentByLocalId(e))}},{key:"removeCommentByRange",value:function(e,t){this.removeComment(this.findCommentByRange(e,t))}},{key:"removeComment",value:function(e){e&&(this.data.doc.comments.removeComment(e),this.app.viewUIL.typoUpdate(),this.updateComponent())}},{key:"removeComments",value:function(e){e&&e.length&&(this.data.doc.comments.removeComments(e),this.app.viewUIL.typoUpdate(),this.updateComponent())}},{key:"updateComponent",value:function(){this.data.doc.reviewMgr.updateComponent(this.data,!0,{}),this.data.doc.reviewMgr.dispatchCommentsDataEvent()}},{key:"replyCommentById",value:function(e){this.replyComment(this.findCommentById(e))}},{key:"replyCommentByLocalId",value:function(e){this.replyComment(this.findCommentByLocalId(e))}},{key:"replyCommentByRange",value:function(e){this.replyComment(this.findCommentByRange(e.pos,e.len))}},{key:"replyComment",value:function(e){if(e){var t=e.pos,n=e.len,i=e.rc_id,o=e.comment_id,a=e.author;this.data.selection.setPosition(t,t+n,{updateOnly:!0}),s.default.dispatchEvent(s.default.mobile.ON_SHOW_COMMENT_ENTRY,{replyUser:a,replyCommentId:o,replyCommentRCId:i,commentRange:{pos:t,len:n}})}}},{key:"isCharBreak",value:function(e){var t=this.data.glyphpool.glyphBuff.getCharCode(e);return y.a.isLineBreak(t)||y.a.isFieldBeginEnd(t)}},{key:"isLineBreak",value:function(e){var t=this.data.glyphpool.glyphBuff.getCharCode(e);return y.a.isLineBreak(t)}},{key:"getParaRange",value:function(e){if(this.app.data.selection.getTableRange(e,!0))return{pos:e,len:0};var t=this.data.doc.getDataLogic("final").getPapx(e),n=void 0;t.len>2&&!_.isMobile&&(e-t.pos>=2?n={pos:e-2,len:2}:t.pos+t.len-e>2&&(n={pos:e,len:2})),n||(n={pos:t.pos,len:t.len-1});var i=this.data.doc.contentControls.collect(n.pos,n.len-1).filter((function(e){return e.begin<n.pos&&e.end<n.pos+n.len})).sort((function(e,t){return e.end-t.end})),o=u()(i,1)[0];return o&&(n={pos:n.pos,len:o.end-n.pos-1}),n}},{key:"getCommentRange",value:function(){var e=this.data.selection.getNormalRanges(),t=e[0];e.forEach((function(e){t=e.pos>t.pos?e:t}));var n=t.pos,i=t.len,o=this.data.selection.selInfo.isInTable(n);i>0&&this.isCharBreak(n+i-1)&&!o&&(i-=1);var a=this.data.doc.textStream.getPapx(Math.max(i>0?n+i-1:n+i,0));return o&&null!=a.prop&&a.prop.getPropVal("para_type")===T.d&&(i-=1),0===i?this.getParaRange(n):{pos:n,len:i}}},{key:"refreshComment",value:function(e){this.ccm&&this.ccm.refreshComment(e)}},{key:"formatComment",value:function(e){if(e){e.userid=e.userid||e.user_info.id;var t=this.findComment(e);if(t){var n=t.pos,i=t.len;e.range={pos:n,len:i}}else console.log("Comment Not Found");return e}return null}},{key:"activeAllComment",value:function(e){var t=this.data.selection.activeAllCommentsData;(0!==e.length||t&&0!==t.comments.length)&&(this.data.selection.activeAllComments({comments:e}),this.app.workspace.refreshDryly())}},{key:"activeCommentPara",value:function(e){this._paraActiveInfo.isPara=e.isPara,this._setParaRange(e.range);var t=e&&e.comments&&e.comments.map((function(e){return e.rc_id}));this.data.selection.activeCommentPara(e,t),this.app.workspace.refreshDryly()}},{key:"hoverCommentPara",value:function(e){var t=e&&e.comments&&e.comments.map((function(e){return e.rc_id}));this.data.selection.hoverCommentPara(e,t),this.app.workspace.refreshDryly()}},{key:"inactiveCommentPara",value:function(){this._paraActiveInfo.active||this._setParaRange(null),this.data.selection.inactiveCommentPara(),this.app.workspace.refreshDryly()}},{key:"outCommentPara",value:function(){this.data.selection.outCommentPara(),this.app.workspace.refreshDryly()}},{key:"beginActiveCommentPara",value:function(e){this._paraActiveInfo.active=!0,this._setParaRange(e.range)}},{key:"endActiveCommentPara",value:function(){this._paraActiveInfo.active&&this._setParaRange(null),this.inactiveCommentPara(),this._paraActiveInfo.active=!1}},{key:"_setParaRange",value:function(e){this.activeParaRange&&(this.localCommentRangeClass.detachNode(this.activeParaRange),this.clearActiveParaRange()),e&&(this.activeParaRange=new p(e.pos,e.pos+e.len,{}),this.localCommentRangeClass.attachNode(this.activeParaRange))}},{key:"clearActiveParaRange",value:function(){this.activeParaRange=null}},{key:"onInsertText",value:function(){}},{key:"onDeleteText",value:function(){}},{key:"onTextChanged",value:function(){}},{key:"setAllCommentsWithParaRange",value:function(){this.app.workspace.revisionComment.getAllDataDraw()}},{key:"username",get:function(){return this.app.info&&this.app.info.username}},{key:"avatar",get:function(){return this.app.info&&this.app.info.avatar}}]),e}(),w=function(){function e(t){o()(this,e),this.app=t,this.data=t.data;var n=t.workspace,i=t.servicesLoader;i&&i.CommentsComponentsManagerLoader&&_.isMobile?(this.ccm=i.CommentsComponentsManagerLoader(n.element),this._shouldDeleteCommentsHandler=this._shouldDeleteComments.bind(this),this.buildPiping=this._buildPiping.bind(this),this.buildPiping()):i&&i.updateCommentsDataManager&&!_.isMobile&&i.updateCommentsDataManager(t),this.document=this.data.doc,this.docUserCommentsHandle=new k(this.app,this.ccm)}return r()(e,[{key:"clearAll",value:function(){_.isMobile&&this.ccm&&this.ccm.clearAll(),this.docUserCommentsHandle.clearAll(),window.removeEventListener(s.default.comments.COMMENTS_SHOULD_UPDATE,this._updatePiping),window.removeEventListener(s.default.comments.COMMENTS_SHOULD_MOVE,this._updatePiping),window.removeEventListener(s.default.comments.COMMENTS_SHOULD_DELETE,this._updatePiping),window.removeEventListener(s.default.comments.COMMENTS_SHOULD_HIDE,this._updatePiping),window.removeEventListener(s.default.comments.COMMENTS_SHOULD_SHOW,this._updatePiping)}},{key:"_buildPiping",value:function(){var e=this;this.piping={status:"waiting",list:[]},this.piping.list.push=function(t){Array.prototype.push.call(this,t),e._doPiping()},this.piping.list.shift=function(){e.piping.status="waiting",Array.prototype.shift.call(this),e._doPiping()},this._updatePiping=this._updatePiping.bind(this),window.addEventListener(s.default.comments.COMMENTS_SHOULD_UPDATE,this._updatePiping),window.addEventListener(s.default.comments.COMMENTS_SHOULD_MOVE,this._updatePiping),window.addEventListener(s.default.comments.COMMENTS_SHOULD_DELETE,this._updatePiping),window.addEventListener(s.default.comments.COMMENTS_SHOULD_HIDE,this._updatePiping),window.addEventListener(s.default.comments.COMMENTS_SHOULD_SHOW,this._updatePiping)}},{key:"_updatePiping",value:function(e){var t=e.detail,n=t.key,i=t.offsetTop,o=t.range,a=t.type;this.piping.list.push({type:a,key:n,offsetTop:i,range:o})}},{key:"_doPiping",value:function(){if("waiting"===this.piping.status){if(0===this.piping.list.length)return;this.piping.status="working";var e=this.piping.list[0];switch(e.type){case"update":this._shouldUpdateComments(e);break;case"move":this._shouldMoveComments(e);break;case"del":this._shouldDeleteComments(e);break;case"hide":this._shouldHideComments(e);break;case"show":this._shouldShowComments(e);break;default:return}}}},{key:"_shouldUpdateComments",value:function(e){var t=this,n=e.key,i=e.offsetTop,o=e.range,a=this.docUserCommentsHandle.getComments(o.pos,o.len),r=this.ccm.updateCommentList(n,i,a);r?r.then((function(e){e?(e.onComponentDidMount((function(e){if(t.app.updater.onCommentHeight){t.app.updater.onCommentHeight(n,e),t.app.viewUIL.typoUpdate();var i=s.default.cooper.getCooperCenter().getCooperationUsers(),o=t.app.info;t.app.data.selection.selCoop.setCooperationSelections(i,o)}})),t.piping.list.shift()):t.piping.list.shift()})).catch((function(){})):this.piping.list.shift()}},{key:"_shouldDeleteComments",value:function(e){var t=e.key,n=e.offsetTop;this.ccm.deleteComment(t,n,[]),this.piping.list.shift()}},{key:"_shouldHideComments",value:function(e){var t=e.key,n=e.offsetTop;this.ccm.hideComment(t,n,[]),this.piping.list.shift()}},{key:"_shouldShowComments",value:function(e){var t=e.key,n=e.offsetTop;this.piping.list.shift(),this.ccm.showComment(t,n,[])}},{key:"_shouldMoveComments",value:function(e){var t=this,n=e.key,i=e.offsetTop,o=this.ccm.updateCommentList(n,i);o?o.then((function(){t.data.selection.clearCache(),t.app.workspace.updateIndicator({selection:t.data.selection,updateOnly:!0}),t.piping.list.shift()}),(function(){})):this.piping.list.shift()}}]),e}();t.a=w},10061:function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(554),d=n(310),p=n(309),f=n(4105),g=n(411),v=n(626),m=n(336),_=n(6119),y=n(1737),b=n(4583),T=n(6120);function C(e,t,n,i,o,a){var r=e.viewPage,s=t.viewPage,l=r.page.lines.findIndex((function(t){return t===e})),u=s.page.lines.findIndex((function(e){return e===t})),c=o&&i.rect.left>n.rect.left||!o&&n.rect.left>i.rect.left;a.bReverseRg=c;for(var h=Math.floor(Math.min(n.rect.left,i.rect.left)),d=Math.ceil(Math.max(n.rect.right,i.rect.right)),p=r;p;){for(var f=p.page.lines,g=p===r?l:0,v=p===s?u+1:f.length;g<v;++g){for(var m=f[g].tablecells,_=null,y=null,b=!1,T=!1,C=0,k=m.length;C<k;++C){var w=m[C];if(!(Math.floor(w.rect.right)<=h)){if(Math.ceil(w.rect.left)>=d)break;!_&&w.range&&(_=w,b=0===C),w.range&&(y=w,T=C===k-1)}}if(_&&y){var S=y.range;c?a.rs.push({begin:S.pos+S.len,end:_.range.pos,bSelAllCell:b&&T}):a.rs.push({begin:_.range.pos,end:S.pos+S.len,bSelAllCell:b&&T})}}if(p===s)break;if(!(p=p._nextTable))return!1}return!0}var k=n(260),w={margin:{left:120,top:96},width:794,height:1123},S=function(e){function t(e,n,i){o()(this,t);var a=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:null,viewPage:null,coorSystem:null}));return a.compose=n,a.data=e,a.layout_pages=[],a.size=f.a.ZERO(),a.coreTypoShapeInfo=new Map,a.update(i),a.pageCount=0,Object(h.default)(a),a.textLineRanges=new d.ITToolkit,a.tableLineRanges=new d.ITToolkit,a.embedShapeRanges=new d.ITToolkit,a.shapeCardRanges=new d.ITToolkit,a.commentsRanges=new d.ITToolkit,a.comments={},a.commentView=new T.a(e,n,a),a.horizontalPadding=25,a.verticalPadding=25,a._viewOffset={x:0,y:0},a.isTypoEnd=!1,a._titleHeight=156,a}return c()(t,e),r()(t,[{key:"isView",value:function(){return!0}},{key:"isHost",value:function(){return!1}},{key:"isCoorSystem",value:function(){return!0}},{key:"getCurrentPos",value:function(e){return 0}},{key:"setViewOffsetX",value:function(e){this._viewOffset.x=e}},{key:"setViewOffsetY",value:function(e){this._viewOffset.y=e}},{key:"getLeftInfo",value:function(e){return{outerLeft:0,innerLeft:this.horizontalPadding}}},{key:"_dealDrawingInfo",value:function(e){var t=e.shapeTreeType,n=e.id,i=e.w,o=e.h;if(void 0!==i&&void 0!==o&&void 0!==t&&void 0!==n){var a=this.data.doc.layer.getShapeTree(t);if(void 0!==a&&void 0!==a.childs){var r=a.childs.getValue(n);r&&(r.setCacheRectByDocRect({left:0,right:i,top:0,bottom:o}),this.rgActive&&this.data.doc.updateShapeDrawingInfo(n,this.rgActive))}else console.log("后端导的数据有问题!")}else console.log("后端导的对象数据有问题:",e)}},{key:"_dealNotEmbedDrawingInfo",value:function(e){if(void 0!==e.type)return 2!==e.type?this._dealDrawingInfo(e):void this._dealHostDrawing(e);console.log("后端导的对象数据有问题:",e)}},{key:"_dealHostDrawing",value:function(e){var t=this;void 0!==e.typoDrawingInfos&&e.typoDrawingInfos.forEach((function(e){t._dealNotEmbedDrawingInfo(e)}))}},{key:"_dealLineDrawing",value:function(e){var t=this;void 0!==e.cells&&e.cells.forEach((function(e){t._dealHostDrawing(e),e.cellPage&&t._dealTextPageDrawing(e.cellPage)}))}},{key:"_dealTextPageDrawing",value:function(e){var t=this;e.lines.forEach((function(e){t.rgActive=e.range?{pos:e.range.position,len:e.range.length}:null,t._dealLineDrawing(e)}))}},{key:"_dealLayoutPageDrawing",value:function(e){var t=this;void 0===e.oldPageIndex&&(this.rgActive=e.pos?{pos:e.pos,len:e.len}:null,this._dealHostDrawing(e),void 0!==e.typoEmbedDrawingInfos&&e.typoEmbedDrawingInfos.forEach((function(e){t._dealDrawingInfo(e)})),e.mainPages.forEach((function(e){t._dealTextPageDrawing(e)})))}},{key:"_dealCoreShapeInfo",value:function(e){var t=this;e&&e.forEach((function(e){var n=e.id,i=t.coreTypoShapeInfo.get(n);if(t.coreTypoShapeInfo.set(n,e),i&&i.shape){var o=t.data.doc.anchors.getAnchor(i.shape.id,i.shape.pos,1);o||(o=t.data.doc.inlineAnchors.getAnchor(i.shape.id,i.shape.pos,1)),o&&t.data.doc._dispatch("onChpxChanged",{pos:i.shape.pos,len:1})}}))}},{key:"getTypoShapeInfo",value:function(e){if(!e)return null;var t=this.coreTypoShapeInfo.get(e.id);return t||(t={dataVersion:-99,id:e.id,shape:e.topShape,visualInnerBounding:{left:0,top:0,right:Object(m.Px2Ti)(e.rect.width),bottom:Object(m.Px2Ti)(e.rect.height)}},this.coreTypoShapeInfo.set(e.id,t)),t}},{key:"update",value:function(e){var t=this,n=null;this.data.cache.typoinfo.typoPageInfo.forEach((function(i){i.pageIndex<e.pageCount&&(null!=i.pos&&(null===n||n.pageIndex<i.pageIndex)&&(n=i),t._dealLayoutPageDrawing(i))}));var i=!1,o=!1;if(e.typoPageInfo&&e.typoPageInfo.forEach((function(e){void 0!==e.footnotesOffset&&(i=!0),void 0!==e.endnotesOffset&&(o=!0)})),i){var a=this.data.doc.getSubDocRange(p.Footnote);this.data.api.queryRange({gcpCurrent:a.pos,length:a.len})}if(o){var r=this.data.doc.getSubDocRange(p.Endnote);this.data.api.queryRange({gcpCurrent:r.pos,length:r.len})}if(null!==n){var s=this.data.doc.subdocs[p.MainText],l=s.subdoc_offset+s.subdoc_size,u=n.pos+n.len;this.data.doc.concernRanges.some((function(e){if(u>=e.pos&&u<e.pos+e.len){var t=e.pos+e.len;return window.APP.prepareRange({gcpCurrent:u,length:t-u}),!0}if(u<e.pos&&l<e.pos)return window.APP.prepareRange({gcpCurrent:e.pos,length:e.len}),!0})),this._dealCoreShapeInfo(e.typoShapeInfo)}}},{key:"getLayoutPageCache",value:function(e){return this.layout_pages[e]}},{key:"hitViewPage",value:function(e){for(var t=this.layout_pages,n=this.pageCount,i=null,o=0,a=n,r=0;o!==a;)if(e<(i=t[r=Math.floor((o+a)/2)]).rect.top)a=r;else{if(!(e>=i.rect.bottom))return{page:i,index:r};o=r+1}if(n){var s=0===a?0:n-1;return{page:t[s],index:s}}return null}},{key:"locateViewPage",value:function(e){var t=this.textLineRanges.findNodeContainPos(e);if(t)return t.line.viewPage}},{key:"heightAt",value:function(e){var t=void 0===e?this.pageCount:e;return 0===t?this.verticalPadding:this.layout_pages[t-1].rect.bottom}},{key:"getSelCellRanges",value:function(e,t,n,i,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=e.line.isSubLine?e.line.parent:e.line,s=t.line.isSubLine?t.line.parent:t.line;if(void 0!==r&&void 0!==s&&void 0===r.tablecells&&void 0===s.tablecells){var l=r.parent,u=s.parent;if(void 0!==l&&void 0!==u){if(l===u)return a?"sameCell":void 0;var c=l,h=u;if(l=l.parent,u=u.parent,void 0!==l&&void 0!==u){var d=[];if(o){var p=l;l=u,u=p}for(var f=[],v=[],m=[];l.layoutType===g.DOCLayoutType.Cell;)v.splice(0,0,l),l=l.parent,m.splice(0,0,l),l=l.parent,f.splice(0,0,l),l=l.parent;for(var y=[],b=[],T=[];u.layoutType===g.DOCLayoutType.Cell;)b.splice(0,0,u),u=u.parent,T.splice(0,0,u),u=u.parent,y.splice(0,0,u),u=u.parent;if(e.layoutIndex!==t.layoutIndex){var k={rs:d};if(!C(m[0],T[0],v[0],b[0],o,k))return;_.a.dealResult(d,k.bReverseRg)}else{if(f.length<=0||y.length<=0)return void console.log("大哥，错了！");if(f[0]!==y[0])return;for(var w=0,S=f.length,P=y.length;w<S&&w<P&&f[w]===y[w];)++w;var I=f[--w];if(I.layoutType!==g.DOCLayoutType.CellPage&&I.layoutType!==g.DOCLayoutType.TextPage&&I.layoutType!==g.DOCLayoutType.MainPage)return void console.log("大哥，错了！");if(v[w]===b[w]){if(c!==h){var E=v[w].range;return o?{begin:E.pos+E.len,end:E.pos}:{begin:E.pos,end:E.pos+E.len}}return}var O={rs:d};if(!I.getSelCellRanges(m[w],T[w],v[w],b[w],o,O))return;_.a.dealResult(d,O.bReverseRg)}return o&&d.reverse(),d}console.log("大哥，错了！")}else console.log("大哥，错了！")}else console.log("大哥，错了！")}},{key:"getFilenameHeight",value:function(){if(void 0!==this._filenameHeight)return this._filenameHeight;var e=this.data.doc.docInfo,t=e.woTemplateFileNamePos,n=e.woTemplateFileNameSeparationLinePos,i=e.woTemplateFileNameSeparationLineHeight;return t=t?Math.min(Math.round(Object(m.Ti2Px)(t)),90):90,n=n?Math.min(Math.round(Object(m.Ti2Px)(n)),139):139,i=i?Math.round(Object(m.Ti2Px)(i)):2,this._filenameHeight=n+i-t,this._filenameHeight}},{key:"updateTitleHeight",value:function(e){var t=e-this._titleHeight;this._titleHeight=e,this.verticalPadding+=t,this.updater.onTitleHeightChange()}},{key:"initForPCWebMode",value:function(e,t){if(e||!this.size.width){var n=window.APP.isAdaptMode(),i=w,o=this.data.doc.sections.getSection(0).data.getProps().page;if(n){if(i=this.getAdaptSize(),o){var a=Object(m.Ti2Px)(o.margin.left),r=Object(m.Ti2Px)(o.margin.top),s=Object(m.Ti2Px)(o.margin.bottom);i.margin.left=a>=0?a:i.margin.left,i.margin.top=r>=0?a:i.margin.top,i.margin.bottom=s>=0?a:i.margin.bottom}}else o&&(i={margin:{left:Object(m.Ti2Px)(o.margin.left||0),top:Math.max(Object(m.Ti2Px)(o.margin.top||0),156),bottom:Math.max(Object(m.Ti2Px)(o.margin.bottom||0),135)},height:Object(m.Ti2Px)(o.height||0),width:Object(m.Ti2Px)(o.width||0)});var l=-(!1===(t||this.data.doc.docInfo).woTemplateFileNameVisible?this.getFilenameHeight():0);this.size.width=i.width||w.width,this.horizontalPadding=i.margin.left,this.horizontalPadding||0===this.horizontalPadding||(this.horizontalPadding=w.margin.left),this.verticalPadding=Math.max(i.margin.top||0,this._titleHeight)+l,this.paddingBottom=i.margin.bottom||0,this.orgPageHeight=i.height||w.height,this.setViewOffsetY(Object(m.Ti2Px)(270))}}},{key:"getAdaptSize",value:function(){var e=w.margin.left,t=20,n=t;window.APP.workspace&&(t=Math.max(window.APP.workspace.getPaddingLeft()+4,t),n+=window.APP.workspace.getPaddingRight());var i=Math.min(Math.max(window.innerWidth-t-n,240),1200);if(1200===i&&window.innerWidth>1200+2*t){var o=window.innerWidth;t=Math.round((o-i)/2)}return this.offsetLeft=t,{margin:{left:e},width:i,height:window.innerHeight}}},{key:"updateComponent",value:function(e,t){t.pageNo,t.pos;e&&this.data.doc.reviewMgr.dispatchEvent(),this.data.doc.reviewMgr.dispatchCommentsDataEvent()}},{key:"getPosition",value:function(e,t){return new y.a(this.data.selection,e,t)}},{key:"offsetView",value:function(e,t){this.horizontalPadding+=e,this.verticalPadding+=t,this.layout_pages.forEach((function(n){n.outer_rect.offset(e,t),n.onDel()}))}},{key:"onUpdated",value:function(){this._dispatch("onViewportChanged"),this._dispatch("onContainerChanged")}},{key:"onAllPageDone",value:function(){this.isTypoEnd=!0,this._dispatch("onAllPageDone"),k.default.dispatchEvent(k.default.names.DOC_TYPO_ALL_PAGE_DONE)}},{key:"attachLine",value:function(e){switch(e.layoutType){case g.DOCLayoutType.TextLine:this.attachTextLine(e);break;case g.DOCLayoutType.TableLine:this.attachTableLine(e)}}},{key:"attachTextLine",value:function(e){e.range.isOrphan()&&this.textLineRanges.attachNode(e.range)}},{key:"attachTableLine",value:function(e){e.range.isOrphan()&&this.tableLineRanges.attachNode(e.range)}},{key:"detachLine",value:function(e){switch(e.layoutType){case g.DOCLayoutType.TextLine:this.detachTextLine(e);break;case g.DOCLayoutType.TableLine:this.detachTableLine(e)}}},{key:"detachTextLine",value:function(e){e.range.isOrphan()||this.textLineRanges.detachNode(e.range)}},{key:"detachTableLine",value:function(e){e.range.isOrphan()||this.tableLineRanges.detachNode(e.range)}},{key:"composeProcessLayout",value:function(e){new b.b(this).composeMobilePage(e)}},{key:"collectTextLines",value:function(e){var t=e.begin,n=e.end;return this.view.textLineRanges.mapInRange(t,n,(function(e){return e._node.line}),d.IT.strictIntersectTest)}},{key:"getCommentView",value:function(e){return this.commentView}},{key:"getCommentPage",value:function(e){return this.commentView.getCommentPage(e)}},{key:"layoutType",get:function(){return g.DOCLayoutType.MobileView}},{key:"view",get:function(){return this}},{key:"position2parent",get:function(){return v.a.ZERO()}},{key:"viewOffset",get:function(){return this._viewOffset}},{key:"width",get:function(){return this.size.width},set:function(e){this.size.width=e}},{key:"height",get:function(){return this.size.height},set:function(e){this.size.height=e}},{key:"typoWidth",get:function(){return this.view.width-2*this.horizontalPadding}},{key:"range",get:function(){return{begin:this.textLineRanges.tree.begin,end:this.textLineRanges.tree.end}}},{key:"lastpage",get:function(){return this.layout_pages[this.pageCount-1]}},{key:"environment",get:function(){return"mobile"}},{key:"allpage_width",get:function(){return this.size.width}}]),t}(g.DOCLayout)},10075:function(e,t,n){"use strict";var i=n(13),o=n.n(i),a=n(8),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(554),d=n(1285),p=n(908),f=n(4976),g=n(1807),v=n(309),m=n(1639),_=n(324),y=n(1252),b=n(260),T={placeholderText:_i18n("applications.writer.components.other.DroplistControl.placeholderText", "Choose one.")},C=n(5747),k=n(1291),w=n(6125),S=n(5725),P=function(){function e(t,n,i){var o=this;l()(this,e),this.getActiveControlPointsMap=function(e){var t=e.begin,n=e.end,i=window.APP.isMobileMode(),a=e.isDropdownList||e.isComboBox?i?22:17:0,r=t+1,s=n-1,l=d.b.locate(o.data,r,!1,o.data.typoinfo),u=d.b.locate(o.data,s,!0,o.data.typoinfo),c=o.data.typoinfo.width,h=0;if(window.APP.isWebMode()&&(h=3),l&&l.line&&l.line.range.begin<=r&&u&&u.line&&u.line.range.end>=s){var f=l.line.papx.getPropVal("bidi"),g=l.line,v=u.line,m=0,_=0,b=0,T=0,C=p.a.getPosition2viewForMobile(g.parent),S=g.rect.top+C.y-h,P=g.rect.bottom+C.y+h;if(g===v){if(!g.glyphGroupInfos)return;var I=o.getEffectiveGlyphGroups(g,t,n),E=o.getMaxShowPosGlyphGroup(I),O=o.getMinShowPosGlyphGroup(I),x=E.widthSum;m=E.x+x+C.x+h,_=O.x+C.x-h,f?_-=a:m+=a,m=Math.min(m,c),_=Math.max(_,0);return f?[[{x:m,y:S},{x:m,y:P},{x:_,y:P},{x:_,y:S},{x:m,y:S}]]:[[{x:_,y:S},{x:m,y:S},{x:m,y:P},{x:_,y:P},{x:_,y:S}]]}var R=l&&l.line,N=R instanceof k.a?R.parent.parent.range:R.parent.range,A=N&&R.isInTable&&(t<N.pos||e&&e.level===w.a||(t===N.pos||e&&e.isRepeatItem&&t-1===N.pos)&&n>N.pos+N.len),D=A?o.data.typoinfo.collectTextLines({begin:t,end:n}):o.data.typoinfo.collectTextLines({begin:t,end:t+e.len-1}),M=A?D:D.filter((function(e){return e.range.end<=n})),L=p.a.getPosition2viewForMobile(v.parent);if(A&&(g=D&&D[0]&&D[0].host,v=D&&D[D.length-1]&&D[D.length-1].host,g&&v&&(L=p.a.getPosition2viewForMobile(v),C=p.a.getPosition2viewForMobile(g),S=g.rect.top+C.y-h,P=g.rect.bottom+C.y+h)),f){var F=Number.MAX_SAFE_INTEGER;M.forEach((function(e){if(e.glyphGroupInfos){var i=o.getEffectiveGlyphGroups(e,t,n),a=o.getMinShowPosGlyphGroup(i),r=p.a.getPosition2viewForMobile(e.parent).x+a.x;r<F&&(F=r)}})),_=Math.max(F-h,0);var B=o.getEffectiveGlyphGroups(g,t,n),H=o.getMaxShowPosGlyphGroup(B);m=Math.min(C.x+H.x+H.widthSum+h,c),B=o.getEffectiveGlyphGroups(v,t,n);var G=o.getMinShowPosGlyphGroup(B),W=o.getMaxShowPosGlyphGroup(B);T=L.x+G.x-h,T-=a,T=Math.max(T,0),b=L.x+W.x+W.widthSum+h}else{var j=Number.MIN_SAFE_INTEGER;M.forEach((function(e){if(e.glyphGroupInfos)if(e.isInTable){var i=e.parent.parent,a=p.a.getPosition2viewForMobile(i.parent);j=Math.max(a.x+i.rect.right,j)}else{var r=o.getEffectiveGlyphGroups(e,t,n),s=o.getMaxShowPosGlyphGroup(r),l=p.a.getPosition2viewForMobile(e.parent).x+s.x+s.widthSum;l>j&&(j=l)}})),m=Math.min(j+h,c);var U=void 0;if(g.layoutType===y.c.TableLine)_=Math.max(C.x-h,0);else{U=o.getEffectiveGlyphGroups(g,t,n);var V=o.getMinShowPosGlyphGroup(U);_=Math.max(C.x+V.x-h,0)}if(v.layoutType===y.c.TableLine)T=Math.max(L.x-h,0),b=L.x+v.rect.width+h+a;else{U=o.getEffectiveGlyphGroups(v,t,n);var Y=o.getMinShowPosGlyphGroup(U),z=o.getMaxShowPosGlyphGroup(U);T=Math.max(L.x+Y.x-h,0),b=L.x+z.x+h+a}}var K=v.rect.top+L.y+h,Z=v.rect.bottom+L.y+h;T===b&&(b+=.25*(Z-K)),b=Math.min(b,c);var X=[];return(!f&&_>b||f&&m<T)&&g.range.end===v.range.begin?(K-=2*h,X=f?[[{x:m,y:S},{x:m,y:P},{x:_,y:P},{x:_,y:S},{x:m,y:S}],[{x:T,y:K},{x:b,y:K},{x:b,y:Z},{x:T,y:Z},{x:T,y:K}]]:[[{x:_,y:S},{x:m,y:S},{x:m,y:P},{x:_,y:P},{x:_,y:S}],[{x:T,y:K},{x:b,y:K},{x:b,y:Z},{x:T,y:Z},{x:T,y:K}]]):(P-=2*h,X=f?[[{x:m,y:S},{x:m,y:P},{x:b,y:P},{x:b,y:Z},{x:T,y:Z},{x:T,y:K},{x:_,y:K},{x:_,y:S},{x:m,y:S}]]:[[{x:_,y:S},{x:m,y:S},{x:m,y:K},{x:b,y:K},{x:b,y:Z},{x:T,y:Z},{x:T,y:P},{x:_,y:P},{x:_,y:S}]]),X}return[]},Object(h.default)(this),this.doc=t,this.isTemplate=this.doc.isTemplate,this.selection=n,this.app=i,this.workspace=this.app.workspace,this.data=this.app.data,this.uilSquareManager=this.workspace.getFormatContentManager(),this.attachObserver(this.uilSquareManager),this.selection.attachObserver(this),this.apiEvent=new S.ContentControlsEvent(t)}return c()(e,[{key:"clearAll",value:function(e){this.unBindEvent(),this.detachObserver(this.uilSquareManager),this.selection.detachObserver(this),b.default.dispatchEvent(b.default.contentControls.RENDER_CONTROLS,[]),this.apiEvent.clearAll()}},{key:"onSelectionChanged",value:function(e,t){if(this.canShowContentControl&&t&&!t.activeContentControlUpdated){var n=this.data.selection.getNormalRange(),i=n.pos,o=n.len,a=this.getContentControlsByRange({pos:i,len:o},{isOperable:!0,isFlated:!0});Array.isArray(a)&&a.length>0?this.updateActiveControlInfoByPos(i):(!t.updateOnly||this.data.selection.activeCtrls.length>0)&&(this.clearActiveControls(!0),delete this.workspace.controllerRenderData)}}},{key:"bindEvent",value:function(){}},{key:"unBindEvent",value:function(){}},{key:"isOperableContentControl",value:function(e){return e.isRichText||e.isDropdownList||e.isDate||e.isPureText||e.isPicture||e.isComboBox||e.isCheckBox||e.isRepeatSec||e.isRepeatItem}},{key:"showAllBorderOfContentControls",value:function(){var e=this;if(this.canShowContentControl){var t=this.getAllOuterMostControls(),n=[],i=void 0;if(t.forEach((function(t){(i=e.getCombineControlInfo(t))&&n.push(i)})),n.length>0)return this.selection.activeCtrls=n,this.rePaint(),!0}}},{key:"getAllOuterMostControls",value:function(){var e=this.doc.getLimitedRange(0);return this.getContentControlsByRange(e,{isOperable:!0,isNonNested:!0,isAllowNestedInCatalog:!0})}},{key:"getAllControls",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.doc.getLimitedRange(0),i=this.getContentControlsByRange(n,{isOperable:!0,isFlated:e});return t||(i=i.filter((function(e){return!e.isRepeatSec}))),i}},{key:"getAllSubDocsControls",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=window.APP.data.doc.subdocs,i=[];return n.forEach((function(n){if(!t||0!==n.subdoc_type){var o={pos:n.subdoc_offset,len:n.subdoc_size-1};i=i.concat(e.getContentControlsByRange(o,{isOperable:!0}))}})),i}},{key:"getContentControlsByRange",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.isFlated||!1;delete n.isFlated;var o=this.doc.contentControls.collect(e.pos,e.len,i),a=window.__CONFIG__.wps.enableContentControlACL&&this.app.restrictEditHandler.isInRestrictEditMode;if(a&&(o=o.filter((function(e,n){return t.app.restrictEditHandler.allowEditContentControlByTag(e.data.getTag())}))),Object.keys(n).length>0){var r=n.isOperable,s=void 0===r||r,l=n.isNonNested,u=void 0!==l&&l,c=n.isAllowNestedInCatalog,h=void 0!==c&&c,d=n.isOnlyDropDownList,p=void 0!==d&&d,f=void 0;o=o.filter((function(e,n){var i=!0;if(p?i=e.isDropdownList:s&&(i=t.isOperableContentControl(e)),u){var o=h&&e.isCatalog;f&&!(e.begin>=f.end)||o?i=!1:f=e}return i}))}return o}},{key:"getOuterMostControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getContentControlsByRange({pos:e,len:0},{isOperable:!0,isNonNested:!0,isAllowNestedInCatalog:!0})[0];return t&&n&&n.isRepeatSec&&(n=this.getRepeatItem(e)||n),n}},{key:"getInnerMostControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getContentControlsByRange({pos:e,len:0},{isOperable:!0}),i=n[n.length-1];return t&&i&&i.isRepeatSec&&(i=this.getRepeatItem(e)||i),i}},{key:"getControlsByPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getContentControlsByRange({pos:e,len:0},{isOperable:!0,isFlated:t});return n}},{key:"isInvalidRangeInUnEditable",value:function(e,t){var n=e.pos,i=n,o=n+e.len;return i>t.begin&&o<t.end||i>=t.begin&&o>t.end||i<t.begin&&o<t.end}},{key:"checkIsEditable",value:function(e,t){var n=this,i={allowInsert:!0,allowDelete:!0,allowFormat:!0,allowComment:!0,allowInsertBookmark:!0,allowInsertDatetime:!0,allowInsertPic:!0};if(this.isTemplate)return i;var o=e,a=t;if(isNaN(o)||isNaN(a)){var r=this.selection.getNormalRange();o=r.pos,a=r.len}var s=this.getContentControlsByRange({pos:o,len:a}),l=o,u=o+a;s.length||0===a&&l>0&&this.data.doc.getText(l-1,1).charCodeAt(0)===_.e&&(s=this.getContentControlsByRange({pos:l-1,len:0}));return s.forEach((function(e){switch(!0){case l===e.begin&&u===e.end:e.lockContent&&(i.allowComment=!1,i.allowInsertDatetime=!1,i.allowInsertBookmark=!1,i.allowFormat=!1,i.allowInsertPic=!1),(e.isDropdownList||e.isPureText||e.isComboBox||e.isPicture||e.isCheckBox)&&(i.allowInsertDatetime=!1),e.isDropdownList&&n.app.restrictEditHandler.isInRestrictEditMode&&(i.allowInsert=!1,i.allowDelete=!1);break;case 0===a&&l===e.begin:case 0===a&&l===e.end:(e.lockContent||e.isDropdownList||e.isPureText||e.isComboBox||e.isPicture||e.isCheckBox)&&(i.allowComment=!1);break;case!(l<=e.begin&&u>=e.end):e.lockContent&&(i.allowInsert=!1,i.allowDelete=!1,i.allowComment=!1,i.allowInsertDatetime=!1,i.allowInsertBookmark=!1,i.allowInsertPic=!1,i.allowFormat=!1),e.isDropdownList?(i.allowInsert=!1,i.allowDelete=!1,i.allowComment=!1,i.allowInsertPic=!1,i.allowInsertDatetime=!1):e.isPicture?(i.allowInsert=!1,i.allowComment=!1,i.allowInsertDatetime=!1):e.isCheckBox?(i.allowInsert=!1,i.allowDelete=!1,i.allowComment=!1,i.allowInsertPic=!1,i.allowInsertDatetime=!1):(e.isPureText||e.isComboBox||e.isDate)&&(i.allowComment=!1,i.allowInsertPic=!1,i.allowInsertDatetime=!1)}})),i}},{key:"checkIsIncludeUnEditable",value:function(e,t){var n=this;if(this.isTemplate)return!1;var i=e,o=t;if(isNaN(i)||isNaN(o)){var a=this.selection.getNormalRange();i=a.pos,o=a.len}return this.getContentControlsByRange({pos:i,len:o}).some((function(e){return n.isInvalidRangeInUnEditable({pos:i,len:o},e)&&e.lockContent}))}},{key:"isInsideControlDefault",value:function(e){var t=this.getInnerMostControl(e,!0);return t&&this.checkIsDefaultContent(t)}},{key:"updateActiveControlInfoByHitResult",value:function(e){if(this.canShowContentControl)if(this.uilSquareManager.showAll)this.showAllBorderOfContentControls();else{var t=e.ctrlInfos,n=void 0===t?[]:t;n=n.filter(this.isOperableContentControl),this.updateActiveControlInfos(n)}}},{key:"clearActiveControls",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.selection.activeCtrls;t.length>0&&(t.length=0,e&&this.rePaint())}},{key:"rePaint",value:function(){this.workspace.refreshDryly()}},{key:"getMinShowPosGlyphGroup",value:function(e){if(!e||e.length<=0)return null;for(var t=e[0],n=0;n<e.length;++n)e[n].x<t.x&&(t=e[n]);return t}},{key:"getMaxShowPosGlyphGroup",value:function(e){if(!e||e.length<=0)return null;for(var t=e[0],n=0;n<e.length;++n)(e[n].x>t.x||e[n].x===t.x&&0===t.widthSum)&&(t=e[n]);return t}},{key:"getEffectiveGlyphGroups",value:function(e,t,n){var i=e.glyphGroupInfos,o=i.findIndex((function(n){return n.beginOffset+e.range.begin>=t})),a=i.findIndex((function(t){return t.beginOffset+e.range.begin>=n}));o===(a=a<0?i.length:a)&&a++;var s=i.slice(o,a);if(e.auto_num_pos&&e.auto_num){var l=this.getInnerMostControl(e.auto_num.gcp),u=e.range.begin;if(l&&(l.isRepeatSec||l.isRichText&&e.range.len<l.len)&&(u>=t||Array.prototype.every.call(this.doc.getText(u,t-u),(function(e){return e.charCodeAt()==_.d})))){var c=e.auto_num_pos,h=c.x,d=c.y,p=e.auto_num.offset;s=[{x:h,y:d,beginOffset:0,endOffset:1,widths:[p],widthSum:p,metrics:e.auto_num}].concat(r()(s))}}return s}},{key:"getActiveControlBelongingTextPage",value:function(e){var t=this.data.typoinfo.textLineRanges.findNodeContainPos(e.pos);return t&&Object(C.b)(t.line)}},{key:"_convertPosition2Number",value:function(e){return e instanceof Object?e.position:"number"==typeof e?e:null}},{key:"move2NextClosestController",value:function(e){if(this.isRestrictEditMode){var t=this._convertPosition2Number(e),n=null,i=this.getAllControls(!0),o=i.filter((function(e){return e.begin>t}));return(n=!o||o.length<=0?i[0]:o[0])?{begin:n.begin+1,end:n.end-1}:{begin:0,end:0}}}},{key:"move2BeforeClosestController",value:function(e){if(this.isRestrictEditMode){var t=this._convertPosition2Number(e),n=null,i=this.getAllControls(!0),o=i.filter((function(e){return e.end<=t||e.isRepeatItem&&e.begin<t-1}));if(n=!o||o.length<=0?i[i.length-1]:o[o.length-1])return{begin:n.begin+1,end:n.end-1}}}},{key:"move2LastController",value:function(){if(this.isRestrictEditMode){var e=this.getAllControls(!0);if(!(e.length<=0)){var t=e[e.length-1];return{begin:t.begin+1,end:t.end-1}}}}},{key:"move2FirstController",value:function(){if(this.isRestrictEditMode){var e=this.getAllControls(!0);if(!(e.length<=0)){var t=e[0];return{begin:t.begin+1,end:t.end-1}}}}},{key:"rangeSelectAutoAddDefaultFormatContent",value:function(e,t){if(this.isRestrictEditMode||this.isReadOnly||this.isTemplate||!this.isEditMode)return{result:!1};var n=this._convertPosition2Number(e),i=this._convertPosition2Number(t);if(!i)return{result:!1};if(0===n-i)return{result:!1};var o=n,a=i,r=!1;if(this.checkIsInContentControl(n)&&this.checkIsInContentControl(i))return{result:!1};if(this.checkIsInContentControl(n)){var s=this.getInnerMostControl(n,!0);this.checkIsDefaultContent(s)&&(r=!0,o=n<i?s.begin:s.end)}if(this.checkIsInContentControl(i-1)){var l=this.getInnerMostControl(i-1,!0);this.checkIsDefaultContent(l)&&(r=!0,a=n<i?l.end:l.begin)}return{result:r,begin:o,end:a}}},{key:"getTextControlFirstLine",value:function(e){if(this.canShowContentControl&&e instanceof f.a)return d.b.locate(this.data,e.begin,!1,this.data.typoinfo).line}},{key:"_getFormatControllerGlyphInfo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.range.pos,o=i+e.range.len;if(t<i||t>o)return null;for(var a=e.glyphGroupInfos,r=t-i,s=a.length,l=0;l<s;++l){var u=a[l],c=u.beginOffset,h=u.endOffset;if(h=n?h+1:h,r>=c&&r<h)return u}return null}},{key:"_getFormatControllerGCPPosition",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.range.pos,o=this._getFormatControllerGlyphInfo(e,t,n),a=o.x-e.rect.left,r=t-i-o.beginOffset,s=0,l=0;l<r;++l)s+=o.widths[l];var u=s+a,c=0;return{x:u,y:c}}},{key:"_getFormatControllerLineRect",value:function(e,t){if(e instanceof g.a&&t instanceof f.a){var n=e.range.pos,i=n+e.range.len,o=t.begin,a=t.begin+t.len;if(!(a<=n||o>=i)){var r=Math.max(o,n),s=Math.min(a,i),l=this._getFormatControllerGCPPosition(e,r),u=l.x,c=l.y,h=this._getFormatControllerGCPPosition(e,s,!0).x,d=e.rect.bottom-e.rect.top;return{left:u,top:c,right:h,bottom:c+(e.rect.bottom-e.rect.top),height:d}}}}},{key:"setPropertyForCtrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.canShowContentControl&&Object.keys(t).length){var n=this.getInnerMostControl(e);return n?this.app.editor.editContentControl(o()({pos:n.pos,len:n.len,type:n.type},t)):void 0}}},{key:"setCheckBoxChecked",value:function(e,t){if(this.canShowContentControl){var n=this.getInnerMostControl(e);if(n&&n.isCheckBox&&!n.lockContent){var i="boolean"==typeof t?t:!n.isChecked;return this.app.editor.editContentControl({pos:n.pos,len:n.len,type:n.type,isChecked:i})}}}},{key:"selectDroplistController",value:function(e,t,n){var i=this;if(!this.canShowContentControl)return Promise.reject();var o=this.getInnerMostControl(e);return o&&!o.lockContent?new Promise((function(e,a){i.app.editor.selectDropdownListEntry(o.pos,o.len,t,n,(function(){e(),i._dispatch("handleDropdownListControlItemChange",{pos:o.pos})}))||a()})):Promise.reject()}},{key:"insertController",value:function(e,t){if(!this.canShowContentControl)return!1;var n=e.pos,i=e.len,a=void 0===i?0:i,r=e.type,s=void 0===r?m.RichText:r,l=e.tag,u=e.title,c=e.placeholderText,h=e.args,d=void 0===h?{}:h,p=e.entries,f=e.displayFormat;p&&(d.entries=p);var g=c;if(!g)switch(s){case m.RichText:g=_i18n("applications.writer.core.shell.model.doc.contentControl.formatControlDefaultContent", "Click here to edit directly.");break;case m.DropdownList:g=T.placeholderText}if(void 0===n){var v=this.selection.selInfo.getSelectionInfo(),_=v.begin,y=v.end;n=_,a||(a=y-_)}return this.app.editor.addContentControl(o()({pos:n,len:a,type:s,title:u,tag:l,args:d,placeholderText:g},f?{displayFormat:f}:{}),t),!0}},{key:"insertContentControllers",value:function(e){if(!this.canShowContentControl)return!1;var t=this.selection.selInfo.getSelectionInfo(),n=t.begin,i=t.isPoint,o=t.containDrawing,a=this.doc.getSubDocType(n);return!(!i||o)&&(!this.checkIsInContentControl(n)&&(a!=v.Comment&&a!=v.Macro&&(this.app.editor.addContentControl({pos:n,len:0,type:m.RichText,title:void 0,tag:void 0,placeholderText:_i18n("applications.writer.core.shell.model.doc.contentControl.formatControlDefaultContent", "Click here to edit directly.")},e),!0)))}},{key:"insertDroplistControllers",value:function(e,t){if(!this.canShowContentControl)return!1;var n=this.selection.selInfo.getSelectionInfo(),i=n.begin,o=n.isPoint,a=n.containDrawing,r=this.doc.getSubDocType(i);return!(!o||a)&&(!this.checkIsInContentControl(i)&&(r!=v.Comment&&r!=v.Macro&&this.app.editor.addContentControl({pos:i,len:0,type:m.DropdownList,title:void 0,tag:void 0,placeholderText:T.placeholderText,args:{entries:e}},t)))}},{key:"insertRepeatSecItem",value:function(e,t){var n=e.pos,i=e.len,o=e.secItemPos,a=e.secItemLen;return this.app.editor.addRepeatSecItem({pos:n,len:i,secItemPos:o,secItemLen:a},t),!0}},{key:"deleteContentControllerByPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.canShowContentControl){var n=this.getInnerMostControl(e,!0);if(!n||n.lockControl)return!1;if(n.isRepeatItem){var i=n.parent;i&&i.pos+1===n.pos&&i.end-1===n.end&&(n=i)}this.app.editor.deleteContentControl(n.pos,n.len,t)}}},{key:"deleteContentController",value:function(e){this.canShowContentControl&&(e instanceof f.a?this.app.editor.deleteContentControl(e.pos,e.len):console.error("deleteContentController error, the input type is illegal"))}},{key:"checkPosIsInTextbox",value:function(e){return!!this.data.doc.textboxs.getTextbox(e)}},{key:"moveContentController2NewPosByController",value:function(e,t){return!!this.canShowContentControl&&(!!e&&(!this.app.restrictEditHandler.isInRestrictEditMode&&(!this.checkPosIsInController(e,t)&&(!!this.checkIsAllowInsertObjInControl(t).allowInsertNonNestControls&&void this.app.editor.moveContent({pos:e.pos,len:e.len,to:t,inherit:!(e.isRepeatSec||this.checkIsDefaultContent(e)),type:e.type})))))}},{key:"selectFirstControl",value:function(){var e=0,t=e,n=this.getAllControls()[0];n&&(e=this.getControllerBeginPos(n),t=this.getControllerEndPos(n)),this.selection.setPosition(e,t)}},{key:"getRepeatItem",value:function(e){return"number"!=typeof e?null:this.doc.repeatSecItems.findNearestControl(e)}},{key:"checkIsDefaultContent",value:function(e){if(!e)return!1;var t=this.doc,n=e.pos+1,i=e.len-1-1,o=t.getText(n,i);return e.isRichText?[e.data.private.placeholderText,_i18n("applications.writer.core.shell.model.doc.contentControl.formatControlDefaultContent", "Click here to edit directly.")].includes(o):e.isDropdownList?e.showPlcHdr||o===e.placeholderText:(e.isPureText||e.isDate||e.isComboBox||!!e.isRepeatItem)&&o===e.placeholderText}},{key:"getControllerEndPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return-1;var n=e.pos;return t?n+e.len:n+e.len-1}},{key:"getControllerBeginPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return-1;return t?e.pos:e.pos+1}},{key:"checkPosIsInController",value:function(e,t){var n=e.begin,i=n+e.len;return t>=n&&t<i}},{key:"contentControlsInitFinish",value:function(){this._dispatch("onContentControlsInitFinish")}},{key:"adjustCopyOrCutRange",value:function(){var e=this.selection.getNormalRange(),t=e.pos,n=e.len,i=this.app.formatContentController.getInnerMostControl(t),o=this.app.formatContentController.getInnerMostControl(t+n);if(i){var a=i.begin,r=i.end;a+1===t&&r-1<=t+n&&(e.pos=a,e.len++)}if(o){var s=o.begin;o.end-1===t+n&&s+1>=t&&e.len++}e.pos===t&&e.len===n||this.selection.setPosition(e.pos,e.pos+e.len)}},{key:"adjustCtrlSpecialRange",value:function(e,t,n){var i=this._convertPosition2Number(e),a=this._convertPosition2Number(t)||i;if(null===i||i!==a)return{result:!1};var r=void 0,s=void 0;if(n.isChangedByFuncKeys){var l=window.APP.data.doc.getDataLogic("final").getPap(i).getPropVal("bidi"),u=l&&("left"===n.funcKey?"right":"right"===n.funcKey&&"left")||n.funcKey,c=this.doc.getText(Math.max(i-1,0),2);0===i&&(c=" "+c);var h=c.charCodeAt(0),d=c.charCodeAt(1),p=[_.d,_.e],f=d===_.l&&h===_.e,g=p.includes(d)||f,v="left"===u&&h===_.d,m="right"===u&&h===_.d;if(g||v||m){var y=this.getInnerMostControl(i,!0);if(!y)return{result:!1};var b=y.isRepeatSec,T=y.isRepeatItem;if(!b&&!T)return{result:!1};var C=this.checkIsDefaultContent(y);if("left"===u){if(g&&b&&i!==y.pos||g&&T&&!l&&(i!==y.end-1||C)||v&&T&&i===y.pos+1&&C){var k=i-1;if(k<0)return{result:!1};if(r=s=k,b||T){var w=this.adjustCtrlSpecialRange(r,s,n);if(w.result)return w}}}else if("right"===u){if(g&&b&&i!==y.pos||g&&T&&!l&&(i!==y.end-1||C))if(r=s=i+1,b||T){var S=this.adjustCtrlSpecialRange(r,s,n);if(S.result)return S}}}}else if(n.isClick||n.updateOnly){var P=this.doc.getText(i,1).charCodeAt()===_.e?"left":"right",I=o()({},n,{isChangedByFuncKeys:!0,funcKey:P}),E=this.adjustCtrlSpecialRange(i,i,I);if(E.result)return E}return void 0!==r&&void 0!==s?{result:!0,begin:r,end:s}:{result:!1}}},{key:"getEmptyControlRange",value:function(e,t,n){var i=this;if(this.app.isReadOnly()||!this.isEditMode||this.isTemplate)return{result:!1};var a=this._convertPosition2Number(e),r=this._convertPosition2Number(t)||a,s=this.data.doc.revisions.getRevision(a);if(s&&"delete"===s.type)return{result:!1};var l=this.getInnerMostControl(a,!0),u=this.getInnerMostControl(r,!0),c=[],h=function(e){return c.some((function(t){return e[t]}))},d=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!i.checkIsDefaultContent(e)||t===e.pos)return!1;var o=n||h(e),a=o?0:1,r=o?0:1,s=e.pos+a,l=e.pos+e.len-r;return{begin:s,end:l}},p=!1,f=!!(a<r);if(l&&u&&l===u){if((a!==r||a!==l.pos)&&(p=f?d(u,r):d(l,a))&&n.isChangedByFuncKeys){var g=window.APP.data.doc.getDataLogic("final").getPap(l.pos).getPropVal("bidi");if("left"===n.funcKey&&a<=p.begin)if(g)this.selection.getNormalRange().len===l.len-1-1&&(p.begin=p.end=l.pos+l.len);else p.begin=p.end=l.pos;else if("right"===n.funcKey&&r>=p.end){if(g)this.selection.getNormalRange().len===l.len-1-1&&(p.begin=p.end=l.pos);else p.begin=p.end=l.pos+l.len}}}else{var v=d(l,a,!0),m=d(u,r,!0);v&&m?p=f?{begin:v.begin,end:m.end}:{begin:v.end,end:m.begin}:v?p=f?{begin:v.begin,end:r}:{begin:v.end,end:r}:m&&(p=f?{begin:a,end:m.end}:{begin:a,end:m.begin})}return p?o()({result:!0},p):{result:!1}}},{key:"insertEmptyDefaultContent",value:function(e,t){if(this.app.isReadOnly()||this.isTemplate)return!1;var n=this._convertPosition2Number(t),i=this._convertPosition2Number(e),o=this.getInnerMostControl(i,!0);if(!o)return!1;if(2!==o.len)return!1;if(n>=o.begin&&n<o.begin+o.len)return!1;if(o.type===m.DocpartObj)return!1;var a=o.placeholderText||"",r=o.isRichText?_i18n("applications.writer.core.shell.model.doc.contentControl.formatControlDefaultContent", "Click here to edit directly."):a;return this.app.editor.updatePlcHdrSync(o.pos+1,0,r),this.updateActiveControlInfoByPos(o.pos),this._dispatch("onInsertEmptyDefaultContent"),!0}},{key:"checkDeleteContentControllerForSelection",value:function(e,t){var n=this.getOuterMostControl(e);return!(!n||n.begin!==e||n.len!==t-e)}},{key:"checkIsInContentControl",value:function(e){return!!this.getOuterMostControl(void 0!==e?e:this.selection.begin.position)}},{key:"checkBeginAndEndInSameContentController",value:function(e,t){var n=this._convertPosition2Number(e),i=this._convertPosition2Number(t);return!!this.checkIsInContentControl(n)&&(!!this.checkIsInContentControl(i-1)&&this.getOuterMostControl(n)===this.getOuterMostControl(i-1))}},{key:"checkIsAllowInsertObjInControl",value:function(e){var t={},n=this.getInnerMostControl(e);return n?((n.isRepeatSec||n.isRichText||n.isCatalog)&&(t.allowInsertNonNestControls=!0,t.allowInsertObj=!0),e===n.pos&&(t.allowInsertNonNestControls=!1,t.allowInsertObj=!0)):(t.allowInsertNonNestControls=!0,t.allowInsertObj=!0),t}},{key:"findControlById",value:function(e){if(e)return this.doc.contentControls.findControlById(e)}},{key:"isWebTypoMode",get:function(){return this.app.isWebMode()}},{key:"currentUsedPage",get:function(){return this.workspace.currentUsedPage}},{key:"isRestrictEditMode",get:function(){return!this.isReadOnly&&this.app.restrictEditHandler.isInRestrictEditMode&&this.isEditMode}},{key:"isReadOnly",get:function(){return this.app.isReadOnly()}},{key:"isEditMode",get:function(){return this.app.isEditMode}},{key:"canShowContentControl",get:function(){return!this.isTemplate&&!this.isReadOnly&&this.isEditMode&&this.app.isFileOpened}}]),e}();t.a=P},1032:function(e,t,n){"use strict";n.d(t,"a",(function(){return R})),n.d(t,"c",(function(){return N})),n.d(t,"b",(function(){return A}));var i=n(24),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(22),c=n.n(u),h=n(145),d=n.n(h),p=n(23),f=n.n(p),g=n(411),v=n(400),m=n(2292),_=n(1807),y=n(2011),b=n(626),T=n(908),C=n(309),k=n(7207),w=n(4580),S=n(336),P=function(e){function t(e,n){var i=e.parent,o=e.viewPage,a=e.coorSystem,s=n.compose,l=n.mathLine,u=n.pageOffsetFromServer;r()(this,t);var h=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:o,coorSystem:a},{compose:s,textline:l,pageOffsetFromServer:u}));return h.math_page=null,h.isMathLine=!0,l&&h._initFromRawMathLine(l,u),h}return f()(t,e),l()(t,[{key:"_initFromRawMathLine",value:function(e,t){this.alignPoint=e.alignPoint,this.leftMargin=Object(S.Ti2Px)(e.leftMargin),this.rightMargin=Object(S.Ti2Px)(e.rightMargin),this.wrapIndent=Object(S.Ti2Px)(e.wrapIndent),this.ignoreWrapProp=e.ignoreWrapProp,this.cpMathEnd=e.cpMathEnd,this.pageRenderWidth=Object(S.Ti2Px)(e.pageRenderWidth),this.isCenterGroup=e.isCenterGroup,this.centerGroupOffset=Object(S.Ti2Px)(e.centerGroupOffset)}}]),t}(n(1291).b),I=n(1631),E=n(811),O=v.a.initByOriginAndSize({x:120,y:96},{width:554,height:931}),x=function(e){function t(e,n){var i=e.parent,o=e.viewPage,a=e.coorSystem,s=n.compose,l=n.textpage,u=n.pageOffsetFromServer,h=n.params;r()(this,t);var d=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:o,coorSystem:a}));return d.compose=s,d.lines=[],d.isInTable=i.isInTable,d.textflow=new m.a(0),d.isMoc?d._initMocPage(l):d._initFromRawData(l,u,h),d}return f()(t,e),l()(t,[{key:"isCoorSystem",value:function(){return!0}},{key:"_initMocPage",value:function(e){var t=e.range;this.rect=O,this._calculateTransposedCoordination();var n=new _.a({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem},{compose:this.compose,textline:{range:t}});this.lines.push(n)}},{key:"_initFromRawData",value:function(e,t){var n=this;e&&(null!=e.textFlow&&(this.textflow=new m.a(parseInt(e.textFlow))),null!=e.rect&&(this.rect=v.a.initByDocRect(e.rect)),this._calculateTransposedCoordination(),null!=e.lines&&(this.lines=[],e.lines.forEach((function(e,i){var o=void 0,a={parent:n,viewPage:n.viewPage,coorSystem:g.DOCCoorSystemType.TextPage};if(e.cells)o=new y.a(a,{compose:n.compose,tableline:e,pageOffsetFromServer:t});else if(e.isFrameLine){if(o=new k.a(a,{compose:n.compose,snippetLine:e,pageOffsetFromServer:t}),n.viewPage.shapeArray&&n.viewPage.shapeArray.length>0){var r=n.viewPage.shapeArray.find((function(e){return e instanceof w.a&&e.snippetPack.range.pos===o.range.pos&&e.snippetPack.range.len===o.range.len}));r&&(r.snippetLine=o)}}else if(e.isMathLine){if(o=new P(a,{compose:n.compose,mathLine:e,pageOffsetFromServer:t}),e.mathPage)return void e.mathPage.lines.forEach((function(e){n.lines.push(new _.a(a,{compose:n.compose,textline:e,pageOffsetFromServer:t}))}))}else o=new _.a(a,{compose:n.compose,textline:e,pageOffsetFromServer:t}),e.range.subdocType===C.Textbox&&(o.isTextboxLine=!0);n.lines.push(o)}))))}},{key:"_calculateTransposedCoordination",value:function(e){var t=this.rect,n=t.size,i=t.origin,o=t.left,a=t.top,r=i.x,s=i.y,l=!1,u=this.textflow;"T2B"===u.corX?(r=o+n.height,s=a,l=!0):"B2T"===u.corX&&(r=o,s=a+n.width,l=!0),l&&(this.rect=v.a.initByOriginAndSize(i,{width:n.height,height:n.width})),this.coororigin_pos2parent={x:r,y:s}}},{key:"term",value:function(){this.lines.forEach((function(e){e.term()}))}},{key:"calcBrokenInfo",value:function(){var e={},t=this.lines;if(!t||0==this.lines.length)return e;var n=t.findIndex((function(e){return e.isBrokenAfter}));return-1===n?e.lastUnbrokenLine=t[t.length-1]:(e.lastUnbrokenLine=t[n-1],e.brokenLines=t.slice(n)),e}},{key:"calcRepeatInfo",value:function(e,t){var n=this.lines,i=n.length,o=i?n[i-1]:null;if(o&&o.layoutType===g.DOCLayoutType.TableLine){for(var a=e.getDataLogic("final").specTable,r=a.getTapx(o.range.end-1),s=null,l=null,u=0,c=i-1;c>=0;--c){if(s=n[c],!(l=a.getTapx(s.range.end-1)).prop||Object(I.g)(r,l)){t.isOver=!0;break}s.isHeaderRow&&(t.repeatLines.unshift(s),u++,t.totalHeight+=s.rect.height)}t.isAllRepeatLine=n.length==u}}},{key:"heightAt",value:function(e){var t=void 0===e?this.lines.length:e;if(0===t)return 0;var n=this.lines[t-1],i=n.rect.bottom;return i+=n.border&&n.border.after_width||0,i+=n.after_space||0}},{key:"findSelLineInfos",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.lines.length,r=[],s=function(o){var a=n.lines[o];if(a.range.pos+a.range.len<=e)return"continue";if(a.range.pos>=t)return"break";if(i.isSupportSnippetLine){if(a.isSnippetLine){i.isOnlySupportSnippetLine=!0;var s=a.viewPage.layers.textframes,l=a.card||s.find((function(e){return e.snippetLine===a}));if(l)l.snippetPack.lines.forEach((function(n){if(n.layoutType===g.DOCLayoutType.TableLine){var o={line:n},a=n.findSelCellInfos(e,t,i);o.cellInfos=a,a.length>0&&r.push(o)}}))}else if(i.isOnlySupportSnippetLine)return{v:[]};if(void 0===a.tablecells&&!a.isSnippetLine||a.isLastRow)return{v:[]}}else if(void 0===a.tablecells||a.isLastRow)return{v:[]};var u={line:a},c=a.findSelCellInfos(e,t,i);u.cellInfos=c,c.length>0&&r.push(u)};e:for(var l=0;l<a;++l){var u=s(l);switch(u){case"continue":continue;case"break":break e;default:if("object"===(void 0===u?"undefined":o()(u)))return u.v}}return r}},{key:"getSelCellRanges",value:function(e,t,n,i,o,a){var r=this.lines.length;if(0===r)return!1;for(var s=null,l=null,u=0;u<r;++u){var c=this.lines[u];if(!s&&c===e){var h=c.getSelCellInfo(n);if(h.err)return!1;(s=h).lineIdx=u}if(!l&&c===t){var d=c.getSelCellInfo(i);if(d.err)return!1;(l=d).lineIdx=u;break}}if(!s||!l)return console.log("大哥，错了！"),!1;var p=o&&l.cellX>s.cellX||!o&&s.cellX>l.cellX;a.bReverseRg=p;for(var f=Math.min(s.cellX,l.cellX),g=Math.max(s.cellX+s.cellW,l.cellX+l.cellW),v=!1,m=s.lineIdx;m<=l.lineIdx;++m){var _=this.lines[m];if(void 0===_.tablecells)return!1;for(var y=_.tablecells.length,b=null,T=null,C=!1,k=!1,w=0;w<y;++w){var S=_.tablecells[w];if(!(Math.floor(S.rect.right)<=Math.floor(f))){if(Math.ceil(S.rect.left)>=Math.ceil(g))break;!b&&S.range&&(b=S,C=0===w),S.range&&(T=S,k=w===y-1)}}if(b&&T){v=!0;var P=T.range;p?a.rs.push({begin:P.pos+P.len,end:b.range.pos,bSelAllCell:C&&k}):a.rs.push({begin:b.range.pos,end:P.pos+P.len,bSelAllCell:C&&k})}}return v}},{key:"collectLinesByRect",value:function(e){if(!e.intersectStrict(this.rect))return[];return[]}},{key:"collectPendingLinesByRect",value:function(e){if(!e.intersectStrict(this.rect))return[];return[]}},{key:"getTextRect",value:function(){var e=this,t=void 0;if(0===this.lines.length)t=v.a.ZERO();else{var n=0,i=Number.MIN_SAFE_INTEGER;this.lines.forEach((function(t){n=Math.min(n,t.rect.left),t.layoutType===g.DOCLayoutType.TextLine?i=e.isUseTextpageWidth()?Math.max(i,Math.max(e.rect.right,t.rect.right)):Math.max(i,t.textWidth):t.layoutType===g.DOCLayoutType.TableLine&&(i=Math.max(i,t.rect.right))}));var o=this.lines[0],a=this.lines[this.lines.length-1],r=o.rect.top-o.before_space-o.border.before_width,s=a.isControlLine&&1!==this.lines.length?a.rect.top:a.rect.bottom+a.after_space+a.border.after_width;i-n<10&&(i=n+10),t=v.a.initByRawRect({left:n,right:i,top:r,bottom:s})}return t.offset(this.rect.left,this.rect.top),t}},{key:"cleanRenderInfo",value:function(){this.pendingLines&&this.pendingLines.forEach((function(e){e.cleanRenderInfo()})),this.lines&&this.lines.forEach((function(e){e.cleanRenderInfo()})),d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this)}},{key:"isUseTextpageWidth",value:function(){return!1}},{key:"position2parent",get:function(){return this.rect.origin}},{key:"offset4child",get:function(){return b.a.ZERO()}},{key:"layoutType",get:function(){return g.DOCLayoutType.TextPage}},{key:"origin",get:function(){return T.a.getPosition2coorsystem(this)}},{key:"firstline",get:function(){return this.lines[0]}},{key:"lastline",get:function(){return this.lines.length>0?this.lines[this.lines.length-1]:null}},{key:"range",get:function(){var e=this.lines.length;if(e){var t=this.lines[0].range.pos,n=this.lines[e-1].range;return{pos:t,len:n.pos+n.len-t}}return null}},{key:"textHeight",set:function(e){this._textHeight=e},get:function(){return void 0!==this._textHeight?this._textHeight:0}}],[{key:"initByParams",value:function(e){var n=e.context,i=e.params,o=new t({parent:n.parent,viewPage:n.viewPage,coorSystem:n.coorSystem},{compose:i.compose,textpage:i.textpage});return i.rect&&(o.rect=i.rect),i.textflow&&(o.textflow=i.textflow),o._calculateTransposedCoordination(),o}}]),t}(g.DOCLayout),R=(t.d=x,function(e){function t(e,n){var i=e.parent,o=e.viewPage,a=e.coorSystem,s=n.compose,l=n.cellpage,u=n.pageOffsetFromServer;r()(this,t);var h=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:o,coorSystem:a},{compose:s,textpage:l,pageOffsetFromServer:u}));return h.isInTable=!0,h}return f()(t,e),l()(t,[{key:"layoutType",get:function(){return g.DOCLayoutType.CellPage}}]),t}(x)),N=function(e){function t(e,n){var i=e.parent,o=e.viewPage,a=e.coorSystem,s=n.compose,l=n.textpage,u=n.pageOffsetFromServer;r()(this,t);var h=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:o,coorSystem:a},{compose:s,textpage:l,pageOffsetFromServer:u}));return h.isInTextFrame=!0,h}return f()(t,e),l()(t,[{key:"isUseTextpageWidth",value:function(){var e=!1;if(!this.isInTable&&1===this.lines.length&&this.compose&&this.range){var t=this.compose.doc.getDataLogic("final").getPapx(this.range.pos);if(t&&t.prop)t.prop.getPropVal("horizontal_align_mode")===E.i.FullAdjustify&&(e=!0)}return e}},{key:"layoutType",get:function(){return g.DOCLayoutType.TextPage}}]),t}(x),A=function(e){function t(e,n){var i=e.parent,o=e.viewPage,a=e.coorSystem,s=n.compose,l=n.notePage,u=n.pageOffsetFromServer;return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:o,coorSystem:a},{compose:s,textpage:l,pageOffsetFromServer:u}))}return f()(t,e),l()(t,[{key:"layoutType",get:function(){return g.DOCLayoutType.FootEndNotePage}}]),t}(x)},1033:function(e,t,n){"use strict";n.r(t),n.d(t,"Font_Bold",(function(){return i})),n.d(t,"Font_Italic",(function(){return o})),n.d(t,"Font_Underline",(function(){return a})),n.d(t,"Font_StrikeThrough",(function(){return r})),n.d(t,"Font_FontSize",(function(){return s})),n.d(t,"Font_GrowUp",(function(){return l})),n.d(t,"Font_Superscript",(function(){return u})),n.d(t,"Font_Subscript",(function(){return c})),n.d(t,"Font_Name",(function(){return h})),n.d(t,"Font_Color",(function(){return d})),n.d(t,"Para_ChangeIndent",(function(){return p})),n.d(t,"Para_Alignment",(function(){return f})),n.d(t,"Style_ApplyToRange",(function(){return g})),n.d(t,"Para_LineSpacing",(function(){return m})),n.d(t,"Para_LineSpacingRel",(function(){return v})),n.d(t,"Para_ChangeFirstLineIndent",(function(){return _})),n.d(t,"List_ApplyToRange",(function(){return y})),n.d(t,"Para_RemoveIndent",(function(){return b})),n.d(t,"Para_Borders",(function(){return T})),n.d(t,"Auto_Number_Continue",(function(){return C})),n.d(t,"Auto_Number_Restart",(function(){return k})),n.d(t,"Table_ApplyStyle",(function(){return w})),n.d(t,"Table_CellAlignment",(function(){return S})),n.d(t,"Table_FormatAlignment",(function(){return O})),n.d(t,"Font_AllCaps",(function(){return x})),n.d(t,"Font_SmallCaps",(function(){return R})),n.d(t,"Font_DoubleStrikeThrough",(function(){return N})),n.d(t,"Font_EmphasisMark",(function(){return A})),n.d(t,"Font_Hidden",(function(){return D})),n.d(t,"Font_Scaling",(function(){return M})),n.d(t,"Font_Spacing",(function(){return L})),n.d(t,"Font_Para_ClearFormat",(function(){return F})),n.d(t,"Font_HighlightColor",(function(){return B})),n.d(t,"Para_ReadingOrder",(function(){return H})),n.d(t,"Para_LeftIndentAbsAndRef",(function(){return G})),n.d(t,"Para_FirstLineIndentAbsAndRef",(function(){return W})),n.d(t,"Para_RightIndentAbsAndRef",(function(){return j})),n.d(t,"Para_SpaceBeforeAbsAndRef",(function(){return U})),n.d(t,"Para_SpaceAfterAbsAndRef",(function(){return V})),n.d(t,"Para_OutlineLevel",(function(){return Y})),n.d(t,"Para_FarEastLineBreakControl",(function(){return z})),n.d(t,"Para_WordWrap",(function(){return K})),n.d(t,"Para_HangingPunctuation",(function(){return Z})),n.d(t,"Para_HalfWidthPunctuationOnTopOfLine",(function(){return X})),n.d(t,"Para_AddSpaceBetweenFarEastAndAlpha",(function(){return q})),n.d(t,"Para_AddSpaceBetweenFarEastAndDigit",(function(){return J})),n.d(t,"Para_ClearLayout",(function(){return Q})),n.d(t,"Sec_Margins",(function(){return $})),n.d(t,"Sec_PageOrientation",(function(){return ee})),n.d(t,"Sec_PageSize",(function(){return te})),n.d(t,"Sec_LineNumbering",(function(){return ne})),n.d(t,"Table_CellFillColor",(function(){return P})),n.d(t,"Table_RepeatHeader",(function(){return I})),n.d(t,"Table_OutSideBorder",(function(){return E})),n.d(t,"Symbol_Char",(function(){return ie}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7,h=8,d=9,p=10,f=11,g=12,v=13,m=13,_=14,y=15,b=16,T=17,C=18,k=19,w=21,S=22,P=23,I=24,E=25,O=26,x=50,R=51,N=52,A=53,D=54,M=55,L=56,F=98,B=99,H=100,G=101,W=102,j=103,U=104,V=105,Y=106,z=107,K=108,Z=109,X=110,q=111,J=112,Q=114,$=200,ee=201,te=202,ne=203,ie=204},1048:function(e,t,n){var i=n(1049),o=n(563),a=n(985),r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(o(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var n=s.test(e);return n||l.test(e)?u(e.slice(2),n?2:8):r.test(e)?NaN:+e}},1049:function(e,t,n){var i=n(1050),o=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(o,""):e}},1050:function(e,t){var n=/\s/;e.exports=function(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}},10863:function(e,t,n){"use strict";n.r(t),n.d(t,"DOCApplicationPC",(function(){return Fe})),n.d(t,"createApp",(function(){return Be}));var i=n(80),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(22),c=n.n(u),h=n(145),d=n.n(h),p=n(23),f=n.n(p),g=n(10011),v=n(10006),m=n(10061),_=n(7760),y=n(7761),b=n(3862),T=n(5742),C=function(e){function t(e,n){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return f()(t,e),l()(t,[{key:"initTypoinfo",value:function(){if(window.APP.isWebMode()){this.typoinfo=new m.a(this,this.compose,this.naked_data.typoInfo);var e=this.doc.getDataLogic("final");this.doc.datalogics.final=_.a.adapt(e)}else this.typoinfo=new y.a(this,this.compose,{typoInfo:this.naked_data.typoInfo})}},{key:"getHeaderfooterLeftShowTip",value:function(e,t){var n="",i=t?_i18n("applications.writer.components.core.shell.docData.header", "Header"):_i18n("applications.writer.components.core.shell.docData.footer", "Footer"),o="";if(!e||e instanceof b.a)return i;var a=void 0,r=e.range;return r&&(a=this.doc.sections.getSection(r.pos)),void 0===a?i:(e.isSecFirstPage&&a.isFirstDiff()?n=_i18n("applications.writer.components.core.shell.docData.index", "First Page")+" ":a.isOddEvenDiff()&&(n=e.pageNum%2?_i18n("applications.writer.components.core.shell.docData.odd", "Odd Page"):_i18n("applications.writer.components.core.shell.docData.even", "Even Page"),n+=" "),this.doc.sections.isOnlyOneSection()||(o=(o=" -"+_i18n("applications.writer.components.core.shell.docData.secIndex", "Section {0}")+"-").replace("{0}",e.sectionIndex+1)),n+i+o)}},{key:"getHeaderfooterRightShowTip",value:function(e,t){if(!e||e instanceof b.a||0===e.sectionIndex)return"";var n=void 0,i=e.range;if(i&&(n=this.doc.sections.getSection(i.pos)),void 0===n)return"";var o=T.g(t,e.isSecFirstPage&&n.isFirstDiff(),e.pageNum%2==0&&n.isOddEvenDiff());return n.getHeaderFooterRange(o)?"":_i18n("applications.writer.components.core.shell.docData.same", "Same As Previous")}}]),t}(v.a),k=n(260),w=n(14),S=n(167),P=n(13),I=n.n(P),E=n(10042),O=n(8),x=n.n(O),R=n(310),N=n(10033),A=n(676),D=function(){function e(t,n,i){r()(this,e),this.app=t,this.container=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-coop-sel-tip",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.container})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e,t,n,i){var o;o={content:n,style:{backgroundColor:i},left:t.left,top:t.top,visible:e},window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.CoopSelTip(o),this._element)}}]),e}(),M={instant:100,long:1e3},L=function(){function e(t,n,i){r()(this,e),this.workspace=t,this.container=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-page-num-tip",style:"position: fixed; right: 0; top: 0; width: 0px; height: 0px; overflow: visible;",parent:n}),this._isEnable=!S.isIE&&!S.isFirefox}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element),clearTimeout(this._hideHandler),this._hideHandler=null}},{key:"getPageNumTip",value:function(e){this._visible=!!e;var t=this.layout,n=t.y,i=t.right,o=t.content;return window.APP.frontUtil.PageNumTip({top:n,right:i+10,content:o,visible:e})}},{key:"update",value:function(){var e=window.APP.workspace.element;this._isEnable&&e.scrollHeight!==e.offsetHeight&&(window.APP.frontUtil.ReactDom.render(this.getPageNumTip(!0),this._element),clearTimeout(this._hideHandler),this._hideHandler=null)}},{key:"delayHideIfNeeded",value:function(e){var t=this;this._visible&&!this._hideHandler&&(clearTimeout(this._hideHandler),this._hideHandler=setTimeout((function(){window.APP.frontUtil.ReactDom.render(t.getPageNumTip(!1),t._element),t._hideHandler=null}),M[e]||M.long))}},{key:"layout",get:function(){var e=this.workspace.config.zoom,t=this.container.cacheDOMAttr.scrollTop,n=this.container.cacheDOMAttr.clientHeight,i=this.container.scrollHeight,o=t+n/2,a=this.data.typoinfo.stablePageCount,r=0,s=this.data.typoinfo.page_heights.findIndex((function(t){return(r+=t*e)>o}));s<0&&(s=a-1);var l=s+1+"/"+a,u=Math.max(n/i*n,24),c=(i-n)/(n-u)||1,h=this.container.cacheDOMAttr.rect;return{y:h.top+t/c+u/2,right:document.body.cacheDOMAttr.clientWidth-h.right,content:l}}}]),e}(),F=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-table-float-menu",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"shouldComponentUpdate",value:function(e){var t=!1,n=e;return this._props?(n=I()({},this._props,e),t=JSON.stringify(n)!==JSON.stringify(this._props)):t=!0,this._props=n,t}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.shouldComponentUpdate(e)||t){var n=t?I()({},this._props,e):this._props;window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.TableFloatMenus(n),this._element)}}}]),e}(),B=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-content-menu",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"_beforeUpdateProcessData",value:function(e){var t=[],n=e.blockRects;return n&&(Object.keys(n).forEach((function(e){for(var i=n[e].entries(),o=i.next();!o.done;){var a=o.value[1];t=t.concat([].concat(x()(a))),o=i.next()}})),e.blockRects=t),e}},{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){var t=this._beforeUpdateProcessData(e);window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.ContentBlockFloatMenus(t),this._element)}}]),e}(),H=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-date-time-float-menu",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.DateTimeConfig(e),this._element)}}]),e}(),G=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-catalog-float-menu",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.CatalogFloatMenus(e),this._element)}}]),e}(),W=n(1639),j=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-control-property-wrap",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){var t=e.controller;if(t)switch(t.ctrl.type){case W.RichText:window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.DOCContentControllerProperty(e),this._element);break;case W.DropdownList:case W.ComboBox:window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.DOCDroplistControllerProperty(e),this._element)}}}]),e}(),U=n(1285),V=n(309),Y=n(10025),z=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-draw-resize-wrap",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.DrawingResizer(e),this._element)}}]),e}(),K=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-draw-preview-wrap",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.DrawingPreviewer(e),this._element)}}]),e}(),Z=n(547),X=function(){function e(){r()(this,e),this.config={softKeep:!1,hardKeep:!1},this.cursorType=""}return l()(e,[{key:"updateCursorType",value:function(e,t){return t?(this.cursorType=e,this.config=I()({},this.config,t),this.cursorType):this.config.hardKeep?this.cursorType:this.config.softKeep?e===Z.cursorTypes.default||e===Z.cursorTypes.text||e===Z.cursorTypes.vertical_text?this.cursorType:e:(this.cursorType=e,this.cursorType)}}]),e}(),q=n(908),J=n(1804),Q=n(7769),$=n(805),ee=n(6123),te=function(e){function t(e,n,i){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return o.handleInputFocusInIpad=function(){o.preFocusTime=Date.now(),o.app.appApi.isKeyboardActive=!0},o.handleInputBlurInIpad=function(){o.preBlurTime=Date.now(),o.app.workspace.switchIndicatorState(!1),o.app.appApi.isKeyboardActive=!1},o.handleInputFocusInPC=function(){o.app.workspace.switchIndicatorState(!0)},o.handleInputBlurInPC=function(){o.app.workspace.switchIndicatorState(!1)},o.handleKeydownInIpad=function(e){if(S.isPad){if("Meta"===e.key)return void(o.isReadOnly||(o.setReadOnly(!0),o.isReadOnly=!0));if(o.isReadOnly){if("CapsLock"===e.key||!0===e.metaKey&&ee.a.isMatch(e))return;o.setReadOnly(!1),o.isReadOnly=!1}}},o.setReadOnly=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?o.input.setAttribute("readonly","readonly"):o.input.removeAttribute("readonly")},o.isReadOnly=!1,o.isFocusOther=!1,o}return f()(t,e),l()(t,[{key:"clearAll",value:function(){S.isPad?(this.input.removeEventListener("focus",this.handleInputFocusInIpad),this.input.removeEventListener("blur",this.handleInputBlurInIpad),this.input.removeEventListener("keydown",this.handleKeydownInIpad)):(this.input.removeEventListener("focus",this.handleInputFocusInPC),this.input.removeEventListener("blur",this.handleInputBlurInPC))}},{key:"setupInput",value:function(){var e=this;d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setupInput",this).call(this),S.isMacOs&&S.isSafari&&(this.input.setAttribute("type","text"),this.input.setAttribute("name","search")),requestAnimationFrame((function(){S.isPad?(e.input.addEventListener("focus",e.handleInputFocusInIpad),e.input.addEventListener("blur",e.handleInputBlurInIpad),e.input.addEventListener("keydown",e.handleKeydownInIpad)):(e.input.addEventListener("focus",e.handleInputFocusInPC),e.input.addEventListener("blur",e.handleInputBlurInPC))}))}},{key:"_extendInputStyle",value:function(e){S.isIE?e["font-size"]=0:S.isPad&&(e["font-size"]="1px",e.opacity="0")}},{key:"_getInputTop",value:function(){return-100}},{key:"update",value:function(e){var n=d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e);if(null!==n){var i=this._updateCalculateLeft(n.pos),o=this._updateCalculateTop(n.pos),a=this.app.workspace.getZoomDiff();return Object($.assignStyle)(this.input,this._style,{left:i+a+"px",top:o+"px"}),this.input.style.top}}},{key:"focus",value:function(){var e=this.app.workspace.isEditable();this.isFocusOther&&e||((S.isEdge||S.isIE)&&window.focus(),this.app.isReadOnly()||(S.isPad?(this.preBlurState=!1,S.isPadMiniProgram&&!this.app.appApi.isKeyboardActive&&Object($.focusOnOtherInput)(),this.input.focus()):document.activeElement!==this.input&&this.input.focus()),this.app.appApi.isKeyboardActive=!0)}},{key:"blur",value:function(){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"blur",this).call(this),this.input.blur(),this.app.appApi.isKeyboardActive=!1}},{key:"isPreBlur",value:function(){return S.isPad?(this.preBlurState=this.preBlurState||!this.preFocusTime||Date.now()-this.preBlurTime>50||Date.now()-this.preFocusTime<100,this.preBlurState):(console.error("该接口仅用于IPad的判断"),!1)}},{key:"IsFocusOther",set:function(e){this.isFocusOther=e},get:function(){return this.isFocusOther}}]),t}(Q.a),ne=n(7138),ie=n(5746),oe=n(1737),ae=S.isMobile?16:24,re=S.isMobile?4:8,se=function(e){function t(e,n,i,o){r()(this,t);var a=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));a.app=e,a._element=document.createElement("div"),a._element.className="bookmark-item",a._baseIndex=10,a.time=100,a.bookmarkName=o;var s={width:ae+"px",height:ae+"px",position:"absolute",left:0,top:0,"z-index":a._baseIndex};a._element.setAttribute("title",_i18n("applications.writer.components.core.app.selection.bookmarkItem.bookmark", "Bookmark")),Object($.assignStyle)(a._element,a._style,s),a.container.appendChild(a._element);var l=window.APP.frontUtil;l.ReactDom.render(l.Icon({type:l.IconTypes.size24.wps_bookmark_item,className:"bookmark-item-icon"}),a._element);var u=new oe.a(a.app.data.selection,i.pos),h=a.app.data.typoinfo.getLeftInfo(u.pos.layoutIndex);return a.setPos(i,h,!0,a.app.workspace.config.zoom,o),a}return f()(t,e),l()(t,[{key:"clearAll",value:function(){this.reset(),window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"hide",value:function(){var e=this;this._element.classList.add("fade-out"),this._fadeoutHandler&&clearTimeout(this._fadeoutHandler),this._fadeoutHandler=setTimeout((function(){e.reset()}),this.time)}},{key:"reset",value:function(){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this._element.classList.remove("fade-out"),this._fadeoutHandler&&clearTimeout(this._fadeoutHandler),this.isVisible=!1,this.container.classList.remove("bookmark-show")}},{key:"update",value:function(){if(this.isVisible){var e=this.app.data.doc.bookmarks.map[this.bookmarkName].pos;this.app.data.doc.getSubDocType(e)===V.Comment&&(e=this.app.data.doc.comments.getCommentByBookmarkPos(e).pos);var t=new oe.a(this.app.data.selection,e),n=this.app.data.typoinfo.getLeftInfo(t.pos.layoutIndex);this.setPos(t,n,!0,this.app.workspace.config.zoom,this.bookmarkName)}}},{key:"setPos",value:function(e,t,n){var i=arguments[4];this.bookmarkName=i;var o=this.app.data.typoinfo.getPosition(e.pos).pos,a=this.app.data.typoinfo.viewOffset.y;if(o){n||this.reset();var r=Math.ceil(ae),s=Math.ceil(o.posX),l=Math.ceil(o.posY-a),u=Math.ceil(o.height),c=t.outerLeft,h=t.innerLeft;l+=(u-r)/2,s=(c=Math.ceil(c))+(h=Math.ceil(h))-r-re,Object($.assignStyle)(this._element,this._style,{width:r+"px",height:r+"px","border-radius":r/2+"px",left:s-20+"px",top:l+"px"}),this.isVisible=!0,this.container.classList.add("bookmark-show")}else this.reset()}}]),t}(ie.a),le=n(6124),ue=n(1238),ce=n(4977),he=function(){function e(t){var n=this;r()(this,e),this.getBookmarks=function(){var e=n.bookmarks.rangeClass.map(),t=n.bookmarks.map,i=[];return e.forEach((function(o,a){e[a].name&&t[e[a].name]&&!t[e[a].name].isPrivate&&(t[e[a].name]&&t[e[a].name].index||n.addBookmarkIndex(t[e[a].name]),i.push({name:e[a].name,pos:e[a].pos,len:e[a].len,subDocType:n.doc.getSubDocType(e[a].pos),index:t[e[a].name].index}))})),n.data=i,i},this.addBookmarkIndex=function(e){var t=e.name.indexOf(_i18n("applications.writer.components.CommandBars.TaskPane.BookmarkPanel.bookmark", "Bookmark")),i=e.name.indexOf("：");if(0===t&&i>2){var o=e.name.substring(t+2,i),a=parseInt(o);o==a&&(n.bookmarks.map[e.name].index=a)}else n.bookmarks.map[e.name].index=1e4},this.getCount=function(){return n.data.length},this.handlePosBookmark=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.pos,a=e.len,r=n.app.data.doc.getSubDocType(i),s=n.app.workspace.domScaleContainer;if(k.default.dispatchEvent(k.default.comments.INACTIVE_COMMENT),r===V.Comment){var l=n.doc.comments.getCommentByBookmarkPos(i);k.default.dispatchEvent(k.default.comments.ACTIVE_COMMENT_BY_RANGE,{range:l,type:"bookmark"}),i=l.pos,a=l.len,n.isActiveComment=!0}else k.default.dispatchEvent(k.default.comments.ACTIVE_COMMENT_BY_RANGE,{range:{pos:i,len:a},type:"bookmark"});var u=n.bookmarks.map[e.name];if(u&&u.data&&u.data.private&&u.data.private.column){var c=u.data.private.column;c.start>0&&c.start===c.end&&(u.tapx||(u.tapx=n.app.data.doc.getDataLogic("final").specTable.getTapx(i)),i=u.tapx.cellDatas[c.start-1].begin,a=u.tapx.cellDatas[c.start-1].end-i)}"_top"===e.name&&(i=0,a=0);var h,d={pos:i,len:a},p=Object(ue.typoToPositionWithLoading)(i+a);p.then((h=o()(regeneratorRuntime.mark((function o(r){var l,u;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,n.app.data.selection.selCoop.locate(t.isInCatalogs?i:r,{delaySetPosition:p.isPoll?400:0,isClick:!1});case 2:k.default.dispatchEvent(k.default.comments.ACTIVE_COMMENT_BY_RANGE,{range:{pos:i+a-(a>0?1:0),len:0},type:"bookmark"}),t.isInCatalogs||(n.bookmarkItem?(l=new oe.a(n.app.data.selection,i),u=n.app.data.typoinfo.getLeftInfo(l.pos.layoutIndex),n.bookmarkItem.reset(),n.bookmarkItem.setPos(d,u,!0,n.app.workspace.config.zoom,e.name)):n.bookmarkItem=new se(n.app,s,d,e.name)),window.APP.data.selection.selCoop.showDefaultHighLight({len:a,pos:i}),setTimeout((function(){n.bookmarkItem&&n.bookmarkItem.hide()}),2e3);case 6:case"end":return o.stop()}}),o,n)}))),function(e){return h.apply(this,arguments)}),(function(){}))},this.app=t,this.doc=t.data.doc,this.bookmarks=this.doc.bookmarks,this.data=[],this.doc.attachObserver(this),this.bookmarks.attachObserver(this),this.debouncePosBookmark=window.utils.Lodash.debounce(this.handlePosBookmark,150),this.sort=ce.h.rankByDocPos}var t;return l()(e,[{key:"onBookmarksChange",value:function(e,t){k.default.dispatchEvent(k.default.bookmark.ON_BOOKMARKS_CHANGE,{bookmark:t})}},{key:"onInsertText",value:function(e,t,n){k.default.dispatchEvent(k.default.bookmark.ON_BOOKMARKS_CHANGE)}},{key:"onDeleteText",value:function(e,t,n){k.default.dispatchEvent(k.default.bookmark.ON_BOOKMARKS_CHANGE)}},{key:"insertBookmark",value:function(e){this.app.editor.insertBookmark(e)}},{key:"deleteBookmark",value:function(e){this.app.editor.deleteBookmark(e)&&this.app.data.doc.bookmarks.map[e.name]&&this.bookmarkItem&&e.name===this.bookmarkItem.bookmarkName&&(this.bookmarkItem.clearAll(),this.bookmarkItem=null)}},{key:"getFileDownloadId",value:(t=o()(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.app.dispatch(Object(le.getFileDownloadId)(t,"wps"));case 2:if(n=e.sent,"ok"!==(i=n.response&&n.response.body).result){e.next=6;break}return e.abrupt("return",i.uploadid);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSort",value:function(){return this.sort}},{key:"setSort",value:function(e){this.sort=e}}]),e}(),de=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({classname:"float-menu",type:"div",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.SelectivePasteFloatMenu(e),this._element)}}]),e}(),pe={"cursor-default":"default","cursor-text":"text","cursor-normal":"crosshair","cursor-move":"move","cursor-move-big":"move","cursor-select":"crosshair","cursor-col-resize":"col-resize","cursor-row-resize":"row-resize","cursor-nw-resize":"nw-resize","cursor-n-resize":"n-resize","cursor-ne-resize":"ne-resize","cursor-w-resize":"w-resize","cursor-sw-resize":"sw-resize","cursor-s-resize":"s-resize","cursor-se-resize":"se-resize","cursor-e-resize":"e-resize","cursor-ns-resize":"ns-resize","cursor-ew-resize":"ew-resize","cursor-nesw-resize":"nesw-resize","cursor-nwse-resize":"nwse-resize","cursor-row-select":"pointer","cursor-col-select":"pointer"},fe={"cursor-cell-select":"ne-resize","cursor-right":"pointer","cursor-down":"pointer"},ge=n(11105),ve=n.n(ge),me=n(984),_e=n(227),ye=function(){function e(t){r()(this,e),this._autoOpen=!1,this._spellCheckManager=t,this._handleOnDocAfterOpen=this._handleOnDocAfterOpen.bind(this),this._handleFilePermissions=this._handleFilePermissions.bind(this),this._handleRestrictStateChange=this._handleRestrictStateChange.bind(this),this._handleViewModeChanged=this._handleViewModeChanged.bind(this),this._blindEvent()}return l()(e,[{key:"_blindEvent",value:function(){window.addEventListener(k.default.document.ON_DOC_AFTER_OPEN,this._handleOnDocAfterOpen),window.addEventListener(_e.default.names.file.SET_FILE_PERMISSIONS,this._handleFilePermissions),window.addEventListener(k.default.restrictEdit.ON_RESTRICT_STATE_CHANGE,this._handleRestrictStateChange),window.addEventListener(k.default.view.AFTER_VIEW_MODE_CHANGED,this._handleViewModeChanged)}},{key:"_unBlindEvent",value:function(){window.removeEventListener(k.default.document.ON_DOC_AFTER_OPEN,this._handleOnDocAfterOpen),window.removeEventListener(_e.default.names.file.SET_FILE_PERMISSIONS,this._handleFilePermissions),window.removeEventListener(k.default.restrictEdit.ON_RESTRICT_STATE_CHANGE,this._handleRestrictStateChange),window.removeEventListener(k.default.view.AFTER_VIEW_MODE_CHANGED,this._handleViewModeChanged)}},{key:"_handleOnDocAfterOpen",value:function(){this._prepareResouce()}},{key:"_handleFilePermissions",value:function(e){e.detail.edit&&!this.isAutoOpen&&this._prepareResouce()}},{key:"_handleRestrictStateChange",value:function(){this._handleSpellCheckSwitch()}},{key:"_handleViewModeChanged",value:function(){this._prepareResouce()}},{key:"_handleSpellCheckSwitch",value:function(){var e=this.canOpenCheck();e!==this._spellCheckManager.isOpened&&this._spellCheckManager.open(e)}},{key:"canOpenCheck",value:function(){var e=this._spellCheckManager.workspace.app.restrictEditHandler.isInRestrictEditMode,t=this.isAutoOpen;return!e&&t}},{key:"unLoadResource",value:function(){this._unBlindEvent()}},{key:"_prepareResouce",value:function(){this._spellCheckManager.workspace.app.isReadOnly()||me.getStatus(me.types.SPELLCHECKAUTOOPEN,!0)&&(this.autoOpen(!0),window.collection("commandbar","click","review|checkspelling_refresh"))}},{key:"autoOpen",value:function(e){e!==this._autoOpen&&me.setStatus(me.types.SPELLCHECKAUTOOPEN,e,!0),this._autoOpen=e,this._handleSpellCheckSwitch()}},{key:"isAutoOpen",get:function(){return this._autoOpen}}]),e}(),be=function(){function e(t){r()(this,e),this._isOpen=!1,this.checkCore=null,this.spellCheckSwitch=null,this.workspace=t}return l()(e,[{key:"init",value:function(){this.spellCheckSwitch=new ye(this)}},{key:"open",value:function(e){var t=this;!this.isOpened&&e?this._startLoadComponents().then((function(){t._isOpen=e,k.default.dispatchEvent(k.default.spellCheck.OPEN)})):this.isOpened&&!e&&(this._isOpen=e,this._unLoadComponents(),k.default.dispatchEvent(k.default.spellCheck.CLOSE))}},{key:"clear",value:function(){this.open(!1),this.spellCheckSwitch.unLoadResource(),this.spellCheckSwitch=null}},{key:"_startLoadCheckComponentCore",value:function(){return new Promise((function(e){ve()((function(t){e(t)}))}))}},{key:"_startLoadComponents",value:function(){var e=this;return this._startLoadCheckComponentCore().then((function(t){return e.checkCore=new t.default(e),e.checkCore.startPrepareResource()}))}},{key:"_unLoadComponents",value:function(){this.checkCore.unLoadResource(),this.checkCore=null}},{key:"isOpened",get:function(){return this._isOpen}}]),e}(),Te=n(336),Ce=n(6100),ke=function(){function e(t,n,i){r()(this,e),this.container=t,this.domScaleContainer=n,this.data=i,this._element=Object(A.createElement)({type:"div",classname:"doc-draw-adjust-handler-wrap",style:"position: absolute; top: 0; left: 0; overflow: visible;",parent:this.domScaleContainer})}return l()(e,[{key:"clearAll",value:function(){window.APP.frontUtil.ReactDom.unmountComponentAtNode(this._element)}},{key:"update",value:function(e){window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.DrawingAdjustHandler(e),this._element)}}]),e}(),we=function(e){function t(e,n){r()(this,t);var i=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return!window.__CONFIG__.wps.isBestScale||window.__CONFIG__.wps.isAdaptWebView&&i.app.isWebMode()||i.initScaleValue(),i}return f()(t,e),l()(t,[{key:"initWorkspace",value:function(){this._workspace=document.getElementById("workspace"),this.updateDisabled=!1,this.getPageCurrent=window.utils.Lodash.throttle(this.getPageCurrent.bind(this),250),S.isPad&&window.addEventListener("orientationchange",this.handleOrientationChange)}},{key:"initScaleValue",value:function(){var e=this.data.doc.sections.getSection(0),t=Object(Te.Ti2Px)(e.getPageWidth()),n=this.element.offsetWidth;if(this.app.isWebMode())try{t=this.data.typoinfo.view.size.width}catch(e){}var i=Math.round((n-40)/t*100);this.config.zoom=i/100}},{key:"initCanvasContainer",value:function(){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initCanvasContainer",this).call(this),this._cvsContainer=this._workspace.querySelector(".page-container"),this._uilTier=this._workspace.querySelector(".uil-monitor-tier"),this._wpsWrap=document.querySelector(".wps-wrap"),this._domContainer=this._workspace.querySelector(".dom-container"),this._scaleDomContainers=this._domContainer.querySelectorAll(".scale-container"),this._noScaleDomContainers=this._domContainer.querySelectorAll(".no-scale-container"),this._domScaleContainer=this._scaleDomContainers[0],this._domNoScaleContainer=this._noScaleDomContainers[0],this.updateContainer(),this.scaleDomContainer()}},{key:"initIndicator",value:function(){if(this.commentInput=null,this.input||(this.input=new te(this.app,this._workspace,this.canvasHandler),this.componentRefs.push(this.input)),!this.waterdrop){var e=this._workspace.querySelector(".cursor-container");this.waterdrop=new ne.b(this.app,e,this.canvasHandler,this.data.selection),this.componentRefs.push(this.waterdrop)}}},{key:"initRevisionComment",value:function(){var e=this,t=window.__CONFIG__.wps,n=t.disableRevisionComment,i=t.useLowPerformanceMode;if(!n&&!i&&!this.revisionComment){var o=this.app.viewUIL.loader,a=o.moduleTypes,r=o.getViewModule(a.revisionComment),s=r.promise,l=r.result,u=function(t){e.currentUsedPage=e.canvasHandler.getCvsList(),e.revisionComment=new t.DOCRevisionCommentPC(e,e.app,e._workspace,e._scaleDomContainers[0]),e.componentRefs.push(e.revisionComment),k.default.dispatchEvent(k.default.comments.RCHANDLER_LOADED),console.info("--- [view] - revisionComment")};l?u(l):s.then((function(e){return u(e)}))}}},{key:"initBookmark",value:function(){this.bookmarksManager=new he(this.app)}},{key:"initCoopSels",value:function(){this.coopSelTip||(this.coopSelTip=new D(this.app,this._workspace,this.data),this.componentRefs.push(this.coopSelTip))}},{key:"initPageNumTip",value:function(){this.app.isPCMode()&&!this.pageNumTip&&(this.pageNumTip=new L(this,this._workspace,this.data),this.componentRefs.push(this.pageNumTip))}},{key:"initUilDom",value:function(){this.uil=new Y.a(this.app,this._scaleDomContainers[1]),this.componentRefs.push(this.uil)}},{key:"initCursorTypeConfig",value:function(){this.cursorTypeConfig||(this.cursorTypeConfig=new X)}},{key:"initCacheDOMAttr",value:function(){var e=this;d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initCacheDOMAttr",this).call(this),this._handleWorkspaceComponentsUpdate=function(){e.updateWorkspaceCacheSize()},window.addEventListener(k.default.revision.ON_HISTORY_REVISION_TOOL_SHOW,this._handleWorkspaceComponentsUpdate),window.addEventListener(k.default.taskPane.ON_TASK_PANE_VISIBLE,this._handleWorkspaceComponentsUpdate)}},{key:"initSpellCheckManager",value:function(){this.spellCheckManager=new be(this),this.spellCheckManager.init()}},{key:"afterOpen",value:function(){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"afterOpen",this).call(this),this.initRevisionComment(),this.initSpellCheckManager(),this.app.docRcStart.setStatus("fileopen",!0),this.resize()}},{key:"resize",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{preventFocus:!0};this.updateContainer(!0),this.refreshWebView(),this.data.typoinfo.updater.updateViewport(this.getCurrentTypoRect()),this.canvasHandler.refreshCanvas(),this.scrollerHelper&&this.scrollerHelper.onResize(),this.bookmarksManager&&this.bookmarksManager.bookmarkItem&&this.bookmarksManager.bookmarkItem.update(),this.scaleDomContainer(),this.keepHorizontalCenterWhenContainerChanged(!0),this.updateRevisionComment("resize"),d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resize",this).call(this,e),this.app.formatContentController.updateActiveControlInfoByPos(window.APP.data.selection.begin.position),this.changeShapeBtn&&this.changeShapeBtn.update({isEditMode:!window.APP.isReadOnly()&&window.APP.isEditMode}),this.onScroll(),k.default.dispatchEvent(k.default.names.DOC_WORKSPACE_AFTER_RESIZE),S.isPad&&(i.preventFocus=!0),this.resizeUpdateFrame&&cancelAnimationFrame(this.resizeUpdateFrame),this.resizeUpdateFrame=requestAnimationFrame((function(){n.data.selection.clearCache(),n.updateIndicator({selection:n.data.selection,preventFocus:i.preventFocus,isComposing:n.data.selection.isComposing}),n.resizeUpdateFrame=null}))}},{key:"resizeIfNecessary",value:function(e){this.checkIsAllowHorizontalScroll()!==this.isHorizontalScroll&&this.resize(null,e)}},{key:"refreshDryly",value:function(e,t){if(e)this.refreshImmediately(t);else{if(window.__CONFIG__.wps.useLowPerformanceMode)this.canvasHandler&&this.canvasHandler.onSelectionChanged();else{var n=this.app.updater;n&&n.goodViewport(this.getCurrentTypoRect())&&this.canvasHandler&&this.canvasHandler.onSelectionChanged()}this.refreshContinently(t)}}},{key:"updateCurPosUIAfterTypo",value:function(e){if(this.data.selection.calearCache(e),this.data.typoinfo.scheduling){var t=this.data.selection.end.pos;t&&(t.line.viewPage.layout_index>e[0]||e.includes(t.line.viewPage.layout_index))&&this.updateCurPosUI(e)}}},{key:"updateCurPosUI",value:function(e){this.canvasHandler.refreshCanvas(null,!1,e),this.updateIndicator({selection:this.data.selection}),this.waterdrop.update(this.data.selection,this.config.zoom),k.default.dispatchEvent(k.default.names.SELECTION_CHANGE_AND_CONTENT_UPDATED,this.selectionChangeParams),this.revisionComment&&this.revisionComment.commentTip.updateAddPos(),this.data.typoinfo.scheduling&&window.APP.workspace.restoreSelection()}},{key:"updateContainer",value:function(e){var t=this,n=this.app.isWebMode(),i=this.data.typoinfo;n||i.updateStablePageInfo();var o=this.element.cacheDOMAttr&&!0!==e?this.element.cacheDOMAttr.clientWidth:this.element.clientWidth,a=this.element.cacheDOMAttr&&!0!==e?this.element.cacheDOMAttr.wrapWidth:this.wpsWrap.clientWidth,r=this.app.isHistoryVersion?o:a,s=r,l=i.verticalPadding||0;n?(i.initForPCWebMode(),s=Math.max(s,i.width*this.config.zoom),l=9,this.data.selection&&this.data.selection.clearCache()):(i.width=s,s=i.width);var u=n?45:0,c=Math.round(s*this.config.zoom),h=s+"px",d={width:c+"px",height:Math.round((i.height+2*l)*this.config.zoom)+u+"px",margin:"0 0","min-height":"100%","overflow-y":"hidden","min-width":h};this.horizontalCenterOffset=0;var p=this.checkIsAllowHorizontalScroll(e);!p&&this.config.zoom>1?(this.horizontalCenterOffset=-Math.floor((c-s)/2),d.transform="translateX("+this.horizontalCenterOffset+"px)"):!p&&this.config.zoom<1&&Math.max(s,c)>r&&(this.horizontalCenterOffset=-Math.floor((Math.max(s,c)-r)/2),d.transform="translateX("+this.horizontalCenterOffset+"px)");var f=!1;return this.shouldUpdateContainer(d)&&(Object($.assignStyle)(this._cvsContainer,{},d),this._uilTier.style.width=h,setTimeout((function(){t._uilTier.style.width=t.element.scrollWidth+"px"}),30),this.updateCacheSize(),S.isFirefox&&requestAnimationFrame((function(){t.updateCacheSize()})),f=!0),e||this.keepHorizontalCenterWhenContainerChanged(!1),f}},{key:"getPaddingLeft",value:function(){var e=(this.app.services||{}).docmapManager;if(e&&e.isOpen){var t=this.app.isAdaptMode()?1:2;return e.getDocMapWidth()*t}return 0}},{key:"getPaddingRight",value:function(){var e=this.app.isAdaptMode()?1:2,t=0;return this.revisionComment&&this.revisionComment.dataHandler.data&&this.revisionComment.dataHandler.data.length>0&&(t=288*e),this._guidePane=this._guidePane||document.querySelector(".guide-content"),this._guidePane&&this._guidePane.offsetWidth>0?this._guidePane.offsetWidth+16+t:(this._taskPane=this._taskPane||document.querySelector(".panel-wrap"),this._taskPane&&this._taskPane.offsetWidth>0?this._taskPane.offsetWidth+16+t:t)}},{key:"getRelativePosByGcp",value:function(e){var t=(this.data.typoinfo.getPosition(e,!0)||{}).pos;if(!t)return{x:-1,y:-1};var n=this.element.cacheDOMAttr,i=n.scrollLeft,o=n.scrollTop,a=n.clientWidth,r=n.clientHeight,s=n.rect.y,l=t.posX-i,u=t.posY+t.height-o;return{x:l>0&&l<a?l:-1,y:u>0&&u<r?u+s:-1}}},{key:"updateRevisionComment",value:function(e){this.revisionComment&&(e?this.revisionComment.refresh(e):this.revisionComment.realTimeRefresh(e))}},{key:"createRevisionComment",value:function(){this.revisionComment&&this.revisionComment.create()}},{key:"scaleDomContainer",value:function(){var e=this.app.isWebMode(),t=this.data.typoinfo,n=t.width,i=t.viewOffset,o=t.padding,a=t.offsetLeft,r=this.config.zoom,s=this.container.clientWidth,l=n*(e?r:1),u=n,c=Math.round((s-l)/2+this.horizontalCenterOffset),h=i.y*r,d=c;this.app.isAdaptMode()&&(c=a),e&&(d=Math.max(c,Math.round((o||0)/2)));var p=h,f={transform:"translate("+d+"px, "+p+"px)"};f["min-width"]=u+"px",Object($.assignStyle)(this._domContainer,{},f);for(var g=0;g<this._noScaleDomContainers.length;g++){var v=this._noScaleDomContainers[g];e?Object($.assignStyle)(v,{},{transform:"translate(0px, 0px)"}):Object($.assignStyle)(v,{},{transform:"translate("+-d+"px, "+-p+"px)"})}for(var m=0;m<this._scaleDomContainers.length;m++){var _=this._scaleDomContainers[m];Object($.assignStyle)(_,e?{"transform-origin":"left top",width:u+"px"}:{},{transform:"scale("+r+")"})}}},{key:"initDateTimeFloatMenus",value:function(){this.dateTimeFloatMenus||(this.dateTimeFloatMenus=new H(this.element,this._scaleDomContainers[0].children[1],this.data),this.componentRefs.push(this.dateTimeFloatMenus))}},{key:"initCatalogFloatMenus",value:function(){this.catalogFloatMenus||(this.catalogFloatMenus=new G(this.element,this._scaleDomContainers[1],this.data),this.componentRefs.push(this.catalogFloatMenus))}},{key:"initTableFloatMenus",value:function(){this.tableFloatMenus||(this.tableFloatMenus=new F(this.element,this._scaleDomContainers[0],this.data),this.componentRefs.push(this.tableFloatMenus))}},{key:"initContentBlockFloatMenus",value:function(){!this.contentBlockFloatMenus&&this.data.doc.isTemplate&&(this.contentBlockFloatMenus=new B(this.element,this._scaleDomContainers[1],this.data),this.componentRefs.push(this.contentBlockFloatMenus))}},{key:"initSelectivePasteFloatMenu",value:function(){this.selectivePasteFloatMenu||(this.selectivePasteFloatMenu=new de(this.element,this._scaleDomContainers[1],this.data),this.componentRefs.push(this.selectivePasteFloatMenu))}},{key:"initDrawingResizer",value:function(){S.isMobile||this.drawingResizer||(this.drawingResizer=new z(this.element,this._scaleDomContainers[1],this.data),this.componentRefs.push(this.drawingResizer))}},{key:"initDrawingPreviewer",value:function(){S.isMobile||this.drawingPreviewer||(this.drawingPreviewer=new K(this.element,this.domScaleContainer,this.data),this.componentRefs.push(this.drawingPreviewer))}},{key:"initDrawingAdjustHandler",value:function(){S.isMobile||this.drawingAdjustHandler||(this.drawingAdjustHandler=new ke(this.element,this.domScaleContainer,this.data),this.componentRefs.push(this.drawingAdjustHandler))}},{key:"initFormatContentProperty",value:function(){var e=this.data.doc.isTemplate;S.isMobile||this.formatContentProperty||e||(this.formatContentProperty=new j(this.element,this._scaleDomContainers[1],this.data),this.componentRefs.push(this.formatContentProperty))}},{key:"updateCommentIndicator",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];S.isPad&&this.commentInput&&(this.updateCommentInput(),this.focusCommentInput(n)),this.commentFocusRAF&&cancelAnimationFrame(this.commentFocusRAF),this.commentFocusRAF=requestAnimationFrame((function(){S.isPad||(t.updateCommentInput(),t.focusCommentInput(n)),t.commentCursor&&e&&t.commentCursor.update(),t.commentFocusRAF=null}))}},{key:"updateIndicator",value:function(e){var t=this;if(e.selection.selContext.isInComment())return this.waterdropResetRAF&&cancelAnimationFrame(this.waterdropResetRAF),this.waterdropResetRAF=requestAnimationFrame((function(){t.waterdrop.reset(),t.waterdropResetRAF=null})),void this.updateCommentIndicator(e.selection.selContext.isCommentEditable);if(e&&e.selection){if(this.waterdrop||this.initIndicator(),S.isPad&&window.APP.data.selection.selContext.isParagraphSetting)return void this.waterdrop.reset();this.waterdropUpdateFrame&&cancelAnimationFrame(this.waterdropUpdateFrame),this.waterdropUpdateFrame=requestAnimationFrame((function(){e.selection.isManualRangeSelect?t.waterdrop.reset():e.isComposing?t.waterdrop.resetWaterDrapCursor(e.selection.end):e.notRenderSelectDrop||t.waterdrop.update(e.selection,t.config.zoom),t.waterdropUpdateFrame=null})),e.selection.end&&(e.updateOnly?e.instant?this.input.update(e.selection.end):(this.inputUpdateFrame&&cancelAnimationFrame(this.inputUpdateFrame),this.inputUpdateFrame=requestAnimationFrame((function(){t.input.update(e.selection.end),t.inputUpdateFrame=null}))):(this.input.update(e.selection.end),e.isMoving||(e.shouldBlur?this.input.blur():e.preventScroll?this.focusWithoutScroll():e.preventFocus||this.input.focus())),k.default.dispatchEvent(k.default.names.DOC_CURSOR_POSITION_CHANGE))}}},{key:"clearAll",value:function(e){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clearAll",this).call(this,e),window.removeEventListener(k.default.revision.ON_HISTORY_REVISION_TOOL_SHOW,this._handleWorkspaceComponentsUpdate),window.removeEventListener(k.default.taskPane.ON_TASK_PANE_VISIBLE,this._handleWorkspaceComponentsUpdate),S.isPad&&window.removeEventListener("orientationchange",this.handleOrientationChange),[this.waterdropUpdateFrame,this.inputUpdateFrame,this.resizeUpdateFrame,this.commentFocusRAF,this.waterdropResetRAF].forEach((function(e){e&&cancelAnimationFrame(e)})),[this.selectionChangeTimeoutID,this.workspaceScrollTimeoutKey,this.commentActiveTimeoutID].forEach((function(e){e&&clearTimeout(e)})),this.app.isWebMode()&&this.app.frontUtil.ReactDom.unmountComponentAtNode(this.canvasHandler.fileNameContainerDiv);for(var n=[].concat(x()(this._cvsContainer.childNodes)),i=0;i<this._scaleDomContainers.length;i++){var o=this._scaleDomContainers[i];n.push.apply(n,x()(o.childNodes))}for(var a=0;a<this._noScaleDomContainers.length;a++){var r=this._noScaleDomContainers[a];n.push.apply(n,x()(r.childNodes))}for(var s,l=this._workspace.childNodes,u=0;u<l.length;u++)(s=l[u])===this._cvsContainer||s===this._domContainer||s===this._domNoScaleContainer||s===this._uilTier||"page-outside-container"===s.className||s.classList.contains("doc-input-tip")||n.push(s);n.forEach((function(e){if(e.className.includes("permanent-container"))for(;e.hasChildNodes();)e.removeChild(e.firstChild);else e.className.includes("components-container")||(e.remove?e.remove():e.parentNode.removeChild(e))})),this.spellCheckManager&&this.spellCheckManager.clear()}},{key:"onSelectionChanged",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.updateDisabled){var o=i.isEditing;this.refreshDryly(o),this.data.selection.selContext.isInComment()&&(i.commentRcIds=this.commentRenderHandler.refresh())}d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onSelectionChanged",this).call(this,e,i),this.selectionChangeTimeoutID?(clearTimeout(this.selectionChangeTimeoutID),this.selectionChangeParams=I()({},this.selectionChangeParams,i,{commentRcIds:[].concat(x()(this.selectionChangeParams.commentRcIds||[]),x()(i.commentRcIds||[]))})):this.selectionChangeParams=i,this.selectionChangeTimeoutID=setTimeout((function(){k.default.dispatchEvent(k.default.names.SELECTION_CHANGE_AND_CONTENT_UPDATED,n.selectionChangeParams),n.selectionChangeTimeoutID=null,n.selectionChangeParams=null}),16)}},{key:"onSectionxChanged",value:function(){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onSectionxChanged",this).call(this)}},{key:"makeContentVisible",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.commentActiveTimeoutID&&clearTimeout(this.commentActiveTimeoutID);var o=d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"makeContentVisible",this).call(this,e,i),a=o.promise,r=o.cancel;return{promise:a.then((function(e){if(e&&!i.isRefocusComment){var t=e.context.comment;t&&(n.commentActiveTimeoutID=setTimeout((function(){k.default.dispatchEvent(k.default.comments.ACTIVE_COMMENT_BY_RANGE,{range:{pos:t.pos,len:t.len}}),n.commentActiveTimeoutID=null}),1e3))}}),(function(e){return Promise.reject(e||"makeContentVisible fail")})),cancel:r}}},{key:"makesureCursorVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.data.selection,r=a.selContext.isInComment();if(S.isIPad&&!r){var s=window.APP.data.selection.end.pos;if(!s)return;var l=window.APP.workspace.config.zoom,u=s.posY*l,c=u+s.height*l,h=window.APP.workspace.getCurrentRect(),d=window.APP.appApi.isKeyboardActive?window.APP.appApi.keyboardHeight:0,p=window.APP.workspace.element.cacheDOMAttr,f=p.clientHeight,g=p.scrollTop,v=g+f-d;if(!(u<h.top||v<c))return;this.disableScroll(),requestAnimationFrame((function(){n.enableScroll()}))}var m=a.getRangedSelection(),_=m.isSame;if(_||e){var y=t?a.end.pos:a.begin.pos;if(!y)return;return r?void(a.selContext.isCommentEditable&&this.scrollToPosInComment(y)):(this.updateContainer(!1),this.scrollToPos(y,i,o))}}},{key:"toggleContainerPointerStyle",value:function(e,t){var n=this,i=Array.prototype.filter.call(this._cvsContainer.classList,(function(e){return!e.match(Z.cursorTypeReg)})),o=this.cursorTypeConfig.updateCursorType(e,t),a=pe[o],r=(S.isWindowsTen||S.isMacOs)&&a;clearTimeout(this.timer),r?(this._cvsContainer.className=i.join(" "),this._workspace.style.cursor=r):S.isWindowsTen&&fe[o]?this.timer=setTimeout((function(){i.push(o),n._cvsContainer.className=i.join(" ")}),100):(i.push(o),this._cvsContainer.className=i.join(" "))}},{key:"scrollToPosInComment",value:function(e){if(this.commentContainer&&this.commentContainer.element){var t=e.posY,n=e.height,i=this.commentContainer.element,o=i.scrollTop,a=i.clientHeight;t+n/4*3>=o+a?this.commentContainer.element.scrollTop+=t+n-o-a+4:t+n/4<o&&(this.commentContainer.element.scrollTop=t-4)}}},{key:"scrollToPos",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.config.zoom,o=!0;Object.assign(e,{posX:e.posX*i,posY:e.posY*i,height:e.height*i});var a=150,r=e.posX,s=(e.charPosY-n)*i,l=e.line.glyphGroupInfos,u=e.height;if(l){var c=e.line.glyphGroupInfos.find((function(t){return e.position<t.endOffset+e.line.range.begin||e.position===e.line.range.end}));c&&(u=c.metrics.height)}var h=0;S.isIPad&&window.APP.appApi.isKeyboardActive&&(h=window.APP.appApi.keyboardHeight);var d=this.element.cacheDOMAttr,p=d.clientWidth,f=d.clientHeight,g=d.scrollTop,v=d.scrollLeft,m=g+f-h,_=v+p-this.horizontalCenterOffset,y=30,b=s-(f-h)/2+u+y;if(t)this.scrollTo({scrollTop:b});else if(s<g)this.scrollTo({scrollTop:s-15}),o=!1;else if(s>m-u){var T=2*u,C=this.element.cacheDOMAttr.scrollTop+T;(C+f<s||C>b)&&(C=b-u/2),this.scrollTo({scrollTop:C}),o=!1}return r<v?(this.scrollTo({scrollLeft:r-u}),o=!1):r>_&&(this.scrollTo({scrollLeft:r-p+u}),o=!1),this.app.initializedBookmarkInfo&&this.app.isFirstTimeHandleBookmark&&this.app.data.selection.selAreas.activeArea&&this.app.data.selection.selAreas.activeArea.getBegin().pos.charPosY&&this.scrollTo({scrollTop:this.app.data.selection.selAreas.activeArea.getBegin().pos.charPosY-a}),o}},{key:"scale",value:function(e){this.revisionComment&&this.revisionComment.onClose(),null==this.currentPage&&(this.currentPage=this.getPageCurrent(!0)),this.config.preZoom=this.config.zoom,this.config.zoom=e,this.resize(),this.scrollerHelper&&this.keepHorizontalCenterWhenScale(),this.updateIndicator({selection:this.data.selection,updateOnly:!0,preventScroll:!0}),this.onScroll(),this.updateRevisionComment("scale")}},{key:"checkIsAllowHorizontalScroll",value:function(e){var t=this.data.typoinfo.allpage_width,n=(this.element.cacheDOMAttr&&!e?this.element.cacheDOMAttr.clientWidth:this.element.clientWidth)-16,i=this.getPaddingLeft()+this.getPaddingRight();return n<=t*this.config.zoom+i}},{key:"calcCenterScrollX",value:function(){var e=this.app.isHistoryVersion?this.element.clientWidth:this.element.cacheDOMAttr?this.element.cacheDOMAttr.wrapWidth:this.wpsWrap.clientWidth,t=this.container.clientWidth;return Math.floor((t-e)/2)}},{key:"keepHorizontalCenterWhenScale",value:function(){var e=this.checkIsAllowHorizontalScroll();switch(!0){case e:this.element.scrollLeft=this.calcCenterScrollX();break;case!e&&this.isHorizontalScroll:this.element.scrollLeft=0}this.scrollTo({scrollTop:this.element.scrollTop*this.config.zoom/this.config.preZoom})}},{key:"keepHorizontalCenterWhenContainerChanged",value:function(e){var t=this.checkIsAllowHorizontalScroll(e);t&&!this.isHorizontalScroll?this.element.scrollLeft=this.calcCenterScrollX():this.isHorizontalScroll&&!t&&(this.element.scrollLeft=0),t!==this.isHorizontalScroll&&k.default.dispatchEvent(k.default.names.DOC_WORKSPACE_SHOULD_HORIZONTAL_SCROLL,{isHorizontalScroll:t}),this.isHorizontalScroll=t}},{key:"getPageCurrent",value:function(e){if(!this.app.isWebMode()){var t=this.app.data.typoinfo.outer_rects,n=this.config.zoom,i=!!this.element.cacheDOMAttr,o=this.data.selection.begin.position,a=this.data.doc.getSubDocType(o),r=o;if(this.data.selection.selContext.isInHeaderFooter){var s=this.data.doc.getSubDocRange(V.HeaderFooter);r>=s.pos+s.len-1&&(r=s.pos+s.len-2)}else if(a==V.Textbox){var l=this.data.doc.getTextLengthInSubDoc(a),u=this.data.doc.getSubDocOffset(a);o>=u+l&&(r=u+l-1)}else if(a===V.Comment){var c=this.data.selection.getNormalRange(),h=this.data.doc.commentBodys.getCommentByPos(c.pos);r=h&&h.pos||0}else{var d=this.data.doc.getMainTextLength();o>=d&&(r=d-1)}var p=U.b.locate(this.data,r,null,this.data.typoinfo),f=void 0,g=void 0,v=void 0,m=void 0;if(p?(f=p.line.viewPage,g=parseInt(p.posY*n),v=m=f.layout_index):(f=0,g=0,v=0,m=0),!e)return v;var _=i?this.element.cacheDOMAttr.scrollTop:this.element.scrollTop,y=i?this.element.cacheDOMAttr.clientHeight:this.element.clientHeight,b=this.data.typoinfo.getLayoutPageCache(0).outer_rect.top,T=!1,C=void 0,k=void 0;if(g>_&&g<=_+y&&(v=m,T=!0),!T)for(var w=0;w<t.length;w++){if(w!=m&&t[w])if(C=parseInt(t[w].top*n),k=parseInt(t[w].height*n),C-(w>0?parseInt((t[w].top-t[w-1].top-t[w-1].height)*n):parseInt(b*n))<=_&&C+k>=_){v=w;break}}return v}}},{key:"getPictureControl",value:function(){if(!this.data.doc.isPalaceMuseumTemplate)return null;for(var e=this.data.doc.getSubDocRange(V.MainText),t=this.data.doc.contentControls.collect(e.pos,e.len),n=0;n<t.length;++n){var i=t[n];if("picture"===i.title){var o=U.b.locate(this.data,i.pos+1,!1,this.data.typoinfo);if(o&&o.line){var a=o.line,r=this.data.typoinfo.embedShapeRanges&&this.data.typoinfo.embedShapeRanges.mapInRange(a.range.begin,a.range.end,R.IT.mapToNode,R.IT.strictIntersectTest);if(r&&r.length)return{shapeInfo:r[0],shapeTreeType:J.c}}break}}return null}},{key:"getTextControl",value:function(){if(!this.data.doc.isPalaceMuseumTemplate)return null;for(var e=this.data.doc.getSubDocRange(V.MainText),t=this.data.doc.contentControls.collect(e.pos,e.len),n=0;n<t.length;++n){var i=t[n];if("text"===i.title){var o=U.b.locate(this.data,i.begin+1,!1,this.data.typoinfo),a=U.b.locate(this.data,i.end-2,!1,this.data.typoinfo);if(o&&o.line&&a&&a.line){var r=o.line,s=q.a.getPosition2view(r),l=a.line;return{rect:{top:s.y,left:s.x,width:Math.max(r.rect.width,l.rect.width),height:q.a.getPosition2view(l).y-s.y+l.rect.height},wordCnt:this.data.selection.selInfo.wordStat.GetWordCountInRange({pos:i.pos+1,len:i.len-2}),pageRect:r.viewPage.outer_rect}}break}}return null}},{key:"getPageFitValue",value:function(){var e=this;this.currentPage=this.getPageCurrent(!0);var t=this.element.cacheDOMAttr.offsetWidth,n=this.element.cacheDOMAttr.offsetHeight-10,i=this.app.isWebMode(),o=i?this.app.data.typoinfo.width:this.app.data.typoinfo.outer_rects[this.currentPage].width,a=i?this.app.data.typoinfo.height:this.app.data.typoinfo.outer_rects[this.currentPage].height;return{pagew:function(){return Math.round((t-40)/o*100)},wordw:function(){return Math.round(t/(o-2*((i?e.app.data.typoinfo.horizontalPadding:e.data.typoinfo.getLayoutPageCache(e.currentPage).inner_rect.left)-25))*100)},totalpage:function(){var e=0;return e=t/n>=o/a?n/(a+10):t/o,Math.round(100*e)}}}},{key:"onScroll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.currentUsedPage=this.canvasHandler.onScroll(e),this.revisionComment&&this.revisionComment.onScroll(this.currentUsedPage),this.revisionComment&&this.revisionComment.onScrollVisible(),Object(Ce.storeReadPosition)({throttle:!0})}},{key:"onViewportChanged",value:function(e){this.revisionComment&&this.revisionComment.debounceViewportChange(),this.data.typoinfo.pageCount!==this.app.defaultPageCount&&(this.app.defaultPageCount=this.data.typoinfo.pageCount,k.default.dispatchEvent(k.default.names.DOC_PAGE_CHANGE))}},{key:"onPosChanged",value:function(e,t){this.currentUsedPage=this.canvasHandler&&this.canvasHandler.getCvsList()||[0];var n=t.updatePosAfterTypo,i=t.params;if(n){var o=i.updatedPages,a=i.dropCount;o&&this.updateCurPosUIAfterTypo(o,a)}}},{key:"lockShowCursor",value:function(){this.waterdrop.lockShow()}},{key:"unlockShowCursor",value:function(){this.waterdrop.unlockShow()}},{key:"pageUp",value:function(e){if(this.app.formatContentController.isRestrictEditMode)this.app.formatContentController.keyUpHandler();else if(this.data.selection.selAlter.pageUpPosition(e))this.makesureCursorVisible(e);else{var t=this.element.cacheDOMAttr.scrollTop;if(0!==t){var n=Math.max(0,t-this.element.cacheDOMAttr.clientHeight);this.scrollTo({scrollTop:n})}}}},{key:"pageDown",value:function(e){if(this.app.formatContentController.isRestrictEditMode)this.app.formatContentController.keyDownHandler();else if(this.data.selection.selAlter.pageDownPosition(e))this.makesureCursorVisible(e);else{var t=this.element.cacheDOMAttr,n=t.scrollTop,i=t.scrollHeight,o=t.clientHeight;if(n+o<i){var a=Math.min(i-o,n+this.element.cacheDOMAttr.clientHeight);this.scrollTo({scrollTop:a})}}}},{key:"onFontUpdate",value:function(){this.canvasHandler.onFontUpdate()}},{key:"shouldFocusWithoutScroll",value:function(){S.isPad?this.input.isPreBlur()||this.focusWithoutScroll():this.isEditable()||this.focusWithoutScroll()}},{key:"updateCommentInput",value:function(){this.commentInput&&this.commentInput.update()}},{key:"focusCommentInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.commentInput&&document.activeElement!==this.commentInput.element){var t=this.element.scrollLeft,n=this.element.scrollTop;return this.commentInput.focus(),e||(this.element.scrollLeft=t,this.element.scrollTop=n),!0}return!1}},{key:"focusWithoutScroll",value:function(){if(this.data.selection.selContext.isInComment())return this.focusCommentInput();if(this.scrollerHelper.startPassiveScroll(),this.isEditable())return!0;if(S.isFirefox||S.isEdge){var e=this.input.element,n=this.element.cacheDOMAttr,i=n.scrollLeft,o=n.scrollTop,a=n.rect,r=a.width,s=a.height,l=e.style,u=l.left,c=l.top;u=parseFloat(u),c=parseFloat(c),u>i&&c>o&&u<i+r&&c<o+s||(e.style.left=i+r/2+"px",e.style.top=o+s/2+"px"),this.input.focus(),setTimeout((function(){e.style.left=u+"px",e.style.top=c+"px"}),500)}else d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"focusWithoutScroll",this).call(this)}},{key:"getClientWidth",value:function(){return this.element.cacheDOMAttr.clientWidth}},{key:"updateWorkspaceCacheSize",value:function(){this.element.cacheDOMAttr={scrollTop:this.element.scrollTop,scrollLeft:this.element.scrollLeft,scrollWidth:this.element.scrollWidth,scrollHeight:this.element.scrollHeight,clientWidth:this.element.clientWidth,clientHeight:this.element.clientHeight,offsetWidth:this.element.offsetWidth,offsetHeight:this.element.offsetHeight,rect:this.element.getBoundingClientRect(),wrapWidth:this.wpsWrap.clientWidth}}},{key:"refreshWebView",value:function(e){if(this.app.isAdaptMode()){this.app.data.typoinfo.initForPCWebMode(!0,e);var t=this.app.data.typoinfo.size.width;(!this.cacheWidth||Math.abs(this.cacheWidth-t)>1)&&(this.app.updater.invalidateView(),this.cacheWidth=t)}}},{key:"handleOrientationChange",value:function(){setTimeout((function(){k.default.dispatchEvent("resize")}),300)}},{key:"enableScroll",value:function(){this._scrollDisabled&&(this.element.classList.remove("scroll-disabled"),this._scrollDisabled=!1)}},{key:"disableScroll",value:function(){this._scrollDisabled||(this.element.classList.add("scroll-disabled"),this._scrollDisabled=!0)}},{key:"scrollTop",get:function(){return this.element.cacheDOMAttr?this.element.cacheDOMAttr.scrollTop:this.element.scrollTop}},{key:"scrollLeft",get:function(){return this.element.cacheDOMAttr?this.element.cacheDOMAttr.scrollLeft:this.element.scrollLeft}},{key:"useCommentRender",get:function(){return!0}}]),t}(N.a),Se=n(10075),Pe=n(4979),Ie=n(4976),Ee=n(7215),Oe=function(e){function t(e,n,i){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return o.onScrollUpdate=function(){o.uilSquareManager.showAll&&(o.isViewPageLayoutUnchanged()||(o.cacheLastScrollPagesIndexArray=Object.assign([],o.currentUsedPage),o.clearActiveControls(!1),o.showAllBorderOfContentControls()))},o.unBindEvent(),o.bindEvent(),o.isWebTypoMode||(o.getActiveControlPointsMap=Function.prototype),o.cacheLastScrollPagesIndexArray=[],o}return f()(t,e),l()(t,[{key:"bindEvent",value:function(){window.addEventListener(k.default.names.DOC_WORKSPACE_SCROLL,this.onScrollUpdate)}},{key:"unBindEvent",value:function(){window.removeEventListener(k.default.names.DOC_WORKSPACE_SCROLL,this.onScrollUpdate)}},{key:"isViewPageLayoutUnchanged",value:function(){var e=this.currentUsedPage;return e.length===this.cacheLastScrollPagesIndexArray.length&&this.cacheLastScrollPagesIndexArray.every((function(t,n){return t===e[n]}))}},{key:"getCombineControlInfo",value:function(e){return this.isWebTypoMode?this.getCombineControlInfo=function(e){var t=(new Map).set(this.getActiveControlBelongingTextPage(e),[].concat(x()(this.getActiveControlPointsMap(e))));return{ctrl:e,highlightType:Pe.a.FULL_BOX,isInactive:!1,pointsMap:{0:t}}}:this.getCombineControlInfo=function(t){var n=this.data.typoinfo.collectTextLines({begin:e.begin,end:e.begin+1});if(n&&n.length){var i=U.b.locate(this.data,t.begin,!1,this.data.typoinfo);this.app.uilManager.hitInSpecific(Ee.a.CONTENT_CONTROLS,i.pos,i);var o=i.ctrlInfos,a=void 0===o?[]:o,r=(a=a.filter(this.isOperableContentControl))[a.length-1];return r?(r.highlightType=Pe.a.FULL_BOX,r.isInactive=!1,r):void 0}},this.getCombineControlInfo(e)}},{key:"getCurrentViewPageContentControls",value:function(e){var t=this.workspace.currentUsedPage;if(!t)return[];var n=t[0],i=t[t.length-1],o=this.data.typoinfo.layout_pages;if(e)for(var a=1;a<=3;a++)n>0&&n--,i<o.length-1&&i++;var r=o[n],s=o[i];if(!r||n.isMoc||!s||s.isMoc)return[];var l=o[n].getMainRange(),u=o[i].getMainRange();if(e&&(u=u||(o[i-1]&&o[i-1]).getMainRange()||(o[i-2]&&o[i-2]).getMainRange()),!l||!u)return[];var c=l.pos,h=u.pos+u.len-l.pos;return e?[].concat(x()(this.getContentControlsByRange({pos:c,len:h},{isOperable:!0})),x()(this.getAllSubDocsControls(!0))).filter((function(e){return e.isPicture&&e.showPlcHdr})):this.getContentControlsByRange({pos:c,len:h},{isOperable:!0,isNonNested:!0})}},{key:"showAllBorderOfContentControls",value:function(){var e=this;if(this.canShowContentControl){var t=null;t=this.isWebTypoMode?this.getAllOuterMostControls():this.getCurrentViewPageContentControls();var n=[],i=void 0;if(t.forEach((function(t){(i=e.getCombineControlInfo(t))&&n.push(i)})),n.length>0)return this.selection.activeCtrls=n,this.rePaint(),!0}}},{key:"updateActiveControlInfos",value:function(e){var t=this;window.APP.workspace.getFormatContentManager().isMoving||(e&&e.length?(this.selection.activeCtrls=e.map((function(e){var n=e;if(t.isWebTypoMode){n instanceof Ie.a||(n=e.ctrl);var i=(new Map).set(t.getActiveControlBelongingTextPage(n),[].concat(x()(t.getActiveControlPointsMap(n))));n={ctrl:n,highlightType:Pe.a.FULL_BOX,isInactive:!1,pointsMap:{0:i}}}else n.highlightType=Pe.a.FULL_BOX,n.isInactive=!1;return n})),this.rePaint()):this.clearActiveControls())}},{key:"updateActiveControlInfoByPos",value:function(e){if(this.data.doc.getSubDocType(e)!==V.Comment){var t=null;if(this.isWebTypoMode){t={ctrlInfos:this.getControlsByPos(e,!0)||[]}}else{if(t=U.b.locate(this.data,e,!1,this.data.typoinfo),!this.app.uilManager)return;this.app.uilManager.hitInSpecific(Ee.a.CONTENT_CONTROLS,t.pos,t)}if(this.isWebTypoMode)this.updateActiveControlInfoByHitResult(t);else if(t&&t.line){var n=!0;this.doc.useCoreTypo&&(n=t.line.rcUpdated),n&&this.updateActiveControlInfoByHitResult(t)}}}},{key:"keyUpHandler",value:function(){if(this.isRestrictEditMode){var e=this.selection.selInfo.getSelectionInfo(),t=e.begin,n=e.end,i=null;if(this.checkIsInContentControl(t)){var o=this.getInnerMostControl(t,!0),a=this.getControllerBeginPos(o),r=this.getControllerEndPos(o);if(a!==t||r!==n)return this.selection.setPosition(a,r);i=this.move2BeforeClosestController(t)}else i=this.move2BeforeClosestController(t);i&&(this.data.selection.setPosition(i.begin,i.end),this.workspace.makesureCursorVisible(!0,!0,!1))}}},{key:"keyDownHandler",value:function(){if(this.isRestrictEditMode){var e=this.selection.selInfo.getSelectionInfo(),t=e.begin,n=e.end,i=null;if(this.checkIsInContentControl(t)){var o=this.getInnerMostControl(t,!0),a=this.getControllerBeginPos(o),r=this.getControllerEndPos(o);if(a!==t||r!==n)return this.selection.setPosition(a,r);i=this.move2NextClosestController(t)}else i=this.move2NextClosestController(t);i&&(this.data.selection.setPosition(i.begin,i.end),this.workspace.makesureCursorVisible(!0,!0,!1))}}}]),t}(Se.a),xe=n(7770),Re=n.n(xe),Ne=n(10043),Ae=n(7772),De=n(684),Me=function(e){function t(e){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}var n;return f()(t,e),l()(t,[{key:"initWorkspace",value:function(){this.view.workspace=new we(this.app,this.data)}},{key:"initControllers",value:function(){var e=this.data,t=e.doc,n=e.selection;this.view.formatContentController=new Oe(t,n,this.app),this.view.formatContentController.contentControlsInitFinish(),this.view.restrictEditHandler=new Re.a}},{key:"initEditor",value:function(){}},{key:"initServices",value:function(){this.view.services={userCommentsManager:new Ne.a(this.app),docmapManager:new Ae.a(this.app)}}},{key:"backup",value:function(){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"backup",this).call(this),this.prevState=I()({},this.prevState,{isCooperationMode:this.app.isCooperationMode,copiedFormat:this.view.uilManager.editHandler.state.copiedFormat})}},{key:"clearAll",value:function(e){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clearAll",this).call(this,e),this.app.isEnterFileName=!1}},{key:"restore",value:function(e){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"restore",this).call(this,e),this.prevState.isCooperationMode&&this.view.appApi.switchToCooperationMode(!0),this.prevState.copiedFormat&&this.view.workspace.toggleContainerPointerStyle(Z.cursorTypes.wps_format_painter,{softKeep:!0})}},{key:"changeViewMode",value:function(e){d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"changeViewMode",this).call(this,e),this.app.isReadOnly()&&(this.app.config.typoMode=e)}},{key:"afterOpen",value:(n=o()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"afterOpen",this).call(this);case 2:this.resetTypoMode();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getTypoUpdateRect",value:function(){return this.view.workspace.getCurrentTypoRect()}},{key:"typoUpdate",value:function(e){return!!d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"typoUpdate",this).call(this,e)&&(this.view.workspace.revisionComment&&this.view.workspace.commentRenderHandler.refresh(),!0)}},{key:"getTargetTypoModeInfo",value:function(e){var t=e.woTemplateTypoMode,n=void 0,i=_i18n("applications.writer.components.core.event.uil.view.webMode", "Full Page Mode");return void 0!==t&&("web"===t?(n=De.TYPO_MODE.MODE_WEB,i=_i18n("applications.writer.components.core.event.uil.view.open", "Open")+i):(n=De.TYPO_MODE.MODE_PC,i=_i18n("applications.writer.components.core.event.uil.view.close", "Close")+i)),null!==n&&n!==this.app.typoMode?{typoMode:n,operation:i}:{}}}]),t}(E.a),Le=n(10039),Fe=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}var n,i;return f()(t,e),l()(t,[{key:"initURLConfigs",value:function(){if(this.isReadOnly()&&!this.isHistoryVersion&&Object(w.hasQuery)("typoModeInReadonly")){var e=Object(w.getQuery)("typoModeInReadonly");"pages"===e&&(this.config.typoMode=De.TYPO_MODE.MODE_PC),"web"===e&&(this.config.typoMode=De.TYPO_MODE.MODE_WEB)}}},{key:"initData",value:function(e,t){this.data=new C(e,t)}},{key:"initViewUIL",value:function(){this.viewUIL||(this.viewUIL=this.isPreview?new Le.a(this):new Me(this))}},{key:"initView",value:(i=o()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initViewUIL(),e.next=3,this.viewUIL.init();case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"initOver",value:function(e){this.initOverBase(e)}},{key:"afterOpen",value:(n=o()(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"afterOpen",this).call(this,n);case 2:this.loadPlugin();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"update",value:function(e){var t=this;this.data.selection.clearCache(),this.data.update(e),void 0!==e.typoinfo&&e.typoinfo._layout_pages&&this.data.typoinfo._layout_pages.forEach((function(e){t.data.typoinfo.getLayoutPageCache(e.pageIndex)}))}},{key:"dispatchCommentDropdownCheck",value:function(e){k.default.dispatchEvent(k.default.comments.CHECKED_COMMENTS_DROPDOWN,{checked:e})}},{key:"isEnableComposition",value:function(){return!this.data.doc.useCoreTypo&&!S.isIEPure}},{key:"isEnableEmphasisMeasurer",value:function(){return!S.isIE}},{key:"focusInput",value:function(){this.data.selection.selContext.isInComment()?this.workspace.commentInput&&this.workspace.commentInput.focus():d()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"focusInput",this).call(this)}},{key:"loadPlugin",value:function(){if(!window.__WPSENV__.cache_preview){var e=["KSOPluginID"];window.APP.data.doc.getCustomAttribute(e).then((function(e){e.KSOPluginID&&window.__WPSPLUGIN__.loader.loadSingleInstance({id:e.KSOPluginID})}))}}},{key:"isHistoryVersion",get:function(){return parseInt(Object(w.getQuery)("version"))>0}},{key:"isHistoryVersionCompare",get:function(){var e=window.__CONFIG__.wps,t=e.disableRevisionComment,n=e.useLowPerformanceMode;if(!this.isHistoryVersion||t||n)return!1;var i=this.workspace.revisionComment.versionCompare;return i&&!i.isCompareVersion()&&!i.preview}}]),t}(g.a),Be=function(){return new Fe};window.tester.record(window.tester.actions.js_loaded)},1103:function(e,t,n){"use strict";n.d(t,"r",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"n",(function(){return l})),n.d(t,"k",(function(){return u})),n.d(t,"l",(function(){return c})),n.d(t,"h",(function(){return h})),n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return p})),n.d(t,"t",(function(){return f})),n.d(t,"m",(function(){return g})),n.d(t,"s",(function(){return v})),n.d(t,"f",(function(){return m})),n.d(t,"e",(function(){return _})),n.d(t,"q",(function(){return y})),n.d(t,"o",(function(){return b})),n.d(t,"p",(function(){return T})),n.d(t,"g",(function(){return C})),n.d(t,"u",(function(){return k}));var i=1,o=2,a=3,r=4,s=5,l=6,u=7,c=8,h=9,d=10,p=11,f=13,g=14,v=15,m=16,_=19,y=20,b=23,T=24,C=25,k=255},1104:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return s}));var i=0,o=1,a=2,r=3,s=4},1105:function(e,t,n){var i=n(474);e.exports=function(){return i.Date.now()}},11105:function(e,t,n){e.exports=function(e,t){n.e(893).then(n.bind(null,16694)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},1143:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64=void 0;var i=c(n(1)),o=c(n(2)),a=c(n(2005)),r=n(2006),s=c(n(2007)),l=n(2008),u=n(1202);function c(e){return e&&e.__esModule?e:{default:e}}var h=1,d=4,p=5,f=7168,g=8194,v=8195,m="edit",_="subscribe",y="https://"+("web.wps.cn"===location.hostname?"msgcenter.wps.cn":"msgcenter.kdocs.cn")+"/api/v1/connectors?protocol=wss";if("www.kdocs.cn"!==location.hostname&&"web.wps.cn"!==location.hostname){var b=window.__CONFIG__.pathPrefix.lastIndexOf("/"),T=window.__CONFIG__.pathPrefix.substr(0,b);y=T+"/ksopush-login-web/api/v1/connectors?protocol=wss"}function C(){}var k=t.base64=new function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(n){var i,o,a,r,s,l,u,c="",h=0;for(n=t(n);h<n.length;)r=(i=n.charCodeAt(h++))>>2,s=(3&i)<<4|(o=n.charCodeAt(h++))>>4,l=(15&o)<<2|(a=n.charCodeAt(h++))>>6,u=63&a,isNaN(o)?l=u=64:isNaN(a)&&(u=64),c=c+e.charAt(r)+e.charAt(s)+e.charAt(l)+e.charAt(u);return c},this.decode=function(t){var i,o,a,r,s,l,u="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)i=e.indexOf(t.charAt(c++))<<2|(r=e.indexOf(t.charAt(c++)))>>4,o=(15&r)<<4|(s=e.indexOf(t.charAt(c++)))>>2,a=(3&s)<<6|(l=e.indexOf(t.charAt(c++))),u+=String.fromCharCode(i),64!=s&&(u+=String.fromCharCode(o)),64!=l&&(u+=String.fromCharCode(a));return u=n(u)};var t=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},n=function(e){for(var t="",n=0,i=0,o=0,a=0;n<e.length;)(i=e.charCodeAt(n))<128?(t+=String.fromCharCode(i),n++):i>191&&i<224?(o=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),a=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a),n+=3);return t}},w=function(e){var t=new DataView(e),n=t.getUint32(0,!0),i=(t.getUint16(4,!0),t.getUint16(6,!0)),o=t.getUint32(8,!0),a=t.getUint32(12,!0),r=t.getUint32(16,!0),s=[t.getUint32(20,!0),r];if(1266907392!=n)return{};for(var l=new Array(o),u=i;u<i+o;u++)l[u]=String.fromCharCode(t.getInt8(u));return{msgId:s,msgType:a,body:l.join("")}},S=function(e,t,n){var i=n.length,o=t,a=e,r=a[0],s=a[1],l=new ArrayBuffer(24+i),u=new DataView(l);u.setUint32(0,1266907392,!0),u.setUint16(4,1,!0),u.setUint16(6,24,!0),u.setUint32(8,i,!0),u.setUint32(12,o,!0),u.setUint32(16,s,!0),u.setUint32(20,r,!0);for(var c=0;c<n.length;c++)u.setInt8(24+c,n.charCodeAt(c));return u.buffer},P=0,I=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P,o=window.fileInfo||window.__WPSENV__.file_info.file;if(o.user_acl.update){var r=window.__WPSENV__.store.getState().public.cooperation;if(!window.__WPSENV__.isOnlineMode&&r&&r.members&&r.members.length>i&&(0,l.report)(window.urlFileId,r.members.length,t),e&&window.__WPSENV__.conflictLock.getInfor().isLockMode)n&&n();else{window.collection2("client_locked_edit_"+(e?"true":"false")),window.__WPSENV__.conflictLock=(0,a.default)(e,t,n);var s=!0;!window.__WPSENV__.isOnlineMode&&window.__CONFIG__.isEnableOnLineMode&&(s=!/(\?|\&)editlock($|\&|=1)/i.test(window.location.search)),window.__WPSENV__.conflictLock.tryLock(s)}}},E=function(){function e(t){var n=this;(0,i.default)(this,e),O.call(this),(0,l.getOnline)().then((function(e){var i=e.isOnline,o=e.threshold;n._isOnlineMode=i,n._init(t),P=o,window.__WPSENV__.isOnlineMode=i,window.__WPSENV__.isOnlinethreshold=o}))}return(0,o.default)(e,[{key:"_procLogin",value:function(){var e=this;if(/(\?|\&)(version|mode=preview)/i.test(window.location.search))return!1;var t=new s.default.LoginServer(y);t.beginLogin().then((function(n){console.log("Allowed to login",n),e._open(t.getRetAddr(),t.getRetToken())})).catch((function(n){(429===n||n>500&&n<600||n===t.getUnpredictableCode())&&e._reProcLogin(n),console.log("Login not allowed",n)}))}},{key:"_reProcLogin",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;setTimeout((function(){e._stop||(console.log("try login",t),e._procLogin())}),3e3*Math.pow(2,this.failTimes++))}},{key:"_onLogined",value:function(e){var t=this,n={authToken:e,deviceid:"",appid:"web.wps.cn",clientType:"web",clientChannel:"WPS",clientVersion:"1.0"};this._call(h,n,(function(e){t._onAuthResponse(e)}))}},{key:"_open",value:function(e,t){var n=this;if(!this._stop){var i="ws://";"https:"===location.protocol&&(i="wss://");try{this._ws=new WebSocket(i+e)}catch(e){return this._reProcLogin(),void console.error(e)}this._ws.binaryType="arraybuffer",this._ws.onclose=function(){n._close(),n._reProcLogin()},this._ws.onerror=function(){n._close(),n._reProcLogin()},this._ws.onopen=function(){n._onLogined(t)},this._ws.onmessage=function(e){var t=w(e.data);switch(t.msgType){case g:break;case f:var i=t.msgId[0]+"-"+t.msgId[1],o=n._penddingCall[i];o&&(o(t.body),delete n._penddingCall[i]);break;case v:n._onDocTeamNotify(t)}}}}},{key:"_checkVersion",value:function(){var e="/api/v3/office/file/"+this._fileId+"/check_new_version";window.__WPSENV__.request({method:"POST",url:e,responseType:"json"}).end().catch((function(){console.error("check new version failed!")}))}},{key:"_lock",value:function(){var e=this;if(this._status===m)return clearTimeout(this._timeTicker),void(this._timeTicker=setTimeout((function(){e._leaveDocumentTeam()}),this._unLockTime));this._subStatusJoin(this._members)}},{key:"_updateMembers",value:function(e){var t=e.Members||e.operators||!1;if(t){var n=this._members;return this._members=t,this._subStatusJoin(t,!0),n}}},{key:"_onDocTeamNotify",value:function(e){e=JSON.parse(e.body);var t=k.decode(e.event_data),n=this._updateMembers(JSON.parse(t));switch(e.header.event_type){case"status_update":this._onUpdateStatusResp(t,n);break;case"status_leave":this._onLeaveResponse(t)}}},{key:"_onAuthResponse",value:function(e){"OK"===e?this._joinDocumentTeam(_):(this._close(),this._reProcLogin())}},{key:"_onJoinResponse",value:function(e){if(500===(e=JSON.parse(e)).code)return this._close(),void this._reProcLogin();if(this._updateMembers(e.data),this._lockStatus)if(this._status===_)this._subStatusJoin(e.data.Members);else if(409===e.code){var t=this._getOneOtherClientUser(e.data.Members);t&&I(!0,t.userid),this._joinDocumentTeam(_)}else{var n=window.__WPSENV__.file_info.user.id;""!=this._lastConflictUserid&&(n=this._lastConflictUserid,this._lastConflictUserid=""),I(!1,n)}}},{key:"_kickScheme",value:function(){var e=this;this.kickUser(),this._timeTicker=setTimeout((function(){e._leaveDocumentTeam()}),this._unLockTime)}},{key:"_subStatusJoin",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._canKick(e);if(i.result&&!n)this._joinDocumentTeam(m),this._timeTicker=setTimeout((function(){t._leaveDocumentTeam()}),this._unLockTime);else if(i.shoudldkick)I(!0,window.__WPSENV__.file_info.user.id,(function(){window.__WPSENV__.conflictLock.getInfor().isLockMode&&t._kickScheme(),console.log("window.__WPSENV__.conflictLock","fresh","lock")}));else{var o=this._getOneOtherClientUser(e);o&&I(!0,o.userid)}}},{key:"_onLeaveResponse",value:function(e){console.log(e)}},{key:"kickUser",value:function(){this._joinDocumentTeam(m)}},{key:"_onUpdateStatusResp",value:function(e,t){if(e=JSON.parse(e),this._status===_&&this._canWrite(e.Members)){this._isReadOnly()&&this._checkVersion();var n=this._getOneOtherClientUser(t);n&&I(!1,n.userid)}}},{key:"_isReadOnly",value:function(){return/(\?|\&)readonly/i.test(window.location.search)}},{key:"_leaveDocumentTeam",value:function(){var e=this;if(this.holdLocked)console.log("holding the editor lock");else{var t={fileId:this._fileId,status:m};this._lockStatus=!1,this._status=_,this._call(p,t,(function(t){t=JSON.parse(t);var n=k.decode(t.event_data);e._onLeaveResponse(n),window.collection2("web_locked_edit_false")}))}}},{key:"_joinDocumentTeam",value:function(e){var t=this,n={fileId:this._fileId,status:e};e===m&&(this._lockStatus=!0),this._status=e,this._call(d,n,(function(e){try{e=JSON.parse(e);var n=k.decode(e.event_data);t._onJoinResponse(n)}catch(t){new Error("JOIN_DOCTEAM:"+e)}}))}},{key:"_getOneOtherClientUser",value:function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];if("web"!==n.clientType)for(var i=0;i<n.status.length;i++)if(n.status[i]===m)return this._lastConflictUserid=n.userid,{userid:n.userid,jointime:n.jointime,clienttype:n.clientType}}}},{key:"_canKick",value:function(e){if(!e)return{result:!0};for(var t=!1,n=!0,i="",o=0;o<e.length;o++){var a=e[o];if(!window.__WPSENV__.file_info)return{result:!1,shoudldkick:!1};if("web"!==a.clientType)for(var r=0;r<a.status.length;r++)if(a.status[r]===m){n=!1,t=!0,i=a.clientType;break}}if(n)return{result:!0};if(t)for(var s=0;s<e.length;s++){var l=e[s];if(window.__WPSENV__.file_info.user.id!==l.userid&&"web"!==l.clientType)for(var u=0;u<l.status.length;u++)if(l.status[u]===m)return{result:!1,shoudldkick:!1}}return{result:!1,shoudldkick:!0,clienttype:i}}},{key:"_canWrite",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if("web"!==n.clientType)for(var i=0;i<n.status.length;i++)if(n.status[i]===m)return this._lastConflictUserid=n.userid,!1}return!0}},{key:"close",value:function(e){this._stop=!0,this._close(e)}},{key:"_close",value:function(e){if(this._ws){switch(this._lockStatus=!1,this._ws.readyState){case WebSocket.CONNECTING:case WebSocket.OPEN:e?this._ws.close(e):this._ws.close()}try{this._ws.onclose=C,this._ws.onopen=C,this._ws.onmessage=C,this._ws.onerror=C}catch(e){}this._ws=null,this._penddingCall={}}}},{key:"_send",value:function(e,t,n){if(!this._ws)return!1;if(this._ws.readyState!=WebSocket.OPEN)return!1;var i=JSON.stringify(n),o=S(e,t,i);return this._ws.send(o),!0}},{key:"_call",value:function(e,t,n){if(!this._ws)return!1;if(this._ws.readyState!=WebSocket.OPEN)return!1;try{var i=this._nextMsgId;this._nextMsgId++;var o=[0,i];if(this._send(o,e,t)){var a="0-"+i;return this._penddingCall[a]=n,!0}return!1}catch(e){return!1}}}]),e}(),O=function(){var e=this;this._init=function(t){e._unLockTime=6e5;var n=window.parseInt(localStorage.getItem("WEB_LOCK_TIMES"));return!window.isNaN(n)&&n>0&&(e._unLockTime=1e3*n),e._nextMsgId=1,e._fileId=t,e._penddingCall={},e._lastConflictUserid="",e._stop=!1,e._status="",e._lockStatus=!1,e._timeTicker=null,e._members=null,!e._isOnlineMode&&(!(0,u.isSupportCollaborationSwitch)()&&(e._procLogin(),!e._isOnlineMode&&((!window.__WPSENV__.file_info||!window.__WPSENV__.file_info.file||"open"!==window.__WPSENV__.file_info.file.collaboration_switch_status)&&(e._lock=e._lock.bind(e),e.holdLocked=!1,window.addEventListener(r.EVENT.ON_DOCUMENT_SAVEING,e._lock),window.addEventListener(r.EVENT.ET_EVENT_ENTER_EDIT,e._triggerLock),window.addEventListener(r.EVENT.MO_ET_EDIT_MODE_BEGIN,e._triggerLock),void window.addEventListener(r.EVENT.ON_DOCUMENT_SAVEING_HOLDING_LOCK,e._holdLock)))))},this._holdLock=function(t){var n=t.detail.holdLocked;e.holdLocked=n,e._lock()},this._triggerLock=function(){window.__WPSENV__.conflictLock.tryLock(!1)},this.failTimes=0};t.default=E},1145:function(e,t,n){"use strict";n.d(t,"b",(function(){return m}));var i=n(8),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(13),c=n.n(u),h=n(1537),d=n(1538),p=window.__WPSENV__.font_name_map||{},f=window.__WPSENV__.cjk_font_name||{},g=c()({"Bahnschrift Condensed":"Bahnschrift","Bahnschrift Light":"Bahnschrift","Bahnschrift Light Condensed":"Bahnschrift","Bahnschrift Light SemiCondensed":"Bahnschrift","Bahnschrift SemiBold":"Bahnschrift","Bahnschrift SemiBold Condensed":"Bahnschrift","Bahnschrift SemiBold SemiConden":"Bahnschrift","Bahnschrift SemiCondensed":"Bahnschrift","Bahnschrift SemiLight":"Bahnschrift","Bahnschrift SemiLight Condensed":"Bahnschrift","Bahnschrift SemiLight SemiConde":"Bahnschrift","TypeLand 康熙字典體 Trial":"TypeLand KhangXi Dict Trial","W0w0砍":"DFPPuDing-B5","W0w?箾bria Math":"DFPMo-B5","W0w輈輈":"DFPWaWa-B5",default:"SimSun","苹方-简":"PingFang SC","仿宋":"FangSong","仿宋_GB2312":"FangSong_GB2312","冬青黑体简体中文 W3":"Hiragino Sans GB W3","冬青黑体简体中文":"Hiragino Sans GB","华康俪金黑W8":"DFLiJinHeiW8-GB","华康俪金黑W8(P)":"DFPLiJinHeiW8-GB","华康新综艺W7(P)":"DFPZongYiW7-GB","华康雅宋体W9":"DFYaSongW9-GB","华康雅宋体W9(P)":"DFPYaSongW9-GB","华文中宋":"STZhongsong","华文仿宋":"STFangsong","华文宋体":"STSong","华文彩云":"STCaiyun","华文新魏":"STXinwei","华文楷体":"STKaiti","华文琥珀":"STHupo","华文细黑":"STXihei","华文行楷":"STXingkai","华文隶书":"STLiti","华文黑体":"STHeiti","宋体":"SimSun","宋体-简":"Songti SC","宋体-方正超大字符集":"Simsun (Founder Extended)","思源宋体 CN":"Source Han Serif CN","思源黑体 CN":"Source Han Sans CN","思源黑体 CN Regular":"Source Han Sans CN Regular","幼圆":"YouYuan","张海山草泥马体":"ZHSCNMT-GBK","张海山锐线体简":"ZHSRXT-GBK","微软雅黑":"Microsoft YaHei","微软雅黑 Light":"Microsoft YaHei Light","德彪钢笔行书字库":"LiDeBiao-Xing3","文尓广告中宋":"Keage-w5","新宋体":"NSimSun","方正中倩简体":"FZZhongQian-M16S","方正中倩繁体":"FZZhongQian-M16T","方正中楷繁体":"FZZhongKai-B08T","方正中等线简体":"FZZhongDengXian-Z07S","方正中等线繁体":"FZZhongDengXian-Z07T","方正书宋简体":"FZShuSong-Z01S","方正书宋繁体":"FZShuSong-Z01T","方正仿宋_GBK":"FZFangSong-Z02","方正仿宋简体":"FZFangSong-Z02S","方正仿宋繁体":"FZFangSong-Z02T","方正俊黑简体":"FZJunHeiS-R-GB","方正兰亭超细黑简体":"FZLanTingHeiS-UL-GB","方正准圆简体":"FZZhunYuan-M02S","方正准圆繁体":"FZZhunYuan-M02T","方正剪纸简体":"FZJianZhi-M23S","方正剪纸繁体":"FZJianZhi-M23T","方正北魏楷书简体":"FZBeiWeiKaiShu-S19S","方正北魏楷书繁体":"FZBeiWeiKaiShu-Z15T","方正华隶简体":"FZHuaLi-M14S","方正华隶繁体":"FZHuaLi-M14T","方正卡通简体":"FZKaTong-M19S","方正卡通繁体":"FZKaTong-M19T","方正古隶简体":"FZGuLi-S12S","方正古隶繁体":"FZGuLi-S12T","方正启体简体":"FZQiTi-S14S","方正启体繁体":"FZQiTi-S14T","方正喵呜体":"FZMiaoWuS-GB","方正大标宋_GBK":"FZDaBiaoSong-B06","方正大标宋简体":"FZDaBiaoSong-B06S","方正大标宋繁体":"FZDaBiaoSong-B06T","方正大黑简体":"FZDaHei-B02S","方正大黑繁体":"FZDaHei-B02T","方正姚体":"FZYaoTi","方正姚体简体":"FZYaoTi-M06S","方正姚体繁体":"FZYaoTi-M06T","方正宋一简体":"FZSongYi-Z13S","方正宋一繁体":"FZSongYi-Z13T","方正宋三简体":"FZSong III-Z05S","方正宋刻本秀楷简体":"FZSongKeBenXiuKaiS-R-GB","方正宋黑简体":"FZSongHei-B07S","方正宋黑繁体":"FZSongHei-B07T","方正小标宋简体":"FZXiaoBiaoSong-B05S","方正小标宋繁体":"FZXiaoBiaoSong-B05T","方正小篆体":"FZXiaoZhuanTi-S13T","方正少儿简体":"FZShaoEr-M11S","方正少儿繁体":"FZShaoEr-M11T","方正平和简体":"FZPingHe-S11S","方正平和繁体":"FZPingHe-S11T","方正平黑繁体":"FZPingHei-B04T","方正幼线简体":"FZYouXian-Z09S","方正幼线繁体":"FZYouXian-Z09T","方正康体简体":"FZKangTi-S07S","方正康体繁体":"FZKangTi-S07T","方正彩云简体":"FZCaiYun-M09S","方正彩云繁体":"FZCaiYun-M09T","方正报宋简体":"FZBaoSong-Z04S","方正报宋繁体":"FZBaoSong-Z04T","方正新书宋繁体":"FZNew ShuSong-Z10T","方正新报宋简体":"FZNew BaoSong-Z12S","方正新秀丽繁体":"FZNew XiuLi-Z11T","方正新舒体简体":"FZNew ShuTi-S08S","方正新舒体繁体":"FZNew ShuTi-S08T","方正显仁简体":"FZXianRenS-R-GB","方正楷体简体":"FZKai-Z03S","方正楷体繁体":"FZKai-Z03T","方正正中黑_GBK":"FZZhengHei-DB-GBK","方正正中黑简体":"FZZhengHeiS-DB-GB","方正正准黑简体":"FZZhengHeiS-M-GB","方正正大黑_GBK":"FZZhengHei-EB-GBK","方正正粗黑简体":"FZZhengHeiS-B-GB","方正正纤黑_GBK":"FZZhengHei-EL-GBK","方正毡笔黑简体":"FZZhanBiHei-M22S","方正毡笔黑繁体":"FZZhanBiHei-M22T","方正水柱简体":"FZShuiZhu-M08S","方正水柱繁体":"FZShuiZhu-M08T","方正水黑简体":"FZShuiHei-M21S","方正水黑繁体":"FZShuiHei-M21T","方正淘淘简体":"FZTTJW","方正清刻本悦宋简体":"FZQingKeBenYueSongS-R-GB","方正琥珀简体":"FZHuPo-M04S","方正琥珀繁体":"FZHuPo-M04T","方正瘦金书简体":"FZShouJinShu-S10S","方正瘦金书繁体":"FZShouJinShu-S10T","方正硬笔楷书简体":"FZYingBiKaiShu-S15S","方正硬笔楷书繁体":"FZYingBiKaiShu-S15T","方正硬笔行书_GBK":"FZYingBiXingShu-S16","方正硬笔行书简体":"FZYingBiXingShu-S16S","方正硬笔行书繁体":"FZYingBiXingShu-S16T","方正祥隶简体":"FZXiangLi-S17S","方正祥隶繁体":"FZXiangLi-S17T","方正稚艺简体":"FZZhiYi-M12S","方正稚艺繁体":"FZZhiYi-M12T","方正粗倩_GBK":"FZCuQian-M17","方正粗倩简体":"FZCuQian-M17S","方正粗倩繁体":"FZCuQian-M17T","方正粗圆简体":"FZCuYuan-M03S","方正粗圆繁体":"FZCuYuan-M03T","方正粗宋简体":"FZCuSong-B09S","方正粗宋繁体":"FZCuSong-B09T","方正粗谭黑简体":"FZTanHeiS-B-GB","方正粗黑繁体":"FZCuHei-B03T","方正细倩简体":"FZXiQian-M15S","方正细倩繁体":"FZXiQian-M15T","方正细圆_GBK":"FZXiYuan-M01","方正细圆简体":"FZXiYuan-M01S","方正细圆繁体":"FZXiYuan-M01T","方正细珊瑚简体":"FZXiShanHu-M13S","方正细珊瑚繁体":"FZXiShanHu-M13T","方正细等线简体":"FZXiDengXian-Z06S","方正细黑一简体":"FZXiHei I-Z08S","方正细黑一繁体":"FZXiHei I-Z08T","方正综艺简体":"FZZongYi-M05S","方正综艺繁体":"FZZongYi-M05T","方正美黑简体":"FZMeiHei-M07S","方正胖头鱼简体":"FZPangTouYu-M24S","方正胖娃简体":"FZPangWa-M18S","方正胖娃繁体":"FZPangWa-M18T","方正舒体":"FZShuTi","方正舒体简体":"FZShuTi-S05S","方正舒体繁体":"FZShuTi-S05T","方正艺黑简体":"FZYiHei-M20S","方正艺黑繁体":"FZYiHei-M20T","方正苏新诗柳楷简体":"FZSuXinShiLiuKaiS-R-GB","方正行楷简体":"FZXingKai-S04S","方正行楷繁体":"FZXingKai-S04T","方正行黑简体":"FZXingHeiS-R-GB","方正超粗黑_GBK":"FZChaoCuHei-M10","方正超粗黑简体":"FZChaoCuHei-M10S","方正超粗黑繁体":"FZChaoCuHei-M10T","方正铁筋隶书简体":"FZTieJinLiShu-S17S","方正铁筋隶书繁体":"FZTieJinLiShu-Z14T","方正隶书简体":"FZLiShu-S01S","方正隶书繁体":"FZLiShu-S01T","方正隶二简体":"FZLiShu II-S06S","方正隶二繁体":"FZLiShu II-S06T","方正隶变简体":"FZLiBian-S02S","方正隶变繁体":"FZLiBian-S02T","方正风雅宋简体":"FZFengYaSongS-GB","方正魏碑简体":"FZWeiBei-S03S","方正魏碑繁体":"FZWeiBei-S03T","方正黄草_GBK":"FZHuangCao-S09","方正黄草简体":"FZHuangCao-S09S","方正黑体_GBK":"FZHei-B01","方正黑体简体":"FZHei-B01S","方正黑体繁体":"FZHei-B01T","方正兰亭大黑_GBK":"FZLanTingHei-EB-GBK","李林哥特中文(试用版）":"AHGTZGete","楷体":"KaiTi","楷体_GB2312":"KaiTi_GB2312","百度综艺简体":"BDZongYi-A001","等线":"DengXian","等线 Light":"DengXian Light","超世纪粗古印":"JetLink BoldOldStamp","造字工房力黑（非商用）常规体":"MF LiHei (Noncommercial) Regular","造字工房尚雅准宋 G0v1 常规体":"RTWS ShangYaZhunSung G0v1 Regular","造字工房悦黑 G0v1 常规体":"RTWS YueGothic G0v1 Regular","造字工房悦黑 G0v1 特细体":"RTWS YueGothic G0v1 Ultra Light","造字工房悦黑 G0v1 特细超长体":"RTWS YueGothic G0v1 Ultra Light Compressed","造字工房悦黑 G0v1 特细长体":"RTWS YueGothic G0v1 Ultra Light Condensed","造字工房悦黑 G0v1 纤细体":"RTWS YueGothic G0v1 Extra Light","造字工房悦黑 G0v1 纤细超长体":"RTWS YueGothic G0v1 Extra Light Compressed","造字工房悦黑 G0v1 纤细长体":"RTWS YueGothic G0v1 Extra Light Condensed","造字工房悦黑 G0v1 细体":"RTWS YueGothic G0v1 Light","造字工房悦黑 G0v1 细长体":"RTWS YueGothic G0v1 Light Condensed","隶书":"LiSu","黑体":"SimHei","黑体-简":"Heiti SC","黑体-简 细体":"Heiti SC Light","黑体-繁 细体":"Heiti TC Light","汉仪中等线KW":"HYZhongDengXianKW","汉仪中黑KW":"HYZhongHeiKW","汉仪书宋二KW":"HYShuSongErKW","汉仪仿宋KW":"HYFangSongKW","汉仪君黑KW 55J":"HYJunHeiKW 55J","汉仪君黑KW 85J":"HYJunHeiKW 85J","汉仪旗黑KW 55S":"HYQiHeiKW 55S","汉仪旗黑KW 85S":"HYQiHeiKW 85S","汉仪楷体KW":"HYKaiTiKW","报隶-繁":"Baoli TC","標楷體":"DFKaiShu-SB-Estd-BF","冬青黑简体中文":"Hiragino Sans GB","汉仪楷体 KW":"HYKaiTiKW","黑体-繁":"Heiti TC","楷体-繁":"Kaiti TC","兰亭黑-繁":"Lantinghei TC","隶变-繁":"Libian TC","凌慧体-繁":"LingWai TC","圆体-繁":"Yuanti TC","手札体-繁":"Hannotate TC","翩翩体-繁":"Hanzipen TC","宋体-繁":"Songti TC","苹方-繁":"Pingfang TC","魏碑-繁":"Weibei TC","娃娃体-繁":"Wawati TC","娃娃体-简":"Wawati SC","苹方-港":"PingFang HK","方正楷体_GBK":"FZKai-Z03","方正隶书_GBK":"FZLiShu-S01","方正书宋_GBK":"FZShuSong-Z01","方正魏碑_GBK":"FZWeiBei-S03","方正小标宋_GBK":"FZXiaoBiaoSong-B05","方正细黑一_GBK":"FZXiHeiI-Z08","方正行楷_GBK":"FZXingKai-S04","方正姚体_GBK":"FZYaoTi-M06","方正宋体S-超大字符集":"FZSongS-Extended","方正宋体S-超大字符集(SIP)":"FZSongS-Extended(SIP)"},p),v=new(function(){function e(){var t=this;r()(this,e),this.CJKSupported=new Set(["Adobe Fangsong Std","Adobe 仿宋 Std","Adobe Fan Heiti Std","Adobe Gothic Std","Adobe Heiti Std","Adobe 黑体 Std","Adobe Kaiti Std","Adobe 楷体 Std","Adobe Ming Std","Adobe Myungjo Std M","Adobe Song Std","Adobe 宋体 Std","Arial Unicode MS","DFKai-SB","Kozuka Gothic Pr6N","Kozuka Gothic Pro","Kozuka Mincho Pr6N","Kozuka Mincho Pro","Malgun Gothic","MS PMincho","MS Mincho","MS Gothic","MS PGothic","MS UI Gothic","HanaMinPlus","Source Han Sans","Source Han Serif","Yu Gothic","Yu Mincho","Microsoft JhengHei","Microsoft YaHei","Noto Sans CJK JP","Noto Sans CJK KR","Noto Sans CJK SC","Noto Sans CJK TC","Noto Sans Mono CJK JP","Noto Sans Mono CJK KR","Noto Sans Mono CJK SC","Noto Sans Mono CJK TC","Noto Serif CJK JP","Noto Serif CJK KR","Noto Serif CJK SC","Noto Serif CJK TC","FangSong","SimHei","KaiTi","AppleGothic","AppleMyungjo","GB18030 Bitmap","STHupo","Hei","Kai","Microsoft JhengHei Light","Microsoft JhengHei UI","Microsoft JhengHei UI Light","Microsoft YaHei UI","Microsoft YaHei UI Light","MingLiU","MingLiU_HKSCS","PMingLiU","STFangsong","STHeiti","STKaiti","STSong","仿宋","兰亭黑-简","冬青黑体简体中文","凌慧体-简","华文中宋","华文仿宋","华文新魏","华文楷体","华文琥珀","华文行楷","华文隶书","娃娃体-简","圆体-简","宋体","宋体-简","微软雅黑","手札体-简","报隶-简","新宋体","楷体","楷体-简","翩翩体-简","苹方-简","行楷-简","隶变-简","雅痞-简","魏碑-简","黑体","黑体-简","Apple LiGothic","Apple LiSung","BiauKai","Hiragino Sans CNS","LiHei Pro","LiSong Pro","兰亭黑-繁","凌慧体-繁","圆体-繁","娃娃体-繁","宋体-繁","手札体-繁","报隶-繁","楷体-繁","翩翩体-繁","苹方-港","苹方-繁","行楷-繁","隶变-繁","雅痞-繁","苹方-简","仿宋","仿宋_GB2312","冬青黑体简体中文 W3","冬青黑体简体中文","华康俪金黑W8","华康俪金黑W8(P)","华康新综艺W7(P)","华康雅宋体W9","华康雅宋体W9(P)","华文中宋","华文仿宋","华文宋体","华文彩云","华文新魏","华文楷体","华文琥珀","华文细黑","华文行楷","华文隶书","华文黑体","宋体","宋体-简","宋体-方正超大字符集","思源宋体 CN","思源黑体 CN","思源黑体 CN Regular","幼圆","张海山草泥马体","张海山锐线体简","微软雅黑","微软雅黑 Light","德彪钢笔行书字库","文尓广告中宋","新宋体","方正中倩简体","方正中倩繁体","方正中楷繁体","方正中等线简体","方正中等线繁体","方正书宋简体","方正书宋繁体","方正仿宋_GBK","方正仿宋简体","方正仿宋繁体","方正俊黑简体","方正兰亭超细黑简体","方正准圆简体","方正准圆繁体","方正剪纸简体","方正剪纸繁体","方正北魏楷书简体","方正北魏楷书繁体","方正华隶简体","方正华隶繁体","方正卡通简体","方正卡通繁体","方正古隶简体","方正古隶繁体","方正启体简体","方正启体繁体","方正喵呜体","方正大标宋_GBK","方正大标宋简体","方正大标宋繁体","方正大黑简体","方正大黑繁体","方正姚体","方正姚体简体","方正姚体繁体","方正宋一简体","方正宋一繁体","方正宋三简体","方正宋刻本秀楷简体","方正宋黑简体","方正宋黑繁体","方正小标宋简体","方正小标宋繁体","方正小篆体","方正少儿简体","方正少儿繁体","方正平和简体","方正平和繁体","方正平黑繁体","方正幼线简体","方正幼线繁体","方正康体简体","方正康体繁体","方正彩云简体","方正彩云繁体","方正报宋简体","方正报宋繁体","方正新书宋繁体","方正新报宋简体","方正新秀丽繁体","方正新舒体简体","方正新舒体繁体","方正显仁简体","方正楷体简体","方正楷体繁体","方正正中黑_GBK","方正正中黑简体","方正正准黑简体","方正正大黑_GBK","方正正粗黑简体","方正正纤黑_GBK","方正毡笔黑简体","方正毡笔黑繁体","方正水柱简体","方正水柱繁体","方正水黑简体","方正水黑繁体","方正淘淘简体","方正清刻本悦宋简体","方正琥珀简体","方正琥珀繁体","方正瘦金书简体","方正瘦金书繁体","方正硬笔楷书简体","方正硬笔楷书繁体","方正硬笔行书_GBK","方正硬笔行书简体","方正硬笔行书繁体","方正祥隶简体","方正祥隶繁体","方正稚艺简体","方正稚艺繁体","方正粗倩_GBK","方正粗倩简体","方正粗倩繁体","方正粗圆简体","方正粗圆繁体","方正粗宋简体","方正粗宋繁体","方正粗谭黑简体","方正粗黑繁体","方正细倩简体","方正细倩繁体","方正细圆_GBK","方正细圆简体","方正细圆繁体","方正细珊瑚简体","方正细珊瑚繁体","方正细等线简体","方正细黑一简体","方正细黑一繁体","方正综艺简体","方正综艺繁体","方正美黑简体","方正胖头鱼简体","方正胖娃简体","方正胖娃繁体","方正舒体","方正舒体简体","方正舒体繁体","方正艺黑简体","方正艺黑繁体","方正苏新诗柳楷简体","方正行楷简体","方正行楷繁体","方正行黑简体","方正超粗黑_GBK","方正超粗黑简体","方正超粗黑繁体","方正铁筋隶书简体","方正铁筋隶书繁体","方正隶书简体","方正隶书繁体","方正隶二简体","方正隶二繁体","方正隶变简体","方正隶变繁体","方正风雅宋简体","方正魏碑简体","方正魏碑繁体","方正黄草_GBK","方正黄草简体","方正黑体_GBK","方正黑体简体","方正黑体繁体","方正兰亭大黑_GBK","李林哥特中文(试用版）","楷体","楷体_GB2312","百度综艺简体","等线","等线 Light","超世纪粗古印","造字工房力黑（非商用）常规体","造字工房尚雅准宋 G0v1 常规体","造字工房悦黑 G0v1 常规体","造字工房悦黑 G0v1 特细体","造字工房悦黑 G0v1 特细超长体","造字工房悦黑 G0v1 特细长体","造字工房悦黑 G0v1 纤细体","造字工房悦黑 G0v1 纤细超长体","造字工房悦黑 G0v1 纤细长体","造字工房悦黑 G0v1 细体","造字工房悦黑 G0v1 细长体","隶书","黑体","黑体-简","黑体-简 细体","黑体-繁 细体","汉仪中等线KW","汉仪中黑KW","汉仪书宋二KW","汉仪仿宋KW","汉仪君黑KW 55J","汉仪君黑KW 85J","汉仪旗黑KW 55S","汉仪旗黑KW 85S","汉仪楷体KW","报隶-繁","標楷體","冬青黑简体中文","汉仪楷体 KW","黑体-繁","楷体-繁","兰亭黑-繁","隶变-繁","凌慧体-繁","圆体-繁","手札体-繁","翩翩体-繁","宋体-繁","苹方-繁","魏碑-繁","娃娃体-繁","娃娃体-简","苹方-港","方正楷体_GBK","方正隶书_GBK","方正书宋_GBK","方正魏碑_GBK","方正小标宋_GBK","方正细黑一_GBK","方正行楷_GBK","方正姚体_GBK","方正宋体S-超大字符集","方正宋体S-超大字符集(SIP)","微软简标宋","BatangChe","文星标宋","汉仪猴嗨森体简","Meiryo","小标宋","创艺简标宋","哈咯字体"].concat(o()(f))),this.CJKSupported_PS=new Set([]),this.CJKSupported.forEach((function(e){var n=g[e];n&&t.CJKSupported_PS.add(n)}))}return l()(e,[{key:"has",value:function(e){return this.CJKSupported.has(e)||this.CJKSupported_PS.has(e)}}]),e}());function m(e){return"Bahnschrift Condensed"!=e&&"Bahnschrift Light"!=e&&"Bahnschrift Light Condensed"!=e&&"Bahnschrift Light SemiCondensed"!=e&&"Bahnschrift SemiBold"!=e&&"Bahnschrift SemiBold Condensed"!=e&&"Bahnschrift SemiBold SemiConden"!=e&&"Bahnschrift SemiCondensed"!=e&&"Bahnschrift SemiLight"!=e&&"Bahnschrift SemiLight Condensed"!=e&&"Bahnschrift SemiLight SemiConde"!=e&&!!(v.has(e)||Object(h.isSimplifiedChineseFontFamily)(e)||Object(d.isTraditionalChineseFontFamily)(e))}var _={"PingFang SC":!0,"Hiragino Sans GB":!0,STHeiti:!0,"Songti SC":!0,"Source Han Serif CN":!0,"Source Han Sans CN":!0,"Source Han Sans CN Regular":!0,"Heiti SC":!0},y={"宋体":["汉仪书宋二KW","方正宋体","方正书宋_GBK"],"仿宋":["汉仪仿宋KW","方正仿宋_GBK"],"楷体":["汉仪楷体KW","方正楷体_GBK"],"黑体":["汉仪中黑KW","方正黑体_GBK"],"等线":["汉仪中等线KW"]},b=function(){function e(){r()(this,e)}return l()(e,null,[{key:"getFontName",value:function(e){var t=g[e],n=!0;return null==t?(this.isChineseFont(e)?(t="SimSun",n=!1):t=e,{fontName:t,ret:n}):(_[t]&&(t="SimSun",n=!1),{fontName:t,ret:n})}},{key:"getMatchListByFamilyName",value:function(e){var t={"仿宋":y["仿宋"],"宋体":y["宋体"],"楷体":y["楷体"],"黑体":y["黑体"]},n=null;return Object.keys(t).some((function(i){if(-1!=e.indexOf(i))return n=t[i].concat(i),!0})),n}},{key:"getPureFontName",value:function(e){return g[e]}},{key:"isChineseFont",value:function(e){for(var t=e.length,n=!1,i=0;i<t;i++)if(0!=(65280&e.charCodeAt(i))){n=!0;break}return n}}]),e}();t.a=b},1146:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCommentHide=t.isLoadedAuditComment=t.isRefusalToAppeal=t.checkReportVisible=t.checkVisible=t.auditComments=t.CommentAudit=t.CommentShowType=t.CommentType=t.COMMENT_REVIEW_STATUS=t.ReviewAttr=void 0;var i,o,a,r,s=n(5),l=n(2183),u=s.__importDefault(n(260));!function(e){e[e.PASS=0]="PASS",e[e.IN_REVIEW=1]="IN_REVIEW",e[e.FORBID=2]="FORBID",e[e.UN_REVIEW=3]="UN_REVIEW"}(i||(i={})),t.COMMENT_REVIEW_STATUS=i,function(e){e.TEXT="text",e.VOICE="voice"}(o||(o={})),t.CommentType=o,function(e){e[e.visible=0]="visible",e[e.forbid=1]="forbid",e[e.loading=2]="loading",e[e.forbidFeedback=3]="forbidFeedback"}(a||(a={})),t.CommentShowType=a,function(e){e[e.FORBIDAPPEALABLE=0]="FORBIDAPPEALABLE",e[e.APPEALABLE=1]="APPEALABLE"}(r||(r={})),t.ReviewAttr=r;var c=function(e){var t,n,o,a,s,l;return{id:e.comment_id,status:null!==(n=null===(t=e.content)||void 0===t?void 0:t.review_status)&&void 0!==n?n:i.IN_REVIEW,userId:null!==(a=null===(o=e.user_info)||void 0===o?void 0:o.id)&&void 0!==a?a:null,attr:e.content.review_attr,isRefusalToAppeal:(null===(s=e.content)||void 0===s?void 0:s.review_attr)===r.FORBIDAPPEALABLE&&(null===(l=e.content)||void 0===l?void 0:l.review_status)===i.FORBID}},h=function(e){var t=v.get(e);if(!t&&window.APP.commentsDataManager&&window.APP.commentsDataManager.commentsCache){var n=window.APP.commentsDataManager.commentsCache.get(e);n&&(t=c(n))}return t},d=function(e){return s.__awaiter(void 0,void 0,Promise,(function(){var t;return s.__generator(this,(function(n){switch(n.label){case 0:return[4,(i=e,s.__awaiter(void 0,void 0,void 0,(function(){var e;return s.__generator(this,(function(t){switch(t.label){case 0:return[4,window.__WPSENV__.reduxDispatch((0,l.auditCommentList)(i))];case 1:return!(e=t.sent())||e.error?[2,null]:[2,e.response.body]}}))}))).catch(console.error)];case 1:return(t=n.sent())?[2,t.Data.reduce((function(e,t){var n=t.comment_id,i=c(t);return e.set(n,i),e}),new Map)]:[2,new Map]}var i}))}))},p=function(e){var t=a.visible;if(!e)return t;var n=h(e);if(!n)return t;var o=n.userId===window.__WPSENV__.user_id;if(n.status===i.FORBID)t=n.attr===r.FORBIDAPPEALABLE?a.forbidFeedback:a.forbid;else{if(n.status===i.PASS||n.status===i.UN_REVIEW)return t;o||(t=a.loading)}return t};t.checkVisible=p;t.checkReportVisible=function(e){var t=e.authorId,n=e.commentId;if(!n)return!1;var i=window.__WPSENV__.file_info.user;if(t===i.id)return!1;var o,r=null,s=window.APP.commentsDataManager.commentsCache.get(n);return s&&(r=s.user_info&&s.user_info.attrs&&s.user_info.attrs.company_id),(!i.attrs||r!==i.attrs.company_id||"0"===r)&&(!!(o=window.__WPSPLUGIN__.helper).has(o.types.ReportComment)&&p(n)===a.visible)};var f=function(e){if(!e)return!1;var t=h(e);return!!t&&t.isRefusalToAppeal};t.isRefusalToAppeal=f;var g=!1;t.isLoadedAuditComment=function(){return g};t.isCommentHide=function(e){if(!e)return!1;var t=!1,n=window.APP.data.doc.commentBubbles.getBubblesByRange(e.pos,e.len);n&&n.length>0&&n.some((function(n){return!!(n.data||[]).some((function(t){return t.comment_id===e.comment_id}))&&(t=f(n.data[0].comment_id),!0)}));var i=f(e.comment_id);return!(!t&&!i)};var v=new Map;t.auditComments=v;var m=function(){function e(){}var n;return n=e,e.subscribed=!1,e.subscribes=function(){n.subscribed||(n.subscribed=!0,n.updateAuditComments(),window.addEventListener(u.default.comments.ON_COMMENT_TEXT_REVIEW,n.handleTextAudit))},e.unsubscribes=function(){n.subscribed=!1,window.removeEventListener(u.default.comments.ON_COMMENT_TEXT_REVIEW,n.handleTextAudit)},e.handleTextAudit=function(t){var n=t.detail.message;if(n){var i=JSON.parse(n),o=i.type,a=i.comment_id;"review_result"===o&&e.updateCommentById(a)}},e.updateAuditComments=function(){return s.__awaiter(void 0,void 0,void 0,(function(){var e;return s.__generator(n,(function(n){switch(n.label){case 0:return e={review_status:"".concat(i.IN_REVIEW,",").concat(i.FORBID)},[4,d(e)];case 1:return t.auditComments=v=n.sent(),g=!0,u.default.dispatchEvent(u.default.comments.GET_ONLINE_AUDIT_COMMENTS),[2,v]}}))}))},e.updateCommentById=function(e){return s.__awaiter(void 0,void 0,void 0,(function(){var t,i,o;return s.__generator(n,(function(n){switch(n.label){case 0:return e?(t={cids:"".concat(e)},[4,d(t)]):[2,v];case 1:return i=n.sent(),(o=i.get(e))&&(v.set(e,o),u.default.dispatchEvent(u.default.comments.GET_ONLINE_AUDIT_COMMENTS)),[2,v]}}))}))},e}();t.CommentAudit=m},1168:function(e,t,n){"use strict";function i(){var e=this.objp_pool,t=void 0;if(0===e.length)switch(arguments.length){case 0:t=new this;break;case 1:t=new this(arguments[0]);break;case 2:t=new this(arguments[0],arguments[1]);break;case 3:t=new this(arguments[0],arguments[1],arguments[2]);break;case 4:t=new this(arguments[0],arguments[1],arguments[2],arguments[3]);break;default:t=new(Function.prototype.bind.apply(this,[null].concat(Array.prototype.slice.call(arguments))))}else(t=e.pop()).init.apply(t,arguments);return t}function o(){this.term&&this.term(),this.constructor.objp_pool.push(this)}function a(){var e=this.objp_pool,t=void 0;if(0===e.length?((t=new(Function.prototype.bind.apply(this,[null].concat(Array.prototype.slice.call(arguments))))).objp_use=!0,++this.objp_totalNew):((t=e.pop()).objp_use&&console.log("[ObjectPool] double used!"),t.objp_use=!0,t.init.apply(t,arguments)),this.objp_verbose){var n=void 0;try{throw Error()}catch(e){n=e.stack}this.objp_traces.set(t,n)}return++this.objp_totalmake,t}function r(){var e=this.constructor,t=e.objp_pool;e.objp_verbose&&e.objp_traces.delete(this),this.objp_use?(this.objp_use=!1,this.term&&this.term(),t.push(this),++e.objp_totalfree):console.log("[ObjectPool] double free!")}function s(){var e=this.objp_pool,t=void 0;return 0===e.length?((t=this.newobj.apply(this,arguments)).free=this.objp_free,t.objp_vt=this):(t=e.pop()).init.apply(t,arguments),t}function l(){this.term&&this.term(),this.objp_vt.objp_pool.push(this)}function u(){var e=this.objp_pool,t=void 0;if(0===e.length?((t=this.newobj.apply(this,arguments)).free=this.objp_free,t.objp_vt=this,t.objp_use=!0,++this.objp_totalNew):((t=e.pop()).objp_use&&console.log("[ObjectPool] double used!"),t.objp_use=!0,t.init.apply(t,arguments)),this.objp_verbose){var n=void 0;try{throw Error()}catch(e){n=e.stack}this.objp_traces.set(t,n)}return++this.objp_totalmake,t}function c(){var e=this.objp_vt,t=e.objp_pool;e.objp_verbose&&e.objp_traces.delete(this),this.objp_use?(this.objp_use=!1,this.term&&this.term(),t.push(this),++e.objp_totalfree):console.log("[ObjectPool] double free!")}n.d(t,"a",(function(){return h}));var h={debugTypes:[],debug:!1,desc:function(){var e="[ObjectPool]\n";return this.debugTypes.sort((function(e,t){return t.objp_totalmake-e.objp_totalmake})),this.debugTypes.forEach((function(t){e+="\t"+t.objp_desc()+"\n"})),e},buildType:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.debug||t,l=e.objp_pool=[];e.make=s?a:i,e.prototype.free=s?r:o,s&&(n&&(e.objp_verbose=!0,e.objp_traces=new Map),e.objp_totalNew=0,e.objp_totalmake=0,e.objp_totalfree=0,e.objp_loss=function(){return e.objp_totalmake!==e.objp_totalfree?"*":" "},e.objp_desc=function(){var t="new: "+e.objp_totalNew+",\tmax: "+l.length+",\tobjp_loss: "+(e.objp_totalmake-e.objp_totalfree)+",\tmake: "+e.objp_totalmake+",\t["+e.objp_loss()+e.name+"]";return e.objp_verbose&&(t+="\n"+e.objp_traces),t},this.debugTypes.push(e))},buildVT:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.debug||n,a=e.objp_pool=[];e.name=t,e.make=o?u:s,e.objp_free=o?c:l,o&&(i&&(e.objp_verbose=!0,e.objp_traces=new Map),e.objp_totalNew=0,e.objp_totalmake=0,e.objp_totalfree=0,e.objp_loss=function(){return e.objp_totalmake!==e.objp_totalfree?"*":" "},e.objp_desc=function(){var t="new: "+e.objp_totalNew+",\tmax: "+a.length+",\tobjp_loss: "+(e.objp_totalmake-e.objp_totalfree)+",\tmake: "+e.objp_totalmake+",\t["+e.objp_loss()+e.name+"]";return e.objp_verbose&&(t+="\n"+e.objp_traces),t},this.debugTypes.push(e))}}},1169:function(e,t,n){"use strict";n.d(t,"g",(function(){return S})),n.d(t,"d",(function(){return P})),n.d(t,"f",(function(){return I})),n.d(t,"a",(function(){return E})),n.d(t,"c",(function(){return O})),n.d(t,"b",(function(){return x})),n.d(t,"e",(function(){return R}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(410),d=n(952),p=n(310),f=n(1319),g=n(535),v=n(614),m=n(4970),_=n(4971),y=n(554),b=n(805);function T(e){var t=window.g_rpt.defaultFactory.createObjectForSvr(v.default.OType_Nake,"",{data:e},null);return t.writeLock=function(){},t}var C=new g.AbsObject,k=null;function w(e){return null===k&&(k=T({})),e.constructor&&(e.constructor.name===C.constructor.name||e.constructor.name===k.constructor.name)}function S(e){return w(e)?e:T(Object(b.deepCopyer)(e))}var P=function(){function e(t,n,i,o){l()(this,e),this.init(t,n,i,o)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:p.ITRange,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i){var o=n;if(o&&!w(o))throw new Error("need AbsObject !");o||(o=new g.AbsObject),this.mixin_ITRange_init(e,t),this.data=o,this.refId=i}},{key:"getData",value:function(){return this.data}},{key:"cloneData",value:function(){return{pos:this.pos,len:this.len,data:this.data}}}]),e}(),I=function(e){Object(_.a)(e),e.insertRange=function(e){var t=this,n={classType:this.rangeClass.classType,data:e};m.a.doInTransact("insertRange",n,(function(){var e={name:"doInsertRange",param:n};m.a.recordAndExec(t,e)}))},e.removeRange=function(e){var t=this,n={classType:this.rangeClass.classType,data:e};m.a.doInTransact("removeRange",n,(function(){var e={name:"doRemoveRange",param:n};m.a.recordAndExec(t,e)}))},e.reset=function(e,t,n){var i=this,o=e,a=t;o>0&&(--o,++a),a++,this.rangeClass.collectRanges(o,a).forEach((function(e){i.doRemoveNakedRange(e)})),n.forEach((function(e){i.doInsertNakedRange(e)}))},e.doInsertRange=function(e,t){t?this.doInsertNakedRange(e.data):this.doRemoveNakedRange(e.data)},e.doRemoveRange=function(e,t){this.doInsertRange(e,!t)}},E=function(){function e(t,n,i){l()(this,e),this.init(t,n,i)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"RBAttacher",base:f.b,methodName:"init"},{baseName:"RBAttacher",base:f.b,methodName:"attach"}]}}]),c()(e,[{key:"init",value:function(e,t,n){this.mixin_RBAttacher_init(e,t),this.refIds=n}},{key:"attach",value:function(e){this.mixin_RBAttacher_attach(e),e.refId&&(this.refIds[e.refId]=e),this.toolkit._dispatch("onAttachNode",e)}}]),e}(),O=function(){function e(t,n,i){l()(this,e),this.init(t,n,i)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRCAttacher",base:E,methodName:"init"},{baseName:"DOCRCAttacher",base:E,methodName:"attach"}]}}]),c()(e,[{key:"init",value:function(e,t,n){this.mixin_DOCRCAttacher_init(e,t,n),this.keyword=new p.BeginWithKeyword}},{key:"attach",value:function(e){var t=e.begin,n=e.end,i=this.toolkit;this.keyword.config(t);var o={};i.fetchInfo(o,t,n,this.keyword)&&n<o.end&&(i.detachNode(o.node),o.node.reset(n,o.end),this.mixin_DOCRCAttacher_attach(o.node)),this.mixin_DOCRCAttacher_attach(e)}}]),e}(),x=function(){function e(t,n){l()(this,e),this.init(t,n)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"RBDetacher",base:f.c,methodName:"init"},{baseName:"RBDetacher",base:f.c,methodName:"detach"}]}}]),c()(e,[{key:"init",value:function(e,t){this.mixin_RBDetacher_init(e),this.refIds=t}},{key:"detach",value:function(e){this.mixin_RBDetacher_detach(e),e.refId&&delete this.refIds[e.refId],this.toolkit._dispatch("onDetachNode",e)}}]),e}(),R=function(e){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.IT.upper,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.IT.NonIntersect,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:p.ITHintVT;l()(this,t);var u=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i,a,r,s));return Object(y.default)(u),u.document=e,u.classType=n,u.refIds={},u.document.attachObserver(u),d.a.bind(u,"attacher",(function(e){return new E(e,e.sortby,e.refIds)})),d.a.bind(u,"detacher",(function(e){return new x(e,e.refIds)})),u}return r()(t,e),c()(t,[{key:"clearAll",value:function(){this.document.detachObserver(this)}},{key:"onInsertText",value:function(e,t,n,i){this.expand(t,n.length)}},{key:"onDeleteText",value:function(e,t,n){this.remove(t,n.length)}},{key:"findRangeByRefId",value:function(e){return this.refIds[e]}},{key:"collectRanges",value:function(e,t){return this.mapInRange(e,e+t,(function(e){return e._node.cloneData()}),p.IT.strictIntersectTest)}}]),t}(p.ITToolkit);h.a.mix(P,p.ITRange),h.a.mix(E,f.b),h.a.mix(O,E),h.a.mix(x,f.c)},1170:function(e,t,n){"use strict";n.r(t),n.d(t,"getCommentMode",(function(){return h})),n.d(t,"getTempCommentData",(function(){return d})),n.d(t,"getTempBubbleData",(function(){return p})),n.d(t,"getCommentPluginState",(function(){return f})),n.d(t,"isInTempComment",(function(){return g})),n.d(t,"getTempData",(function(){return v})),n.d(t,"getTempComment",(function(){return m})),n.d(t,"isTempCommentId",(function(){return _})),n.d(t,"isTempBubbleId",(function(){return y})),n.d(t,"isTempCommentAt",(function(){return b})),n.d(t,"renderElements",(function(){return T}));var i=n(238),o=n.n(i),a=n(966),r=n(1808);n.d(t,"TEMP",(function(){return a.TEMP}));var s=n(677),l=n(1320),u={id:a.TEMP,type:a.CR_TYPE.comments,range:{pos:-1,len:-1}},c={comment_id:a.TEMP,rc_id:a.TEMP,comment_type:"text",body:{pos:-1,len:-1}};function h(){var e=window.APP&&window.APP.appApi&&window.APP.appApi.getCommentShowStatus?window.APP.appApi.getCommentShowStatus():{commentBubble:!1,commentPanel:!1},t=e.commentBubble,n=e.commentPanel;return t?0:n?1:void 0}function d(e){var t=JSON.parse(JSON.stringify(c));return e&&(t.date=e),t}function p(e,t,n){var i=JSON.parse(JSON.stringify(u));return e&&(i.range=e),t&&(i.data=[t]),n&&(i.id=n),i}function f(){var e={};if(window.APP.uilManager){var t=window.APP.uilManager.getModuleState(s.b.SELECTION,l.a.COMMENT);t&&(e=t)}return e}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h(),t=!1;if(0===e){if(window.APP&&window.APP.workspace&&window.APP.workspace.revisionComment){var n=window.APP.workspace.revisionComment.dataHandler,i=n.tempCommentId,o=n.reEditCommentId;(_(i)||o)&&(t=!0)}}else if(1===e){var a=f();(a.currentCommentId&&_(a.currentCommentId)||a.currentReeditCommentId)&&(t=!0)}return t}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h(),t={};if(0===e){var n=window.APP.workspace.revisionComment.dataHandler,i=n.tempBubbleId,o=n.tempCommentId,a=n.tempRcId,r=n.tempReplyId,s=n.tempReplyTo,l=n.tempRange,u=n.reEditCommentId,c=n.tempTrueCommentId;t={tempBubbleId:i,tempCommentId:o,tempRcId:a,tempReplyId:r,tempRange:l,tempReplyTo:s,reEditCommentId:u,trueCommentId:c}}else if(1===e){var d=f(),p=d.currentBubbleId,g=d.currentCommentId,v=d.currentRcId,m=d.currentReplyId,_=d.currentReplyTo,y=d.tempRange,b=d.currentReeditCommentId,T=d.tempTrueCommentId;t={tempBubbleId:p,tempCommentId:g,tempRcId:v,tempReplyId:m,tempRange:y,tempReplyTo:_,reEditCommentId:b,trueCommentId:T}}return t}function m(){var e={comment_type:"text",comment_id:a.TEMP,rc_id:a.TEMP,pos:-1};if(!g())return e;var t=v().tempRcId;if(t&&t!==a.TEMP){var n=window.APP.data.doc.comments.getCommentByRcId(t);n&&(e=n)}return e}function _(e){return e===a.TEMP}function y(e){return e===a.TEMP}function b(){return g()&&Object(r.hasTempAtDom)()}function T(e){var t=e.elements,n=e.isMore,i=e.showPlaceholder,a=e.text,r=e.className;if(n&&i){var s=t[0],l=t.slice(1,t.length-1),u=t[t.length-1],c=[s];return c.push(o.a.createElement("p",{key:2,className:r||null},o.a.createElement("svg",{width:"9",height:"6",viewBox:"0 0 9 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o.a.createElement("path",{d:"M0.75 1.5L4.50009 5L8.25 1.5",stroke:"#0063F4","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})),a.replace("{0}",l.length))),c.push(u),c}return t}},1202:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeSupportCollaborationSwitch=t.isSupportCollaborationSwitch=t.isShowCollaborationSwitch=void 0;var i=n(5).__importDefault(n(82)),o=n(167),a=[i.default.pdf,i.default.image,i.default.whiteboard,i.default.unknown];t.isShowCollaborationSwitch=function(e){return void 0===e&&(e=!0),window.__WPSENV__.file_info&&window.__WPSENV__.file_info.file&&window.__WPSENV__.file_info.file.collaboration_switch_status&&window.__CONFIG__.isCollaborationSwitchGroupType?a.includes(window.officeType)?null:window.__CONFIG__.isShowCollaborationSwitch?-1===document.cookie.indexOf("wps_endcloud=1")?null:o.isMobile?(window.__WPSENV__.isSupportCollaborationSwitch=!0,!0):e&&!window.__WPSENV__.isNewUI?null:!(!e&&window.officeType!==i.default.dbsheet)||null:null:null};t.isSupportCollaborationSwitch=function(){return window.__WPSENV__.isSupportCollaborationSwitch},t.changeSupportCollaborationSwitch=function(e){window.__WPSENV__.isSupportCollaborationSwitch=e}},1238:function(e,t,n){"use strict";n.r(t),n.d(t,"typoToPositionWithLoading",(function(){return m}));var i=n(167),o=n(3481),a=n.n(o),r=n(3482),s=n.n(r),l=n(247),u=void 0,c={show:function(e,t){u||(u=document.createElement("div"),document.body.appendChild(u)),t?window.APP.frontUtil.ReactDom.render(Object(l.default)(s.a,{loading:c,onClick:e}),u):window.APP.frontUtil.ReactDom.render(Object(l.default)(a.a,{loading:c,onClick:e}),u)},update:function(e,t){u&&window.APP.frontUtil.ReactDom.render(Object(l.default)(a.a,{loading:c,onClick:e,progress:t}),u)},hide:function(){u&&(window.APP.frontUtil.ReactDom.unmountComponentAtNode(u),document.body.removeChild(u),u=null)}},h=c,d=n(1732),p=null,f=null,g={start:function(e){var t=function(){h.hide(),e()};p=setTimeout((function(){h.show(t,i.isMobile)}),500),f=setTimeout((function(){t(),h.hide(),window.Toast.error(_i18n("applications.writer.components.other.LocateLoading.timeout", "A timeout error occurred while getting the location."))}),6e4)},update:function(e,t){i.isMobile||h.update(e,t)},end:function(e){clearTimeout(p),clearTimeout(f),setTimeout((function(){h.hide()}),e||i.isMobile?0:2e3)}},v=!0;function m(e){if(!v)return Promise.reject();var t=void 0;v=!1;var n=new Promise((function(n,i){(t=Object(d.h)(e,g)).then((function(e){v=!0,n(e)})).catch((function(){v=!0,i()}))}));return n.cancel=function(){t.cancel&&(t.cancel(),g.end(!0))},n.isPoll=t.isPoll,n}},1251:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"f",(function(){return s})),n.d(t,"a",(function(){return l}));var i=3,o=1,a=2,r=0,s=4,l=7},1252:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a}));var i={Unknown:0,View:1,TextPage:2,TextLine:3,TableLine:4,Cell:5,CellPage:6,SnippetLine:7,SnippetScene:8,LayoutPage:9,MainPage:10,DrawingFrame:11,MobileView:12,MobilePage:13,Pending:14,Comments:15,ShapeScene:16,Zone:17,CommentView:18,CommentPage:19,FootEndNote:20,FootEndNotePage:21,FootEndNotes:22},o={0:"Unknown",1:"View",2:"TextPage",3:"TextLine",4:"TableLine",5:"Cell",6:"CellPage",7:"SnippetLine",8:"SnippetScene",9:"LayoutPage",10:"MainPage",11:"DrawingFram",12:"MobileView",13:"MobilePage",14:"Pending",15:"Comments",16:"ShapeScene",17:"Zone",18:"CommentView",19:"CommentPage",20:"FootEndNote",21:"FootEndNotePage",22:"FootEndNotes"},a={Unknown:-1,Canvas:0,LayoutPage:1,TextPage:2,CellPage:3,TextFramePage:4,MobileView:5,MobilePage:6,CommentView:7,CommentPage:8,FootEndNotePage:9}},1285:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(310),l=function(){function e(){o()(this,e)}return r()(e,null,[{key:"locate",value:function(t,n,i,o,a,r){r.enter(o);var s=e.locatePage(t,n,i,o,a,r);return r.exit(),s}},{key:"locatePage",value:function(e,t,n,i,o,a){for(var r=i.lines,s=0;s<r.length;++s){var l=r[s];if(t>l.range.pos&&t<l.range.pos+l.range.len||n&&t===l.range.pos+l.range.len||!n&&t===l.range.pos){if(d.locate(e,t,n,l,{},o,a))return!0}}return!1}}]),e}(),u=function(){function e(){o()(this,e)}return r()(e,null,[{key:"locate",value:function(t,n,i,o,a,r,s){s.enter(o);var l=e.locateCell(t,n,i,o,a,r,s);return s.exit(),l}},{key:"locateCell",value:function(e,t,n,i,o,a,r){return!!o&&!!l.locate(e,t,n,o,a,r)}}]),e}(),c=n(626),h=n(1252),d=function(){function e(){o()(this,e)}return r()(e,null,[{key:"locate",value:function(t,n,i,o,a,r,s,l,u){s.enter(o);var c=e.locateLine(t,n,i,o,a,r,s,l,u);return s.exit(),c}},{key:"getNotesOrNotePlaceholderWidth",value:function(e,t){for(var n=t[e],i=n.widthSum,o=n.beginOffset,a=e+1;a<t.length;){var r=t[a];if(!(r.isFootnote()||r.isEndnote()||r.isNotePlaceholder())||r.beginOffset!==o)break;i+=r.widthSum,++a}return i}},{key:"locateLine",value:function(t,n,i,o,a,r,s,l,u){var d=n,p=i;if(o.inEqZone)return!1;if(o.isSnippetLine&&0===d&&0===o.range.pos)return Object.assign(r,{isLineLastChar:!1,position:0,charWidth:0,height:0,posX:0,posY:0,charPosY:0,charHeight:0,line:o}),!0;if(o.tablecells)return e.tablecellsLocate(t,d,p,o.tablecells,o,r,s);if(o.sublines)return e.sublineLocate(t,d,p,o.sublines,a,r,s);var f=t.selection.selContext,g=f.isChangedByEdit,v=f.isChangedByFuncKeys,m=f.prevSelInfo;!g||p||m&&!m.glyphTail||(p=o.range.len>1&&d===o.range.pos+o.range.len-1),p&&--d<0&&(d=0,p=!1);var _=s.getCoorPos2Worspace();if("line"===l){var y=o.line_origin.y||o.glyphGroupInfos&&o.glyphGroupInfos[0]&&o.glyphGroupInfos[0].y||0;return Object.assign(r,{isLineLastChar:!0,position:0,charWidth:0,height:0,posX:_.x,posY:_.y+y,charPosY:0,charHeight:0,line:null}),!0}var b=c.a.add(s.position,o.position2parent,o.offset4child);o.composeProcess&&o.composeProcess(!1,b);var T=o.glyphGroupInfos;if(!T||T.length<=0)return Object.assign(r,{isLineLastChar:!0,position:0,charWidth:0,height:0,posX:_.x,posY:_.y,charPosY:0,charHeight:0,line:o}),!0;for(var C=0,k=0,w=void 0,S=o.range.pos,P=o.range.pos+o.range.len,I=T.length;C<I;++C){if(d<(w=T[C]).endOffset+S){k=d-w.beginOffset-S;break}C==I-1&&(k=P-w.beginOffset-S,r.notInLine=!0)}if(C>T.length)return!1;r.isLineLastChar=C>=T.length-1&&k==w.widths.length-1,r.position=w.beginOffset+S+k,w.isCombine&&p&&(r.position+=w.endOffset-w.beginOffset-1);var E=w.widths;r.charWidth=w.isFootnote()||w.isEndnote()||w.isNotePlaceholder()?e.getNotesOrNotePlaceholderWidth(C,T):E[k]||0,r.height=o.rect.bottom-o.rect.top,r.drawHeight=w.zone.getLineDrawHeight&&w.zone.getLineDrawHeight(w);var O=w.x;if(w.isLayoutRTL){O+=w.widthSum;for(var x=0;x<k;++x)O-=E[x]}else for(var R=0;R<k;++R)O+=E[R];var N=O,A=w.y,D=A;if("lineEnd"===l?(N=o.rect.left+o.endPos,r.type="lineEnd",p&&(r.position+=1)):"lineHome"===l||d===o.range.pos&&!p&&v?(N=o.rect.left+o.homePos,r.type="lineHome"):p&&(N+=w.isLayoutRTL?-r.charWidth:r.charWidth,r.position+=1),void 0!==o.baseline){var M=A+(w.zone.getDrawBaseline&&w.zone.getDrawBaseline(o.baseline,w)||o.baseline)-w.metrics.ascent;D=Math.max(A,M),r.charHeight=Math.max(0,Math.min(M+w.metrics.height-D,A+r.height-D))}else r.charHeight=r.height;if(w.oMath){var L=w.oMath.locate(k,p);N=w.x+L.x,A=w.y+o.baseline-w.oMath.baseline+L.y-(L.charHeight-L.height)/2,r.charHeight=L.charHeight,r.drawHeight=r.charHeight,r.height=L.charHeight,D=A}r.line=o,r.glyphTail=p;var F=s.getCurrentCoor().node,B=F.textflow;if("T2B"===B.corX){if(B.isReverseLine){var H=F.rect.width-o.rect.top-o.rect.height;A=A-o.rect.top+H,D=D-o.rect.top+H}r.posX=_.x+F.rect.width-A,r.posY=_.y+N,r.charPosY=r.posY,r.charPosX=_.x+F.rect.width-D-r.charHeight,r.isTranspose=!0}else"B2T"===B.corX?(r.posX=_.x+A,r.posY=_.y+F.rect.height-N,r.charPosY=r.posY,r.charPosX=_.x+D,r.isTranspose=!0):(r.posX=_.x+N,r.posY=_.y+A,r.charPosY=_.y+D,r.charPosX=r.posX);if(F.parent.layoutType===h.c.ShapeScene){var G=F.parent.getTextBoxRect(),W=_.x-F.rect.left+G.left,j=_.y-F.rect.top+G.top;r.clipRect={left:W,top:j,width:G.width,height:G.height}}else if(F.layoutType===h.c.CellPage&&F.parent.diagCell){var U=_.x-F.rect.left,V=_.y-F.rect.top,Y=F.parent,z=Y.rect,K=z.width,Z=z.height;if(Y.nextMergedCell){for(var X=Y.nextMergedCell;X.nextMergedCell;)X=X.nextMergedCell;Z=X.parent.rect.bottom-Y.parent.rect.top}r.clipRect={left:U,top:V,width:K,height:Z}}return r.posX=Math.round(r.posX),r.posY=Math.round(r.posY),r.charPosY=Math.round(r.charPosY),r.charPosX=Math.round(r.charPosX),r.clipRect&&(r.isTranspose?"B2T"===B.corX?(r.charPosX>r.clipRect.left+r.clipRect.width&&(r.charPosX=Math.floor(r.clipRect.left+r.clipRect.width)),r.posX>r.clipRect.top+r.clipRect.height&&(r.posX=Math.floor(r.clipRect.left+r.clipRect.width))):(r.charHeight+r.charPosX<r.clipRect.left&&(r.charPosX=Math.ceil(r.clipRect.left-r.charHeight)),r.charHeight+r.posX<r.clipRect.left&&(r.poxX=Math.ceil(r.clipRect.left-r.charHeight))):(r.charPosY>r.clipRect.top+r.clipRect.height&&(r.charPosY=Math.floor(r.clipRect.top+r.clipRect.height)),r.posY>r.clipRect.top+r.clipRect.height&&(r.posY=Math.floor(r.clipRect.top+r.clipRect.height)))),r.glyphGroupInfo=w,!0}},{key:"sublineLocate",value:function(t,n,i,o,a,r,s){for(var l=0;l<o.length;++l){var u=o[l];if(n>u.range.pos&&n<u.range.pos+u.range.len||i&&n===u.range.pos+u.range.len||!i&&n===u.range.pos)return!!e.locateLine(t,n,i,u,a,r,s)}return!1}},{key:"tablecellsLocate",value:function(e,t,n,i,o,a,r){if(!i)return!1;if(n&&t===o.range.pos+o.range.len||!n&&t===o.range.pos+o.range.len-1){var s=r.getCoorPos2Worspace();return a.position=t,a.charWidth=0,a.height=o.rect.bottom-o.rect.top,a.posX=s.x+(o.isRTL?o.rect.left:o.rect.right),a.posY=s.y+o.rect.top,a.charPosY=a.posY,a.charHeight=16,a.line=o,!0}for(var l=function(e){var i=e.range,o=i.pos,a=i.len;return t>o&&t<o+a||n&&t===o+a||!n&&t===o},c=0;c<i.length;++c){var h=i[c],d=h.diagCell?h.diagCell.pages.find((function(e){return l(e)})):h.cell_page&&l(h.cell_page)&&h.cell_page;if(d)return!!u.locate(e,t,n,h,d,a,r)&&(a.tablecellIdx=c,!0)}return!1}}]),e}(),p=n(1915),f=n(908),g=n(3079),v=function(){function e(){o()(this,e)}return r()(e,null,[{key:"locate",value:function(e,t,n,i){var o=n?t-1:t,a=e.doc.commentBodys.getCommentByPos(o);if(!a)return!1;var r=i.getCommentView(),l=i.getCommentPage(a.rc_id);if(r&&l){var u={},h=(r.textLineRanges.findNodeContainPos(o,s.IT.Include)||{}).line;if(h){var v=p.a.findCoorNode(h),m=h.parent,_=f.a.transvertPositionFromNode2Target(m,v),y=f.a.transvertPositionFromNode2Target(v,r),b=c.a.reduce(c.a.add(_,y),m.position2parent),T=p.a.initFakeContext(m,_,b,g.b,r.viewOffset);if(d.locate(e,t,n,h,{},u,T))return u.isInComment=!0,u}}return!1}}]),e}(),m=n(411),_=n(1291),y=n(309),b=n(4809),T=n(1032),C=n(3080),k={config:function(e,t){k.pos=e,k.layoutIndex=t},eq:function(e){return e.end===k.pos&&(void 0===k.layoutIndex||k.layoutIndex==e._node.line.viewPage.layout_index)}},w={config:function(e,t,n){w.pos=e,w.rule=t,w.layoutIndex=n},eq:function(e){var t=w.pos,n=e.begin,i=e.end;return!(n==t&&w.rule==s.IT.Exclude||i==t&&w.rule==s.IT.Include)&&(n<=t&&t<=i&&(null==w.layoutIndex||w.layoutIndex==e._node.line.viewPage.layout_index))}},S=new s.PointKeyword;var P=function(){function e(){o()(this,e)}return r()(e,null,[{key:"locateLine",value:function(t,n,i,o,a){var r=t.doc,l=t.selection.selContext,u=t.selection.selInfo,c=l.isInHeaderFooter?l.headerfooterLayoutIndex:void 0;if(u){var h=u.isRepeatHeaderRow(n),d=h.repeatHeaderPageIndex,p=h.isRepeat,f=h.isRepeatCellArr;if(p&&d>-1){var g=f[0].begin,v=f[f.length-1].end;n>=g&&n<=v&&(c=d)}}if(-1==r.getSubDocType(n))return!1;var m=r.getLimitedRange(n),_=i&&n>m.pos?n-1:n,y=i?s.IT.Exclude:s.IT.Include,b=null;return k.config(_+1,c),(b=o.tableLineRanges.findNode(_+1,_+1,k))?b.line:(w.config(n,y,c),(b=o.textLineRanges.findNode(n,n,w))?b.line:a?(S.config(n,s.IT.Include),b=o.textLineRanges.seekNode(S,!0),l.isInHeaderFooter&&!b?e.locateLine(t,m.pos,!1,o,!1):b?b.line:null):null)}},{key:"locate",value:function(t,n,i,o,a){var r=i,s=n,l=e.locateLine(t,s,r,o,!0);if(!l)return!1;var u={},h=l.parent===l||l instanceof _.a?l.parent.parent:l.parent,v=p.a.findCoorNode(l),y=f.a.transvertPositionFromNode2Target(h,v),b=f.a.transvertPositionFromNode2Target(v,o),T=c.a.reduce(c.a.add(y,b),h.position2parent),C=window.APP.isMobileMode()||window.APP.isWebMode(),k=C?o.viewOffset:l.viewPage.viewOffset,w=p.a.initFakeContext(h,y,T,g.b,k);if(d.locate(t,n,i,l,{},u,w,a)){return C||l.scene.layoutType!==m.DOCLayoutType.ShapeScene?e.locateInMainPage(l,t,s,r,u):e.locateInTextbox(l,t,s,r,u)}return!1}},{key:"checkIsTargetNode",value:function(e){return e.layoutType===m.DOCLayoutType.MainPage||e.footer_type}},{key:"locateInMainPage",value:function(t,n,i,o,a){for(var r=t.viewPage,s=window.APP.isMobileMode()||window.APP.isWebMode(),l=0,u=0,c=t.parent;null!==c&&!e.checkIsTargetNode(c);)c.layoutType===m.DOCLayoutType.Cell&&(l+=c.cell2page_offset.x,u+=c.cell2page_offset.y),c=c.parent;if(a.charPosX+=l,a.charPosY+=u,a.posY+=u,a.posX+=l,!s){var h=c;n.selection.selContext.isInHeaderFooter||r.isDecorativePage?a.isInFooter=h===r.footer:a.pageIdx=r.mainpages.findIndex((function(e){return e===h}))}return a.layoutIndex=r.layout_index,a.subDocType=n.selection.selContext.isInHeaderFooter?y.HeaderFooter:y.MainText,a}},{key:"locateInTextbox",value:function(e,t,n,i,o){var a=e.viewPage;if(!(window.APP.isMobileMode()||window.APP.isWebMode())){o.pageIdx=0;for(var r=0,s=0,l=e.parent;null!==l&&m.DOCLayoutType.ShapeScene!==l.layoutType;)l.layoutType===m.DOCLayoutType.Cell&&(r+=l.cell2page_offset.x,s+=l.cell2page_offset.y),l=l.parent;o.charPosX+=r,o.charPosY+=s,o.posY+=s,o.posX+=r}o.layoutIndex=a.layout_index,o.subDocType=y.Textbox;for(var u=e.parent;u&&!(u instanceof b.a);)u=u.parent;return u&&(o.shapeIdxPathOfTextbox=u.shapeIdxPath,o.shapeTreeTypeOfTextbox=u.shape_tree_type),o.isInTextbox=!0,o}},{key:"locateRect",value:function(e,t,n,i){var o=e.selection.selContext,a=o.isInHeaderFooter?o.headerfooterLayoutIndex:void 0;w.config(t,s.IT.Include,a);var r=[];i.textLineRanges.forEachHintInRange(t,t+n,(function(e){var t=function(e){for(var t=e;t&&!(t instanceof T.d);)t=t.parent;return t}(e._node.line);t&&!r.includes(t)&&r.push(t)}),s.IT.strictIntersectTest);var l=[];return r.forEach((function(e){var o=p.a.findCoorNode(e),a=f.a.transvertPositionFromNode2Target(e,o),r=f.a.transvertPositionFromNode2Target(o,i),s=window.APP.isMobileMode()||window.APP.isWebMode()?i.viewOffset:e.viewPage.viewOffset,u=c.a.add(a,r,s);Object(C.getRangesRects)([{pos:t,len:n}],e).forEach((function(e){e.addOffset(u),l.push(e)}))})),l.length&&l}}]),e}(),I=function(){function e(){o()(this,e)}return r()(e,null,[{key:"locate",value:function(e,t,n,i,o){var a=e.doc.getSubDocRange(y.Comment);if(t>=a.pos&&t<a.pos+a.len||t===a.pos+a.len&&n)return v.locate(e,t,n,i);if(window.APP.isPCMode()||window.APP.isPaginationMode())for(var r=0;r<i._layout_pages.length&&!(i.pagePos[r].beginPos>t);++r)i.getLayoutPageCache(r);if(e.typoinfo.updater){var s=e.doc.getSubDocRange(y.MainText),l=t===s.pos+s.len?t:t+1;e.typoinfo.updater.updateToPosInContext(e,l)}return P.locate(e,t,n,i,o)}},{key:"locateRect",value:function(e,t,n,i){var o=e.doc.getSubDocRange(y.Comment),a=t+n;if(t>=o.pos&&t<o.pos+o.len||a===o.pos+o.len)return null;if(window.APP.isPCMode()||window.APP.isPaginationMode())for(var r=0;r<i._layout_pages.length&&!(i.pagePos[r].beginPos>a);++r)i.getLayoutPageCache(r);return e.typoinfo.updater&&e.typoinfo.updater.updateToPosInContext(e,a),P.locateRect(e,t,n,i)}}]),e}();t.b=I},1290:function(e,t,n){"use strict";n.r(t),n.d(t,"shallowEqual",(function(){return f})),n.d(t,"getNextWord",(function(){return g})),n.d(t,"parseFieldCode",(function(){return v})),n.d(t,"isRangeIntersect",(function(){return m})),n.d(t,"toParams",(function(){return _})),n.d(t,"NODETYPE",(function(){return y})),n.d(t,"getLinks",(function(){return T})),n.d(t,"getMentions",(function(){return C})),n.d(t,"getHyperlinks",(function(){return k})),n.d(t,"getCatalogs",(function(){return w})),n.d(t,"getPictures",(function(){return S})),n.d(t,"handleTypes",(function(){return P})),n.d(t,"getRelatedUserIdsByContent",(function(){return I}));var i,o=n(13),a=n.n(o),r=n(8),s=n.n(r),l=n(144),u=n.n(l),c=n(30),h=n.n(c),d=n(1806),p=n(698),f=function(e,t){if(e!==t)if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1}else{var o=Object.keys(e),a=Object.keys(t);if(o.length!==a.length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}return!0};function g(e,t){for(var n="",i=t;" "===e[i];)++i;for(var o=!1;i<e.length;++i)if('"'===e[i]){if(o)break;o=!0}else n+=e[i];return++i,{string:n.trim(),idx:i}}function v(e){for(var t=[],n={},i=0;" "===e[i];)++i;for(;i<e.length;)if('"'===e[i]){var o=g(e,i);t.push(o.string),i=o.idx}else if("\\"===e[i]){var a=g(e,++i+1);n[e[i]]=a.string,i=a.idx}else++i;return{params:t,switchs:n}}function m(e,t){return!(e.pos+e.len<=t.pos||e.pos>=t.pos+t.len)}function _(e){return e.split("&").reduce((function(e,t){var n=t.indexOf("="),i=t.slice(0,n),o=t.slice(n+1);return void 0!==i&&void 0!==o&&("type"===i?e._type=o:e[i]=o),e}),{})}var y={TEXT:"text",MENTION:"mention",PICTURE:"picture",HYPERLINK:"hyperlink",CATALOG:"catalog"},b=(i={},h()(i,y.MENTION,"mentionNodes"),h()(i,y.HYPERLINK,"linkNodes"),h()(i,y.CATALOG,"catalogNodes"),i);function T(e){var t,n=window.APP.data.doc,i=e.pos,o=e.len,a=n.fields.getFields({begin:i,end:i+o}),r=[],s=[],l=[];return a.forEach((function(e){var t=e.pos,i=e.len,o=e._node;if("HYPERLINK"===o.type){var a=n.getText(t,i),c=a.match(/\x13 HYPERLINK "kw:mention\?(.+)" \x14@(.+)\x15/);if(c){var h=u()(c,3),f=h[1],g=h[2],v=_(f);v.userid&&(v.userid=parseInt(v.userid)),v.classes=d.classes.mention;var m={pos:t,len:i,text:"@"+g,attrs:v};return void s.push(m)}var y=a.match(/\x13 HYPERLINK "(.+)" \x14(.+)\x15/);if(y){var b=u()(y,3),T=b[1],C=b[2];r.push({pos:t,len:i,text:Object(p.filterSpecialPlaceholder)(C),link:T,classes:d.classes.link})}}else if("TOC"===o.type){var k={pos:t,len:i,text:Object(p.getText)({pos:t,len:i})};l.push(k)}})),t={},h()(t,b[y.MENTION],s),h()(t,b[y.HYPERLINK],r),h()(t,b[y.CATALOG],l),t}function C(e){return T(e)[b[y.MENTION]]}function k(e){return T(e)[b[y.HYPERLINK]]}function w(e){return T(e)[b[y.CATALOG]]}function S(e){var t=window.APP.data.doc,n=e.pos,i=e.len,o=t.inlineAnchors.getAnchors(n,i),a=t.anchors.getAnchors(n,i);return[].concat(s()(o),s()(a)).map((function(e){var t=(e.anchor||{len:0}).len;return e.len=t,e}))}function P(e,t,n){var i=t.pos,o=t.len,r=i+o-1,s=[];if(n){var l=n.hyperlinks,u=void 0===l?[]:l,c=n.range;s=u.map((function(e){var t=a()({},e.params);return a()({},c,{text:e.text.slice(1),attrs:t,_nType:y.MENTION})}))}var h=void 0,d=Object.keys(e).reduce((function(n,i){var o=void 0;(b[i]&&(h||(h=T(t)),o=h[b[i]]),o)||(o=(0,e[i])(t));return o.forEach((function(e){return e._nType=i})),n.concat(o)}),s).sort((function(e,t){return(e.pos||0)-(t.pos||0)}));return d.length?d.reduce((function(e,t,n){var o=t.pos,a=t.len;if(i<o){var s=i,l=o-i,u={pos:s,len:l,text:Object(p.getText)({pos:s,len:l}),_nType:y.TEXT};e.push(u)}if(e.push(t),i=o+a,n===d.length-1&&i<r){var c=i,h=r-i,f={pos:c,len:h,text:Object(p.getText)({pos:c,len:h}),_nType:y.TEXT};e.push(f)}return e}),[]):[{pos:i,len:o,text:Object(p.getText)({pos:i,len:o}),_nType:y.TEXT}]}var I=function(e,t){var n=new Set(t||[]);return e.replace(/\x13 HYPERLINK "kw:mention\?(.+?)" \x14@.+?\x15/g,(function(e,t){var i=_(t).userid;i&&n.add(i)})),Array.from(n)}},1291:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(3077),d=n(400),p=n(626),f=n(411),g=n(908),v=n(7202),m=n(7203),_=n(336),y=n(6103),b=n(6107),T=n(5741),C=n(1591),k=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.compose,u=n.textline,c=n.pageOffsetFromServer;o()(this,t);var p=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r}));return p.compose=s,p._paraFirst=void 0,p._isUpdateRequired=!0,p.zones=[],p.border={},p.isMoc?(p.rect=d.a.ZERO(),p.range=new h.a(u.range.pos,u.range.pos+u.range.len,p)):u&&p._initFromRawData(u,c),p}return c()(t,e),r()(t,[{key:"isCoorSystem",value:function(){return!1}},{key:"_initFromRawData",value:function(e,t){null!=e.isSnippetLine&&(this.is_frame_line=e.isSnippetLine),null!=e.beforeBorder&&(this.border.before_width=Math.round(Object(_.Ti2Px)(parseInt(e.beforeBorder)))),null!=e.afterBorder&&(this.border.after_width=Math.round(Object(_.Ti2Px)(parseInt(e.afterBorder)))),null!=e.leftBorder&&(this.border.left_width=Math.round(Object(_.Ti2Px)(parseInt(e.leftBorder)))),null!=e.rightBorder&&(this.border.right_width=Math.round(Object(_.Ti2Px)(parseInt(e.rightBorder)))),null!=e.beforeSpace&&(this.before_space=Object(_.Ti2Px)(parseInt(e.beforeSpace))),null!=e.afterSpace&&(this.after_space=Object(_.Ti2Px)(parseInt(e.afterSpace))),null!=e.baseLine&&(this.baseline=Object(_.Ti2Px)(e.baseLine)),null!=e.hangIndent&&(this.hang_indent=Object(_.Ti2Px)(parseInt(e.hangIndent))),null!=e.beforeIndent&&(this.before_indent=Object(_.Ti2Px)(parseInt(e.beforeIndent))),null!=e.afterIndent&&(this.after_indent=Object(_.Ti2Px)(parseInt(e.afterIndent))),null!=e.realWidth&&(this.textWidth=Object(_.Ti2Px)(parseInt(e.realWidth))),null!=e.rect&&(this.rect=d.a.initByDocRect(e.rect)),null!=e.range&&(this.range=this.createTextLineRange(e.range,t)),this.rcUpdated=null!=e.rect;var n=this.view.data.doc;this.papx||(this.papx=n.getDataLogic("final").getPap(this.range.pos)),n.useCoreMeasure?e.glyphGroupInfos?this.compose.initGlyphGroupInfosFromRaw(e,this):this.glyphGroupInfos=[]:(this._charglyphs=e.charglyphs,this.initZones())}},{key:"initZones",value:function(){this.zones=[];var e=[this._processFieldZone.bind(this),this._processNotes.bind(this),this._processCharGlyph.bind(this),this._processTextZone.bind(this)],t={data:this.view.data,curZone:null,begin:this.range.begin,end:this.range.end,chain:e},n=this.range.begin,i=this.range.end;this._processNextZone(t,n,i)}},{key:"_pushTextZone",value:function(e,t,n){var i=new v.a({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem});return i.typoRange={pos:e-this.range.pos,len:t-e},i.partRangePos=e-this.range.pos,i.rtlText=n,this.zones.push(i),i}},{key:"_processNextZone",value:function(e,t,n){e._stack||(e._stack=[],e._processId=-1),e._stack.push(e._processId),e._processId+=1;var i=e.chain[e._processId];i||(i=this._createTextZone),i(e,t,n),e._processId=e._stack.pop()}},{key:"_processFieldZone",value:function(e,t,n){for(var i=e.data.doc.fields.getFields({begin:t,end:n}),o=t;o<n;){var a=i.shift();if(a){if(o>=a.end)continue;o<a.begin&&(this._processNextZone(e,o,a.begin),o=a.begin);var r=this._pushFieldZone(e.data,o,a);r?e.lastZone=r:this._processNextZone(e,o,Math.min(a.end,n)),o=Math.min(a.end,n)}else this._processNextZone(e,o,n),o=n}}},{key:"_processNotes",value:function(e,t,n){var i=window.APP.data.doc;if(i.footnotes&&!i.footnotes.rangeClass.tree.empty()||i.endnotes&&!i.endnotes.rangeClass.tree.empty()){for(var o=(this.viewPage.compose&&this.viewPage.compose.glyphpool||this.viewPage.parent.compose&&this.viewPage.parent.compose.glyphpool).getGlyphGroups(t,n),a=o.length,r=-1,s=0;s<a;++s){var l=o[s];!l.isFootnote()&&!l.isEndnote()||l.isRevisionHidden()||l.isMath()?!l.isFootEndNotePlaceholder()||l.isRevisionHidden()||l.isMath()?r<0&&(r=s):(r>=0&&(this._processNextZone(e,Math.max(o[r].pos,t),l.pos),r=-1),this.__pushFootEndNoteZoneForPlaceholder(l)):(r>=0&&(this._processNextZone(e,Math.max(o[r].pos,t),l.pos),r=-1),this.__pushFootEndNoteZone(l))}r>=0&&this._processNextZone(e,Math.max(o[r].pos,t),n)}else this._processNextZone(e,t,n)}},{key:"_processCharGlyph",value:function(e,t,n){if(this._charglyphs&&this._charglyphs.length){e.charglyphs||(e.charglyphs=this._charglyphs.slice());for(var i=t;i<n;){var o=e.charglyphs.shift();if(!o){this._processNextZone(e,i,n);break}if(o.charbox){var a=o.charbox,r=e.begin+a.beginOffset,s=e.begin+a.endOffset;if(i>=s||s-r<=0)continue;i<r&&(this._processNextZone(e,i,r),i=r);var l=this._pushCharBoxZone(e.data,i,a);l?e.lastZone=l:this._processNextZone(e,i,Math.min(s,n)),i=Math.min(s,n)}else{var u=e.begin+o.cp,c=e.data.glyphpool.getGlyphIterator(u);if((15&o.charFlag)==c.glyphGroup.getCharRngFlag()){var h=c.mi;h&&(h.shared&&(delete(h=h.clone()).shared,c.glyphBuff.setMi(u,h)),c.glyphGroup.isTab()&&(h.leadingChar=String.fromCharCode(o.ch>>8)),h.setFixedWidth(Object(_.Ti2Px)(o.charWidth)))}}}}else this._processNextZone(e,t,n)}},{key:"_processTextZone",value:function(e,t,n){if(window.APP.createBidi){for(var i=(this.viewPage.compose&&this.viewPage.compose.glyphpool||this.viewPage.parent.compose&&this.viewPage.parent.compose.glyphpool).getGlyphGroups(t,n),o=i.length,a=0,r=0,s=i[r++],l=s.chpx.getPropVal("right_to_left_text");r<o;)(s=i[r]).chpx.getPropVal("right_to_left_text")!==l&&(this._pushTextZone(Math.max(i[a].pos,t),s.pos,l),a=r,l=s.chpx.getPropVal("right_to_left_text")),++r;this._pushTextZone(Math.max(i[a].pos,t),n,l)}else this._pushTextZone(t,n,!1)}},{key:"_pushFieldZone",value:function(e,t,n){var i=null;return(i=this._pushPageNumZone(e,t,n._node))||(i=this._pushPageCountZone(e,t,n._node))?i:(i=this._pushEqZone(e,t,n._node))||null}},{key:"_pushPageNumZone",value:function(e,t,n){var i=y.a.makeZoneByField(e,this,n,t);return i&&this.zones.push(i),i}},{key:"_pushPageCountZone",value:function(e,t,n){var i=b.a.makeZoneByField(e,this,n,t);return i&&this.zones.push(i),i}},{key:"_pushEqZone",value:function(e,t,n){var i=window.APP.makeZoneByField(e,this,n,t);return i&&this.zones.push(i),i}},{key:"_pushCharBoxZone",value:function(e,t,n){var i=S(e,this,n,t);return i&&this.zones.push(i),i}},{key:"__pushFootEndNoteZone",value:function(e){var t=Object(T.d)(window.APP.data.doc,e.pos,e.isFootnote(),{parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem});t&&(t.typoRange.pos=e.pos-this.range.pos,this.zones.push(t))}},{key:"__pushFootEndNoteZoneForPlaceholder",value:function(e){var t=Object(T.e)(window.APP.data.doc,e.pos,{parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem});t&&(t.typoRange.pos=e.pos-this.range.pos,this.zones.push(t))}},{key:"onBeforeInsertText",value:function(e,t){if(!(e<this.range.begin||e>=this.range.end)&&this._charglyphs){var n=e-this.range.begin;this._charglyphs.forEach((function(e){if(n<=e.cp&&(e.cp+=t.length),e.charbox){var i=e.charbox;n<=i.beginOffset?(i.beginOffset+=t.length,i.endOffset+=t.length):n<i.endOffset&&(i.endOffset+=t.length)}}))}}},{key:"onBeforeDeleteText",value:function(e,t){if(!(e<this.range.begin||e>=this.range.end)&&this._charglyphs){var n=Math.max(0,e-this.range.begin),i=Math.min(e+t.length-this.range.begin,this.range.len),o=i-n;this._charglyphs.forEach((function(e){if(i<=e.cp&&(e.cp-=o),e.charbox){var t=e.charbox;if(i<=t.beginOffset)t.beginOffset-=o,t.endOffset-=o;else{if(n>=t.endOffset)return;if(n<t.beginOffset){var a=Math.max(0,t.beginOffset-n),r=Math.min(i-t.beginOffset,t.endOffset-t.beginOffset);t.beginOffset-=a,t.endOffset-=a,t.endOffset-=r}else{var s=Math.min(o,t.endOffset-n);t.endOffset-=s}}}}))}}},{key:"createTextLineRange",value:function(e,t){var n=t||0,i=this.view.data.doc.subdocs[e.subdocType],o=void 0;return o=i?i.toDocumentPosition(e.position):e.position,new h.a(n+o,n+o+e.length,this)}},{key:"composeProcess",value:function(e,t){this.isMoc||this.compose.process(this,e,t)&&this.zones&&this.zones.length>0&&this.zones.forEach((function(n){return n.composeProcess(e,t)}))}},{key:"moveTo",value:function(e){var t=e-this.rect.top,n=this.rect.height;this.rect.top+=t,this.rect.bottom=this.rect.top+n,this.isUpdateRequired=!0}},{key:"textStart",value:function(){var e=0;return this.auto_num&&(e=this.auto_num.offset),this.rect.left+e}},{key:"textEnd",value:function(){return this.rect.right}},{key:"getSelCellInfo",value:function(e){if(void 0===this.tablecells)return{err:!0};for(var t=this.tablecells.length,n=0;n<t;++n){var i=this.tablecells[n];if(i===e)return{err:!1,cellX:i.rect.left,cellW:i.rect.right-i.rect.left}}return{err:!0}}},{key:"findSelCellInfos",value:function(e,t,n){if(this.isSnippetLine)return[];for(var i=this.tablecells.length,o=[],a=function(n){var i=n.range;return!!i&&!(e>=i.pos+i.len||t<=i.pos)},r=0;r<i;++r){var s=this.tablecells[r],l=s.cell_page?a(s.cell_page)&&s.cell_page:s.diagCell&&s.diagCell.pages.find((function(e){return a(e)}));if(l){var u={cell:s},c=l.findSelLineInfos(e,t,n);u.textPage=l,u.lineInfos=c,u.hostLine=this,o.push(u)}}return o}},{key:"getPapx",value:function(e){return e.getDataLogic("final").getPapx(this.range.pos).prop}},{key:"getLineBottom",value:function(){return this.rect.bottom+(this.after_space||0)+(this.border.after_width||0)}},{key:"isFirstSubline",value:function(){return!0}},{key:"reset",value:function(){this._borderAndShdRect=void 0}},{key:"isUpdateRequired",get:function(){return this._isUpdateRequired},set:function(e){this._isUpdateRequired=e}},{key:"is_para_first",set:function(e){this._paraFirst=e},get:function(){if(void 0===this._paraFirst){var e=this.view.data.doc.getDataLogic("final").getPapx(this.range.pos);this._paraFirst=this.range.pos===e.pos}return this._paraFirst}},{key:"position2parent",get:function(){return this.rect.origin}},{key:"offset4child",get:function(){return p.a.ZERO()}},{key:"line_origin",get:function(){return g.a.getPosition2coorsystem(this)}},{key:"isInTable",get:function(){return this.parent.isInTable}},{key:"isSubLine",get:function(){return!1}},{key:"isInTextFrame",get:function(){return this.parent.isInTextFrame}},{key:"borderAndShdRect",get:function(){if(!this._borderAndShdRect){var e=this._borderAndShdRect=d.a.initByRawRect(this.rect),t=this.border,n=t.before_width,i=void 0===n?0:n,o=t.after_width,a=void 0===o?0:o;e.top-=i?0:this.before_space||0,e.bottom+=a?0:this.after_space||0,this.papx.getPropVal("bidi")?this.first_line_indent>0&&this.is_para_first?e.right+=this.first_line_indent:this.first_line_indent<0&&!this.is_para_first&&this.isFirstSubline()&&(e.right-=this.first_line_indent):this.first_line_indent>0&&this.is_para_first?e.left-=this.first_line_indent:this.first_line_indent<0&&!this.is_para_first&&this.isFirstSubline()&&(e.left+=this.first_line_indent)}return this._borderAndShdRect}},{key:"first_line_indent",set:function(e){this.__firstLineIndex=e},get:function(){if(void 0===this.__firstLineIndex){var e=this.glyphGroupInfos&&this.glyphGroupInfos[0].chpx;if(!e)return 0;var t=Object(_.Ti2Px)(e.getPropVal("font_size_normal")||0)||Object(_.Ti2Px)(e.getPropVal("font_size_cs")||0)||14,n=this.papx,i=Object(_.Ti2Px)(n.getPropVal("first_line_indent_abs")||0),o=n.getPropVal("first_line_indent_chars")||0;this.__firstLineIndex=o?o/100*t:i}return this.__firstLineIndex}}]),t}(f.DOCLayout);t.b=k;var w=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.compose,u=n.subline;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r},{compose:s,textline:u}))}return c()(t,e),r()(t,[{key:"isFirstSubline",value:function(){var e=this.parent;return!e.sublines||e.sublines[0]===this}},{key:"layoutType",get:function(){return f.DOCLayoutType.TextLine}},{key:"isSubLine",get:function(){return!0}}]),t}(k);function S(e,t,n,i){if(n.type!==C.a.CBT_TwoLineInOne)return null;if(!n.firstLine||!n.secondLine)return null;var o=new m.a({parent:t,viewPage:t.viewPage,coorSystem:t.coorSystem});return o.typoRange={pos:i-t.range.begin,len:0},o.partRangePos=i-t.range.begin,o.typoRange.len=n.endOffset-n.beginOffset,o.firstLine=new k({parent:t,viewPage:t.viewPage,coorSystem:t.coorSystem},{compose:t.compose,textline:n.firstLine}),o.firstLine.range.offsetBegin(i-o.firstLine.range.begin),n.secondLine.range.length=o.typoRange.len-o.firstLine.range.len,o.secondLine=new k({parent:t,viewPage:t.viewPage,coorSystem:t.coorSystem},{compose:t.compose,textline:n.secondLine}),o.secondLine.range.offsetBegin(o.firstLine.range.end,o.secondLine.range.begin),e.glyphpool.getGlyphGroups(t.range.begin,t.range.end),o.splitGlyphGroup(),o}},1292:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAvailableFounderFontList=t.founderFontList=void 0;var i=n(1805);t.founderFontList=["方正小标宋简体","方正仿宋_GBK","方正黑体_GBK","方正小标宋_GBK","方正魏碑_GBK","方正书宋_GBK","方正隶书_GBK","方正楷体_GBK","方正兰亭大黑_GBK"],t.getAvailableFounderFontList=function(){return i.privileges.font_founder_official?t.founderFontList:[]}},1318:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return k}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=function(e){var t=0,n=JSON.parse(JSON.stringify(e));for(var i in n){var o=n[i];n[i]="number"==typeof o?o:t,t++}return Object.freeze(n),n},d=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].codePointAt());return t},p=d("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),f=d("0123456789"),g=d('([{·‘“〈《「『【〔〖（．［｛￡￥"!),.:;?]}¨·ˇˉ―‖’”…∶、。〃々〉》」』】〕〗！＂＇），．：；？］｀｜｝～￠'),v=[11,13,15,12,14,2,5,8,1,9,32,19,20,21,40,26,27,12288,160,0,0],m=h({CC_Ascii:null,CC_FarEast:null,CC_NoFarEast:null,CC_Shared:null,CC_Complex:null}),_=h({SC_Ascii:m.CC_Ascii,SC_FarEast:m.CC_FarEast,SC_NoFarEast:m.CC_NoFarEast,SC_Shared:m.CC_Shared,SC_Complex:m.CC_Complex,__SC_SomeShared__:null,__SC_Unknown__:null,__SC_Undefine__:null}),y=h({usrBasicLatin:null,usrLatin1:null,usrLatinXA:null,usrLatinXB:null,usrIPAExtensions:null,usrSpacingModLetters:null,usrCombDiacritical:null,usrBasicGreek:null,usrGreekSymbolsCop:null,usrCyrillic:null,usrCyrillic2:null,usrArmenian:null,usrHebrewXA:null,usrBasicHebrew:null,usrBasicArabic:null,usrArabicX:null,usrSyriac:null,usrArabicSupplement:null,usrThaana:null,usrDevangari:null,usrBengali:null,usrGurmukhi:null,usrGujarati:null,usrOriya:null,usrTamil:null,usrTelugu:null,usrKannada:null,usrMalayalam:null,usrCeylon:null,usrThai:null,usrLao:null,usrTibet:null,usrBurma:null,usrGeorgianExtended:null,usrBasicGeorgian:null,usrHangulJamo:null,usrEthiopia:null,usrCherokee:null,usrJLDTZPY:null,usrOGZM:null,usrAncientryNorthEurope:null,usrTJL:null,usrHanunoo:null,usrBuhid:null,usrTagbanwa:null,usrCambodia:null,usrMongolia:null,usrLatinExtendedAdd:null,usrGreekExtended:null,usrGeneralPunct:null,usrSuperAndSubscript:null,usrCurrencySymbols:null,usrCombDiacriticsS:null,usrLetterlikeSymbols:null,usrNumberForms:null,usrArrows:null,usrMathematicalOps:null,usrMiscTechnical:null,usrControlPictures:null,usrOpticalCharRecog:null,usrEnclosedAlphanum:null,usrBoxDrawing:null,usrBlockElements:null,usrGeometricShapes:null,usrMiscDingbats:null,usrDingbats:null,usrMiscMathSymbolsA:null,usrArrowsA:null,usrBraillePatterns:null,usrArrowsB:null,usrMiscMathSymbolsB:null,usrMathematicalOps1:null,usrCJKRadicals1:null,usrKangxiRadicals:null,usrIdeographicDescription:null,usrCJKSymAndPunct:null,usrHiragana:null,usrKatakana:null,usrBopomofo:null,usrHangulCompatJamo:null,usrCJKMisc:null,__usrUnnamed10:null,__usrUnnamed11:null,usrEnclosedCJKLtMnth:null,usrCJKCompatibility:null,usrCJKUnifiedIdeoExtendedA:null,usrCJKUnifiedIdeo:null,__usrUnnamed13:null,__usrUnnamed14:null,usrHangul:null,usrHighSurrogates:null,__usrUnnamed16:null,usrLowSurrogates:null,usrPrivateUseArea:null,usrCJKCompatibilityIdeographs:null,usrAlphaPresentationForms:null,usrArabicPresentationFormsA:null,__usrUnnamed18:null,usrCombiningHalfMarks:null,usrCJKCompatForms:null,usrSmallFormVariants:null,usrArabicPresentationFormsB:null,usrHFWidthForms:null,usrSpecials:null,usrLinearBSyllabary:null,usrLinearBIdeograms:null,usrAegeanNumbers:null,usrAncientGreekNumbers:null,__usrUnnamed19:null,usrOldItalic:null,usrGothic:null,__usrUnnamed20:null,usrUgaritic:null,usrOldPersian:null,__usrUnnamed21:null,usrDeseret:null,usrShavian:null,usrOsmanya:null,__usrUnnamed22:null,usrCypriotSyllabary:null,__usrUnnamed23:null,usrPhoenician:null,__usrUnnamed24:null,usrKharoshthi:null,__usrUnnamed25:null,usrCuneiform:null,__usrUnnamed26:null,usrCuneiformNumbersAndPunctuation:null,__usrUnnamed27:null,usrByzantineMusicalSymbols:null,usrMusicalSymbols:null,usrAncientGreekMusicalNotation:null,__usrUnnamed28:null,usrTaiXuanJingSymbols:null,usrCountingRodNumerals:null,__usrUnnamed29:null,usrMathematicalAlphanumericSymbols:null,__usrUnnamed30:null,usrCJKUnifiedIdeographsExtensionB:null,__usrUnnamed31:null,usrCJKCompatibilityIdeographsSupplement:null,__usrUnnamed32:null,usrTags:null,__usrUnnamed33:null,usrSupplementaryPrivateUseAreaA:null,usrSupplementaryPrivateUseAreaB:null,usrError:4294967295}),b=function(){function e(){l()(this,e);var t=_.SC_Ascii,n=_.SC_FarEast,i=_.SC_NoFarEast,o=_.SC_Shared,a=_.SC_Complex,r=_.__SC_SomeShared__,s=_.__SC_Unknown__;this.TxUsrTable=[this.createTxUsrItem(y.usrBasicLatin,0,127,t),this.createTxUsrItem(y.usrLatin1,128,255,r),this.createTxUsrItem(y.usrLatinXA,256,383,r),this.createTxUsrItem(y.usrLatinXB,384,591,r),this.createTxUsrItem(y.usrIPAExtensions,592,687,r),this.createTxUsrItem(y.usrSpacingModLetters,688,767,o),this.createTxUsrItem(y.usrCombDiacritical,768,879,o),this.createTxUsrItem(y.usrBasicGreek,880,975,o),this.createTxUsrItem(y.usrGreekSymbolsCop,976,1023,i),this.createTxUsrItem(y.usrCyrillic,1024,1279,o),this.createTxUsrItem(y.usrCyrillic2,1280,1327,i),this.createTxUsrItem(y.usrArmenian,1328,1423,i),this.createTxUsrItem(y.usrHebrewXA,1424,1487,a),this.createTxUsrItem(y.usrBasicHebrew,1488,1535,a),this.createTxUsrItem(y.usrBasicArabic,1536,1618,a),this.createTxUsrItem(y.usrArabicX,1619,1791,a),this.createTxUsrItem(y.usrSyriac,1792,1871,a),this.createTxUsrItem(y.usrArabicSupplement,1872,1919,a),this.createTxUsrItem(y.usrThaana,1920,1983,a),this.createTxUsrItem(y.usrDevangari,2304,2431,a),this.createTxUsrItem(y.usrBengali,2432,2559,a),this.createTxUsrItem(y.usrGurmukhi,2560,2687,a),this.createTxUsrItem(y.usrGujarati,2688,2815,a),this.createTxUsrItem(y.usrOriya,2816,2943,a),this.createTxUsrItem(y.usrTamil,2944,3071,a),this.createTxUsrItem(y.usrTelugu,3072,3199,a),this.createTxUsrItem(y.usrKannada,3200,3327,a),this.createTxUsrItem(y.usrMalayalam,3328,3455,a),this.createTxUsrItem(y.usrCeylon,3456,3583,a),this.createTxUsrItem(y.usrThai,3584,3711,a),this.createTxUsrItem(y.usrLao,3712,3839,a),this.createTxUsrItem(y.usrTibet,3840,4095,a),this.createTxUsrItem(y.usrBurma,4096,4255,a),this.createTxUsrItem(y.usrGeorgianExtended,4256,4303,i),this.createTxUsrItem(y.usrBasicGeorgian,4304,4351,i),this.createTxUsrItem(y.usrHangulJamo,4352,4607,i),this.createTxUsrItem(y.usrEthiopia,4608,4991,i),this.createTxUsrItem(y.usrCherokee,5024,5119,i),this.createTxUsrItem(y.usrJLDTZPY,5120,5759,i),this.createTxUsrItem(y.usrOGZM,5760,5791,i),this.createTxUsrItem(y.usrAncientryNorthEurope,5792,5887,i),this.createTxUsrItem(y.usrTJL,5888,5919,i),this.createTxUsrItem(y.usrHanunoo,5920,5951,i),this.createTxUsrItem(y.usrBuhid,5952,5983,a),this.createTxUsrItem(y.usrTagbanwa,5984,6015,a),this.createTxUsrItem(y.usrCambodia,6016,6143,a),this.createTxUsrItem(y.usrMongolia,6144,6319,a),this.createTxUsrItem(y.usrLatinExtendedAdd,7680,7935,o),this.createTxUsrItem(y.usrGreekExtended,7936,8191,i),this.createTxUsrItem(y.usrGeneralPunct,8192,8303,o),this.createTxUsrItem(y.usrSuperAndSubscript,8304,8351,o),this.createTxUsrItem(y.usrCurrencySymbols,8352,8399,o),this.createTxUsrItem(y.usrCombDiacriticsS,8400,8447,o),this.createTxUsrItem(y.usrLetterlikeSymbols,8448,8527,o),this.createTxUsrItem(y.usrNumberForms,8528,8591,o),this.createTxUsrItem(y.usrArrows,8592,8703,o),this.createTxUsrItem(y.usrMathematicalOps,8704,8959,o),this.createTxUsrItem(y.usrMiscTechnical,8960,9215,o),this.createTxUsrItem(y.usrControlPictures,9216,9279,o),this.createTxUsrItem(y.usrOpticalCharRecog,9280,9311,o),this.createTxUsrItem(y.usrEnclosedAlphanum,9312,9471,o),this.createTxUsrItem(y.usrBoxDrawing,9472,9599,o),this.createTxUsrItem(y.usrBlockElements,9600,9631,o),this.createTxUsrItem(y.usrGeometricShapes,9632,9727,o),this.createTxUsrItem(y.usrMiscDingbats,9728,9983,o),this.createTxUsrItem(y.usrDingbats,9984,10175,o),this.createTxUsrItem(y.usrMiscMathSymbolsA,10176,10223,o),this.createTxUsrItem(y.usrArrowsA,10224,10239,o),this.createTxUsrItem(y.usrBraillePatterns,10240,10495,o),this.createTxUsrItem(y.usrArrowsB,10496,10623,o),this.createTxUsrItem(y.usrMiscMathSymbolsB,10624,10751,o),this.createTxUsrItem(y.usrMathematicalOps1,10752,11007,o),this.createTxUsrItem(y.usrCJKRadicals1,11904,12031,n),this.createTxUsrItem(y.usrKangxiRadicals,12032,12255,n),this.createTxUsrItem(y.usrIdeographicDescription,12272,12287,n),this.createTxUsrItem(y.usrCJKSymAndPunct,12288,12351,n),this.createTxUsrItem(y.usrHiragana,12352,12447,n),this.createTxUsrItem(y.usrKatakana,12448,12543,n),this.createTxUsrItem(y.usrBopomofo,12544,12591,n),this.createTxUsrItem(y.usrHangulCompatJamo,12592,12687,n),this.createTxUsrItem(y.usrCJKMisc,12688,12703,n),this.createTxUsrItem(y.__usrUnnamed10,12704,12735,s),this.createTxUsrItem(y.__usrUnnamed11,12784,12799,s),this.createTxUsrItem(y.usrEnclosedCJKLtMnth,12800,13055,n),this.createTxUsrItem(y.usrCJKCompatibility,13056,13311,n),this.createTxUsrItem(y.usrCJKUnifiedIdeoExtendedA,13312,19903,n),this.createTxUsrItem(y.usrCJKUnifiedIdeo,19968,40959,n),this.createTxUsrItem(y.__usrUnnamed13,40960,42127,s),this.createTxUsrItem(y.__usrUnnamed14,42128,42191,s),this.createTxUsrItem(y.usrHangul,44032,55203,n),this.createTxUsrItem(y.usrHighSurrogates,55296,56191,n),this.createTxUsrItem(y.__usrUnnamed16,56192,56319,n),this.createTxUsrItem(y.usrLowSurrogates,56320,57343,n),this.createTxUsrItem(y.usrPrivateUseArea,57344,63743,o),this.createTxUsrItem(y.usrCJKCompatibilityIdeographs,63744,64255,n),this.createTxUsrItem(y.usrAlphaPresentationForms,64256,64335,o),this.createTxUsrItem(y.usrArabicPresentationFormsA,64336,65023,o),this.createTxUsrItem(y.__usrUnnamed18,65024,65039,s),this.createTxUsrItem(y.usrCombiningHalfMarks,65056,65071,n),this.createTxUsrItem(y.usrCJKCompatForms,65072,65103,n),this.createTxUsrItem(y.usrSmallFormVariants,65104,65135,n),this.createTxUsrItem(y.usrArabicPresentationFormsB,65136,65278,o),this.createTxUsrItem(y.usrHFWidthForms,65280,65519,n),this.createTxUsrItem(y.usrSpecials,65520,65535,i),this.createTxUsrItem(y.usrLinearBSyllabary,65536,65663,i),this.createTxUsrItem(y.usrLinearBIdeograms,65664,65791,i),this.createTxUsrItem(y.usrAegeanNumbers,65792,65855,i),this.createTxUsrItem(y.usrAncientGreekNumbers,65856,65935,i),this.createTxUsrItem(y.__usrUnnamed19,65936,66303,s),this.createTxUsrItem(y.usrOldItalic,66304,66351,i),this.createTxUsrItem(y.usrGothic,66352,66383,i),this.createTxUsrItem(y.__usrUnnamed20,66384,66431,s),this.createTxUsrItem(y.usrUgaritic,66432,66463,i),this.createTxUsrItem(y.usrOldPersian,66464,66527,i),this.createTxUsrItem(y.__usrUnnamed21,66528,66559,s),this.createTxUsrItem(y.usrDeseret,66560,66639,i),this.createTxUsrItem(y.usrShavian,66640,66687,i),this.createTxUsrItem(y.usrOsmanya,66688,66735,i),this.createTxUsrItem(y.__usrUnnamed22,66736,67583,s),this.createTxUsrItem(y.usrCypriotSyllabary,67584,67647,i),this.createTxUsrItem(y.__usrUnnamed23,67648,67839,s),this.createTxUsrItem(y.usrPhoenician,67840,67871,i),this.createTxUsrItem(y.__usrUnnamed24,67872,68095,s),this.createTxUsrItem(y.usrKharoshthi,68096,68191,i),this.createTxUsrItem(y.__usrUnnamed25,68192,73727,s),this.createTxUsrItem(y.usrCuneiform,73728,73983,i),this.createTxUsrItem(y.__usrUnnamed26,73984,74751,s),this.createTxUsrItem(y.usrCuneiformNumbersAndPunctuation,74752,74879,i),this.createTxUsrItem(y.__usrUnnamed27,74880,118783,s),this.createTxUsrItem(y.usrByzantineMusicalSymbols,118784,119039,i),this.createTxUsrItem(y.usrMusicalSymbols,119040,119295,i),this.createTxUsrItem(y.usrAncientGreekMusicalNotation,119296,119375,i),this.createTxUsrItem(y.__usrUnnamed28,119376,119551,s),this.createTxUsrItem(y.usrTaiXuanJingSymbols,119552,119647,n),this.createTxUsrItem(y.usrCountingRodNumerals,119648,119679,n),this.createTxUsrItem(y.__usrUnnamed29,119680,119807,s),this.createTxUsrItem(y.usrMathematicalAlphanumericSymbols,119808,120831,i),this.createTxUsrItem(y.__usrUnnamed30,120832,131071,s),this.createTxUsrItem(y.usrCJKUnifiedIdeographsExtensionB,131072,173791,n),this.createTxUsrItem(y.__usrUnnamed31,173792,194559,s),this.createTxUsrItem(y.usrCJKCompatibilityIdeographsSupplement,194560,195103,n),this.createTxUsrItem(y.__usrUnnamed32,195104,917503,s),this.createTxUsrItem(y.usrTags,917504,917631,i),this.createTxUsrItem(y.__usrUnnamed33,917632,983039,s),this.createTxUsrItem(y.usrSupplementaryPrivateUseAreaA,983040,1048573,i),this.createTxUsrItem(y.usrSupplementaryPrivateUseAreaB,1048576,1114109,i)];var u=m.CC_Shared,c=m.CC_NoFarEast;this.SomeSharedCharsTable=[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,u,c,c,u,u,c,u,c,c,u,c,u,u,u,u,u,u,c,u,u,u,u,u,c,u,u,u,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,u,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,u,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,u,u,u,u,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,u,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c]}return c()(e,[{key:"createTxUsrItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return{nType:e,chFrom:t,chTo:n,nClass:i}}},{key:"checkUsrTable",value:function(e,t){var n=e,i=e+1;do{var o=this.TxUsrTable[n],a=this.TxUsrTable[i];if(o.chTo<=o.chFrom||a.chFrom<=o.chTo)return!1;n=i,i++}while(i!==t-1);return!0}}]),e}(),T=function(){function e(){l()(this,e),this.TxUsrTable=new b}return c()(e,[{key:"_isHighSurrogate",value:function(e){return e>=55296&&e<=56191}},{key:"_isLowSurrogate",value:function(e){return e>=56320&&e<=57343}},{key:"_surrogate2Unic4",value:function(e,t){var n=0;return this._isHighSurrogate(e)&&this._isLowSurrogate(t)&&(n=1024*(e-55296)+65536+(t-56320)),n}},{key:"_unic42LoSurrogate",value:function(e){var t=0;return e>65536&&(t=56320+(e-65536)%1024),t}},{key:"_unic42HiSurrogate",value:function(e){var t=0;return e>65536&&(t=55296+(e-65536)/1024),t}},{key:"_getUsrItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.TxUsrTable,i=n.TxUsrTable,o=n.checkUsrTable,a=n.createTxUsrItem,r=0,s=i.length,l=o.bind(this.TxUsrTable,r,s);if(l){var u=0;u=this._isHighSurrogate(t)&&this._isLowSurrogate(e)?this._surrogate2Unic4(t,e):e;var c=a.bind(this.TxUsrTable);c.chTo=u;var h=function(e,t,n,i,o){var a=t,r=n;if(a>r||i>e[r])return-1;for(var s=Math.floor((a+r)/2);a<r;)o(s,e,i)?r=s:a=s+1,s=Math.floor((a+r)/2);return s}(i,r,s,c,(function(e,t,n){return t[e].chTo>=n.chTo}));return-1==h?null:i[h]}}},{key:"_getUsrItem2",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.TxUsrTable,i=n.TxUsrTable,o=n.checkUsrTable,a=n.createTxUsrItem,r=0,s=i.length,l=o.bind(this.TxUsrTable,r,s);if(l){var u=0;u=this._isHighSurrogate(t)&&this._isLowSurrogate(e)?this._surrogate2Unic4(t,e):e;var c=a.bind(this.TxUsrTable);c.chTo=u;var h=function(e,t,n,i,o){var a=t,r=n;if(a>r||i>e[r])return-1;for(var s=Math.floor((a+r)/2);a<r;)o(s,e,i)?r=s:a=s+1,s=Math.floor((a+r)/2);return s}(i,r,s,c,(function(e,t,n){return t[e].chTo>=n.chTo}));return{index:h,item:-1==h?null:i[h]}}}},{key:"getCharClass",value:function(e){var t=this.TxUsrTable.SomeSharedCharsTable,n=String.fromCharCode(e),i=this._getUsrItem(e);return i?i.nClass!=_.__SC_SomeShared__?i.nClass:i.nClass==_.__SC_Unknown__?(console.error('----\x3e 字符"'+n+'"(0x'+e+")所属UnicodeSubrange的CharClass属性为Unknown!"),m.CC_Ascii):e-128<t.length?t[e-128]:void console.error('---\x3e 字符"'+n+'"(0x'+e+")无法找到所属的Unicode Subrange"):(console.error('---\x3e 字符"'+n+'"(0x'+e+")未定义Unicode Subrange!"),m.CC_Ascii)}},{key:"get4ByteCharClass",value:function(e,t){if(!t)return this.getCharClass(e);var n=this._getUsrItem(e,t);return n?n.nClass===m.__SC_Unknown__?(console.error("---\x3e 字符(0x"+e+")所属的Unicode Subrange的CharClass属性为Unknown!"),m.CC_Ascii):n.nClass===m.__SC_SomeShared__?m.CC_Ascii:n.nClass:(console.error("---\x3e 字符(0x"+e+")未定义Unicode Subrange!"),m.CC_Ascii)}},{key:"getUsrType",value:function(e){var t=this._getUsrItem(e);return t?t.nType:_.usrError}},{key:"isTxRealAsia",value:function(e){return e==y.usrCJKUnifiedIdeo||e==y.usrCJKCompatibilityIdeographs||e==y.usrCJKCompatibility||e==y.usrCJKUnifiedIdeoExtendedA||e==y.usrHiragana||e==y.usrKatakana||e==y.usrBopomofo||e==y.usrHangul||e==y.usrHangulCompatJamo}},{key:"isTxChinese",value:function(e){return e==y.usrCJKUnifiedIdeo||e==y.usrCJKCompatibilityIdeographs||e==y.usrCJKCompatibility||e==y.usrCJKUnifiedIdeoExtendedA}},{key:"isTxComplex",value:function(e){var t=y.usrHebrewXA,n=y.usrBasicHebrew,i=y.usrBasicArabic,o=y.usrArabicX,a=y.usrArabicSupplement,r=y.usrSyriac,s=y.usrThaana,l=y.usrThai,u=y.usrTamil,c=y.usrBengali,h=y.usrDevangari,d=y.usrGujarati,p=y.usrGurmukhi,f=y.usrKannada,g=y.usrOriya,v=y.usrTelugu,m=y.usrMalayalam,_=y.usrCeylon,b=y.usrLao,T=y.usrBuhid,C=y.usrTagbanwa,k=y.usrCambodia,w=y.usrTibet,S=y.usrBurma,P=y.usrMongolia;return e==t||e==n||e==i||e==o||e==a||e==r||e==s||e==l||e==u||e==c||e==h||e==d||e==p||e==f||e==g||e==v||e==m||e==_||e==b||e==T||e==C||e==k||e==w||e==S||e==P}},{key:"isTxRtl",value:function(e){var t=y.usrHebrewXA,n=y.usrBasicHebrew,i=y.usrBasicArabic,o=y.usrArabicX,a=y.usrArabicSupplement,r=y.usrSyriac,s=y.usrArabicPresentationFormsA,l=y.usrArabicPresentationFormsB;switch(e){case t:case n:case i:case o:case a:case r:case s:case l:return!0}return!1}},{key:"isTxArabic",value:function(e){var t=y.usrBasicArabic,n=y.usrArabicX,i=y.usrArabicSupplement,o=y.usrArabicPresentationFormsA,a=y.usrArabicPresentationFormsB;switch(e){case t:case n:case i:case o:case a:return!0}return!1}}]),e}(),C=function(e){function t(){l()(this,t);var e=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._unicodeCharItemGroups=[],e._groupBits=8,e._bitMask=(1<<e._groupBits)-1,e}return r()(t,e),c()(t,[{key:"_createUnicodeCharItem",value:function(e){var t={};return t.usrType=e.nType,t.charClass=e.nClass,this.isTxRealAsia(t.usrType)?(t.isRealAsia=!0,this.isTxChinese(t.usrType)&&(t.isChinese=!0)):this.isTxComplex(t.usrType)&&(t.isComplex=!0,this.isTxRtl(t.usrType)&&(t.isRtl=!0,this.isTxArabic(t.usrType)&&(t.isArabic=!0))),t}},{key:"_prepareUnicodeCharItemGroup",value:function(e){var t=this,n=e<<this._groupBits,i=n>65535?this._unic42LoSurrogate(n):n,o=n>65535?this._unic42HiSurrogate(n):0,a=_.SC_Ascii,r=_.__SC_SomeShared__,s=_.__SC_Unknown__,l=this.TxUsrTable.TxUsrTable,u=l.length,c=this._getUsrItem2(i,o),h=c.index,d=c.item,y=[],b=d,T=d,C=h,k=h;if(y.push(d),n<b.chFrom){var w=l[--C];w.chTo+1!=b.chFrom&&y.splice(0,0,{chFrom:w.chTo+1,chTo:b.chFrom-1,nClass:s}),b=w,y.splice(0,0,b)}for(;C>0&&b.chFrom&this._bitMask;){var S=l[--C];S.chTo+1!=b.chFrom&&y.splice(0,0,{chFrom:S.chTo+1,chTo:b.chFrom-1,nClass:s}),b=S,y.splice(0,0,b)}for(;k<u-1&&255!=(T.chTo&this._bitMask);){var P=l[++k];T.chTo+1!=P.chFrom&&y.push({chFrom:T.chTo+1,chTo:P.chFrom-1,nClass:s}),T=P,y.push(T)}for(var I=y[0].chFrom>>this._groupBits,E=y[y.length-1].chTo+1>>this._groupBits;I<E;++I)this._unicodeCharItemGroups[I]=this._unicodeCharItemGroups[I]||{};y.forEach((function(e){for(var n=t._createUnicodeCharItem(e),i=e.chFrom,o=e.chTo,s=e.nClass,l=i>>t._groupBits,u=o>>t._groupBits;l<=u;++l){var c=l<<t._groupBits,h=c+t._bitMask+1,d=t._unicodeCharItemGroups[l];switch(s){case r:d.items||(d.items=[]);var g=m.CC_Shared,v=m.CC_NoFarEast,_=t.TxUsrTable.SomeSharedCharsTable,y=Object.assign({},n),b=d.items;y.charClass=g,n.charClass=v;for(var T=Math.max(c,i),C=Math.min(h,o+1);T<C;++T)b[T-c]=_[T-128]==g?y:n;break;case a:d.items||(d.items=[]),d.sItem=n;for(var k=d.items,w=Object.assign({isAlpha:!0},n),S=0,P=p.length;S<P;S++)k[p[S]]=w;for(var I=Object.assign({isNum:!0,isDigit:!0},n),E=0,O=f.length;E<O;E++)k[f[E]]=I;break;default:if(i<=c)d.sItem=n;else{d.items||(d.items=[]);for(var x=d.items,R=Math.max(i,c)-c,N=Math.min(o+1,h)-c;R<N;++R)x[R]=n}}}}));for(var O=y[0].chFrom,x=y[y.length-1].chTo+1,R=0,N=g.length;R<N;R++){var A=g[R];if(A>=O&&A<x){var D=A>>this._groupBits,M=A&this._bitMask,L=this._unicodeCharItemGroups[D];L.items||(L.items=[]);var F=Object.assign({isPunc:!0},L.items[M]||L.sItem);L.items[M]=F}}for(var B=0,H=v.length;B<H;B++){var G=v[B];if(G>=O&&G<x){var W=G>>this._groupBits,j=G&this._bitMask,U=this._unicodeCharItemGroups[W];U.items||(U.items=[]);var V=Object.assign({isPlaceHolder:!0},U.items[j]||U.sItem);U.items[j]=V}}}},{key:"getUnicodeCharItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t?this._surrogate2Unic4(t,e):e,i=n>>this._groupBits;this._unicodeCharItemGroups[i]||this._prepareUnicodeCharItemGroup(i);var o=this._unicodeCharItemGroups[i];return o.items&&o.items[n&this._bitMask]||o.sItem}}]),t}(T),k={DOCCharTypeDetecter:new T,DOCCharTypeFastDetecter:new C}},1319:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return E})),n.d(t,"e",(function(){return O})),n.d(t,"h",(function(){return x})),n.d(t,"b",(function(){return A})),n.d(t,"c",(function(){return D})),n.d(t,"g",(function(){return H})),n.d(t,"f",(function(){return j}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1168),l=n(952),u={red:0,black:1,lnr:0,nlr:1,lrn:2,rnl:3};function c(e,t){this._node=e,this._tree=t}function h(){this._node=null,this._tree=null}function d(){return this._node.nonTree()}function p(){C(this)}function f(){k(this)}function g(){return U.make(this._node,this._tree)}function v(e){e.init=c,e.term=h,e.good=d,e.movePrev=p,e.moveNext=f,e.clone=g}function m(e,t){var n={};return v(n),n.init(e,t),n}function _(e){return e._node.nonTree()}function y(e){e._node=e._node._parent}function b(e){null===e._node._left?e._node=e._tree:e._node=e._node._left}function T(e){null===e._node._right?e._node=e._tree:e._node=e._node._right}function C(e){if(null===e._node._left){for(;e._node.isLeft();)y(e);y(e)}else for(b(e);null!==e._node._right;)T(e)}function k(e){if(null===e._node._right){for(;e._node.isRight();)y(e);y(e)}else for(T(e);null!==e._node._left;)b(e)}function w(e){e._node=e._tree}function S(e,t){e._node=t._node,e._tree=t._tree}function P(e){return U.make(e._node,e._tree)}function I(e){return e._node.toString()}function E(){this.beHint=v,this.newobj=m,this.good=_,this.moveUp=y,this.moveLeft=b,this.moveRight=T,this.movePrev=C,this.moveNext=k,this.stop=w,this.copy=S,this.clone=P,this.toString=I}u.colorOf=function(e){return null===e?u.black:e._color},E.rbhintvt_beHint=v,E.rbhintvt_good=_,E.rbhintvt_moveUp=y,E.rbhintvt_moveLeft=b,E.rbhintvt_moveRight=T,E.rbhintvt_movePrev=C,E.rbhintvt_moveNext=k,E.rbhintvt_stop=w,E.rbhintvt_copy=S,E.rbhintvt_clone=P;var O=function(){function e(){o()(this,e),this.init()}return r()(e,[{key:"init",value:function(){this._color=u.red,this._parent=null,this._left=null,this._right=null}},{key:"getPrevNode",value:function(){if(null!==this._left)return this._left.getMax();for(var e=this,t=this._parent;t&&e===t._left;)e=t,t=t._parent;return t}},{key:"getNextNode",value:function(){if(null!==this._right)return this._right.getMin();for(var e=this,t=this._parent;t&&e===t._right;)e=t,t=t._parent;return t}},{key:"getSibling",value:function(){return this.isTree()?null:this===this._parent._left?this._parent._right:this._parent._left}},{key:"getOnlyChild",value:function(){return null!==this._left?this._left:this._right}},{key:"getMin",value:function(){for(var e=this;null!==e._left;)e=e._left;return e}},{key:"getMax",value:function(){for(var e=this;null!==e._right;)e=e._right;return e}},{key:"getUncle",value:function(){return null===this._parent?null:this._parent.getSibling()}},{key:"getGrandparent",value:function(){return null===this._parent?null:this._parent._parent}},{key:"getTree",value:function(){for(var e=this;e.nonTree();){if(null===e._parent)return null;e=e._parent}return e}},{key:"isOrphan",value:function(){return null===this._parent}},{key:"isLeft",value:function(){return null!==this._parent&&this===this._parent._left}},{key:"isRight",value:function(){return null!==this._parent&&this===this._parent._right}},{key:"isRoot",value:function(){return null===this._parent||this._parent.isTree()}},{key:"isTree",value:function(){return!1}},{key:"nonTree",value:function(){return!0}},{key:"orphan",value:function(){this._color=u.red,this._parent=null,this._left=null,this._right=null}},{key:"linkToLeft",value:function(e){this._left=e,null!==e&&(e._parent=this)}},{key:"linkToRight",value:function(e){this._right=e,null!==e&&(e._parent=this)}},{key:"removable",value:function(){return null===this._left||null===this._right}}]),e}(),x=function(){function e(t){o()(this,e),this.init(t)}return r()(e,[{key:"init",value:function(e){this._color=u.black,this._parent=this,this._left=null,this._right=null,this.HintVT=e}},{key:"getPrevNode",value:function(){return null!==this._left?this._left.getMax():this}},{key:"getNextNode",value:function(){return null!==this._right?this._right.getMin():this}},{key:"getSibling",value:function(){return null}},{key:"getOnlyChild",value:function(){return this._left}},{key:"getMin",value:function(){for(var e=this;null!==e._left;)e=e._left;return e}},{key:"getMax",value:function(){for(var e=this;null!==e._right;)e=e._right;return e}},{key:"getUncle",value:function(){return null}},{key:"getGrandparent",value:function(){return this}},{key:"getTree",value:function(){return this}},{key:"getRoot",value:function(){return this._left}},{key:"isOrphan",value:function(){return!1}},{key:"isLeft",value:function(){return!1}},{key:"isRight",value:function(){return!1}},{key:"isRoot",value:function(){return!1}},{key:"isTree",value:function(){return!0}},{key:"nonTree",value:function(){return!1}},{key:"isAncestorOf",value:function(e){return this===e.getTree()}},{key:"orphan",value:function(){this._color=u.black,this._parent=this,this._left=null,this._right=null}},{key:"linkToLeft",value:function(e){this._left=e,this._right=e,null!==e&&(e._parent=this)}},{key:"linkToRight",value:function(e){this._left=e,this._right=e,null!==e&&(e._parent=this)}},{key:"removable",value:function(){return!1}},{key:"empty",value:function(){return null===this._left}},{key:"membership",value:function(e){return null!==e&&this.isAncestorOf(e)}},{key:"hintAtTree",value:function(e){e.init(this,this)}},{key:"hintAtNode",value:function(e,t){e.init(t,this)}},{key:"hintAtRoot",value:function(e){this.hintAtTree(e),this.HintVT.moveLeft(e)}},{key:"hintAtHead",value:function(e){this.hintAtTree(e),this.HintVT.moveNext(e)}},{key:"hintAtTail",value:function(e){this.hintAtTree(e),this.HintVT.movePrev(e)}},{key:"makeHintAtNode",value:function(e){return this.HintVT.make(e,this)}},{key:"makeHintAtTree",value:function(){return this.HintVT.make(this,this)}},{key:"makeHintAtRoot",value:function(){var e=this.makeHintAtTree();return this.HintVT.moveLeft(e),e}},{key:"makeHintAtHead",value:function(){var e=this.makeHintAtTree();return this.HintVT.moveNext(e),e}},{key:"makeHintAtTail",value:function(){var e=this.makeHintAtTree();return this.HintVT.movePrev(e),e}},{key:"removeNode",value:function(e){var t=e._parent,n=e.getOnlyChild();e===t._left?t.linkToLeft(n):t.linkToRight(n),e.orphan()}},{key:"swap",value:function(e,t){var n=e._parent;t._color=e._color,t.linkToLeft(e._left),t.linkToRight(e._right),e===n._left?n.linkToLeft(t):n.linkToRight(t),e.orphan()}},{key:"adoptAsLeft",value:function(e,t){e.linkToLeft(t)}},{key:"adoptAsRight",value:function(e,t){e.linkToRight(t)}},{key:"insert",value:function(e,t,n){null===t._right?this.adoptAsRight(t,e):this.adoptAsLeft(n,e),this.insertBalance(e)}},{key:"remove",value:function(e){var t=void 0,n=(t=e.removable()?e:e.getPrevNode())._parent,i=t.getSibling(),o=t.getOnlyChild(),a=t._color,r=u.colorOf(o);this.removeNode(t),u.black===a&&(u.red===r?o._color=u.black:this.removeBalance(o,i,n)),e!==t&&this.swap(e,t)}},{key:"rotateLeft",value:function(e){var t=e._parent,n=t._parent,i=e._left;t===n._left?n.linkToLeft(e):n.linkToRight(e),e.linkToLeft(t),t.linkToRight(i)}},{key:"rotateRight",value:function(e){var t=e._parent,n=t._parent,i=e._right;t===n._left?n.linkToLeft(e):n.linkToRight(e),e.linkToRight(t),t.linkToLeft(i)}},{key:"rotate",value:function(e){e.isLeft()?this.rotateRight(e):this.rotateLeft(e)}},{key:"insertBalance",value:function(e){for(var t=void 0,n=void 0,i=void 0;;){if(e.isRoot())e._color=u.black;else if(t=(n=e._parent)._parent,i=e.getUncle(),u.red===n._color){if(u.red===u.colorOf(i)){n._color=u.black,i._color=u.black,t._color=u.red,e=t;continue}e===n._right&&n===t._left?(this.rotateLeft(e),n=e):e===n._left&&n===t._right&&(this.rotateRight(e),n=e),n._color=u.black,t._color=u.red,this.rotate(n)}break}}},{key:"removeBalance",value:function(e,t,n){for(var i=void 0,o=void 0;;){if(n.nonTree()){if(u.red===t._color&&(t._color=u.black,n._color=u.red,this.rotate(t),t=e===n._left?n._right:n._left),i=t._left,o=t._right,u.black===u.colorOf(i)&&u.black===u.colorOf(o)){if(u.black===n._color){t._color=u.red,n=(e=n)._parent,t=e.getSibling();continue}t._color=u.red,n._color=u.black;break}t===n._left?u.black===u.colorOf(i)&&(o._color=u.black,t._color=u.red,this.rotateLeft(o),i=(t=o)._left,o=t._right):u.black===u.colorOf(o)&&(i._color=u.black,t._color=u.red,this.rotateRight(i),i=(t=i)._left,o=t._right),t._color=n._color,n._color=u.black,t===n._left?(i._color=u.black,this.rotateRight(t)):(o._color=u.black,this.rotateLeft(t))}break}}},{key:"toString",value:function(){var e=this.HintVT,t=e.good,n=e.toString,i=e.moveNext,o=e.rb_hint1,a="";for(this.hintAtHead(o);t(o);)a+=n(o)+"\n",i(o);return a}}]),e}();function R(e,t,n){return 0<n(e,t)}function N(e,t,n){return 0<=n(e,t)}var A=function(){function e(t,n){o()(this,e),this.init(t,n)}return r()(e,[{key:"init",value:function(e,t){this.toolkit=e,this.sortby=t}},{key:"attach",value:function(e,t){var n=this.toolkit.HintVT,i=n.good,o=n.moveLeft,a=n.moveRight,r=n.rb_hint1,s=this.toolkit.tree,l=s,u=s,c=this.sortby,h=c.extractFast&&c.extractFast(e)||e,d=t?N:R;for(s.hintAtRoot(r);i(r);)d(h,r,c)?(l=r._node,a(r)):(u=r._node,o(r));s.insert(e,l,u)}}]),e}(),D=function(){function e(t){o()(this,e),this.init(t)}return r()(e,[{key:"init",value:function(e){this.toolkit=e,this.tree=e.tree}},{key:"detach",value:function(e){this.tree.remove(e)}}]),e}();function M(e,t){for(var n=e.HintVT,i=n.good,o=n.moveLeft,a=n.moveRight,r=n.stop,s=n.copy,l=e.makeHintAtRoot(),u=0,c=e.HintVT.rb_makeStack();;)if(i(l)){if(t.passWhole(l)){r(l);continue}s(c[u++],l),o(l)}else{if(0===u)break;if(s(l,c[--u]),!t.visit(l))break;if(t.passRight(l)){r(l);continue}a(l)}l.free(),e.HintVT.rb_freeStack(c)}function L(e,t){var n=e.HintVT,i=n.good,o=n.moveLeft,a=n.moveRight,r=n.copy,s=e.getRoot(),l=e.makeHintAtTree(),u=e.makeHintAtTree(),c=0,h=e.HintVT.rb_makeStack();for(null!==s&&(e.hintAtNode(u,s),t.passWhole(u)||r(h[c++],u));0!==c&&(r(l,h[--c]),t.passRight(l)&&(r(u,l),a(u),i(u)&&r(h[c++],u)),r(u,l),o(u),i(u)&&r(h[c++],u),t.visit(l)););l.free(),u.free(),e.HintVT.rb_freeStack(h)}function F(e,t){for(var n=e.HintVT,i=n.good,o=n.moveUp,a=n.moveLeft,r=n.moveRight,s=n.stop,l=n.copy,u=e.makeHintAtRoot(),c=0,h=e.HintVT.rb_makeStack();;)if(i(u)){if(t.passWhole(u)){s(u);continue}if(l(h[c++],u),null!==u._node._left){a(u);continue}if(t.passRight(u)){s(u);continue}r(u)}else{if(0===h.length)break;if(l(u,h[--c]),!t.visit(u))break;!u._node.isRoot()&&u._node.isLeft()?(o(u),t.passRight(u)?s(u):r(u)):s(u)}u.free(),e.HintVT.rb_freeStack(h)}function B(e,t){for(var n=e.HintVT,i=n.good,o=n.moveLeft,a=n.moveRight,r=n.stop,s=n.copy,l=e.makeHintAtRoot(),u=0,c=e.HintVT.rb_makeStack();;)if(i(l)){if(t.passWhole(l)){r(l);continue}if(s(c[u++],l),t.passRight(l)){r(l);continue}a(l)}else{if(0===u)break;if(s(l,c[--u]),!t.visit(l))break;o(l)}l.free(),e.HintVT.rb_freeStack(c)}var H=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.lnr;o()(this,e),this.tree=t,this.defaultOrder=n}return r()(e,[{key:"traverse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;switch(void 0===t&&(t=this.defaultOrder),t){case u.lnr:M(this.tree,e);break;case u.nlr:L(this.tree,e);break;case u.lrn:F(this.tree,e);break;case u.rnl:B(this.tree,e)}}}]),e}();function G(){if(this.rb_stackPool.length)return this.rb_stackPool.pop();for(var e=[],t=null,n=0;n<48;++n)t={},this.beHint(t),e.push(t);return e}function W(e){e.forEach((function(e){e.term()})),this.rb_stackPool.push(e)}var j=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;o()(this,e),this.init(t,n)}return r()(e,null,[{key:"doAsTheToolkitDo",value:function(e){return e.rb_hint1={},e.rb_hint2={},e.beHint(e.rb_hint1),e.beHint(e.rb_hint2),e.rb_stackPool=[],e.rb_makeStack=G,e.rb_freeStack=W,e}}]),r()(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;this.sortby=e,this.HintVT=t,l.a.bind(this,"tree",(function(e){return new x(t)})),l.a.bind(this,"attacher",(function(e){return new A(e,e.sortby)})),l.a.bind(this,"detacher",(function(e){return new D(e)}))}},{key:"reset",value:function(){this.HintVT.rb_hint1.term(),this.HintVT.rb_hint2.term()}},{key:"clear",value:function(){for(var e=this.tree;!e.empty();)this.detachNode(e.getPrevNode())}},{key:"attachNode",value:function(e){this.attacher.attach(e)}},{key:"detachNode",value:function(e){this.detacher.detach(e)}},{key:"binarySearchHint",value:function(e,t,n){return n?function(e,t,n,i){var o=n.HintVT,a=o.good,r=o.moveLeft,s=o.moveRight,l=o.copy;for(n.hintAtRoot(t),n.hintAtTree(e);a(t);)i.lt(t)?r(t):(i.eq(t)&&l(e,t),s(t));return e}(e,this.HintVT.rb_hint1,this.tree,t):function(e,t,n,i){var o=n.HintVT,a=o.good,r=o.moveLeft,s=o.moveRight,l=o.copy;for(n.hintAtRoot(t),n.hintAtTree(e);a(t);)i.gt(t)?s(t):(i.eq(t)&&l(e,t),r(t));return e}(e,this.HintVT.rb_hint1,this.tree,t)}},{key:"binarySearchNode",value:function(e,t){var n=this.binarySearchHint(this.HintVT.rb_hint2,e,t);return n.good()?n._node:null}},{key:"seekHint",value:function(e,t,n){return n?function(e,t,n,i){var o=n.HintVT,a=o.good,r=o.moveLeft,s=o.moveRight,l=o.copy;for(n.hintAtRoot(t),n.hintAtTree(e);a(t);)i.lt(t)?r(t):(l(e,t),s(t));return e}(e,this.HintVT.rb_hint1,this.tree,t):function(e,t,n,i){var o=n.HintVT,a=o.good,r=o.moveLeft,s=o.moveRight,l=o.copy;for(n.hintAtRoot(t),n.hintAtTree(e);a(t);)i.gt(t)?s(t):(l(e,t),r(t));return e}(e,this.HintVT.rb_hint1,this.tree,t)}},{key:"seekNode",value:function(e,t){var n=this.seekHint(this.HintVT.rb_hint2,e,t);return n.good()?n._node:null}}]),e}(),U=j.doAsTheToolkitDo(new E);s.a.buildVT(U,"RBHint")},1320:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i={UI:"UI",UPDATE:"UPDATE",COOPERATION:"COOPERATION",CURSOR:"CURSOR",COOPER_SELECTION:"COOPER_SELECTION",TABLE:"TABLE",SHAPE:"SHAPE",SELECTION:"SELECTION",KEYBOARD:"KEYBOARD",HYPERLINK:"HYPERLINK",DATE:"DATE",CATALOG:"CATALOG",RICH_TEXT:"RICH_TEXT",SELECTIVE_PASTE:"SELECTIVE_PASTE",AT:"AT",TEXT:"TEXT",SHAPE_RESIZE:"SHAPE_RESIZE",CONTEXT_MENU:"CONTEXT_MENU",INK:"INK",PARAGRAPH_SETTING:"PARAGRAPH_SETTING",SPELL_CHECK:"SPELL_CHECK",SWIPE_MATH:"SWIPE_MATH",COMMENT:"COMMENT",TICKCHAR:"TICKCHAR",NOTES:"NOTES",SHAPE_PREVIEW:"SHAPE_PREVIEW",SHAPE_ADJUSTHANDLER:"SHAPE_ADJUSTHANDLER",CONTENT_CONTROL:"CONTENT_CONTROL"},o={INIT:"INIT",START:"START",MOVE:"MOVE"}},1403:function(e,t,n){"use strict";var i,o=n(144),a=n.n(o),r=n(1),s=n.n(r),l=n(2),u=n.n(l),c=n(30),h=n.n(c),d=n(3828),p=0,f=1,g=2,v=(i={0:"DefaultColor",1:"DesktopBkgrnd",2:"AutoFillColor",3:"AutoFillBkColor",4:"AutoLineColor",5:"AutoBkColor",6:"Reserved6",7:"Reserved7",8:"AutoTextColor",9:"Reserved9",12:"WindowBkgrnd",13:"HighlightColor",14:"HighlightTextColor",15:"ButtonFaceColor",16:"ThreeDShadowColor",17:"GrayText"},h()(i,"17","AutoColorMaxIndex"),h()(i,"64","AutoColorMax"),h()(i,"ffffff","TransparentColor"),i),m={DefaultColor:{tine:"#000000",dark:"#ffffff"},DesktopBkgrnd:{tine:"#ffffff",dark:"#000000"},AutoFillColor:{tine:"#000000",dark:"#ffffff"},AutoFillBkColor:{tine:"#000000",dark:"#ffffff"},AutoLineColor:{tine:"#000000",dark:"#ffffff"},AutoBkColor:{tine:null,dark:"#000000"},Reserved6:{tine:"#000000",dark:"#ffffff"},Reserved7:{tine:"#000000",dark:"#ffffff"},AutoTextColor:{tine:"#000000",dark:"#ffffff"},Reserved9:{tine:"#000000",dark:"#ffffff"},WindowBkgrnd:{tine:"#ffffff",dark:"#000000"},HighlightColor:{tine:"#ffff00",dark:"#00ffff"},HighlightTextColor:{tine:"#ffff00",dark:"#00ffff"},ButtonFaceColor:{tine:"#ffffff",dark:"#000000"},ThreeDShadowColor:{tine:"#cccccc",dark:"#333333"},GrayText:{tine:"#cccccc",dark:"#333333"},AutoColorMaxIndex:{tine:"#ff0000",dark:"#00ffff"},AutoColorMax:{tine:"#ff0000",dark:"#00ffff"},TransparentColor:{tine:"#ffffff",dark:"#ffffff"}},_=function(){function e(t,n){s()(this,e),this.naked_color=t||{},this.default_color=n||"#000"}return u()(e,[{key:"getColorEx",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.naked_color.type,n=void 0;switch(t){case p:n=this._getHexColor(e);break;case f:n=this._getThemeColor();break;case g:n=this.naked_color.color;break;default:n=this.default_color}return n&&"#"!==n[0]&&"r"!==n[0]&&(n="#"+n),n}},{key:"_getHexColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.naked_color.hex.toString(16),n=t.length,i=8-n,o="00000000",a=o.substring(0,i),r=a+t,s=r.substring(0,2);if(e&&"00"===s)return"#ffffffffff000000";var l=r.substring(2,4),u=r.substring(4,6),c=r.substring(6,8),h="00"===s?this._getAutoColor(l,u,c,t):this._getStandardColor(l,u,c);return h}},{key:"_getStandardColor",value:function(e,t,n){return e+t+n}},{key:"_getAutoColor",value:function(e,t,n,i){return m[v[i]].tine}},{key:"_getThemeColorByType",value:function(e,t,n){var i=e;return 16==i?t.phColor:(i=t.schemeColorMapping[i])>=0&&i<=11?n[i]:{srgb:0,"2rgb":"#000",type:0}}},{key:"_getThemeColor",value:function(){var t=d.a.getInstance().baseStyle.colorScheme.colors,n=d.a.getInstance().agent,i=this.naked_color,o=i.scheme,r=i.themeShade,s=i.themeTine,l=this._getThemeColorByType(o,n,t)["2rgb"];if(65535!==r||65535!==s){var u=parseInt(l.substring(1,8),16),c=(u>>16&255)/255,h=(u>>8&255)/255,p=(255&u)/255,f=e.rgbToHsl(c,h,p),g=a()(f,3),v=g[0],m=g[1],_=g[2];if(65535!==r){var y=r/255;_=Math.min(_*y,1)}if(65535!==s){var b=s/255;_=Math.min(_*b+1-b,1)}var T=e.hslToRgb(v,m,_),C=a()(T,3),k=C[0],w=C[1],S=C[2];l="#"+((l=(u=(k=Math.floor(255*Math.floor(1e5*k)/1e5))<<16|(w=Math.floor(255*Math.floor(1e5*w)/1e5))<<8|(S=Math.floor(255*Math.floor(1e5*S)/1e5))).toString(16)).length<6?Array(7-l.length).join("0"):"")+l}return l}},{key:"color",get:function(){return this.getColorEx()}},{key:"colorEx",get:function(){return this.getColorEx(!0)}}],[{key:"initWithCustomColor",value:function(t){return new e({color:t,type:g})}},{key:"initWithHexColor",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n)return new e({type:0,hex:16777215&t});if(7===t.length&&"#"===t.substring(0,1)){var i=parseInt(t.substring(1),16);return new e({type:0,hex:16777215&i|251658240})}}},{key:"isGrayLevelHighInYUV",value:function(e,t,n){return.299*e+.578*t+.114*n>=192}},{key:"rgbToHsl",value:function(e,t,n){var i=Math.max(e,t,n),o=Math.min(e,t,n),a=i-o,r=i+o,s=0,l=.5*r,u=0;return a>1e-6&&(u=l<.5?a/r:a/(2-r),s=e===i?(t-n)/a+(t<n?6:0):t===i?2+(n-e)/a:4+(e-t)/a,s*=1/6),[s,u,l]}},{key:"hueToRgb",value:function(e,t,n){var i=n;return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}},{key:"bound",value:function(e,t,n){return t<e?e:t>n?n:t}},{key:"hslToRgb",value:function(t,n,i){var o=void 0,a=void 0,r=void 0;if(Math.abs(t-1)<1e-6)o=a=r=i;else if(n<0){var s=i<.5?i*(1-n):i-n+i*n,l=2*i-s;o=2*i-e.hueToRgb(l,s,t+1/3),a=2*i-e.hueToRgb(l,s,t),r=2*i-e.hueToRgb(l,s,t-1/3),o=e.bound(0,o,1),a=e.bound(0,a,1),r=e.bound(0,r,1)}else if(Math.abs(i)<1e-6)o=a=r=0;else{var u=i<.5?i*(1+n):i+n-i*n,c=2*i-u;o=e.hueToRgb(c,u,t+1/3),a=e.hueToRgb(c,u,t),r=e.hueToRgb(c,u,t-1/3),o=e.bound(0,o,1),a=e.bound(0,a,1),r=e.bound(0,r,1)}return[o,a,r]}},{key:"darkenRGB",value:function(e){if(7===e.length&&"#"===e[0]){var t=parseInt(e.substring(1,3),16)+256>>1,n=parseInt(e.substring(3,5),16)+256>>1,i=parseInt(e.substring(5,7),16)+256>>1;return"#"+t.toString(16)+n.toString(16)+i.toString(16)}return e}}]),e}();t.a=_},1417:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(310),d=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.IT.lower,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,h.IT.NonIntersect,n))}return c()(t,e),r()(t,[{key:"todo",value:function(e){var t=e.begin,n=e.end,i=this.detachNodes(t,n,h.IT.intersectTest).boundary;this.attacher.attach(new h.ITRange(i.begin,i.end))}},{key:"attachNotEmpty",value:function(e,t){if(e<t){var n=new h.ITRange(e,t);this.attacher.attach(n)}}},{key:"done",value:function(e){var t=e.begin,n=e.end,i=this.detachNodes(t,n,h.IT.strictIntersectTest).boundary;this.attachNotEmpty(i.begin,t),this.attachNotEmpty(n,i.end)}},{key:"empty",value:function(){return this.tree.empty()}},{key:"doEach",value:function(e,t){var n=this,i=e.begin,o=e.end,a=void 0;this.mapInRange(i,o,h.IT.mapToRange,h.IT.strictIntersectTest).forEach((function(e){(a=t(e))&&n.done(a)}))}},{key:"doInTurn",value:function(e){for(var t=this.tree,n=null;!t.empty()&&((n=e(h.IT.mapToRange(t.getNextNode()))).doneRange&&this.done(n.doneRange),!n.stop););}},{key:"have",value:function(e){var t=e.begin,n=e.end;return this.some(t,n,h.IT.strictIntersectTest)}},{key:"begin",get:function(){return this.tree.begin}},{key:"end",get:function(){return this.tree.end}}]),t}(h.ITToolkit);t.default=d},1473:function(e,t,n){"use strict";n.d(t,"b",(function(){return C})),n.d(t,"g",(function(){return w})),n.d(t,"f",(function(){return S})),n.d(t,"a",(function(){return T})),n.d(t,"c",(function(){return k})),n.d(t,"d",(function(){return P})),n.d(t,"e",(function(){return _}));var i=n(227),o=n(2695),a=n(535),r=n(614),s=n(3075),l=0,u=1,c=2;function h(){this.customFactory=null,this.defaultFactory=new k,this.workspace=null,this.transDepositedContainer=null,this.commandProc=null,this.resetRepertory(this)}h.prototype.resetRepertory=function(e){e.newObjMap=new Object,e.topObjMap=new Object,e.curTopOps=new Array,e.transacts=new Array,e.curTransact=null,e.curVersion=-1,e.baseVersion=-1,e.initVersion=-1,e.reachVersion=-1,e.taskVersion=-1,e.lockVersion=-1,e.undoSteps=0,e.undoLocalSteps=0,e.lockUndoSteps=-1,e.transLevel=0,e.needSendToSvr=!0,e.transExt=[],e.destroyedExtRanges={},e.delayLoadObj=new Set,null!=e.workspace&&(e.workspace.documents=[]),e.bornTaskVerUndo=new Set,e.curBornTaskVerUndo=new Map,e.curLastUndoTrans=null,delete e._canUndoDataVersionBeforeInit},h.prototype.canUndoBeforeInit=function(){if(!this._canUndoDataVersionBeforeInit)return!1;for(var e=this._canUndoDataVersionBeforeInit.length-1;e>=0;--e){var t=this._canUndoDataVersionBeforeInit[e];if("over"===t.banUndoType)return!1;if(window.__WPSENV__.conn_id===t.connId&&"cur"!==t.banUndoType)return!0}return!1},h.prototype.beginTransact=function(){if(0==this.transLevel){if(null!=this.curTransact)return;this.curTransact=new s.a,this.curTransact.beginExtObjects(this.transDepositedContainer.transDepositedGetArray())}this.transLevel++},h.prototype.endTransact=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.default.ctCommit;if(!(this.transLevel<=0)&&null!=this.curTransact)if(!0===e)this.curTransact.rollback(),this.curTransact=null,this.transLevel=0;else if(0==--this.transLevel){this.curTransact.complete(),this.clearInvalidTransacts(!0,!0,!1),this.curTransact.commitExtObjects(this.transDepositedContainer.transDepositedGetArray()),this.needSendToSvr||(t===r.default.ctCommit_Merge?t=r.default.ctCommit_UnClose:t===r.default.ctCommit_MergeAndClose&&(t=r.default.ctCommit));var n=!1,o=!1;switch(t){case r.default.ctCommit_UnClose:n=!1,o=!1;break;case r.default.ctCommit_Merge:n=!0,o=!1;break;case r.default.ctCommit_MergeAndClose:n=!0,o=!0;break;case r.default.ctCommit:default:n=!1,o=!0}n&&this.isTransactCanMerge()?(this.mergeToLastTransact(this.curTransact),o&&this.closeLastTransact()):(this.closeLastTransact(),this.canMergeToLocalCommand(this.curTransact)?(this.mergeToLastTransact(this.curTransact),o&&this.closeLastTransact()):(this.curVersion++,this.curTransact.setDataVersion(this.curVersion),this.transacts.push(this.curTransact),o&&this.closeLastTransact(),i.default.dispatchEvent(i.default.names.TRANSACT_CHANGED))),this.curTransact=null,this.transacts.length!==this.getCurTransactIndex()+1&&console.error("endTransact:version not match!")}},h.prototype.isInTransaction=function(){return this.transLevel>0},h.prototype.closeLastTransact=function(){var e=this.transacts.length;if(0==e)return!1;var t=this.transacts[e-1];return!t.closed&&(t.closed=!0,!this.needSendToSvr||this.sendCommandToSvr(t))},h.prototype.dropLastTransact=function(){this.undo(),this.clearInvalidTransacts(!0,!1,!0),i.default.dispatchEvent(i.default.names.TRANSACT_CHANGED)},h.prototype.isTransactCanMerge=function(){var e=this.transacts.length;return 0!=e&&!this.transacts[e-1].closed},h.prototype.getLastLocalCommand=function(){var e=this.transacts.length;return 0==e?null:this.transacts[e-1].localCommand},h.prototype.undo=function(){var e=this.undoLocalVersion();return null!=e&&this.undoLocalSteps++,this._getUndoCate()!==c&&this.undoSteps++,i.default.dispatchEvent(i.default.names.TRANSACT_CHANGED),e},h.prototype.undoLocalVersion=function(){if(this.curVersion>this.baseVersion){var e=m(this);if(void 0!==e)return e}return null},h.prototype.undoServerVersion=function(){if(this.curVersion==this.baseVersion){var e=m(this);if(null!=e)return this.baseVersion--,e}return null},h.prototype.redo=function(){var e=null;return this.canRedoLocal()&&null!=(e=this.redoVersion())&&this.undoLocalSteps--,this.undoSteps--,i.default.dispatchEvent(i.default.names.TRANSACT_CHANGED),e},h.prototype.redoVersion=function(){var e=v(this);return null==e||e.isLocalTransact()?null:(this.baseVersion++,e)},h.prototype._getUndoCate=function(){for(var e=this.getCurTransactIndex();e>=0;e--){var t=this.transacts[e];if("over"===t.banUndoType)return l;if("cur"!==t.banUndoType&&1==t.isSelf)return u}return this.canUndoBeforeInit()?c:l},h.prototype.canUndo=function(){return this._getUndoCate()!=l&&this.curVersion>this.lockVersion},h.prototype.canUndoLocal=function(){return this.curVersion>this.baseVersion},h.prototype.canRedo=function(){return this.undoSteps>0&&this.undoSteps>this.lockUndoSteps},h.prototype.canRedoLocal=function(){return this.undoSteps>0&&this.undoLocalSteps>0},h.prototype.getTransact=function(e){var t=this.getTransactIndex(e);return t>=this.transacts.length||t<0?null:this.transacts[t]},h.prototype.getNextRedoTransact=function(){var e=this.getCurTransactIndex()+1;return e<this.transacts.length&&e>=0?this.transacts[e]:null},h.prototype.getBaseVersion=function(){return this.baseVersion},h.prototype.getCurrentVersion=function(){return this.curVersion},h.prototype.getCurTaskVersion=function(){return this.taskVersion},h.prototype.getInitialVersion=function(){return this.initVersion},h.prototype.getCurrentTransact=function(){return this.curTransact},h.prototype.getTransactIndex=function(e){return window.g_rpt.transacts.length>0?e-window.g_rpt.transacts[0].dataVersion:e-this.initVersion-1},h.prototype.getCurTransactIndex=function(){return this.getTransactIndex(this.curVersion)},h.prototype.applyServerInitData=function(e){if(null==e.versions)return console.log("server data error: ",e),{};this.resetRepertory(this),e.canUndoDataVersionBeforeInit&&(this._canUndoDataVersionBeforeInit=e.canUndoDataVersionBeforeInit),this.assembleNewObjects(e,this);var t=this.playDocumentInit(e,this);return i.default.dispatchEvent(i.default.names.TRANSACT_CHANGED),t},h.prototype.clearInvalidTransacts=function(e,t,n){var i=this.getCurTransactIndex()+1,o=this.transacts.length-i;if(o>0){if(t&&(this.transExt=this.transacts.slice(i,i+o).concat(this.transExt)),n)for(var a=this.transacts.slice(i,i+o),r=a.length-1;r>=0;--r)a[r].backwardTopObj();for(var s=i;s<this.transacts.length;++s){var l=this.transacts[s];this.destroyedExtRanges[l.bornTaskVer]=l.extRanges}this.transacts.splice(i,o)}null!=e&&1==e&&(this.undoSteps=0,this.undoLocalSteps=0,this.lockUndoSteps=-1)},h.prototype.applyServerVersions=function(e){var t=this;if(t.curBornTaskVerUndo.clear(),t.curLastUndoTrans=null,null==e.versions||this.isInitializeData(e))return console.error("server data error: ",e),null;this.canUndoLocal()&&this.transacts[this.getCurTransactIndex()].commitExtObjects(this.transDepositedContainer.transDepositedGetArray());this.delayLoadObj.clear(),this.assembleNewObjects(e,this);var n=function(e,t){var n=[],i=[];do{var o=t.undoLocalVersion();if(null!==o){o.localOnly?i.push(o):n.push(o);var a=t.transacts.length-1;a>=0&&t.transacts[a]==o?t.transacts.splice(a,1):console.log("error!")}}while(null!==o);var r=function(e){var t=[];return e.versions.forEach((function(e){null!=e.isVerOfCurExec&&1==e.isVerOfCurExec&&t.push(e)})),t}(e),s=r.length,l=n.splice(n.length-s);n=n.concat(i),l.reverse();for(var u=0;u<l.length;u++)r[u]&&l[u]&&l[u].extRanges&&(r[u].extRanges=l[u].extRanges);return{commited:l,notCommited:n.reverse()}}(e,this),o=function(e,t){if(void 0===e.baseDataVer)return;t.curVersion!=t.baseVersion&&console.error("resetBaseVersion:version not match rpt.curVersion: "+t.curVersion+" rpt.baseVersion: "+t.baseVersion);var n=[];for(;t.curVersion>e.baseDataVer;){var i=t.undoServerVersion();if(null==i)break;n.push(i)}return n.reverse()}(e,this),a=[],s=e.versions.length,l=function(e,t){for(var n=new Array,i=0;i<e.orgObjs.length;i++){var o=e.orgObjs[i],a=t.getServerObjectByID(o.id);if(null!=a&&null!=a){if(a.objType==r.default.OType_Data||a.objType==r.default.OType_Custom){for(var s in o.data)y(a.constructor)(s);a.isTopObject()&&console.log("playTopOperates:new"),a.private=o.data,a.newest=!0,a.onChangedCB&&a.onChangedCB(a)}n.push(a)}}return n}(e,this);s>0&&this.clearInvalidTransacts(!1,!1,!0);var u=0;if(s>0)for(var c=0;c<s&&t.transExt.length>0;++c){var h=e.versions[c];if(g(h)){u=h.dataVer-t.baseVersion-1;break}}else u=Math.max(0,e.curDataVer-t.baseVersion);if(t.transExt.length>0&&s>0)for(var m=t.transExt.length-1;m>=u;--m)t.transExt[m].backwardTopObj();for(c=0;c<u&&u<=t.transExt.length;++c){var _=t.transExt[c];t.transacts.push(_),a.push(_),t.baseVersion=t.baseVersion+1,_.setDataVersion(t.baseVersion),v(t)}t.transExt=0==s?t.transExt.splice(u):[];for(c=0;c<s;c++){h=e.versions[c];null!=(_=d(h,window.g_rpt))&&(a.push(_),f(_,h,window.g_rpt)),h.type===r.default.vtDataVersion?v(this):h.type===r.default.vtLocCommandVersion&&playLocalCommand(h)}var b=p(e,this);return l.forEach((function(e){null!=e.newest&&(e.newest=!1)})),function(e,t,n,i){if(void 0===e.curDataVer)return;if(t.curVersion>e.curDataVer)for(;t.curVersion>e.curDataVer;){var o=t.undoServerVersion(!1);if(null==o)break;n.length>0?n.splice(n.length-1,1):i.push(o)}else for(;t.curVersion<e.curDataVer;){var a=t.redoVersion(!1);if(null==a)break;n.push(a)}t.curVersion==e.curDataVer&&t.baseVersion==e.curDataVer||console.error("setCurrentVersion: version not match! rpt.curVersion: "+t.curVersion+" rpt.baseVersion: "+t.baseVersion+" svrData.curDataVer: "+e.curDataVer)}(e,this,a,o),null!=e.undoSteps&&(this.undoSteps=e.undoSteps+this.undoLocalSteps),i.default.dispatchEvent(i.default.names.TRANSACT_CHANGED),this.delayLoadObj.clear(),this.restoreExtObjRanges(),{localVersions:n.notCommited,localCommitedVersion:n.commited,resetBaseVersions:o,applyVersions:a,shapePictureChanged:b}},h.prototype.restoreExtObjRanges=function(){var e=this,t=e.curLastUndoTrans;e.curBornTaskVerUndo.forEach((function(n,i){e.bornTaskVerUndo.add(i),(null==t||n.taskVer>t.taskVer)&&(t=n)})),null!=t&&t.swapExtObjRanges(t!=e.curLastUndoTrans),e.curBornTaskVerUndo.clear(),e.curLastUndoTrans=null},h.prototype.updateExtObjectsAfterApply=function(){var e=this.getCurTransactIndex();e+1==this.transacts.length&&0<=e&&this.transacts[e].commitExtObjects(this.transDepositedContainer.transDepositedGetArray())},h.prototype.isInitializeData=function(e){return!(!e.versions||1!=e.versions.length||e.versions[0].type!=r.default.vtInitialData)},h.prototype.setCustomFactory=function(e){this.customFactory=e},h.prototype.setTransDepositedContainer=function(e){this.transDepositedContainer=e},h.prototype.getTransDepositedContainer=function(){return this.transDepositedContainer},h.prototype.setCommandProc=function(e){this.commandProc=e},h.prototype.getCustomFactory=function(){return this.customFactory},h.prototype.setWorkspace=function(e){this.workspace=e,this.registerServerObject(1,this.workspace)},h.prototype.getWorkspace=function(){return null===this.workspace&&(this.workspace=new C,this.registerServerObject(1,this.workspace)),this.workspace},h.prototype.getServerObjectByID=function(e,t){return 1===e?this.getWorkspace():0===e?null:null!=t?t[e]:this.newObjMap[e]},h.prototype.registerServerObject=function(e,t,n){1!==e&&0!==e&&(null!=n?n[e]=t:this.newObjMap[e]=t)},h.prototype.registerNewObject=function(e){this.curTransact&&this.curTransact.registerNewObject(e)},h.prototype.registerTopObject=function(e,t){this.topObjMap[e]=t},h.prototype.addDataNotify=function(e){this.curTransact&&this.curTransact.addDataNotify(e)},h.prototype.addVectorOperate=function(e,t,n,i,o,a){this.curTransact&&this.curTransact.addVectorOp(e,t,n,i,o,a)},h.prototype.addCustomOperate=function(e,t){this.curTransact&&this.curTransact.addCustomOp(e,t)},h.prototype.createObjectForSvr=function(e,t,n){var i=null;return null!=t&&this.customFactory&&(i=this.customFactory.createObjectForSvr(e,t,n)),null==i&&(i=this.defaultFactory.createObjectForSvr(e,t,n)),i},h.prototype.createTopObjectForSvr=function(e,t,n){var i=null;return null!=t&&this.customFactory&&(i=this.customFactory.createTopObjectForSvr(e,t,n)),null==i&&(i=this.defaultFactory.createTopObjectForSvr(e,t,n)),i},h.prototype.hasSelfTransact=function(){for(var e=this.getCurTransactIndex();e>=0;e--){var t=this.transacts[e];if("over"===t.banUndoType)return!1;if("cur"!==t.banUndoType&&1==t.isSelf)return!0}return!1},h.prototype.mergeToLastTransact=function(e){var t=this.transacts.length;if(0==t)return!1;var n=this.transacts[t-1];if(e.operates.forEach((function(e){n.operates.push(e)})),null!=e.localCommand)if(null==n.localCommand)n.localCommand=e.localCommand,console.error("localCommand not diff!");else if(null!=this.commandProc){var i=this.commandProc.mergeLocalCommand(n.localCommand,e.localCommand);n.mergeExtObjects(this.transDepositedContainer.transDepositedGetArray(),e),0==i&&console.error("command type not diff!")}return!1},h.prototype.canMergeToLocalCommand=function(e){var t=this.transacts.length;if(0==t)return!1;var n=this.transacts[t-1];return!(!this.needSendToSvr||null==this.commandProc||!this.commandProc.hasCommandQueue())&&this.commandProc.canMergeLocalCommand(n.localCommand,e.localCommand)},h.prototype.sendCommandToSvr=function(e){if(e&&null!=e.localCommand&&null!=this.commandProc){var t=this.commandProc;return t.needAuxOps&&t.needAuxOps(e.localCommand)&&t.exportAuxOpsToCommand(e,e.localCommand),t.sendCommand(e.localCommand)}return!1};var d=function(e,t){var n=e.ops,i=new s.a;return e.__topOps=new Array,n.forEach((function(n){var o=t.getServerObjectByID(n.id);if(null!=o){var a=o.objType,s=void 0;switch(n.opt){case r.default.otReplaceData:s={obj:o,opType:n.opt,data:n.data};break;case r.default.otInsert:case r.default.otMove:case r.default.otRemove:case r.default.otModify:if(a==r.default.OType_Data)return void console.error("op type not math object type!");a==r.default.OType_Vector||a==r.default.OType_Delay_Vector?(s={obj:o,opType:n.opt,data:n.data,pos:n.pos},void 0!==n.oldData&&(s.oldData=n.oldData),void 0!==n.offset&&(s.offset=n.offset)):(s={obj:o,opType:n.opt,data:n.data},null!=n.pos&&(s.pos=n.pos),null!=n.offset&&(s.offset=n.offset));break;default:return}o.isTopObject()?e.__topOps.push(s):i.addServerOperate(s)}})),e.mainObjOps.forEach((function(e){var n=t.getServerObjectByID(e.id);null!=n&&i.addMainObjectOperates(n,e.ops)})),e.extRanges&&(i.extRanges=e.extRanges,e.extRanges=null),null==i.extRanges&&(i.extRanges=t.destroyedExtRanges[e.bornTaskVer]),null==i.extRanges&&(i.beginExtObjects(t.transDepositedContainer.transDepositedGetArray()),i.commitExtObjects(t.transDepositedContainer.transDepositedGetArray())),t.taskVersion=e.taskVer,g(e)?(t.baseVersion=e.dataVer,t.reachVersion=e.dataVer,i.taskVer=e.taskVer,i.bornTaskVer=e.bornTaskVer,i.setDataVersion(e.dataVer),i.isSelf=null!=e.self&&e.self,i.isVerOfCurExec=null!=e.isVerOfCurExec&&e.isVerOfCurExec,i.banUndoType=e.banUndo?e.banUndo:null,i.isLocal=!1,i.closed=!0,t.transacts.push(i),t.transacts.length>100?(t.transacts.splice(0,t.transacts.length-100),delete t._canUndoDataVersionBeforeInit):t._canUndoDataVersionBeforeInit&&t.transacts.length+t._canUndoDataVersionBeforeInit.length>100&&t._canUndoDataVersionBeforeInit.splice(0,t.transacts.length+t._canUndoDataVersionBeforeInit.length-100),i):null},p=function(e){if(null!=e.shapePics){var t=!1;return e.shapePics.forEach((function(e){var n=window.g_rpt.getServerObjectByID(e.id);null!=n&&(null!=n.setSha1?n.setSha1(e.sha1,e.dpi):n.sha1=e.sha1,null!=n.setRect?n.setRect(e.rect):n.rect=e.rect,n.updateChartMetaData&&e.chartMetaData&&(n.updateChartMetaData(e.chartMetaData),e.chartMetaData=null),t=!0)})),e.shapePics=[],t}},f=function(e,t,n){if(void 0!==t.__topOps){var i=t.__topOps.length;i>0&&console.log("playTopOperates");for(var o=0;o<i;o++){var a=t.__topOps[o];if(a.obj.isTopObject()){var r=a.obj.forward(a);null!=r&&r instanceof Array&&(e.operates=e.operates.concat(r))}}e.topOps=t.__topOps}},g=function(e){return e.type===r.default.vtDataVersion||e.type===r.default.vtLocalCmdVersion},v=function(e){var t=e.getCurTransactIndex()+1;if(t<e.transacts.length&&t>=0){var n=e.transacts[t];if(n.forward(),n.bornTaskVer>=0)!e.curBornTaskVerUndo.delete(n.bornTaskVer)&&e.bornTaskVerUndo.delete(n.bornTaskVer)&&(e.curLastUndoTrans=n);return e.curVersion++,n}return null},m=function(e){var t=e.getCurTransactIndex();if(t<e.transacts.length&&t>=0){var n=e.transacts[t];return n.backward(!0),n.bornTaskVer>=0&&e.curBornTaskVerUndo.set(n.bornTaskVer,n),e.curVersion--,n}return null},_=function(e){var t=e.substr(0,1).toUpperCase()+e.substr(1);return{get:"get"+t,set:"set"+t}},y=function(e){return function(t){var n=_(t),i=n.get;void 0===e.prototype[i]&&(e.prototype[i]=function(){return this.private[t]});var o=n.set;void 0===e.prototype[o]&&(e.prototype[o]=function(e){null!=this.writeLock&&this.writeLock(),this.private[t]=e})}};function b(e,t,n,i){var o=t.__svrObjMap[e],a=null;if(void 0===o)return void 0===(a=i.getServerObjectByID(e))?(console.error("object not find!"),null):a;if(void 0!==(a=i.getServerObjectByID(e,t.__newObjsTmp)))return a;var r=null,s=o.top,l=o.clsname,u=o.type;return(r=s?i.createTopObjectForSvr(u,l,o,t):i.createObjectForSvr(u,l,o,t))._setSelf&&r._setSelf(),i.registerServerObject(e,r),i.registerServerObject(e,r,t.__newObjsTmp),r}function T(){this.objType,this.private=null,this.initialize()}function C(){this.documents=new Array,this.initialize()}function k(){}h.prototype.assembleNewObjects=function(e,t){var n=e.versions;e.__svrObjMap=new Object,e.__newObjsTmp=new Object;for(var i=0;i<n.length;i++){n[i].newObjs.forEach((function(t){e.__svrObjMap[t.id]=t}))}null!=e.newObjs&&e.newObjs.forEach((function(t){e.__svrObjMap[t.id]=t})),null!=e.newCustomObjs&&e.newCustomObjs.forEach((function(t){e.__svrObjMap[t.id]=t}));var o=e.__objRefers,a=o.length;for(i=0;i<a;i++){var r=o[i],s=r.parent;if(r.isArr)s[r.index]=b(r.oid,e,0,t);else s[r.field]=b(r.oid,e,0,t)}if(t.customFactory)for(var l=0;l<e.__namedObjRefers.length;l++){var u=e.__namedObjRefers[l];u.parent[u.field]=t.customFactory.createBinVarNamedObj(u.parent[u.field])}for(i=0;i<n.length;i++){var c=n[i].delayNewObjs;null!=c&&c.forEach((function(n){var i=b(n,e,0,t);t.delayLoadObj.add(i)}))}delete e.__namedObjRefers,delete e.__objRefers,delete e.__svrObjMap,delete e.__newObjsTmp},h.prototype.playDocumentInit=function(e,t){if(null==e.versions||1!=e.versions.length)return console.error("initial version shuoud be 1"),null;var n=e.versions[0];if(1!=n.ops.length||1!==n.ops[0].id)return console.error("init data error!"),null;var i=n.ops[0],o=t.getServerObjectByID(i.id);t.curVersion=n.dataVer,t.baseVersion=n.dataVer,t.initVersion=n.dataVer,t.taskVersion=n.taskVer,t.reachVersion=n.dataVer,o.forward(i);var a=i.data;return o.documents.push(a),a},h.prototype.appendVersionInfo=function(e){e.dataVer=this.baseVersion,e.taskVer=this.taskVersion,e.reachVer=this.reachVersion},h.prototype.lockCurVersion=function(){this.lockVersion=this.curVersion},h.prototype.lockCurrentUndoSteps=function(){this.lockUndoSteps=this.undoSteps},window.g_rpt=new h,T.prototype.initialize=function(){this.objType=r.default.OType_Nake},C.prototype=new a.AbsTopObject,k.prototype.addAttrs=function(e,t){for(var n in t.data)y(e)(n)},k.prototype.createObjectForSvr=function(e,t,n){var i=null;switch(e){case r.default.OType_Nake:i=new T,this.addAttrs(T,n),i.private=n.data;break;case r.default.OType_Data:i=new a.AbsObject,this.addAttrs(a.AbsObject,n),i.private=n.data;break;case r.default.OType_Vector:(i=new a.AbsVectorObject).private=n.data,i.vector=n.data;break;case r.default.OType_Delay_Vector:(i=new a.AbsDelayVectorObject).private=n.data,i.vector=n.data.vector,i.cnt=n.data.cnt,i.cnt&&i.cnt>i.vector.length&&(i.vector[i.cnt-1]=void 0);break;case r.default.OType_Custom:if("AbsModel"==t){(i=new o.a).applySvrData(n),this.addAttrs(o.a,n);break}i=new a.AbsCustomObject,this.addAttrs(a.AbsCustomObject,n),i.private=n.data}return i&&(i.objID=n.id),i},k.prototype.createTopObjectForSvr=function(e,t,n){var i=null;switch(e){case r.default.OType_Vector:(i=new a.AbsTopVectorObject).vector=n.data;break;case r.default.OType_Delay_Vector:(i=new a.AbsDelayTopVectorObject).vector=n.data.vector,i.cnt=n.data.cnt,i.cnt&&i.cnt>i.vector.length&&(i.vector[i.cnt-1]=void 0);break;case r.default.OType_Data:i=new a.AbsTopObject,this.addAttrs(a.AbsTopObject,n),i.private=n.data;break;case r.default.OType_Custom:i=new a.AbsTopCustomObject,this.addAttrs(a.AbsTopCustomObject,n),i.private=n.data}return i&&(i.objID=n.id),i},k.prototype.createBinVarNamedObj=function(e){return e};var w=function(e,t,n){y(e.constructor)(t),e[_(t).set](n)},S=function(e,t){console.assert(0!=t.length);var n=_(t).get;return null!=e[n]?e[n]():null},P=function(e){if(e&&e.private)for(var t in e.private)y(e.constructor)(t)}},1474:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.huawenFonts=void 0,t.huawenFonts=["华文中宋","华文彩云","华文仿宋","华文琥珀","华文楷体","华文隶书","华文宋体","华文细黑","华文新魏","华文行楷"]},1475:function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return s}));var i=0,o={Init:0,Checkpoint:1,ExpectLine:2,UpdatingLineAccepted:3,UpdatingLineRejected:4,LineDone:5,Restore:6,PageBroken:7,PackBroken:8,PackDone:9,SectionDone:10,DataDone:11,Rollback:12,Term:99},a={Pass:i,PackBroken:o.PackBroken,PageBroken:o.PageBroken,Rollback:o.Rollback},r={Init:0,Checkpoint:1,ExpectNextZone:2,LineBroken:3,LineEnd:4,DataEnd:5,Term:6},s={Pass:i,LineBroken:r.LineBroken,LineEnd:r.LineEnd,DataEnd:r.DataEnd}},1476:function(e,t,n){"use strict";function i(e){return e&&3===e.nodeType}Object.defineProperty(t,"__esModule",{value:!0}),t.mockScroll=t.isChrome=t.insertDom=t.createTextSpace=t.isTextSpace=t.isBrNode=t.isEmptyTextNode=t.isContentTextNode=t.isTextNode=t.isNoEditableNode=t.scrollToView=t.textSpaceCode=void 0,t.textSpaceCode="​",t.scrollToView=function(e){if(e&&!function(e){var t=!1,n=e.getBoundingClientRect(),i=n.top,o=n.bottom,a=window.APP.workspace.element.cacheDOMAttr.rect,r=a.top,s=a.height;return i>r&&o<r+s&&(t=!0),t}(e)){for(var t=window.APP.workspace,n=t.element.cacheDOMAttr.offsetHeight,i=0,o=e;o&&o!==t.element;)i+=o.offsetTop,o=o.parentNode;var a=i-n/2;a&&a>0&&(t.scrollTo({scrollTop:a}),setTimeout((function(){return t.onScroll()}),50))}},t.isNoEditableNode=function(e){return e&&"false"===e.contentEditable},t.isTextNode=i,t.isContentTextNode=function(e){return i(e)&&e.textContent.length},t.isEmptyTextNode=function(e){return i(e)&&!e.textContent.length},t.isBrNode=function(e){return e&&"BR"===e.tagName},t.isTextSpace=function(e){return i(e)&&e.textContent===t.textSpaceCode},t.createTextSpace=function(){return document.createTextNode(t.textSpaceCode)},t.insertDom=function(e,t,n){void 0===n&&(n="before");var i=t.parentNode;i&&("before"===n?i.insertBefore(e,t):"after"===n&&(i.lastChild==t?i.appendChild(e):i.insertBefore(e,t.nextSibling)))};var o=window.navigator.userAgent.toLowerCase();t.isChrome=-1!==o.indexOf("chrome");var a=function(){function e(t){var n=this;if(this.touchStart=function(e){var t=e.touches[0],i=t.pageX,o=t.pageY;n.touchStartX=i,n.touchStartY=o},this.touchMove=function(e){var t=e.touches[0],i=t.pageX,o=t.pageY;0==n.touchStartY&&(n.touchStartY=o),0==n.touchStartX&&(n.touchStartX=i);var a=o-n.touchStartY,r=i-n.touchStartX,s=Math.abs(a)/Math.abs(r)||0,l=Math.atan(s)/Math.PI*180;a=.3*Math.max(Math.min(a,60),-60);var u=e.target,c=u.scrollTop,h=u.clientHeight,d=u.scrollHeight;if(d>h&&l>45){var p=d-h;if(a>0){var f=Math.max(c-a,0);n.AnimationFrame&&cancelAnimationFrame(n.AnimationFrame),n.AnimationFrame=requestAnimationFrame((function(){u.scrollTop=f,n.AnimationFrame=null}))}else if(a<0){var g=Math.min(c-a,p);n.AnimationFrame&&cancelAnimationFrame(n.AnimationFrame),n.AnimationFrame=requestAnimationFrame((function(){u.scrollTop=g,n.AnimationFrame=null}))}}e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault()},e.instance)return e.instance;e.instance=this,this.dom=t,this.touchStartX=0,this.touchStartY=0}return e.destroy=function(){e.instance&&e.instance.unbindEvent()},e.prototype.bindEvent=function(){this.dom?(this.dom.addEventListener("touchstart",this.touchStart),this.dom.addEventListener("touchmove",this.touchMove)):delete e.instance},e.prototype.unbindEvent=function(){delete e.instance,this.AnimationFrame&&cancelAnimationFrame(this.AnimationFrame),this.dom&&(this.dom.removeEventListener("touchstart",this.touchStart),this.dom.removeEventListener("touchmove",this.touchMove))},e}();t.mockScroll=a},1477:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return l}));var i=n(167),o={LEFT:0,MIDDLE:1,RIGHT:2},a={A:65,B:66,C:67,D:68,E:69,F:70,H:72,I:73,J:74,K:75,L:76,M:77,R:82,S:83,U:85,X:88,Y:89,Z:90,BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,DELETER:46,LEFT_PARENTHESIS:219,RIGHT_PARENTHESIS:221,PERIOD:188,COMMA:190,LEFT:37,UP:38,RIGHT:39,DOWN:40,PAGEDOWN:34,PAGEUP:33,HOME:36,END:35,MINUS:189,ADD:187,EQUAL:61,CONNECT:173,ZERO:48,NUMBER_ADD:107,NUMBER_MINUS:109,NUMBER_ZERO:96};function r(e){return i.isMacOs?e.metaKey&&!e.altKey:e.ctrlKey&&!e.altKey}function s(e){return e.shiftKey}function l(e){return e.keyCode===a.ENTER}},1537:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSimplifiedChineseFontFamily=t.fontsSimplifiedChineseRecommended=t.fontsSimplifiedChinese=void 0;var i=n(1292),o=n(1474);t.fontsSimplifiedChinese=new Set(["Adobe 仿宋 Std","Adobe 宋体 Std","Adobe 楷体 Std","Adobe 黑体 Std","Hei","Kai","Microsoft JhengHei","Microsoft JhengHei Light","Microsoft JhengHei UI","Microsoft JhengHei UI Light","Microsoft YaHei UI","Microsoft YaHei UI Light","MingLiU","MingLiU_HKSCS","PMingLiU","STFangsong","STHeiti","STKaiti","STSong","仿宋","方正小标宋","方正姚体","方正舒体","兰亭黑-简","冬青黑体简体中文","凌慧体-简","华文中宋","华文仿宋","华文新魏","华文楷体","华文琥珀","华文行楷","华文隶书","娃娃体-简","圆体-简","宋体","宋体-简","微软雅黑","微软雅黑 Light","手札体-简","报隶-简","新宋体","楷体","楷体-简","翩翩体-简","苹方-简","行楷-简","隶变-简","雅痞-简","魏碑-简","黑体","幼圆","黑体-简","等线","等线 Light","楷体_GB2312","仿宋_GB2312","思源黑体","思源宋体","思源柔黑"].concat(i.founderFontList).concat(o.huawenFonts)),t.fontsSimplifiedChineseRecommended=new Set(["Adobe 仿宋 Std","Adobe 宋体 Std","Adobe 楷体 Std","Adobe 黑体 Std","Hei","Kai","Microsoft JhengHei","Microsoft JhengHei Light","Microsoft JhengHei UI","Microsoft JhengHei UI Light","Microsoft YaHei UI","Microsoft YaHei UI Light","MingLiU","MingLiU_HKSCS","PMingLiU","STFangsong","STHeiti","STKaiti","STSong","仿宋","方正小标宋","兰亭黑-简","冬青黑体简体中文","凌慧体-简","华文中宋","华文仿宋","华文新魏","华文楷体","华文琥珀","华文行楷","华文隶书","娃娃体-简","圆体-简","宋体","宋体-简","微软雅黑","微软雅黑 Light","手札体-简","报隶-简","新宋体","楷体","楷体-简","翩翩体-简","苹方-简","行楷-简","隶变-简","雅痞-简","魏碑-简","黑体","黑体-简","等线","等线 Light"]),t.isSimplifiedChineseFontFamily=function(e){return t.fontsSimplifiedChinese.has(e)}},1538:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTraditionalChineseFontFamily=t.fontsTraditionalChinese=void 0,t.fontsTraditionalChinese=new Set(["Apple LiGothic","Apple LiSung","BiauKai","Hiragino Sans CNS","LiHei Pro","LiSong Pro","兰亭黑-繁","凌慧体-繁","圆体-繁","娃娃体-繁","宋体-繁","手札体-繁","报隶-繁","楷体-繁","翩翩体-繁","苹方-港","苹方-繁","行楷-繁","隶变-繁","雅痞-繁","魏碑-繁","黑体-繁"]),t.isTraditionalChineseFontFamily=function(e){return t.fontsTraditionalChinese.has(e)}},1583:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1142);var l=function(){function e(){o()(this,e),this._zoom=1}return r()(e,[{key:"single_reset",value:function(){}},{key:"zoom",get:function(){return this._zoom},set:function(e){this._zoom=e}},{key:"dpr",get:function(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI||1}}],[{key:"getZoom",value:function(){return e.getInstance().zoom}},{key:"getDPR",value:function(){return e.getInstance().dpr}},{key:"setZoom",value:function(t){e.getInstance().zoom=t}}]),e}();t.a=l;s.a.buildInstance(l)},1590:function(e,t,n){"use strict";n.r(t),n.d(t,"wpsUnderlineNone",(function(){return i})),n.d(t,"wpsUnderlineSingle",(function(){return o})),n.d(t,"wpsUnderlineWords",(function(){return a})),n.d(t,"wpsUnderlineDouble",(function(){return r})),n.d(t,"wpsUnderlineDotted",(function(){return s})),n.d(t,"wpsUnderlineThick",(function(){return l})),n.d(t,"wpsUnderlineDash",(function(){return u})),n.d(t,"wpsUnderlineDotDash",(function(){return c})),n.d(t,"wpsUnderlineDotDotDash",(function(){return h})),n.d(t,"wpsUnderlineWavy",(function(){return d})),n.d(t,"wpsUnderlineWavyHeavy",(function(){return p})),n.d(t,"wpsUnderlineDottedHeavy",(function(){return f})),n.d(t,"wpsUnderlineDashHeavy",(function(){return g})),n.d(t,"wpsUnderlineDotDashHeavy",(function(){return v})),n.d(t,"wpsUnderlineDotDotDashHeavy",(function(){return m})),n.d(t,"wpsUnderlineDashLong",(function(){return _})),n.d(t,"wpsUnderlineDashLongHeavy",(function(){return y})),n.d(t,"wpsUnderlineWavyDouble",(function(){return b}));var i=0,o=1,a=2,r=3,s=4,l=6,u=7,c=9,h=10,d=11,p=27,f=20,g=23,v=25,m=26,_=39,y=55,b=43},1591:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i={Unknow:0,Text:1,HFPageNumField:2,HFPageCountField:3,FitText:4,TwoLinesInOne:5,Footnote:6,Endnote:7,NotePlaceholder:8,EQField:9},o={CBT_Undefine:0,CBT_FootnoteNum:1,CBT_EmbedDrawing:2,CBT_NumberField:3,CBT_EQCharBox:4,CBT_TextSymbol:5,CBT_TwoLineInOne:6,CBT_HorzInVert:7,CBT_FieldCode:8,CBT_CheckBox:9,CBT_CombleBox:10,CBT_Expression:11,CBT_CircleNumber:12,CBT_MacroButton:13,CBT_AutoNum:14,CBT_ContentNode:15,CBT_EmptyContentNode:16,CBT_CurPageNumber:17,CBT_StyleRefField:18,CBT_Math:19,CBT_StringMath:20,CBT_MathEQAnd:21,CBT_ImageNumber:22}},1631:function(e,t,n){"use strict";n.d(t,"g",(function(){return m})),n.d(t,"f",(function(){return _})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return b})),n.d(t,"e",(function(){return k})),n.d(t,"a",(function(){return S})),n.d(t,"d",(function(){return P}));var i=n(811),o=n(1251),a=n(310),r=n(411),s=n(8),l=n.n(s),u=n(1),c=n.n(u),h=n(2),d=n.n(h),p=n(908),f=function(){function e(){c()(this,e),this.lines=[],this.rect={},this.position=Number.MAX_SAFE_INTEGER}return d()(e,[{key:"pushLines",value:function(e){this.lines=[].concat(l()(this.lines),l()(e))}},{key:"updatePosition",value:function(e){this.position=Math.min(this.position,e)}},{key:"updateRect",value:function(){var e={};this.lines.forEach((function(t){var n=t.rect.size,i=n.width,o=n.height,a=p.a.getPosition2view(t),r=a.x,s=r+i,l=a.y,u=l+o;e.left=isNaN(e.left)?r:Math.min(e.left,r),e.right=isNaN(e.right)?s:Math.max(e.right,s),e.top=isNaN(e.top)?l:Math.min(e.top,l),e.bottom=isNaN(e.bottom)?u:Math.max(e.bottom,u)})),e.size={width:e.right-e.left,height:e.bottom-e.top},this.rect=e}},{key:"hasContent",get:function(){return!!this.lines.length}},{key:"range",get:function(){var e=this,t={pos:Number.MAX_SAFE_INTEGER,len:0};return this.lines.forEach((function(n){t.pos=Math.min(e.position,n.range.pos),t.len+=n.range.len})),t}}]),e}(),g=n(772),v=n(336);function m(e,t){if(!(e&&t&&e.prop&&t.prop))return!0;var n=e.prop.getPropVal("table_row"),a=t.prop.getPropVal("table_row");return!n||!a||(!Object(i.k)(n.tableStyle,a.tableStyle)||(!n.wrapInfo||n.wrapInfo.mode!==o.f||!a.wrapInfo||a.wrapInfo.mode!==o.f)&&(!Object(i.k)(n.wrapInfo,a.wrapInfo)||n.topFromText!==a.topFromText||n.leftFromText!==a.leftFromText||n.rightFromText!==a.rightFromText||n.bottomFromText!==a.bottomFromText||n.tableXPos!==a.tableXPos||n.tableYPos!==a.tableYPos||n.overLap!==a.overLap))}function _(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i){if(0===t&&t===n)return 0;if(o&&t===n)return 0}var a=e.getPapx(t);if(t===n)return a.prop.getPropVal("nest_level");for(var r=Number.MAX_SAFE_INTEGER;a.good&&a.pos<n;e.movePapxToNext(a))r=Math.min(r,a.prop.getPropVal("nest_level"));return r}function y(e,t,n){var i=[],o=e.specTable,r=o.getTapx(t,a.IT.Include,n),s=r.prop?r.duplicate():null;if(i.push(s),null!==s){var l=o.getTapx(s.end,a.IT.Include,n),u=l.prop&&!m(l,r)?l.duplicate():null;i.push(u),s.isTableLast=null===u}return i}function b(e,t,n){var i=e.getDataLogic("final").specTable,o=i.getTapx(t,a.IT.Include,n);if(!o||!o.prop)return null;for(var r=void 0!==n?n:o.prop.getPropVal("nest_level"),s=[o.duplicate()],l=o.pos,u=o.pos+o.len,c=o,h=i.getTapx(l,a.IT.Exclude,r),d=i.getTapx(u,a.IT.Include,r);h&&h.prop&&!m(h,c);)c=h,s.push(h.duplicate()),h=i.getTapx(h.pos,a.IT.Exclude,r);for(s.reverse(),c=o;d&&d.prop&&!m(c,d);)c=d,s.push(d.duplicate()),d=i.getTapx(d.pos+d.len,a.IT.Include,r);return{range:{pos:s[0].pos,len:s[s.length-1].pos+s[s.length-1].len-s[0].pos},rows:s}}function T(e){var t=[];if(e.prop.table_row.rgdxa)e.prop.table_row.rgdxa.forEach((function(e){t.push(e)}));else{t.push(-108);var n=!1;if(e.cells.forEach((function(e){void 0===e.width||0!==e.width.type?n=!0:t.push(t[t.length-1]+e.width.width)})),n)for(var i=8522/e.cells.length,o=0;o<e.cells.length;++o)t.push(t[t.length-1]+i)}return t=t.map((function(e){return Object(v.Ti2Px)(e)}))}function C(e,t){for(var n=T(t),i=!0,o=n[0],a=0;a<t.cells.length;++a){var r=t.cells[a],s=n[a+1];if(e>=o&&e<s){i=(r.vertMerge||g.e.NONE)!==g.e.MIDDLE;break}o=s}return i}function k(e,t,n,i){var o=e.vertMerge||g.e.NONE;return o!==g.e.FIRST||i&&!C(T(n)[t],i)||(o=g.e.NONE),o===g.e.MIDDLE&&(i&&!C(T(n)[t],i)||(o=g.e.LAST)),o}function w(e,t,n){if(0===n){var i=e.getPapx(t);if(i.prop.text_frame){var o=i.len,r=e.specTable.getTapx(t,a.IT.Include,n+1);r&&r.prop&&(o=r.len);var s=Object.assign({},i.prop.text_frame);return s.vertPos=s.vertPos||0,{pos:i.pos,len:o,text_frame:s,isWrapTable:!1}}}var l=e.specTable.getTapx(t,a.IT.Include,n+1);return l&&l.prop&&l.prop.text_frame?{pos:l.pos,len:l.len,text_frame:l.prop.text_frame,isWrapTable:!0}:null}function S(e,t,n){var o=w(e,t,n);if(!o)return null;for(var a=o.pos+o.len,r=w(e,a,n);null!==r&&Object(i.k)(r.text_frame,o.text_frame);)r=w(e,a=r.pos+r.len,n);return{range:{pos:t,len:a-t},frameProp:o}}function P(e){var t=[];e.typoinfo.layout_pages.forEach((function(n){n.mainpages.forEach((function(n){t=t.concat(function(e,t){var n=[],i=void 0,o=t.lines.length,s=e.doc.getDataLogic("final").specTable;return t.lines.forEach((function(e,t){if(e.layoutType===r.DOCLayoutType.TableLine){i||(i=new f);var l=!0;if(i.lines.length>0){var u=i.lines[i.lines.length-1].range.end,c=s.getTapx(u,a.IT.Exclude),h=e.range.end;m(c,s.getTapx(h,a.IT.Exclude))&&(i.updateRect(),n.push(i),i=void 0,l=!1)}l&&(i.pushLines([e]),i.updatePosition(e.range.pos))}!i||e.layoutType===r.DOCLayoutType.TableLine&&t!==o-1||(i.updateRect(),n.push(i),i=void 0)})),n}(e,n))}))}));var n=[],i={};return t.forEach((function(t){var o=b(e.doc,t.position).range,a=o.pos,r=o.len,s=i,l=s.pos,u=s.len,c=n.length-1;l==a&&u==r?n[c].lines=n[c].lines.concat(t.lines):n.push({lines:t.lines,range:o}),i=o})),n}},1639:function(e,t,n){"use strict";n.r(t),n.d(t,"RichText",(function(){return i})),n.d(t,"PureText",(function(){return o})),n.d(t,"Picture",(function(){return a})),n.d(t,"ComboBox",(function(){return r})),n.d(t,"DropdownList",(function(){return s})),n.d(t,"BuildingBlock",(function(){return l})),n.d(t,"Date",(function(){return u})),n.d(t,"Group",(function(){return c})),n.d(t,"CheckBox",(function(){return h})),n.d(t,"RepeatSec",(function(){return d})),n.d(t,"DocpartObj",(function(){return p})),n.d(t,"Unknown",(function(){return f}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7,h=8,d=9,p=10,f=11},1640:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var i=function(){sessionStorage.setItem("login_change_notice","true")},o=function(){return"true"===sessionStorage.getItem("login_change_notice")},a=function(){sessionStorage.removeItem("login_change_notice")}},1643:function(e,t,n){"use strict";n.r(t),n.d(t,"encodeBkName",(function(){return s})),n.d(t,"decodeBkName",(function(){return l})),n.d(t,"getTime",(function(){return u})),n.d(t,"isValidCommentBkName",(function(){return c})),n.d(t,"getCommentUserIdByCommentBody",(function(){return h}));var i=n(144),o=n.n(i),a="_T",r="_V",s=function(e,t){var n=e+"_"+window.APP.info.userid;return"voice"==t?r+n:a+n},l=function(e){if(!e||e.length<3||"_"!=e[0])return null;var t=e.slice(0,2),n="",i="",s="",l=e.slice(2).split("_"),u=o()(l,2);return i=u[0],s=u[1],t===r?n="voice":t===a?n="text":(n="other",i=e,s=""),{type:n,comment_id:i,userId:s}},u=function(e){var t=e;if("string"==typeof e)t=new Date(t.replace(/-/g,"/"));else{if("number"==typeof e)return e;t=new Date}return Math.floor(t.getTime()/1e3)},c=function(e){return e.length>2&&"_"===e[0]&&("V"===e[1]||"T"===e[1])};function h(e){var t=window.APP.data.doc.bookmarks.getBookmarkByCommentBody(e);if(t){var n=t.data.getName(),i=l(n);if(i)return i.userId}}},1731:function(e,t,n){"use strict";n.d(t,"n",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return s})),n.d(t,"g",(function(){return l})),n.d(t,"h",(function(){return u})),n.d(t,"i",(function(){return c})),n.d(t,"j",(function(){return h})),n.d(t,"k",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"o",(function(){return f})),n.d(t,"b",(function(){return g})),n.d(t,"p",(function(){return v})),n.d(t,"l",(function(){return m})),n.d(t,"q",(function(){return _})),n.d(t,"m",(function(){return y}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7,h=8,d=9,p=34,f=65,g=85,v=90,m=260,_=4094,y=4095},1732:function(e,t,n){"use strict";n.d(t,"h",(function(){return s})),n.d(t,"g",(function(){return l})),n.d(t,"i",(function(){return u})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return d})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return f})),n.d(t,"f",(function(){return g}));var i=n(80),o=n.n(i);function a(e,t){var n=window.APP.data.doc.getLimitedRange(e);return Math.min(n.pos+n.len,e+t)}function r(e){return new Promise((function(t){setTimeout(t,e)}))}function s(e,t){var n=window.APP.data,i=!1,a=n.selection.begin.position,s=n.typoinfo,l=0;if(n.doc.useCoreTypo&&(window.APP.isPCMode()||window.APP.isPaginationMode())){var u=s.getPosition(e);if((l=u.locate().position)===e)return Promise.resolve(u)}else{var c=s.getLayoutPageCache(s.pageCount-1);if(c&&(l=c.range?c.range.pos+c.range.len:c.end,e<=l))return Promise.resolve(e)}a=l;var h=new Promise((function(n,s){var u=function(){i=!0};t&&t.start&&t.start(u);var c=void 0;!function(){var h=o()(regeneratorRuntime.mark((function o(){var h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!i){o.next=4;break}return c=null,s("promise reject: typo to position: cancel"),o.abrupt("return");case 4:if(window.APP.data.api.queryRange({gcpCurrent:a,length:5e3}),a=Math.min(a+5e3,e),(c=window.APP.data.typoinfo.getPosition(a)).pos){o.next=12;break}t&&t.end&&t.end(),s("promise reject: typo to position: over position pos"),o.next=21;break;case 12:h=0;case 13:if(!(c.pos.position!==a&&h<10)){o.next=19;break}return o.next=16,r(100);case 16:h++,o.next=13;break;case 19:t&&t.update&&t.update(u,Math.ceil((a-l)/(e-l)*100)),c.pos.charPosY&&c.pos.position===e?(t&&t.end&&t.end(),n(c)):setTimeout((function(){d()}),300);case 21:case"end":return o.stop()}}),o,this)})));function d(){return h.apply(this,arguments)}return d}()()}));if(h)return h.cancel=function(){i=!0},h.isPoll=!0,h}function l(e,t,n){if(n&&!1===n())return t&&t(-1),!1;var i=window.APP.data.typoinfo;i.calcRects();var o=i.isTypoEnd,r=i.pagePos,u=i.outer_rects;if(o||u.length>=e){var c=Math.min(u.length,e);t&&t(c)}else{if(Array.isArray(r)&&r.length>1)s(a(r[r.length-1].endPos,5e3)).then((function(){l(e,t,n)})).catch((function(){l(e,t,n)}));else setTimeout((function(){l(e,t,n)}),500)}}function u(e,t){var n=window.APP.data.typoinfo;if(n.updater.goodViewport({bottom:e})){var i=n.height;t&&t(i)}else{s(a(n.range.end,5e3)).then((function(){u(e,t)})).catch((function(){var e=n.height;t(e)}))}}function c(e){var t=e.parent.lines,n=[],i=t.findIndex((function(t){return t===e})),o=i;if(!e.is_para_first&&t[0]!==e)for(var a=i-1;a>0;a--)if(t[a].is_para_first){o=a;break}n.push(t[o]);for(var r,s=o+1;s<t.length&&!(r=t[s]).is_para_first;s++)n.push(r);return n}function h(e){var t=null,n=e.parent.lines;if(n.length>1){var i=e.parent.lines.indexOf(e);if(0!==i)return n[i-1]}else{var o=e.viewPage,a=o.parent.layout_pages,r=a.indexOf(o),s=a[r-1];s&&(s.mainPages?t=s.mainPages.slice(-1)[0].lines.slice(-1)[0]:s.page&&(t=s.page.lines.slice(-1)[0]))}return t}function d(e){var t=window.APP.data.doc.getDataLogic("final");try{var n=t.getChpx(e);if(!n.prop.highlight_color||"#ffffffffff000000"===n.prop.highlight_color)return null;var i=function e(n){var i=t.getPrevChpx(n);return i.good&&i.prop.highlight_color===n.prop.highlight_color?e(i):n.pos}(n);return{pos:i,len:function e(n){var i=t.getNextChpx(n);return i.good&&i.prop.highlight_color===n.prop.highlight_color?e(i):n.pos+n.len}(n)-i}}catch(e){}}function p(e,t){return e-t>1e-12}function f(e,t){return Math.abs(e-t)<=1e-12}function g(e,t){return p(e,t)||f(e,t)}},1733:function(e,t,n){"use strict";n.r(t),n.d(t,"collectRows",(function(){return f})),n.d(t,"collectColumns",(function(){return p})),n.d(t,"collectTable",(function(){return h})),n.d(t,"getFirstMergedCell",(function(){return v})),n.d(t,"getNestedCells",(function(){return m})),n.d(t,"getCellRangeByPos",(function(){return _})),n.d(t,"isFirstRowInTable",(function(){return y})),n.d(t,"isInSameTable",(function(){return b})),n.d(t,"findFirstMergeLine",(function(){return T})),n.d(t,"hiddenInNestingTable",(function(){return C}));var i=n(8),o=n.n(i),a=n(772),r=n(310),s=n(1631),l=n(2011),u=n(411),c=n(7753);function h(e,t,n){var i=Object(s.c)(e,t,n);if(!i)return null;var o=i.rows,a=i.range;return{tapxs:o,range:{begin:a.pos,end:a.pos+a.len}}}function d(e,t,n){var i=void 0===t&&void 0===n,o=[],a=[],r=[];return e.length>0&&e.some((function(e){if(!e||!e.prop)return!1;var s=void 0,l=void 0,u=e.cellDatas,c=e.prop.table_row.rgdxa;a.push([]),r.push([]),u.forEach((function(e,o){(t>=c[o+1]||n<=c[o])&&!i||(a[a.length-1].push(e),r[r.length-1].push(o),s=void 0===s?e.begin:s,l=e.end)})),!a[a.length-1].length&&a.pop(),!r[r.length-1].length&&r.pop(),void 0!==s&&void 0!==l&&o.push({begin:s,end:l,bSelAllCell:!1})})),{cells:a,ranges:o,idxs:r}}function p(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER,o=e.getDataLogic("final"),a=o.getPapx(t)||{},r=o.getPapx(n);if(!a||!r)return{};var s=a.prop.nest_level,l=void 0===s?0:s,u=r.prop.nest_level,c=void 0===u?0:u,p=Math.min(l,c,i);if(0===p)return{};var f=h(e,t,p),v=f.tapxs,m=g(t,v),_=g(n,v),y=Math.min(m.rgdxa.left,_.rgdxa.left),b=Math.max(m.rgdxa.right,_.rgdxa.right),T=d(v,y,b),C=T.cells,k=T.ranges,w=T.idxs;return{cells:C,idxs:w,ranges:k,tapxs:v,left:y,right:b}}function f(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER,o=e.getDataLogic("final"),a=o.getPapx(t).prop,r=o.getPapx(n-1).prop,s=a.nest_level,l=r.nest_level,u=Math.max(Math.min(s,l,i),1),c=o.specTable.collectTapxs(t,n-t,u).filter((function(e){return e&&e.prop}));if(c.length){var h={begin:Number.MAX_SAFE_INTEGER,end:Number.MIN_SAFE_INTEGER};c.forEach((function(e){h.begin=Math.min(h.begin,e.begin),h.end=Math.max(h.end,e.end)}));var p=d(c),f=p.cells,g=p.idxs;return{range:h,tapxs:c,cells:f,idxs:g}}return{}}function g(e,t){var n=t.find((function(t){return e>=t.begin&&e<t.end}));if(!n||!n.prop)return null;var i=n.cellDatas,o=n.prop.table_row.rgdxa,a=i.findIndex((function(t){return e>=t.begin&&e<t.end}));return~a?{range:i[a],rgdxa:{left:o[a],right:o[a+1]}}:void 0}function v(e,t,n,i){var o={level:0},s=e.getDataLogic("final"),l=s.getPapx(n-1).prop;if(!l)return o;var u=l.nest_level,c=s.specTable.getTapx(t,r.IT.Include,u);if(c&&c.prop){var h=c.prop.table_row,d=c.cells,p=c.cellDatas,f=h.rgdxa,g=void 0===f?[]:f,v=g[i],m=g[i+1];if(d[i].vertMerge!==a.e.MIDDLE)return o.tapx=c,o.level=u,o.range=p[i],o;for(var _=c.getPrevNode();_&&_.prop;){var y=_,b=y.cells,T=y.cellDatas,C=_.prop,k=C.table_row,w=C.nest_level,S=k.rgdxa;if(w===u){for(var P=0,I=T.length;P<I;P++)if(v<=S[P]&&m>=S[P+1]&&b[P].vertMerge!==a.e.MIDDLE)return o.tapx=_,o.level=u,o.range=T[P],o}else if(w<u)break;_=_.getPrevNode()}}return o}function m(e,t,n,i){var a=e.getDataLogic("final"),s=v(e,t,n,i),l=[].concat(o()(s.level?[s]:[]));return s.level>1&&function(){for(var e=s.level,t=s.range.begin,n=1;n<e;++n){var i=a.specTable.getTapx(t,r.IT.Include,n);if(i&&i.prop){var o=i.cellDatas.find((function(e){return t>=e.begin&&t<e.end}));o&&l.push({level:n,range:o})}}}(),l}function _(e,t,n){var i=void 0,o=e.getDataLogic("final").specTable.getTapx(t,r.IT.Include,n);return o&&o.prop&&(i=o.cellDatas.find((function(e){return t>=e.begin&&t<e.end}))),i}function y(e,t,n,i){var o=e.getDataLogic("final"),a=e.getBodyRange(t).begin,l=((o.getPapx(n-1)||{}).prop||{}).nest_level;if(!l||void 0!==i&&l!==i)return!1;if(t===a)return!0;var u=o.specTable.getTapx(t,r.IT.Include,l),c=o.specTable.getTapx(t,r.IT.Exclude,l);return Object(s.g)(c,u)}function b(e,t,n){var i=e.getDataLogic("final"),o=i.getPapx(t),a=i.getPapx(n);if(!o||!a)return!1;var r=(o.prop||{}).nest_level,s=void 0===r?0:r,l=(a.prop||{}).nest_level,u=void 0===l?0:l;if(!s||!u)return!1;var c=Math.min(s,u),d=h(e,t,c).range,p=h(e,n,c).range;return d.begin===p.begin&&d.end===p.end}function T(e,t,n){for(var i=t-1;i>=0;--i){var o=n[i];if(!(o instanceof l.a))break;for(var r=0;r<o.tablecells.length;++r){var s=o.tablecells[r];if(s.merge_type===a.e.FIRST&&e>=s.rect.left&&e<s.rect.right)return o}}return null}function C(e,t,n){if(e>0&&e===t.lines.length-1&&t.lines[e-1].layoutType===u.DOCLayoutType.TableLine){var i=t.lines[e];if(1===i.range.len)if(n.glyphBuff.getCharCode(i.range.pos)===c.DOCTypoPlaceholder.EndPara)return!0}return!1}},1734:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return r}));var i=0,o=1,a=2,r=3},1735:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSelectionEnd=t.selectAllByNode=t.setRangeByNode=t.setRangeByRange=t.createRange=t.getCurrentRange=void 0;var i=n(1476);function o(e,t,n,i){n||(n=e),i||(i=t);var o=document.createRange();return o.setStart(e,t),o.setEnd(n,i),o}function a(e){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}function r(e,t,n,i){var r=o(e,t,n,i);return a(r),r}t.getCurrentRange=function(){var e=window.getSelection();return e&&e.rangeCount?e.getRangeAt(0):null},t.createRange=o,t.setRangeByRange=a,t.setRangeByNode=r,t.selectAllByNode=function(e){var t=window.getSelection();t.removeAllRanges(),t.selectAllChildren(e)},t.setSelectionEnd=function(e){var t=getSelection();if((0,i.isTextSpace)(e.lastChild))r(e.lastChild,0);else{if((0,i.isBrNode)(e.lastChild)){var n=e.lastChild.previousSibling;if((0,i.isTextSpace)(n))return void r(n,0)}(0,i.isEmptyTextNode)(e.lastChild)&&e.lastChild.remove(),t.selectAllChildren(e),t.collapseToEnd()}}},1736:function(e,t,n){"use strict";n.r(t),n.d(t,"Auto",(function(){return i})),n.d(t,"Left",(function(){return o})),n.d(t,"Center",(function(){return a})),n.d(t,"Right",(function(){return r})),n.d(t,"Adjustify",(function(){return s})),n.d(t,"FullAdjustify",(function(){return l})),n.d(t,"MiddleJustify",(function(){return u})),n.d(t,"CenterAcross",(function(){return c})),n.d(t,"HighJustify",(function(){return h})),n.d(t,"LowJustify",(function(){return d})),n.d(t,"ThaiFullAdjustify",(function(){return p}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7,h=8,d=9,p=10},1737:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1285),l=n(6117),u=n(1291),c=n(1032),h=n(309),d=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o()(this,e),this.selection=t,"number"==typeof n?(this.position=n,this.glyphTail=i):n instanceof e?(this.position=n.position,this._isInFooter=n._isInFooter,this.glyphTail=n.glyphTail):(this.position=n.position,this.glyphTail=n.glyphTail,this._isInFooter=n.isInFooter,l.a.setPos(this.position,n,this.glyphTail,t))}return r()(e,[{key:"locate",value:function(){return s.a.locate(window.APP.data,this.position,!1,window.APP.data.typoinfo)}},{key:"isTypeset",get:function(){return this.locate().position===this.position}},{key:"isInFooter",get:function(){if(void 0!==this._isInFooter)return this._isInFooter;var e=this.pos;return!!e&&e.isInFooter}},{key:"isInComment",get:function(){return this.selection.data.doc.getSubDocType(this.position)===h.Comment}},{key:"pos",get:function(){if(null===this.position||void 0===this.position)return null;var e=this.selection,t=l.a.getPos(this.position,this.glyphTail,this.selection);if(!t||!t.posX){if(e.data.typoinfo.updater){e.getTableRange(this.position)&&e.data.typoinfo.updater.updateToPosInContext(e.data,this.position);var n=e.data.doc.getSubDocRange(h.MainText),i=n.pos,o=n.len,a=this.position===i+o?this.position:this.position+1;e.data.typoinfo.updater.updateToPosInContext(e.data,a)}var r=e.data.doc.getSubDocType(this.position),u=e.selContext.isInHeaderFooter;if(r!==h.HeaderFooter&&r!==h.TextboxInHF?e.selContext.setInHeaderFooterPurely(!1):e.selContext.setInHeaderFooterPurely(!0),!1===(t=s.b.locate(e.data,this.position,this.glyphTail,e.data.typoinfo))){if(!1===(t=s.b.locate(e.data,this.position,!this.glyphTail,e.data.typoinfo)))return e.selContext.setInHeaderFooterPurely(u),null;this.glyphTail=!this.glyphTail}e.selContext.setInHeaderFooterPurely(u),l.a.setPos(this.position,t,this.glyphTail,e)}return t&&(t=function(e){if(!e)return{};var t=Object.assign({},e),n=t.line.viewPage;return n._drawingOffset&&(t.posX-=n._drawingOffset.x),t}(t)),t}},{key:"pageNo",get:function(){return this.pageIndex}},{key:"pageIndex",get:function(){return this.pos.layoutIndex+1}},{key:"sectionIndex",get:function(){var e=this.pos.position,t=this.selection.selContext;if(t.isInHeaderFooter)e=this.selection.data.typoinfo.layout_pages[t.headerfooterLayoutIndex].range.pos;else if(t.isInTextbox){var n=this.selection.begin.pageIndex-1;e=this.selection.data.typoinfo.layout_pages[n].range.pos}var i=1;return this.selection.data.doc.sections.rangeClass.forEachHint((function(t){if(e<t.end)return!0;++i})),i}},{key:"colOfTextPage",get:function(){return this.pos.position-this.pos.line.range.pos+1}},{key:"rowOfTextPage",get:function(){var e=this.pos.line;e instanceof u.a&&(e=e.parent);var t=e.parent;return t instanceof c.d?t.lines.findIndex((function(t){return t===e}))+1:0}}]),e}();t.a=d},1804:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var i=0,o=1,a=2,r=3},1805:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPrivileges=t.privileges=void 0,t.privileges={font_founder_official:!1};var i=null;function o(){var e=window.__WPSENV__;if(window.__CONFIG__.wps.isOfficialFounderFont)return t.privileges.font_founder_official=!0,Promise.resolve(t.privileges);try{var n=e.user_id;if(n&&("-1"===n||n.startsWith("fake")))throw new Error("not login");if(!window.fileInfo||!window.fileInfo.id)throw new Error("no file info")}catch(e){return Promise.reject(e)}return i||((i=e.request({method:"POST",url:"/api/v3/office/file/".concat(window.fileInfo.id,"/privilege_list"),responseType:"json",body:JSON.stringify({privilege_names:["font_founder_official"]})}).end().then((function(e){if(200===e.status){var n=e.body.privileges.font_founder_official;if(n)n.expire_at>0&&1e3*n.expire_at<Date.now()||(t.privileges.font_founder_official=!0);return t.privileges}throw new Error("unknown response status")})).catch((function(e){throw i=null,e})))||Promise.reject("parse response error"))}t.getPrivileges=o,o().catch(Function.prototype)},1806:function(e,t,n){"use strict";n.r(t),n.d(t,"classes",(function(){return i})),n.d(t,"ItemConfig",(function(){return o})),n.d(t,"categories",(function(){return a}));var i={mention:"mention",filelink:"filelink",link:"link"},o={user:"mention",file:"filelink"},a={avatar:"avatar",text:"text"}},1807:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(626),f=n(411),g=n(1291),v=n(7534),m=n(400),_=2,y=28;var b=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.compose,u=n.textline,c=n.pageOffsetFromServer;o()(this,t);var h=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r},{compose:s,textline:u,pageOffsetFromServer:c}));return u&&h._initFromRawLine(u,c),h}return d()(t,e),r()(t,[{key:"composeProcess",value:function(e,n){this.sublines&&this.sublines.length?this.sublines.forEach((function(t){t.composeProcess(e,n)})):c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"composeProcess",this).call(this,e,n)}},{key:"_initFromRawLine",value:function(e,t){var n=this;e.sublines&&(this.sublines||(this.sublines=[]),e.sublines.forEach((function(e){var i=new g.a({parent:n,viewPage:n.viewPage,coorSystem:n.coorSystem},{compose:n.compose,subline:e,pageOffsetFromServer:t});n.sublines.push(i),n.view.attachTextLine(i)})),this.sublines[0]&&this.sublines[0].auto_num&&(this.auto_num=null)),e.autoNum&&this._initAutoNum(e),this._initBitflagsEx(e),this._initBitFlags(e),e.isFrameLine?this.view.attachFrameLine(this):this.view.attachTextLine(this)}},{key:"_initAutoNum",value:function(e){this.auto_num=new v.a({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem,gcp:e.range.position},{compose:this.compose,autoNum:e.autoNum})}},{key:"_initBitflagsEx",value:function(e){var t=e.bitflagsEx;t&&(this.isPageBrokenParaMark=t&1<<_)}},{key:"_initBitFlags",value:function(e){var t=e.bitflags;t&&(this.isHidden=t&1<<y)}},{key:"term",value:function(){}},{key:"layoutType",get:function(){return f.DOCLayoutType.TextLine}},{key:"offset4child",get:function(){return p.a.ZERO()}},{key:"renderRect",get:function(){if(this.before_space||this.after_space||this.border&&(this.border.before_width||this.border.after_width)){var e=this.rect,t=e.left,n=e.right,i=this.rect,o=i.top,a=i.bottom;this.before_space&&(o-=this.before_space),this.after_space&&(a+=this.after_space);var r=this.border;return r&&(r.before_width&&(o-=r.before_width),r.after_width&&(a+=r.after_width)),m.a.initByRawRect({left:t,top:o,right:n,bottom:a})}return this.rect}}]),t}(g.b);t.a=b},1808:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAtPosition=t.getAtAttrs=t.isTrueAtDom=t.createAtDom=t.closeAt=t.showAt=t.hasTempAtDom=t.setTempAtDom=t.getTempAtDom=void 0;var i,o,a=n(5),r=a.__importDefault(n(260)),s=a.__importStar(n(167)),l=n(1806),u=n(246),c=n(1735),h=null,d=null;function p(){return d}function f(e){d=e}function g(){return!!d}function v(e){void 0===e&&(e=!1),e&&r.default.dispatchEvent(r.default.comments.COLSE_AT_MODEL),f(null),m(!1)}function m(e){s.isMobile?function(e){e?window.addEventListener("keydown",b):window.removeEventListener("keydown",b)}(e):function(e){o||(o=window.utils.Lodash.debounce(y,100));i||(i=window.utils.Lodash.debounce(_,16));if(e){window.addEventListener("keydown",b),document.addEventListener("selectionchange",o),window.addEventListener(r.default.comments.ON_COMMENT_PANEL_SCROLL,i),h&&h.disconnect();var t=function(){var e=null;if(g())for(var t=p().parentNode;t;)t.classList&&t.classList.contains("comment-modal-body")?(e=t,t=null):t=t.parentNode;return e}();t&&((h=new MutationObserver(i)).observe(t,{childList:!0,subtree:!0}),window.addEventListener("resize",i,!1))}else window.removeEventListener("keydown",b),document.removeEventListener("selectionchange",o),window.removeEventListener(r.default.comments.ON_COMMENT_PANEL_SCROLL,i),h&&(h.disconnect(),h=null,window.removeEventListener("resize",i,!1))}(e)}function _(){if(g()){var e=p();if(!e.parentNode)return;var t=T((0,c.createRange)(e,e.textContent.length).getBoundingClientRect());r.default.dispatchEvent(r.default.comments.SHOW_AT_MODEL,{position:t,isUpdate:!0})}}function y(){if(g()){var e=(0,c.getCurrentRange)(),t=window.APP.workspace.commentInput.element;if(e&&t.contains(e.commonAncestorContainer)){var n=p();(e.startContainer!==n||e.endContainer!==n||e.startOffset<=n.startOffset)&&v(!0)}}}function b(e){var t=(0,u.getKey)(e);return![u.Keys.Tab,u.Keys.Enter,u.Keys.Esc,u.Keys.ArrowLeft,u.Keys.ArrowUp,u.Keys.ArrowRight,u.Keys.ArrowDown].includes(t)||(e.preventDefault(),e.stopPropagation(),!1)}function T(e){var t,n,i={bound:{},begin:{},end:{}},o=window.APP,a=o.workspace.element.cacheDOMAttr,r=a.rect,l=a.scrollLeft,u=a.scrollTop,c=a.clientWidth,h=a.clientHeight,d=s.isPad?o.appApi.keyboardHeight:0,p=window.APP.workspace.commentInput&&window.APP.workspace.commentInput.element||document.querySelector("#root .temp_comment_input"),f=p&&p.getBoundingClientRect()||e,g=!0;if(e.right/r.right<.5&&(g=!1),o.commentShowStatus.commentBubble)t=f.left+l,n=e.top+u-r.top,i.bound={left:l,right:g?l+f.x:l+c,top:u,bottom:u+h-d};else{t=f.left,n=e.top;var v=document.body.cacheDOMAttr,m=v.clientWidth,_=v.clientHeight;i.bound={left:0,right:g?f.x:m,top:0,bottom:_-d}}return i.begin={x:t,y:n,offsetX:f.width,offsetY:e.height},i.end={x:t+e.width,y:n,offsetX:f.width,offsetY:e.height},i}t.getTempAtDom=p,t.setTempAtDom=f,t.hasTempAtDom=g,t.showAt=function(e,t){r.default.dispatchEvent(r.default.comments.SHOW_AT_MODEL,{position:e}),f(t),m(!0)},t.closeAt=v,t.createAtDom=function(e,t){var n=document.createElement("span");return e&&(n.classList.add("isMention"),n.textContent=t||"",Object.keys(e).forEach((function(t){n.setAttribute("contenteditable","false"),"classes"!==t?(n.setAttribute(t,e[t]),"userid"===t&&e[t]==window.APP.info.userid&&n.classList.add("isAtSelf")):n.classList.add(e[t])}))),n},t.isTrueAtDom=function(e){return e&&e.classList&&e.classList.contains("isMention")},t.getAtAttrs=function(e){var t=["class","contenteditable"],n={extraattrs:"extraAttrs"},i=a.__spreadArray([],e.attributes,!0).reduce((function(e,i){var o=i.name,a=i.value;return t.includes(o)||(n.hasOwnProperty(o)&&(o=n[o]),e[o]=a),e}),{});return a.__spreadArray([],e.classList,!0).forEach((function(e){l.classes[e]&&(i.classes=l.classes[e])})),i},t.getAtPosition=T},1809:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},l=function(e){var t=s[e||"linear"];return t||(console.debug("Scroll error: scroller does not support an easing option of "+e+'. Using "linear" instead'),t=s[e]),t},u=function(){function e(t){if(o()(this,e),t&&!(t instanceof Node))throw new Error("Scroll error: element passed to Scroll constructor must be a DOM node, you passed "+t+"!");this.el=t||this.document.body}return r()(e,[{key:"moveElement",value:function(e,t,n){e[t]=n,e===this.document.body&&(this.document.documentElement[t]=n)}},{key:"scroll",value:function(e,t,n,i,o,a,r,s){var l=this;window.requestAnimationFrame((function(){var u=Date.now(),c=Math.min(1,(u-o)/a);if(t===n)return s?s():null;isNaN(c)&&(c=1),l.moveElement(e,i,r(c)*(n-t)+t),c<1?l.scroll(e,e[i],n,i,o,a,r,s):s&&s()}))}},{key:"toY",value:function(e,t){var n=this,i=t||{},o=i.duration,a=i.easing,r="number"==typeof o&&o>=0?o:400;return new Promise((function(t){n.scroll(n.el,n.getScrollPosition("scrollTop"),e,"scrollTop",Date.now(),r,l(a),t)}))}},{key:"toX",value:function(e,t){var n=this;(t=t||{}).duration=t.duration||400;return new Promise((function(i){n.scroll(n.el,n.getScrollPosition("scrollLeft"),e,"scrollLeft",Date.now(),t.duration,l(t.easing),i)}))}},{key:"getScrollPosition",value:function(e){var t=this.el,n=this.document;return t===n.body?n.body[e]||n.documentElement[e]:t[e]}},{key:"document",get:function(){return document}}]),e}();t.default=u},1910:function(e,t,n){"use strict";n.d(t,"b",(function(){return _})),n.d(t,"c",(function(){return y})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return T}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(30),l=n.n(s),u=n(1318),c=n(324),h=n(2956),d=n(5736),p=u.c.DOCCharTypeFastDetecter,f=l()({},"Times New Roman",4.989),g=new Set(["宋体","汉仪中黑KW","方正仿宋_GBK","仿宋_GB2312","方正仿宋简体","方正大标宋简体","黑体"]),v={"宋体":{EMSize:256},"汉仪中黑KW":{EMSize:1e3},"Times New Roman":{EMSize:2048},"方正仿宋_GBK":{EMSize:256},"仿宋_GB2312":{EMSize:256},"方正仿宋简体":{EMSize:256},"微软雅黑":{EMSize:2048,ySubscriptYOffset:182,ySuperscriptYOffset:582,ySubscriptYSize:1331,ySuperscriptYSize:1331},"方正大标宋简体":{EMSize:256},"黑体":{EMSize:256}},m={"宋体":{bold:"reguler"},"Times New Roman":{bold:"bold"},"汉仪中黑KW":{bold:"reguler"},"方正仿宋_GBK":{bold:"reguler"},"仿宋_GB2312":{bold:"reguler"},"方正仿宋简体":{bold:"reguler"},"方正大标宋简体":{bold:"reguler"},"黑体":{bold:"reguler"}};function _(e){return g.has(e)?b(e):null}function y(e,t){var n=m[e];return n?n[t]:t}function b(e){return v[e].EMSize}function T(e){return v[e]}var C,k=(C=void 0,function(e){return e&&(C=e),C}),w=function(){function e(){if(o()(this,e),k())return k();k(this)}return r()(e,null,[{key:"getFontIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2];if(n){var i=void 0,o=void 0;if(e&&(e.bUseCJKFont=!1),null!=e&&e.isComplex){if(!e)return;switch(i=e.CTL_Ftc,t){case u.a.CC_FarEast:e.bUseCJKFont=!0;break;case u.a.CC_Shared:(o=n.getPropVal("share_hint"))==h.c?e.bUseCJKFont=!0:e.isRealComplex=!0}}else switch(t){case u.a.CC_FarEast:i=n.getPropVal("font_name_asia_east"),e&&(e.bUseCJKFont=!0);break;case u.a.CC_Ascii:i=n.getPropVal("font_name_ascii");break;case u.a.CC_Shared:(o=n.getPropVal("share_hint")||0)==h.c?(i=n.getPropVal("font_name_asia_east"),e&&(e.bUseCJKFont=!0)):o==h.a?i=n.getPropVal("font_name_complex"):o==h.b&&(i=n.getPropVal("font_name_ftcbi"),e&&(e.isRealComplex=!0));break;case u.a.CC_NoFarEast:i=n.getPropVal("font_name_complex");break;case u.a.CC_Complex:i=n.getPropVal("font_name_ftcbi");break;default:i=n.getPropVal("font_name_complex")}return i}}},{key:"isWestWriteLetter",value:function(e,t,n){if(c.x==e||c.A==e||c.w==e||t&&t.isLineBreak())return!1;if(!t&&!n)return!1;var i=t&&t.charInfo||n&&n.charInfo,o=t&&t.chpx||n&&n.chp,a=i.charClass,r=o.getPropVal("share_hint");return u.a.CC_Ascii==a||u.a.CC_NoFarEast==a||u.a.CC_Shared==a&&h.a==r}},{key:"betweenWestWriteLetters",value:function(e,t,n,i,o,a,r){var s=void 0,l=void 0;if(n>0?(s=i[n-1],l=o[n-1]):(s=i[n].getPrevNode()).isTree()?s=null:l=s.begin,!(s&&this.isWestWriteLetter(r.getCharCode(l),s)))return!1;var u=void 0,c=void 0;return n<i.length-1?(u=i[n+1],c=o[n+1]):(u=i[n].getNextNode()).isTree()?u=null:c=u.begin,u||(t.needNextGlyph=!0),!!(u&&this.isWestWriteLetter(r.getCharCode(c),u))}},{key:"getPrevGlyph",value:function(e,t){var n=t.getPrevNode();return n.isTree()?{}:{prevGlyphGroup:n,lgid:Object(d.a)(n.chpx.getPropVal("east_asia_language")||"")}}},{key:"getNextGlyph",value:function(e,t){var n=t.getNextNode();return n.isTree()?{}:{nextGlyphGroup:n}}},{key:"getNextGlyphGroup",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=function(e,t,n){var i=null;return e<n.length-1?i=n[e+1]:(i=t&&t.getNextNode()).isTree()&&(i=null),i},a=null,r=t,s=e;do{if(!(a=o(s,r,n)))return null;if(!i||a.isVisible())return a;r=a,s++}while(r)}},{key:"getAdjCalcFactor",value:function(e){var t=0;if(e.bDiffSBMB)t=4;else{var n=e.fontArg,i=n.fontFamily&&f[n.fontFamily];t=i||4}return t}},{key:"isKanaSpec",value:function(e,t){if(t>=65377&&t<=65439||t>=65512&&t<=65518)return!0}},{key:"isJPNMonospacedFont",value:function(e){return!1}},{key:"isFixedWidthSpec",value:function(e,t){var n=!1,i=p.getUnicodeCharItem(t).usrType;return i!==u.b.usrCJKUnifiedIdeo&&i!==u.b.usrCJKCompatibilityIdeographs&&i!==u.b.usrCJKCompatibility&&i!==u.b.usrHangul&&i!==u.b.usrHangulCompatJamo||(n=!0),n}},{key:"hasKerningPairs",value:function(e){var t=e.fontArg,n={family:t.fontFamily,bold:t.fontWeight,italic:t.fontStyle},i=window.APP.fontServer.getFontFace(n);return!!i&&64&i.flag}},{key:"betweenWestWriteLetters2",value:function(e,t){return e&&t&&this.isWestWriteLetter(e.charCode,null,e)&&this.isWestWriteLetter(t.charCode,null,t)}}]),e}();t.a=w},1914:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.geneLocalIndexInfo=t.getQueryIndexInfo=void 0;var i=n(5),o=n(2290),a=n(14),r=i.__importDefault(n(82));t.getQueryIndexInfo=function(){var e=(0,a.getQuery)("pageIdxInfo");if(e)try{return(0,o.convertIndexInfo)((0,o.decodeIndexInfo)(e))}catch(e){}return null},t.geneLocalIndexInfo=function(){return i.__awaiter(this,void 0,Promise,(function(){var e,t;return i.__generator(this,(function(n){switch(n.label){case 0:return e=window.officeType,t=null,e!==r.default.writer?[3,2]:[4,(0,o.geneWPSIndexInfo)()];case 1:return t=n.sent(),[3,8];case 2:return e!==r.default.spreadsheet?[3,4]:[4,(0,o.geneETIndexInfo)()];case 3:return t=n.sent(),[3,8];case 4:return e!==r.default.presentation?[3,6]:[4,(0,o.geneWPPIndexInfo)()];case 5:return t=n.sent(),[3,8];case 6:return e!==r.default.pdf?[3,8]:[4,(0,o.genePDFIndexInfo)()];case 7:t=n.sent(),n.label=8;case 8:return t?[2,(0,o.encodeIndexInfo)(t)]:[2,null]}}))}))}},1915:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(626),l=n(4580),u=n(3079),c=n(411),h=n(772),d=function(){function e(t){var n=t.node,i=t.ctxpos,a=t.isCustomPos,r=t.ctxpos2view;o()(this,e),this.node=n,this.ctxpos=i||s.a.ZERO(),this.ctxpos2view=r||s.a.ZERO(),this.isCustomPos=!!a}return r()(e,[{key:"node_pos_2_view",get:function(){return s.a.add(this.ctxpos2view,this.node.position2parent)}}],[{key:"initFakeNode",value:function(t,n){var i={position2parent:s.a.ZERO(),offset4child:s.a.ZERO()},o=t.ctxpos;return u.b===n?new e({node:i,ctxpos:o,ctxpos2view:t.ctxpos2view}):new e({node:i,ctxpos:o})}},{key:"initWithNodeAndCustomPos",value:function(t,n,i,o){return new e({node:t,ctxpos:n,isCustomPos:!0,ctxpos2view:i})}},{key:"initWithNodeAndPreContextNode",value:function(t,n,i){var o=s.a.ZERO(),a=s.a.ZERO();return!n||n.node.isCoorSystem()||(o=s.a.add(n.ctxpos,n.node.position2parent,n.node.offset4child)),!n||u.b!==i||(a=s.a.add(n.ctxpos2view,n.node.position2parent,n.node.offset4child)),new e({node:t,ctxpos:o,ctxpos2view:a})}}]),e}(),p=function(){function e(t){o()(this,e),this.chain=[],this.root=null,this.hosts=[],this.coors=[],this.mode=t||u.a}return r()(e,[{key:"push",value:function(e){this.nodeChecker(e);var t=this.lastNode,n=null;t&&t.node===e?(console.warn("Nodes is deprecated"),n=d.initFakeNode(t,this.mode)):n=d.initWithNodeAndPreContextNode(e,t,this.mode),this.pushStageNode(n),this.chain.push(n)}},{key:"pushNodeWithPosition",value:function(e,t,n){this.nodeChecker(e);var i=d.initWithNodeAndCustomPos(e,t,n,this.mode);this.pushStageNode(i),this.chain.push(i)}},{key:"pop",value:function(){var e=this.chain.pop();return this.popStageNode(e),e}},{key:"pushStageNode",value:function(e){var t=e.node;t.isScene()&&(this.root=e),t.isView()&&(this.root=e),t.isHost()&&this.hosts.push(e),t.isCoorSystem()&&this.coors.push(e)}},{key:"popStageNode",value:function(e){var t=e.node;t.isHost()&&this.hosts.pop(),t.isCoorSystem()&&this.coors.pop()}},{key:"nodeChecker",value:function(e){!e&&console.warn("[DOCTypoContextChain] Push node is null")}},{key:"chain_str",get:function(){var e="";return this.chain.forEach((function(t){var n=t.node.constructor.name;e+=">> "+n+" "})),e}},{key:"length",get:function(){return this.chain.length}},{key:"firstNode",get:function(){return this.length<=0?null:this.chain[0]}},{key:"lastNode",get:function(){var e=this.length;return e<=0?null:this.chain[e-1]}},{key:"currentCoor",get:function(){var e=this.coors.length;return this.coors[e-1]}}]),e}(),f=function(){function e(t){o()(this,e),this._context_node_chain=new p(t&&t.mode),this._logColor=t&&t.logColor||{color1:"#fff",color2:"#000"},this._assistant_params={}}return r()(e,[{key:"enter",value:function(e){e instanceof l.a&&(this._assistant_params.isInTextframe=!0),this._context_node_chain.push(e)}},{key:"enterWithCustomPos",value:function(e,t,n){this._context_node_chain.pushNodeWithPosition(e,t,n)}},{key:"exit",value:function(){this._context_node_chain.pop().node instanceof l.a&&(this._assistant_params.isInTextframe=!1)}},{key:"getRoot",value:function(){return this._context_node_chain.root}},{key:"getCoorPos2Worspace",value:function(){var e=this.getCoorPos2View(),t=this._context_node_chain.firstNode;return t.node.isScene()||t.node.isView()?s.a.add(e,t.node.viewOffset):e}},{key:"getCoorPos2View",value:function(){return this.getCurrentCoor().node_pos_2_view}},{key:"getCurrentCoor",value:function(){return this._context_node_chain.currentCoor}},{key:"position",get:function(){return this._context_node_chain.lastNode.ctxpos}},{key:"node_chain",get:function(){return this._context_node_chain}},{key:"node_chain_str",get:function(){return this._context_node_chain.chain_str}},{key:"isInTextframe",get:function(){return this._assistant_params.isInTextframe}}],[{key:"initFakeContext",value:function(t,n,i,o,a){var r=new e({mode:o}),l=new c.DOCMocAncestor({viewOffset:a});return r.enterWithCustomPos(l,s.a.ZERO(),i),r.enterWithCustomPos(t,n,i),r}},{key:"findCell",value:function(e){for(var t=e.parent;t&&!t.isScene();t=t.parent)if(t instanceof h.c)return t;return null}},{key:"findHost",value:function(t){return t?t.isHost()||t.isScene()||t.isView()?t:e.findHost(t.parent):null}},{key:"findView",value:function(t){return t?t.isScene()||t.isView()?t:e.findView(t.parent):null}},{key:"findCoorNode",value:function(t){return t&&t.parent?t.parent.isCoorSystem()?t.parent:e.findCoorNode(t.parent):null}}]),e}();t.a=f},1916:function(e,t,n){"use strict";n.d(t,"l",(function(){return i})),n.d(t,"n",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"y",(function(){return h})),n.d(t,"u",(function(){return d})),n.d(t,"r",(function(){return p})),n.d(t,"x",(function(){return f})),n.d(t,"t",(function(){return g})),n.d(t,"q",(function(){return v})),n.d(t,"w",(function(){return m})),n.d(t,"s",(function(){return _})),n.d(t,"p",(function(){return y})),n.d(t,"v",(function(){return b})),n.d(t,"o",(function(){return T})),n.d(t,"h",(function(){return C})),n.d(t,"c",(function(){return k})),n.d(t,"i",(function(){return w})),n.d(t,"j",(function(){return S})),n.d(t,"m",(function(){return P})),n.d(t,"k",(function(){return I}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7,h=8,d=9,p=10,f=11,g=12,v=13,m=14,_=15,y=16,b=17,T=18,C=19,k=20,w=21,S=22,P=23,I=24},1917:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i={CompositionInit:0,CompositionStart:1,CompositionUpdate:2,CompositionEnd:3},o=4},2004:function(e,t,n){"use strict";n.r(t),n.d(t,"urlForObject",(function(){return _})),n.d(t,"onFileOpen",(function(){return k})),n.d(t,"onSessionError",(function(){return C})),n.d(t,"setModified",(function(){return m})),n.d(t,"onOnlineModeChange",(function(){return w})),n.d(t,"setCanUnload",(function(){return S}));var i=n(1143),o=n.n(i),a=n(227),r=n(562),s=n(167),l=n(343),u=n(86),c=n(82),h=n(240),d=n(1640),p=n(67),f=[c.default.spreadsheet,c.default.writer,c.default.presentation,c.default.pdf].indexOf(Object(h.getPageOfficeType)())>=0,g=!1,v=!0;function m(){g=!0}window.woapi_ismodified=function(){return g};var _=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((function(o,a){var r=u.getClient();if(r.connected()){var s=r.clientID;o("/api/v3/office/file/"+e+"/"+(i?"media_object":"object")+"/"+t+"?connid="+s+"&orientation"+(n?"&get_url":""))}else a("session not connected, post object is not allowed")}))},y=null,b=!1,T=function(e){if(window.RPCClient&&"CONNECTED"===window.RPCClient.getState()&&!b){if(b=!0,a.default.dispatchEvent(a.default.names.ON_BEFORE_UNLOAD,{event:e}),!v)return v=!0,b=!1,!0;if(s.isAndroid&&s.isMobileQQ)return!0;if(!window.__WPSENV__.cache_preview&&!Object(p.isPublish)()&&(!window.openClientTimeStamp||(new Date).getTime()-window.openClientTimeStamp>150)){var t=window.RPCClient;t.send("session.close"),t.close(!0),t.serverID=""}}};window.addEventListener("unload",T),window.addEventListener("beforeunload",T),window.addEventListener("pagehide",T);try{window.woapi_onunload=T}catch(e){}var C=function(e){var t=!1,n=e.errno,i=e.responseHeaders,o=e.reason,u=e.subReason,c=i?i.match(/x-request-id: (.*)(?:\r\n)/i):null,h=c?c[1]:null;switch(o){case"NotExists":case"lightLinkNotExist":a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.InvalidLink,errorno:n,request_id:h});break;case r.default.fileNotExists:case r.default.RetryLater:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:e.reason,result:e.reason,errorno:n,request_id:h});break;case"linkExpired":a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.Unknown,result:"linkClosed",errorno:n,request_id:h});break;case r.default.UserNotLogin:"AccountUpgrading"===u?Object(l.gotoMigrateGuide)():Object(l.gotoLogin)();break;case r.default.fileTooLarge:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:e.reason,limit:e.detail.limit,errorno:n,request_id:h});break;case r.default.fileSizeLimit:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:e.reason,msg:_i18n("applications.public.helpers.core.sessionhelper.fileSizeLimit", "The file is too large to support preview service"),errorno:n,request_id:h});break;case r.default.SessionExpired:a.default.dispatchEvent(a.default.names.network.SESSION_TIMEOUT);break;case"fileUploadNotComplete":a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.fileUploadNotComplete,errorno:n,request_id:h});break;case"lightlinkVerifying":case r.default.FileUnderReview:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.FileUnderReview,errorno:n,request_id:h});break;case r.default.Unknown:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.Unknown,result:"",msg:"",errorno:n,request_id:h});break;case r.default.NeedPassword:case r.default.NeedLevel1Password:case r.default.NeedLevel2Password:case r.default.NeedModifyPassword:case r.default.InvalidPassword:a.default.dispatchEvent(a.default.names.network.ON_FILE_PASSWORD_ERROR,{type:e.reason});break;case r.default.OpenFailed:case r.default.AppExceedsMaxEditFileCount:case r.default.AppStatusNotUsed:case r.default.GetFileInfoFailed:case r.default.PermissionRevoked:case r.default.CooperationTerminated:case r.default.fileOtherError:case r.default.FileCrash:case r.default.LightlinkForbid:case r.default.SpaceFull:case r.default.InvalidArgument:case r.default.RestrictedFile:case r.default.ServerNotAvailable:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:e.reason,errorno:n,request_id:h});break;case r.default.SecureDocumentError:if(e.detail){var p={type:e.reason,result:e.detail.code,msg:e.detail.msg};a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,p)}else window.location.reload();break;case r.default.Unavailable:case r.default.DownloadFailed:t=!0;break;case r.default.PermissionInvalid:case r.default.SessionDeleted:"WEB_CHANGE_LOGIN"===e.message&&s.isPc?(Object(d.c)(),setTimeout((function(){window.location.reload()}),500)):a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:e.reason,result:e.msg,msg:e.msg,errorno:n,request_id:h});break;case r.default.PermissionExpire:case r.default.PermissionLimit:case r.default.SecDocAlgorithmNotMatch:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:e.reason,result:e.msg,msg:e.msg,errorno:n,request_id:h});break;case r.default.InvalidVersion:a.default.dispatchEvent(a.default.names.file.ON_FILE_INFO_CHANGE,{eventName:"force_refresh"});break;case r.default.AuthCodeExpired:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.AuthCodeExpired,errorno:n,request_id:h});break;case r.default.RestrictedAccess:case r.default.NewVersionFound:window.location.reload();break;case r.default.DraftClosed:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.DraftClosed,errorno:n,request_id:h});break;case r.default.DriverServerError:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.DriverServerError,msg:_i18n("applications.public.helpers.core.sessionhelper.DriverServerError", "Docking system error"),errorno:n,request_id:h});break;case r.default.OfficeTypeChanged:var f=window.location.href;-1!==f.indexOf("/office/k/")||-1!==f.indexOf("/office/s/")?(f=window.location.origin+"/p/"+window.fileInfo.id,window.location.href=f):window.location.reload();break;default:a.default.dispatchEvent(a.default.names.network.ON_FILE_OPEN_ERROR,{type:r.default.Unknown,result:e.reason,msg:e.msg,errorno:n,request_id:h})}return y&&(y.close(),y=null),t},k=function(e){window.__CONFIG__.isEnableEditLock&&f&&(null===y||y.close(),y=new o.a(e))},w=function(e){var t=JSON.parse(e.message),n=Object.assign({eventName:"online_mode_change"},t);a.default.dispatchEvent(a.default.names.file.ON_FILE_INFO_CHANGE,n)},S=function(e){v=e}},2005:function(e,t,n){"use strict";var i,o,a,r,s,l=n(13),u=(i=l)&&i.__esModule?i:{default:i};e.exports=(o=/(\?|\&)readonly/i.test(window.location.search),a=!1,r=/(\?|\&)lock/i.test(window.location.search),s={getInfor:function(){return{isTriggered:a,isReadMode:o,isLockMode:r}},tryLock:function(){return a&&this.lock(),!1}},window.__WPSENV__.conflictLock=s,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.info("window.__WPSENV__.conflictLock",e,t);var i=function(){var i={eventName:"edit_lock",readOnly:e,memberId:t,onClientLogout:function(){n&&n()}},o=window.__WPSENV__.isOnlineMode;if(!o){var a=document.createEvent("CustomEvent");a.initCustomEvent("ON_FILE_INFO_CHANGE",!0,!0,(0,u.default)({},i,{isOnline:o,threshold:window.__WPSENV__.isOnlinethreshold})),window.dispatchEvent(a),window.collection2("web_locked_edit_true")}};return a?(s.lock=i,s):{getInfor:function(){return{isReadMode:o,lockReadOnly:e,memberId:t,isTriggered:a,isLockMode:r}},lock:i,unLock:function(){e&&!o&&(a=!0)},tryLock:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!(t&&!o||!o&&!e||(this.lock(),this.unLock(),0))}}})},2006:function(e,t,n){"use strict";e.exports={EVENT:{ON_DOCUMENT_SAVEING:"ON_DOCUMENT_SAVEING",ET_EVENT_ENTER_EDIT:"ET_EVENT_ENTER_EDIT",MO_ET_EDIT_MODE_BEGIN:"MO_ET_EDIT_MODE_BEGIN_LOCK",ON_DOCUMENT_SAVEING_HOLDING_LOCK:"ON_DOCUMENT_SAVEING_HOLDING_LOCK"}}},2007:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e.WebSocket){var t=function(e,t){this.addr=e,this.protocol=i,this.debug=t,this.open()},n=function(e,t){this.url=e,this.cookie_=t,this.retCode=400,this.retAddr="",this.retToken="",this.lastCallTime=(new Date).getTime(),this.firstCall=0},i={unpack:function(e){var t=new DataView(e),n=t.getUint32(0,!0),i=(t.getUint16(4,!0),t.getUint16(6,!0)),o=t.getUint32(8,!0),a=t.getUint32(12,!0),r=t.getUint32(16,!0),s=t.getUint32(20,!0)*Math.pow(2,32)+r;if(1266907392!=n)return{};for(var l=new Array(o),u=i;u<i+o;u++)l[u]=String.fromCharCode(t.getInt8(u));return{msgId:s,msgType:a,body:l.join("")}},unmarshal:function(e){return e},marshalAndPack:function(e,t,n){var i=n.length,o=t,a=e,r=a/Math.pow(2,32)|0,s=a%Math.pow(2,32),l=new ArrayBuffer(24+i),u=new DataView(l);u.setUint32(0,1266907392,!0),u.setUint16(4,1,!0),u.setUint16(6,24,!0),u.setUint32(8,i,!0),u.setUint32(12,o,!0),u.setUint32(16,s,!0),u.setUint32(20,r,!0);for(var c=0;c<n.length;c++)u.setInt8(24+c,n.charCodeAt(c));return u.buffer}};t.prototype={constructor:t,enableBinary:function(){this.ws.binaryType="arraybuffer"},open:function(){this.ws=new WebSocket(this.addr),this.ws.binaryType="arraybuffer",this.callbacks={},this.ws.onclose=this.onClose.bind(this),this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)},onClose:function(e){this.debug&&console.log("wsclientsdk: Connection closed!"),this.callbacks.close&&this.callbacks.close(e)},onMessage:function(e){var t=this.protocol.unpack(e.data);this.callbacks.receive&&this.callbacks.receive(t)},onError:function(e){this.debug&&console.log("wsclientsdk: onerror!"),this.callbacks.error&&this.callbacks.error(e)},onOpen:function(e){this.debug&&console.log("onOpen wsclientsdk: Connection established!"),this.callbacks.open&&this.callbacks.open(e)},set_receive_function:function(e){this.callbacks.receive=e},set_open_function:function(e){this.callbacks.open=e},set_close_function:function(e){this.callbacks.close=e},set_error_function:function(e){this.callbacks.error=e},sendData:function(e,t,n){try{var i=this.protocol.marshalAndPack(e,t,n);this.ws.send(i)}catch(e){console.log("sendData wsclientsdk ex: "+e)}},wsReadyState:function(){try{return this.ws.readyState}catch(e){console.log("wsReadyState wsclientsdk ex: "+e)}},closeWs:function(){console.log("client close websocket"),this.ws.close()}};return n.prototype={getUnpredictableCode:function(){return 20200424},constructor:n,beginLogin:function(e,t){var n=this;return new Promise((function(e,t){n.retCode=400,n.retAddr="",n.retToken="";var i=n;if(0==n.firstCall)n.lastCallTime=(new Date).getTime(),n.firstCall=1;else{var o=(new Date).getTime(),a=n.lastCallTime;n.lastCallTime=o,o-a<1e3&&(console.log("Do not log in frequently"),t())}var r="/ksopush-login-web",s=window.__CONFIG__.pathPrefix;s&&(r=(s=s.substr(0,s.lastIndexOf("/")))+r);var l=window.__WPSENV__.request({method:"GET",url:n.url,responseType:"json",headers:{"client-type":"web","client-ver":"web","client-chan":"web"},encrypt:!0,gateway:r});l.xhr.withCredentials=!0,l.end().then((function(n){var o=n.target,a=n.body,r=o.status;try{i.retCode=r;var s=a;if(!s||!s.Connectors)return t(20200424),void console.log("loginweb 200 result:",s);var l=s.Connectors;if(l&&Array.isArray(l)&&0!==l.length){var u=l[Math.floor(Math.random()*Math.floor(l.length-1))];i.retAddr=u.Addr,i.retToken=s.Token,e(r)}else t(r)}catch(e){t(20200424),console.log("loginweb login error",e)}})).catch((function(e){var n=e.target.status,o=e.body._cause;i.retCode=n,t("error"===o?400:n)}))}))},getRetAddr:function(){return this.retAddr},getRetToken:function(){return this.retToken},getRetCode:function(){return this.retCode}},e.golem={Connection:t,LoginServer:n},e.golem}return console.warn("wsclientsdk: WebSockets not supported!"),null}(window)},2008:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.report=t.getOnline=void 0;var i,o,a,r=n(80),s=(i=r)&&i.__esModule?i:{default:i};t.getOnline=(o=(0,s.default)(regeneratorRuntime.mark((function e(){var t,n,i,o,a,r,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.urlFileId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l("/api/kdocs/file/"+s+"/settings?conn_id="+window.RPCClient.clientID),n={method:"GET",url:t,responseType:"json"},e.next=4,u(n);case 4:return i=e.sent,o=i.status,a=i.result,r=void 0===a?r&&r.online_mode?r:{online_mode:{online_user_threshold:-1}}:a,e.abrupt("return",{isOnline:200===o&&1===r.mode,threshold:r.online_mode.online_user_threshold});case 9:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),t.report=(a=(0,s.default)(regeneratorRuntime.mark((function e(t,n,i){var o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l("/api/kdocs/file/"+t+"/settings/report"),a={method:"POST",url:o,body:{action:"edit_lock",data:{member:n,locker:i}},responseType:"json"},e.next=4,u(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)});function l(e){if("www.kdocs.cn"!==location.hostname&&"web.wps.cn"!==location.hostname){var t=window.__CONFIG__.pathPrefix.lastIndexOf("/");return window.__CONFIG__.pathPrefix.substr(0,t)+e}return e}function u(e){return new Promise((function(t){var n=window.__WPSENV__.request(e);n.xhr.withCredentials=!0,n.end().then((function(e){var n=e.target,i=e.body,o=n.status;t({status:o,result:i})})).catch((function(e){window.isDebugger&&console.warn(e),t({status:status})}))}))}},2009:function(e,t,n){"use strict";var i={HEADER_FOOTER:{SWITCH_MODE:"SWITCH_MODE",EDITOR_MODE:"EDITOR_MODE",READER_MODE:"READER_MODE",SHOW_HIT_TIP:"SHOW_HIT_TIP"},HIGHLIGHT:{BLINK:"BLINK"}};t.a=i},2010:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return h}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(554),l=n(1168),u=n(310),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;o()(this,e),this.init(t,n,i,a)}return r()(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.good=e,this.pos=t,this.len=n,this.prop=i}},{key:"term",value:function(){this.prop=null}},{key:"noGood",value:function(){this.good=!1,this.pos=-1,this.len=-1,this.prop=null}},{key:"end",get:function(){return this.pos+this.len}}]),e}();l.a.buildType(c);var h=function(){function e(t){o()(this,e),this.init(t)}return r()(e,[{key:"init",value:function(e){Object(s.default)(this),e.attachObserver(this),this.upstream=e,this.core=e.core}},{key:"logme",value:function(e){var t=e.pos,n=e.len;null==t&&(t=0),0===n&&(n=1),null==n&&(n=this.getTextSize()-t);var i=this.collectChpxs(t,n),o=this.collectPapxs(t,n);console.log("["+t+", "+n+"] of "+this.nickname),console.log(this.getText(t,n)),i.forEach((function(e){console.log("["+e.pos+", "+e.len+"] chpx.prop")})),o.forEach((function(e){console.log("["+e.pos+", "+e.len+"] papx.prop")}))}},{key:"getTextSize",value:function(){return this.core.getTextSize()}},{key:"getChar",value:function(e){return this.core.getChar(e)}},{key:"getText",value:function(e,t){return this.core.getText(e,t)}},{key:"hasChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.IT.Include;return this.upstream.hasChp(e,t)}},{key:"getChp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.IT.Include;return this.upstream.getChp(e,t)}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.IT.Include;return this.upstream.getChpx(e,t)}},{key:"collectChpxs",value:function(e,t){return this.upstream.collectChpxs(e,t)}},{key:"getPrevChpx",value:function(e){return this.upstream.getPrevChpx(e)}},{key:"getNextChpx",value:function(e){return this.upstream.getNextChpx(e)}},{key:"moveChpxToPrev",value:function(e){this.upstream.moveChpxToPrev(e)}},{key:"moveChpxToNext",value:function(e){this.upstream.moveChpxToNext(e)}},{key:"getCompatibleChpx",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,o=this.getChpx(e);if(!o.good)return o;for(var a=n&&n(null,o),r=this.getPrevChpx(o),s=this.getNextChpx(o),l=o.pos,u=o.pos+o.len;r.good&&t(r,o,a);this.moveChpxToPrev(r))a=n&&n(a,r),l=r.pos;for(;s.good&&i(s,o,a);this.moveChpxToNext(s))a=n&&n(a,s),u=s.pos+s.len;return r.free(),s.free(),o.pos=l,o.len=u-l,o.prop=a,o}},{key:"atChpxBound",value:function(e){if(e===this.getTextSize())return!0;var t=this.getChpx(e),n=t.good&&e===t.pos;return t.free(),n}},{key:"hasPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.IT.Include;return this.upstream.hasPap(e,t)}},{key:"getPap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.IT.Include;return this.upstream.getPap(e,t)}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.IT.Include;return this.upstream.getPapx(e,t)}},{key:"collectPapxs",value:function(e,t){return this.upstream.collectPapxs(e,t)}},{key:"getPrevPapx",value:function(e){return this.upstream.getPrevPapx(e)}},{key:"getNextPapx",value:function(e){return this.upstream.getNextPapx(e)}},{key:"movePapxToPrev",value:function(e){this.upstream.movePapxToPrev(e)}},{key:"movePapxToNext",value:function(e){this.atChpxBound.upstream.movePapxToNext(e)}},{key:"getCompatiblePapx",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u.IT.Include,a=this.getPapx(e,o);if(!a.good)return a;for(var r=n&&n(null,a),s=this.getPrevPapx(a),l=this.getNextPapx(a),c=a.pos,h=a.pos+a.len;s.good&&t(s,a,r);this.movePapxToPrev(s))r=n&&n(r,s),c=s.pos;for(;l.good&&i(l,a,r);this.movePapxToNext(l))r=n&&n(r,l),h=l.pos+l.len;return s.free(),l.free(),a.pos=c,a.len=h-c,a.prop=r,a}},{key:"atPapxBound",value:function(e){if(e===this.getTextSize())return!0;var t=this.getPapx(e),n=t.good&&e===t.pos;return t.free(),n}},{key:"onBeforeInsertText",value:function(e,t,n,i){this._dispatch("onBeforeInsertText",t,n,i)}},{key:"onInsertText",value:function(e,t,n,i,o){this._dispatch("onInsertText",t,n,i,o)}},{key:"onBeforeDeleteText",value:function(e,t,n){this._dispatch("onBeforeDeleteText",t,n)}},{key:"onDeleteText",value:function(e,t,n){this._dispatch("onDeleteText",t,n)}},{key:"onBeforeChpxChanged",value:function(e,t){this._dispatch("onBeforeChpxChanged",t)}},{key:"onChpxChanged",value:function(e,t){this._dispatch("onChpxChanged",t)}},{key:"onPapxChanged",value:function(e,t){this._dispatch("onPapxChanged",t)}},{key:"onStyleChanged",value:function(e,t,n,i){this._dispatch("onStyleChanged",t,n,i)}},{key:"nickname",get:function(){return"DOCDataLogic"}}]),e}()},2011:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(1291),f=n(772),g=n(411),v=n(4579),m=n(3860),_=n(336),y=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.compose,u=n.tableline,c=n.pageOffsetFromServer;o()(this,t);var h=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r},{compose:s,textline:u,pageOffsetFromServer:c}));return h.hostPendings=[],u&&h._initTableMember(u,c),h}return d()(t,e),r()(t,[{key:"isHost",value:function(){return!0}},{key:"_initTableMember",value:function(e,t){var n=e.cells;this.tablecells=f.d.generateTableCells({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem},{tablecells:n,compose:this.compose,height:this.rect.size.height,pageOffsetFromServer:t});for(var i=0;i<this.tablecells.length;++i){var o=this.tablecells[i];if(o.merge_type===f.e.MIDDLE||o.merge_type===f.e.LAST){this.hasMergedCell=!0;break}}this.view.attachTableLine(this),this.isBrokenBefore=e.isBrokenBefore,this.isBrokenAfter=e.isBrokenAfter,this.isHeaderRowProp=e.isHeaderRowProp,this.isHeaderRow=e.isHeaderRow,this.isRepeatHeaderRow=e.isRepeatHeaderRow,e.hasSpacing?(this.hasSpacing=e.hasSpacing,this.spacing=Object(_.Ti2Px)(e.spacing)):(this.hasSpacing=!1,this.spacing=0)}},{key:"textStart",value:function(){return this.rect.left}},{key:"textEnd",value:function(){return this.rect.right}},{key:"selectLayersByPack",value:function(e){var t=this.tablecells.find((function(t){return t.cell_page===e||t.diagCell&&t.diagCell.pages.includes(e)}));return t?t.layers:null}},{key:"createLayersByPack",value:function(e,t){var n=this.tablecells.find((function(t){return t.cell_page===e||t.diagCell&&t.diagCell.pages.includes(e)}));if(n){var i=n.layers;return i||(n.layers=i=t?t.makeLayers({parent:n,viewPage:this.viewPage}):new m.a({parent:n,viewPage:this.viewPage}),this.viewPage.layers.addChild(i)),i}return null}},{key:"cleanRenderInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.tablecells&&this.tablecells.forEach((function(t){t.cleanRenderInfo(e)})),c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this)}},{key:"layoutType",get:function(){return g.DOCLayoutType.TableLine}},{key:"isInTable",get:function(){return!0}},{key:"cell_style_cp",get:function(){var e=this.range;return e.pos+e.len-1}},{key:"position_in_table",get:function(){var e=this,t=this.parent.lines,n=t.findIndex((function(t){return t===e}));if(n<0)return console.log("Find table line failed!"),v.c;var i=v.c,o=n>0?t[n-1]:null;o&&o.layoutType===g.DOCLayoutType.TableLine||(i=v.a);var a=n<t.length?t[n+1]:null;return a&&a.layoutType===g.DOCLayoutType.TableLine||(i=i!==v.a?v.d:v.b),i}},{key:"position_in_page",get:function(){var e=this,t=this.parent.lines,n=t.length;switch(t.findIndex((function(t){return t===e}))){case 0:return 1===n?v.b:v.a;case n-1:return v.d;default:return v.c}}},{key:"rightMargin",get:function(){var e=this.tablecells;if(!e||e.length<=0)return 0;var t=e[e.length-1],n=t.cell_page||t.diagCell&&t.diagCell.pages[0];return n?t.rect.width-n.rect.right:0}},{key:"leftMargin",get:function(){if(!this.tablecells||!this.tablecells.length)return 0;var e=this.tablecells[0],t=e.cell_page||e.diagCell&&e.diagCell.pages[0];return t?t.rect.left-e.rect.left:0}}]),t}(p.b);t.a=y},2180:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a}));var i=0,o=1,a=3},2181:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s={"宋体":"汉仪书宋二KW",SimSun:"汉仪书宋二KW","仿宋":"汉仪仿宋KW",FangSong:"汉仪仿宋KW","楷体":"汉仪楷体KW",KaiTi:"汉仪楷体KW","黑体":"汉仪中黑KW",SimHei:"汉仪中黑KW","等线":"汉仪中等线KW",DengXian:"汉仪中等线KW","微软雅黑":"汉仪旗黑KW 55S","Microsoft YaHei":"汉仪旗黑KW 55S"},l=Object.assign({},s);window.__CONFIG__.wps.useXiaoBiaoSong&&(s["方正小标宋简体"]="方正小标宋简体",s["FZXiaoBiaoSong-B05S"]="方正小标宋简体");var u=s;window.__CONFIG__.wps.useXiaoBiaoSong&&(l["方正小标宋简体"]="汉仪书宋二KW",l["FZXiaoBiaoSong-B05S"]="汉仪书宋二KW");var c=l,h=function(){function e(){o()(this,e)}return r()(e,null,[{key:"mapping",value:function(e,t){return t&&c[e]?c[e]:!t&&u[e]?u[e]:e}},{key:"isMappingExist",value:function(e,t){return!(t&&!c[e])&&!(!t&&!u[e])}}]),e}();t.b=h},2182:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return u}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(167),l=new Map,u=function(){function e(){o()(this,e),this._containerA=null,this._containerB=null,this._rootContainer=null,this.setDefaultFont(),this.createContainers()}return r()(e,[{key:"setDefaultFont",value:function(){this._mustExistDefaultFont="Arial",s.isAndroid&&(this._mustExistDefaultFont="Serif")}},{key:"createContainers",value:function(){var e=document.createElement("div"),t=document.createElement("span"),n=document.createElement("span"),i=this.checkStringText;e.className="doc-font-checker-container",e.setAttribute("style","position: fixed;text-align: center;z-index: -99;opacity: 0;top: 0;left: 0;transform: translateZ(-1px)"),t.className="doc-font-checker-container-default-font-use",n.className="doc-font-checker-container-check-font-use",t.textContent=i,n.textContent=i;var o={top:"0",left:"0",margin:"0",padding:"0",fontSize:"76px",zIndex:"-99",position:"absolute",display:"inline","white-space":"nowrap"};for(var a in o)o.hasOwnProperty(a)&&(t.style[a]=o[a],n.style[a]=o[a]);this._containerA=t,this._containerB=n;var r=document.body;e.appendChild(this._containerA),e.appendChild(this._containerB),r.appendChild(e)}},{key:"checkDimension",value:function(){return this._containerA.offsetWidth===this._containerB.offsetWidth&&this._containerA.offsetHeight===this._containerB.offsetHeight}},{key:"checkFontEfficiencyVersion",value:function(e){if(!e)return!1;if(!l.has(e)){this._containerA.style.fontFamily="'"+e+"', '"+this._mustExistDefaultFont+"'",this._containerB.style.fontFamily="'"+this._mustExistDefaultFont+"'";var t=this.checkDimension();l.set(e,!t||e.trim()===this._mustExistDefaultFont||(s.isWindows||s.isMacOs)&&"Helvetica"===e.trim())}return!0===l.get(e)}},{key:"checkStringText",get:function(){var e="mmmmmmmmmmlli1ƒ⁇";s.isPCWxMiniProgram||s.isInWeixin||s.isQQBrowser?e+=String.fromCharCode(160):s.isIE?e=e+String.fromCharCode(0)+String.fromCharCode(59336):s.isWps2019?e+=String.fromCharCode(0):s.isMacOs&&(e+=String.fromCharCode(33));return e}}]),e}()},2183:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.auditCommentList=t.commentReviewAsync=t.delEmoji=t.addEmoji=void 0;var i=n(5).__importStar(n(146));t.addEmoji=function(e){return{types:i.HTTP_TYPES,autoErrorToast:!1,callAPI:function(t){return t.post("/api/v3/office/file/".concat(window.urlFileId,"/comment/emoji")).send(e).end()}}};var o;t.delEmoji=function(e){return{types:i.HTTP_TYPES,autoErrorToast:!1,callAPI:function(t){return t.del("/api/v3/office/file/".concat(window.urlFileId,"/comment/emoji")).send(e).end()}}},function(e){e.TEXT="text",e.VOICE="voice"}(o||(o={}));t.commentReviewAsync=function(e){var t=window.fileInfo.id,n={};return Object.keys(e).forEach((function(t){e[t]&&(n[t]=e[t])})),n.type||(n.type=o.TEXT),{types:i.HTTP_TYPES,callAPI:function(e){return e.post("/api/v3/office/file/".concat(t,"/comment/async")).fields(n).end()}}};t.auditCommentList=function(e){return{types:i.HTTP_TYPES,callAPI:function(t){return t.get("/api/v3/office/file/".concat(window.urlFileId,"/comments/all")).query(e).end()}}}},2290:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genePDFIndexInfo=t.geneWPPIndexInfo=t.geneETIndexInfo=t.geneWPSIndexInfo=t.convertIndexInfo=t.decodeIndexInfo=t.encodeIndexInfo=void 0;var i=n(5),o=i.__importDefault(n(452));function a(e){return Number(e)||0}t.encodeIndexInfo=function(e){return encodeURIComponent(o.default.encode(JSON.stringify(e)))},t.decodeIndexInfo=function(e){return JSON.parse(o.default.decode(decodeURIComponent(e)))},t.convertIndexInfo=function(e){var t=e.pageIndex,n=e.cell,i=e.cursor,o={pageIndex:a(t)};if(n){var r=n.rowFrom,s=n.rowTo,l=n.colFrom,u=n.colTo;o.cell={rowFrom:a(r),rowTo:a(s),colFrom:a(l),colTo:a(u)}}if(i){var c=i.startGcp,h=i.endGcp;o.cursor={startGcp:a(c),endGcp:a(h)}}return o},t.geneWPSIndexInfo=function(){return i.__awaiter(this,void 0,Promise,(function(){var e,t,n,o,a;return i.__generator(this,(function(i){switch(i.label){case 0:e=window.WPSOpenApi.Application,i.label=1;case 1:return i.trys.push([1,6,,7]),[4,e.ActiveDocument.ActiveWindow.Selection];case 2:return[4,(t=i.sent()).Information(e.Enum.WdInformation.wdActiveEndPageNumber)];case 3:return n=i.sent(),[4,t.Range.Start];case 4:return o=i.sent(),[4,t.Range.End];case 5:return a=i.sent(),[2,{pageIndex:n,cursor:{startGcp:o,endGcp:a}}];case 6:return i.sent(),[2,null];case 7:return[2]}}))}))},t.geneETIndexInfo=function(){return i.__awaiter(this,void 0,Promise,(function(){var e,t,n,o,a,r,s;return i.__generator(this,(function(i){switch(i.label){case 0:e=window.WPSOpenApi.Application,i.label=1;case 1:return i.trys.push([1,8,,9]),[4,e.ActiveWorkbook.ActiveSheet.Index];case 2:return t=i.sent(),[4,e.Selection];case 3:return[4,(n=i.sent()).Row];case 4:return o=i.sent(),[4,n.RowEnd];case 5:return a=i.sent(),[4,n.Column];case 6:return r=i.sent(),[4,n.ColumnEnd];case 7:return s=i.sent(),[2,{pageIndex:t,cell:{rowFrom:o,rowTo:a,colFrom:r,colTo:s}}];case 8:return i.sent(),[2,null];case 9:return[2]}}))}))},t.geneWPPIndexInfo=function(){return i.__awaiter(this,void 0,Promise,(function(){var e,t;return i.__generator(this,(function(n){switch(n.label){case 0:e=window.WPSOpenApi.Application,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.ActivePresentation.SlideShowWindow.View.Slide.SlideIndex];case 2:return t=n.sent(),[2,{pageIndex:t}];case 3:return n.sent(),[2,null];case 4:return[2]}}))}))},t.genePDFIndexInfo=function(){return i.__awaiter(this,void 0,Promise,(function(){var e,t;return i.__generator(this,(function(n){switch(n.label){case 0:e=window.WPSOpenApi.Application,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.ActivePDF.CurrentPage];case 2:return t=n.sent(),[2,{pageIndex:t}];case 3:return n.sent(),[2,null];case 4:return[2]}}))}))}},2291:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(24),o=n.n(i),a=n(167),r=null;function s(){return null===r&&(r=function(){if(window.__IN_SANDBOX__)return!1;if(a.isIos&&a.iosVersion<12)return!1;try{if("object"===("undefined"==typeof WebAssembly?"undefined":o()(WebAssembly))&&"function"==typeof WebAssembly.instantiate)return WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0))}catch(e){console.log("WASM not support: ",e)}return!1}(),console.log(r?"%cWebAssembly is supported":"%cWebAssembly is not supported","color: mediumpurple;")),r}},2292:function(e,t,n){"use strict";var i,o=n(30),a=n.n(o),r=n(1),s=n.n(r),l=n(2),u=n.n(l),c=n(6101),h={},d=function(){function e(t){s()(this,e);var n=p[t],i=f[n],o=i.corX,a=i.corY,r=i.chardirect,l=i.rotate,u=i.scale,c=i.isReverseLine;this.corX=o,this.corY=a,this.chardirect=r,this.rotate=l,this.scale=u,this.isReverseLine=c}return u()(e,null,[{key:"default",value:function(){return new e("0")}},{key:"isTransposeCoor",value:function(e){if(!e)return!1;switch(e){case 0:case 2:case 8:case 10:return!1;default:return!0}}},{key:"isTransposeCoorOrientation",value:function(e){switch(e){case c.d:case c.a:case c.e:case c.f:return!0;default:return!1}}},{key:"get",value:function(t){var n=h[t];return n||(n=h[t]=new e(t)),n}},{key:"fromOrientation",value:function(t){return new e(g[t])}}]),e}();t.a=d;var p={0:"X_L2R_Y_T2B_NORMAL",8:"X_L2R_Y_T2B_TRANSPOSE",2:"X_R2L_Y_T2B_NORMAL",10:"X_R2L_Y_T2B_TRANSPOSE",5:"X_T2B_Y_R2L_NORMAL",13:"X_T2B_Y_R2L_TRANSPOSE",1:"X_T2B_Y_L2R_NORMAL",9:"X_T2B_Y_L2R_TRANSPOSE",3:"X_B2T_Y_L2R_NORMAL",7:"X_B2T_Y_R2L_NORMAL"},f={X_L2R_Y_T2B_NORMAL:{corX:"L2R",corY:"T2B",chardirect:"NORMAL",rotate:0,scale:{x:1,y:1}},X_L2R_Y_T2B_TRANSPOSE:{corX:"L2R",corY:"T2B",chardirect:"TRANSPOSE",rotate:0,scale:{x:1,y:1}},X_R2L_Y_T2B_NORMAL:{corX:"R2L",corY:"T2B",chardirect:"NORMAL",rotate:0,scale:{x:-1,y:1}},X_R2L_Y_T2B_TRANSPOSE:{corX:"R2L",corY:"T2B",chardirect:"TRANSPOSE",rotate:0,scale:{x:-1,y:1}},X_T2B_Y_R2L_NORMAL:{corX:"T2B",corY:"R2L",chardirect:"NORMAL",rotate:Math.PI/180*90,scale:{x:1,y:1}},X_T2B_Y_R2L_TRANSPOSE:{corX:"T2B",corY:"R2L",chardirect:"TRANSPOSE",rotate:Math.PI/180*90,scale:{x:1,y:1}},X_T2B_Y_L2R_NORMAL:{corX:"T2B",corY:"L2R",chardirect:"NORMAL",rotate:Math.PI/180*90,scale:{x:1,y:1},isReverseLine:!0},X_T2B_Y_L2R_TRANSPOSE:{corX:"T2B",corY:"L2R",chardirect:"TRANSPOSE",rotate:Math.PI/180*90,scale:{x:1,y:1},isReverseLine:!0},X_B2T_Y_L2R_NORMAL:{corX:"B2T",corY:"L2R",chardirect:"NORMAL",rotate:Math.PI/180*270,scale:{x:1,y:1}},X_B2T_Y_R2L_NORMAL:{corX:"B2T",corY:"R2L",chardirect:"NORMAL",rotate:Math.PI/180*270,scale:{x:1,y:-1}}},g=(i={},a()(i,c.b,"0"),a()(i,c.d,"3"),a()(i,c.a,"5"),a()(i,c.e,"13"),a()(i,c.c,"8"),a()(i,c.f,"9"),i)},2293:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=8,o=9},2294:function(e,t,n){"use strict";n.r(t),n.d(t,"getRandomKey",(function(){return i})),n.d(t,"getRandomId",(function(){return o})),n.d(t,"getUniqueId",(function(){return s}));var i=function(){return"_"+(new Date).getTime()},o=function(){return Math.random().toString(36).substr(2,7)+"_"+Math.random().toString(36).substr(2,7)},a=0,r=0;function s(){function e(e){var t=["a","b","c","d","e","f","g","h","i","j"];return e.toString().split("").reduce((function(e,n){return e+t[n]}),"")}var t=Date.now();return r!==t&&(a=0,r=t),e(t)+e(a++)}},2295:function(e,t,n){"use strict";function i(e){var t=!1;try{var n=window.APP.data,i=n.doc.getDataLogic("final").getPapx(e),o=n.selection.selContext.activeDocumentFieldNames[0],a=n.doc.documentFields.getFieldByName(o);a.end>=i.end&&a.begin<=i.pos&&(t=!0)}catch(e){}return t}function o(e){var t=e.begin,n=e.end,i=e.type,o=["comments","comment"].includes(i);return!(!o||!window.APP.restrictEditHandler.isInCommentProtectMode)||!window.APP.restrictEditHandler.checkIsRangeNonEditable({pos:t,len:n-t})&&window.APP.data.doc.documentFields.getFields({begin:t,end:n}).every((function(e){if(o){if(e.begin<n&&e.end>n)return!e._node.readonly}else if(e.begin<=t&&e.end>=n)return!e._node.readonly;return!0}))}function a(e){var t=window.APP.data.selection,n=e.isShape,i=e.shapeId,o=e.isProcessOn,a=e.isLatexMath,r=e.fileId,s=window.APP.data.doc,l=void 0,u=0;if(n){var c=s.getTextSize(),h=!0;if(l=s.inlineAnchors.getAnchorPos(i,0,c),Number.isInteger(l)||(h=!1,l=s.anchors.getAnchorPos(i,0,c)),Number.isInteger(l)&&(o||a)){var d=null,p=(d=h?s.inlineAnchors.getAnchor(i,l,1):s.anchors.getAnchor(i,l,1))?d.anchor.shapeData.extData:null;p&&(p.isProcessOn&&r===p.fileId||p.isLatexMath)&&(u=1)}}if(!Number.isInteger(l))if(s.limitInSubdoc(e.pos,e.pos).isOutOfValidSubDocRange)l=0;else{l=e.pos,t.setPosition(l,l);var f=window.APP.formatContentController,g=t.selInfo.getSelectionInfo(),v=g.isAllowInsertWithControl,m=g.isInReadonlyDocumentField,_=t.selInfo.isHitOnCtrl().isHitOnDatetime,y=f.checkIsInContentControl(l),b=window.APP.restrictEditHandler.isInRestrictEditMode&&!y;!(_||y||b||!v||m)||(l=0)}return{pos:l,len:u}}function r(e,t,n,i){var o=!1;if(i.length>0){i.sort((function(e,t){return e.pos-t.pos}));for(var a=0,r=i.length-1;a<r;){var s=Math.floor((a+r)/2),l=i[s];if(e>=l.pos){if(!(e>=l.pos+l.len)){a=s;break}a=s+1}else r=s-1}var u=e+t.length;if(!n)for(;a<i.length;){var c=i[a],h=c.pos+c.len;if(e<=c.pos&&h<=u)i.splice(a,1),o=!0;else{if(h>=u)break;a+=1}}if(a<i.length){var d=i[a],p=d.pos,f=d.pos+d.len;e>=f?a+=1:n&&e<=p||u<=p||(e>=p||!n&&u<=f)&&(i.splice(a,1),o=!0);for(var g=a;g<i.length;++g){var v=i[g];n?v.pos+=t.length:v.pos-=t.length}}}return o}n.r(t),n.d(t,"isCurrentParagraphInReadonlyField",(function(){return i})),n.d(t,"checkIfCommentOrRevisionEditable",(function(){return o})),n.d(t,"getInsertRangeOnRestoring",(function(){return a})),n.d(t,"adjustRangeOnTextChanging",(function(){return r}))},246:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isComposing=t.Keys=t.isMatchShortCutKey=t.isMatchKey=t.getKey=void 0;var i=n(5),o=n(594),a=n(167),r={Ctrl:"Ctrl",Meta:"Meta",Shift:"Shift",Alt:"Alt"},s=i.__assign(i.__assign({},r),{Esc:"Esc",Backspace:"Backspace",CapsLock:"CapsLock",ContextMenu:"ContextMenu",ControlLeft:"Ctrl",ControlRight:"Ctrl",Enter:"Enter",MetaLeft:"Meta",MetaRight:"Meta",Space:"Space",Tab:"Tab",Delete:"Delete",End:"End",Help:"Help",Home:"Home",Insert:"Insert",PageDown:"PageDown",PageUp:"PageUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",NumLock:"NumLock"});function l(e){var t={},n=u(e);return e.altKey&&r.Alt!==n&&(t[r.Alt]=!0),a.isMacOs?(e.metaKey&&r.Meta!==n&&(t[r.Ctrl]=!0),e.ctrlKey&&r.Ctrl!==n&&(t[r.Meta]=!0)):(e.ctrlKey&&r.Ctrl!==n&&(t[r.Ctrl]=!0),e.metaKey&&r.Meta!==n&&(t[r.Meta]=!0)),e.shiftKey&&r.Shift!==n&&(t[r.Shift]=!0),t}function u(e){if(!e.code)return o.KeyCode2Key[e.keyCode];var t=void 0===e.key?o.KeyCode2Key[e.keyCode]:e.key;return e.code.startsWith("Numpad")?t:o.Code2Key[e.code]?o.Code2Key[e.code]:t}function c(e){if(p(e))return"";var t=l(e);return Object.keys(t).length>0?"":u(e)}function h(e,t){return Array.isArray(t)?d(e,t):t&&c(e)===t}function d(e,t){if(p(e))return!1;for(var n=l(e),i=0;i<t.length;i++){var o=t[i],a=!!r[o];if(!a&&u(e)!==o)return!1;if(a&&!n[o])return!1}return!0}function p(e){return 229===e.keyCode}t.Keys=s,t.getKey=c,t.isMatchKey=h,t.isMatchShortCutKey=d,t.isComposing=p,t.default={getKey:c,isMatchKey:h,isMatchShortCutKey:d,Keys:s,isComposing:p}},2502:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"db",(function(){return o})),n.d(t,"O",(function(){return a})),n.d(t,"cb",(function(){return r})),n.d(t,"N",(function(){return s})),n.d(t,"S",(function(){return l})),n.d(t,"g",(function(){return u})),n.d(t,"T",(function(){return c})),n.d(t,"D",(function(){return h})),n.d(t,"h",(function(){return d})),n.d(t,"s",(function(){return p})),n.d(t,"t",(function(){return f})),n.d(t,"a",(function(){return g})),n.d(t,"I",(function(){return v})),n.d(t,"r",(function(){return m})),n.d(t,"U",(function(){return _})),n.d(t,"u",(function(){return y})),n.d(t,"v",(function(){return b})),n.d(t,"n",(function(){return T})),n.d(t,"p",(function(){return C})),n.d(t,"o",(function(){return k})),n.d(t,"q",(function(){return w})),n.d(t,"e",(function(){return S})),n.d(t,"f",(function(){return P})),n.d(t,"A",(function(){return I})),n.d(t,"m",(function(){return E})),n.d(t,"w",(function(){return O})),n.d(t,"x",(function(){return x})),n.d(t,"y",(function(){return R})),n.d(t,"z",(function(){return N})),n.d(t,"gb",(function(){return A})),n.d(t,"hb",(function(){return D})),n.d(t,"ib",(function(){return M})),n.d(t,"Y",(function(){return L})),n.d(t,"Z",(function(){return F})),n.d(t,"ab",(function(){return B})),n.d(t,"bb",(function(){return H})),n.d(t,"i",(function(){return G})),n.d(t,"j",(function(){return W})),n.d(t,"k",(function(){return j})),n.d(t,"l",(function(){return U})),n.d(t,"J",(function(){return V})),n.d(t,"K",(function(){return Y})),n.d(t,"L",(function(){return z})),n.d(t,"M",(function(){return K})),n.d(t,"B",(function(){return Z})),n.d(t,"c",(function(){return X})),n.d(t,"C",(function(){return q})),n.d(t,"d",(function(){return J})),n.d(t,"E",(function(){return Q})),n.d(t,"F",(function(){return $})),n.d(t,"G",(function(){return ee})),n.d(t,"H",(function(){return te})),n.d(t,"V",(function(){return ne})),n.d(t,"W",(function(){return ie})),n.d(t,"X",(function(){return oe})),n.d(t,"fb",(function(){return ae})),n.d(t,"R",(function(){return re})),n.d(t,"P",(function(){return se})),n.d(t,"eb",(function(){return le})),n.d(t,"Q",(function(){return ue}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7,h=8,d=9,p=10,f=11,g=12,v=13,m=14,_=15,y=16,b=17,T=18,C=19,k=20,w=21,S=22,P=23,I=24,E=25,O=26,x=27,R=28,N=29,A=30,D=31,M=32,L=33,F=34,B=35,H=36,G=37,W=38,j=39,U=40,V=41,Y=42,z=43,K=44,Z=45,X=46,q=47,J=48,Q=49,$=50,ee=51,te=52,ne=53,ie=54,oe=55,ae=56,re=57,se=58,le=59,ue=60},2503:function(e,t,n){"use strict";n.r(t),n.d(t,"alphabetic",(function(){return i})),n.d(t,"middle",(function(){return o})),n.d(t,"top",(function(){return a})),n.d(t,"bottom",(function(){return r})),n.d(t,"center",(function(){return s}));var i="alphabetic",o="middle",a="top",r="bottom",s="center"},253:function(e,t,n){"use strict";n.r(t),n.d(t,"getDateTimestamp",(function(){return s})),n.d(t,"FormatType",(function(){return h})),n.d(t,"formatDate",(function(){return d})),n.d(t,"TimeMode",(function(){return f})),n.d(t,"calcTime",(function(){return g})),n.d(t,"formatTime",(function(){return v})),n.d(t,"toTimestamp",(function(){return r})),n.d(t,"transformSeconds",(function(){return m})),n.d(t,"isHasSecTime",(function(){return _})),n.d(t,"isHasTime",(function(){return y}));var i={0:_i18n("applications.public.helpers.number.zero", "Zero"),1:_i18n("applications.public.helpers.number.one", "Mon."),2:_i18n("applications.public.helpers.number.two", "Tue."),3:_i18n("applications.public.helpers.number.three", "Wed."),4:_i18n("applications.public.helpers.number.four", "Thur."),5:_i18n("applications.public.helpers.number.five", "Fri."),6:_i18n("applications.public.helpers.number.six", "Sat."),7:_i18n("applications.public.helpers.number.seven", "Seven"),8:_i18n("applications.public.helpers.number.eight", "Eight"),9:_i18n("applications.public.helpers.number.night", "Nine"),10:_i18n("applications.public.helpers.number.ten", "Tenth")},o={ARABIC_NUM_MAP_CHINESE:i,turnArabic2ChineseNumChar:function(e){for(var t=e.toString(),n="",o=0;o<t.length;o++)n+=i[t[o]];return n},numToChinese:function(e){var t=e.toString();if(t.length>2)return!1;var n="",o=parseInt(t/10),a=parseInt(t%10);return o>1&&(n+=i[o]),o>0&&(n+=i[10]),a>0&&(n+=i[a]),n}},a=function(e){return e<10?"0"+e:e},r=function(e){return e.toString().length>11?e:1e3*e},s=function(e){"number"!=typeof e&&(e=e.getTime());var t=c("yyyy-mm-dd",e);return new Date(t).getTime()},l=[_i18n("applications.public.helpers.date.weekday.sun", "Sunday"),_i18n("applications.public.helpers.date.weekday.mon", "Monday"),_i18n("applications.public.helpers.date.weekday.tues", "Tuesday"),_i18n("applications.public.helpers.date.weekday.wed", "Wednesday"),_i18n("applications.public.helpers.date.weekday.thur", "Thursday"),_i18n("applications.public.helpers.date.weekday.fri", "Friday"),_i18n("applications.public.helpers.date.weekday.sat", "Saturday")],u=[_i18n("applications.public.helpers.date.month.jan", "Jan"),_i18n("applications.public.helpers.date.month.feb", "Feb"),_i18n("applications.public.helpers.date.month.mar", "Mar"),_i18n("applications.public.helpers.date.month.apr", "Apr"),_i18n("applications.public.helpers.date.month.may", "May"),_i18n("applications.public.helpers.date.month.jun", "Jun"),_i18n("applications.public.helpers.date.month.jul", "Jul"),_i18n("applications.public.helpers.date.month.aug", "Aug"),_i18n("applications.public.helpers.date.month.sept", "Sept"),_i18n("applications.public.helpers.date.month.oct", "Oct"),_i18n("applications.public.helpers.date.month.nov", "Nov"),_i18n("applications.public.helpers.date.month.dec", "Dec")],c=function(e,t){t=r(t);var n=new Date(t);return e=e.replace(/(ys|yyyy|ycyc|mm|mc|m|M|dd|dc|d|H|i|s|D)/g,(function(e){switch(e){case"ys":return n.getFullYear()%100;case"yyyy":return n.getFullYear();case"ycyc":return o.turnArabic2ChineseNumChar(n.getFullYear());case"mm":return a(n.getMonth()+1);case"mc":return o.numToChinese(n.getMonth()+1);case"m":return n.getMonth()+1;case"M":return u[n.getMonth()];case"dd":return a(n.getDate());case"dc":return o.numToChinese(n.getDate());case"d":return n.getDate();case"H":return a(n.getHours());case"i":return a(n.getMinutes());case"s":return a(n.getSeconds());case"D":return l[n.getDay()];default:return console.assert(!1),e}}))},h={Date:_i18n("applications.public.helpers.date.format.time6", "M dd, yyyy"),Time:_i18n("applications.public.helpers.date.format.time3", "H:i"),DateTime:_i18n("applications.public.helpers.date.format.time5", "M dd, yyyy H:i"),FullTime:_i18n("applications.public.helpers.date.format.time7", "M dd, yyyy H:i:s"),Auto:null},d=function(e,t){return e===h.Auto?p(t):c(e,t)},p=function(e){var t=r(e),n=new Date(t),i=new Date,o=i.getTime()-t;if(o<0)return c(_i18n("applications.public.helpers.date.format.time5", "M dd, yyyy H:i"),t);if(o<6e4)return _i18n("applications.public.helpers.date.format.time1", "Just Now");if(i.getFullYear()-n.getFullYear()!=0)return c(_i18n("applications.public.helpers.date.format.time5", "M dd, yyyy H:i"),t);if(i.getMonth()-n.getMonth()!=0)return c(_i18n("applications.public.helpers.date.format.time4", "M dd H:i"),t);if(i.getDate()-n.getDate()==0){var a=c(_i18n("applications.public.helpers.date.format.time3", "H:i"),t);return _i18n("applications.public.helpers.date.format.time2", "Today {0}").replace("{0}",a)}return c(_i18n("applications.public.helpers.date.format.time4", "M dd H:i"),t)},f={T24HourClock:0,T12HourClock:1},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=60*i+n,s=f.T24HourClock===o?e:e+(a?0:12),l=60*s+t+r;l=l<0?1440+l:l;var u=Math.floor(l/60)%24,c=l%60;return f.T24HourClock===o?{rHour:u,rMinute:c}:(u>12&&(u-=12),{rHour:u,rMinute:c,isAm:u>12||12===u&&c>=0})},v=function(e,t,n){var i=t.toString(),o=n.toString();return i.length<2&&(i="0"+i),o.length<2&&(o="0"+o),e=e.replace("H",i).replace("i",o)},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="0"+Math.floor(e%60),i="0"+Math.floor(e/60%60),o="0"+Math.floor(e/3600);return t?parseInt(1e3*e):o.slice(-2)+":"+i.slice(-2)+":"+n.slice(-2)},_=function(e){return/h{1,2}:mm:ss/.test(e)},y=function(e){return/h{1,2}:mm/.test(e)}},260:function(e,t,n){"use strict";n.r(t),n.d(t,"guide",(function(){return a}));var i=n(227),o={ON_HEADER_TOOLBAR_STATUS_CHANGE:"ON_HEADER_TOOLBAR_STATUS_CHANGE",ON_ACTIVATE_KEYBOARD:"ON_ACTIVATE_KEYBOARD",ON_COMMAND_BARS_TAB_CHANGE:"ON_COMMAND_BARS_TAB_CHANGE",ON_HIDE_EDIT_TOOLBAR_PANEL:"ON_HIDE_EDIT_TOOLBAR_PANEL",ON_SHOW_EDIT_TOOLBAR_PANEL:"ON_SHOW_EDIT_TOOLBAR_PANEL",ON_COMMENT_TAB_SWITCH:"ON_COMMENT_TAB_SWITCH",ON_AUDIO_PERMISSION_CHANGE:"ON_AUDIO_PERMISSION_CHANGE",ON_SHOW_POPOVER_BARS:"ON_SHOW_POPOVER_BARS",ON_HIDE_POPOVER_BARS:"ON_HIDE_POPOVER_BARS",ON_SHOW_POPOVER_TOAST:"ON_SHOW_POPOVER_TOAST",ON_HIDE_POPOVER_TOAST:"ON_HIDE_POPOVER_TOAST",ON_POPOVER_VISIBILITY_CHANGED:"ON_POPOVER_VISIBILITY_CHANGED",POPOVER_BARS_EVENTS:{COPY:_i18n("applications.writer.constants.copy", "Copy"),PASTE:_i18n("applications.writer.constants.paste", "Paste"),CUT:_i18n("applications.writer.constants.cut", "Cut"),SELECT:_i18n("applications.writer.constants.select", "Select "),SELECTALL:_i18n("applications.writer.constants.selectall", "Select all"),IMAGE_COPY:_i18n("applications.writer.constants.imageCopy", "Copy"),IMAGE_SHARE:_i18n("applications.writer.constants.imageShare", "Share"),COMMENT:_i18n("applications.writer.constants.comment", "Comment"),VOICE:_i18n("applications.writer.constants.voice", "Voice"),VIEW:_i18n("applications.writer.constants.view", "View image"),DEL:_i18n("applications.writer.constants.del", "Delete"),FORMAT:_i18n("applications.writer.constants.format", "Format"),CONVENE:_i18n("applications.writer.constants.convene", "Convene"),VIEWCOMMENT:_i18n("applications.writer.constants.viewcomment", "View comments"),VIEWREVISION:_i18n("applications.writer.constants.viewrevision", "View changes"),INSERT_ROW:_i18n("applications.writer.constants.insertRow", "Insert row"),DELETE_ROW:_i18n("applications.writer.constants.deleteRow", "Del row"),INSERT_COLUMN:_i18n("applications.writer.constants.insertColumn", "Insert column"),DELETE_COLUMN:_i18n("applications.writer.constants.deleteColumn", "Del column"),DELETE_TABLE:_i18n("applications.writer.constants.deleteTable", "Delete table")},ON_IMAGE_CLICK:"ON_IMAGE_CLICK",ON_IMAGE_CLICK_VIEW:"ON_IMAGE_CLICK_VIEW",ON_IMAGE_LONG_PRESS:"ON_IMAGE_LONG_PRESS",ON_NATIVE_KEYBOARD_CLOSE:"ON_NATIVE_KEYBOARD_CLOSE",ON_IMAGE_CLICK_EDIT_MODE:"ON_IMAGE_CLICK_EDIT_MODE",ON_KEYBOARD_ACTIVE:"ON_KEYBOARD_ACTIVE",ON_KEYBOARD_INACTIVE:"ON_KEYBOARD_INACTIVE",ON_KEYBOARD_HEIGHT_UPDATED:"ON_KEYBOARD_HEIGHT_UPDATED",ON_TOGGLE_EDIT_MODE:"ON_TOGGLE_EDIT_MODE",ON_TOGGLE_READ_MODE:"ON_TOGGLE_READ_MODE",ON_INK_PANEL_VISIBLE:"ON_INK_PANEL_VISIBLE",ON_SHOW_INK_PANEL:"ON_SHOW_INK_PANEL",ON_CHANGE_INK_COLOR:"ON_CHANGE_INK_COLOR",ON_MODE_CHANGED:"ON_MODE_CHANGED",ON_READ_SETTING_CHANGED:"ON_SETTING_CHANGED",ON_SHOW_COMMENT_ENTRY:"ON_SHOW_COMMENT_ENTRY",ON_HIDE_COMMENT_ENTRY:"ON_HIDE_COMMENT_ENTRY",ON_SHOW_VOICE_COMMENT:"ON_SHOW_VOICE_COMMENT",ON_SEND_PRISE_COMMENT:"ON_SEND_PRISE_COMMENT",CHECK_CAN_SHOW_VOICE_COMMENT:"CHECK_CAN_SHOW_VOICE_COMMENT",ON_EDIT_TOOLBAR_TAB_CHANGED:"ON_EDIT_TOOLBAR_TAB_CHANGED",ON_FIND_REPLACE_BAR_CHANGED:"ON_FIND_REPLACE_BAR_CHANGED",ON_SHOW_FONT_STYLE_PANEL:"ON_SHOW_FONT_STYLE_PANEL",ON_RECORD_CARD_SCROLL_TOP:"ON_RECORD_CARD_SCROLL_TOP",ON_UPDATE_CONTAINER:"ON_UPDATE_CONTAINER",ON_SET_POSITION_ON_VISIBLE:"ON_SET_POSITION_ON_VISIBLE",ON_SCROLL_INTO_VIEW:"ON_SCROLL_INTO_VIEW",ON_WINDOW_HIDDEN:"ON_WINDOW_HIDDEN",ON_WORKSPACE_CLICK_IN_READING_MOD:"ON_WORKSPACE_CLICK_IN_READING_MOD",ON_SWIPE_IN_READ_MODE:"ON_SWIPE_IN_READ_MODE",ON_PINCHING_TO_ZOOM_IN_READ_MODE:"ON_PINCHING_TO_ZOOM_IN_READ_MODE",ON_SHOW_DIALOG:"ON_SHOW_DIALOG",ON_CLOSE_DIALOG:"ON_CLOSE_DIALOG",ON_HYPERLINK_CLICK:"ON_HYPERLINK_CLICK",ON_WEBSHAPE_CLICK:"ON_WEBSHAPE_CLICK",ON_HYPERLINK_JUMP:"ON_HYPERLINK_JUMP",ON_HYPERLINK_COPY:"ON_HYPERLINK_COPY",ON_HYPERLINK_CANCEL:"ON_HYPERLINK_CANCEL",ON_HYPERLINK_TO_WEBSHAPE:"ON_HYPERLINK_TO_WEBSHAPE",ON_WEBSHAPE_TO_HYPERLINK:"ON_WEBSHAPE_TO_HYPERLINK",ON_OPEN_HYPERLINK_EDITOR:"ON_OPEN_HYPERLINK_EDITOR",SHOW_HYPERLINK_EDITOR_PANEL:"SHOW_HYPERLINK_EDITOR_PANEL",ON_TEXT_ENCODING_PANEL_VISIBLE_CHANGE:"ON_TEXT_ENCODING_PANEL_VISIBLE_CHANGE",ON_SHOW_RC_RECORD_CARD:"ON_SHOW_RC_RECORD_CARD",ON_SHOW_APPOINT_CARD:"ON_SHOW_APPOINT_CARD",ON_SHOW_RC_RECORD_LIST:"ON_SHOW_RC_RECORD_LIST",ON_RECORD_CARD_CHANGE:"ON_RECORD_CARD_CHANGE",RC_DATA_CHANGE:"RC_DATA_CHANGE",REVISION_INDEX_CHANGE:"REVISION_INDEX_CHANGE",ON_SHOW_CARD_MENU_PANEL:"ON_SHOW_CARD_MENU_PANEL",COMMENT_MORE_SHOW:"COMMENT_MORE_SHOW",TOUCH_SWIPER_SHOW:"TOUCH_SWIPER_SHOW",VOICE_COMMENT_TIP_VISIBLE:"VOICE_COMMENT_TIP_VISIBLE",REVISION_COMMENT_TIP_VISIBLE:"REVISION_COMMENT_TIP_VISIBLE",REVISION_CURSOR_TIP_SHOW:"REVISION_CURSOR_TIP_SHOW",REVISION_NUM_CHANGE:"REVISION_NUM_CHANGE",TOUCH_MOVE_DELETE_SHOW:"TOUCH_MOVE_DELETE_SHOW",FONT_DOWNLOAD:{ON_FONT_RESOURCE_DOWNLOAD_ERROR:"ON_FONT_RESOURCE_DOWNLOAD_ERROR",ON_FONT_RESOURCE_DOWNLOAD_FINISHED:"ON_FONT_RESOURCE_DOWNLOAD_FINISHED",ON_DOWNLOAD_CANCEL:"ON_DOWNLOAD_CANCEL",ON_FONT_RESOURCE_DOWNLOAD_REQUEST:"ON_FONT_RESOURCE_DOWNLOAD_REQUEST"},ON_UPDATE_TABLE_VIEW:"ON_UPDATE_TABLE_VIEW",RENDER_DRAG_MARK:"RENDER_DRAG_MARK",RENDER_DRAG_SELECT_EFFECT:"RENDER_DRAG_SELECT_EFFECT",DOC_WORKSPACE_SCROLL_TO:"DOC_WORKSPACE_SCROLL_TO",ON_UPDATE_WORKSPACE:"ON_UPDATE_WORKSPACE",ON_TOGGLE_GUIDE_CONTAINER:"ON_TOGGLE_GUIDE_CONTAINER",FORCE_UPDATE_SCROLL_INNER_SIZE:"FORCE_UPDATE_SCROLL_INNER_SIZE",ON_SHOW_TYPO_MODE_PANEL:"ON_SHOW_TYPO_MODE_PANEL",ON_SHOW_EXPORT_PDF_PANEL:"ON_SHOW_EXPORT_PDF_PANEL",ON_SHOW_FUNCTION_LIMIT_NOTICE:"ON_SHOW_FUNCTION_LIMIT_NOTICE",ON_SHOW_DROPLIST_CONTROL_MODAL:"ON_SHOW_DROPLIST_CONTROL_MODAL",ON_SYNC_HEADER_STATUS:"ON_SYNC_HEADER_STATUS",SWITCH_FINGER_SWIPE_MODE:"SWITCH_FINGER_SWIPE_MODE",SWITCH_WORKSPACE_SCROLL_CSS_ANIMATE:"SWITCH_WORKSPACE_SCROLL_CSS_ANIMATE",TOGGLE_HEADER_FOOTER_TOOLBAR:"TOGGLE_HEADER_FOOTER_TOOLBAR",INK_MODE:"INK_MODE",INK_RENDER:"INK_RENDER",CLEAR_INK:"CLEAR_INK",CLEAR_SINGLE_INK:"CLEAR_SINGLE_INK",CLOSE_INK_PANEL:"CLOSE_INK_PANEL",RESET_INK_CONTAINER_SIZE:"RESET_INK_CONTAINER_SIZE"},a={OPEN_GUIDE:"OPEN_GUIDE",CLOSE_GUIDE:"CLOSE_GUIDE",SWITCH_GUIDE_CONTENT:"SWITCH_GUIDE_CONTENT",ON_CONTENT_STRUCTURE_CHANGED:"ON_CONTENT_STRUCTURE_CHANGED",TOGGLE_GUID_MODE:"TOGGLE_GUID_MODE",CONFIRM_DELETE:"CONFIRM_DELETE"},r={names:{DOC_SELECTION_CHANGED:"doc.selectionChanged",DOC_SELECTION_SYNC_CHANGED:"doc.selectionSyncChanged",SELECTION_CHANGE_AND_CONTENT_UPDATED:"SELECTION_CHANGE_AND_CONTENT_UPDATED",DOC_TYPO_FINISHED:"doc.typo.finished",DOC_TYPO_ALL_PAGE_DONE:"doc typo all page done",DOC_COOPERATION_MODE_TOGGLED:"doc.update.coopinfo",DOC_COOPINFO_UPDATED:"doc.coopinfo.updated",DOC_COOPRANGE_UPDATED:"doc.cooprange.updated",DOC_SCROLL_INTO_VIEW:"doc.scroll.into.view",DOC_SHOW_FIND_PANEL:"doc.show.find.panel",DOC_SHOW_REPLACE_PANEL:"doc.show.replace.panel",DOC_REPLACE_RESULT:"doc.replace.result",DOC_FINDRESULTS_CHANGED:"doc.findresults.changed",DOC_FIND_PREV:"doc.find.prev",DOC_FIND_NEXT:"doc.find.next",DOC_WORKSPACE_SCROLL:"doc.workspace.scroll",DOC_WORKSPACE_AFTER_RESIZE:"doc.workspace.after_resize",DOC_WORKSPACE_SHOULD_HORIZONTAL_SCROLL:"doc.workspace.should.horizontal.scroll",DOC_SET_PROPS:"doc.set.props",DOC_INIT_IMAGE_END:"doc.init.image.end",ON_STYLE_TAG_RECEIVED:"ON_STYLE_TAG_RECEIVED",DOC_SHOW_CONTEXT_MENU:"doc.show.context.menu",DOC_CLOSE_CONTEXT_MENU:"doc.close.context.menu",DOC_RELEASE_CONTEXT_MENU:"doc.release.context.menu",DOC_PAGE_CHANGE:"DOC_PAGE_CHANGE",DOC_SECTION_CHANGE:"DOC_SECTION_CHANGE",DOC_GUEST_CONFIRM_LOGIN:"DOC_GUEST_CONFIRM_LOGIN",DOC_APP_INFO_LOADED:"DOC_APP_INFO_LOADED",TOGGLE_INSERT_PANEL_MENU:"TOGGLE_INSERT_PANEL_MENU",ON_CUSTOM_MODAL_VISIBLE_CHANGE:"ON_CUSTOM_MODAL_VISIBLE_CHANGE",ON_DATETIME_CONFIG_PANEL_VISIBLE_CHANGE:"ON_DATETIME_CONFIG_PANEL_VISIBLE_CHANGE",DOC_FONT_WAIT_TO_REPLACE:"DOC_FONT_WAIT_TO_REPLACE",DOC_FONT_WAIT_TO_LOAD:"DOC_FONT_WAIT_TO_LOAD",DOC_FONT_LOAD_CHANGE:"DOC_FONT_LOAD_CHANGE",DOC_FONT_MISSING:"DOC_FONT_MISSING",DOC_DISABLE_COMMAND_BAR:"DOC_DISABLE_COMMAND_BAR",ON_SIGNATURE_PANEL_SHOW:"ON_SIGNATURE_PANEL_SHOW",ON_SELECTIVE_PASTE:"ON_SELECTIVE_PASTE",SELECTIVE_PASTE_SUCCESS:"SELECTIVE_PASTE_SUCCESS",ON_ACTIVE_LINE_CHANGE:"ON_ACTIVE_LINE_CHANGE",DOC_UNDO_REDO:"DOC_UNDO_REDO",ON_ENTER_PARAGRAPH_SETTING_MODE:"ON_ENTER_PARAGRAPH_SETTING_MODE",ON_EXIT_PARAGRAPH_SETTING_MODE:"ON_EXIT_PARAGRAPH_SETTING_MODE",ON_KEYBOARD_HEIGHT_CHANGED:"ON_KEYBOARD_HEIGHT_CHANGED",ON_LATEX_MATH_PANEL_SHOW:"ON_LATEX_MATH_PANEL_SHOW",ON_CORE_ERROR:"ON_CORE_ERROR",SHOW_MENTION_PANEL:"SHOW_MENTION_PANEL",DOC_CLEAR_PARA:"DOC_CLEAR_PARA",DOC_CURSOR_POSITION_CHANGE:"DOC_CURSOR_POSITION_CHANGE",ON_PAGE_CONTAINER_SIZE_CHANGE:"ON_PAGE_CONTAINER_SIZE_CHANGE"},comments:{COMMENT_ENABLED_STATUS_CHANGE:"COMMENT_ENABLED_STATUS_CHANGE",COMMENTS_SHOULD_UPDATE:"comments_should_update",COMMENTS_SHOULD_DELETE:"comments_should_delete",COMMENTS_SHOULD_MOVE:"comments_should_move",COMMENTS_SHOULD_HIDE:"comments_should_hide",COMMENTS_SHOULD_SHOW:"comments_should_show",RCHANDLER_LOADED:"RCHANDLER_LOADED",COMMENTS_LOADED:"COMMENTS_LOADED",OPEN_COMMENTS_DIALOG_BY_BTN:"OPEN_COMMENTS_DIALOG_BY_BTN",OPEN_COMMENTS_DIALOG:"OPEN_COMMENTS_DIALOG",SHOW_COMMENTS_TIPS:"SHOW_COMMENTS_TIPS",SHOW_COMMENTS:"SHOW_COMMENTS",CHECKED_COMMENTS_DROPDOWN:"CHECKED_COMMENTS_DROPDOWN",COMMENTS_PARA_ACTIVE_BEGIN:"COMMENTS_PARA_ACTIVE_BEGIN",COMMENTS_PARA_ACTIVE:"COMMENTS_PARA_ACTIVE",COMMENTS_PARA_INACTIVE:"COMMENTS_PARA_INACTIVE",COMMENTS_PARA_ACTIVE_END:"COMMENTS_PARA_ACTIVE_END",GET_ONLINE_COMMENTS:"GET_ONLINE_COMMENTS",GET_ONLINE_COMMENTS_END:"GET_ONLINE_COMMENTS_END",ON_ACTIVE:"ON_ACTIVE",ON_EDIT_ITEM:"ON_EDIT_ITEM",ON_DELETE_ITEM:"ON_DELETE_ITEM",ON_DELETE_ITEMS:"ON_DELETE_ITEMS",ON_REPLY_ITEM:"ON_REPLY_ITEM",ON_CANCEL_REPLY_ITEM:"ON_CANCEL_REPLY_ITEM",ON_HOVER:"ON_HOVER",ON_LEAVE:"ON_LEAVE",ON_CLOSE:"ON_CLOSE",ON_DID_MOUNT:"ON_DID_MOUNT",ACTIVE_COMMENT_BY_RANGE:"ACTIVE_COMMENT_BY_RANGE",INACTIVE_COMMENT:"INACTIVE_COMMENT",COMMENTS_MODAL_RESIZE:"COMMENTS_MODAL_RESIZE",ON_ADD_ITEM_BY_MODAL:"ON_ADD_ITEM_BY_MODAL",ON_ADD_ITEM_BY_BTN:"ON_ADD_ITEM_BY_BTN",COMMENTS_PARAS_INVALID:"COMMENTS_PARAS_INVALID",SCROLL_TO_COMMENT:"SCROLL_TO_COMMENT",SCROLL_FIND_COMMENT:"SCROLL_FIND_COMMENT",COMMENT_SHOW_IN_PARA:"COMMENT_SHOW_IN_PARA",ON_TEMP_COMMENT_MODAL_SHOW:"ON_TEMP_COMMENT_MODAL_SHOW",ON_ENTER_COMMENT_BODY:"ON_ENTER_COMMENT_BODY",ON_EXIT_COMMENT_BODY:"ON_EXIT_COMMENT_BODY",COMMIT_AND_INSERT_NEW_COMMENT:"COMMIT_AND_INSERT_NEW_COMMENT",NAVIGATE_TO_COMMENT_HIGHLIGHT:"NAVIGATE_TO_COMMENT_HIGHLIGHT",DRAW_CONTENT_BY_COMMENT:"DRAW_CONTENT_BY_COMMENT",ON_COMMENT_SHOW_STATUS_UPDATE:"ON_COMMENT_SHOW_STATUS_UPDATE",CANCEL_SELECT_COMMENT_PANEL:"CANCEL_SELECT_COMMENT_PANEL",CANCEL_COMMENT_PANEL_BUBBLE_ACTIVE:"CANCEL_COMMENT_PANEL_BUBBLE_ACTIVE",UPDATE_COMMENT_DATA_INCLUDE_USER_INFO:"UPDATE_COMMENT_DATA_INCLUDE_USER_INFO",NOTIFY_COMMENTS_PANEL_DATA_IS_CHANGED:"NOTIFY_COMMENTS_PANEL_DATA_IS_CHANGED",MENTION_IN_COMMENT:"MENTION_IN_COMMENT",ACTIVE_COMMENT_PANEL_BUBBLE:"ACTIVE_COMMENT_PANEL_BUBBLE",ON_COMMENT_PANEL_BUBBLE_ACTIVE:"ON_COMMENT_PANEL_BUBBLE_ACTIVE",ON_COMMENT_PANEL_BUBBLE_INACTIVE:"ON_COMMENT_PANEL_BUBBLE_INACTIVE",ON_COMMENT_PANEL_SCROLL:"ON_COMMENT_PANEL_SCROLL",SET_COMMENT_OR_COMMENT_PANEL_CHECKED:"SET_COMMENT_OR_COMMENT_PANEL_CHECKED",GO_TO_ALL_COMMENT_PANEL:"GO_TO_ALL_COMMENT_PANEL",BEFORE_MODIFY_COMMENT:"BEFORE_MODIFY_COMMENT",INSERT_EMOJI_COMMENT_BY_BTN:"INSERT_EMOJI_COMMENT_BY_BTN",COMMENT_PANEL_VISIBLE:"COMMENT_PANEL_VISIBLE",COMMENT_NUM_CHANGE:"COMMENT_NUM_CHANGE",UNREAD_COMMENT_APPENDED:"UNREAD_COMMENT_APPENDED",UNREAD_COMMENT_DELETED:"UNREAD_COMMENT_DELETED",COMMENTS_DATA_CHANGED:"COMMENTS_DATA_CHANGED",COMMENTS_PANEL_DIALOG_CLOSE:"COMMENTS_PANEL_DIALOG_CLOSE",TOGGLE_COMMENT_SHOW_IN_PARA:"TOGGLE_COMMENT_SHOW_IN_PARA",SWITCH_COMMENT_TYPE:"SWITCH_COMMENT_TYPE",AFTER_COMMENT_INSERTED:"AFTER_COMMENT_INSERTED",COMMENT_INSERTOREDIT_SUCCESS:"COMMENT_INSERTOREDIT_SUCCESS",ON_CLICK_OPEN_AT:"ON_CLICK_OPEN_AT",SHOW_AT_MODEL:"SHOW_AT_MODEL",COLSE_AT_MODEL:"COLSE_AT_MODEL",SEARCH_AT_MODEL:"SEARCH_AT_MODEL",ON_CONFIRM_AT:"ON_CONFIRM_AT",ON_CLOSE_AT:"ON_CLOSE_AT",RICHTEXT_INPUT_FOCUS:"RICHTEXT_INPUT_FOCUS",RICHTEXT_INPUT_BLUR:"RICHTEXT_INPUT_BLUR",STOP_BODY_SCROLL:"STOP_BODY_SCROLL",ON_INSERT_TEMP_COMMENT:"ON_INSERT_TEMP_COMMENT",COMMENT_EMOJI_UPDATE:"COMMENT_EMOJI_UPDATE",COMMENT_UPDATE_LAYOUT:"COMMENT_UPDATE_LAYOUT",COMMENT_RICHTEXT_HEIGHT_CHANGE:"COMMENT_RICHTEXT_HEIGHT_CHANGE",UPDATE_COMMENT_PARAMS:"UPDATE_COMMENT_PARAMS",ON_COMMENTS_SVG_UPDATE:"ON_COMMENTS_SVG_UPDATE",ON_COMMENT_TEXT_REVIEW:"COMMENT_TEXT_REVIEW",GET_ONLINE_AUDIT_COMMENTS:"GET_ONLINE_AUDIT_COMMENTS",ON_COMMENT_MENU_CLICK:"ON_COMMENT_MENU_CLICK",CHANGE_COMMENT_ICON_ZINDEX:"CHANGE_COMMENT_ICON_ZINDEX"},revision:{DISABLE_REVISION:"DISABLE_REVISION",ENABLE_REVISION:"ENABLE_REVISION",REVISION_TRACK_CHANGE:"REVISION_TRACK_CHANGE",REVISION_DATA_END:"REVISION_DATA_END",REVISION_ACTIVE_CHANGE:"REVISION_ACTIVE_CHANGE",REVISION_CLIENT_TOAST:"REVISION_CLIENT_TOAST",REVISION_DATA_CHANGE:"REVISION_DATA_CHANGE",REVISION_COUNT:"REVISION_COUNT",REVISION_ACCEPTREFUSE:"REVISION_ACCEPTREFUSE",ON_HISTORY_REVISION_TOOL_SHOW:"ON_HISTORY_REVISION_TOOL_SHOW",REVISION_SETTINGS_CHANGE:"REVISION_SETTINGS_CHANGE",REVISION_BTN_DISPLAY_CHANGE:"REVISION_BTN_DISPLAY_CHANGE",SHOW_REVISION_BUBBLE:"SHOW_REVISION_BUBBLE"},table:{ON_TABLE_INSERT:"ON_TABLE_INSERT",ON_TABLE_COPY:"ON_TABLE_COPY",ON_TABLE_CUT:"ON_TABLE_CUT",ON_TABLE_DELETE:"ON_TABLE_DELETE",ON_TABLE_SELECT_ALL:"ON_TABLE_SELECT_ALL",ON_TABLE_BEGIN_RESIZING:"ON_TABLE_BEGIN_RESIZING",ON_TABLE_END_RESIZING:"ON_TABLE_END_RESIZING",ON_TABLE_MERGE_CELLS:"ON_TABLE_MERGE_CELLS",ON_TABLE_SPLIT_CELLS:"ON_TABLE_SPLIT_CELLS",ON_TABLE_KEEP_ACTIVE:"ON_TABLE_KEEP_ACTIVE",ON_TABLE_CANCEL_ACTIVE:"ON_TABLE_CANCEL_ACTIVE",ON_TABLE_SELECT_COLUMN_OR_ROW:"ON_TABLE_SELECT_COLUMN_OR_ROW",ON_TABLE_SELECTS_START:"ON_TABLE_SELECTS_START",ON_TABLE_MOVING_START:"ON_TABLE_MOVING_START",ON_TABLE_MOVING_EDIT_MODE:"ON_TABLE_MOVING_EDIT_MODE",ON_TABLE_MOVING_EDIT_MODE_END:"ON_TABLE_MOVING_EDIT_MODE_END",ON_TABLE_DRAG_START_COLUMN_OR_ROW:"ON_TABLE_DRAG_START_COLUMN_OR_ROW",ON_TABLE_DRAG_COLUMN_OR_ROW:"ON_TABLE_DRAG_COLUMN_OR_ROW",ON_TABLE_DRAG_END_COLUMN_OR_ROW:"ON_TABLE_DRAG_COLUMN_OR_ROW_END",ON_TABLE_SELECT_BY_SHORTCUT:"ON_TABLE_SELECT_BY_SHORTCUT"},shape:{ON_IMAGE_MOVING_EDIT_MODE:"ON_IMAGE_MOVING_EDIT_MODE",ON_IMAGE_MOVING_EDIT_MODE_END:"ON_IMAGE_MOVING_EDIT_MODE_END",ON_SHOW_IMAGE_VIEWER:"ON_SHOW_IMAGE_VIEWER",ON_HIDE_IMAGE_VIEWER:"ON_HIDE_IMAGE_VIEWER",ON_SHAPE_BEGIN_RESIZING:"ON_SHAPE_BEGIN_RESIZING",ON_SHAPE_END_RESIZING:"ON_SHAPE_END_RESIZING",HIT_ON_SHAPE:"HIT_ON_SHAPE",ON_SHAPE_SELECTED:"ON_SHAPE_SELECTED",ON_SHAPE_CANCEL_SELECT:"ON_SHAPE_CANCEL_SELECT",ON_IMAGE_UPLOAD_REQUEST:"ON_IMAGE_UPLOAD_REQUEST",ON_IMAGE_INSERT:"ON_IMAGE_INSERT",AFTER_IMAGE_INSERT:"AFTER_IMAGE_INSERT",ON_SHAPE_BEGIN_PREVIEW:"ON_SHAPE_BEGIN_PREVIEW",ON_SHAPE_END_PREVIEW:"ON_SHAPE_END_PREVIEW",ON_SHAPE_BEGIN_SET_ADJUSTHANDLER:"ON_SHAPE_BEGIN_SET_ADJUSTHANDLER",ON_SHAPE_END_SET_ADJUSTHANDLER:"ON_SHAPE_END_SET_ADJUSTHANDLER",ON_SHAPE_SET_ADJUSTHANDLER:"ON_SHAPE_SET_ADJUSTHANDLER",ON_SHAPE_PRE_INSERT:"ON_SHAPE_PRE_INSERT",ON_SHAPE_CANCLE_INSERT:"ON_SHAPE_CANCLE_INSERT"},mobile:o,dispatchEvent:i.default.dispatchEvent,cooper:i.default.cooper,hyperLink:{ON_LINK_INSERT:"ON_LINK_INSERT",ON_LINK_EDIT:"ON_LINK_EDIT",ON_LINK_SELECT:"ON_LINK_SELECT",ON_LINK_DELETE:"ON_LINK_DELETE",ON_LINK_OPEN:"ON_LINK_OPEN",ON_LINK_CARD_SWITCH:"ON_LINK_CARD_SWITCH",ON_LINK_MODAL_SWITCH:"ON_LINK_MODAL_SWITCH",ON_LINK_ITEM_CLICK:"ON_LINK_ITEM_CLICK",ON_LINK_COPY:"ON_LINK_COPY",SWITCH_TO_WEBSHAPE:"SWITCH_TO_WEBSHAPE"},webshape:{ON_WEBSHAPE_CARD_SWITCH:"ON_WEBSHAPE_CARD_SWITCH",SWITCH_TO_LINK:"SWITCH_TO_LINK",ON_WEBSHAPE_INSERT:"ON_WEBSHAPE_INSERT",ON_WEBSHAPE_MODAL_SWITCH:"ON_WEBSHAPE_MODAL_SWITCH"},footnoteEndnote:{ON_NOTE_SETTING_DIALOG_SWITCH:"ON_NOTE_SETTING_DIALOG_SWITCH",ON_FOOTNOTE_SETTING_CT:"ON_FOOTNOTE_SETTING_CT",ON_ENDNOTE_SETTING_CT:"ON_ENDNOTE_SETTING_CT"},zoom:{ZOOM_TO_FITPAGE:"ZOOM_TO_FITPAGE",ZOOM_TO_WORD:"ZOOM_TO_WORD",ZOOM_TO_TOTALPAGE:"ZOOM_TO_TOTALPAGE",ZOOM_TO_DECREASE:"ZOOM_TO_DESCRESE",ZOOM_TO_INCREASE:"ZOOM_TO_INCREASE",ZOOM_TO_100_PERCENT:"ZOOM_TO_100_PERCENT",DOC_SCALE:"DOC_SCALE",ON_SCALING_CHANGE:"ON_SCALING_CHANGE"},content:{MODIFY:"MODIFY",CLEAR:"CLEAR",PROP_CHANGE:"PROP_CHANGE",EDIT:"EDIT"},formatPainter:{ON_FORMAT_PAINTER_APPLIED:"ON_FORMAT_PAINTER_APPLIED",ON_FORMAT_PAINTER_RESET:"ON_FORMAT_PAINTER_RESET"},pageSetting:{ON_PAGE_MARGIN_VISIBLE:"ON_PAGE_MARGIN_VISIBLE",ON_PAGE_DIRECT_VISIBLE:"ON_PAGE_DIRECT_VISIBLE"},contentControls:{BEFORE_CONTENT_CONTROLS_DATE_APPLY:"BEFORE_CONTENT_CONTROLS_DATE_APPLY",RENDER_CONTROLS:"RENDER_CONTROLS",RENDER_PIC_CONTROLS_ENTRANCE:"RENDER_PIC_CONTROLS_ENTRANCE",ON_CONTROL_ITEM_CLICK:"ON_CONTROL_ITEM_CLICK",ON_CONTENT_CONTROL_ENTER:"ON_CONTENT_CONTROL_ENTER"},catalog:{BEFORE_CATALOG_APPLY:"BEFORE_CATALOG_APPLY",ON_CATALOG_CONFIG_PANEL_VISIBLE_CHANGE:"ON_CATALOG_CONFIG_PANEL_VISIBLE_CHANGE",SHOW_CATALOG_TIP:"SHOW_CATALOG_TIP"},docmap:{SHOW:"SHOW",HIDE:"HIDE",INIT:"INIT",INSERTED:"INSERTED",DELETED:"DELETED",MODIFIED:"MODIFIED",SELECTED:"SELECTED",AUTONUM_CHANGED:"AUTONUM_CHANGED",ON_PANEL_OPEN:"ON_PANEL_OPEN",ON_PANEL_CLOSE:"ON_PANEL_CLOSE",ON_ITEM_CLICK:"ON_ITEM_CLICK"},cooperation:{COOPERATOR_SELECTION_CHANGE:"COOPERATOR_SELECTION_CHANGE",ON_CONVENE_LIST_UPDATE:"ON_CONVENE_LIST_UPDATE",ON_RESPONSE_CONVENE:"ON_RESPONSE_CONVENE",ON_CONVENE_INITIATE:"ON_CONVENE_INITIATE",CHANGE_COOPERATION_STATUS:"CHANGE_COOPERATION_STATUS",ON_AVATAR_VISIBLE_CHANGE:"ON_AVATAR_VISIBLE_CHANGE",SHOW_COOPERATOR_NAME_TIP:"SHOW_COOPERATOR_NAME_TIP",ON_NOTIFY_TIPS:"ON_NOTIFY_TIPS"},watermark:{CHANGE_MODIFY_WATERMARK:"CHANGE_MODIFY_WATERMARK",REMOVE_WATERMARK_OLD_NODE:"REMOVE_WATERMARK_OLD_NODE"},pcDialogs:{WPS_SHOW_ALERT:"WPS_SHOW_ALERT",ON_OPEN_UPLOAD_DECORATOR:"ON_OPEN_UPLOAD_DECORATOR",WPS_SUMMARY_TIPS:"WPS_SUMMARY_TIPS"},taskPane:{OPEN_FONT_FONT:"OPEN_FONT_FONT",OPEN_FONT_PARA:"OPEN_FONT_PARA",OPEN_BOOKMARK:"OPEN_BOOKMARK",OPEN_OFFICIAL_DOCUMENT:"OPEN_OFFICIAL_DOCUMENT",OPEN_COMMENT_PANEL:"OPEN_COMMENT_PANEL",GET_COMMENT_PANEL_DATA:"GET_COMMENT_PANEL_DATA",KILL_COMMENT_PANEL:"KILL_COMMENT_PANEL",OPEN_SHAPE_ATTR:"OPEN_SHAPE_ATTR",OPEN_SHAPE_TEXT:"OPEN_SHAPE_TEXT",ON_TASK_PANE_VISIBLE:"ON_TASK_PANE_VISIBLE",CLOSE_TASK_PANEL:"CLOSE_TASK_PANEL"},restrictEdit:{ON_RESTRICT_STATE_CHANGE:"ON_RESTRICT_STATE_CHANGE",SHOW_RESTRICT_OPEN_DIALOG:"SHOW_RESTRICT_OPEN_DIALOG"},guide:a,print:{OPEN_PRINT:"OPEN_PRINT"},processon:{CREATE:"CREATE"},document:{ON_OTHER_USER_CHANGE_DOCUMENT_ENCODING:"ON_OTHER_USER_CHANGE_DOCUMENT_ENCODING",ON_DOCUMENT_OPEN:"ON_DOCUMENT_OPEN",ON_DOC_BEFORE_OPEN:"ON_DOC_BEFORE_OPEN",ON_DOC_AFTER_INIT:"ON_DOC_AFTER_INIT",ON_DOC_AFTER_OPEN:"ON_DOC_AFTER_OPEN",ON_DOC_DATA_LOAD:"ON_DOC_DATA_LOAD"},webMode:{ON_UPDATE_OUTDIV:"ON_UPDATE_OUTDIV",ON_FILENAME_SETTING_CHANGE:"ON_FILENAME_SETTING_CHANGE",ON_FILENAME_SWITCH:"ON_FILENAME_SWITCH",ON_WEBMODE_GUIDE:"ON_WEBMODE_GUIDE"},bookmark:{ON_BOOKMARKS_CHANGE:"ON_BOOKMARKS_CHANGE",ON_BOOKMARKS_SORT:"ON_BOOKMARKS_SORT"},view:{BEFORE_VIEW_MODE_CHANGED:"BEFORE_VIEW_MODE_CHANGED",AFTER_VIEW_MODE_CHANGED:"AFTER_VIEW_MODE_CHANGED",VISUAL_VIEWPORT_LOCATE_TIMEOUT:"VISUAL_VIEWPORT_LOCATE_TIMEOUT",ON_OPENAPI_INIT:"ON_OPENAPI_INIT"},pluginEvent:{CUSTOM_PLUGIN_EVENT:"CUSTOM_PLUGIN_EVENT"},preview:{ON_PAGE_APPENDED:"ON_PAGE_APPENDED"},input:{ON_INPUT_VALUE_CHANGED:"ON_INPUT_VALUE_CHANGED"},canvas:{ON_BEFORE_TEXT_PAGE_RENDER:"ON_BEFORE_TEXT_PAGE_RENDER",ON_AFTER_REFRESH_CANVAS:"ON_AFTER_REFRESH_CANVAS"},spellCheck:{OPEN:"OPEN",CLOSE:"CLOSE",MISSION_BEFORE_TERMINATE:"MISSION_BEFORE_TERMINATE",RELEASE_MISSION:"RELEASE_MISSION",SAVE_IGNORE_DATA2_STORAGE:"SAVE_IGNORE_DATA2_STORAGE",DELETE_REMOVE_WRONG_RANGES:"DELETE_REMOVE_WRONG_RANGES",INSERT_REMOVE_WRONG_RANGES:"INSERT_REMOVE_WRONG_RANGES",SET_PROP_REMOVE_WRONG_RANGES:"SET_PROP_REMOVE_WRONG_RANGES",REMOVE_WRONG_RANGES:"REMOVE_WRONG_RANGES",BEFORE_REMOVE_PROGRESS_RANGES:"BEFORE_REMOVE_PROGRESS_RANGES"},documentField:{DOC_DOCUMENTFIELDS_DATA_UPDATE:"DOC_DOCUMENTFIELDS_DATA_UPDATE"},interactions:{SWIPE:"SWIPE"},edit:{ON_AUTO_FORMAT_BY_INSERT_TEXT:"ON_AUTO_FORMAT_BY_INSERT_TEXT",ON_ANCHOR_DATA_CHANGED:"ON_ANCHOR_DATA_CHANGED",ON_SHAPE_DATA_CHANGED:"ON_SHAPE_DATA_CHANGED"},scroll:{FREE_SCROLL_BAR_STYLE:"FREE_SCROLL_BAR_STYLE"}};t.default=r},2694:function(e,t,n){"use strict";n.r(t),n.d(t,"initClient",(function(){return v})),n.d(t,"getClient",(function(){return m}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(26),d=n(15),p=n(150),f=n(0),g=null,v=function(){var e;e=new _,g=window.interactRPCClient=e,(new y).init()},m=function(){return void 0===window.interactRPCClient&&window.__CONFIG__.isEnableInteractSession&&v(),window.interactRPCClient},_=function(e){function t(){o()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._state=f.State.CLOSED,e.bindEvents(),e._autoReconnect=!0,e._socket=null,e._retryCount=0,e._pingTimer=null,e._reconnectTimer=null,e.clientID=window.__WPSENV__.conn_id?window.__WPSENV__.conn_id:f.randomHexString(32),e._lastRecvTime=0,e._onmessageNormal=function(t){var n={},i={};t.data instanceof ArrayBuffer?(e._lastMsgLength=t.data.byteLength,(n=h.binReader(t.data)).result.byteLength>0&&(i=h.binReader(n.result))&&(i.msgLength=n.result.byteLength)):(e._lastMsgLength=t.data.length,(i=(n=JSON.parse(t.data)).result)&&(i.msgLength=t.data.length)),e.emit(n.event||n.cmd,i)},e.on("session.ping",(function(e){})),e.initSocket(),e}return c()(t,e),r()(t,[{key:"bindEvents",value:function(){var e=this;window.addEventListener("offline",(function(t){e._onSocketClosed({code:-2,reason:"offline"})})),window.addEventListener("online",(function(){e._autoReconnect&&e._state===f.State.IDLE&&e.connectImmediately()}))}},{key:"initSocket",value:function(){var e=this,t="";window.__WPSENV__.file_version&&(t=window.__WPSENV__.file_version);var n={connid:this.clientID,front_ver:t},i=function(){var e=window.location.pathname.split("/").pop(),t=null;try{window._parent.__INITIAL_STATE__&&(t=window._parent.__INITIAL_STATE__.route.params.chkcode)}catch(e){}var n="/api/v3/office/file/"+e+"/interact/session";return t&&(n+="?chkcode="+t),n}();d.callJSON("POST",i,{body:n,timeout:5e3}).then((function(t){if(!t.body.token)return console.error("【interactRPC】get ticket failed! empty ticket,resp:",t),void e.reconnect();var n=function(e,t){var n="ws://";"https:"===location.protocol&&(n="wss://");var i=location.search,o=null;try{window._parent.__INITIAL_STATE__&&(o=window._parent.__INITIAL_STATE__.route.params.chkcode)}catch(e){}var a=window.location.pathname.split("/").pop(),r=""+n+e;return r+=window.__CONFIG__.pathPrefix,r+="/wo/websocket/v3/interact",t&&(r+="/"+t),r+=i,o&&(r+=(i?"&":"?")+"chkcode="+o),i.indexOf("_w_appid")<0&&window.__WPSENV__.app_id&&(r=f.appendURLQuery(r,"_w_appid="+window.__WPSENV__.app_id)),r=f.appendURLQuery(r,"office_type="+f._getApp()),r=f.appendURLQuery(r,"file_id="+a)}(t.body.host?t.body.host:location.host,t.body.region);e._connectSocket(n,t.body.token)})).catch((function(t){t.subReason=t.reason,t.reason=t.result,console.error("【interactRPC】get ticket failed! reason:",t),e._autoReconnect&&e.reconnect()}))}},{key:"_connectSocket",value:function(e,t){var n=this;this._socket=new WebSocket(e,t),this._socket.binaryType="arraybuffer",this._socket.onopen=function(e){n._lastRecvTime=window.performance.now(),n._pingTimer=setInterval((function(){n._keepalive()}),f.TIMECOUNT.PING_INTERVAL),n._setState(f.State.CONNECTED)},this._socket.onclose=function(e){console.error("【interactRPC】[WebSocket] onclose, code:",e.code,", reason:"+e.reason+", reconnect:",n._autoReconnect),n._onSocketClosed(e)},this._socket.onmessage=function(e){n._lastRecvTime=window.performance.now(),n._onSocketMessage(e)}}},{key:"reconnect",value:function(){var e=this;if(this._closeSocket(),"hidden"===document.visibilityState)return this._autoReconnect=!1,this._setState(f.State.IDLE),!1;this._setState(f.State.CONNECTING);var t=function(){e._autoReconnect=!0;var t=e._retryCount*f.TIMECOUNT.RETRY_INTERVAL;e._retryCount++,t>f.TIMECOUNT.MAX_RETRY_INTERVAL&&(t=f.TIMECOUNT.MAX_RETRY_INTERVAL),clearTimeout(e._reconnectTimer),e._reconnectTimer=setTimeout((function(){e._reconnectTimer=null,e.initSocket()}),t)};window.__WPSENV__.extendsRefreshToken?window.__WPSENV__.extendsRefreshToken().then((function(){t()})).catch((function(t){e._setState(f.State.CLOSED)})):setTimeout(t,0)}},{key:"_keepalive",value:function(){var e=window.performance.now()-this._lastRecvTime;e>f.TIMECOUNT.MAX_RECV_INTERVAL?(console.error("[WebSocket] read timeout for",e/1e3,"s"),this._onSocketClosed({code:-1,reason:"read timeout"})):null!==this._socket&&this.sendJson("session.ping",{start:f.getMilliTimestamp()})}},{key:"connectImmediately",value:function(){this._autoReconnect=!0,this.initSocket()}},{key:"enable",value:function(){this._autoReconnect=!0,this.startListen()}},{key:"send",value:function(e,t,n){if(null===this._socket)return!1;if(this._socket.readyState!==WebSocket.OPEN)return!1;var i={cmd:e,seq:0,args:f.marshal(t)};return n&&(i.exArgs=JSON.stringify(n)),this._socket.send(h.binWriter(i)),!0}},{key:"sendJson",value:function(e,t,n){if(null===this._socket)return!1;if(this._socket.readyState!==WebSocket.OPEN)return!1;var i={};t&&(i=t);var o={cmd:e,seq:0,args:i};return n&&(o.exArgs=JSON.stringify(n)),this._socket.send(JSON.stringify(o)),!0}},{key:"_closeSocket",value:function(){if(this._socket){switch(this._socket.onopen=function(){},this._socket.onmessage=function(){},this._socket.onerror=function(){},this._socket.onclose=function(){},this._socket.readyState){case WebSocket.CONNECTING:case WebSocket.OPEN:this._socket.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:}this._socket=null}this._setState(f.State.CLOSED),null!==this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),null!==this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),console.log("【interactRPC】client closed socket")}},{key:"_onSocketMessage",value:function(e){try{this._onmessageNormal(e)}catch(e){throw e}}},{key:"_onSocketClosed",value:function(e){if(this._recvFileOpen=!1,/^{/.test(e.reason)){var t=JSON.parse(e.reason);if("Unavailable"!==t.reason)return this.emit("session.error",t),void this.close()}this._autoReconnect&&this.reconnect()}},{key:"close",value:function(){this._autoReconnect=!1,this._closeSocket(),this._setState(f.State.CLOSED)}},{key:"_setState",value:function(e){this._state!==e&&(this._state=e)}}]),t}(p.a),y=function(){function e(){o()(this,e),this._timer=null}return r()(e,[{key:"init",value:function(){var e=this;document.addEventListener("visibilitychange",(function(){e._visibilityStateHandle()})),window.addEventListener("pageshow",(function(){e._onPageShow()})),this._visibilityStateHandle()}},{key:"_visibilityStateHandle",value:function(){"visible"===document.visibilityState?this._onVisible():this._onInvisible()}},{key:"_onPageShow",value:function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null),g._state===f.State.CLOSED_NOERROR&&g.connectImmediately()}},{key:"_onVisible",value:function(){this._clearTimers(),g._state===f.State.IDLE&&g.connectImmediately()}},{key:"_onInvisible",value:function(){null===this._timer&&(this._timer=setTimeout((function(){g._state!==f.State.CONNECTED&&g._state!==f.State.CONNECTING||(window.interactRPCClient.close(),window.interactRPCClient._setState(f.State.IDLE))}),1e3*window.__CONFIG__.maxSessionIdleTime))}},{key:"_clearTimers",value:function(){clearTimeout(this._timer),this._timer=null}}]),e}()},2695:function(e,t,n){"use strict";var i=n(535),o=n(614);function a(){this.initialize()}a.prototype=new i.AbsVectorObject,a.prototype.initialize=function(){this.objType=o.default.OType_Custom,window.g_rpt.registerNewObject(this)},a.prototype.applySvrData=function(e){this.private=e.data,this.objID=e.id,this.vector=e.data.childs},a.prototype.getChilds=function(){return this.private.childs},a.prototype.getObjID=function(){return this.objID},a.prototype.appChild=function(e){this.push(e)},a.prototype.insertChild=function(e,t){this.insert(e,t)},a.prototype.removeChild=function(e){this.remove(e)},a.prototype.moveChild=function(e,t){this.move(e,t)},a.prototype.setChild=function(e,t){this.set(e,t)},a.prototype.forward=function(e){switch(e.opType){case o.default.otInsert:this.private.childs.splice(e.pos,0,e.data);break;case o.default.otRemove:this.private.childs.splice(e.pos,1);break;case o.default.otMove:this.private.childs.splice(e.pos,1),this.private.childs.splice(e.pos+e.offset,0,e.data);break;case o.default.otModify:this.private.childs[e.pos]=e.data;break;case o.default.otReplaceData:var t=this.private;this.private=e.data,e.data=t}},a.prototype.backward=function(e){var t=new Object;switch(t.object=e.object,t.pos=e.pos,e.opType){case o.default.otInsert:t.opType=o.default.otRemove,t.data=e.data;break;case o.default.otRemove:t.opType=o.default.otInsert,t.data=e.data;break;case o.default.otMove:t.opType=o.default.otMove,t.pos=e.pos+e.offset,t.offset=-e.offset,t.data=e.data;break;case o.default.otModify:t.opType=o.default.otModify,t.oldData=e.data,t.data=e.oldData;break;case o.default.otReplaceData:t=e}this.forward(t)},t.a=a},2698:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var i=n(14),o=function(){return(window.fileInfo||window.__WPSENV__.file_info.file).id};function a(){var e=Object(i.getQuery)("wpsPreview");return"0"!==e&&"false"!==e&&void 0!==e}},2699:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"i",(function(){return l})),n.d(t,"h",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"f",(function(){return h}));var i={MARKER:"MARKER",FLUORESCENCE:"FLUORESCENCE",HIGHLIGHTER:"HIGHLIGHTER",ERASER:"ERASER"},o=["#FF0000","#FFF000","#00FF00","#0000FF","#3B3B3B"],a={strokeSize:2.3,strokeSizeSpliteLength:20,strokeSizeMax:11.5,strokeSizeMin:2.3},r="#ffffffffff000000",s={pageZoomSizeSpliteLength:80},l={m:0,cm:1,mm:2,in:3,pt:4,ti:5,pc:6,em:7,ex:6},u={brushDefaultWidth4Ellipse:19050,brushDefaultHeight4Ellipse:19050,waterColorBrushDefaultWidth4Ellipse:34925,waterColorBrushDefaultHeight4Ellipse:34925,brushDefaultWidth4Rectangle:31750,brushDefaultHeight4Rectangle:127e3},c={ellipse:0,rectangle:1,drop:2,highlight:3},h={CopyPen:0,MaskPen:1,NoOperation:2}},2700:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(54),o=window.__CONFIG__.wps.cdnFontsJson,a=function(){return{types:i.default.HTTP_TYPES,autoErrorToast:!1,callAPI:function(e){return e.get(window.__CONFIG__.isEnableFontServer?"/api/v3/office/fonts_config/wps":o).end()}}}},2701:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(324),l=n(6118),u=0,c=1,h=2,d=-1,p=0,f=1,g=2,v=1,m=3,_=4,y=function(){function e(){o()(this,e),this.curPos=0,this.totalLen=0,this.hasMergeFormat=!1,this.hasCarFormat=!1,this.strCode="",this.strName="",this.lastError=null,this.privateSwitchs=new Map,this.pictureSwitch=new Map,this.formats=new Map,this.switchs=new Map,this.params=[],this.parmsInQuote=[],this.initPrivateSwitchs()}return r()(e,[{key:"initPrivateSwitchs",value:function(){this.privateSwitchs.set("l",!0),this.privateSwitchs.set("m",!1),this.privateSwitchs.set("n",!1),this.privateSwitchs.set("o",!0),this.privateSwitchs.set("t",!0)}},{key:"parse",value:function(e){var t=this;this.strCode=e+" ",this.totalLen=this.strCode.length;var n=this.nextWord(),i=n.word,o=void 0;switch(n.wordType){case h:this.strName=i;break;case c:o=i[0]}for(var a=!0;a;){var r=this.curPos,s=this.nextWord(),l=s.word;switch(s.wordType){case h:if(o&&this.switchHasParam(o))if("#"==o||"@"==o);else if("*"==o)switch(this.parseFormatString(l)){case d:break;case p:this.formats.forEach((function(e,n){0==e&&t.formats.delete(n)})),this.formats.set(l,!1);break;case f:this.formats.set(l,!0);break;case g:l.length>2083&&l.splice(2083,l.length-2083),this.switchs.set(o,l)}else l.length>2083&&l.splice(2083,l.length-2083),this.switchs.set(o,l);else{l.length>2083&&l.splice(2083,l.length-2083);var y={begin:r,end:this.curPos};this.params.push({url:l,urlScpope:y}),this.parmsInQuote.push(s.inQuote),this.switchs.set(o,"")}o=0;break;case c:this.lastError||(("@"==l[0]||"#"==l[0])&&this.formats.size>0?this.lastError=_:"*"!=o&&"@"!=o&&"#"!=o||!o?o==l[0]&&(this.lastError=v):this.lastError=m),o&&this.switchs.set(o,""),this.lastError||"@"!=l[0]&&"#"!=l[0]||!this.switchs.get(l[0])||(this.lastError=v),o=l[0];break;case u:o&&(this.lastError||"*"!=o&&"@"!=o&&"#"!=o||(this.lastError=m),this.switchs.set(o,"")),a=!1}}}},{key:"reParse",value:function(e){this.curPos=0,this.totalLen=0,this.lastError=0,this.hasMergeFormat=!1,this.hasCharFormat=!1,this.strCode="",this.strName="",this.switchs.clear(),this.pictureSwitch.clear(),this.formats.clear(),this.params=[],this.parmsInQuote=[],this.parse(e)}},{key:"nextWord",value:function(){var e=u,t="",n=!1;if(this.curPos>=this.totalLen-1)return{word:t,wordType:e,inQuote:n};this.skipSpace();var i=this.nextChar();if(!i||this.isSpace(i))return{word:t,wordType:e,inQuote:n};if("="==i)return{word:t+=i,wordType:e=h,inQuote:n};if(this.isShift(i)){if(i=this.nextChar(),this.isSwitch(i))return e=c,{word:t=i=i.toLowerCase(),wordType:e,inQuote:n};i&&this.addChar(t,i)}else this.isQuote(i)?n=!0:t=i;var o=!0;for(e=h;o;){if(""===(i=this.nextChar())||0===i){o=!1;break}if(this.isBreakWordChar(i))n?this.addChar(t,i):o=!1;else switch(i){case 8220:case 8221:case'"':o=!1,n||this.stepBack();break;case"\\":n?(i=this.nextChar())&&this.addChar(t,i):(i=this.nextChar(),this.isSwitch(i)?(o=!1,this.stepBack(),this.stepBack()):this.isShift(i)?t+="\\":t.length>0&&":"==t.charAt(t.length-1)&&this.addChar(t,i));break;default:t+=i}}return{word:t=t.trim(),wordType:e,inQuote:n}}},{key:"addChar",value:function(e,t){this.curPos!=this.totalLen&&t}},{key:"isBreakWordChar",value:function(e){var t=e.charCodeAt(0);return t==s.A||t==s.j||t==s.l||t==s.w||t==s.m||t==s.k||t==s.i||t==s.B}},{key:"isQuote",value:function(e){var t=e.charCodeAt();return'"'==e||8220==t||8221==t}},{key:"isSwitch",value:function(e){return this.isPrivateSwitch(e)||"*"==e||"@"==e||"#"==e}},{key:"isShift",value:function(e){return"\\"==e}},{key:"isPrivateSwitch",value:function(e){return!!this.privateSwitchs.get(e.toLowerCase())}},{key:"skipSpace",value:function(){for(;this.isSpace(this.nextChar()););this.curPos<=this.totalLen-1&&this.stepBack()}},{key:"stepBack",value:function(){var e=!0;return this.curPos>0?this.curPos--:e=!1,e}},{key:"nextChar",value:function(){return this.curPos>=0&&this.curPos<this.totalLen?this.strCode[this.curPos++]:""}},{key:"switchHasParam",value:function(e){return"@"==e||"*"==e||"#"==e||!!this.privateSwitchs.get(e)&&this.privateSwitchs.get(e)}},{key:"parseFormatString",value:function(e){for(var t=["caps","firstcap","upper","lower","sbchar","dbchar","firstcaponly"],n=0;n<t.length;++n)if(t[n]==e.toLowerCase())return f;var i=Object(l.b)(e,0).result;return"dollartext"==e.toLowerCase()||i?p:"mergeformat"==e.toLowerCase()||"mergeformatinet"==e.toLowerCase()?(this.hasMergeFormat=!0,g):"charformat"==e.toLowerCase()?(this.hasCarFormat=!0,g):d}},{key:"isSpace",value:function(e){var t=e.charCodeAt();return t==s.z||t==s.A||t==s.r||t==s.j||t==s.l||t==s.w||t==s.m||t==s.k||t==s.i||t==s.q||t==s.a||t==s.f||t==s.g||t==s.B}},{key:"getLastErr",value:function(){return this.lastError}},{key:"getErrorString",value:function(){}},{key:"getFormatCount",value:function(){return this.formats.size}},{key:"getFormat",value:function(e){}}]),e}();t.a=y},289:function(e,t,n){"use strict";t.a=function(e){return Object.prototype.toString.call(e)}},2939:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var i=n(24),o=n.n(i),a=n(8),r=n.n(a),s=n(80),l=n.n(s),u=n(1),c=n.n(u),h=n(2),d=n.n(h),p=n(361),f=function(e){return{types:p.default.HTTP_TYPES,callAPI:(t=l()(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.post("/api/v3/office/file/"+window.urlFileId+"/users").send({ids:e}).end();case 2:return i=t.sent,t.abrupt("return",{body:i.body});case 4:case"end":return t.stop()}}),t,void 0)}))),function(e){return t.apply(this,arguments)})};var t},g=n(227),v=n(676),m=Function.prototype,_=0;function y(e){return new Promise((function(t){setTimeout(t,e)}))}var b=[],T=!1,C=function(){function e(){c()(this,e)}return d()(e,[{key:"loadUserInfos",value:function(e,t){var n=new Promise((function(n){var i;i=l()(regeneratorRuntime.mark((function i(){var o,a,s,l,u,c,h;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:T=!0,o=[],a=0;case 3:if(!(a<e.length)){i.next=20;break}if(s=e.slice(a,a+200),a+=200,!((l=Date.now())-_<200)){i.next=10;break}return i.next=10,y(200-(l-_));case 10:return u=null,i.next=13,t(f(s));case 13:c=i.sent,h=c.response,u=h&&h.body||[],_=Date.now(),o.push.apply(o,r()(u)),i.next=3;break;case 20:n(o),b.length>0&&b.shift()(),T=!1;case 23:case"end":return i.stop()}}),i,this)}))),m=function(){return i.apply(this,arguments)}}));return T?b.push(m):m(),n}}]),e}(),k=new(function(){function e(){if(c()(this,e),"object"===o()(e._instance_))return e._instance_;e._instance_=this,this.loader=new C,this.colors=["#0484DA","#33A02C","#FF7F00","#6A3D9A","#3D959A","#AE8B00","#9A3D84","#5B68D0","#7BAE00","#f15989","#155884","#1C8015","#9E5812","#4E217F","#21687F","#876800","#7F2164","#151B84","#708700","#A7191A","#1F78B4","#0BBE00","#CA6400","#6003C3","#009788","#C38D00","#BD006C","#1800CC","#A0B200","#D20002"],this.userColorsFromOutside=new Map,this.coopInfos=[],this.styleTags=[],this.cooperCenter=g.default.cooper.getCooperCenter(),this.handleCooperModeToggled=this.handleCooperModeToggled.bind(this),this.handleStyleTagReceived=this.handleStyleTagReceived.bind(this),this._isInit=!1,this._isFetchingInfos=!1,this._isFetchRequestShelved=!1}var t;return d()(e,[{key:"setUsersColor",value:function(e,t){var n=this;if(e.forEach((function(e){n.userColorsFromOutside.set(e.userId,e.color);var t=n.coopInfos.find((function(t){return t.userid+""==e.userId+""}));t&&(t.color=e.color)})),t){var i=window.APP.data.selection.activeAllCommentsData;i&&i.comments&&i.comments.forEach((function(e){var t=n.userColorsFromOutside.get(e.userid)||e.color;e.color=t})),this.events.dispatchEvent(this.events.COOPERATOR_SELECTION_CHANGE),window.APP.workspace.refreshDryly()}}},{key:"getColorByTagid",value:function(e){var t=this.coopInfos.find((function(t){return t.tagid===e}));return t&&this.userColorsFromOutside.has(t.userid)?this.userColorsFromOutside.get(t.userid):this.colors[(e-1)%this.colors.length]}},{key:"getUserColor",value:function(e){if(this.userColorsFromOutside.has(e))return this.userColorsFromOutside.get(e);var t=this.coopInfos.find((function(t){return t.userid===e}));if(t)return t.color;var n=this.styleTags.find((function(t){return t.userid===e}));return n?this.colors[(n.tagid-1)%this.colors.length]:"#fc0d1b"}},{key:"getRevisionColor",value:function(e){return this.userColorsFromOutside.has(e)?this.userColorsFromOutside.get(e):this.colors[e%this.colors.length]}},{key:"init",value:function(e,t,n,i){this.acl=n,this.fileid=t,this.dispatch=i,this.events=e,window.addEventListener(this.events.ON_STYLE_TAG_RECEIVED,this.handleStyleTagReceived),window.addEventListener(this.events.DOC_COOPERATION_MODE_TOGGLED,this.handleCooperModeToggled),this.init=Function.prototype}},{key:"handleStyleTagReceived",value:(t=l()(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.styleTags=t.detail.data,this._isInit&&this.updateUserInfo();case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"afterOpen",value:function(){this._isInit=!0,this.copyUserInfoFromPublic(),this.updateUserInfo()}},{key:"copyUserInfoFromPublic",value:function(){var e=this;this.cooperCenter._users.forEach((function(t){e.generateUserInfo(Object.assign({},t))}))}},{key:"generateUserInfo",value:function(e){if(e){var t={avatar:e.avatar,userid:e.id,username:e.name},n=e.tagid;void 0!==n?(t.tagid=n,t.color=this.userColorsFromOutside.get(e.id)||this.colors[(n-1)%this.colors.length]):t.color=e._color||"#fc0d1b";var i=this.coopInfos.find((function(e){return e.userid===t.userid}));i?Object.assign(i,t):this.coopInfos.push(t)}}},{key:"getUserInfoFromPublic",value:function(e){var t=e.userid,n=e.tagid,i=this.cooperCenter._users.get(t);i&&this.generateUserInfo(Object.assign({tagid:n},i))}},{key:"updateUserInfo",value:function(){var e=this;if(this._isFetchingInfos)this._isFetchRequestShelved=!0;else{this._isFetchingInfos=!0,this.styleTags.forEach(this.getUserInfoFromPublic,this);var t=this.fetchUserInfoThatNonexistentYet().then((function(){e.events.dispatchEvent(e.events.DOC_COOPINFO_UPDATED)}));Object(v.enableFinally)(t).finally((function(){e._isFetchingInfos=!1,e._isFetchRequestShelved&&(e._isFetchRequestShelved=!1,e.updateUserInfo())}))}}},{key:"fetchUserInfoThatNonexistentYet",value:function(){var e=this,t=this.styleTags.filter((function(t){return!e.coopInfos.some((function(e){return e.userid===t.userid}))}));if(t.length>0){var n=t.map((function(e){return e.userid}));return this.loader.loadUserInfos(n,this.dispatch).then((function(t){t.forEach((function(i){var o=i.avatar_url,a=i.name,r=i.id,s=e.styleTags.find((function(e){return e.userid===r})),l={avatar:o,userid:r,username:a,color:e.userColorsFromOutside.get(r)};s?(l.tagid=s.tagid,l.color=l.color||e.colors[(s.tagid-1)%e.colors.length]):(l.color=l.color||"#fc0d1b",console.error("id无法匹配，协作信息加载错误！",t,n,e.styleTags)),e.coopInfos.push(l)}))}))}return Promise.resolve()}},{key:"handleCooperModeToggled",value:function(e){e.detail.state&&!this._isInit||this.events.dispatchEvent(this.events.DOC_COOPINFO_UPDATED)}},{key:"hasCooperMembers",get:function(){return!(0===this.coopInfos.length||1===this.coopInfos.length&&this.coopInfos[0].userid==window.APP.info.userid)}}]),e}())},2956:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a}));var i=0,o=1,a=2},3075:function(e,t,n){"use strict";var i=n(24),o=n.n(i),a=n(614);function r(){this.operates=new Array,this.customOp=new Map,this.newObjects=new Array,this.modifyObjects=new Array,this.command={},this.mainOperstes={},this.dataVersion=-1,this.isLocal=!0,this.isSelf=!0,this.isVerOfCurExec=!0,this.extRanges=null,this.closed=!1,this.taskVer=-1,this.bornTaskVer=-1,this.topOps=null}r.prototype.backward=function(){for(var e=this.operates.length-1;e>=0;e--){var t=this.operates[e];t.obj.backward(t),t.obj._fireChanged(t)}},r.prototype.forward=function(){for(var e=this.operates.length,t=0;t<e;t++){var n=this.operates[t];window.g_rpt.delayLoadObj.has(n.obj)||(n.obj.forward(n),n.obj._fireChanged(n))}},r.prototype.swapExtObjRanges=function(e){var t=window.g_rpt;if(null!=this.extRanges&&null!=t.getTransDepositedContainer()){var n=this;t.getTransDepositedContainer().transDepositedGetArray().forEach((function(t){if(null==t.transDepositedInstall||null==t.transDepositedClone)console.error("ext object not transDepositedInstall or  transDepositedClone function");else{var i=n.extRanges.get(t);null!=i&&t.transDepositedInstall(e?i.beginRgs:i.endRgs,n,e)}}))}},r.prototype.rollback=function(){this.complete(),this.backward(!0)},r.prototype.complete=function(){var e=this;this.newObjects.forEach((function(e){e.__isNew=!1,e.__modify=!1})),this.newObjects=null,this.modifyObjects.forEach((function(e){e.__isNew=!1,e.__modify=!1})),this.modifyObjects=null;var t=this.customOp;delete this.customOp,t.forEach((function(t,n){var i=[],o=!1;t.forEach((function(e){e instanceof Array?e.forEach((function(e){i.push(e),o=!0})):i.push(e)})),i=o?i:t,e.operates.push({obj:n,opType:a.default.otModify,data:i})}))},r.prototype.backwardTopObj=function(){if(null!=this.topOps)for(var e=this.topOps.length,t=0;t<e;t++){var n=this.topOps[t];n.obj.backward(n)}},r.prototype.beginExtObjects=function(e){if(null!=e){this.extRanges=new Map;var t=this;e.forEach((function(e){var n=e.transDepositedClone();null!=n&&t.extRanges.set(e,{beginRgs:n,endRgs:null})}))}},r.prototype.commitExtObjects=function(e){if(null!=e&&void 0!==this.extRanges){var t=this;e.forEach((function(e){var n=e.transDepositedClone();if(null!=n){var i=t.extRanges.get(e);null!=i&&(i.endRgs=n)}}))}},r.prototype.mergeExtObjects=function(e,t){if(null!=e&&void 0!==t.extRanges&&void 0!==this.extRanges){var n=this;e.forEach((function(e){var i=t.extRanges.get(e),o=n.extRanges.get(e);null!=i&&null!=o&&(o.endRgs=i.endRgs)}))}},r.prototype.isLocalTransact=function(){return this.isLocal},r.prototype.getDataVersion=function(){return this.dataVersion},r.prototype.setDataVersion=function(e){this.dataVersion=e},r.prototype.setSrcCommand=function(e){this.command.srcCommand=e},r.prototype.getSrcCommand=function(e){return this.command.srcCommand},r.prototype.addCommand=function(e){this.command.cmds.push(e)},r.prototype.addCommand=function(e){return this.command.cmds},r.prototype.addMainObjectOperates=function(e,t){return!(!e.isMainObject()||0==t.length)&&(this.mainOperstes[e.getObjID()]=t,!0)},r.prototype.getMainObjectOperates=function(e){return this.mainOperstes[e]},r.prototype.registerNewObject=function(e){e.__isNew=!0,this.newObjects.push(e)},r.prototype.addDataNotify=function(e){if(!e.__isNew&&!e.__modify){e.__modify=!0,this.modifyObjects.push(e);var t={};s(e.private,t),this.addRelaceDataOp(e,t)}},r.prototype.addRelaceDataOp=function(e,t){if(!e.__isNew){var n={obj:e,opType:a.default.otReplaceData,data:t};this.operates.push(n),e._fireChanged(n)}},r.prototype.addVectorOp=function(e,t,n,i,o,a){if(!e.__isNew){var r={obj:e,opType:t,pos:n,data:i};null!=o&&(r.oldData=o),null!=a&&(r.offset=a),this.operates.push(r),e._fireChanged(r)}},r.prototype.addCustomOp=function(e,t){e.__isNew||(this.customOp.has(e)||this.customOp.set(e,[]),this.customOp.get(e).push(t),e._fireChanged({obj:e,data:t}))},r.prototype.addServerOperate=function(e){this.operates.push(e)};var s=function e(t,n){n=n||{};for(var i in t)if(null===t[i])n[i]=t[i];else if("object"===o()(t[i])){var a=t[i].constructor;n[i]=a===Array?[]:{},a===Object&&a===Array?e(t[i],n[i]):n[i]=t[i]}else n[i]=t[i];return n};t.a=r},3077:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(410),l=n(310),u=function(){function e(t,n,i){o()(this,e),this.init(t,n,i)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:l.ITRange,methodName:"init"},{baseName:"ITRange",base:l.ITRange,methodName:"onExpand"},{baseName:"ITRange",base:l.ITRange,methodName:"onRemove"}]}}]),r()(e,[{key:"init",value:function(e,t,n){this.mixin_ITRange_init(e,t),this.line=n}},{key:"onExpand",value:function(e,t,n){var i=this.line.view.data.doc;if(3===this.line.layoutType&&i.useCoreTypo&&(e<this._relativeEnd||e==this._relativeEnd&&n===l.IT.Exclude)){var o=Math.max(e-this._relativeBegin,0);this.line.zones&&this.line.zones.forEach((function(e){if(!e.isTextPartZone){var n=e.partRangePos,i=e.typoRange.len;o>n+i||(0!==o&&o<=n?(e.typoRange.pos+=t,e.partRangePos+=t):e.typoRange.len+=t)}}))}this.mixin_ITRange_onExpand(e,t,n)}},{key:"onRemove",value:function(e,t){var n=this.line.view.data.doc;if(3===this.line.layoutType&&n.useCoreTypo){var i=l.IT.lengthOfIntersect(e,t,this._relativeBegin,this._relativeEnd);if(i>0){var o=Math.max(e-this._relativeBegin,0),a=[];this.line.zones&&this.line.zones.forEach((function(e){if(e.isTextPartZone)a.push(e);else{var t={pos:e.partRangePos,len:e.typoRange.len};if(o>=t.pos+t.len)a.push(e);else if(o<=t.pos&&t.pos+t.len<=o+i);else if(t.pos>=o+i)e.typoRange.pos-=i,e.partRangePos-=i,a.push(e);else{var n=l.IT.lengthOfIntersect(o,o+i,t.pos,t.pos+t.len);e.typoRange.len-=n,a.push(e)}}})),this.line.zones=a}}this.mixin_ITRange_onRemove(e,t)}},{key:"toString",value:function(){return"["+this.begin+", "+this.end+")"}}]),e}();t.a=u,s.a.mix(u,l.ITRange)},3078:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return s}));var i={Typo_caTop:0,Typo_caMiddle:1,Typo_caBottom:2,Typo_caGenkoVertical:3,Typo_caGenkoHorizontal:4,Typo_caFixedTop:5,Typo_caFixedMiddle:6,Typo_caFixedBottom:7,Typo_caMinBottom:8},o={Typo_GridMode_None:0,Typo_GridMode_CharAndLine:1,Typo_GridMode_LineOnly:2,Typo_GridMode_SnapText:3},a={RowHeightRule_Auto:0,RowHeightRule_AtLeast:1,RowHeightRule_Exact:2},r={TypoJustificationModeExpand:0,TypoJustificationModeCompress:1,TypoJustificationModeCompressKana:2,TypoJustificationModeMax:3},s={MAX_LINE_WIDTH:65535,MAX_LINE_HEIGHT:65535,MAX_PAGE_WIDTH:65535,MAX_PAGE_HEIGHT:1073741823.5,MAX_FRAME_TABLE_PAGE_HEIGHT:63487,MIN_LAYOUT_PAGE_WIDTH:15,MIN_LAYOUT_PAGE_HEIGHT:15,INVALID_INDEX:2147483647,AUTONUM_MAX_LEVEL:9,MIN_SUBLINE_WIDTH:360,MIN_SUBLINE_WIDTH_97:259,MIN_TIGHT_SUBLINE_WIDTH:180,MIN_TEXTFRAMEWRAPED_SUBLINE_WIDTH:1440,MIN_WRAPTABLE_SUBLINE_WIDTH:385,INVALID_GLYPHPOOL_INDEX:4294967295,MAX_GLYPHPOOL_PIECES_COUNT:1024,DEFAULT_FRAME_LINE_WIDTH:181}},3079:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i=0,o=1},308:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i={arrayTag:"[object Array]",boolTag:"[object Boolean]",dateTag:"[object Date]",funcTag:"[object Function]",numberTag:"[object Number]",objectTag:"[object Object]",stringTag:"[object String]",symbolTag:"[object Symbol]"},o={FUNC_ERROR_TEXT:"need function",ARRAY_ERROR_TEXT:"need array",ARRAYObj_ERROR_TEXT:"need obj or array"}},3080:function(e,t,n){"use strict";n.r(t),n.d(t,"USE_HEIGHT_WAY",(function(){return _})),n.d(t,"getRangesPath",(function(){return y})),n.d(t,"getUnderlinePath",(function(){return b})),n.d(t,"getRangesRects",(function(){return P})),n.d(t,"rects2LinePath",(function(){return I})),n.d(t,"rects2Path",(function(){return E})),n.d(t,"getTextPageByRanges",(function(){return x})),n.d(t,"renderFindHightlight",(function(){return R})),n.d(t,"renderRecordHighlight",(function(){return N})),n.d(t,"renderSelection",(function(){return A})),n.d(t,"renderActiveOMath",(function(){return D})),n.d(t,"renderSpellCheck",(function(){return M})),n.d(t,"getCellSelectionRect",(function(){return F})),n.d(t,"findSvgNode",(function(){return B})),n.d(t,"renderCommentCard",(function(){return H})),n.d(t,"renderCommentParagraph",(function(){return G})),n.d(t,"renderCommentUnderline",(function(){return W})),n.d(t,"renderColorBlock",(function(){return j})),n.d(t,"renderShapeSelection",(function(){return U})),n.d(t,"renderPath",(function(){return X})),n.d(t,"renderSingleLinePath",(function(){return q})),n.d(t,"renderWavyPathUsingPattern",(function(){return J})),n.d(t,"getNodePathToTextPageWithSvgNode",(function(){return Q})),n.d(t,"renderPathWithNodePath",(function(){return $}));var i=n(8),o=n.n(i),a=n(310),r=n(167),s=n(1807),l=n(2011),u=n(723),c=n(400),h=n(3081),d=n(2699),p=n(1032),f=n(1733),g=n(772),v=n(1591),m=n(6116),_={TEXT_HEIGHT:1,LINE_HEIGHT:2,DEFAUL_HEIGHT:3,LINE_TEXT_HEIGHT:4,LINE_CONTENT_HEIGHT:5};function y(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_.LINE_HEIGHT,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!e||e.length<0)return null;var r=P(e,t,!1,n,i,o);return r?(0!==a&&r.forEach((function(e){e.offset(0,a)})),o===_.DEFAUL_HEIGHT?I(r):E(r)):null}function b(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_.LINE_HEIGHT,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!e||e.length<0)return null;var r=P(e,t,!1,n,i,o);return r&&0!==a&&r.forEach((function(e){e.offset(0,a)})),I(r)}function T(e,t){var n=t[e],i=t[e+1];return!i||i.beginOffset!==n.beginOffset}function C(e,t,n){var i=t.baseline,o=t.metrics,a=t.top,r=t.bottom,s=t.line;if(n&&n.zone.type===v.b.TwoLinesInOne){var l=n.zone;switch(e){case _.LINE_TEXT_HEIGHT:var u=i-s.strongAscent;return l.getLineDrawTop(n,u);case _.LINE_CONTENT_HEIGHT:var c=i-s.textHeight+s.strongDescent;return l.getLineDrawTop(n,c);case _.TEXT_HEIGHT:return l.getDrawBaseline(i,n,!0)-o.ascent;case _.DEFAUL_HEIGHT:return l.getLineDrawBottom(n,r)-1;default:return l.getLineDrawTop(n,a)}}else switch(e){case _.LINE_TEXT_HEIGHT:return i-s.strongAscent;case _.LINE_CONTENT_HEIGHT:return i-s.textHeight+s.strongDescent;case _.TEXT_HEIGHT:return i-o.ascent;case _.DEFAUL_HEIGHT:return r-1;default:return a}}function k(e,t,n){var i=t.baseline,o=t.metrics,a=t.bottom,r=t.line;if(n&&n.zone.type===v.b.TwoLinesInOne){var s=n.zone;switch(e){case _.LINE_TEXT_HEIGHT:case _.LINE_CONTENT_HEIGHT:var l=i+r.strongDescent;return s.getLineDrawBottom(n,l);case _.TEXT_HEIGHT:case _.DEFAUL_HEIGHT:return s.getDrawBaseline(i,n,!0)+o.descent;default:return s.getLineDrawBottom(n,a)}}else switch(e){case _.LINE_TEXT_HEIGHT:case _.LINE_CONTENT_HEIGHT:return i+r.strongDescent;case _.TEXT_HEIGHT:case _.DEFAUL_HEIGHT:return i+o.descent;default:return a}}function w(e,t,n,i,o,a,r,s,l){if(e!==t){if(n&&(i.ascent!=o.metrics.ascent||i.descent!=o.metrics.descent))return!0;if(a!=o.isLayoutRTL)return!0;if(a?r!=o.x+o.widthSum:s!=o.x)return!0;if(l!==o.zone.type&&(l===v.b.TwoLinesInOne||o.zone.type===v.b.TwoLinesInOne))return!0}return!1}var S=function(e){var t=window.APP.data.glyphpool.glyphBuff.getCharCode(e);return!!u.a.isPageBreak(t)||!!u.a.isLineBreak(t)};function P(e,t,n,i,o,a){var l=[];if(!t)return l;var h=t.lines;if(!h)return l;var d=t.range,p=e.filter((function(e){if(!(e.pos<d.pos&&e.pos+e.len<=d.pos))return!0}));if(0==p.length)return l;var g=0,v=p.length;return h.some((function(e){var h=e.range,d=h.pos,_=h.len+d;if(e instanceof s.a){if(i&&e.isInTable){var y=e.parent.parent,b=y.parent,P=y.index,I=b.range.pos,E=b.range.pos+b.range.len,O=Object(f.getFirstMergedCell)(window.APP.data.doc,I,E,P).range;if(O&&p[g].pos<=O.begin&&p[g].pos+p[g].len>=O.end)return}for(var x=function(e,t){var n=t.textflow&&t.textflow.isReverseLine,i=e.rect.top;return n&&(i=t.rect.width-e.rect.top-e.rect.height),i}(e,t),R=function(e,t){var n=t.textflow&&t.textflow.isReverseLine,i=e.rect.bottom;return n&&(i=t.rect.width-e.rect.top),i}(e,t),N=e.sublines,A=N?N.length:0,D=0;g<v&&p[g].pos<_;){for(;D<A&&(N[D].range.len<=0||N[D].range.pos+N[D].range.len<=p[g].pos||!N[D].glyphGroupInfos);)++D;if(A>0&&D>=A)break;var M=D<A?N[D].glyphGroupInfos:e.glyphGroupInfos,L=p[g].pos,F=L+p[g].len,B=D<A?N[D].range.pos:d,H=D<A?B+N[D].range.len:_,G=void 0,W=void 0;if(F<B||!M)break;if(n){var j=x+e.baseline;if(L>=B){var U=Object(m.a)(L-B,M),Y=U.pos,z=U.glyphGroupInfo,K=z.fontMetrics||z.metrics,Z=k(a,{baseline:j,metrics:K,bottom:R,line:e}),X=C(a,{baseline:j,metrics:K,top:x,bottom:Z,line:e});G=Y,l.push(c.a.initByRawRect({left:G,right:G+1,top:X,bottom:Z}))}if(F<=H){var q=void 0;if(F==H){var J=M[M.length-1];q=J.fontMetrics||J.metrics,W=J.x+J.widthSum}else{var Q=Object(m.a)(F-B,M),$=Q.pos,ee=Q.glyphGroupInfo;q=ee.fontMetrics||ee.metrics,W=$}var te=k(a,{baseline:j,metrics:q,bottom:R,line:e}),ne=C(a,{baseline:j,metrics:q,top:x,bottom:te,line:e});l.push(c.a.initByRawRect({left:W,right:W+1,top:ne,bottom:te})),++g}else++D}else{var ie=M.length,oe=x+e.baseline,ae=Object(m.a)(Math.max(0,L-B),M),re=ae.index,se=ae.pos,le=ae.glyphGroupInfo,ue=!le.oMath&&(le.fontMetrics||le.metrics),ce=le.isLayoutRTL,he=le.zone.type,de=re;for(ce?W=se:G=se;de<ie;)if((le=M[de]).metrics){var pe=le.oMath&&!S(le.endOffset+B-1)&&le.oMath;if(ue){if(pe||w(re,de,a,ue,le,ce,G,W,he)){var fe=M[de-1],ge=k(a,{baseline:oe,metrics:ue,bottom:R,line:e},fe),ve=C(a,{baseline:oe,metrics:ue,bottom:ge,top:x,line:e},fe);l.push(c.a.initByRawRect({left:G,right:W,top:ve,bottom:ge})),ue=le.fontMetrics||le.metrics,ce=le.isLayoutRTL,he=le.zone.type,ce?W=le.x+le.widthSum:G=le.x}}else pe||(ue=le.fontMetrics||le.metrics,ce=le.isLayoutRTL,he=le.zone.type,ce?W=le.x+le.widthSum:G=le.x);if(pe){var me=pe.locateRect(L-B-le.beginOffset,F-L),_e=le.y+e.baseline-pe.baseline+me.y,ye=me.height;if(pe.isText)ye=e.rect.height,_e=le.y;else if(ye>=pe.height){var be=k(a,{baseline:oe,metrics:ue,bottom:R,line:e},le);ye=be-(_e=C(a,{baseline:oe,metrics:ue,bottom:be,top:x,line:e},le))}if(l.length>0){var Te=l[l.length-1];if(Te.bottom<=le.y)l.push(c.a.initByOriginAndSize({x:le.x+me.x,y:_e},{width:me.width,height:ye}));else{var Ce=Math.min(Te.left,le.x+me.x),ke=Math.max(Te.right,le.x+me.x+me.width),we=Math.min(Te.top,_e),Se=Math.max(Te.bottom,_e+me.height);l[l.length-1]=c.a.initByOriginAndSize({x:Ce,y:we},{width:ke-Ce,height:Se-we})}}else l.push(c.a.initByOriginAndSize({x:le.x+me.x,y:_e},{width:me.width,height:ye}));ue=null}if(!(F>=le.endOffset+B)){ce?G=V(F-B,le):W=V(F-B,le);break}if(ce?G=le.x:W=le.x+le.widthSum,F==le.endOffset+B&&T(de,M))break;++de}else++de;if(ue){if(!o){var Pe=window.APP.data.glyphpool.glyphBuff.getCharCode(le.endOffset+B-1);u.a.isPageBreak(Pe)?ce?G=r.isMobile&&!window.APP.isEditMode?G-8:e.rect.left:W=r.isMobile&&!window.APP.isEditMode?W+8:e.rect.right:u.a.isLineBreak(Pe)&&(ce?G-=8:W+=8)}var Ie=k(a,{baseline:oe,metrics:ue,bottom:R,line:e},le),Ee=C(a,{baseline:oe,metrics:ue,bottom:Ie,top:x,line:e},le);l.push(c.a.initByRawRect({left:G,right:W,top:Ee,bottom:Ie}))}F>=H?++D:++g}if(F==H){if(1===M.length&&M[0].oMath&&M[0].oMath.repeatOpLen)break;if(e.zoneExceed)break;++g}else if(D>=A&&F>_)break}}else for(;g<v&&p[g].pos+p[g].len<=_;)++g;if(g>=v)return!0})),l}function I(e){for(var t=[],n=0;n<e.length;++n){var i=e[n],o=[];o.push({x:i.left,y:i.bottom}),o.push({x:i.right,y:i.bottom}),t.push(o)}return t}function E(e){if(null==e||0===e.length)return[];var t=e.filter((function(e){return e.right>e.left&&e.bottom>e.top})),n=function(e){var t=z(e),n=[];return t.forEach((function(e,i){if(void 0===e.adj_top&&void 0===e.adj_bottom);else if(0===e.adj_top.length&&0===e.adj_bottom.length)n.push([e]);else{var o=[];!function e(n,i){if(void 0!==t[i].adj_top||void 0!==t[i].adj_bottom){n.push(t[i]);var o=[];t[i].adj_top&&(o=o.concat(t[i].adj_top),t[i].adj_top=void 0),t[i].adj_bottom&&(o=o.concat(t[i].adj_bottom),t[i].adj_bottom=void 0),o.forEach((function(t){e(n,t)}))}}(o,i),n.push(o)}})),n}(t=function(e){var t=!1,n=function(e,t){var n=c.a.initByRawRect(t);return n.top=e.bottom,t.bottom=e.bottom,n},i=e;do{t=!1,i=Y(i);for(var o=0;o<i.length;++o){for(var a=o+1;a<i.length;++a)if(Math.abs(i[a].top-i[o].top)<.001&&Math.abs(i[a].left-i[o].right)<.001){if(Math.abs(i[o].bottom-i[a].bottom)>.001){i[o].bottom>i[a].bottom?i.push(n(i[a],i[o])):i.push(n(i[o],i[a])),t=!0;break}i[o].right=i[a].right,i.splice(a,1),--a}if(t)break}}while(t);return i}(t)),i=[];return n.forEach((function(e){var t=function(e){var t=[];return Z(t,e,0),function(e){for(var t=0;t<e.length;++t){for(var n=1,i=t+1;i<e.length&&(e[i].x===e[t].x&&e[i].y===e[t].y);++i)++n;n>1&&(e.splice(t,n),--t)}}(t),t}(z(e));i.push(t)})),i}function O(e){for(var t=e.parent;t&&!(t instanceof p.d);)t=t.parent;return t}function x(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.textLineRanges,o=new Set;return e.forEach((function(e){!e.len&&n||i.mapInRange(e.pos,e.pos+e.len,(function(e){return e._node.line}),a.IT.strictIntersectTest).forEach((function(e){if(!e.isFrameLine){var t=O(e);t&&!o.has(t)&&o.add(t)}}))})),o}function R(e,t){X(e,t,h.k.naked_color.color)}function N(e,t){X(e,t,h.t.naked_color.color)}function A(e,t){var n=null;if(window.APP.data.selection.selectionComposingRenderCheck()&&(window.APP.isPCMode()||window.APP.isWebMode()))return q(e,t,(n=h.r).naked_color.color);n=window.APP.data.selection.selContext.isParagraphSetting?h.s:r.isMobile?h.p:h.q,X(e,t,window.APP.isInkMode&&window.APP.appApi.getInkPencilType()===d.d.HIGHLIGHTER?window.APP.appApi.getInkPencilParams().hightLightColor:n.naked_color.color)}function D(e,t){X(e,t,"rgba(85, 165, 255, 0.1)")}function M(e,t,n){return J(e,t,n,h.w.naked_color.color)}function L(e){for(var t=e.rect.left,n=e.rect.right,i=e.parent,o=i.parent.lines,a=e,r=o.indexOf(i)+1,s=o.length;r<s;++r){var u=o[r];if(!(u instanceof l.a))break;for(var c=u.tablecells,h=!1,d=0,p=c.length;d<p;++d){var f=c[d];if(!(f.rect.right<=t||f.rect.left>=n)&&(f.merge_type&&f.merge_type!==g.e.NONE)){f.merge_type===g.e.LAST&&(h=!0),a=f;break}}if(h)break}return a}function F(e,t){var n=c.a.ZERO(),i=e.index,o=e.parent,a=o.range.pos,r=o.range.pos+o.range.len,s=Object(f.getNestedCells)(window.APP.data.doc,a,r,i);if(!s.length)return n;for(var l=void 0,u=0;u<t.length;++u)for(var h=t[u],d=0;d<s.length;d++){var p=s[d].range,v=p.begin,m=p.end;h.len&&h.pos<=v&&h.pos+h.len>=m&&(l=d)}if(0===l){var _=e.rect,y=_.top,b=_.left,T=_.width,C=_.height;y+=o.rect.top,b+=o.rect.left;var k=e.merge_type;if(k===g.e.FIRST){var w=L(e);if(w&&w.parent)C=w.parent.rect.bottom-o.rect.top}else if(k===g.e.MIDDLE||k===g.e.LAST)return n;n=c.a.initByRawRect({left:b,right:b+T,top:y,bottom:y+C})}return n}function B(e,t){for(var n=t.childNodes,i=0,o=n.length;i<o;++i){var a=n[i];if(a.getAttribute("id")===e)return a}return null}function H(e,t,n,i,o){var a=P(e,t,!0,!1,!1,_.TEXT_HEIGHT);if(a){var r=i.save();return i.fillStyle=n||h.c.color,a.forEach((function(e){i.fillRect(e.left,e.top+o,e.width,e.height)})),i.restore(),r}}function G(e,t,n,i){var o=n||h.c.color;t.saveAndSetAlpha(i?.5:.2);var a=t.save();return X(e,t,o),t.restoreAlpha(),t.restore(),a}function W(e,t,n){var i=t.save();return t.beginPath(),e.forEach((function(e){t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)})),t.lineWidth="1",t.strokeStyle=n,t.stroke(),t.closePath(),t.restore(),i}function j(e,t,n,i){"shadings"===n.type?(X(e,t,n.back),n.fill&&n.texture>0&&(t.saveAndSetAlpha(n.alpha),X(e,t,n.fill),t.restoreAlpha())):(n.alpha>0&&t.saveAndSetAlpha(n.alpha),X(e,t,n.color),n.alpha>0&&t.restoreAlpha())}function U(e,t){if(e){var n=e.rect,i=n.left,o=n.top,a=n.width,s=n.height,l=e.innerBoundary,u=e.renderScale;if(l&&(void 0===u&&(u=1),i+=l.left*u,o+=l.top*u,a=l.width*u,s=l.height*u),t.beginPath(),t.strokeStyle=h.v.color,t.lineWidth="2",t.rect(i-.5,o-.5,a+2,s+2),t.stroke(),r.isMobile){if(window.APP.isMobileMode()&&!e.isEmbedShape)return;!function(e,t){var n=t.left,i=t.top,o=t.width,a=t.height,r=n+o,s=i+a,l=Math.round((n+r)/2),u=Math.round((i+s)/2);[{x:n,y:i},{x:l,y:i},{x:r,y:i},{x:r,y:u},{x:r,y:s},{x:l,y:s},{x:n,y:s},{x:n,y:u}].forEach((function(t){var n=t.x,i=t.y;e.beginPath(),e.fillStyle="#fff",e.strokeStyle="rgba(0, 0, 0, 0.1)",e.lineWidth="2",e.arc(n,i,h.u,0,2*Math.PI,!0),e.fill(),e.stroke(),e.beginPath(),e.fillStyle=h.v.color,e.arc(n,i,h.u-2,0,2*Math.PI,!0),e.fill()}))}(t,{left:i,top:o,width:a,height:s})}}}function V(e,t){var n=void 0,i=t.widths,o=e-t.beginOffset;if(t.isLayoutRTL){n=t.x+t.widthSum;for(var a=0;a<o&&a<i.length;++a)n-=i[a]}else{n=t.x;for(var r=0;r<o&&r<i.length;++r)n+=i[r]}return n}function Y(e){for(var t=e.sort((function(e,t){return e.top===t.top?e.left-t.left:e.top-t.top})),n=0;n<t.length;++n){for(var i=0,o=n+1;o<t.length&&(t[o].left===t[n].left&&t[o].top===t[n].top&&t[o].right===t[n].right&&t[o].bottom===t[n].bottom);++o)i++;i>0&&t.splice(n+1,i)}return t}function z(e){for(var t=Y(e),n=0;n<t.length;++n)t[n].adj_top=[],t[n].adj_bottom=[];for(var i=function(e,t){return e.left>=t.left&&e.left<=t.right||e.right>=t.left&&e.right<=t.right},o=0;o<t.length;++o)for(var a=o+1;a<t.length;++a)t[a].top===t[o].bottom&&(i(t[o],t[a])||i(t[a],t[o]))&&(t[o].adj_bottom.push(a),t[a].adj_top.push(o));return t}function K(e,t,n){var i=t[n],o=[];i.adj_top.forEach((function(e){t[e].adj_bottom.forEach((function(e){e!==n&&o.push(e)}))})),i.adj_bottom.forEach((function(n){t[n].crossed||Z(e,t,n)})),e.push({x:i.right,y:i.bottom,rc:n}),e.push({x:i.right,y:i.top,rc:n}),t[n].crossed|=12;for(var a=0;a<o.length;++a){var r=t[o[a]];!r.crossed&&r.left>i.right&&Z(e,t,o[a])}for(var s=i.adj_top.length-1;s>=0;--s){t[i.adj_top[s]].crossed||K(e,t,i.adj_top[s])}for(var l=0;l<o.length;++l){var u=t[o[l]];!u.crossed&&u.right<i.left&&Z(e,t,o[l])}e.push({x:i.left,y:i.top,rc:n}),e.push({x:i.left,y:i.bottom,rc:n}),t[n].crossed|=3}function Z(e,t,n){if(0!==t.length){var i=t[n];if(e.push({x:i.left,y:i.top,rc:n}),e.push({x:i.left,y:i.bottom,rc:n}),t[n].crossed|=3,i.adj_bottom.forEach((function(n){for(var o=t[n],a=o.adj_top.length-1;a>=0;--a){var r=t[o.adj_top[a]];!r.crossed&&r.right<i.left&&K(e,t,o.adj_top[a])}t[n].crossed||Z(e,t,n);for(var s=0;s<o.adj_top.length;++s){var l=t[o.adj_top[s]];!l.crossed&&l.left>i.right&&K(e,t,o.adj_top[s])}})),e.push({x:i.right,y:i.bottom,rc:n}),e.push({x:i.right,y:i.top,rc:n}),t[n].crossed|=12,0===i.adj_bottom.length)for(var o=i.adj_top.length-1;o>=0;--o){t[i.adj_top[o]].crossed||K(e,t,i.adj_top[o])}}}function X(e,t,n){return t.beginPath(),e.forEach((function(e){e.forEach((function(e,n){0===n?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)}))})),t.closePath(),t.fillStyle=n,t.fill(),t.__currentElement}function q(e,t,n){t.beginPath(),e.forEach((function(e){t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)})),t.lineWidth="1.5",t.strokeStyle=n,t.stroke(),t.closePath()}function J(e,t,n,i){var o=[],a=n.getSpellCheckPattern();return t.fillStyle=a.pattern,e.forEach((function(e){var n=t.fillRect(0,0,e.width,a.renderHeight);n.setAttribute("transform","translate("+e.left+", "+(e.bottom-a.renderHeight/2)+")"),o.push(n)})),o}function Q(e){for(var t=[e],n=e;n&&!n.svgNode;)n=n.parent,t.push(n);return t.reverse()}function $(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(a>=n.length)return i.apply(void 0,o()(e));var r=n[a];if(r instanceof g.c){var s=t.save(),l=r,u=l.parent,c=l.rect,h=c.top,d=c.left,f=c.width,v=c.height;h+=u.rect.top,d+=u.rect.left;var m=l.merge_type;if(m===g.e.FIRST){var _=L(l);if(_&&_.parent){var y=_.parent;v=y.rect.bottom-u.rect.top}}t.clipRect(d,h,f,v);var b=l.offset4child;return t.translate(Math.round(d+(b?b.x:0)),Math.round(h+(b?b.y:0))),$(e,t,n,i,a+1),t.restore(),s}if(r instanceof p.d){var T=t.save(),C=r,k=C.coororigin_pos2parent||C.position2parent||{x:0,y:0},w=C.textflow,S=w.rotate,P=w.scale;return t.translate(Math.round(k.x),Math.round(k.y)),t.rotate(S),t.scale(P.x,P.y),$(e,t,n,i,a+1),t.restore(),T}return $(e,t,n,i,a+1)}},3081:function(e,t,n){"use strict";n.d(t,"p",(function(){return o})),n.d(t,"q",(function(){return a})),n.d(t,"r",(function(){return r})),n.d(t,"s",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"v",(function(){return u})),n.d(t,"k",(function(){return c})),n.d(t,"t",(function(){return h})),n.d(t,"u",(function(){return d})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return f})),n.d(t,"h",(function(){return g})),n.d(t,"g",(function(){return v})),n.d(t,"f",(function(){return m})),n.d(t,"l",(function(){return _})),n.d(t,"j",(function(){return y})),n.d(t,"i",(function(){return b})),n.d(t,"m",(function(){return T})),n.d(t,"a",(function(){return C})),n.d(t,"b",(function(){return k})),n.d(t,"D",(function(){return w})),n.d(t,"C",(function(){return S})),n.d(t,"B",(function(){return P})),n.d(t,"y",(function(){return I})),n.d(t,"A",(function(){return E})),n.d(t,"x",(function(){return O})),n.d(t,"E",(function(){return x})),n.d(t,"z",(function(){return R})),n.d(t,"o",(function(){return N})),n.d(t,"w",(function(){return A})),n.d(t,"n",(function(){return D}));var i=n(1403),o=i.a.initWithCustomColor("rgba(85, 165, 255, 0.5)"),a=i.a.initWithCustomColor("rgba(85, 165, 255, 0.5)"),r=i.a.initWithCustomColor("rgb(0, 0, 0)"),s=i.a.initWithCustomColor("rgba(0, 0, 0, 0)"),l=i.a.initWithCustomColor("#EFEA38"),u=i.a.initWithCustomColor("#4989ea"),c=i.a.initWithCustomColor("#ffff00"),h=i.a.initWithCustomColor("#AAD2FF"),d=5,p=i.a.initWithCustomColor("#4882e5"),f=.2,g=1,v=.4,m=[9,4],_=i.a.initWithCustomColor("rgba(62, 128, 236, 1)"),y=i.a.initWithCustomColor("#e5e7ef"),b=i.a.initWithCustomColor("#d3d3d3"),T=1,C=i.a.initWithCustomColor("#E2E6ED"),k=1,w=12,S=1,P=i.a.initWithCustomColor("#ebebeb"),I=i.a.initWithCustomColor("#417ff9"),E=i.a.initWithCustomColor("#fafafa"),O=i.a.initWithCustomColor("#c1d6fa"),x=i.a.initWithCustomColor("#969696"),R=i.a.initWithCustomColor("#417ff9"),N=i.a.initWithCustomColor("#4991F2"),A=i.a.initWithCustomColor("#FF0000"),D=7},3082:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var i={PureArabic:0,DashArabic:1,UCRoman:2,ArabicNumChnOrder:3,ArabicNumChnOrder2:4,ChnNumChnOrder:5,ChnNumChnOrder2:6,ChnDbNum1:7,LineArabic:8,DbChar:9,GB3:10,ChnDbNum2:11,LCRoman:12,UCLetter:13,LCLetter:14,Zodiac1:15,Zodiac2:16,DbNum3:17,DAiueo:18,DIroha:19,Ordinal:20,Cardtext:21,Ordtext:22,SlashArabic:23},o={Left:0,Center:1,Right:2,Inside:3,OutSide:4},a={CurrentPage:0,ToCurrentPage:1,FromCurrentPage:2,CurrentSection:3,All:4},r={Header:0,Footer:1,HeaderAndFooter:2}},309:function(e,t,n){"use strict";n.r(t),n.d(t,"MainText",(function(){return i})),n.d(t,"Footnote",(function(){return o})),n.d(t,"HeaderFooter",(function(){return a})),n.d(t,"Macro",(function(){return r})),n.d(t,"Comment",(function(){return s})),n.d(t,"Endnote",(function(){return l})),n.d(t,"Textbox",(function(){return u})),n.d(t,"TextboxInHF",(function(){return c}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7},310:function(e,t,n){"use strict";n.r(t),n.d(t,"IT",(function(){return y})),n.d(t,"Range",(function(){return C})),n.d(t,"ITHintVTProto",(function(){return K})),n.d(t,"ITPoint",(function(){return Z})),n.d(t,"ITRange",(function(){return X})),n.d(t,"IntervalTree",(function(){return q})),n.d(t,"ITHintVT",(function(){return ge})),n.d(t,"ITExpander",(function(){return Q})),n.d(t,"ITRemover",(function(){return $})),n.d(t,"ITDeleteRemover",(function(){return ee})),n.d(t,"ITSortRemover",(function(){return te})),n.d(t,"ITSortDeleteRemover",(function(){return ne})),n.d(t,"ITExtract",(function(){return ie})),n.d(t,"ITFindHandler",(function(){return oe})),n.d(t,"BeginWithKeyword",(function(){return ce})),n.d(t,"EndWithKeyword",(function(){return he})),n.d(t,"PointKeyword",(function(){return de})),n.d(t,"RangeKeyword",(function(){return pe})),n.d(t,"ITToolkit",(function(){return fe}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1168),l=n(952),u=n(410),c=n(1319);function h(e,t){return e.begin<=t.begin&&t.end<=e.end}function d(e){return e._node}function p(e,t){e.begin=Math.min(e.begin,t.begin),e.end=Math.max(e.end,t.end)}function f(e,t){e.begin=t.begin,e.end=t.end,e.node=t._node}var g={begin:0,end:0};function v(e){return g.begin=e.begin,g.end=e.end,g}function m(e,t){var n=e.begin,i=t.begin;return n===i?e.end-t.end:n-i}function _(e,t){return e.begin-t.begin}m.extractFast=v,_.extractFast=v;var y={Exclude:0,Include:1,lower:0,upper:1,outer:2,inner:3,outerupper:4,NonIntersect:0,Nesting:1,Crossing:2,lengthOfIntersect:function(e,t,n,i){return n<t&&e<i?Math.min(t,i)-Math.max(e,n):0},mapToNode:d,mapToRange:function(e){return{begin:e.begin,end:e.end}},mapToRangeAndNode:function(e){return{begin:e.begin,end:e.end,node:e._node}},calcBoundary:p,calcRange:function(e,t){e.begin=t.begin,e.end=t.end},calcRangeAndNode:f,sortbyRange:m,sortbyPoint:_,getMinOverLapRegion:function(e,t,n,i){var o=Math.max(e,n),a=Math.min(t,i);return{begin:o,end:a,pos:o,len:a-o}},containTest:h,intersectTest:function(e,t){return t.begin<=e.end&&e.begin<=t.end},strictContainTest:function(e,t){return t.begin===t.end?e.begin===t.begin||e.begin<t.begin&&t.begin<e.end:h(e,t)&&(e.begin!==t.begin||e.end!==t.end)},strictIntersectTest:function(e,t){return e.begin===t.end||e.end===t.begin?(e.begin===e.end||t.begin===t.end)&&e.begin===t.begin:t.begin<e.end&&e.begin<t.end},endWithTest:function(e,t){return e.end===t.end},containEndTest:function(e,t){return e.begin<t.end&&t.end<=e.end}},b=[y.Exclude,y.Include,y.Include,y.Exclude,y.Include],T=[y.Exclude,y.Include,y.Exclude,y.Include,y.Exclude],C=function(){function e(t,n){o()(this,e),this.begin=t,this.end=n}return r()(e,[{key:"init",value:function(e,t){this.begin=e,this.end=t}},{key:"isContain",value:function(e){return this.begin<=e&&e<this.end}},{key:"toString",value:function(){return"["+this.begin+", "+this.end+")"}},{key:"pos",get:function(){return this.begin}},{key:"len",get:function(){return this.end-this.begin}}]),e}(),k=c.d.rbhintvt_beHint,w=c.d.rbhintvt_good,S=c.d.rbhintvt_moveUp,P=c.d.rbhintvt_moveLeft;function I(e,t,n){this._node=e,this._tree=t,this._originPosition=n||0}function E(){this._node=null,this._tree=null}function O(){W(this)}function x(){j(this)}function R(){return ge.make(this._node,this._tree,this._originPosition)}function N(){return this._originPosition+this._node._relativeBegin}function A(){return this._originPosition+this._node._relativeEnd}function D(){return this._originPosition+this._node._relativeBegin}function M(){return this._node.len}function L(){return this._originPosition+this._node._relativeLimit}function F(e){k(e),Object.defineProperties(e,{init:{value:I},term:{value:E},movePrev:{value:O},moveNext:{value:x},clone:{value:R},begin:{get:N},end:{get:A},pos:{get:D},len:{get:M},limitPos:{get:L}})}function B(e,t,n){var i={};return F(i),i.init(e,t,n),i}function H(e){e._node.isLeft()?e._node=e._node._parent:(e._node=e._node._parent,e._originPosition-=e._node._relativeBegin)}function G(e){null===e._node._right?(e._node=e._tree,e._originPosition=0):(e._originPosition+=e._node._relativeBegin,e._node=e._node._right)}function W(e){if(null===e._node._left){for(;e._node.isLeft();)S(e);S(e),e._originPosition-=e._node._relativeBegin}else for(P(e);null!==e._node._right;)G(e)}function j(e){if(null===e._node._right){for(;e._node.isRight();)S(e),e._originPosition-=e._node._relativeBegin;S(e)}else for(G(e);null!==e._node._left;)P(e)}function U(e){e._node=e._tree,e._originPosition=0}function V(e,t){e._node=t._node,e._tree=t._tree,e._originPosition=t._originPosition}function Y(e){return ge.make(e._node,e._tree,e._originPosition)}function z(e){return"["+e.begin+", "+e.end+"]"}function K(){var e=new c.d;return e.beHint=F,e.newobj=B,e.moveUp=H,e.moveRight=G,e.movePrev=W,e.moveNext=j,e.stop=U,e.copy=V,e.clone=Y,e.toString=z,e}K.ithintvt_beHint=F,K.ithintvt_good=w,K.ithintvt_moveUp=H,K.ithintvt_moveLeft=P,K.ithintvt_moveRight=G,K.ithintvt_movePrev=W,K.ithintvt_moveNext=j,K.ithintvt_stop=U,K.ithintvt_copy=V,K.ithintvt_clone=Y,K.ithintvt_toString=z;var Z=function(){function e(t){o()(this,e),this.init(t)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"RBNode",base:c.e,methodName:"init"},{baseName:"RBNode",base:c.e,methodName:"orphan"}]}}]),r()(e,[{key:"init",value:function(e){this.mixin_RBNode_init(),this._relativeBegin=e,this._limitDistance=0}},{key:"reset",value:function(e){this.mixin_RBNode_init(),this._relativeBegin=e,this._limitDistance=0}},{key:"orphan",value:function(){this.mixin_RBNode_orphan(),this._limitDistance=0}},{key:"offsetBegin",value:function(e){this._relativeBegin+=e}},{key:"expandLimit",value:function(e){this._limitDistance+=e}},{key:"onExpand",value:function(e,t,n){}},{key:"onRemove",value:function(e,t){}},{key:"toString",value:function(){return"["+this.pos+"})"}},{key:"begin",get:function(){return this._originPosition+this._relativeBegin}},{key:"end",get:function(){return this._originPosition+this._relativeBegin}},{key:"pos",get:function(){return this._originPosition+this._relativeBegin}},{key:"len",get:function(){return 0}},{key:"_relativeEnd",get:function(){return this._relativeBegin}},{key:"_relativeLimit",get:function(){return this._relativeBegin+this._limitDistance}},{key:"_originPosition",get:function(){var e=this,t=this._parent,n=0;if(t)for(;e!==t;e=t,t=t._parent)e!==t._left&&(n+=t._relativeBegin);return n}}]),e}(),X=function(){function e(t,n){o()(this,e),this.init(t,n)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITPoint",base:Z,methodName:"init"},{baseName:"ITPoint",base:Z,methodName:"orphan"}]}}]),r()(e,[{key:"init",value:function(e,t){this.mixin_ITPoint_init(e),this._upperDistance=t-e,this._limitDistance=this._upperDistance}},{key:"reset",value:function(e,t){this.mixin_ITPoint_init(e),this._upperDistance=t-e,this._limitDistance=this._upperDistance}},{key:"orphan",value:function(){this.mixin_ITPoint_orphan(),this._limitDistance=this._upperDistance}},{key:"onExpand",value:function(e,t,n){(e<this._relativeEnd||e===this._relativeEnd&&n===y.Exclude)&&(this._upperDistance+=t)}},{key:"onRemove",value:function(e,t){var n=y.lengthOfIntersect(e,t,this._relativeBegin,this._relativeEnd);this._upperDistance-=n}},{key:"toString",value:function(){return"["+this.begin+", "+this.end+")"}},{key:"end",get:function(){return this.begin+this._upperDistance}},{key:"len",get:function(){return this._upperDistance}},{key:"_relativeEnd",get:function(){return this._relativeBegin+this._upperDistance}}]),e}(),q=function(){function e(t){o()(this,e),this.init(t)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"RBTree",base:c.h,methodName:"init"},{baseName:"RBTree",base:c.h,methodName:"adoptAsLeft"},{baseName:"RBTree",base:c.h,methodName:"adoptAsRight"},{baseName:"RBTree",base:c.h,methodName:"removeNode"},{baseName:"RBTree",base:c.h,methodName:"rotateLeft"},{baseName:"RBTree",base:c.h,methodName:"rotateRight"},{baseName:"RBTree",base:c.h,methodName:"swap"}]}}]),r()(e,[{key:"init",value:function(e){this.mixin_RBTree_init(e)}},{key:"hintAtNode",value:function(e,t){e.init(t,this,t._originPosition)}},{key:"makeHintAtNode",value:function(e){return this.HintVT.make(e,this,e._originPosition)}},{key:"adoptAsLeft",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.mixin_RBTree_adoptAsLeft(e,t);var i=e._parent;if(e!==i){var o=n?0:e._originPosition,a=e._relativeLimit,r=0;for(t&&(r=t._relativeEnd-o,t._relativeBegin-=o);a<r&&(e._limitDistance+=r-a,t=e,(e=i)!==(i=i._parent));)a=e._relativeLimit,t===e._right&&(r+=e._relativeBegin)}}},{key:"adoptAsRight",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.mixin_RBTree_adoptAsRight(e,t);var i=e._parent;if(e!==i){var o=n?0:e._originPosition,a=e._relativeLimit,r=0;for(t&&(r=t._relativeEnd-o,t._relativeBegin-=o+e._relativeBegin);a<r&&(e._limitDistance+=r-a,t=e,(e=i)!==(i=i._parent));)a=e._relativeLimit,t===e._right&&(r+=e._relativeBegin)}}},{key:"removeNode",value:function(e){var t=void 0,n=e._parent,i=e._originPosition,o=e._relativeBegin;if(null!==e._right)for(var a=t=e._right;a;a=a._left)a._relativeBegin+=o;else t=e._left;e===n._right?(t&&(t._relativeBegin+=n._relativeBegin),this.adoptAsRight(n,t,!0)):this.adoptAsLeft(n,t,!0),e._relativeBegin+=i,e.orphan()}},{key:"rotateLeft",value:function(e){var t=e._parent,n=t._relativeBegin,i=t._relativeEnd-n,o=t._left&&t._left._relativeLimit-n||0,a=e._left&&e._left._relativeLimit||0;e._relativeBegin+=n,t._limitDistance=Math.max(i,o,a);var r=e._relativeBegin,s=e._relativeEnd-r,l=t._relativeLimit-r,u=e._right&&e._right._relativeLimit||0;e._limitDistance=Math.max(s,l,u),this.mixin_RBTree_rotateLeft(e)}},{key:"rotateRight",value:function(e){var t=e._parent,n=e._relativeBegin,i=e._relativeEnd-n,o=t._relativeLimit-n,a=e._right&&e._right._relativeLimit||0;t._relativeBegin-=n,e._limitDistance=Math.max(i,o,a);var r=t._relativeBegin,s=t._relativeEnd-r,l=e._right&&e._right._relativeLimit-r||0,u=t._right&&t._right._relativeLimit||0;t._limitDistance=Math.max(s,l,u),this.mixin_RBTree_rotateRight(e)}},{key:"swap",value:function(e,t){var n=e._parent,i=e._left,o=e._right,a=n._originPosition,r=a,s=e._relativeBegin;e===n._right&&(r+=n._relativeBegin);var l=t._relativeBegin,u=t._relativeEnd,c=i?i._relativeLimit+r:0,h=o?o._relativeLimit+r+s:0;if(o)for(var d=r+s-l,p=o;p;p=p._left)p._relativeBegin+=d;t._color=e._color,t._limitDistance=Math.max(u,c,h)-l,t.linkToLeft(i),t.linkToRight(o),t._relativeBegin-=a,e===n._right?this.adoptAsRight(n,t,!0):this.adoptAsLeft(n,t,!0),e._relativeBegin+=r,e.orphan()}},{key:"begin",get:function(){return 0}},{key:"end",get:function(){return this._relativeEnd}},{key:"_relativeBegin",get:function(){return 0}},{key:"_relativeEnd",get:function(){return null===this._left?0:this._left._relativeLimit}},{key:"_originPosition",get:function(){return 0}}]),e}(),J=function(){function e(){o()(this,e)}return r()(e,[{key:"config",value:function(e,t){this.begin=e,this.end=t}},{key:"passWhole",value:function(e){return this.begin>e.limitPos}},{key:"passRight",value:function(e){return this.end<e.begin}}]),e}(),Q=function(){function e(){o()(this,e)}return r()(e,[{key:"config",value:function(e,t,n){this.begin=e,this.end=e,this.offsetRule=T[n],this.expandRule=b[n],this.rule=n,this.len=t}},{key:"passRight",value:function(e){var t=this.begin,n=e.begin;return(this.rule!==y.outerupper||0!==e.len||t!==n)&&(t<n||t===n&&this.offsetRule===y.Exclude)}},{key:"visit",value:function(e){var t=this.begin-e._originPosition,n=e._node;return this.rule===y.outerupper&&0===e.len&&t===n._relativeBegin||(t<n._relativeBegin||t===n._relativeBegin&&this.offsetRule===y.Exclude?n.offsetBegin(this.len):((t<n._relativeLimit||t===n._relativeLimit&&this.expandRule===y.Exclude)&&n.expandLimit(this.len),n.onExpand(t,this.len,this.expandRule))),!0}}]),e}(),$=function(){function e(t){o()(this,e),this.init(t)}return r()(e,[{key:"init",value:function(e){this.toolkit=e}},{key:"visit",value:function(e){var t=e._node,n=this.begin-e._originPosition,i=this.end-e._originPosition,o=0,a=0;return n<t._relativeBegin?i<=t._relativeBegin?(o=i-Math.max(0,n),a=0):(o=t._relativeBegin-Math.max(0,n),a=Math.min(t._relativeLimit,i)-t._relativeBegin):n<t._relativeLimit&&(a=Math.min(t._relativeLimit,i)-n),t.onRemove(n,i),t.expandLimit(-a),t.offsetBegin(-o),!0}}]),e}(),ee=function(){function e(t,n){o()(this,e),this.init(t,n)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRemover",base:$,methodName:"init"},{baseName:"ITRemover",base:$,methodName:"visit"}]}}]),r()(e,[{key:"init",value:function(e,t){this.mixin_ITRemover_init(e),this.deleteTest=t,this.deleteNodes=[]}},{key:"deleteHandle",value:function(e){return!!this.deleteTest(this,e)&&(this.deleteNodes.push(e._node),!0)}},{key:"deleteOnRemoved",value:function(){var e=this.toolkit;this.deleteNodes.forEach((function(t){e.detachNode(t)})),this.deleteNodes.length=0}},{key:"visit",value:function(e){return this.deleteHandle(e),this.mixin_ITRemover_visit(e)}}]),e}(),te=function(){function e(t){o()(this,e),this.init(t)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRemover",base:$,methodName:"init"},{baseName:"ITRemover",base:$,methodName:"visit"}]}}]),r()(e,[{key:"init",value:function(e){this.mixin_ITRemover_init(e),this.sortNodes=[]}},{key:"sortHandle",value:function(e){var t=e.begin;this.begin<=t&&t<=this.end&&this.sortNodes.push(e._node)}},{key:"sortOnRemoved",value:function(){var e=this.toolkit;2<=this.sortNodes.length&&(this.sortNodes.forEach((function(t){e.detachNode(t)})),this.sortNodes.forEach((function(t){e.attachNode(t)}))),this.sortNodes.length=0}},{key:"visit",value:function(e){return this.sortHandle(e),this.mixin_ITRemover_visit(e)}}]),e}(),ne=function(){function e(t,n){o()(this,e),this.mixin_ITDeleteRemover_init(t,n),this.mixin_ITSortRemover_init(t)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRemover",base:$,methodName:"visit"},{baseName:"ITDeleteRemover",base:ee,methodName:"init"},{baseName:"ITSortRemover",base:te,methodName:"init"}]}}]),r()(e,[{key:"visit",value:function(e){return this.deleteHandle(e)||this.sortHandle(e),this.mixin_ITRemover_visit(e)}}]),e}(),ie=function(){function e(t,n,i,a){o()(this,e),this.init(t,n,i,a)}return r()(e,[{key:"init",value:function(e,t,n,i){this.begin=e,this.end=t,this.handler=n,this.extractTest=i||y.intersectTest}},{key:"term",value:function(){this.handler=null,this.extractTest=null}},{key:"config",value:function(e,t,n,i){this.begin=e,this.end=t,this.handler=n,this.extractTest=i||y.intersectTest}},{key:"visit",value:function(e){return!(!this.extractTest||this.extractTest(this,e))||!this.handler.handle(e)}}]),e}(),oe=function(){function e(t){o()(this,e),this.toolkit=t,this.tree=t.tree,this.copy=t.HintVT.copy}return r()(e,[{key:"config",value:function(e,t,n,i){this.found=e,this.keyword=t,this.tree.hintAtTree(e),i?(this.nearest=n,this.nearer=i,this.tree.hintAtTree(n)):(this.nearest=null,this.nearer=null)}},{key:"handle",value:function(e){return this.keyword.eq(e)?(this.copy(this.found,e),!0):(this.nearer&&this.nearer(e,this.nearest)&&this.copy(this.nearest,e),!1)}}]),e}(),ae=function(){function e(t){o()(this,e),this.toolkit=t}return r()(e,[{key:"config",value:function(e,t){this.nodes=[],this.boundary={begin:e,end:t}}},{key:"handle",value:function(e){p(this.boundary,e),this.nodes.push(e._node)}}]),e}(),re=function(){function e(t){o()(this,e),this.toolkit=t}return r()(e,[{key:"config",value:function(){this.touch=!1}},{key:"handle",value:function(e){return this.touch=!0}}]),e}(),se=function(){function e(t,n){o()(this,e),this.toolkit=t,this.handle=n}return r()(e,[{key:"init",value:function(e,t){this.toolkit=e,this.handle=t}},{key:"term",value:function(){this.toolkit=null,this.handle=null}},{key:"config",value:function(e){this.handle=e}}]),e}(),le=function(){function e(t){o()(this,e),this.toolkit=t}return r()(e,[{key:"config",value:function(e){this.map=[],this.translate=e||d}},{key:"handle",value:function(e){this.map.push(this.translate(e))}}]),e}(),ue=function(){function e(t){o()(this,e),this.toolkit=t}return r()(e,[{key:"config",value:function(e,t){this.sum=e,this.total=t||{}}},{key:"handle",value:function(e){this.sum(this.total,e)}}]),e}(),ce=function(){function e(){o()(this,e)}return r()(e,[{key:"config",value:function(e){this.pos=e}},{key:"eq",value:function(e){return e.begin===this.pos}}]),e}(),he=function(){function e(){o()(this,e)}return r()(e,[{key:"config",value:function(e){this.pos=e}},{key:"eq",value:function(e){return e.end===this.pos}}]),e}(),de=function(){function e(){o()(this,e)}return r()(e,[{key:"config",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.Exclude;this.pos=e,this.rule=t}},{key:"gt",value:function(e){var t=e.end;return this.pos>t||this.pos===t&&y.Include===this.rule}},{key:"lt",value:function(e){var t=e.begin;return this.pos<t||this.pos===t&&y.Exclude===this.rule}},{key:"eq",value:function(e){var t=e.begin;if(y.Include===this.rule&&this.pos===t)return!0;var n=e.end;return y.Exclude===this.rule&&this.pos===n||t<this.pos&&this.pos<n}}]),e}(),pe=function(){function e(){o()(this,e)}return r()(e,[{key:"config",value:function(e,t){this.begin=e,this.end=t}},{key:"gt",value:function(e){var t=e.begin;return this.begin===t?this.end>e.end:this.begin>t}},{key:"lt",value:function(e){var t=e.begin;return this.begin===t?this.end<e.end:this.begin<t}},{key:"eq",value:function(e){return this.begin===e.begin&&this.end===e.end}}]),e}(),fe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.upper,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.NonIntersect,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ge;o()(this,e),this.init(t,n,i,a)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"RBToolkit",base:c.f,methodName:"init"},{baseName:"RBToolkit",base:c.f,methodName:"reset"}]}},{key:"doAsTheToolkitDo",value:function(e){return e.it_hint1={},e.it_hint2={},e.beHint(e.it_hint1),e.beHint(e.it_hint2),c.f.doAsTheToolkitDo(e)}}]),r()(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.upper,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.NonIntersect,n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ge;this.mixin_RBToolkit_init(m,o),this.rule=e,this.agreement=t,this.deleteTest=h,l.a.bind(this,"tree",(function(e){return new q(o)})),l.a.bind(this,"traverser",(function(e){return new c.g(e.tree,c.a.lnr)})),l.a.bind(this,"expander",(function(e){return new Q})),l.a.bind(this,"remover",(function(e){var o=$,a=ee;switch(t){case y.Nesting:case y.Crossing:o=te,a=ne}return i?new a(n,n.deleteTest):new o(n)})),l.a.bind(this,"extract",(function(e){return ie.make()})),l.a.bind(this,"detachHandler",(function(e){return new ae(e)})),l.a.bind(this,"someHandler",(function(e){return new re(e)})),l.a.bind(this,"findHandler",(function(e){return new oe(e)})),l.a.bind(this,"forEachHandler",(function(e){return se.make(e)})),l.a.bind(this,"mapHandler",(function(e){return new le(e)})),l.a.bind(this,"reduceHandler",(function(e){return new ue(e)})),l.a.bind(this,"pointKeyword",(function(e){return new de})),l.a.bind(this,"rangeKeyword",(function(e){return new pe})),l.a.bind(this,"endWithKeyword",(function(e){return new he}))}},{key:"reset",value:function(){this.mixin_RBToolkit_reset(),this.HintVT.it_hint1.term(),this.HintVT.it_hint2.term()}},{key:"expand",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rule;this.expander.config(e,t,n),this.traverser.traverse(this.expander,c.a.rnl)}},{key:"remove",value:function(e,t){var n=this.remover;n.config(e,e+t),this.traverser.traverse(n,c.a.rnl),n.deleteOnRemoved&&n.deleteOnRemoved(),n.sortOnRemoved&&n.sortOnRemoved()}},{key:"detachNodes",value:function(e,t,n){var i=this,o=this.detachHandler;return o.config(e,t),this.extract.config(e,t,o,n),this.traverser.traverse(this.extract),o.nodes.forEach((function(e){i.detachNode(e)})),{boundary:o.boundary,nodes:o.nodes}}},{key:"detachAllNodes",value:function(){for(var e=this.tree,t=null,n=[];!e.empty();)t=e.getNextNode(),this.detachNode(t),n.push(t);return n}},{key:"fetchHint",value:function(e,t,n,i){var o=this.findHandler;return o.config(e,i),this.extract.config(t,n,o),this.traverser.traverse(this.extract),e}},{key:"fetchNearestHint",value:function(e,t,n,i,o,a){var r=this.findHandler;return r.config(e,i,o,a),this.extract.config(t,n,r),this.traverser.traverse(this.extract),e.good()}},{key:"fetchHintContainPos",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.Include;return this.pointKeyword.config(t,n),this.agreement===y.NonIntersect?this.binarySearchHint(e,this.pointKeyword):this.fetchHint(e,t,t,this.pointKeyword)}},{key:"fetchHintEqualRange",value:function(e,t,n){return this.rangeKeyword.config(t,n),this.binarySearchHint(e,this.rangeKeyword)}},{key:"fetchHintEndWith",value:function(e,t){return this.endWithKeyword.config(t),this.fetchHint(e,t,t,this.endWithKeyword)}},{key:"findNode",value:function(e,t,n){var i=this.fetchHint(this.HintVT.it_hint1,e,t,n);return i.good()&&i._node||null}},{key:"findNearestNode",value:function(e,t,n,i){var o=this.HintVT.it_hint1,a=this.HintVT.it_hint2;return this.fetchNearestHint(o,e,t,n,a,i)?{found:o._node,nearest:null}:{found:null,nearest:a.good()?a._node:null}}},{key:"findNodeContainPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.Include,n=this.fetchHintContainPos(this.HintVT.it_hint1,e,t);return n.good()&&n._node||null}},{key:"findNodeEqualRange",value:function(e,t){return this.rangeKeyword.config(e,t),this.binarySearchNode(this.rangeKeyword)}},{key:"findNodeEndWith",value:function(e){var t=this.fetchHintEndWith(this.HintVT.it_hint1,e);return t.good()&&t._node||null}},{key:"fetchInfo",value:function(e,t,n,i){var o=this.fetchHint(this.HintVT.it_hint1,t,n,i);return o.good()?(f(e,o),e):null}},{key:"fetchInfoContainPos",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.Include,i=this.fetchHintContainPos(this.HintVT.it_hint1,t,n);return i.good()?(f(e,i),e):null}},{key:"some",value:function(e,t,n){var i=this.someHandler;return i.config(),this.extract.config(e,t,i,n),this.traverser.traverse(this.extract),i.touch}},{key:"forEachHint",value:function(e){for(var t=this.HintVT,n=t.good,i=t.moveNext,o=this.tree.makeHintAtHead();n(o)&&!e(o);)i(o);o.free()}},{key:"forEachNode",value:function(e){for(var t=this.HintVT,n=t.good,i=t.moveNext,o=this.tree.makeHintAtHead();n(o)&&!e(o._node);)i(o);o.free()}},{key:"forEachHintInRange",value:function(e,t,n,i){var o=se.make(this,n),a=ie.make(e,t,o,i);this.traverser.traverse(a),a.free(),o.free()}},{key:"map",value:function(e){var t=this.HintVT,n=t.good,i=t.moveNext,o=this.tree.makeHintAtHead(),a=[];for(e||(e=d);n(o);)a.push(e(o)),i(o);return o.free(),a}},{key:"mapInRange",value:function(e,t,n,i){var o=this.mapHandler;return o.config(n),this.extract.config(e,t,o,i),this.traverser.traverse(this.extract),o.map}}]),e}();u.a.mix(Z,c.e),u.a.mix(X,Z),u.a.mix(q,c.h),u.a.mix(Q,J),u.a.mix($,J),u.a.mix(ee,$),u.a.mix(te,$),u.a.mix(ne,J,ee,te),u.a.mix(ie,J),u.a.mix(fe,c.f);var ge=fe.doAsTheToolkitDo(new K);s.a.buildVT(ge,"ITHint"),s.a.buildType(ie),s.a.buildType(se)},324:function(e,t,n){"use strict";n.d(t,"x",(function(){return i})),n.d(t,"z",(function(){return o})),n.d(t,"j",(function(){return a})),n.d(t,"l",(function(){return r})),n.d(t,"m",(function(){return s})),n.d(t,"k",(function(){return l})),n.d(t,"i",(function(){return u})),n.d(t,"q",(function(){return c})),n.d(t,"a",(function(){return h})),n.d(t,"f",(function(){return d})),n.d(t,"g",(function(){return p})),n.d(t,"B",(function(){return f})),n.d(t,"A",(function(){return g})),n.d(t,"n",(function(){return v})),n.d(t,"p",(function(){return m})),n.d(t,"o",(function(){return _})),n.d(t,"C",(function(){return y})),n.d(t,"h",(function(){return b})),n.d(t,"d",(function(){return T})),n.d(t,"e",(function(){return C})),n.d(t,"t",(function(){return k})),n.d(t,"s",(function(){return w})),n.d(t,"r",(function(){return S})),n.d(t,"D",(function(){return P})),n.d(t,"w",(function(){return I})),n.d(t,"b",(function(){return E})),n.d(t,"c",(function(){return O})),n.d(t,"y",(function(){return x})),n.d(t,"v",(function(){return R})),n.d(t,"u",(function(){return N})),n.d(t,"E",(function(){return A}));var i=0,o=10,a=11,r=13,s=12,l=15,u=14,c=2,h=5,d=8,p=1,f=9,g=32,v=19,m=20,_=21,y=40,b=7,T=3,C=4,k=26,w=27,S=12288,P=0,I=160,E=60,O=62,x=31,R=8203,N=8205,A=42},3319:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=function e(t,n){o()(this,e),this.x=t||0,this.y=n||0},l=function(){function e(t){o()(this,e),t&&this.init(t)}return r()(e,[{key:"init",value:function(e){var t=e.left||0,n=e.top||0,i=e.right||0,o=e.bottom||0;t<=i?(this.left=t,this.right=i):(this.left=i,this.right=t),n<=o?(this.top=n,this.bottom=o):(this.top=o,this.bottom=n)}},{key:"equal",value:function(e){return this.left===e.left&&this.right===e.right&&this.top===e.top&&this.bottom===e.bottom}},{key:"intersect",value:function(e){return e.left<=this.right&&this.left<=e.right&&e.top<=this.bottom&&this.top<=e.bottom}},{key:"addOffset",value:function(e,t){this.left+=e,this.right+=e,this.top+=t,this.bottom+=t}},{key:"width",get:function(){return this.right-this.left}},{key:"height",get:function(){return this.bottom-this.top}},{key:"lefttop",get:function(){return new s(this.left,this.top)}},{key:"righttop",get:function(){return new s(this.right,this.top)}},{key:"leftbottom",get:function(){return new s(this.left,this.bottom)}},{key:"rightbottom",get:function(){return new s(this.right,this.bottom)}},{key:"size",get:function(){return{width:this.width,height:this.height}}}]),e}();t.a=l},3331:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=function(){function e(){o()(this,e)}return r()(e,[{key:"mateOf",value:function(){return!1}},{key:"makeZone",value:function(){return null}},{key:"initZone",value:function(e,t,n){n.typoRange={pos:t.ccp,len:0},n.partRangePos=t.dataStatus.pos-e.range.pos;var i=t.dataStatus.chpx.prop;n.rtlText=i.getPropVal("right_to_left_text")}},{key:"updateZone",value:function(){}}]),e}();t.a=s},3332:function(e,t,n){"use strict";n.d(t,"c",(function(){return S})),n.d(t,"a",(function(){return P})),n.d(t,"d",(function(){return O})),n.d(t,"b",(function(){return x})),n.d(t,"e",(function(){return R})),n.d(t,"f",(function(){return A}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(410),d=n(1169),p=n(310),f=n(1103),g=n(554),v=n(952),m=n(309),_=n(324),y=n(6108),b=n(6109),T=n(3859),C=function(){function e(t,n,i,o){l()(this,e),this.init(t,n,i,o)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:d.d,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i){this.mixin_DOCRange_init(t,n,i),this.refNote=e}}]),e}();function k(e,t){e.onDeleteText=function(n,i,o){t(n,i,o),e.remove(i,o.length)}.bind(e)}var w=function(){function e(t,n,i){l()(this,e),this.document=n,this.rangeClass=new d.e(n,i,p.IT.upper,p.IT.NonIntersect,!0),Object(g.default)(this),v.a.bind(this.rangeClass,"attacher",(function(e){return new d.c(e,e.sortby,e.refIds)})),this.rangeClass.attachObserver(this),k(this.rangeClass,this.beforeDeleteText.bind(this))}return c()(e,[{key:"getRefByPos",value:function(e){return void 0===e?null:(this.rangeClass.findNodeContainPos(e)||{}).refNote}},{key:"getNoteBody",value:function(e){return this.rangeClass.findNodeContainPos(e)}},{key:"onAttachNode",value:function(e,t){var n=t.pos+t.len,i=this.document.getSubDocRange(this.subDocType),o=[{pos:n,len:i.pos+i.len-n}];this._dispatch("onFontUpdate",o)}},{key:"beforeDeleteText",value:function(e,t,n){var i=n.length,o=!1;if(this.rangeClass.mapInRange(t,t+i,(function(e){var n=e._node,a=n.pos,r=n.len;t<=a&&t+i>=a+r&&(o=!0)}),p.IT.strictIntersectTest),o){var a=t+i,r=this.document.getSubDocRange(this.subDocType),s=[{pos:a,len:r.pos+r.len+i-a}];this._dispatch("onFontUpdate",s)}}}]),e}(),S=function(e){function t(e,n){l()(this,t);var i=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,f.l));return i.subDocType=m.Footnote,i}return r()(t,e),t}(w),P=function(e){function t(e,n){l()(this,t);var i=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,f.i));return i.subDocType=m.Endnote,i}return r()(t,e),t}(w),I=function(){function e(t,n,i,o){l()(this,e),this.init(t,n,i,o)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:d.d,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i){this.mixin_DOCRange_init(e,t,Object(d.g)(n)),this.document=i;var o=this.getData().getBody();o&&(void 0!==o.pos?this.body=new C(this,o.pos,o.pos+o.len):this.body=new C(this,o.getPos(),o.getPos()+o.getLen()))}},{key:"setBody",value:function(e){this.getData().setBody(e),e.refNote=this}},{key:"isCustom",get:function(){return this.getData().getIsCustom()}},{key:"isRevisionHidden",get:function(){return void 0===this._isRevisionHidden&&(this._isRevisionHidden=Object(T.b)(this.document.getDataLogic("final").getChpx(this.pos).prop)),this._isRevisionHidden},set:function(e){this._isRevisionHidden=e}}]),e}();h.a.mix(C,d.d),h.a.mix(I,d.d);var E=function(){function e(t,n,i,o){l()(this,e),Object(d.f)(this),Object(g.default)(this),this.document=n,this.bodys=o,this.rangeClass=new d.e(n,i,p.IT.outer,p.IT.Crossing,!0);var a=this;t.forEach((function(e){a.doInsertNakedRange(e)})),this.rangeClass.attachObserver(this),k(this.rangeClass,this.beforeDeleteText.bind(this))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new I(e.pos,e.pos+e.len,e.data,this.document);this.rangeClass.attachNode(t),this.bodys.rangeClass.attachNode(t.body),t.setBody(t.body)}},{key:"onAttachNode",value:function(e,t){for(var n=t.getNextNode(),i=[];n&&!n.isTree();){if(!n.isCustom&&void 0!==n.num){delete n.num;var o=n,a=o.pos,r=o.len;i.push({pos:a,len:r})}n=n.getNextNode()}i.length&&this._dispatch("onFontUpdate",i)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.bodys.rangeClass.detachNode(t.body),this.rangeClass.detachNode(t)}},{key:"getNotes",value:function(e){var t=e.begin,n=e.end;return this.rangeClass.mapInRange(t,n,(function(e){return e.clone()}),p.IT.strictIntersectTest)}},{key:"getNote",value:function(e){return this.rangeClass.findNodeContainPos(e)}},{key:"beforeDeleteText",value:function(e,t,n){var i=n.length,o=!1;if(this.rangeClass.mapInRange(t,t+i,(function(e){o=!0}),p.IT.strictIntersectTest),o){var a=[];this.rangeClass.mapInRange(t+i,this.document.getMainTextLength()+i,(function(e){var t=e._node;if(!t.isCustom&&void 0!==t.num){delete t.num;var n=t.pos,i=t.len;a.push({pos:n,len:i})}}),p.IT.strictIntersectTest),this._dispatch("onFontUpdate",a)}}},{key:"onChpxChanged",value:function(e,t){var n=!0,i=this.document.textStream,o=t.pos,a=t.len,r=[];this.rangeClass.mapInRange(o,o+a,(function(e){var t=e._node,o=Object(T.b)(i.getChpx(t.pos).prop);if(o!==t.isRevisionHidden){n=!0,t.isCustom||void 0===t.num||delete t.num,t.isRevisionHidden=o;var a=t.body;r.push({pos:a.pos,len:a.len})}}),p.IT.strictIntersectTest),n&&(this.rangeClass.mapInRange(o+a,this.document.getMainTextLength()+a,(function(e){var t=e._node;if(!t.isCustom&&void 0!==t.num){delete t.num;var n=t.pos,i=t.len,o=t.body;r.push({pos:n,len:i}),r.push({pos:o.pos,len:o.len})}}),p.IT.strictIntersectTest),this._dispatch("onFontUpdate",r))}},{key:"onSectionxChanged",value:function(e,t){this.rangeClass.forEachNode((function(e){delete e.num}))}}]),e}(),O=function(e){function t(e,n){return l()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,f.k,n.footnoteBodys))}return r()(t,e),t}(E),x=function(e){function t(e,n){return l()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,f.h,n.endnoteBodys))}return r()(t,e),t}(E),R=String.fromCharCode(_.q),N=function(e,t,n,i){return void 0===e.num&&function e(t,n,i,o){for(var a=t.isRevisionHidden,r=t.getPrevNode();r&&!r.isTree()&&(r.isCustom||r.isRevisionHidden&&!a);)r=r.getPrevNode();if(r.isTree())t.num=n.numStart;else switch(void 0===r.num&&e(r,n,i,o),t.num=r.num+1,n.numRestart){case y.c:var s=window.APP.data.typoinfo.textLineRanges.findNodeContainPos(r.pos);s&&s.line&&s.line.viewPage!==o&&(t.num=n.numStart);break;case y.d:var l=i.getPrevNode(),u=l.isTree()?0:l.pos+1;r.pos<u&&(t.num=n.numStart)}}(e,t,n,i),b.a.numberFormat(e.num,t.numFormat)};function A(e,t,n,i){var o=i.sections.getSection(e.pos);return i.getText(e.pos,e.len).replace(R,e.isCustom?"":N(e,t?o.getFootnotePr():o.getEndnotePr(),o,n))}},3333:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return p})),n.d(t,"f",(function(){return f})),n.d(t,"a",(function(){return r})),n.d(t,"g",(function(){return l}));var i=n(8),o=n.n(i),a="zh-CN"===window.langName,r={SimSun:"宋体",FangSong:"仿宋",SimHei:"黑体",KaiTi:"楷体",YaHei:"微软雅黑",STSong:"华文宋体",STFangsong:"华文仿宋",STKaiti:"华文楷体",FZXiaoBiaoSong:"方正小标宋简体"},s=["初号","小初","一号","小一","二号","小二","三号","小三","四号","小四","五号","小五","六号","小六","七号","八号"],l=a?"五号":5,u=[42,36,26,24,22,18,16,15,14,12,10.5,9,7.5,6.5,5.5,5],c=[5,5.5,6.5,7.5,8,9,10,10.5,11,12,14,16,18,20,22,24,26,28,36,48,72],h=void 0,d=void 0;a?(h=[].concat(s,c),d=[].concat(u,c)):(h=[].concat(c),d=[].concat(c));var p=[_i18n("applications.writer.font.size.auto", "Auto")].concat(o()(h)),f=[0].concat(o()(d))},3334:function(e,t,n){"use strict";function i(e,t){if(window.Rect){var n=t.top,i=t.left,o=t.width,a=t.height,r=new window.Rect(i,n,o,a).rotationAtCenter(e);t.updateByOrigin(r.x(),r.y()),t.updateBySize(r.width(),r.height())}}function o(e,t,n){if(window.QMatrix){var i=new window.QMatrix;i.rotate(-n);var o=i.map_point(new window.Point(e.x-t.left-t.width/2,e.y-t.top-t.height/2)),a=o.x(),r=o.y();return a>=-t.width/2&&a<t.width/2&&r>=-t.height/2&&r<t.height/2}}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}))},336:function(e,t,n){"use strict";n.r(t),n.d(t,"Ti2Px",(function(){return i})),n.d(t,"Px2Ti",(function(){return o})),n.d(t,"Ti2Pt",(function(){return a})),n.d(t,"Pt2Ti",(function(){return r})),n.d(t,"Ti2Mm",(function(){return s})),n.d(t,"Mm2Ti",(function(){return l})),n.d(t,"Ti2Cm",(function(){return u})),n.d(t,"Cm2Ti",(function(){return c})),n.d(t,"Px2Pt",(function(){return h})),n.d(t,"Pt2Px",(function(){return d}));var i=function(e){return e/15},o=function(e){return 15*e},a=function(e){return e/20},r=function(e){return 20*e},s=function(e){return 127*e/7200},l=function(e){return 7200*e/127},u=function(e){return 127*e/72e3},c=function(e){return 72e3*e/127},h=function(e){return 15*e/20},d=function(e){return 20*e/15}},3478:function(e,t,n){"use strict";n.r(t),n.d(t,"sortString",(function(){return o})),n.d(t,"getNamesStrFromTargets",(function(){return a})),n.d(t,"parseBase64String",(function(){return r}));var i=n(3854);function o(e){function t(e){var t=e.charCodeAt(0);return t>=0&&t<=128}return e.sort((function(e,n){if(t(e)&&t(n)||!t(e)&&!t(n))return e.localeCompare(n);var i="zh-CN"===window.langName,o=void 0;return o=t(e)?-1:1,i&&(o*=-1),o}))}function a(e){if(!e||!e.length)return"";var t=!1,n=e.map((function(e){return e.nickname?e.nickname.length>i.a.coop_single_name_max_length?(t=!0,e.nickname.substr(0,i.a.coop_single_name_max_length)):e.nickname:""})).join(",");return n.length>i.a.coop_multi_names_max_length&&(n=n.substr(0,i.a.coop_multi_names_max_length)),t&&(n+="..."),n}function r(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={isValid:!1,mimeType:""},i=e.split(",");if(2===i.length){var o=/^data:(?:.*\/.*)?(?:;base64)?/.test(i[0]);n.mimeType=i[0].match(/^data:((?:.*\/[^;]*)?)/)[1];var a=!t||/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/.test(i[1]);n.isValid=o&&a}return n}},3479:function(e,t,n){"use strict";n.r(t),n.d(t,"txDocProtNone",(function(){return i})),n.d(t,"txDocProtReadOnly",(function(){return o})),n.d(t,"txDocProtRevisions",(function(){return a})),n.d(t,"txDocProtKrmReadOnly",(function(){return r})),n.d(t,"txDocProtForm",(function(){return s})),n.d(t,"txDocProtComment",(function(){return l}));var i=0,o=1,a=2,r=3,s=4,l=5},3480:function(e,t,n){"use strict";n.r(t),n.d(t,"read",(function(){return f})),n.d(t,"write",(function(){return g})),n.d(t,"remove",(function(){return v})),n.d(t,"has",(function(){return _})),n.d(t,"clear",(function(){return y})),n.d(t,"clearExpireItems",(function(){return T}));var i,o=n(80),a=n.n(o),r=n(24),s=n.n(r),l=n(1402),u=(new Date).getTime(),c=!0,h=function(e){return"w-stg-expire-"+e},d=function(){return l.default.getInstance()},p=function(e){return new Promise((function(t,n){var i=h(e);d().read(i,(function(i,o){if(i&&"No available storage method found."===i.message)return c=!1,void n("unavailableKey");i||!o||o<u?v(e,(function(){n("unavailableKey")})):t(e)}))}))},f=function(e,t,n){c||t&&t(null,null,null),p(e).then((function(){d().read(e,(function(i,o){i||null==o?t&&t(null,null,null):void 0!==n&&(void 0===o?"undefined":s()(o))!==n?v(e,(function(){t&&t(null,null,null)})):t&&t(null,o,e)}))})).catch((function(){t&&t(null,null,null)}))},g=function(e,t,n,i){if(e&&null!=t&&c){var o=d();o.write(e,t,(function(t,a,r){t||o.write(h(e),function(e){return(new Date).getTime()+(e?94608e7:12096e5)}(i)),n&&n(t,a,r)}))}else n&&n("error",null,null)},v=function(e,t){c||t&&t(null);var n=h(e);Promise.all([m(e),m(n)]).then((function(){t&&t(null)})).catch((function(){t&&t("error")}))},m=function(e){return new Promise((function(t,n){d().delete(e,(function(i){i?t(e):n("error")}))}))},_=function(e){return c?new Promise((function(t,n){p(e).then((function(){d().has(e).then((function(){t(e)})).catch((function(){n("error")}))})).catch((function(){n("error")}))})):Promise.reject("error")},y=function(e){c&&d().clear(e)},b=void 0,T=(i=a()(regeneratorRuntime.mark((function e(){var t,n,i,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d().storage,void 0===b&&(b=0),e.next=4,t.length();case 4:n=e.sent,i=Math.min(b+10,n);case 6:if(!(b<i)){e.next=14;break}return e.next=9,t.key(b);case 9:(o=e.sent)&&0===o.indexOf("w-stg-expire")&&(a=o.substr("w-stg-expire".length+1,o.length-"w-stg-expire".length),p(a).then((function(){})).catch((function(){})));case 11:b++,e.next=6;break;case 14:return e.abrupt("return",b>=n);case 15:case"end":return e.stop()}}),e,void 0)}))),function(){return i.apply(this,arguments)})},3481:function(e,t,n){e.exports=function(e,t){n.e(858).then(n.bind(null,5905)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},3482:function(e,t,n){e.exports=function(e,t){n.e(831).then(n.bind(null,5906)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},3483:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventType=void 0,function(e){e.ShowCommentItemAfterJump="ShowCommentItemAfterJump",e.ShowCommentItemAfterFindLocate="ShowCommentItemAfterFindLocate"}(t.EventType||(t.EventType={}))},3484:function(e,t,n){"use strict";n.d(t,"g",(function(){return i})),n.d(t,"k",(function(){return o})),n.d(t,"e",(function(){return a})),n.d(t,"j",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"l",(function(){return l})),n.d(t,"m",(function(){return u})),n.d(t,"f",(function(){return c})),n.d(t,"h",(function(){return h})),n.d(t,"i",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return g})),n.d(t,"n",(function(){return v}));var i=1,o=2,a=3,r=4,s=5,l=6,u=7,c=8,h=9,d=10,p=11,f=12,g=13,v=14},3485:function(e,t,n){"use strict";n.d(t,"b",(function(){return w})),n.d(t,"c",(function(){return S})),n.d(t,"a",(function(){return P})),n.d(t,"d",(function(){return k})),n.d(t,"e",(function(){return I}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(410),d=n(1168),p=n(6104),f=n(310),g=n(324),v=n(3484),m=n(5740),_=n(723),y=n(1318),b=n(6105),T=y.c.DOCCharTypeFastDetecter,C=function(){function e(){l()(this,e),this.init()}return c()(e,[{key:"init",value:function(){}},{key:"setCharRngFlag",value:function(e){this.charFlag=4294967280&this.charFlag|e}},{key:"getCharRngFlag",value:function(){return 15&this.charFlag}},{key:"isGlyphNormal",value:function(){return this.getCharRngFlag()==v.g}},{key:"isGlyphSharedNormal",value:function(){return this.getCharRngFlag()==v.k}},{key:"isNormal",value:function(){return this.getCharRngFlag()<3}},{key:"isNoPlaceHolder",value:function(){return this.getCharRngFlag()<6}},{key:"isGlyphFarEast",value:function(){return this.getCharRngFlag()==v.e}},{key:"isGlyphSharedFarEast",value:function(){return this.getCharRngFlag()==v.j}},{key:"isFarEast",value:function(){return this.isGlyphFarEast()||this.isGlyphSharedFarEast()}},{key:"isSpace",value:function(){return this.getCharRngFlag()==v.l}},{key:"isFullWidthSpace",value:function(){return _.a.isFullWidthSpace(this.charCode)}},{key:"isTab",value:function(){return this.getCharRngFlag()==v.m}},{key:"isZero",value:function(){return this.getCharRngFlag()==v.n}},{key:"isLineBreak",value:function(){return this.getCharRngFlag()==v.f}},{key:"isParaBreak",value:function(){return this.getCharRngFlag()==v.h}},{key:"isSepBreak",value:function(){return this.getCharRngFlag()==v.i}},{key:"isColBreak",value:function(){return this.getCharRngFlag()==v.a}},{key:"isGlyphComplex",value:function(){return this.getCharRngFlag()==v.b}},{key:"isCharStop",value:function(){return 0==(this.charFlag&m.v)}},{key:"setCharStopFlag",value:function(){this.charFlag&=~m.v}},{key:"unSetCharStopFlag",value:function(){this.charFlag|=m.v}},{key:"isWordStop",value:function(){return 0!=(this.charFlag&m.J)}},{key:"setWordStopFlag",value:function(){this.charFlag|=m.J}},{key:"isClusterStart",value:function(){return 0==(this.charFlag&m.w)}},{key:"setClusterStartFlag",value:function(){return this.charFlag&=~m.w}},{key:"unSetClusterStartFlag",value:function(){return this.charFlag|=m.w}},{key:"isRTL",value:function(){return this.charFlag&0!=m.z}},{key:"setRTLFlag",value:function(){this.charFlag|=m.z}},{key:"setLTRFlag",value:function(){this.charFlag&=~m.z}},{key:"isLayoutRTL",value:function(){return 0!=(this.charFlag&m.r)}},{key:"setLayoutRTLFlag",value:function(){this.charFlag|=m.r}},{key:"setLayoutLTRFlag",value:function(){this.charFlag&=~m.r}},{key:"isComplex",value:function(){return 0!=(this.charFlag&m.e)}},{key:"setComplexFlag",value:function(){this.charFlag|=m.e}},{key:"unSetComplexFlag",value:function(){this.charFlag&=~m.e}},{key:"isNeedWordBreaking",value:function(){return 0!=(this.charFlag&m.u)}},{key:"setNeeDWordBreakingFlag",value:function(){this.charFlag|=m.u}},{key:"unSetNeedWordBreakingFlag",value:function(){this.charFlag&=~m.u}},{key:"getLevel",value:function(e,t){return e!=t?2:t}},{key:"setEmphasisMarkFlag",value:function(){this.charFlag|=m.g}},{key:"setAboveTextEmphasisMarkFlag",value:function(){this.charFlag|=m.a}},{key:"setBelowTextEmphasisMarkFlag",value:function(){this.charFlag&=~m.a}},{key:"unSetEmphasisMarkFlag",value:function(){this.charFlag&=~m.g}},{key:"unSetAboveTextEmphasisMarkFlag",value:function(){return this.unSetEmphasisMark()}},{key:"unSetBelowTextEmphasisMarkFlag",value:function(){return this.unSetEmphasisMark()}},{key:"hasEmphasisMark",value:function(){return 0!=(this.charFlag&m.g)}},{key:"isAboveTextEmphasisMark",value:function(){return this.hasEmphasisMark()&&0!=(this.charFlag&m.a)}},{key:"isBelowTextEmphasisMark",value:function(){return this.hasEmphasisMark()&&0==(this.charFlag&m.a)}},{key:"setLowerAlphaSmallCapsFlag",value:function(){this.charFlag|=m.t}},{key:"isLowerAlphaSmallCaps",value:function(){return 0!=(this.charFlag&m.t)}},{key:"setFieldFlag",value:function(){this.charFlag|=m.i}},{key:"unSetFieldFlag",value:function(){this.charFlag&=~m.i}},{key:"isField",value:function(){return 0!=(this.charFlag&m.i)}},{key:"isGlyphValid",value:function(){return 0==(this.charFlag&m.p)}},{key:"isHidden",value:function(){return 0!=(this.charFlag&m.m)}},{key:"setHiddenFlag",value:function(){this.charFlag|=m.m}},{key:"unSetHiddenFlag",value:function(){this.charFlag&=~m.m}},{key:"isSpecHidden",value:function(){return 0!=(this.charFlag&m.C)}},{key:"setSpecHiddenFlag",value:function(){this.charFlag|=m.C}},{key:"unSetSpecHiddenFlag",value:function(){this.charFlag&=~m.C}},{key:"isVisible",value:function(){return!(this.isHidden()||this.isSpecHidden()||this.isRevisionHidden())}},{key:"isCharBox",value:function(){return 0!=(this.charFlag&m.c)}},{key:"unSetCharBoxFlag",value:function(){this.charFlag&=~m.c}},{key:"isEmbedDrawing",value:function(){return this.getCharRngFlag()==v.d}},{key:"setEmbedDrawingFlag",value:function(){this.setCharRngFlag(v.d)}},{key:"isOleEmbedDrawing",value:function(){return 0!=(this.charFlag&m.x)}},{key:"setOleEmbedDrawingFlag",value:function(){this.charFlag|=m.x}},{key:"isDrawing",value:function(){return this.getCharRngFlag()==v.c}},{key:"isEsc",value:function(){return this.getCharRngFlag()<12&&this.getCharRngFlag()>5}},{key:"setSpecFlag",value:function(){this.charFlag|=m.B}},{key:"unSetSpecFlag",value:function(){this.charFlag&=~m.B}},{key:"isSpec",value:function(){return 0!=(this.charFlag&m.B)}},{key:"isHiddenField",value:function(){return 0!=(this.charFlag&m.n)}},{key:"setHiddenFieldFlag",value:function(){this.charFlag|=m.n}},{key:"isHitTestHyperLink",value:function(){return 0!=(this.charFlag&m.o)}},{key:"setHitTestHyperLinkFlag",value:function(){this.charFlag|=m.o}},{key:"isHitTestTextInput",value:function(){return 0!=(this.charFlag&m.F)}},{key:"setHitTestTextInputFlag",value:function(){this.charFlag|=m.F}},{key:"isFormFieldMark",value:function(){return 0!=(this.charFlag&m.l)}},{key:"setFormFieldMarkFlag",value:function(){this.charFlag|=m.l}},{key:"isInTocField",value:function(){return 0!=(this.charFlag&m.E)}},{key:"setInTocFieldFlag",value:function(){this.charFlag|=m.E}},{key:"isLineFirstChar",value:function(){return 0!=(this.charFlag&m.s)}},{key:"setLineFirstCharFlag",value:function(){this.charFlag|=m.s}},{key:"unSetLineFirstCharFlag",value:function(){this.charFlag&=~m.s}},{key:"isInAsianLayout",value:function(){return 0!=(this.charFlag&m.b)}},{key:"setInAsianLayoutFlag",value:function(){this.charFlag|=m.b}},{key:"unSetInAsianLayoutFlag",value:function(){this.charFlag&=~m.b}},{key:"isVertHeightInfo",value:function(){return 0!=(this.charFlag&m.I)}},{key:"setVertHeightInfoFlag",value:function(){this.charFlag|=m.I}},{key:"setHoriHeightInfoFlag",value:function(){this.charFlag&=~m.I}},{key:"isKerningFollowing",value:function(){return 0!=(this.charFlag&m.q)}},{key:"setKerningFollowingFlag",value:function(){this.charFlag|=m.q}},{key:"unSetKerningFollowingFlag",value:function(){this.charFlag&=~m.q}},{key:"isPuncAdjusted",value:function(){return 0!=(this.charFlag&m.y)}},{key:"setPuncAdjustedFlag",value:function(){this.charFlag|=m.y}},{key:"setPuncNoAdjustedFlag",value:function(){this.charFlag&=~m.y}},{key:"isCJKFont",value:function(){return 0!=(this.charFlag&m.d)}},{key:"setCJKFontFlag",value:function(){this.charFlag|=m.d}},{key:"setNoCJKFontFlag",value:function(){this.charFlag&=~m.d}},{key:"isWaterMarkEmbed",value:function(){return-1!=this.embedFontIdx}},{key:"setSeparatorFlag",value:function(){this.customCharFlag|=m.D}},{key:"unSetSeparatorFlag",value:function(){this.customCharFlag&=~m.D}},{key:"isSeparator",value:function(){return 0!=(this.customCharFlag&m.D)}},{key:"isZeroChar",value:function(){return this.getCharRngFlag()==v.n}},{key:"setMathFlag",value:function(){this._isMath=!0}},{key:"isMath",value:function(){return!!this._isMath}},{key:"setRevisionHiddenFlag",value:function(){this.customCharFlag|=m.A}},{key:"isRevisionHidden",value:function(){return 0!=(this.customCharFlag&m.A)}},{key:"setFootnoteFlag",value:function(){this.customCharFlag|=m.k}},{key:"isFootnote",value:function(){return 0!=(this.customCharFlag&m.k)}},{key:"setEndnoteFlag",value:function(){this.customCharFlag|=m.h}},{key:"isEndnote",value:function(){return 0!=(this.customCharFlag&m.h)}},{key:"setFootEndNotePlaceholder",value:function(){this.customCharFlag|=m.j}},{key:"isFootEndNotePlaceholder",value:function(){return 0!=(this.customCharFlag&m.j)}},{key:"setContentControlPlaceholderHiddenFlag",value:function(){this.customCharFlag|=m.f}},{key:"isContentControlPlaceholderHidden",value:function(){return 0!=(this.customCharFlag&m.f)}},{key:"setTickCharBoxFlag",value:function(){this.customCharFlag|=m.G}},{key:"isTickCharBox",value:function(){return 0!=(this.customCharFlag&m.G)}},{key:"setTickCharSymbolFlag",value:function(){this.customCharFlag|=m.H}}]),e}(),k=function(){function e(t){l()(this,e),this.init(t)}return c()(e,[{key:"init",value:function(e){this.glyphGroups=e.glyphGroups,this.glyphBuff=e.glyphBuff,this.groupHint=e.glyphGroups.tree.makeHintAtTree()}},{key:"term",value:function(){this.glyphGroup=null,this.glyphBuff=null,this.groupHint.free()}},{key:"seek",value:function(e){return this.glyphGroups.fetchHintContainPos(this.groupHint,e),!!this.groupHint.good()&&(this.glyphGroup=this.groupHint._node,this.position=e,!0)}},{key:"seekIt",value:function(e){this.glyphGroups.HintVT.copy(this.groupHint,e.groupHint),this.glyphGroup=e.glyphGroup,this.position=e.position}},{key:"next",value:function(){if(++this.position,this.position>=this.groupHint.end){if(this.groupHint.moveNext(),!this.groupHint.good()||this.position<this.groupHint.begin)return!1;this.glyphGroup=this.groupHint._node}return!0}},{key:"prev",value:function(){if(--this.position,this.position<0)return this.position=0,!1;if(this.position<this.groupHint.begin){if(this.groupHint.movePrev(),!this.groupHint.good()||this.groupHint.end<this.position)return!1;this.glyphGroup=this.groupHint._node}return!0}},{key:"clone",value:function(t){var n=t;return n||(n=e.make(this)),n.seekIt(this),n}},{key:"setCharCode",value:function(e){this.glyphBuff.setCharAndCharCode(this.position,e)}},{key:"setMetrics",value:function(e){this.glyphGroup.metrics=e}},{key:"isSpec",value:function(){return this.glyphGroup.isSpec()}},{key:"isHidden",value:function(){return this.glyphGroup.isHidden()}},{key:"isSpecHidden",value:function(){return this.glyphGroup.isSpecHidden()}},{key:"isVisible",value:function(){return this.glyphGroup.isVisible()}},{key:"isSeparator",value:function(){return this.glyphGroup.isSeparator()}},{key:"char",get:function(){return this.glyphBuff.getChar(this.position)}},{key:"charCode",get:function(){return this.glyphBuff.getCharCode(this.position)}},{key:"width",get:function(){var e=this.glyphGroup.typomi||this.glyphBuff.getMi(this.position);return e?e.width:0}},{key:"lineHeaderWidth",get:function(){var e=this.glyphGroup.typomi||this.glyphBuff.getMi(this.position);return e?e.lineHeaderWidth:0}},{key:"minWidth",get:function(){var e=this.glyphGroup.typomi||this.glyphBuff.getMi(this.position);return e?e.minWidth:0}},{key:"metrics",get:function(){return this.glyphGroup.metrics}},{key:"mi",get:function(){return this.glyphBuff.getMi(this.position)}}]),e}();d.a.buildType(k);var w=function(e){function t(){l()(this,t);var e=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.init(),e}return r()(t,e),c()(t,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:f.ITRange,methodName:"init"}]}}]),c()(t,[{key:"init",value:function(){this.mixin_ITRange_init(0,0),this.charFlag=0,this.customCharFlag=0,this.chpx=null,this.papx=null}},{key:"setFont",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"10",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.font={fontStyle:e,fontWeight:t,fontSize:""+n,fontFamily:i}}},{key:"clone",value:function(){var e=new t;for(var n in this)"shape"!=n&&void 0===e[n]&&(e[n]=this[n]);return e.charFlag=this.charFlag,e.customCharFlag=this.customCharFlag,e.chpx=this.chpx,e.papx=this.papx,e}}]),t}(C),S=function(){function e(){l()(this,e),this.init()}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITToolkit",base:f.ITToolkit,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(){this.mixin_ITToolkit_init(f.IT.upper,f.IT.NonIntersect,!0)}},{key:"setGlyphGroupFlag",value:function(e,t){var n=t.begin,i=t.end;n!==i&&(this.trySplit(n),this.trySplit(i),this.forEachHintInRange(n,i,(function(t){e(t._node)}),f.IT.strictIntersectTest))}},{key:"_inSameDocumentFields",value:function(e,t){var n=e.documentFields,i=t.documentFields,o=n&&n.length,a=o!=(i&&i.length);if(!a&&o)for(var r=0;r<o;++r)if(n[r]!=i[r]){a=!0;break}return!a}},{key:"canMerge",value:function(e,t,n){if(e.charFlag!=t.charFlag||e.bidiLevel!=t.bidiLevel||!this._inSameDocumentFields(e,t)||e.isCombine||t.isCombine)return!1;var i=e.getCharRngFlag(),o=n.getCharCode(e.begin),a=n.getCharCode(t.begin);switch(i){case v.g:if(o>=48&&o<=57){if(a>=48&&a<=57)return!0}else if(o>=97&&o<=122){if(a>=97&&a<=122)return!0}else if(o>=65&&o<=90&&a>=65&&a<=90)return!0;break;case v.e:if(o!=g.r&&a!=g.r&&!_.a.isPunc(o)&&!_.a.isPunc(a))return!0;break;default:if(Object(b.b)(o)&&Object(b.c)(a))return!0}return!1}},{key:"tryMerge",value:function(e,t,n){if(!n.atChpxBound(e)){var i=this.mapInRange(e,e,f.IT.mapToNode);if(2===i.length){var o=i[0],a=i[1];this.canMerge(o,a,t)&&(this.detachNode(o),this.detachNode(a),o.reset(o.begin,a.end),this.attachNode(o))}}}},{key:"mergeGlyphGroup",value:function(e,t,n){var i=n.begin,o=n.end;this.tryMerge(i,e,t),this.tryMerge(o,e,t)}},{key:"trySplit",value:function(e){var t=this.fetchHintContainPos(this.HintVT.it_hint1,e);if(t.good()&&e!=t.begin){var n=t._node,i=n.clone();this.detachNode(n),i.reset(e,n.end),n.reset(n.begin,e),this.attachNode(n),this.attachNode(i)}}},{key:"dropGroups",value:function(e,t){var n=this;this.trySplit(e),this.trySplit(t),this.mapInRange(e,t,f.IT.mapToNode,f.IT.strictIntersectTest).forEach((function(e){n.detachNode(e)}))}},{key:"collectGroups",value:function(e,t){return this.mapInRange(e,t,f.IT.mapToNode,f.IT.strictIntersectTest)}}]),e}();h.a.mix(w,f.ITRange),h.a.mix(S,f.ITToolkit);var P=function(){function e(t){l()(this,e),this.init(t),this.size=t}return c()(e,[{key:"init",value:function(e){this.buffs=new p.a}},{key:"setCharAndCharCode",value:function(e,t){this.buffs.set(e,(function(e,n,i){n[i].charCode=t,n[i].char=String.fromCharCode(t)}))}},{key:"setChars",value:function(e,t){var n=t.begin,i=t.end,o=0,a=0,r=this.buffs;r.format(n,i,(function(e,t,n){t[n]={}})),r.forEach(n,i,(function(t,n,i){a=e.charAt(o++),n[i].char=a,n[i].charCode=a.charCodeAt(0)}))}},{key:"setRenderChars",value:function(e,t,n,i){var o=t;this.buffs.forEach(n,n+i,(function(t,n,i){n[i].char=String.fromCharCode(e[o++])}))}},{key:"toUpperAlpha",value:function(e,t){var n=0,i=null;this.buffs.forEach(e,t,(function(e,t,o){i=t[o],n=_.a.toUpperAlpha(i.char),i.char=n,i.charCode=n.charCodeAt(0)}))}},{key:"getCharCode",value:function(e){var t=this.buffs.at(e);return t&&t.charCode}},{key:"getChar",value:function(e){var t=this.buffs.at(e);return t&&t.char}},{key:"getText",value:function(e,t){var n="";return this.buffs.forEach(e,e+t,(function(e,t,i){n+=t[i].char})),n}},{key:"getMi",value:function(e){var t=this.buffs.at(e);return t&&t.mi}},{key:"getBuffs",value:function(){return this.buffs}},{key:"setMi",value:function(e,t){this.buffs.set(e,(function(e,n,i){n[i].mi=t}))}},{key:"fillMi",value:function(e,t,n){this.buffs.forEach(e,t,(function(e,t,i){t[i].mi=n}))}},{key:"onInsert",value:function(e,t){this.buffs.insert(e,new Array(t)),this.buffs.forEach(e,e+t,(function(e,t,n){t[n]={}})),this.size+=t}},{key:"onRemove",value:function(e,t){this.buffs.delete(e,t),this.size-=t}},{key:"isLowSurrogatesOfCombineChar",value:function(e){var t=this.getCharCode(e);return T.getUnicodeCharItem(t).usrType==y.b.usrLowSurrogates}},{key:"isHighSurrogatesOfCombineChar",value:function(e){var t=this.getCharCode(e);return T.getUnicodeCharItem(t).usrType==y.b.usrHighSurrogates}},{key:"getEmojiCombineCharForward",value:function(e){var t=this.getCharCode(e),n=0;if(Object(b.b)(t)&&e+1<this.size){var i=this.getCharCode(e+1);if(Object(b.c)(i)&&n++,n>0&&e+2<this.size){var o=this.getCharCode(e+2);Object(b.c)(o)&&n++}}return n}},{key:"getEmojiCombineCharBackward",value:function(e){var t=this.getCharCode(e),n=0;if(Object(b.c)(t)&&e-1>=0){var i=this.getCharCode(e-1);if(Object(b.c)(i)&&n++,e-2>=0){var o=this.getCharCode(e-2);Object(b.b)(o)&&n++}}return n}}]),e}(),I=function(){function e(t,n){l()(this,e),this.init(t,n)}return c()(e,[{key:"init",value:function(e,t){this.mainGlyphPool=this.glyphPool=e,this.line=t,this.groupInfo={}}},{key:"term",value:function(){this.mainGlyphPool=null,this.line=null,this.zone=null,this.groupInfo=null}},{key:"seek",value:function(e){return this.zone=this.line.zones.find((function(t){return t.typoRange.pos<=e&&e<t.typoRange.pos+t.typoRange.len})),!!this.zone&&(this.glyphPool=this.zone.getGlyphPool()||this.mainGlyphPool,this.posInLine=e,this.posInBuff=this._getPosition(e),!!this.glyphPool.glyphGroups.fetchInfoContainPos(this.groupInfo,this.posInBuff)&&(this.glyphGroup=this.groupInfo.node,!0))}},{key:"seekIt",value:function(e){this.groupInfo.begin=e.groupInfo.begin,this.groupInfo.enf=e.groupInfo.end,this.groupInfo.node=e.groupInfo.node,this.glyphGroup=e.groupInfo.node,this.posInLine=e.position,this.posInBuff=e.posInBuff}},{key:"next",value:function(){return++this.posInLine,++this.posInBuff,!(this.posInBuff>=this.groupInfo.end)||this.seek(this.posInLine)}},{key:"prev",value:function(){return--this.posInLine,--this.posInBuff,this.posInLine<0?(this.posInLine=0,!1):!(this.posInBuff<this.groupInfo.begin)||this.seek(this.posInLine)}},{key:"clone",value:function(t){var n=t;return n||((n=e.make()).mainGlyphPool=this.mainGlyphPool,n.glyphPool=this.glyphPool,n.line=this.line),n.seekIt(this),n}},{key:"setCharCode",value:function(e){this.glyphPool.glyphBuff.setCharAndCharCode(this.posInBuff,e)}},{key:"_getTypoMi",value:function(){return this.glyphPool.typomi?this.glyphPool.typomi:this.glyphPool.glyphBuff.getMi(this.posInBuff)}},{key:"setMetrics",value:function(e){this.glyphGroup.metrics=e}},{key:"_getPosition",value:function(e){return e-this.zone.typoRange.pos+this.zone.getPartRange().pos}},{key:"char",get:function(){return this.glyphPool.glyphBuff.getChar(this.posInBuff)}},{key:"charCode",get:function(){return this.glyphPool.glyphBuff.getCharCode(this.posInBuff)}},{key:"width",get:function(){var e=this._getTypoMi();return e?e.width:0}},{key:"lineHeaderWidth",get:function(){var e=this._getTypoMi();return e?e.lineHeaderWidth:0}},{key:"minWidth",get:function(){var e=this._getTypoMi();return e?e.minWidth:0}},{key:"metrics",get:function(){return this.glyphGroup.metrics}},{key:"mi",get:function(){return this.glyphPool.glyphBuff.getMi(this.posInBuff)}}]),e}();d.a.buildType(I)},3486:function(e,t,n){"use strict";n.r(t),n.d(t,"WOType_Delete",(function(){return i}));var i=0},3487:function(e,t,n){"use strict";n.d(t,"d",(function(){return k})),n.d(t,"c",(function(){return S})),n.d(t,"b",(function(){return P})),n.d(t,"a",(function(){return O}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(8),l=n.n(s),u=n(554),c=n(260),h=n(309),d=n(324),p=n(4806),f=n(4581),g=n(966),v=n(411),m=n(1417),_=n(310);function y(e,t){!t||!t.lines||t.lines.length<=0||t.lines.forEach((function(t){t.layoutType===v.DOCLayoutType.TextLine&&e.push({pos:t.range.pos,len:t.range.len}),t.layoutType===v.DOCLayoutType.TableLine&&t.tablecells&&t.tablecells.length>0&&(t.tablecells.forEach((function(t){t.cell_page&&t.cell_page.lines&&t.cell_page.lines.length>0&&y(e,t.cell_page),t.diagCell&&t.diagCell.pages.forEach((function(t){y(e,t)}))})),t.is_broken_after||e.push({pos:t.range.end-1,len:1})),t.layoutType===v.DOCLayoutType.SnippetLine&&e.push({pos:t.range.pos,len:t.range.len})}))}function b(e,t){var n=e.getLayoutPageCache(t);if(!n)return[];var i=[];n.mainpages.forEach((function(e){y(i,e);var t=e.footnotes,n=e.endnotes;t&&t.notes.forEach((function(e){y(i,e.note_page)})),n&&n.notes.forEach((function(e){y(i,e.note_page)}))})),i.sort((function(e,t){return e.pos-t.pos}));var o=[];return i.forEach((function(e){var t=o.length>0?o[o.length-1]:null;t&&t.pos+t.len===e.pos?t.len+=e.len:o.push(e)})),o}function T(e,t,n){var i=e.typoinfo.getLayoutPageCache(t);if(!i||!i.range)return null;var o=n&&i.header&&i.header.range||!n&&i.footer&&i.footer.range;return o&&o.len>0?o:null}function C(e,t,n,i){var o=e.typoinfo.getLayoutPageCache(t);if(!o||o.isMoc)return[];var a=function(e){return!!(e.has_textbox&&e.textbox_page&&e.textbox_page.range&&e.textbox_page.range.len)&&(n.pos<=e.pos&&e.pos<n.pos+n.len)},r=function(e){if(!e)return[];var t=e.layers.getBottomShapeCards().filter(a),n=e.layers.getTopShapeCards().filter(a),i=[];if(e.embed_shape_map)for(var o in e.embed_shape_map){var r=e.embed_shape_map[o];a(r)&&i.push(r)}return t.concat(n).concat(i)};return(!i&&r(o)||i&&r(o.decorativePage)).map((function(e){return e.textbox_page.range}))}function k(e,t,n,i,o){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=e.doc,u=[],c=function(e){return e.range.pos>=t},h=window.APP.appApi.getCommentShowStatus(),d=h.commentPanel;if(!d){if(!i){var g=Object(f.getBubblesByRange)(s,t,n-t);a&&(g=g.filter(c)),g&&g.length>0&&u.push.apply(u,l()(g))}if(!o){var v=Object(p.b)(e,t,n-t,r).filter(c);v&&v.length>0&&u.push.apply(u,l()(v))}}return u}function w(e,t){return e.range.pos!==t.range.pos?e.range.pos-t.range.pos:"comment"===e.type&&"comment"===t.type?e.range.len-t.range.len:"comment"!==e.type&&"comment"!==t.type?e.date!==t.date?e.date<t.date?-1:1:e.len!==t.len?e.len-t.len:e.type<t.type?-1:1:"comment"===e.type?-1:1}function S(e,t,n,i,o){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=e.typoinfo,s=e.typoinfo.updater;s&&!o&&(!t||t.length<=0?s.updateViewport():s.updatePages({from:t[0],to:t[t.length-1]}));var u=function(e,t,n){void 0!==t&&e.forEach((function(e){e.setPageIndex&&e.setPageIndex(t,n)}))},c=[];return!t||t.length<=0||(o?t.forEach((function(t){var o=t>=0&&t<r.pageCount?r.layout_pages[t]:null,a=o&&o.page&&o.page.range;if(a){var s=k(e,a.pos,a.pos+a.len,n,i,!0,t).sort(w);s.length>0&&(u(s,t,g.DOC_TYPE.main),c.push.apply(c,l()(s)))}})):t.forEach((function(t){var o=T(e,t,!0);if(o){var s=k(e,o.pos,o.pos+o.len,n,i,!0,t);C(e,t,o,!0).forEach((function(o){var a=k(e,o.pos,o.pos+o.len,n,i,!0,t);s.push.apply(s,l()(a))})),s.length>0&&(u(s,t,g.DOC_TYPE.head),c.push.apply(c,l()(s)))}b(r,t).forEach((function(o){var r=k(e,o.pos,o.pos+o.len,n,i,a,t).sort(w);C(e,t,o,!1).forEach((function(o){var a=k(e,o.pos,o.pos+o.len,n,i,!0,t);r.push.apply(r,l()(a))})),r.length>0&&(u(r,t,g.DOC_TYPE.main),c.push.apply(c,l()(r)))}));var h=T(e,t,!1);if(h){var d=k(e,h.pos,h.pos+h.len,n,i,!0,t);C(e,t,h,!0).forEach((function(o){var a=k(e,o.pos,o.pos+o.len,n,i,!0,t);d.push.apply(d,l()(a))})),d.length>0&&(u(d,t,g.DOC_TYPE.foot),c.push.apply(c,l()(d)))}}))),c}function P(e,t,n){return e.comments.collectByPlaceHolder(t,n,(function(t){var n=t._node,i=Object(f.getCommentId)(e,n);return{comment_id:i.comment_id,comment_type:i.comment_type,type:n.type,pos:n.pos,len:n.len,rc_id:n.rc_id,author:n.author,content:n.content,date:f.commentsUtil.getTime(n.date),body:{pos:n.body.pos,len:n.body.len}}}))}var I=function(){function e(t,n){o()(this,e),this.doc=t,this.comments=t.comments,this.dataLogic=t.getDataLogic("final"),this.reviewEventMgrs=n,this.cmtBubbles=t.commentBubbles,this.specEventRange=void 0}return r()(e,[{key:"onInsertText",value:function(e,t,n,i){this.needRecordTextChanged(t,n)&&this.recordSpecEventRange(t,n)}},{key:"onDeleteText",value:function(e,t,n){this.needRecordTextChanged(t,n)&&this.recordSpecEventRange(t,n)}},{key:"onChpxChanged",value:function(e,t){this.onSetProp(e,t)}},{key:"onPapxChanged",value:function(e,t){this.onSetProp(e,t)}},{key:"onSetProp",value:function(e,t){var n=this.dataLogic.getText(t.pos,t.len);this.needRecordTextChanged(t.pos,n)}},{key:"lockEvents",value:function(){this.reviewEventMgrs.lockEvents()}},{key:"unlockEvents",value:function(){this.reviewEventMgrs.unlockEvents()}},{key:"needRecordTextChanged",value:function(e,t){return this.reviewEventMgrs.needRecordTextChanged(e,t)}},{key:"recordSpecEventRange",value:function(e,t){this.specEventRange||(this.specEventRange={pos:e,len:t.length,text:t})}},{key:"dispatchSpecEvent",value:function(){return!!this.specEventRange&&(this.specEventRange.type=g.NOTIFY_TYPE.delInsSame,c.default.dispatchEvent(c.default.comments.COMMENTS_PARAS_INVALID,this.specEventRange),this.specEventRange=void 0,!0)}},{key:"updateComponent",value:function(e,t,n){var i=n.pageNo,o=n.pos;this.locked||(t||this.isRangeIntersect(e.typoinfo,{pageNo:i,pos:o}))&&this.dispatchEvent()}},{key:"dispatchEvent",value:function(){var e=window.APP.workspace,t=e.updateDisabled&&!e.uilOperation;if(this.locked||t)return!1;this.lockEvents();var n=this.dispatchInsertTextEvent(),i=this.dispatchDeleteTextEvent(),o=this.dispatchInsertCommentsEvent(),a=this.dispatchDeleteCommentsEvent(),r=void 0;return n||i||(r=this.dispatchSetPropEvent()),n||i||o||a||r||this.dispatchSpecEvent(),this.clearEvents(),this.unlockEvents(),!0}},{key:"dispatchInsertCommentsEvent",value:function(){var e=this.reviewEventMgrs.getInsComments();if(!e.length)return!1;var t={type:"InsertComment"};if(1===e.length){var n=e[0].end-1;t.comments=Object(f.getBubbleByPlaceHolder)(this.doc,n),t.woUserId=e[0].woUserId}return c.default.dispatchEvent(c.default.comments.COMMENTS_PARAS_INVALID,t),!0}},{key:"dispatchDeleteCommentsEvent",value:function(){var e=this.reviewEventMgrs.getDelComments();if(!e.length)return!1;var t={type:"RemoveComment"};if(1===e.length){var n=e[0],i=this.cmtBubbles.getBubbleByRange(n.begin,n.end-n.begin)||this.cmtBubbles.getBubbleByRange(n.begin,n.end-n.begin-1);t.comments=i}return c.default.dispatchEvent(c.default.comments.COMMENTS_PARAS_INVALID,t),!0}},{key:"dispatchInsertTextEvent",value:function(){var e=this.reviewEventMgrs.getInsRanges();if(!e.length)return!1;var t=e[0],n={pos:t.pos,len:t.len,insRgs:e};return this.doc.getSubDocType(n.pos)===h.Comment?n.type=g.NOTIFY_TYPE.insertCommentText:n.type=g.NOTIFY_TYPE.insertText,c.default.dispatchEvent(c.default.comments.COMMENTS_PARAS_INVALID,n),!0}},{key:"dispatchDeleteTextEvent",value:function(){var e=this.reviewEventMgrs.getDelRanges();if(!e.length)return!1;var t=e[0],n={pos:t.pos,delLen:t.data.delLen,delRgs:e};return this.doc.getSubDocType(n.pos)===h.Comment?n.type=g.NOTIFY_TYPE.deleteCommentText:n.type=g.NOTIFY_TYPE.deleteText,c.default.dispatchEvent(c.default.comments.COMMENTS_PARAS_INVALID,n),!0}},{key:"dispatchSetPropEvent",value:function(){var e=this.reviewEventMgrs.getPropRanges();if(!e.length)return!1;var t={pos:e[0].pos,propRgs:e,type:g.NOTIFY_TYPE.setProp};return c.default.dispatchEvent(c.default.comments.COMMENTS_PARAS_INVALID,t),!0}},{key:"isRangeIntersect",value:function(e,t){var n=t.pageNo,i=t.pos,o=this.reviewEventMgrs.getDelRanges();if(o.length>0&&o.some((function(t){if(void 0!==i&&i>=t.begin&&i<t.end)return!0;if(void 0!==n){var o=e.getLayoutPageCache(n),a=o&&o.getMainRange();if(a&&a.pos<=t.end&&t.begin<=a.pos+a.len)return!0}return!1})))return!0;var a=this.reviewEventMgrs.getDelComments();if(a.length>0){var r=window.APP.workspace.canvasHandler.getCvsList().reduce((function(t,n,i){var o=e.layout_pages[n].range;if(!o)return t;var a=o.pos,r=o.pos+o.len;return 0===i?(t.begin=a,t.end=r):(t.begin=Math.min(a,t.begin),t.end=Math.max(r,t.end)),t}),{begin:0,end:1});if(a.some((function(e){return!(r.end<e.begin||r.begin>=e.end)})))return!0}return!1}},{key:"clearEvents",value:function(){this.reviewEventMgrs.clear(),this.specEventRange=void 0}},{key:"locked",get:function(){return this.reviewEventMgrs.locked}}]),e}(),E=function(){function e(t,n){o()(this,e),this.doc=t,this.comments=t.comments,this.reviewEventMgrs=n,this.dataLogic=t.getDataLogic("final"),this.insCmts=[],this.delCmts=[],this.insertRange=void 0,this.deleteRange=void 0,this.isCmtsChanged=!1}return r()(e,[{key:"lockEvents",value:function(){this.reviewEventMgrs.lockEvents()}},{key:"unlockEvents",value:function(){this.reviewEventMgrs.unlockEvents()}},{key:"needRecordTextChanged",value:function(e,t){return this.reviewEventMgrs.needRecordTextChanged(e,t)}},{key:"onInsertText",value:function(e,t,n){this.needRecordTextChanged(t,n)&&(this.deleteRange&&t===this.deleteRange.pos&&n.length===this.deleteRange.len?this.deleteRange=void 0:this.insertRange?t===this.insertRange.pos+this.insertRange.len&&(this.insertRange.len+=n.length,this.insertRange.text+=n):this.insertRange={pos:t,len:n.length,text:n})}},{key:"onBeforeDeleteText",value:function(e,t,n){var i=this.dataLogic.getText(t,n.length),o=this.onDeleteCommentsInRange(t,i);this.updateFlag(!!o)}},{key:"onDeleteText",value:function(e,t,n){this.needRecordTextChanged(t,n)&&(this.insertRange?t===this.insertRange.pos&&n.length===this.insertRange.len?this.insertRange=void 0:t>=this.insertRange.pos&&t+n.length<=this.insertRange.pos+this.insertRange.len&&(this.insertRange.text=this.insertRange.text.slice(0,t-this.insertRange.pos)+this.insertRange.text.slice(t-this.insertRange.pos+n.length),this.insertRange.len-=n.length):this.deleteRange||(this.deleteRange={pos:t,len:n.length,text:n}))}},{key:"onDeleteCommentsInRange",value:function(e,t){for(var n=this,i=!1,o=function(o){if(t.charCodeAt(o)===d.a&&!n.delCmts.find((function(t){return t.end===e+o+1}))){var a=n.comments.getCommentByCommentEnd(e+o+1);a&&n.delCmts.push({begin:a.begin,end:a.end}),i=i||a}},a=0;a<t.length;++a)o(a);return i}},{key:"onInsertComment",value:function(e,t){var n=this.delCmts.findIndex((function(e){return e.end===t.end}));-1!==n?this.delCmts.splice(n,1):this.insCmts.push({end:t.end}),this.updateFlag(!0)}},{key:"onRemoveComment",value:function(e,t){var n=this.insCmts.findIndex((function(e){return e.end===t.end}));-1!==n?this.insCmts.splice(n,1):this.delCmts.push({begin:t.begin,end:t.end}),this.updateFlag(!0)}},{key:"updateFlag",value:function(e){this.isCmtsChanged=e}},{key:"dispatchCommentsDataEvent",value:function(){(this.isCmtsChanged||this.insertRange||this.deleteRange)&&(this.locked||window.APP.workspace.updateDisabled||(this.lockEvents(),this.dispatchCmtsUpdateEvent(),this.dispatchCmtsInsertEvent(),this.dispatchCmtsDeleteEvent(),this.dispatchInsertTextEvent(),this.dispatchDeleteTextEvent(),this.updateFlag(!1),this.unlockEvents()))}},{key:"dispatchCmtsUpdateEvent",value:function(){this.isCmtsChanged=!1,this.insCmts.length>0||this.delCmts.length>0||c.default.dispatchEvent(c.default.comments.COMMENTS_DATA_CHANGED,{type:g.NOTIFY_TYPE.updateComments})}},{key:"dispatchCmtsInsertEvent",value:function(){this.insCmts.length<=0||(c.default.dispatchEvent(c.default.comments.COMMENTS_DATA_CHANGED,{type:g.NOTIFY_TYPE.insertComments,items:this.insCmts.slice()}),this.insCmts.splice(0))}},{key:"dispatchCmtsDeleteEvent",value:function(){this.delCmts.length<=0||(c.default.dispatchEvent(c.default.comments.COMMENTS_DATA_CHANGED,{type:g.NOTIFY_TYPE.removeComments,items:this.delCmts.slice()}),this.delCmts.splice(0))}},{key:"dispatchInsertTextEvent",value:function(){if(this.insertRange){var e=void 0;e=this.doc.getSubDocType(this.insertRange.pos)===h.Comment?g.NOTIFY_TYPE.insertCommentText:g.NOTIFY_TYPE.insertText,c.default.dispatchEvent(c.default.comments.COMMENTS_DATA_CHANGED,{type:e,items:this.insertRange}),this.insertRange=void 0}}},{key:"dispatchDeleteTextEvent",value:function(){if(this.deleteRange){var e=void 0;e=this.doc.getSubDocType(this.deleteRange.pos)===h.Comment?g.NOTIFY_TYPE.deleteCommentText:g.NOTIFY_TYPE.deleteText,c.default.dispatchEvent(c.default.comments.COMMENTS_DATA_CHANGED,{type:e,items:this.deleteRange}),this.deleteRange=void 0}}},{key:"locked",get:function(){return this.reviewEventMgrs.locked}}]),e}(),O=function(){function e(t){o()(this,e),this.doc=t,this.comments=t.comments,this.cmtBubbles=this.doc.commentBubbles,this.dataLogic=t.getDataLogic("final"),this.reviewEventMgr=new I(t,this),this.commentEventMgr=new E(t,this),this.invalidInsertRanges=new m.default,this.invalidPropRanges=new m.default,this.invalidDeleteRanges=new m.default(_.IT.lower,!1),this.invalidDelComments=new _.ITToolkit(_.IT.outer,_.IT.Crossing,!1),this.cmtAdded={},this.cmtRemoved={},this.cmtBubblesAdded={},this.cmtBubblesRemoved={},this.locked=!1,Object(u.default)(this),this.comments.attachObserver(this),this.dataLogic.attachObserver(this),this.cmtBubbles.attachObserver(this),this.attachObserver(this.reviewEventMgr),this.attachObserver(this.commentEventMgr)}return r()(e,[{key:"needRecordTextChanged",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!window.APP.workspace&&(!n||this.doc.getSubDocType(e)!==h.Comment)}},{key:"lockEvents",value:function(){this.locked=!0}},{key:"unlockEvents",value:function(){this.locked=!1}},{key:"onInsertText",value:function(e,t,n,i){if(n.length){if(!this.needRecordTextChanged(t,n))return this.invalidInsertRanges.expand(t,n.length),this.invalidDeleteRanges.expand(t,n.length),this.invalidPropRanges.expand(t,n.length),void this.invalidDelComments.expand(t,n.length);var o=this.invalidDeleteRanges.mapInRange(t,t,_.IT.mapToNode,_.IT.intersectTest);if(o.length>0){o.length>1&&console.warn("more than one invalid delete range!");var a=o[0].data.delLen,r=n.length;r>=a?this.invalidDeleteRanges.detachNode(o[0]):o[0].data.delLen-=r,this.invalidDeleteRanges.expand(t,n.length),this.invalidInsertRanges.expand(t,n.length),r>a&&this.invalidInsertRanges.todo({begin:t+a,end:t+n.length})}else this.invalidDeleteRanges.expand(t,n.length),this.invalidInsertRanges.expand(t,n.length),this.invalidInsertRanges.todo({begin:t,end:t+n.length});this.invalidPropRanges.expand(t,n.length),this.invalidDelComments.expand(t,n.length),this._dispatch("onInsertText",t,n,i)}}},{key:"onBeforeDeleteText",value:function(e,t,n){var i=this.dataLogic.getText(t,n.length);this.onDeleteCommentsInRange(t,i),this._dispatch("onBeforeDeleteText",t,i)}},{key:"onDeleteText",value:function(e,t,n){var i=this;if(n.length){if(!this.needRecordTextChanged(t,n))return this.invalidInsertRanges.remove(t,n.length),this.invalidDeleteRanges.remove(t,n.length),this.invalidPropRanges.remove(t,n.length),void this.invalidDelComments.remove(t,n.length);var o=n.length;if(this.invalidInsertRanges.mapInRange(t,t+n.length).forEach((function(e){o-=_.IT.lengthOfIntersect(t,t+n.length,e.begin,e.end)})),o>0){this.invalidDeleteRanges.mapInRange(t,t+n.length,_.IT.mapToNode,_.IT.intersectTest).forEach((function(e){o+=e.data.delLen,i.invalidDeleteRanges.detachNode(e)})),this.invalidDeleteRanges.todo({begin:t,end:t+n.length}),this.invalidDeleteRanges.remove(t,n.length);var a=this.invalidDeleteRanges.mapInRange(t,t,_.IT.mapToNode,_.IT.intersectTest);1!==a.length&&console.warn("invalid delete ranges count wrong!"),a.length&&(a[0].data={delLen:o})}this.invalidInsertRanges.remove(t,n.length),this.invalidPropRanges.remove(t,n.length),this.invalidDelComments.remove(t,n.length),this._dispatch("onDeleteText",t,n)}}},{key:"onChpxChanged",value:function(e,t){if(t.len){var n=this.dataLogic.getText(t.pos,t.len);if(!this.needRecordTextChanged(t.pos,n,!0))return!1;this.invalidPropRanges.todo({begin:t.pos,end:t.pos+t.len}),this._dispatch("onChpxChanged",t)}}},{key:"onPapxChanged",value:function(e,t){if(!t.len)return!1;var n=this.dataLogic.getText(t.pos,t.len);if(!this.needRecordTextChanged(t.pos,n,!0))return!1;this.invalidPropRanges.todo({begin:t.pos,end:t.pos+t.len}),this._dispatch("onPapxChanged",t)}},{key:"onInsertComment",value:function(e,t){var n=this,i=t.comment_id,o=t.rc_id,a=t.refId,r=i&&this.cmtRemoved[i]||o&&this.cmtRemoved[o]||a&&this.cmtRemoved[a];if(r)Object.keys(this.cmtRemoved).forEach((function(e){n.cmtRemoved[e]==r&&delete n.cmtRemoved[e]})),r.isOrphan()?console.warn("Found the same comment to detach"):this.invalidDelComments.detachNode(r);else{var s={comment_id:i,rc_id:o,refId:a,woUserId:t.woUserId};i&&(this.cmtAdded[i]=s),o&&(this.cmtAdded[o]=s),a&&(this.cmtAdded[a]=s)}e&&this._dispatch("onInsertComment",t)}},{key:"onRemoveComment",value:function(e,t){var n=this,i=t.begin,o=t.end,a=t.comment_id,r=t.rc_id,s=t.refId,l=a&&this.cmtAdded[a]||r&&this.cmtAdded[r]||s&&this.cmtAdded[s];if(l)Object.keys(this.cmtAdded).forEach((function(e){n.cmtAdded[e]==l&&delete n.cmtAdded[e]}));else{var u=new _.ITRange(i,o);Object.assign(u,{comment_id:a,rc_id:r}),this.invalidDelComments.attachNode(u),a&&(this.cmtRemoved[a]=u),r&&(this.cmtRemoved[r]=u),s&&(this.cmtRemoved[s]=u)}e&&this._dispatch("onRemoveComment",t)}},{key:"onDeleteCommentsInRange",value:function(e,t){for(var n=0;n<t.length;++n)if(t.charCodeAt(n)===d.a){var i=this.comments.getCommentByCommentEnd(e+n+1);i&&this.onRemoveComment(this.comments,i)}}},{key:"onAddCommentBubble",value:function(e,t,n){this.cmtBubblesRemoved[t.id]?delete this.cmtBubblesRemoved[t.id]:this.cmtBubblesAdded[t.id]={newBubble:t,splitBubble:n}}},{key:"onRemoveCommentBubble",value:function(e,t,n){if(!this.cmtBubblesAdded[t.id])return n&&this.cmtBubblesAdded[n.id]?(delete this.cmtBubblesAdded[n.id],void(n.id=t.id)):void(this.cmtBubblesRemoved[t.id]={bubble:t,mergedBubble:n});delete this.cmtBubblesAdded[t.id]}},{key:"onCommentDataChanged",value:function(e,t,n){this.dataChangedCmts||(this.dataChangedCmts={});var i=t.refId||t.comment_id||t.rc_id;this.dataChangedCmts[i]||(this.dataChangedCmts[i]={comment:t,diff:n})}},{key:"onModifyComments",value:function(e){var t=this;if(this.dataChangedCmts&&Object.values(this.dataChangedCmts).length){var n=Object.values(this.dataChangedCmts);delete this.dataChangedCmts;var i={};n.forEach((function(e){var n=Object(f.getBubbleByPlaceHolder)(t.doc,e.comment.end-1);n&&!i[n.id]&&(i[n.id]=n)}));var o=e&&e.userId,a=e&&e.done||n[0].comment.isDone;this._dispatch("onModifyComments",{userId:o,bubbles:Object.values(i),changes:n,done:a})}}},{key:"onReplaceRcId",value:function(e,t,n){e.idCacheMgr.clearId(n),this.onRemoveComment(null,t),t._setRcId(n),this.onInsertComment(null,t);var i=this.cmtBubbles.getBubbleByPlaceHolder(t.end-1);if(i){var o=i.id,a=this.cmtBubbles.idMgr.getId((function(e){return e.key===n}),!1);a&&o!==a&&(this.cmtBubbles._setBubbleId(i,a),this.cmtBubbles.idMgr.clearId(a),this.cmtBubblesAdded[o]&&(delete this.cmtBubblesAdded[o],this.cmtBubblesRemoved[a]&&delete this.cmtBubblesRemoved[a]))}else console.warn("Can not find comment bubble by comment!")}},{key:"updateCmdUserId",value:function(e){this.cmdUserId=e}},{key:"updateCommentBubbles",value:function(){var e=this;if(this.locked)return!1;this.lockEvents();var t={},n=function(e,n,i){t[e]||(t[e]={}),"insertComments"===n||"deleteComments"===n?(t[e][n]||(t[e][n]=[]),t[e][n].push(i)):t[e][n]=i};Object.keys(this.cmtBubblesAdded).forEach((function(t){n(t,"add",!0),e.cmtBubblesAdded[t].splitBubble&&n(e.cmtBubblesAdded[t].splitBubble.id,"split",!0)})),Object.keys(this.cmtBubblesRemoved).forEach((function(t){n(t,"remove",!0),e.cmtBubblesRemoved[t].mergedBubble&&n(e.cmtBubblesRemoved[t].mergedBubble.id,"merge",!0)})),this.getInsComments().forEach((function(t){var i=Object(f.getBubbleByPlaceHolder)(e.doc,t.end-1),o=t.comment_id,a=t.rc_id,r=t.begin,s=t.end;n(i.id,"insertComments",{pos:r,len:s-r,comment_id:o,rc_id:a})})),this.getDelComments().forEach((function(t){var i=e.cmtBubbles.getBubbleByRange(t.begin,t.end-t.begin)||e.cmtBubbles.getBubbleByRange(t.begin,t.end-t.begin-1);if(i){var o=t.comment_id,a=t.rc_id;n(i.id,"deleteComments",{comment_id:o,rc_id:a})}}));var i=Object.keys(t);return i.length&&(i.forEach((function(i){if(t[i].add||t[i].split||t[i].merge||t[i].insertComments||t[i].deleteComments){var o=Object(f.getBubbleDataById)(e.doc,i);n(i,"bubble",o)}})),this._dispatch("onUpdateCommentBubbles",{userId:this.cmdUserId,items:t}),console.log("***** updateCommentBubbles *****",t),this.clear(!0)),this.unlockEvents(),!0}},{key:"dispatchCommentBubbleEvent",value:function(){window.APP.commentShowStatus.commentPanel&&this.updateCommentBubbles()&&this.clear()}},{key:"dispatchCommentsDataEvent",value:function(){return this.dispatchCommentBubbleEvent(),this.commentEventMgr.dispatchCommentsDataEvent()}},{key:"dispatchEvent",value:function(){return this.dispatchCommentBubbleEvent(),this.reviewEventMgr.dispatchEvent()}},{key:"updateComponent",value:function(e,t,n){var i=n.pageNo,o=n.pos;return this.dispatchCommentBubbleEvent(),this.reviewEventMgr.updateComponent(e,t,{pageNo:i,pos:o})}},{key:"getInsRanges",value:function(){var e=[];return this.invalidInsertRanges.forEachNode((function(t){e.push(t)})),e}},{key:"getDelRanges",value:function(){var e=[];return this.invalidDeleteRanges.forEachNode((function(t){e.push(t)})),e}},{key:"getPropRanges",value:function(){var e=[];return this.invalidPropRanges.forEachNode((function(t){e.push(t)})),e}},{key:"getInsComments",value:function(){var e=this,t=Array.from(new Set(Object.values(this.cmtAdded)));return t.forEach((function(t){var n=e.comments.getCommentById(t.refId,t.comment_id,t.rc_id);n?(t.begin=n.begin,t.end=n.end):console.warn("Looking for comment by id failed")})),t}},{key:"getDelComments",value:function(){return Array.from(new Set(Object.values(this.cmtRemoved)))}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(this.invalidInsertRanges.detachAllNodes(),this.invalidDeleteRanges.detachAllNodes(),this.invalidPropRanges.detachAllNodes()),this.invalidDelComments.detachAllNodes(),this.cmtAdded={},this.cmtRemoved={},this.cmtBubblesAdded={},this.cmtBubblesRemoved={},delete this.cmdUserId}}]),e}()},3488:function(e,t,n){var i=n(936),o=n(563);e.exports=function(e,t,n){var a=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return o(n)&&(a="leading"in n?!!n.leading:a,r="trailing"in n?!!n.trailing:r),i(e,t,{leading:a,maxWait:t,trailing:r})}},3489:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"N",(function(){return o})),n.d(t,"n",(function(){return a})),n.d(t,"L",(function(){return r})),n.d(t,"i",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"o",(function(){return u})),n.d(t,"M",(function(){return c})),n.d(t,"F",(function(){return h})),n.d(t,"E",(function(){return d})),n.d(t,"m",(function(){return p})),n.d(t,"t",(function(){return f})),n.d(t,"y",(function(){return g})),n.d(t,"P",(function(){return v})),n.d(t,"I",(function(){return m})),n.d(t,"k",(function(){return _})),n.d(t,"j",(function(){return y})),n.d(t,"a",(function(){return b})),n.d(t,"c",(function(){return T})),n.d(t,"e",(function(){return C})),n.d(t,"l",(function(){return k})),n.d(t,"p",(function(){return w})),n.d(t,"r",(function(){return S})),n.d(t,"s",(function(){return P})),n.d(t,"u",(function(){return I})),n.d(t,"v",(function(){return E})),n.d(t,"w",(function(){return O})),n.d(t,"x",(function(){return x})),n.d(t,"A",(function(){return R})),n.d(t,"D",(function(){return N})),n.d(t,"H",(function(){return A})),n.d(t,"K",(function(){return D})),n.d(t,"O",(function(){return M})),n.d(t,"Q",(function(){return L})),n.d(t,"R",(function(){return F})),n.d(t,"S",(function(){return B})),n.d(t,"B",(function(){return H})),n.d(t,"C",(function(){return G})),n.d(t,"q",(function(){return W})),n.d(t,"G",(function(){return j})),n.d(t,"g",(function(){return U})),n.d(t,"z",(function(){return V})),n.d(t,"J",(function(){return Y})),n.d(t,"f",(function(){return z})),n.d(t,"h",(function(){return K}));var i=8,o=9,a=13,r=16,s=17,l=18,u=27,c=32,h=33,d=34,p=35,f=36,g=37,v=38,m=39,_=40,y=46,b=65,T=66,C=67,k=69,w=70,S=71,P=72,I=73,E=74,O=75,x=76,R=77,N=80,A=82,D=83,M=85,L=88,F=89,B=90,H=91,G=93,W=114,j=188,U=190,V=219,Y=221,z="CMD_OR_CTRL",K={NUM0:[48,96],NUM1:[49,97],NUM2:[50,98],NUM3:[51,99],NUM4:[52,100],NUM5:[53,101],NUM6:[54,102],NUM7:[55,103],NUM8:[56,104],NUM9:[57,105],NUM_ADD:[187,107],NUM_SUBTRACT:[189,109]}},3490:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=0,o=1},3828:function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var i=n(2),o=n.n(i),a=n(1),r=n.n(a),s={"zh-MO_radstr":{script:"Hant",type:2},"zh-TW_pronun":{script:"Hant",type:2},"zh-MO_stroke":{script:"Hant",type:2},"de-DE_phoneb":{script:"Latn",type:0},"tzm-Latn":{script:"Latn",type:0},"sd-Arab":{script:"Arab",type:1},"mn-Mong":{script:"Mong",type:1},"tg-Cyrl":{script:"Cyrl",type:0},"tzm-Tfng":{script:"Tfng",type:0},"az-Cyrl":{script:"Cyrl",type:0},"bs-Cyrl":{script:"Cyrl",type:0},"es-CU":{script:"Latn",type:0},"es-US":{script:"Latn",type:0},"es-NI":{script:"Latn",type:0},"sr-Latn":{script:"Latn",type:0},"es-HN":{script:"Latn",type:0},"en-SG":{script:"Latn",type:0},"es-SV":{script:"Latn",type:0},"en-MY":{script:"Latn",type:0},"es-BO":{script:"Latn",type:0},"ar-QA":{script:"Arab",type:1},"en-IN":{script:"Latn",type:0},"fr-HT":{script:"Latn",type:0},"ar-AE":{script:"Arab",type:1},"es-CL":{script:"Latn",type:0},"uz-Cyrl":{script:"Cyrl",type:0},"sr-Cyrl-ME":{script:"Cyrl",type:0},"ar-LB":{script:"Arab",type:1},"sr-Latn-ME":{script:"Latn",type:0},"en-TT":{script:"Latn",type:0},"ar-JO":{script:"Arab",type:1},"sr-Cyrl-RS":{script:"Cyrl",type:0},"fr-SN":{script:"Latn",type:0},"es-PE":{script:"Latn",type:0},"uz-Latn":{script:"Latn",type:0},"fr-CI":{script:"Latn",type:0},"smn-FI":{script:"Latn",type:0},"sr-Latn-RS":{script:"Latn",type:0},"fr-CD":{script:"Latn",type:0},"en-029":{script:"Latn",type:0},"es-EC":{script:"Latn",type:0},"ar-YE":{script:"Arab",type:1},"bs-Cyrl-BA":{script:"Cyrl",type:0},"fr-RE":{script:"Latn",type:0},"es-VE":{script:"Latn",type:0},"en-JM":{script:"Latn",type:0},"ka-GE_modern":{script:"Geor",type:0},"ar-OM":{script:"Arab",type:1},"fr-029":{script:"Latn",type:0},"es-DO":{script:"Latn",type:0},"en-ZA":{script:"Latn",type:0},"ar-TN":{script:"Arab",type:1},"fr-MC":{script:"Latn",type:0},"ar-MA":{script:"Arab",type:1},"fr-LU":{script:"Latn",type:0},"fr-ML":{script:"Latn",type:0},"uk-UA":{script:"Cyrl",type:0},"yi-001":{script:"Hebr",type:1},"de-LI":{script:"Latn",type:0},"zh-MO":{script:"Hant",type:2},"smj-NO":{script:"Latn",type:0},"en-CA":{script:"Latn",type:0},"ar-LY":{script:"Arab",type:1},"sd-Arab-PK":{script:"Arab",type:1},"quz-PE":{script:"Latn",type:0},"se-FI":{script:"Latn",type:0},"fy-NL":{script:"Latn",type:0},"fr-CA":{script:"Latn",type:0},bs:{script:"Latn",type:0},"en-AU":{script:"Latn",type:0},"rw-RW":{script:"Latn",type:0},"ar-EG":{script:"Arab",type:1},"es-PY":{script:"Latn",type:0},"ti-ER":{script:"Ethi",type:0},"ti-ET":{script:"Ethi",type:0},"quz-EC":{script:"Latn",type:0},"ff-Latn-SN":{script:"Latn",type:0},"ne-IN":{script:"Deva",type:1},"en-BZ":{script:"Latn",type:0},"es-ES":{script:"Latn",type:0},"smj-SE":{script:"Latn",type:0},"sr-Latn-BA":{script:"Latn",type:0},"es-CR":{script:"Latn",type:0},"tzm-Latn-DZ":{script:"Latn",type:0},"bn-BD":{script:"Beng",type:1},"az-Cyrl-AZ":{script:"Cyrl",type:0},"ur-IN":{script:"Arab",type:1},"ig-NG":{script:"Latn",type:0},"ru-MD":{script:"Cyrl",type:0},"ro-MD":{script:"Latn",type:0},"nn-NO":{script:"Latn",type:0},"nl-BE":{script:"Latn",type:0},"it-CH":{script:"Latn",type:0},"es-MX":{script:"Latn",type:0},"en-GB":{script:"Latn",type:0},"fr-CM":{script:"Latn",type:0},"ar-SY":{script:"Arab",type:1},"fr-BE":{script:"Latn",type:0},"ca-ES-valencia":{script:"Latn",type:0},"zh-HK":{script:"Hant",type:2},"ku-Arab-IQ":{script:"Arab",type:1},"sah-RU":{script:"Cyrl",type:0},"gsw-FR":{script:"Latn",type:0},"co-FR":{script:"Latn",type:0},"oc-FR":{script:"Latn",type:0},"br-FR":{script:"Latn",type:0},"ta-IN":{script:"Taml",type:1},"so-SO":{script:"Latn",type:0},"ar-DZ":{script:"Arab",type:1},"fr-CH":{script:"Latn",type:0},"moh-CA":{script:"Latn",type:0},"ii-CN":{script:"Yiii",type:2},"uz-Cyrl-UZ":{script:"Cyrl",type:0},"dz-BT":{script:"Tibt",type:1},"hsb-DE":{script:"Latn",type:0},"haw-US":{script:"Latn",type:0},"om-ET":{script:"Latn",type:0},"zh-CN":{script:"Hans",type:2},"pap-029":{script:"Latn",type:0},"tn-ZA":{script:"Latn",type:0},"kl-GL":{script:"Latn",type:0},"lb-LU":{script:"Latn",type:0},"sms-FI":{script:"Latn",type:0},"ba-RU":{script:"Cyrl",type:0},"az-Latn":{script:"Latn",type:0},"kr-NG":{script:"Latn",type:0},"nso-ZA":{script:"Latn",type:0},"quz-BO":{script:"Latn",type:0},"ar-BH":{script:"Arab",type:1},"mn-Mong-MN":{script:"Mong",type:1},"bin-NG":{script:"Latn",type:0},"yo-NG":{script:"Latn",type:0},"zh-CN_phoneb":{script:"Hans",type:2},"en-PH":{script:"Latn",type:0},"ha-Latn-NG":{script:"Latn",type:0},"en-ZW":{script:"Latn",type:0},"ff-NG":{script:"Latn",type:0},"ibb-NG":{script:"Latn",type:0},"dv-MV":{script:"Thaa",type:1},"en-IE":{script:"Latn",type:0},"ps-AF":{script:"Arab",type:1},"dsb-DE":{script:"Latn",type:0},"iu-Latn-CA":{script:"Latn",type:0},"ks-Arab":{script:"Arab",type:1},"as-IN":{script:"Beng",type:1},"ta-LK":{script:"Taml",type:1},"nl-NL":{script:"Latn",type:0},"si-LK":{script:"Sinh",type:1},"arn-CL":{script:"Latn",type:0},"ar-SA":{script:"Arab",type:1},"af-ZA":{script:"Latn",type:0},"sd-Deva-IN":{script:"Deva",type:1},"th-TH":{script:"Thai",type:1},"my-MM":{script:"Mymr",type:1},"es-CO":{script:"Latn",type:0},"sma-NO":{script:"Latn",type:0},"ar-IQ":{script:"Arab",type:1},"km-KH":{script:"Khmr",type:1},"sr-Cyrl":{script:"Cyrl",type:0},"bo-CN":{script:"Tibt",type:1},"ml-IN":{script:"Mlym",type:1},"quc-Latn":{script:"Latn",type:0},"rm-CH":{script:"Latn",type:0},"ur-PK":{script:"Arab",type:1},"gu-IN":{script:"Gujr",type:1},"pa-Arab-PK":{script:"Arab",type:1},"en-US":{script:"Latn",type:0},"uz-Latn-UZ":{script:"Latn",type:0},"ky-KG":{script:"Cyrl",type:0},"en-NZ":{script:"Latn",type:0},"mn-MN":{script:"Cyrl",type:0},"en-HK":{script:"Latn",type:0},"tt-RU":{script:"Cyrl",type:0},"mn-Mong-CN":{script:"Mong",type:1},"ja-JP_radstr":{script:"Jpan",type:2},"ve-ZA":{script:"Latn",type:0},"kk-KZ":{script:"Cyrl",type:0},"ms-MY":{script:"Latn",type:0},"cs-CZ":{script:"Latn",type:0},"zh-CN_stroke":{script:"Hans",type:2},"lo-LA":{script:"Laoo",type:1},"es-AR":{script:"Latn",type:0},"se-NO":{script:"Latn",type:0},"de-CH":{script:"Latn",type:0},"mn-Cyrl":{script:"Cyrl",type:0},"mk-MK":{script:"Cyrl",type:0},"mt-MT":{script:"Latn",type:0},"syr-SY":{script:"Syrc",type:1},"quc-Latn-GT":{script:"Latn",type:0},"id-ID":{script:"Latn",type:0},"ka-GE":{script:"Geor",type:0},"zh-SG":{script:"Hans",type:2},"prs-AF":{script:"Arab",type:1},"zu-ZA":{script:"Latn",type:0},"wo-SN":{script:"Latn",type:0},"hu-HU":{script:"Latn",type:0},"st-ZA":{script:"Latn",type:0},"ms-BN":{script:"Latn",type:0},"mr-IN":{script:"Deva",type:1},"se-SE":{script:"Latn",type:0},"pt-PT":{script:"Latn",type:0},"ts-ZA":{script:"Latn",type:0},"es-ES_tradnl":{script:"Latn",type:0},"or-IN":{script:"Orya",type:1},"es-GT":{script:"Latn",type:0},"ga-IE":{script:"Latn",type:0},"fi-FI":{script:"Latn",type:0},"sv-FI":{script:"Latn",type:0},"eu-ES":{script:"Latn",type:0},"te-IN":{script:"Telu",type:1},"lt-LT":{script:"Latn",type:0},"en-ID":{script:"Latn",type:0},"fr-FR":{script:"Latn",type:0},"ne-NP":{script:"Deva",type:1},"mni-IN":{script:"Beng",type:1},"el-GR":{script:"Grek",type:0},"zh-SG_stroke":{script:"Hans",type:2},"et-EE":{script:"Latn",type:0},"zh-HK_radstr":{script:"Hant",type:2},"gd-GB":{script:"Latn",type:0},"am-ET":{script:"Ethi",type:0},"xh-ZA":{script:"Latn",type:0},"bg-BG":{script:"Cyrl",type:0},"he-IL":{script:"Hebr",type:1},"lv-LV":{script:"Latn",type:0},"tk-TM":{script:"Latn",type:0},"es-PR":{script:"Latn",type:0},"zh-TW":{script:"Hant",type:2},"tr-TR":{script:"Latn",type:0},"ar-KW":{script:"Arab",type:1},"sr-Cyrl-BA":{script:"Cyrl",type:0},"ko-KR":{script:"Hang",type:2},"zh-SG_phoneb":{script:"Hans",type:2},"vi-VN":{script:"Viet",type:0},"sv-SE":{script:"Latn",type:0},"tzm-Arab-MA":{script:"Arab",type:1},"pa-IN":{script:"Guru",type:1},"kn-IN":{script:"Knda",type:1},"sq-AL":{script:"Latn",type:0},"de-AT":{script:"Latn",type:0},"fr-MA":{script:"Latn",type:0},"ks-Deva-IN":{script:"Deva",type:1},"es-UY":{script:"Latn",type:0},"es-PA":{script:"Latn",type:0},"hr-HR":{script:"Latn",type:0},"fa-IR":{script:"Arab",type:1},"be-BY":{script:"Cyrl",type:0},"tg-Cyrl-TJ":{script:"Cyrl",type:0},"sk-SK":{script:"Latn",type:0},"es-419":{script:"Latn",type:0},"sw-KE":{script:"Latn",type:0},"hr-BA":{script:"Latn",type:0},"fo-FO":{script:"Latn",type:0},"ru-RU":{script:"Cyrl",type:0},"az-Latn-AZ":{script:"Latn",type:0},"sl-SI":{script:"Latn",type:0},"is-IS":{script:"Latn",type:0},"ro-RO":{script:"Latn",type:0},"gl-ES":{script:"Latn",type:0},"tn-BW":{script:"Latn",type:0},"fil-PH":{script:"Latn",type:0},"zh-TW_radstr":{script:"Hant",type:2},"pt-BR":{script:"Latn",type:0},"bs-Latn":{script:"Latn",type:0},"kok-IN":{script:"Deva",type:1},"hy-AM":{script:"Armn",type:0},"ja-JP":{script:"Jpan",type:2},"hu-HU_technl":{script:"Latn",type:0},"nb-NO":{script:"Latn",type:0},"it-IT":{script:"Latn",type:0},"cy-GB":{script:"Latn",type:0},"iu-Cans-CA":{script:"Cans",type:0},"sma-SE":{script:"Latn",type:0},"sa-IN":{script:"Deva",type:1},"mi-NZ":{script:"Latn",type:0},"ks-Deva":{script:"Deva",type:1},"pl-PL":{script:"Latn",type:0},"bs-Latn-BA":{script:"Latn",type:0},"tzm-Tfng-MA":{script:"Tfng",type:0},"de-DE":{script:"Latn",type:0},"hi-IN":{script:"Deva",type:1},yi:{script:"Hebr",type:1},"la-001":{script:"Latn",type:0},"chr-Cher-US":{script:"Cher",type:0},"gn-PY":{script:"Latn",type:0},"ca-ES":{script:"Latn",type:0},"ku-Arab":{script:"Arab",type:1},"de-LU":{script:"Latn",type:0},"da-DK":{script:"Latn",type:0},"bn-IN":{script:"Beng",type:1}},l=n(1142),u=1,c=2,h=3,d=4,p=5,f=6,g=7,v=65536,m=131072,_=function e(t){r()(this,e),this.ascii=t.ascii,this.eastasia=t.eastAsia,this.bidi=t.bidi},y=function e(t){if(r()(this,e),t&&t.phColor){var n=t.phColor,i={};null!=n.toRGB&&(i["2rgb"]="#"+n.toRGB.substring(3,9)),null!=n.type&&(i.type=n.type),null!=n.system&&(i.system=n.system),null!=n.sRgb&&(i.srgb=n.sRgb),this.phColor=i}else this.phColor={srgb:16777215,"2rgb":"#FFFFFF",type:0};t&&t.schemeColorMapping?this.schemeColorMapping=t.schemeColorMapping:this.schemeColorMapping=[0,1,2,3,4,5,6,7,8,9,10,11,1,0,3,2,16]},b=function e(t){for(var n in r()(this,e),t)this[n]&&console.log("DOCThemeLangInfo: repeat at "+n),this[n]={},this[n].type=t[n].type,this[n].script=t[n].script},T=function e(t){r()(this,e),this.name=t.name,this.panose=t.panose,this.pitchFamily=t.pitchFamily,this.charset=t.charset},C=function(){function e(t){r()(this,e),this.latinFont=new T(t.latinFont),this.eastAsianFont=new T(t.eastAsianFont),this.complexFont=new T(t.complexScriptFont);var n={};t.supplemental&&t.supplemental.forEach((function(e){n[e.script]=e.typeface})),this.supplemental=n}return o()(e,[{key:"getName",value:function(e,t){var n=this.supplemental[e];return n||t}}]),e}(),k=function e(t){r()(this,e),this.name=t.name,this.major=new C(t.majorFont),this.minor=new C(t.minorFont)},w=function(){function e(t){r()(this,e),this._init(t)}return o()(e,[{key:"_init",value:function(e){this.name=e.name,this.colors=e.colors.map((function(e){var t={};return null!=e.toRGB&&(t["2rgb"]="#"+e.toRGB.substring(3,9)),null!=e.type&&(t.type=e.type),null!=e.system&&(t.system=e.system),null!=e.sRgb&&(t.srgb=e.sRgb),t}))}}]),e}(),S=function(){function e(t){r()(this,e),this._data=t}return o()(e,[{key:"getFillAt",value:function(e){return e<=0?null:this._data.fill[e-1]}},{key:"getLineAt",value:function(e){return e<=0?null:this._data.lines[e-1]}},{key:"getBackgroundFillAt",value:function(e){return e<=0?null:this._data.backgroundFill[e-1]}},{key:"getEffectsAt",value:function(e){return e<=0?null:this._data.effects[e-1]}}]),e}(),P=function e(t){r()(this,e),this.fontScheme=new k(t.fontScheme),this.colorScheme=new w(t.colorScheme),this.formatScheme=new S(t.formatScheme)},I=function(){function e(t,n,i){r()(this,e),this.fontLang=new _(n),this.agent=new y(i),this.themeLangInfo=new b(s),this.name=t.name,this.baseStyle=new P(t.baseStyle)}return o()(e,[{key:"single_reset",value:function(){}},{key:"getCollection",value:function(e){switch(e){case v:return this.baseStyle.fontScheme.major;case m:return this.baseStyle.fontScheme.minor}return null}},{key:"getName",value:function(e,t){var n="",i=this.getCollection(t),o=null,a=i.latinFont.name,r="Times New Roman";if(!i)return null;switch(e){case u:case d:case g:n=this.themeLangInfo[this.fontLang.ascii];break;case c:case p:n=this.themeLangInfo[this.fontLang.bidi],o=i.complexFont,a=i.complexFont.name;break;case h:case f:n=this.themeLangInfo[this.fontLang.eastasia],o=i.eastAsianFont,a=i.eastAsianFont.name}var s=o&&o.name&&""!=o.name?o.name:a;return n&&(r=i.getName(n.script,s)),r}}],[{key:"buildGetInstance",value:function(t,n){return l.a.buildGetInstance(e,t,n)}}]),e}()},3851:function(e,t,n){"use strict";function i(e,t){if(e.localCommitedVersion.length>0)for(var n=0;n<e.applyVersions.length;++n){var i=e.applyVersions[n];if(i.isSelf){for(var o={applyVersions:[],resetBaseVersions:[]},a=0;a<=n;++a){var r=e.applyVersions[a];r.isSelf||o.applyVersions.push(r)}for(var s=0;s<e.resetBaseVersions.length;++s){var l=e.resetBaseVersions[s];l.isSelf||l.taskVer>i.taskVer||o.resetBaseVersions.push(l)}0===o.applyVersions.length&&0===o.resetBaseVersions.length||t(i.extRanges,o)}}}function o(e,t){var n=e.applyVersions.length,i=e.resetBaseVersions.length;if(n>0&&i>0)for(var o=0;o<n;++o)for(var a=e.applyVersions[o],r=0;r<i;++r){var s=e.resetBaseVersions[r];if(a.bornTaskVer===s.bornTaskVer||a.bornTaskVer===s.taskVer){for(var l={applyVersions:[],resetBaseVersions:[]},u=0;u<o;++u)l.applyVersions.push(e.applyVersions[u]);for(var c=0;c<r;++c)l.resetBaseVersions.push(e.resetBaseVersions[c]);(l.applyVersions.length>0||l.resetBaseVersions.length>0)&&t(a.extRanges,l);break}}}function a(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i={applyVersions:[],resetBaseVersions:[]},o=0;o<t.applyVersions.length;++o){var a=t.applyVersions[o];(n||!a.isSelf)&&a.taskVer>e.taskVer&&i.applyVersions.push(a)}for(var r=0;r<t.resetBaseVersions.length;++r){var s=t.resetBaseVersions[r];if((n||!s.isSelf)&&s.taskVer>e.taskVer){for(var l=!1,u=0;u<t.applyVersions.length;++u){var c=t.applyVersions[u];if(c.bornTaskVer===s.bornTaskVer||c.bornTaskVer===s.taskVer){l=!0;break}}l||i.resetBaseVersions.push(s)}}return i}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a}))},3854:function(e,t,n){"use strict";t.a={coop_single_name_max_length:15,coop_multi_names_max_length:30,coop_avatar_hide_interval:5e3,coop_cursor_hide_tip:2e3,coop_avatar_fadeout_interval:1e3,coop_cursor_tip_fadeout_interval:500,comment_margin_bottom:10,page_num_tip_available_right:30}},3855:function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return l}));var i=0,o=1,a=2,r=8,s=1,l=2},3856:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(411),d=n(6102),p=n(1591),f=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;o()(this,t);var r=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}));return r.heightInfo=void 0,r.typoRange=void 0,r.partRangePos=void 0,r}return c()(t,e),r()(t,[{key:"resetLen",value:function(e){this.typoRange&&(this.typoRange.len=e)}},{key:"getGlyphPool",value:function(){return this.viewPage.compose&&this.viewPage.compose.glyphpool||this.viewPage.parent.compose&&this.viewPage.parent.compose.glyphpool}},{key:"getGlyphGroups",value:function(){var e=this.getGlyphPool(),t=this.getPartRange();return e.getGlyphGroups(t.pos,t.pos+t.len)}},{key:"getGlyphBuff",value:function(){return this.getGlyphPool().glyphBuff}},{key:"getHeightInfo",value:function(e,t,n){return this.heightInfo||(this.heightInfo=d.a.calcHeightMax(this,t,n)),this.heightInfo}},{key:"getDataRange",value:function(){return this.dataRange||this.textPart&&this.textPart.getGcpRange()||this.getPartRange()}},{key:"getPartRange",value:function(){var e=this.partRangePos||0;return this.isTextPartZone||(e=this.parent.range.pos+(this.partRangePos||0)),{pos:e,len:this.len}}},{key:"rollBack",value:function(e,t){this.resetLen(this.typoRange.len-e)}},{key:"canDoCompress",value:function(){return!0}},{key:"getGlyphGroupsForCompose",value:function(){return this.getGlyphGroups()}},{key:"renderWithOutLine",value:function(){return!0}},{key:"composeProcess",value:function(e,t){}},{key:"getLeftTypoWidth",value:function(){return 0}},{key:"getRightTypoWidth",value:function(){return 0}},{key:"needAddLeftTypoWidth",value:function(){return!1}},{key:"needAddRightTypoWidth",value:function(){return!1}},{key:"clear",value:function(){this.isTextPartZone&&this.getGlyphPool().clearAll()}},{key:"type",get:function(){return p.b.Unknow}},{key:"len",get:function(){return this.isMoc?this.parent.range.len:this.typoRange.len}},{key:"isTextPartZone",get:function(){return!!this.textPart}}]),t}(h.DOCLayout);t.a=f},3857:function(e,t,n){"use strict";var i,o=n(1),a=n.n(o),r=n(2),s=n.n(r),l=n(324),u=n(723),c=n(1910),h=n(7204),d=n(1145),p=n(4577),f=n(7752),g=(i=void 0,function(e){return e&&(i=e),i}),v=function(){function e(){if(a()(this,e),g())return g();this.canvas=document.createElement("canvas"),this.canvas.setAttribute("style","display:none"),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.emphasizeMeasurer=window.APP.isEnableEmphasisMeasurer()&&new p.a||null,g(this)}return s()(e,[{key:"_checkIsDefaultSansSerifMeasureWidth",value:function(e,t){return this.ctx.font=this.defaultBrowserMeasureFont,t===this.ctx.measureText(e).width}},{key:"_resetMeasureEnvironment",value:function(){this.ctx.font=this.defaultBrowserMeasureFont,this.ctx.measureText("A")}},{key:"parseFontFace",value:function(e,t){var n={};return n.family=e.fontFamily,n.size=e.fontSize,null!=e.fontWeight&&""!=e.fontWeight&&"normal"!=e.fontWeight?n.bold=!0:n.bold=!1,null!=e.fontStyle&&""!=e.fontStyle&&"normal"!=e.fontStyle?n.italic=!0:n.italic=!1,t&&(n.bold=!1),n}},{key:"getPureTextMeasure",value:function(e,t){this.ctx.font=t;var n=u.a.isNoWidthSpace(e.charCodeAt(0))?"0":e;return this.ctx.measureText(n)}},{key:"getCharWidthInfoFromCache",value:function(e,t,n){var i=f.CharWidthMap[e];if(i&&i[t]){var o=i[t];if(o.italic==n.italic&&o.bold==n.bold)return o}return null}},{key:"getRealUseFontName",value:function(e){var t=e,n=window.APP.fontServer;return n.isFontNeedReplace2FallBackFont(e)?t=n.docFontFallBack.getSystemOnLoadFontName(e):n.isFontNeedReplace2EnglishFontName(e)?t=d.a.getPureFontName(e):n.isFontNeedReplace2SpecialSoveFontName(e)&&(t=n.docSystemFontFallBack.getSpecialSystemOnLoadFontName(e)),t}},{key:"getCharManorWithMeasure",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.parseFontFace(t,n),o=window.APP.fontServer,a=o.getFontHoriWidth(e,i);if(a)return a;var r=t.fontFamily,s=t.fontStyle,l=t.fontWeight,u=t.fontSize,c=o.getFontNameForRender(this.getRealUseFontName(r)),h=((i.italic?s:"")+" "+(i.bold?l:"")+" 256px "+c).trim(),d=0,p=this.getCharWidthInfoFromCache(c,e,t);return p?d=p.width/p.size*u:(d=this.getPureTextMeasure(e,h).width,this._checkIsDefaultSansSerifMeasureWidth(e,d)&&(this.ctx.font="256px sans-serif",d=this.ctx.measureText(e).width),d=d/256*u),o.addFontHoriWidthMetrics(i,e,{width:d}),this._resetMeasureEnvironment(),{width:d}}},{key:"measureNormalChar",value:function(e,t,n,i,o,a){var r=0,s=n,c=n+t.len;if(t.isCombine){var d=i.getText(s,c-s);r=t.isField()&&u.a.isFieldLinkPlaceholder(d)&&window.APP.isFieldLink(n)?1.4*e.fontArg.fontSize:this.getCharManorWithMeasure(d,e.fontArg).width;var p=new h.a;p.setFixedWidth(r),p.realWidth=r,i.setMi(s,p);var f=new h.a;f.setFixedWidth(0),f.realWidth=0,i.fillMi(s+1,c,f)}else if(a&&t.isFarEast()){r=e.fontArg.fontSize;var g=i.getCharCode(s);e.bBoldAdjustment&&!u.a.isNormalSpace(g)&&r>0&&(r+=o);var v=new h.a;v.dispOffset=0,v.setFixedWidth(r),v.realWidth=r,v.shared=!0,i.fillMi(s,c,v)}else if(c-s>1)for(var m=s;m<c;++m){r=this.getCharManorWithMeasure(i.getChar(m),e.fontArg,e.bBoldAdjustment).width,e.bBoldAdjustment&&!u.a.isNormalSpace(i.getCharCode(m))&&r>0&&(r+=o);var _=new h.a;_.dispOffset=0,_.setFixedWidth(r),_.realWidth=r,i.setMi(m,_)}else{var y=i.getCharCode(s);r=this.getCharManorWithMeasure(i.getChar(s),e.fontArg,e.bBoldAdjustment).width,e.bBoldAdjustment&&r>0&&(r+=o),!t.isSpec()&&t.isZero()&&y===l.E&&(r*=1.56);var b=new h.a;b.dispOffset=0,b.setFixedWidth(r),b.realWidth=r,i.setMi(s,b)}}},{key:"setGlyphGroupInfoFont",value:function(e,t){e.font||e.setFont(t.fontStyle,t.fontWeight,t.fontSize,t.fontFamily)}},{key:"measureChars",value:function(e,t,n,i){var o=0;if(e.bBoldAdjustment){if(e.viewSetting&&e.viewSetting.getWord97LineBreakRule())o=e.fontArg.fontSize/1e3;else{var a=e.fontArg,r=a.fontFamily&&Object(c.b)(a.fontFamily);o=r?a.fontSize/r:0}e.boldAddWidth=o}if(!(t.isHidden()||t.isRevisionHidden()||t.isSpecHidden()&&!t.isDrawing())){switch(this.setGlyphGroupInfoFont(t,e.fontArg),!0){case t.isNormal():case t.isFarEast():break;case t.isLineBreak():case t.isParaBreak():t.unSetComplexFlag();var s=new h.a;return s.dispOffset=0,i.setMi(n,s),void(e.bBidi&&(t.setRTLFlag(),t.setLayoutRTLFlag()));case t.isSepBreak():case t.isColBreak():t.unSetComplexFlag(),e.bBidi&&(t.setRTLFlag(),t.setLayoutRTLFlag());break;case t.isDrawing():case t.isEmbedDrawing():t.unSetComplexFlag();var u=new h.a;return u.dispOffset=0,u.setFixedWidth(0),void i.setMi(n,u);case t.isTab():t.unSetComplexFlag();var d=new h.a;return d.dispOffset=0,d.setFixedWidth(0),i.setMi(n,d),void(e.bBidi&&(t.setRTLFlag(),t.setLayoutRTLFlag()));case t.isGlyphComplex():}var p=t.isGlyphComplex()||t.isNormal()||t.isFarEast()||t.isZero(),f=i.getCharCode(n),g=f===l.d||f===l.e||f===l.b||f===l.c||f===l.t||f===l.s;if(t.isSpec()&&!p||t.isSpec()&&g){var v=new h.a;return v.dispOffset=0,v.setFixedWidth(0),void i.setMi(n,v)}var m=c.a.isFixedWidthSpec(e,i.getCharCode(n));this.measureNormalChar(e,t,n,i,o,m)}}},{key:"defaultBrowserMeasureFont",get:function(){return"10px sans-serif"}}]),e}();t.a=v},3858:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return r}));var i=0,o=1,a=2,r=3},3859:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return g}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(554),l=n(4578),u=n(6110),c=n(984),h=n(4972),d={RevisionsSettingsSyncCoop:!1,RevisionsView:l.a,RevisionsShowMarkup:!0,RevisionsMode:u.a,RevisionsFrameShow:!0,ShowComments:!0,ShowInsertionsAndDeletions:!0,ShowFormatChanges:!0,DisplayDocumentFields:h.wpsDisplayDocumentFields},p=function(){function e(t){o()(this,e),Object(s.default)(this),this.data={},this.init(t)}return r()(e,[{key:"init",value:function(e){if(void 0!==e.syncCoopRevisionsSettings&&this.setRevisionsSettingsSyncCoop(!!e.syncCoopRevisionsSettings),e.syncCoopRevisionsSettings)this.setRevisionsView(e.revisionsView?l.b:l.a),this.setRevisionsShowMarkup(!!e.showMark),this.setRevisionsFrameShow(!!e.showRevisionsFrame);else{var t=c.getStatus(c.types.REVISION_VIEW,!0);null!=t&&this.setRevisionsView(t?l.b:l.a);var n=c.getStatus(c.types.REVISION_SHOW_MARK,!0);null!=n&&this.setRevisionsShowMarkup(!!n);var i=c.getStatus(c.types.REVISION_SHOW_FRAME,!0);null!=i&&this.setRevisionsFrameShow(!!i)}var o=c.getStatus(c.types.REVISION_MODE,!0);null!=o&&this.setRevisionsMode(o)}},{key:"getMember",value:function(e){return null!=this.data[e]?this.data[e]:this.def[e]}},{key:"setMember",value:function(e,t){var n=this.getMember(e);return t===n?n:(this.data[e]=t,this._dispatch&&this._dispatch("on"+e+"Changed",t),this.data[e])}},{key:"getRevisionsSettingsSyncCoop",value:function(){return this.getMember("RevisionsSettingsSyncCoop")}},{key:"setRevisionsSettingsSyncCoop",value:function(e){return this.setMember("RevisionsSettingsSyncCoop",e)}},{key:"getRevisionsView",value:function(){return this.getMember("RevisionsView")}},{key:"setRevisionsView",value:function(e,t){var n=this.setMember("RevisionsView",e);return t&&c.setStatus(c.types.REVISION_VIEW,e,!0,Date.now()+18144e5),n}},{key:"getRevisionsShowMarkup",value:function(){return this.getMember("RevisionsShowMarkup")}},{key:"setRevisionsShowMarkup",value:function(e,t){var n=this.setMember("RevisionsShowMarkup",e);return t&&c.setStatus(c.types.REVISION_SHOW_MARK,e,!0,Date.now()+18144e5),n}},{key:"getRevisionsMode",value:function(){return this.getMember("RevisionsMode")}},{key:"setRevisionsMode",value:function(e,t){var n=this.setMember("RevisionsMode",e);return t&&c.setStatus(c.types.REVISION_MODE,e,!0,Date.now()+18144e5),n}},{key:"getRevisionsFrameShow",value:function(){return this.getMember("RevisionsFrameShow")}},{key:"setRevisionsFrameShow",value:function(e,t){var n=this.setMember("RevisionsFrameShow",e);return t&&c.setStatus(c.types.REVISION_SHOW_FRAME,e,!0,Date.now()+18144e5),n}},{key:"getShowInsertionsAndDeletions",value:function(){return this.getMember("ShowInsertionsAndDeletions")}},{key:"isRevisionsFinalView",value:function(){return this.getRevisionsView()===l.a}},{key:"isShowRevisionFrame",value:function(){return this.getRevisionsShowMarkup()&&this.getRevisionsFrameShow()}},{key:"getDisplayDocumentFields",value:function(){return this.getMember("DisplayDocumentFields")}},{key:"setDisplayDocumentFields",value:function(e){return this.setMember("DisplayDocumentFields",e)}},{key:"setReadonlyProtectionExceptionsBackgroundVisible",value:function(e){return this.setMember("ReadonlyProtectionExceptionsBackgroundVisible",e)}},{key:"getReadonlyProtectionExceptionsBackgroundVisible",value:function(){return this.getMember("ReadonlyProtectionExceptionsBackgroundVisible")}},{key:"def",get:function(){return d}},{key:"utils",get:function(){return{isRevisionHiddenChp:g,isRevisionHiddenMode:f}}}]),e}(),f=function(){var e=window.APP.data.doc.viewSettings;return!e.getRevisionsShowMarkup()||(!e.getShowInsertionsAndDeletions()||e.getRevisionsMode()===u.a)},g=function(e){if(!e||!e.revision)return!1;var t=e.revision,n=window.APP.data.doc.viewSettings.getRevisionsView();return!!f()&&(t.delete&&n===l.a||t.insert&&n===l.b)}},3860:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(310),l=n(908),u=n(684),c=function(){function e(t){var n=t.parent,i=t.viewPage;o()(this,e),this.parent=n,this.viewPage=i,this.view=i.parent,this.topCards=[],this.bottomCards=[],this.textframes=[],this.embedShapes=[]}return r()(e,[{key:"addChild",value:function(e){this.childLayers||(this.childLayers=[]),this.childLayers.push(e),e.parentLayers=this}},{key:"removeChild",value:function(e){var t=this.childLayers.indexOf(e);t>=0&&this.childLayers.splice(t,1)}},{key:"getRootLayers",value:function(){if(!this.parentLayers)return this;for(var e=this.parentLayers;e.parentLayers;)e=e.parentLayers;return e}},{key:"getTopRenderInfo",value:function(){for(var e=this;e.parentLayers;)e=e.parentLayers;return e.renderInfo}},{key:"getTopShapeCards",value:function(){var e=this,t=void 0;if(this.childLayers&&this.childLayers.forEach((function(e){e.topCards&&e.topCards.length&&(t=t?t.concat(e.topCards):e.topCards)})),this.topCards.forEach((function(t){e.adjustShapePos(t)})),t&&t.length){var n=[].concat(this.topCards);return t.forEach((function(t){e.adjustShapePos(t),e.insertByZOrder(t,n)})),n}return this.topCards}},{key:"getBottomShapeCards",value:function(){var e=this,t=void 0;if(this.childLayers&&this.childLayers.forEach((function(e){e.bottomCards&&e.bottomCards.length&&(t=t?t.concat(e.bottomCards):e.bottomCards)})),this.bottomCards.forEach((function(t){e.adjustShapePos(t)})),t&&t.length){var n=[].concat(this.bottomCards);return t.forEach((function(t){e.adjustShapePos(t),e.insertByZOrder(t,n)})),n}return this.bottomCards}},{key:"adjustShapePos",value:function(e){if(e.isWrap)e.coor_pos2view||(e.coor_pos2view=l.a.transvertPositionFromNode2Target(e.upper,this.viewPage));else if(e.upper){var t=l.a.transvertPositionFromNode2Target(e.upper,this.viewPage);e.offset(t.x,t.y),e.upper=this.viewPage}}},{key:"getTextframeCards",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!t)return this.textframes;var n=[];if(this.childLayers&&this.childLayers.forEach((function(e){e.textframes&&e.textframes.length&&(n=n.concat(e.textframes))})),n.length){var i=[].concat(this.textframes);return n.forEach((function(t){e.insertByZOrder(t,i)})),i}return this.textframes}},{key:"getTextboxCards",value:function(){var e=[];this.bottomCards&&this.bottomCards.length>0&&this.bottomCards.forEach((function(t){t.has_textbox&&e.push(t)}));var t=this.getTopShapeCards();return t&&t.length>0&&t.forEach((function(t){t.has_textbox&&e.push(t)})),e}},{key:"getWrapCards",value:function(){var e=[];return this.topCards.forEach((function(t){t.isWrap&&e.push(t)})),e.concat(this.textframes)}},{key:"collectCardsByRange",value:function(e,t){var n=this.view.shapeCardRanges,i=this.viewPage.layout_index;return n.mapInRange(e,t,s.IT.mapToNode,s.IT.strictIntersectTest).filter((function(n){return n.viewPage.layout_index===i&&(e<=n.begin&&n.end<=t)}))}},{key:"collectEmbedsByRange",value:function(e,t){var n=this.view.embedShapeRanges,i=this.viewPage.layout_index;return n.mapInRange(e,t,s.IT.mapToNode,s.IT.strictIntersectTest).filter((function(n){return n.viewPage.layout_index===i&&(e<=n.begin&&n.end<=t)}))}},{key:"collectWrapCardsByRange",value:function(e,t){var n=[];return this.topCards.forEach((function(i){i.isWrap&&i.pos>=e&&i.pos<t&&n.push(i)})),this.textframes.forEach((function(i){i.begin>=e&&i.end<=t&&n.push(i)})),n}},{key:"collectWrapCardsByRect",value:function(e){var t=[];return this.topCards.forEach((function(n){n.isWrap&&n.intersect(e)&&t.push(n)})),this.textframes.forEach((function(n){n.intersect(e)&&t.push(n)})),t}},{key:"commitEmbed",value:function(e){if(e.isOrphan()){this.view.embedShapeRanges.attachNode(e);var t=this.getTopRenderInfo();if(e.renderInfo&&t&&t.removed){var n=t.removed.indexOf(e.renderInfo);n>=0&&t.removed.splice(n,1)}}var i=this.embedShapes.findIndex((function(t){return t.pos>e.pos}));-1===i?this.embedShapes.push(e):this.embedShapes.splice(i,0,e),this.viewPage.embed_shape_map||(this.viewPage.embed_shape_map={}),this.viewPage.embed_shape_map[e.id]=e}},{key:"removeEmbed",value:function(e){if(e&&e.isEmbedShape){if(!e.isOrphan()){this.view.embedShapeRanges.detachNode(e);var t=this.getTopRenderInfo();t&&(t.removed||(t.removed=[]),t.removed.push(e.renderInfo))}this.viewPage.embed_shape_map[e.id]&&delete this.viewPage.embed_shape_map[e.id],this.doRemove(e,this.embedShapes)}}},{key:"commitCard",value:function(e){if(e.linkLayers=this,e.isTextFrame?this.textframes.push(e):e.isBehindText?this.insertByZOrder(e,this.bottomCards):this.insertByZOrder(e,this.topCards),e.isOrphan()){this.view.shapeCardRanges.attachNode(e);var t=this.getTopRenderInfo();if(e.renderInfo&&t&&t.removed){var n=t.removed.indexOf(e.renderInfo);n>=0&&t.removed.splice(n,1)}}this.viewPage.shapeArray||(this.viewPage.shapeArray=[]),this.viewPage.shapeArray.push(e),window.APP.typoMode===u.TYPO_MODE.MODE_PAGINATION&&e.isInk||e.startFetchingImg&&e.startFetchingImg()}},{key:"removeCard",value:function(e){var t=this,n=!1;if(n=e.isTextFrame?this.doRemove(e,this.textframes):e.isBehindText?this.doRemove(e,this.bottomCards):this.doRemove(e,this.topCards),this.view.shapeCardRanges.mapInRange(e.pos,e.pos+e.len,s.IT.mapToNode,s.IT.strictIntersectTest).forEach((function(n){n===e&&t.view.shapeCardRanges.detachNode(e)})),this.viewPage.shapeArray){var i=this.viewPage.shapeArray.indexOf(e);i>=0&&this.viewPage.shapeArray.splice(i,1)}var o=this.getTopRenderInfo();o&&n&&(o.removed||(o.removed=[]),o.removed.push(e.renderInfo))}},{key:"insertByZOrder",value:function(e,t){for(var n=e.zorder||0,i=t.length,o=0;o<i;){if(n<(t[o].zorder||0))break;++o}t.splice(o,0,e)}},{key:"doRemove",value:function(e,t){var n=t.indexOf(e);return n>=0&&(t.splice(n,1),!0)}},{key:"cleanRenderInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=function(e){e.forEach((function(e){e.cleanRenderInfo()}))};!e&&t(this.topCards),!e&&t(this.bottomCards),!e&&t(this.textframes),t(this.embedShapes),delete this.renderInfo,this.childLayers&&this.childLayers.forEach((function(t){t.cleanRenderInfo(e)}))}}]),e}();t.a=c},3861:function(e,t,n){"use strict";n.d(t,"d",(function(){return l})),n.d(t,"e",(function(){return u})),n.d(t,"g",(function(){return h})),n.d(t,"a",(function(){return d})),n.d(t,"f",(function(){return p})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return g})),n.d(t,"h",(function(){return v})),n.d(t,"i",(function(){return m}));var i=n(310),o=n(4975),a=n(1590),r=n(3333),s=[20,40,60,80,100,110,130,150,160,180,200,210,220,240,280,320,360,400,440,480,520,560,720,960,1440,1600];function l(e){var t=e;if(t<s[0])return s[0];if(t>=s[0]&&t<s[s.length-1]){for(var n=0;n<s.length;n++)if(!(t>=s[n])){t=s[n];break}}else t=10*parseInt((t+200)/10);return t>32760?32760:t}function u(e){var t=e;if(t<=s[0])return s[0];if(t>s[0]&&t<=s[s.length-1]){for(var n=s.length-1;n>=0;n--)if(!(t<=s[n])){t=s[n];break}}else t=10*parseInt((t-200)/10);return t}function c(e){var t=e.toString(16),n=t.substring(t.length>6?t.length-6:0);return n.length<6&&(n=(Array(6).join(0)+n).slice(-6)),"#"+n}function h(e,t,n,i){n.push("underline"),e!==a.wpsUnderlineNone?(n.push("underline_type"),i.push(o.Normal),i.push(e),void 0!==t&&(n.push("underline_color"),i.push(c(t)))):i.push(o.None)}function d(e,t){var n=e.mathManager;return t.map((function(e){var t=e.pos,i=e.pos+e.len,o=n.getMath(t,!0);if(o)if(t=Math.min(t,o.begin),i>o.end){var a=n.getMath(i,!0);a&&a.begin<i&&(i=a.end)}else i=o.end;return{pos:t,len:i-t}}))}function p(e,t,n){t.push("strike"),n.push(e),e&&(t.push("double_strike"),n.push(!1))}function f(e,t,n,i){var o=t.query(e);n.push("font_name_ftcbi"),i.push(o);var a,s=(a=e)===r.a.SimSun||a===r.a.FangSong||a===r.a.SimHei||a===r.a.KaiTi||a===r.a.YaHei||"MingLiU"===a||"MS PMincho"===a?{isCJK:!0,isBidi:!1}:"Arial"===a||"Tahoma"===a||"Times New Roman"===a||"Courier New"===a?{isCJK:!1,isBidi:!0,isAscii:!0}:"Georgia"===a||"Calibri"===a||"Comic Sans MS"===a||"Verdana"===a?{isCJK:!1,isBidi:!1}:{isCJK:!0,isBidi:!1};!s.isCJK&&s.isBidi?s.isAscii&&(n.push("font_name_ascii"),n.push("font_name_complex"),n.push("share_hint"),i.push(o),i.push(o),i.push(0)):(n.push("font_name_ascii"),n.push("font_name_complex"),s.isCJK&&(n.push("font_name_asia_east"),i.push(o)),n.push("share_hint"),i.push(o),i.push(o),i.push(s.isCJK?1:0))}function g(e,t,n,i){n.push(e);var o=t.toString(16),a=o.substring(o.length>6?o.length-6:0);a.length<6&&(a=(Array(6).join(0)+a).slice(-6)),i.push("#"+a)}function v(e,t){var n={};if(void 0!==e.isBold&&(n.bold=e.isBold,n.bold_cs=e.isBold),void 0!==e.isItalic&&(n.italic=e.isItalic,n.italic_cs=e.isItalic),void 0!==e.underlineType){var r=[],s=[];r.push("underline"),e.underlineType!==a.wpsUnderlineNone?(r.push("underline_type"),s.push(o.Normal),s.push(e.underlineType)):s.push(o.None),r.forEach((function(e,t){n[e]=s[t]}))}if(void 0!==e.underlineColor){var h=[],d=[];h.push("underline_color");var v=parseInt(e.underlineColor.substring(1),16);d.push(c(v)),h.forEach((function(e,t){n[e]=d[t]}))}if(void 0!==e.isStrikeThrough){var m=[],_=[];p(e.isStrikeThrough,m,_),m.forEach((function(e,t){n[e]=_[t]}))}if(void 0!==e.fontSize&&(n.font_size_normal=e.fontSize,n.font_size_cs=e.fontSize),void 0!==e.scriptPos&&(n.script_pos=e.scriptPos),void 0!==e.fontName){var y=[],b=[];f(e.fontName,t.fonttable,y,b),y.forEach((function(e,t){n[e]=b[t]}))}if(void 0!==e.fontColor){var T=[],C=[];g("font_color",parseInt(e.fontColor.substring(1),16),T,C),T.forEach((function(e,t){n[e]=C[t]}))}if(void 0!==e.highlightColor){var k=[],w=[];"#ffffffffff000000"===e.highlightColor?(k.push("highlight_color"),w.push("#ffffffffff000000")):g("highlight_color",parseInt(e.highlightColor.substring(1),16),k,w),k.forEach((function(e,t){n[e]=w[t]}))}if(void 0!==e.growUp&&0!==e.growUp){var S=t.getDataLogic("final"),P=S.getPapx(e.pos),I=e.pos===P.pos?i.IT.Include:i.IT.Exclude,E=S.getChpx(e.pos,I).prop,O=E.font_size_normal,x=E.font_size_cs;if(void 0!==O){for(var R=O,N=0;N<Math.abs(e.growUp);++N)R=e.growUp>0?l(R):u(R);n.font_size_normal=R}if(void 0!==x){for(var A=x,D=0;D<Math.abs(e.growUp);++D)A=e.growUp>0?l(A):u(A);n.font_size_cs=A}}return void 0!==e.isAllCaps&&(n.caps=e.isAllCaps),void 0!==e.isSmallCaps&&(n.small_caps=e.isSmallCaps),void 0!==e.isDoubleStrikeThrough&&(n.double_strike=e.isDoubleStrikeThrough),void 0!==e.emphasisMark&&(n.emphasis_type=e.emphasisMark),void 0!==e.isHidden&&(n.vanish=e.isHidden),void 0!==e.scaling&&(n.character_scale=e.scaling),void 0!==e.spacing&&(n.spacing=e.spacing),n}function m(e,t){var n={};if(void 0!==e.bold&&(n.isBold=e.bold),void 0!==e.italic&&(n.isItalic=e.italic),void 0!==e.underline_type&&(n.underlineType=e.underline_type),void 0!==e.underline_color&&(n.underlineColor=e.underline_color),void 0!==e.strike&&(n.isStrikeThrough=e.strike),void 0===e.font_size_normal&&void 0===e.font_size_cs||(n.fontSize=e.font_size_normal||e.font_size_cs),void 0!==e.script_pos&&(n.scriptPos=e.script_pos),void 0!==e.font_color&&(n.fontColor=e.font_color),void 0!==e.highlight_color&&(n.highlightColor=e.highlight_color),e.font_size_normal||e.font_size_cs){var i=e.font_size_normal||e.font_size_cs;n.fontSize=i}return void 0!==e.caps&&(n.isAllCaps=Number(e.caps)),void 0!==e.small_caps&&(n.isSmallCaps=Number(e.small_caps)),void 0!==e.double_strike&&(n.isDoubleStrikeThrough=e.double_strike),void 0!==e.emphasis_type&&(n.emphasisMark=e.emphasis_type),void 0!==e.vanish&&(n.isHidden=e.vanish),void 0!==e.character_scale&&(n.scaling=e.character_scale),void 0!==e.spacing&&(n.spacing=e.spacing),n}},3862:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(411),d=n(626),p=n(3863),f=n(400),g=function(e){function t(e,n,i,a,r,s){o()(this,t);var u=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:e,coorSystem:h.DOCCoorSystemType.Canvas}));return u.compose=n,u._initMocPage(i,a,r,s),u}return c()(t,e),r()(t,[{key:"isCoorSystem",value:function(){return!0}},{key:"isScene",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"_initMocPage",value:function(e,t,n,i){this.isMoc=!0,this.layout_index=e,this.rect=t,this.outer_rect=t,this.inner_rect=f.a.initByRawRect({left:120,right:t.right-240,top:201,bottom:t.bottom-402}),this.mainpages=[],this.mainpages.push(new p.a({parent:this,viewPage:this,coorSystem:this.coorSystem},{compose:this.compose,mainpage:{range:{pos:n,len:i-n}}}))}},{key:"getRange",value:function(){return{pos:this.mainpages[0].range.pos,len:this.mainpages[0].range.len}}},{key:"position2parent",get:function(){return d.a.ZERO()}},{key:"offset4child",get:function(){return d.a.ZERO()}},{key:"layoutType",get:function(){return h.DOCLayoutType.LayoutPage}},{key:"view",get:function(){return this.parent}},{key:"range",get:function(){var e=this.mainpages.length;if(e){var t=this.mainpages[0].range.pos,n=this.mainpages[e-1].range;return{pos:t,len:n.pos+n.len-t}}return null}}]),t}(h.DOCLayout);t.a=g},3863:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(411),f=n(1032),g=n(400),v=n(6006),m=n(336),_=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.compose,u=n.mainpage,c=n.pageOffsetFromServer,h=n.notesInfo;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r},{compose:s,textpage:u,pageOffsetFromServer:c,params:{notesInfo:h}}))}return d()(t,e),r()(t,[{key:"_initFromRawData",value:function(e,n,i){if(e){c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initFromRawData",this).call(this,e,n);var o=i.notesInfo;if(e.footnotes){this.footnotes=new v.a({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem},{notes:e.footnotes,pos:Object(m.Ti2Px)(e.footnotePos)||0,compose:this.compose,info:o.footnote});var a=(window.APP.data.doc.settings.getFootnotePr()||{showSeparator:!0}).showSeparator;this.footnotes.showSeparator=a}if(e.endnotes){this.endnotes=new v.a({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem},{notes:e.endnotes,pos:Object(m.Ti2Px)(e.endnotePos)||0,compose:this.compose,info:o.endnote});var r=(window.APP.data.doc.settings.getFootnotePr()||{showSeparator:!0}).showSeparator;this.endnotes.showSeparator=r}}}},{key:"cleanRenderInfo",value:function(){c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this),this.footnotes&&this.footnotes.cleanRenderInfo(),this.endnotes&&this.endnotes.cleanRenderInfo()}},{key:"_calculateTransposedCoordination",value:function(e){var t=this.rect,n=t.size,i=t.origin,o=t.left,a=t.top,r=i.x,s=i.y,l=this.textflow,u=!1;"T2B"===l.corX?(r=o+n.height,s=a,u=!0):"B2T"===l.corX&&(r=o,s=a+n.width,u=!0),u&&(this.rect=g.a.initByOriginAndSize(i,{width:n.height,height:n.width})),this.coororigin_pos2parent={x:r,y:s}}},{key:"layoutType",get:function(){return p.DOCLayoutType.MainPage}},{key:"next",get:function(){var e,t=this,n=this.parent;if(n.header===this||n.footer===this)return null;if((e=n.mainpages.findIndex((function(e){return e===t})))===n.mainpages.length-1){var i=n.next;return i&&i.mainpages.length?i.mainpages[0]:null}return e>=0&&e<n.mainpages.length?n.mainpages[e+1]:(console.log("what? why? error In DOCMainPage.next"),null)}}]),t}(f.d);t.a=_},3976:function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return g}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(310),l=n(324),u=n(336),c=n(3078),h={_maxWidth:0,_minWidth:28,_minBeforeIndent:14,_minAfterIndent:14,_chpx:{},_cache:{},_get:function(e,t){return e.getPropVal(t)},_calcIndent:function(e,t,n){if(this._cache._indents)return this._cache._indents[t];var i=Object(u.Ti2Px)(n.defFontSize());(!i||i<=0)&&(i=14);var o=Object(u.Ti2Px)(this._get(this._chpx,"font_size_normal")||0)||Object(u.Ti2Px)(this._get(this._chpx,"font_size_cs")||0)||14,a=i;this._minWidth=Math.ceil(2*o);var r=Object(u.Ti2Px)(this._get(e,"left_indent_abs")||0),s=this._get(e,"left_indent_chars")||0,h=Object(u.Ti2Px)(this._get(e,"first_line_indent_abs")||0),d=this._get(e,"first_line_indent_chars")||0,p=Object(u.Ti2Px)(this._get(e,"right_indent_abs")||0),f=this._get(e,"right_indent_chars")||0,g=this._get(e,"nest_level")||0,v=void 0,m=void 0,_=void 0;if(m=this.getBeforeIndent(s,r,d,h,a),_=f?f/100*a:p,v=d?d/100*o:h,this._maxWidth===Number.MAX_SAFE_INTEGER||g){if(d){var y=this._get(this._chpx,"character_scale")||100,b=this._get(this._chpx,"spacing");if(b){var T=n.getDataLogic("final").getChar(this._para.begin).charCodeAt(0);T!==l.q&&T!==l.a&&T!==l.f&&T!==l.g&&T!==l.n&&T!==l.p&&T!==l.o||(b=0)}v=d*(o*y/100+Object(u.Ti2Px)(2*b))/100;var C=n.sections.getSection(this._para.begin),k=C.getSnapMode();if(c.c.Typo_GridMode_SnapText===k){var w=C.getSrcGridWidth()+n.defFontSize(),S=Math.floor(Object(u.Px2Ti)(v)/w);Object(u.Px2Ti)(v)%Math.floor(w)!=0&&(S+=v>0?1:-1),v=Object(u.Ti2Px)(Math.floor(S*w))}else if(c.c.Typo_GridMode_CharAndLine===k){var P=C.getSrcGridWidth();v+=P=P>0?Object(u.Ti2Px)(Math.round(d*Math.ceil(P)/100)):Object(u.Ti2Px)(Math.round(d*Math.ceil(100*P)/1e4))}}if(f){var I=n.sections.getSection(this._para.begin),E=I.getSnapMode();if(c.c.Typo_GridMode_SnapText===E||c.c.Typo_GridMode_CharAndLine===E){var O=I.getSrcGridWidth()+n.defFontSize();_=Object(u.Ti2Px)(Math.round(f*Math.floor(O)/100))}else _=Object(u.Ti2Px)(Math.round(f*Math.floor(n.defFontSize())/100))}this._minWidth=Math.ceil(o)}else{var x=0,R=this._maxWidth-this._minWidth,N=v<0,A=Math.abs(v);if(A){if((x=A+m+_)>=R){if(A>R)x=R-(m=m&&Math.min(this._minBeforeIndent,m)||0)-(_=_&&Math.min(this._minAfterIndent,_)||0);else{var D=R-A-(m+_),M=m&&_?D/2:D;m=m&&m+M||0,_=_&&_+M||0,x=A}v=N?-x:x}}else if((x=m+_)>=R){var L=m&&_?(x-R)/2:x-R;m=m&&m-L||0,_=_&&_-L||0}}return this._cache._indents={before_indent:m,after_indent:_,first_line_indent:v,min_text_width:this._minWidth},this._cache._indents[t]},getBeforeIndent:function(e,t,n,i,o){var a=0,r=!1;return e?a=e/100*o:(a=t,r=!0),(i<0||n<0)&&r&&(a=n?0:t+i),a},traps:{indent:{keys:["before_indent","after_indent","first_line_indent"],method:"_calcIndent"},indent_typo:{keys:["min_text_width"],method:"_calcIndent"}}},d=n(309),p=n(3485);function f(e){e.glyphIterator.free()}var g=function(){function e(t,n){o()(this,e),this.data=t,this.document=t.doc,this.glyphpool=n,this.final=this.glyphpool.getDataLogic(),this.autoNum=t.autonum,this.querying=!1,this.glyphIterator=p.d.make(this.glyphpool),this.validates={}}return r()(e,[{key:"makeGlyphAt",value:function(e){if(e<this.bodyRange.begin||this.bodyRange.end<=e)return null;var t=p.d.make(this.glyphpool);return this.validate(e),t.seek(e),t}},{key:"makeGlyphInLineAt",value:function(e,t){var n=p.e.make(this.glyphpool,t);return this.validate(e),n.seek(e),n}},{key:"_updatePropCache",value:function(e){var t=e.begin,n=e.end,i="pc"===this.data.typoinfo.environment?Number.MAX_SAFE_INTEGER:this.data.typoinfo.width-2*this.data.typoinfo.horizontalPadding,o=this.final.getSegments({pos:t,len:n-t})||[],a=void 0,r=void 0;0!==o.length&&(r=o[0].chpx,a=function(e,t,n,i){var o=Object.assign(t,n),a=function(t){var n=o.traps[t],a=n.keys,r=n.method;a.forEach((function(t){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return o[r](e,t,i)}})}))};for(var r in o.traps)a(r);return e}(o[0].papx,h,{_maxWidth:i,_chpx:r,_cache:{},_para:{begin:t,end:n}},this.document),o.forEach((function(e){e.para={pos:t,len:n-t},e.papx=a}))),this.cache={range:{begin:t,end:n},props:o}}},{key:"getCachedProps",value:function(){return{range:this.cache.range,props:this.cache.props}}},{key:"getProps",value:function(){var e=this,t=this.papx,n=t.pos,i=n,o=n+t.len;return this.cache?(this.cache.range.end<=i||this.cache.range.begin>=o)&&this._updatePropCache({begin:i,end:o}):this._updatePropCache({begin:i,end:o}),this.cache.props.find((function(t){var n=t.pos,i=t.len;return e.pos>=n&&e.pos<n+i}))}},{key:"locate",value:function(e){this.pos=e,this.chpx=this.final.getChpx(e),this.papx=this.final.getPapx(e),this.lastChpx=this.final.getChpx(this.chpx.pos,s.IT.Exclude),this.lastPapx=this.final.getPapx(this.papx.pos,s.IT.Exclude),this.isChpxBegin=this.pos==this.chpx.pos,this.isPapxBegin=this.pos==this.papx.pos,this.bodyRange=this.glyphpool.getBodyRange(e),this.subdocType=this.document.getSubDocType(e),this.validate(e),this.glyphIterator.seek(e)}},{key:"rollback",value:function(e){this.pos=e,this.chpx=this.final.getChpx(e),this.papx=this.final.getPapx(e),this.lastChpx=this.final.getChpx(this.chpx.pos,s.IT.Exclude),this.lastPapx=this.final.getPapx(this.papx.pos,s.IT.Exclude),this.isChpxBegin=this.pos==this.chpx.pos,this.isPapxBegin=this.pos==this.papx.pos,this.bodyRange=this.glyphpool.getBodyRange(e),this.subdocType=this.document.getSubDocType(e),this.validate(e),this.glyphIterator.seek(e)}},{key:"next",value:function(){return++this.pos,this.isChpxBegin=!1,this.isPapxBegin=!1,this.pos===this.chpx.pos+this.chpx.len&&(this.isChpxBegin=!0,this.lastChpx=this.chpx,this.chpx=this.final.getChpx(this.pos)),this.pos===this.papx.pos+this.papx.len&&(this.isPapxBegin=!0,this.lastPapx=this.papx,this.papx=this.final.getPapx(this.pos)),this.isDataEnd||(this.validate(this.pos)?this.glyphIterator.seek(this.pos):this.glyphIterator.next()),this.glyphIterator}},{key:"nextToPos",value:function(e){for(;this.pos<e;)this.next()}},{key:"isEnterTable",value:function(e){return this.papx.prop.getPropVal("nest_level")>=e}},{key:"isEnterFrame",value:function(e){var t=this.papx.prop.getPropVal("nest_level");if(t<e&&(e>1||t>0))return!1;var n=this.final.specTable&&this.final.specTable.getTapx(this.pos,s.IT.Include,e+1);return!(!n||!n.prop)&&!!n.prop.text_frame}},{key:"validate",value:function(e){var t=this.validates[this.subdocType];if("number"!=typeof t&&(t=this.validates[this.subdocType]=this.bodyRange.begin),e<t)return!1;if(e>=this.bodyRange.end)return!1;var n={begin:this.bodyRange.begin,end:e+1};return n.end=Math.min(Math.max(t,e+1)+this.glyphpool.getValidateStep(n),this.bodyRange.end),this.glyphpool.needQueryData()&&this.queryData(),this.validates[this.subdocType]=n.end,this.glyphpool.validate(n)}},{key:"needMoreData",value:function(){var e=this.document.subdocs[d.MainText],t=this.document.concernRanges[0];return!this.querying&&(e.getTextSize()>t.len&&this.pos<e.getTextSize()&&this.pos>t.pos+t.len-1e3&&(this.querying=!0,!0))}},{key:"queryData",value:function(){if(this.needMoreData()){var e=this.document.concernRanges[0];this.data.api.queryRange({gcpCurrent:e.pos+e.len,length:5e3})}}},{key:"isDataEnd",get:function(){return this.pos>=this.bodyRange.end}}]),e}()},400:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(4105),l=n(626),u=n(336),c=function(){function e(t){var n=t.doc_rect,i=t.raw_rect,a=t.origin,r=t.size;o()(this,e),n?this._initFromRawData(n):i?(this.top=i.top,this.left=i.left,this.right=i.right,this.bottom=i.bottom):a&&r?(this.left=a.x,this.top=a.y,this.right=this.left+r.width,this.bottom=this.top+r.height):this.top=this.left=this.right=this.bottom=0}return r()(e,[{key:"_initFromRawData",value:function(e){this.left=Object(u.Ti2Px)(e.left),this.right=Object(u.Ti2Px)(e.right),this.top=Object(u.Ti2Px)(e.top),this.bottom=Object(u.Ti2Px)(e.bottom)}},{key:"updateByOrigin",value:function(e,t){var n=null==e?this.origin.x:e,i=null==t?this.origin.y:t,o=this.size,a=o.width,r=o.height;this.left=n,this.right=n+a,this.top=i,this.bottom=i+r}},{key:"updateBySize",value:function(e,t){var n=null==e?this.size.width:e,i=null==t?this.size.height:t;this.right=this.left+n,this.bottom=this.top+i}},{key:"updateByHeight",value:function(e){this.updateBySize(void 0,e)}},{key:"updateByWidth",value:function(e){this.updateBySize(e)}},{key:"addOffset",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];n.forEach((function(t){e.left+=t.x,e.right+=t.x,e.top+=t.y,e.bottom+=t.y}))}},{key:"addSize",value:function(e){var t=e.width,n=e.height;this.right+=t,this.bottom+=n}},{key:"offset",value:function(e,t){this.addOffset({x:e,y:t})}},{key:"origin",get:function(){return l.a.initWithOrigin({x:this.left,y:this.top})}},{key:"size",get:function(){return s.a.initWithSize({width:this.right-this.left,height:this.bottom-this.top})}},{key:"width",get:function(){return this.size.width}},{key:"height",get:function(){return this.size.height}},{key:"vpsc_rect",get:function(){return e.initByOriginAndSize(this.origin.vpsc_position,this.size.vpsc_size)}}],[{key:"initByDocRect",value:function(t){return new e({doc_rect:t})}},{key:"initByRawRect",value:function(t){return new e({raw_rect:t})}},{key:"initByOriginAndSize",value:function(t,n){return new e({origin:t,size:n})}},{key:"getRectByRectAndOffset",value:function(t,n){return e.initByRawRect({left:t.left+n.x,right:t.right+n.x,top:t.top+n.y,bottom:t.bottom+n.y})}},{key:"ZERO",value:function(){return e.initByOriginAndSize(l.a.ZERO(),s.a.ZERO())}},{key:"copy",value:function(t){return e.initByRawRect(t)}},{key:"addDeepOffset",value:function(t,n){var i=e.copy(t);return i.addOffset(n),i}},{key:"pointInRect",value:function(e,t){return e&&e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom}},{key:"verticalDistanceFromPointToRect",value:function(e,t){var n=0;return e.y<t.top?n=Math.abs(e.y-t.top):e.y>t.bottom&&(n=Math.abs(e.y-t.bottom)),n*n}},{key:"distanceFromPointToRect",value:function(t,n){if(e.pointInRect(t,n))return 0;var i=0,o=0;return t.x<n.left?i=Math.abs(t.x-n.left):t.x>n.right&&(i=Math.abs(t.x-n.right)),t.y<n.top?o=Math.abs(t.y-n.top):t.y>n.bottom&&(o=Math.abs(t.y-n.bottom)),i*i+o*o}},{key:"nEqual",value:function(e,t){return Math.abs(e-t)<1e-7}},{key:"nLarger",value:function(t,n){return t>n&&!e.nEqual(t,n)}},{key:"nLargerEqual",value:function(t,n){return t>n||e.nEqual(t,n)}},{key:"intersects",value:function(t,n){return!(e.nLarger(t.left,n.right)||e.nLargerEqual(n.left,t.right)||e.nLarger(t.top,n.bottom)||e.nLargerEqual(n.top,t.bottom))}},{key:"intersectsRect",value:function(t,n){return t&&n&&e.intersects(t,n)?{left:Math.max(t.left,n.left),top:Math.max(t.top,n.top),right:Math.min(t.right,n.right),bottom:Math.min(t.bottom,n.bottom)}:null}},{key:"equal",value:function(t,n){return!(!t&&n||t&&!n)&&(!t&&!n||!!(e.nEqual(t.left,n.left)&&e.nEqual(t.right,n.right)&&e.nEqual(t.top,n.top)&&e.nEqual(t.bottom,n.bottom)))}},{key:"add",value:function(e,t){return{top:e.top+t.top,left:e.left+t.left,right:e.right+t.right,bottom:e.bottom+t.bottom}}}]),e}();t.a=c},405:function(e,t,n){"use strict";var i=n(289),o=n(308);t.a=function(e,t){if(Object(i.a)(e)!=o.a.arrayTag)throw new TypeError(o.b.ARRAY_ERROR_TEXT);for(var n=e.length,a=-1;++a<n;)if(t(e[a],a,e))return a;return-1}},406:function(e,t,n){"use strict";var i=n(289),o=n(308);t.a=function(e,t){var n=Object(i.a)(e);if(n===o.a.objectTag)for(var a in e)e.hasOwnProperty(a)&&t(e[a],a);else{if(n!==o.a.arrayTag)throw new TypeError(o.b.ARRAYObj_ERROR_TEXT);e.forEach(t)}}},410:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={findBase:function(e,t){var n=e.mixin_bases[t];return n||(n=e.mixin_mixed.find((function(e){return e.name===t}))),n},getBindName:function(e,t){return"mixin_"+e+"_"+t},mix:function(e){if(void 0===e.mixin_bases){e.mixin_bases=new Map,e.mixin_mixed=[];for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.forEach((function(t){e.mixin_mixed.push(t),t.mixin_mixed&&t.mixin_mixed.forEach((function(t){e.mixin_mixed.push(t)})),e.mixin_bases.set(t.name,t),Reflect.ownKeys(t.prototype).forEach((function(n){"init"!==n&&"constructor"!==n&&(e.prototype.hasOwnProperty(n)||Reflect.defineProperty(e.prototype,n,Reflect.getOwnPropertyDescriptor(t.prototype,n)))}))})),e.mixin_bind_method_list&&e.mixin_bind_method_list().forEach((function(t){var n=t.baseName,o=t.base,a=t.methodName,r=o.prototype[a];r?e.prototype[i.getBindName(n,a)]=r:console.log("Mixin("+e.name+"): "+n+"."+a+" not found")}))}else console.log("Mixin("+e.name+"): mixed before")}}},4103:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1804),l=n(1142),u=n(7146),c=n(167),h=n(260),d=n(805),p=n(7154),f=n(7730),g=n.n(f),v=n(7731),m=n.n(v),_=n(5735),y=["bmp","jpg","jpeg","png","gif"],b=function(){function e(){var t=this;o()(this,e),this.handleShapeDataChange=function(e){var n=e.detail.shapeData,i=n.shapeId,o=n.shapeTreeType,a=t.getShapeFromMap(o,i,!0);a.sha1="",a.orgSha1="";var r=e.detail.shapeDataObj;r&&t._handleShapeDataObjChange(r,!1)},this.getShape=new p.default,this.initImageEndOnce=Object(d.runOnce)((function(){h.default.dispatchEvent(h.default.names.DOC_INIT_IMAGE_END)})),this.shapeMap=new m.a,this.api=u.a.getInstance(),this._delayRenderShapes=new Set,this._shapeRenderInfo={},this.localPicCache={},this.shapeUrlHelper=new g.a(this.api,this);var n=window.APP.data.doc;n.anchors.attachObserver(this),n.inlineAnchors.attachObserver(this),window.addEventListener(h.default.edit.ON_SHAPE_DATA_CHANGED,this.handleShapeDataChange),this._updateShapeQueue=[],this._timer=null}return r()(e,[{key:"single_reset",value:function(){}},{key:"margin",value:function(){return 2}},{key:"config",value:function(e){var t=e||"https://ks3-cn-beijing.ksyun.com/weboffice-test/shapes";this.DOC_SHAPE_PREFIX=t}},{key:"clearAll",value:function(e){this.clearTextBoxCache();var t=window.APP.data.doc;t.anchors.detachObserver(this),t.inlineAnchors.detachObserver(this),window.removeEventListener(h.default.edit.ON_SHAPE_DATA_CHANGED,this.handleShapeDataChange)}},{key:"_handleShapeDataObjChange",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.private.group||e.isCanvasShape||e.isCanvasLayers)e.childShapes.forEach((function(e){t._handleShapeDataObjChange(e)}));else if(n){var i=e.private,o=i.shapeTreeType,a=i.shapeId,r=this.getShapeFromMap(o,a,!1);r&&(r.sha1="",r.orgSha1="")}}},{key:"onAnchorInsert",value:function(e,t){if(t.shapeData){var n=t.shapeData,i=n.shapeId,o=n.shapeTreeType,a=this.getShapeFromMap(o,i,!0);a.refShapeObjId=t.refShapeObjId,a.sha1="",a.orgSha1=""}t.shapeDataObj&&this._handleShapeDataObjChange(t.shapeDataObj,!1)}},{key:"onAnchorDelete",value:function(e,t){if(t.shapeData){var n=t.shapeData,i=n.shapeId,o=n.shapeTreeType,a=this.getShapeFromMap(o,i,!0),r=a.refShapeObjId;t.refShapeObjId===r&&(a.sha1="",a.orgSha1="")}t.shapeDataObj&&this._handleShapeDataObjChange(t.shapeDataObj,!1)}},{key:"getShapeUrl",value:function(e,t,n,i,o){var a=this.shapeMap.isPicture(e,t),r=n&&a,s=this.getShapeFromMap(e,t,!0);return(s.isFailed||r&&!s.orgSha1||!r&&!s.sha1||void 0!==o&&o>s.dataVersion)&&(Object(_.showDebugInfo)(_.MessageKey.requestForOriginalPictureInfo,e+"-"+t+"-"+r),this.startShapeFetching([{shapeTreeType:e,shapeId:t,origin:r}],!1),s.isFailed=!1),s.getUrl(n,i,o)}},{key:"getShapeBase64Data",value:function(e,t,n){var i=this.shapeMap.isPicture(e,t),o=n&&i,a=this.getShapeFromMap(e,t,!0);return o&&!a.orgSha1&&(Object(_.showDebugInfo)(_.MessageKey.requestForOriginalPictureInfo,e+"-"+t+"-true"),this.startShapeFetching([{shapeTreeType:e,shapeId:t,origin:!0}],!1)),o||a.sha1||(Object(_.showDebugInfo)(_.MessageKey.requestForThumbnailInfo,e+"-"+t+"-false"),this.startShapeFetching([{shapeTreeType:e,shapeId:t}],!1)),a.getBase64Data(o)}},{key:"startShapeFetching",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&e.forEach((function(e){t.shapeMap.markShapeOutOfDate(e.shapeId)})),e.forEach((function(e){t._updateShapeQueue.find((function(t){return t.shapeId==e.shapeId&&t.shapeTreeType==e.shapeTreeType&&!!t.origin==!!e.origin}))||t._updateShapeQueue.push(e)})),this._timer||(this._timer=setTimeout((function(){t.handleShapeFetching()}),100))}},{key:"handleShapeFetching",value:function(){for(var e=0;e<this._updateShapeQueue.length;)this.shapeUrlHelper.requestUrl(this._updateShapeQueue.slice(e,e+10)),e+=10;this._updateShapeQueue=[],clearTimeout(this._timer),this._timer=null}},{key:"handleShapeUrlUpdate",value:function(e,t){this.initImageEndOnce(),this.deletePicCache(e,t)}},{key:"setSessionReady",value:function(){this.shapeUrlHelper.handleSessionReady()}},{key:"getShapeFromMap",value:function(e,t,n){return this.shapeMap.getShapeInfo(e,t,n)}},{key:"calcShapeSize",value:function(e){var t=e.shapeTreeType,n=e.shapeId,i=e.maxWidth,o=e.data,a=e.doc,r=this.getShapeInfo({shapeTreeType:t,shapeId:n,data:o,doc:a}).rect.size,s=r.width,l=r.height;return i&&i<s&&(l=l*i/s,s=i),{width:s,height:l}}},{key:"shapeInfoGetter",value:function(e){var t=e.shapeTreeType,n=e.shapeId,i=e.data,o=e.doc||i.doc;if(o)return o.layer.getShapeTree(t).childs.getValue(n);console.error("Params Error")}},{key:"getShapeInfo",value:function(e){var t=e.shapeTreeType,n=e.shapeId,i=e.data,o=e.doc,a=this.shapeInfoGetter({shapeTreeType:t,shapeId:n,data:i,doc:o});return a||t!==s.c||(a=this.shapeInfoGetter({shapeTreeType:s.d,shapeId:n,data:i,doc:o})),a}},{key:"addDelayRenderShapeId",value:function(e){this._delayRenderShapes.add(e),this.shapeMap.markShapeOutOfDate(e)}},{key:"isShapeUpdated",value:function(e){return this._delayRenderShapes.has(e)}},{key:"deleteDelayRenderShapeId",value:function(e){this._delayRenderShapes.delete(e),this.shapeMap.unmarkShapeOutOfDate(e)}},{key:"getSourceUrl",value:function(e,t,n){var i=this.shapeMap.getShapeInfo(e,t);return i?n?i.orgSourceWebpUrl||i.orgSourceUrl:i.sourceWebpUrl||i.sourceUrl:""}},{key:"updateShapeUrl",value:function(e){return this.getShape.updateShapeUrl(e)}},{key:"isSupportedFormat",value:function(e,t){var n=this.shapeMap.getFormat(e,t);return n&&y.findIndex((function(e){return e===n}))>=0}},{key:"getUrlBySha1Promise",value:function(e){var t=this.shapeMap.getShapeInfoBySha1(e);if(t){var n=e===t.orgSha1;return t.getUrl(n)}return Promise.reject()}},{key:"getImageSize",value:function(e,t,n){var i=this.shapeMap.getShapeInfo(e,t);if(i)return n?i.orgSize:i.size;console.error("can not find shape info when get image size")}},{key:"addPicCache",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if((!c.isAndroid||!c.isWpsClient)&&(this.localPicCache[e]={url:t.url,info:t.info},n)){var i=n.shapeTreeType,o=n.shapeId;this.shapeMap.getShapeInfo(i,o)&&(this.shapeMap.getShapeInfo(i,o).readySha1=void 0,this.shapeMap.getShapeInfo(i,o).readyOrgSha1=void 0,this.shapeMap.getShapeInfo(i,o).mimeDataId=e)}}},{key:"deletePicCache",value:function(e,t){for(var n in this.localPicCache)if(Object.hasOwnProperty.call(this.localPicCache,n)){var i=this.localPicCache[n];if(i&&i.shape&&i.shape.shapeId===t&&i.shape.shapeTreeType===e){delete this.localPicCache[n],this.getShapeFromMap(e,t).mimeDataId="";break}}}},{key:"getPicCache",value:function(e,t){var n=void 0,i=t.shapeTreeType,o=t.shapeId;this.shapeMap.getShapeInfo(i,o)&&(n=this.shapeMap.getShapeInfo(i,o));var a=n&&n.mimeDataId?n.mimeDataId:e,r=this.localPicCache[a];return r?(r.shape=t,r):null}},{key:"clearTextBoxCache",value:function(){var e=this,t=window.APP.data;[s.d,s.b].forEach((function(n){var i=e.shapeMap.map.get(n)||new Map;i.forEach((function(o,a){var r=e.getShapeInfo({shapeTreeType:n,shapeId:a,data:t});r&&r.naked_child&&(r.naked_child.getHasTextbox&&r.naked_child.getHasTextbox()&&i.delete(a));console.log(o,a)}))}))}}],[{key:"buildGetInstance",value:function(){return l.a.buildGetInstance(e)}}]),e}();t.a=b},4104:function(e,t,n){"use strict";n.r(t),t.default={insertText:"insertText",deleteText:"deleteText",insertFile:"insertFile",formatOp:"formatOp",insertParagraph:"insertParagraph",insertComment:"insertComment",deleteComment:"deleteComment",insertPicture:"insertPicture",insertWebshape:"insertWebshape",convertHyperlink2webExtension:"convertHyperlink2webExtension",convertWebExtension2hyperlink:"convertWebExtension2hyperlink",changePicture:"changePicture",movePicture:"movePicture",deletePicture:"deletePicture",moveShape:"moveShape",resizeShape:"resizeShape",setShapeWrapFormat:"setShapeWrapFormat",setShapeZOrder:"setShapeZOrder",setShapeLayout:"setShapeLayout",insertTable:"insertTable",deleteTable:"deleteTable",insertHyperlink:"insertHyperlink",insertNHyperlink:"insertNHyperlink",editHyperlink:"editHyperlink",deleteHyperlink:"deleteHyperlink",insertSeparator:"insertSeparator",insertDatetime:"insertDatetime",replaceText:"replaceText",rearrangeParagraph:"rearrangeParagraph",smartRearrange:"smartRearrange",toBlankParagraphSplitMode:"toBlankParagraphSplitMode",deleteBlankParagraph:"deleteBlankParagraph",deletePrefixSpaces:"deletePrefixSpaces",deleteSpaces:"deleteSpaces",deleteSoftReturn:"deleteSoftReturn",convertSoftReturn:"convertSoftReturn",insertParagraphInd:"insertParagraphInd",paragraphInd2Spaces:"paragraphInd2Spaces",insertBlankParagraphs:"insertBlankParagraphs",formatPainter:"formatPainter",insertWatermark:"insertWatermark",deleteWatermark:"deleteWatermark",insertBreak:"insertBreak",insertHeaderFooter:"insertHeaderFooter",insertSymbol:"insertSymbol",paste:"paste",insertPic4ProcessOn:"insertPic4ProcessOn",insertPic4LatexMath:"insertPic4LatexMath",insertBookmark:"insertBookmark",deleteBookmark:"deleteBookmark",deleteBookmarks:"deleteBookmarks",setTextEncoding:"setTextEncoding",addContentControl:"addContentControl",deleteContentControl:"deleteContentControl",setControlTitle:"setControlTitle",moveContent:"moveContent",mergeTableCells:"mergeTableCells",splitTableCells:"splitTableCells",autoAdjustColumn:"autoAdjustColumn",typeTab:"typeTab",smartPaste:"smartPaste",deletePageNumber:"deletePageNum",insertPageNumber:"insertPageNum",setDocProps:"setDocProps",insertDocumentField:"insertDocumentField",deleteDocumentField:"deleteDocumentField",deleteDocumentFields:"deleteDocumentFields",documentFieldOp:"documentFieldOp",allDocumentFieldOp:"allDocumentFieldOp",selectDropdownListEntry:"selectDropdownListEntry",editContentControl:"editContentControl",autoAdjustTable:"autoAdjustTable",updateCtrlPlcHdrSync:"updateCtrlPlcHdrSync",insertInks:"insertInks",deleteInk:"deleteInk",deleteAllInks:"deleteAllInks",acceptAllRevisions:"acceptAllRevisions",rejectAllRevisions:"rejectAllRevisions",revisionOp:"revisionOp",setRevisionSettings:"setRevisionSettings",insertTableOfContents:"insertTableOfContents",removeTableOfContents:"removeTableOfContents",updateTableOfContents:"updateTableOfContents",modifyTableOfContents:"modifyTableOfContents",modifyComments:"modifyComments",insertShape:"insertShape",modifyShapeProps:"modifyShapeProps",modifyTextFrameProps:"modifyTextFrameProps",groupShapes:"groupShapes",ungroupShape:"ungroupShape",insertNewComment:"insertNewComment",modifyNewComment:"modifyNewComment",deleteComments:"deleteComments",deleteAllComments:"deleteAllComments",deleteRow:"deleteRow",deleteColumn:"deleteColumn",insertRowAbove:"insertRowAbove",insertRowBelow:"insertRowBelow",insertColumnLeft:"insertColumnLeft",insertColumnRight:"insertColumnRight",dragTable:"dragTable",moveTableOfRowOrCol:"moveTableOfRowOrCol",adjustRow:"adjustRow",adjustColumnEx:"adjustColumnEx",adjustTable:"adjustTable",insertFootnote:"insertFootnote",insertEndnote:"insertEndnote",setEndnotesSettings:"setEndnotesSettings",setFootnotesSettings:"setFootnotesSettings",addRepeatSecItem:"addRepeatSecItem"}},4105:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1583),l=function(){function e(t){o()(this,e),t?t.size?(this.width=t.size.width,this.height=t.size.height):t.rect?(this.width=t.rect.size.width,this.height=t.rect.size.height):this.width=this.height=0:this.width=this.height=0}return r()(e,[{key:"vpsc_size",get:function(){var t=s.a.getZoom();return e.initWithParams(t*this.width,t*this.height)}}],[{key:"initWithRect",value:function(t){return new e({rect:t})}},{key:"initWithSize",value:function(t){return new e({size:t})}},{key:"initWithParams",value:function(t,n){return new e({size:{width:t,height:n}})}},{key:"add",value:function(){for(var t=e.ZERO(),n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return i.forEach((function(e){t={width:t.width+e.width,height:t.height+e.height}})),t.width=Math.round(t.width),t.height=Math.round(t.height),t}},{key:"copy",value:function(e){return{width:e.width,height:e.height}}},{key:"ZERO",value:function(){return new e}}]),e}();t.a=l},4106:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(723),l=n(6102),u=function(){function e(){o()(this,e)}return r()(e,null,[{key:"initZone",value:function(e,t,n,i){if(e.line=t,e.lineStatus=n,i){var o=n.zoneBrokenInfo?n.zoneBrokenInfo.brokenPos:0;i.locate(o),e.dataStatus=i,e.update_begin=o}else e.dataStatus=n.dataStatus,e.update_begin=n.dataStatus.pos;e.charPosX=e.charPosStart=n.charPos,e.charPosEnd=n.textEnd,e.minCharPosX=n.minCharPos,e.next=function(){e.thisGlyphIterator=e.dataStatus.next()},e.ccp=0,e.thisGlyphIterator=e.dataStatus.glyphIterator}},{key:"processZone",value:function(t,n){for(;!this.isDataEnd(n);n.next()){++n.ccp;var i=n.thisGlyphIterator.glyphGroup,o=!0;if(i.isNormal()||i.isFarEast()||i.isZero()||i.isComplex()||i.isDrawing()?o=e.processNormalChar(t,n):i.isSpace()&&(o=e.processSpace(t,n)),!o)break}}},{key:"processZoneNoBreak",value:function(e,t){for(var n=0,i=0;!this.isDataEnd(t);t.next())++n,i+=t.thisGlyphIterator.width;t.charPosX+i>t.charPosEnd&&!t.lineStatus.bForceRenderChar?(t.zoneExceed=!0,t.dataStatus.locate(0)):(t.ccp+=n,t.charPosX+=i,t.minCharPosX+=i)}},{key:"endZone",value:function(e,t){e.typoRange.len=t.dataStatus.pos-t.update_begin,e.textWidth=t.charPosX-t.charPosStart;var n=l.a.calcHeight(e,t.lineStatus,t.dataStatus);e.heightInfo=n;var i=t.lineStatus;if(!t.zoneExceed&&e.isTextPartZone){var o=e.textPart.getGcpRange();i.dataStatus.locate(o.pos+o.len),t.lineStatus.packStatus.zoneBrokenInfo=null}else if(t.zoneExceed&&e.textPart){var a={},r=e.textPart.getGcpRange();i.dataStatus.locate(r.pos+r.len),a.brokenPos=t.dataStatus.pos,e.brokenAfter=!0,a.zone=e,t.lineStatus.packStatus.zoneBrokenInfo=a}i.charPos=t.charPosX,i.minCharPos=t.minCharPosX}},{key:"processNormalChar",value:function(t,n){var i=!0,o=n.thisGlyphIterator.width;return n.curCharRealWidth=o,n.charPosX+o>n.charPosEnd&&!n.lineStatus.bForceRenderChar&&(n.zoneExceed=!0,i=!1),i&&e.forward(n,n.curCharRealWidth),i}},{key:"processSpace",value:function(t,n){var i=n.thisGlyphIterator,o=i.width,a=!0;(n.lineStatus.bWordWrap||s.a.isNonBreakSpace(i.charCode)||n.charPosX>n.charPosEnd)&&(a=!1);var r=!0;return n.charPosX+o>n.charPosEnd&&(r=!!a),r&&e.forward(n,o),r}},{key:"forward",value:function(e,t){e.charPosX+=t,e.lineStatus.canDoCompress()?e.minCharPosX+=e.thisGlyphIterator.minWidth:e.minCharPosX+=t}},{key:"isDataEnd",value:function(e){var t=e.dataStatus;return!(!e.limitEnd||t.pos!==e.limitEnd)||t.isDataEnd}}]),e}();t.a=u},4107:function(e,t,n){"use strict";n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return p}));var i=n(24),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ti",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/15;switch(r()(this,e),this.ti2pxScale=i,n){case"px":this.ti=t*i;break;case"pt":this.ti=20*t;break;case"in":this.ti=1440*t;break;case"emu":this.ti=t/635;break;default:this.ti=t}}return l()(e,[{key:"pt",get:function(){return this.ti/20}},{key:"px",get:function(){return this.ti*this.ti2pxScale}},{key:"inch",get:function(){return this.ti/1440}},{key:"emu",get:function(){return 914400*this.ti}}]),e}();function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/15;if(!t)throw new Error("scale is invalid!");if("object"===(void 0===e?"undefined":o()(e))){var n={};for(var i in e)n[i]=c(e[i],t);return n}return new u(e,"ti",t).px}function h(e){return parseInt(e/635)}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/15;return 635*e/t}function p(e){return c(e/635)}},4108:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var i=n(309),o=n(1804);function a(e,t){if(e){if(t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;++n)if(e[n]!==t[n])return!1;return!0}return!1}return!t}function r(e,t){var n=window.APP.data.doc,a=n.layer.getShapeTree(e).childs.at(t[0]).shapeId,r=void 0,s=void 0;switch(e){case o.c:s=n.inlineAnchors,r=i.MainText;break;case o.b:s=n.anchors,r=i.HeaderFooter;break;case o.a:s=n.inlineAnchors,r=i.HeaderFooter;break;default:s=n.anchors,r=i.MainText}var l=n.getSubDocRange(r);return{id:a,gcp:s.getAnchorPos(a,l.pos,l.len)}}},4109:function(e,t,n){"use strict";n.d(t,"h",(function(){return l})),n.d(t,"f",(function(){return c})),n.d(t,"e",(function(){return h})),n.d(t,"g",(function(){return d})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return f})),n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return m}));var i=n(24),o=n.n(i),a=n(4974),r=n(4110),s=n(1731);function l(e){switch(e){case a.c:return"insert";case a.a:return"delete";case a.b:return"format";case a.e:return"paraFormat";case a.f:return"tableFormat";case a.d:return"numberFormat";default:return"unknown"}}function u(e,t,n){if(e===t)return!0;if(!e||!t)return!1;var i=new Set(Object.getOwnPropertyNames(e));return Object.getOwnPropertyNames(t).forEach((function(e){return i.add(e)})),Array.from(i).every((function(i){if(n.has(i)||e[i]===t[i])return!0;if(void 0===e[i]&&!t[i]||void 0===t[i]&&!e[i])return!0;if(!e[i]||!t[i]){if("basestyle"===i){var a=e.basestyle,r=t.basestyle;if(!a&&r&&r.id===s.n)return!0;if(a&&a.id===s.n&&!r)return!0}return!1}return"object"===o()(e[i])?!(Object.prototype.toString.call(e[i])!==Object.prototype.toString.call(t[i])||!function e(t,n){if(t===n)return!0;if(!t||!n)return!1;var i=t instanceof Array;if(i!==n instanceof Array)return!1;var a=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(n);return a.length===r.length&&a.every((function(a){if(i&&"parent"===a)return!0;if("def"===a){if(t[a]!==n[a])return!1}else{if("object"===o()(t[a]))return!(Object.prototype.toString.call(t[a])!==Object.prototype.toString.call(n[a])||!e(t[a],n[a]));if(t[a]!==n[a])return!1}return!0}))}(e[i],t[i])):e[i]===t[i]}))}function c(e,t){return u(e,t,new Set(["def","para_type","revision","type","mixMarks"]))}function h(e,t){return u(e,t,new Set(["mixMarks","bold_cs","complex_script","def","fit_text","font_name_ftcbi","font_size_cs","italic_cs","o_math","o_math_align","o_math_break","o_math_script","revision","right_to_left_text","share_hint","special","symbol_char","symbol_fontname"]))}function d(e,t){return e.userID&&e.userID.length||t.userID&&t.userID.length?!!(e.userID&&e.userID.length&&t.userID&&t.userID.length)&&e.userID==t.userID:e.user==t.user}function p(e){if(!e)return e;var t=e.duplicate();return!e.basestyle&&e.revision&&e.revision.format&&r.a.union(e.revision.format.historyBag,t),t}function f(e){if(!e)return e;var t=e.duplicate();return!e.basestyle&&e.revision&&e.revision.paraFormat&&r.a.union(e.revision.paraFormat.historyBag,t),t}function g(e){if(e){if(!v(e))return e.toString();var t=e.toString();t.endsWith("0")||(t=t.split("").reverse().join(""));var n=y(parseInt(t)),i=n.highInt,o=n.lowInt,a=y((31&o)*Math.pow(2,7)),r=y((2016&o)*Math.pow(2,21)),s=y((260096&o)*Math.pow(2,-11)),l=y(_(4294705152&o)*Math.pow(2,-6)),u=4294967295&i,c=a.highInt|r.highInt|s.highInt|l.highInt|u,h=a.lowInt|r.lowInt|s.lowInt|l.lowInt;return h=_(h),(c*Math.pow(2,32)+h).toString()}}function v(e){var t=e.toString();return!!/^\d+$/.test(t)&&!(t.length>15)}function m(e){return v(e)?"WPS Office":"WebOffice Third"}function _(e){if(e>=0)return e;var t=-e;t-=1;for(var n=(Array(32).join("0")+t.toString(2)).slice(-32).split(""),i=0;i<n.length;i++)0==n[i]?n[i]=1:n[i]=0;return t=Math.pow(2,31)+parseInt(n.join("").substring(1),2)}function y(e){for(var t=e.toString(2),n="",i=0;i<64-t.length;i++)n+="0";return n+=t,{highInt:parseInt(n.substring(0,32),2),lowInt:parseInt(n.substring(32),2)}}},411:function(e,t,n){"use strict";n.r(t),n.d(t,"DOCLayout",(function(){return p})),n.d(t,"DOCMocAncestor",(function(){return f}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(626),d=n(1252);n.d(t,"DOCLayoutType",(function(){return d.c})),n.d(t,"DOCCoorSystemType",(function(){return d.a}));var p=function(){function e(t){var n=t.parent,i=t.viewPage,o=t.coorSystem;l()(this,e),this.init({parent:n,viewPage:i,coorSystem:o})}return c()(e,[{key:"init",value:function(e){var t=e.parent,n=e.viewPage,i=e.coorSystem;this.parent=t,this.viewPage=void 0===n?this:n,this.coorSystem=null!=i?i:d.a.Unknown,this.isMoc=this.parent&&this.parent.isMoc}},{key:"getContext",value:function(){return this.context?this.context:this.parent.context}},{key:"isHit",value:function(e){return!1}},{key:"isView",value:function(){return!1}},{key:"isScene",value:function(){return!1}},{key:"isHost",value:function(){return!1}},{key:"isCoorSystem",value:function(){return!1}},{key:"resetParent",value:function(e){this.parent=e,this.viewPage=e.viewPage}},{key:"getScenePath",value:function(){for(var e=[],t=this;t;t=t.parent)e.push(t);return e.reverse()}},{key:"getWholePath",value:function(){for(var e=[],t=this,n=null;t;)n=t.getScenePath(),t=n[0].outer,e.push(n);return e.reverse()}},{key:"getPageByGcpWithinMaintext",value:function(e){var t=this.textLineRanges.findNodeContainPos(e),n=t&&t.line;if(n)return n.viewPage.layout_index}},{key:"cleanRenderInfo",value:function(){delete this.renderInfo}},{key:"layoutType",get:function(){return d.c.Unknown}},{key:"layoutName",get:function(){return d.b[this.layoutType]}},{key:"view",get:function(){return this.viewPage.view}},{key:"scene",get:function(){if(null===this.parent)return this;for(var e=this.parent;!e.isScene();)e=e.parent;return e}},{key:"host",get:function(){if(null===this.parent)return this;for(var e=this.parent;!e.isHost();)e=e.parent;return e}},{key:"viewOffset",get:function(){var e=this.parent.viewOffset;return{x:this.rect.left+e.x,y:this.rect.top+e.y}}},{key:"position2parent",get:function(){return h.a.ZERO()}},{key:"offset4child",get:function(){return h.a.ZERO()}},{key:"svgNode",get:function(){return this.renderInfo&&this.renderInfo.svgNode},set:function(e){this.renderInfo||(this.renderInfo={}),this.renderInfo.svgNode=e}}]),e}(),f=function(e){function t(e){var n=e.viewOffset;l()(this,t);var i=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{}));return i._viewOffset=n||h.a.ZERO(),i}return r()(t,e),c()(t,[{key:"isView",value:function(){return!0}},{key:"isScene",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"isCoorSystem",value:function(){return!0}},{key:"viewOffset",get:function(){return this._viewOffset}}]),t}(p)},4110:function(e,t,n){"use strict";var i=n(24),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(1731),c=n(811),h=["bold","bold_cs","italic","italic_cs","strike","double_strike","vanish","outline","caps","small_caps","emboss","imprint"],d=function(){function e(){r()(this,e)}return l()(e,null,[{key:"union",value:function(t,n){for(var i in t)if(void 0!==t[i])if(void 0===n[i])n[i]=t[i];else{if("tab_stops"===i)continue;null!==n[i]&&"object"===o()(n[i])&&e.union(t[i],n[i])}}},{key:"unionAutoNumPapx",value:function(t,n){for(var i in t)if(void 0!==t[i])if(void 0===n[i])n[i]=t[i];else{if("tab_stops"===i)continue;null!==n[i]&&"object"===o()(n[i])&&e.union(t[i],n[i])}}},{key:"resetIndent",value:function(e){var t=e.getProp("list_id"),n=t.val;t.def||-1!==n||(this.prepareIndentValue(e,"left_indent_chars",0),this.prepareIndentValue(e,"left_indent_abs",0),this.prepareIndentValue(e,"first_line_indent_chars",0),this.prepareIndentValue(e,"first_line_indent_abs",0),this.prepareIndentValue(e,"right_indent_chars",0),this.prepareIndentValue(e,"right_indent_abs",0))}},{key:"prepareIndentValue",value:function(e,t,n){e.getProp(t).def&&(e[t]=n)}},{key:"complanateIndent",value:function(e,t){this.complanateIndentAtom(e,t,"left_indent_chars","left_indent_abs"),this.complanateIndentAtom(e,t,"first_line_indent_chars","first_line_indent_abs"),this.complanateIndentAtom(e,t,"right_indent_chars","right_indent_abs")}},{key:"complanateIndentAtom",value:function(e,t,n,i){var o=this.complanateIndentAtom_GetIndent(e,t,n),a=this.complanateIndentAtom_GetIndent(e,t,i);(o.hasProp||a.hasProp)&&(e[n]=o.val,e[i]=a.val)}},{key:"complanateIndentAtom_GetIndent",value:function(e,t,n){for(var i=e,o=i.getPropVal("list_level"),a=t.stylesheet,r=t.autoNumMgr;i;){var s=this.complanateIndentAtom_GetAttr(i,n);if(s.hasProp)return s;if(o<10){var l=i.getPropVal("list_id");o=i.getPropVal("list_level");var u=i.hasAutoNum()&&r.findAutoNum(l);if(u&&o>=0&&o<u.levels.length){var c=u.levels[o].papx;if(c){var h=this.complanateIndentAtom_GetAttr(c,n);if(h.hasProp)return h}}}if(i.basestyle){var d=a.getPrimeStyle(i.basestyle);i=d?d.papx:null}else i=null;if(null==i)return s}return{hasProp:!1,val:0}}},{key:"complanateIndentAtom_GetAttr",value:function(e,t){var n=!1;return t in e&&(n=!0),{hasProp:n,val:e.getPropVal(t)}}},{key:"complanateOutLineLevel",value:function(e,t,n){var i=e.basestyle.id;i>=u.c&&i<=u.k&&t.papx.getProp("out_line_level").def&&(n.out_line_level=i-u.c)}},{key:"getPapWithStyle",value:function(e,t){var n=e,i=t.stylesheet,o=t.autoNumMgr;if(!n)return null;var a=n.list_id,r=n.list_level,s=n.duplicate();this.resetIndent(s);var l=n.hasAutoNum()&&o.findAutoNum(a);if(l&&void 0===r&&n.basestyle)for(var u=i.getStyleByProp(n);u;){if(u.papx.list_id===l.listId&&void 0!==u.papx.list_level){r=u.papx.list_level;break}if(!u.papx.basestyle)break;u=i.getStyleByProp(u.papx)}for(l&&(void 0===r||r>=l.levels.length)&&(r=l.levels.length-1),l&&(this.complanateIndent(s,t),this.unionAutoNumPapx(l.levels[r].papx,s));n&&n.basestyle;){var c=i.getStyleByProp(n);if(this.complanateIndent(s,t),this.complanateOutLineLevel(n,c,s),this.union(c.papx,s),n=c.papx,-1===a||void 0===a){a=n.list_id,r=n.list_level;var h=n.hasAutoNum()&&o.findAutoNum(a);h&&r>=h.levels.length&&(r=h.levels.length-1),h&&(this.complanateIndent(s,t),this.unionAutoNumPapx(h.levels[r].papx,s))}}return s}},{key:"getChpWithStyle",value:function(e,t,n){if(!e)return null;var i={};t&&t.basestyle&&this.mergedChpFromPapStyle(t,n.stylesheet,i);var o=new c.a;return this.mergedChpFromChpStyle(e.duplicate(),n.stylesheet,i,o),this.convertChpxType(o),o}},{key:"mergedChpFromPapStyle",value:function(e,t,n){var i=e,o=t.getPrimeStyle(i.basestyle);if(o){(i=o.papx)&&i.basestyle&&this.mergedChpFromPapStyle(i,t,n);var a=o.chpx.duplicate();this.reverseProps(a,n),this.union2(a,n,!0)}}},{key:"mergedChpFromChpStyle",value:function(e,t,n,i){var o=!0;if(e&&e.basestyle){var a=t.getStyleByProp(e);o=!1,this.mergedChpFromChpStyle(a.chpx.duplicate(),t,n,i)}var r=e;o?(this.reverseProps(r,n),this.union2(n,r,!1)):this.reverseProps(r,i),this.union2(r,i,!0)}},{key:"reverseProps",value:function(e,t){h.forEach((function(n){if(128===e[n]){var i=t&&t[n]?t[n]:e.def[n];e[n]=i}else if(129===e[n]){var o=t&&t[n]?t[n]:e.def[n];e[n]=!o}}))}},{key:"convertChpxType",value:function(e){h.forEach((function(t){"number"==typeof e[t]&&(e[t]=!!e[t])}))}},{key:"union2",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var a in t)if(void 0!==t[a]){var r=n[a];(i||void 0===r||""===r)&&(null===r||"object"!==(void 0===r?"undefined":o()(r))?n[a]=t[a]:e.union(t[a],r))}}}]),e}();t.a=d},4111:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i=1,o=2},4112:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return r}));var i=-1,o=-2,a=-3,r=-4},4113:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s="#000",l=function(){function e(){o()(this,e),this.init()}return r()(e,[{key:"init",value:function(){this.startX=-1,this.endX=-1,this.height=-1}},{key:"reset",value:function(){this.init()}},{key:"expandRangeEnd",value:function(e){this.endX===e.x?this.endX+=e.widthSum:this.startX=e.x,this.endPos=e.endPosition}},{key:"getItem",value:function(){return{startX:this.startX,endX:this.endX,scriptPos:this.scriptPos,startPos:this.startPos,endPos:this.endPos,yPos:this.yPos}}}]),e}(),u=function(){function e(){o()(this,e),this.init()}return r()(e,[{key:"init",value:function(){this.initItem(),this.isProcessing=!1,this.items=[],this.preInfo={}}},{key:"getItems",value:function(){return this.isProcessing&&(this.pushItem(),this.isProcessing=!1),this.items.slice(0)}},{key:"resetItem",value:function(){this.item.reset()}},{key:"canJoin",value:function(e){return this.item.endX===e.x||e.x+e.widthSum===this.item.startX}},{key:"process",value:function(e){this.isType(e)?this.isProcessing?!this.canJoin(e)||this.isDifferent(e)?(this.pushItem(),this.recordPreInfo(e),this.isProcessing=!0,this.moveNext(e)):this.item.expandRangeEnd(e):(this.recordPreInfo(e),this.isProcessing=!0,this.moveNext(e)):this.isProcessing&&(this.pushItem(),this.isProcessing=!1),e.isLast&&this.isProcessing&&(this.pushItem(),this.isProcessing=!1)}},{key:"pushItem",value:function(){this.items.push(this.item.getItem())}},{key:"moveNext",value:function(e){this.resetItem(),this.item.scriptPos=e.scriptPos,this.item.startX=e.x,this.item.endX=e.x+e.widthSum,this.item.yPos=this.calcYPos(e),this.item.startPos=e.beginPosition,this.item.endPos=e.endPosition}}]),e}()},4114:function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return d}));var i=n(684);function o(e){return e.reduce((function(e,t,n){return e[t]=n,e}),{})}var a=o(["editable-area","cell-shd","para-shd","chp-shd","highlight","findHighlight","recordHighlight","coopsels","documentfileds","twinkle-light-container","para-border","main-content","embed","commentParagraph","wrap","revision-lines","spellCheck","customHighlight","customUnderline","selection","table-border","columnline","line-numbering"]),r=o(["editable-area","cell-shd","para-shd","chp-shd","highlight","findHighlight","recordHighlight","coopsels","documentfileds","twinkle-light-container","selection","para-border","main-content","embed","commentParagraph","spellCheck","customHighlight","customUnderline","revision-lines","shapeSelection","table-border","line-numbering"]),s=void 0;function l(e){switch(e){case i.TYPO_MODE.MODE_PC:s=a;break;default:s=r}}function u(e,t,n){return function(e,t,n,i){try{var o=e.childNodes,a=c(t,e,i),r=a.index,s=a.targetNode,l=o.length;if(s)return n.enterChildCtxByNode(s);var u=n.createG(t);return r>=l?e.appendChild(u):e.insertBefore(u,o[r]),n.enterChildCtxByNode(u)}catch(i){console.warn(i);var h=n.createG(t);e.appendChild(h)}}(e,t,n,s)}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,i=n[e],o=t.childNodes,a=o.length,r=void 0,l=void 0;if(i>=0){r=0;for(var u=Math.min(i+1,a);r<u;){var c=o[r],h=c.getAttribute("id");if("shapeSelection"!==e||"main"!==h){if(!h||null==n[h]||n[h]<0)break;if(h===e){l=c;break}if(n[h]>i)break;++r}else++r}r=Math.min(i,r)}return{index:r,targetNode:l}}var h={"editable-area":{x:!0,y:!0},highlight:{x:!0,y:!0},"para-shd":{x:!0,y:!0},"chp-shd":{x:!0,y:!0},"cell-shd":{x:!0,y:!0},"main-content":{x:!0,y:!0},"para-border":{x:!0,y:!0},documentfileds:{x:!0,y:!0},"table-border":{x:!0,y:!0},columnline:{x:!0,y:!0},embed:{x:!0,y:!0},spellCheck:{x:!0,y:!0},"revision-lines":{x:!1,y:!0,"shape-rendering":"crispEdges"}},d={"revision-lines":"crispEdges"}},448:function(e,t,n){"use strict";t.a=function(e,t,n){var i=!(n&&!1===n.trailing),o=Date.now(),a=void 0,r=void 0,s=null;function l(){for(var n=arguments.length,l=Array(n),u=0;u<n;u++)l[u]=arguments[u];a=this;var c=Date.now();if(void 0===r)return r=-1,s=e.apply(this,l),o=c,s;var h=c-o,d=t-h;return d>0?-1===r&&(r=setTimeout((function(){!1!==i&&(s=e.apply(a,l),o=Date.now()),r=-1}),d)):(s=e.apply(this,l),o=c),s}return Number(t)||(t=16),l.cancel=function(){r&&-1!==r&&(clearTimeout(r),r=-1)},l}},4575:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u}));var i=n(2),o=n.n(i),a=n(1),r=n.n(a),s={ascii:-1,ea:-2,cs:-3,bi:-4},l=function e(t){r()(this,e),this.private={name:""},this.private.name=t.name},u=function(){function e(t,n){r()(this,e),this.theme=n,this.reservedFonts=t.reservedFonts||[0,1,0,0],this.naked_fonts=t.fonts}return o()(e,[{key:"query",value:function(e){var t=this.naked_fonts.vector.findIndex((function(t){return t.private.name==e}));if(-1==t){t=this.naked_fonts.vector.length;var n={name:e};this.naked_fonts.vector.push(new l(n))}return t}},{key:"get",value:function(e){var t=e;null==t&&(t=0);var n=t%65536,i=t-n;if(i){var o=this.theme.getName(n,i);if(!o)return null;n=this.query(o)}if(n<0){var a=this.getReservedFontFtc(n);return 0===a>>16?this.naked_fonts.vector[this.reservedFonts[Math.abs(n)-1]].private:this.get(a)}return n>=this.naked_fonts.vector.length?this.naked_fonts.vector[0].private:this.naked_fonts.vector[n].private}},{key:"getName",value:function(e){var t=this.get(e);return t?t.name:this.naked_fonts.vector[0].private.name}},{key:"getReservedFontFtc",value:function(e){return this.reservedFonts[Math.abs(e)-1]}},{key:"length",get:function(){return this.naked_fonts.vector.length}}]),e}()},4576:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(336),l=n(1910),u=function(){function e(){o()(this,e)}return r()(e,null,[{key:"calcFontSizeForSubOrSuperScript",value:function(e,t,n,i){var o=.6,a=Object(l.e)(i);if(a&&a.ySubscriptYOffset&&a.ySuperscriptYOffset&&a.EMSize&&a.ySubscriptYSize&&a.ySuperscriptYSize&&a.ySubscriptYOffset<=.501953125*a.EMSize&&a.ySuperscriptYOffset<=.751953125*a.EMSize){(o=(t?a.ySubscriptYSize:a.ySuperscriptYSize)/a.EMSize)<.5&&(o=.6)}return Object(s.Ti2Px)(Math.floor(Object(s.Px2Ti)(n)*o))}},{key:"calcFontsize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(t?e.getPropVal("font_size_cs")||e.getPropVal("font_size_normal"):e.getPropVal("font_size_normal")||e.getPropVal("font_size_cs"))||14;if(!t){var i=e.getPropVal("asian_layout");i&&i.combine&&(n/=2)}return Object(s.Ti2Px)(parseInt(n))}}]),e}();t.a=u},4577:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return p}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(5737),l=n(676),u=s.a,c=["．","‧","˙","、","。","˚","￠"],h={INIT:0,IN_PROGRESS:1,FINISH:2,ERROR:3},d=256,p=function(){function e(){o()(this,e),this._emphasizeMeasurerRoot=null,this._emphasizeMeasurer=null,this._emphasizeSVGRoot=null,this._emphasizeSVGText=null,this._measureEmphasisState={},this._measureEmphasisCommandStack=[],this._measureEmphasisCurrentHandleCommand=null}return r()(e,[{key:"isCurrentEmphasisCommandEmpty",value:function(){return 0===this._measureEmphasisCommandStack.length}},{key:"emphasisCommandSize",value:function(){return this._measureEmphasisCommandStack.length}},{key:"pushEmphasisCommand",value:function(e){this._measureEmphasisCommandStack.push(e)}},{key:"popEmphasisCommand",value:function(){return this._measureEmphasisCommandStack.pop()}},{key:"getCurrentHandlingCommand",value:function(){return this._measureEmphasisCurrentHandleCommand}},{key:"topElementCommand",value:function(){return this._measureEmphasisCommandStack[this._measureEmphasisCommandStack.length-1]}},{key:"refreshCurrentHandingCommand",value:function(){this._measureEmphasisCurrentHandleCommand=this.isCurrentEmphasisCommandEmpty()?null:this.topElementCommand()}},{key:"emptyEmphasisStack",value:function(){this._measureEmphasisCommandStack.length=0}},{key:"startMeasurer",value:function(e,t){this._emphasizeMeasurerRoot||this._createNode();var n=u?performance.now():0,i=this._getEmBoxInfo(e,t),o=i.width,a=i.height;return u&&console.log("%cemphasize measurer step one time consume【"+window.APP.fontServer.getEmphasisMetricsLocalKey(e,t)+"】: ","color:green;",performance.now()-n),n=u?performance.now():0,this._updateRelatedTextNode(e,t),this._emphasizeSVGRoot.setAttribute("width",o),this._emphasizeSVGRoot.setAttribute("height",a),u&&console.log("%cemphasize measurer step two time consume 【"+window.APP.fontServer.getEmphasisMetricsLocalKey(e,t)+"】: ","color:green;",performance.now()-n),this._convertNode2Image(o,a,e,t)}},{key:"updateEmphasisMeasurerState",value:function(e,t){this._measureEmphasisState[e]=t}},{key:"getMeasurerState",value:function(e){return this._measureEmphasisState[e]||h.INIT}},{key:"getFinishMeasureEmphasis",value:function(){var e=this;return Object.keys(this._measureEmphasisState).filter((function(t){return e._measureEmphasisState[t]===h.FINISH}))}},{key:"clearMeasureState",value:function(){this._measureEmphasisState={}}},{key:"parseMeasureKey2FontArgPlusRenderContent",value:function(e,t){var n=e.split("_");t.fontFamily=n[0],t.renderContent=n[n.length-1],t.fontSize=n[n.length-2],4===n.length?(t.fontWeight="bold"===n[1]?"bold":"",t.fontStyle="italic"===n[1]?"italic":""):(t.fontWeight=n[1],t.fontStyle=n[2])}},{key:"_generateRealPaintAreaPosition",value:function(e){for(var t=e.data,n=e.width,i=e.height,o=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,l=0;l<i;++l)for(var u=0;u<n;++u){var c=l*n+u,h=t[4*c],d=t[4*c+1],p=t[4*c+2];(255^h||255^d||255^p)&&(l<o&&(o=l),l>r&&(r=l),u<a&&(a=u),u>s&&(s=u))}return{leftUpper:{x:a+1,y:o+1},rightUpper:{x:s+1,y:o+1},rightDown:{x:s+1,y:r+1},leftDown:{x:a+1,y:r+1}}}},{key:"_setNodeStyle",value:function(e,t,n){var i=t.fontFamily,o=t.fontStyle,a=t.fontWeight,r=t.fontSize;Object(l.assignStyle2)(e,{"font-family":i,"font-size":r+"px","font-style":o||"normal","font-weight":a||"normal"}),e.textContent=n}},{key:"_getEmBoxInfo",value:function(e,t){return this._setNodeStyle(this._emphasizeMeasurer,e,t),{width:this._emphasizeMeasurer.offsetWidth,height:this._emphasizeMeasurer.offsetHeight}}},{key:"_updateRelatedTextNode",value:function(e,t){this._setNodeStyle(this._emphasizeSVGText,e,t)}},{key:"_convertNode2Image",value:function(e,t,n,i){var o=this;return new Promise((function(a,r){var s=u?performance.now():0,c='<?xml version="1.0" standalone="no"?>\r\n'+(new XMLSerializer).serializeToString(o._emphasizeSVGRoot),h=new Image;h.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(c);var d=Object(l.createElement)({type:"canvas",classname:"emphasize_measurer_canvas"});d.width=e,d.height=t;var p=d.getContext("2d");p.fillStyle="#fff",p.fillRect(0,0,e,t);var f=o;h.onload=function(){try{p.drawImage(h,0,0);var o=p.getImageData(0,0,e,t),l=f._generateRealPaintAreaPosition(o),c=(l.leftUpper.x+l.rightUpper.x)/2,d=(l.leftUpper.y+l.leftDown.y)/2;u&&console.log("%cemphasize measurer step three time consume【"+window.APP.fontServer.getEmphasisMetricsLocalKey(n,i)+"】: ","color:red;",performance.now()-s),a({centerPoint:{x:c,y:d},width:l.rightUpper.x-l.leftUpper.x,height:l.rightDown.y-l.rightUpper.y})}catch(e){console.log("emphasize measurer error"),r(e)}},h.onerror=function(){console.log("emphasize measurer error"),r("promise reject: convert node to image: load image error")}}))}},{key:"_createNode",value:function(){this._createDIVNode(),this._createSVG()}},{key:"_createDIVNode",value:function(){var e=Object(l.createElement)({type:"div",classname:"emphasize_measurer_root"}),t=Object(l.createElement)({type:"text",classname:"emphasize_measurer_root"});Object(l.assignStyle2)(e,{position:"fixed",top:"0px",left:"0px",display:"block","z-index":"-99",opacity:"0",width:"auto",height:"auto"}),Object(l.assignStyle2)(t,{visibility:"hidden",position:"fixed",top:"0px",left:"0px","z-index":"-99","line-height":"normal"}),e.appendChild(t),document.body.appendChild(e),this._emphasizeMeasurerRoot=e,this._emphasizeMeasurer=t}},{key:"_createSVG",value:function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg"),n=document.createElementNS(e,"text");n.setAttributeNS(null,"x","0"),n.setAttributeNS(null,"y","0"),n.setAttributeNS(null,"dominant-baseline","text-before-edge"),t.appendChild(n),this._emphasizeMeasurerRoot.appendChild(t),t.classList.add("emphasize_measurer_svg_root"),n.classList.add("emphasize_measurer_svg_text"),this._emphasizeSVGRoot=t,this._emphasizeSVGText=n}}]),e}()},4578:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i=0,o=1},4579:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return r}));var i=0,o=1,a=2,r=3},4580:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(410),l=n(310),u=n(6112),c=n(411),h=n(626),d=n(3860),p=n(1251),f=function(){function e(t){var n=t.viewPage,i=t.range,a=t.frameData;o()(this,e),this.init({viewPage:n,range:i,frameData:a})}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCCard",base:u.a,methodName:"init"},{baseName:"DOCLayout",base:c.DOCLayout,methodName:"init"},{baseName:"ITRange",base:l.ITRange,methodName:"init"}]}}]),r()(e,[{key:"init",value:function(e){var t=e.viewPage,n=e.range,i=e.frameData;this.mixin_DOCCard_init(),this.mixin_DOCLayout_init({parent:null,viewPage:t}),this.mixin_ITRange_init(n.begin,n.end),this.isWrap=!0,i?(this.frameProp=i.frameProp.text_frame,this.isWrapTable=i.frameProp.isWrapTable,this.allowover=this.frameProp.overlap,this.wrap_mode=this.frameProp.wrapMode):(this.allowover=!1,this.wrap_mode=p.c),this.layoutInCell=!0,this.isSnippetCard=!0,this.hostPendings=[]}},{key:"reset",value:function(e){return this.isWrap=!0,e?(this.frameProp=e.frameProp.text_frame,this.isWrapTable=e.frameProp.isWrapTable,this.allowover=this.frameProp.overlap,this.wrap_mode=this.frameProp.wrapMode):(this.allowover=!1,this.wrap_mode=p.c),this.isSnippetCard=!0,this}},{key:"initRange",value:function(e){this.mixin_ITRange_init(e.pos,e.pos+e.len)}},{key:"isScene",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"selectLayersByPack",value:function(e){return this.layers}},{key:"createLayersByPack",value:function(e){return this.layers||(this.layers=new d.a({parent:this,viewPage:this.viewPage,coorSystem:c.DOCCoorSystemType.Canvas}),this.viewPage.layers.addChild(this.layers)),this.layers}},{key:"isCoorSystem",value:function(){return!0}},{key:"isContain",value:function(e){return l.IT.containTest(this,e)}},{key:"clone",value:function(){var e=Object.assign({},this);return e.isTextFrame=this.isTextFrame,e}},{key:"cleanRenderInfo",value:function(){this.snippetPack&&this.snippetPack.cleanRenderInfo(),delete this.renderInfo}},{key:"isTextFrame",get:function(){return!0}},{key:"layoutType",get:function(){return c.DOCLayoutType.SnippetScene}},{key:"position2parent",get:function(){return h.a.initWithOrigin({x:this.rect.left,y:this.rect.top})}},{key:"offset4child",get:function(){return h.a.ZERO()}}]),e}();t.a=f,s.a.mix(f,u.a,c.DOCLayout,l.ITRange)},4581:function(e,t,n){"use strict";n.r(t),n.d(t,"getBubbleByPlaceHolder",(function(){return L})),n.d(t,"getBubblesByRange",(function(){return F})),n.d(t,"getBubbleDataById",(function(){return B})),n.d(t,"DOCComments",(function(){return O})),n.d(t,"DOCCommentBodys",(function(){return P})),n.d(t,"DOCCommentBubbles",(function(){return M})),n.d(t,"getCommentId",(function(){return R}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(410),d=n(952),p=n(310),f=n(1103),g=n(1169),v=n(2294),m=n(1643);n.d(t,"commentsUtil",(function(){return m}));var _=n(554),y=n(324),b=n(309),T=n(805),C=n(760),k=n(1290),w=n(1170),S=function(){function e(t,n,i,o,a){l()(this,e),this.init(t,n,i,o,a)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:g.d,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i,o){this.mixin_DOCRange_init(t,n,i,o),this.comment=e}}]),e}(),P=function(){function e(t,n){l()(this,e),this.document=n,this.rangeClass=new g.e(n,f.d,p.IT.upper,p.IT.NonIntersect,!0),Object(_.default)(this),d.a.bind(this.rangeClass,"attacher",(function(e){return new g.c(e,e.sortby,e.refIds)})),this.rangeClass.attachObserver(this)}return c()(e,[{key:"getCommentByPos",value:function(e){return void 0===e?null:(this.rangeClass.findNodeContainPos(e)||{}).comment}},{key:"onAttachNode",value:function(e,t){this._dispatch("onInsertCommentBody",t)}},{key:"onDetachNode",value:function(e,t){this._dispatch("onRemoveCommentBody",t)}}]),e}(),I=function(){function e(t,n,i,o,a,r){l()(this,e),this.init(t,n,i,o,a,r)}return c()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:g.d,methodName:"init"}]}}]),c()(e,[{key:"init",value:function(e,t,n,i,o,a){this.mixin_DOCRange_init(e,t,Object(g.g)(n),o),this.refData=a,this.document=i;var r=this.getData().getBody();if(r&&(void 0!==r.pos?this.body=new S(this,r.pos,r.pos+r.len,r.data,r.refId):this.body=new S(this,r.getPos(),r.getPos()+r.getLen())),n.getName){var s=n.getName();this.rc_id=s&&m.decodeBkName(s).comment_id}this.rc_id||(this.rc_id=v.getRandomId()),this._woUserId=void 0,a&&a.on&&a.on(this.onCommentDataChanged.bind(this))}},{key:"filterContentFormula",value:function(e){return!!new Set([y.d,y.e]).has(e)}},{key:"setBody",value:function(e){this.getData().setBody(e),e.comment=this}},{key:"onCommentDataChanged",value:function(e,t){var n=e.getDone(),i=e.getReply(),o={isDone:this.isDone!==n};this.isDone=n,this.isReply=i,this.document&&this.document.comments&&this.document.comments._dispatch("onCommentDataChanged",this,o)}},{key:"cloneData",value:function(){return{pos:this.pos,len:this.len,data:this.data,refId:this.refId,refData:this.refData}}},{key:"_setRcId",value:function(e){this.rc_id=e}},{key:"content",get:function(){var e=this.document.getText(this.body.pos,this.body.len),t=void 0!==this.comment_userId?this.comment_userId:m.getCommentUserIdByCommentBody(this.body);return this.relatedUserIds=Object(k.getRelatedUserIdsByContent)(e,t?[t]:[]),e=Object(C.filterText)(e,this.filterContentFormula),e=Object(T.r2n)(e)}},{key:"author",get:function(){return this.getData().getAuthor()}},{key:"date",get:function(){try{return this.getData().getDate()}catch(e){return"1988-01-01 08:00:00"}}},{key:"type",get:function(){return"comment"}},{key:"woUserId",get:function(){return void 0===this._woUserId&&(this._woUserId=this.document.getDataLogic("prime").getChp(this.end,p.IT.Exclude).getPropSelf("wo_user_id")),this._woUserId}},{key:"isDone",get:function(){return this.getData().getDone()},set:function(e){this.getData().setDone(e)}},{key:"isReply",get:function(){return this.getData().getReply()},set:function(e){this.getData().setReply(e)}}]),e}();function E(e,t){return e.begin<t.end&&t.end<=e.end}h.a.mix(S,g.d),h.a.mix(I,g.d);var O=function(){function e(t,n){l()(this,e),Object(g.f)(this),this.document=n,this.commentBodys=n.commentBodys,this.rangeClass=new g.e(n,f.c,p.IT.outer,p.IT.Crossing,!0),this.rangeClass.deleteTest=E,this.idCacheMgr=new D,this.ids={},Object(_.default)(this),this.rangeClass.attachObserver(this);var i=this;t.forEach((function(e){i.doInsertNakedRange(e)}))}return c()(e,[{key:"doInsertNakedRange",value:function(e){var t=new I(e.pos,e.pos+e.len,e.data,this.document,e.refId,e.refData);this.rangeClass.attachNode(t),this.commentBodys.rangeClass.attachNode(t.body),t.setBody(t.body),t.rc_id=this.idCacheMgr.getCachedCommentId(t),!e.refId&&this.setLocalComment(t),e.refId&&this._cacheNewestComments(t),this._dispatch("onInsertComment",t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);this.getLocalComment()==t&&this.clearLocalComment(),this._dispatch("onRemoveComment",t),window.APP.workspace&&window.APP.workspace.updateDisabled&&this.idCacheMgr.cacheCommentId(t),this.commentBodys.rangeClass.detachNode(t.body),this.rangeClass.detachNode(t)}},{key:"getNextComment",value:function(e){for(var t=this.rangeClass.map(),n=void 0,i=0;i<t.length;++i)if(t[i].begin>e.pos||t[i].begin==e.pos&&t[i].end>e.pos+e.len){n=t[i];break}return n}},{key:"insertComment",value:function(e){var t=e.pos,n=e.len,i=void 0===n?0:n,o=e.string,a=void 0===o?"":o,r=e.author,s=void 0===r?"":r,l=e.date,u=void 0===l?"":l,c=e.bkName,h=e.isReply,d=void 0!==h&&h,p=e.submit,f=e.commentId,g=e.commentType,v=e.contents,m=Object(T.n2r)(a),_=this.document.mathManager.getMath(i>0?t+i-1:t);this.document.mathManager.setMathEdit(!!_);var y={pos:t,len:i,string:m,strlen:m.length,author:s,date:u,bkName:c,isReply:d,isDone:!1,submit:p,contents:v};window.APP.isReadOnlyComment()&&(y.commentId=f,y.commentType=g);var b={name:"insertComment",param:y};window.APP.editor.cmdExecutor.exec(b),this.document.mathManager.setMathEdit(!1)}},{key:"insertDocComment",value:function(e){var t=e.string,n=void 0===t?"":t,i=e.author,o=void 0===i?"":i,a=e.date,r=void 0===a?"":a,s=e.bkName,l=e.commentId,u=e.commentType,c=e.contents,h=this.document.getSubDocRange(b.MainText),d=h.pos+h.len-1;this.insertComment({pos:d,len:0,string:n,author:o,date:r,commentId:l,commentType:u,bkName:s,contents:c})}},{key:"insertCommentReply",value:function(e){for(var t=e.string,n=void 0===t?"":t,i=e.author,o=void 0===i?"":i,a=e.date,r=void 0===a?"":a,s=e.bkName,l=e.submit,u=e.replyId,c=e.commentId,h=e.commentType,d=e.contents,p=this.getCommentByCommentId(u),f=p.pos,g=p.len,v=this.rangeClass.findNodeEqualRange(f,f+g+1);v&&v.isReply;)++g,v=this.rangeClass.findNodeEqualRange(f,f+g+1);this.insertComment({pos:f,len:g,string:n,author:o,date:r,bkName:s,isReply:!0,submit:l,commentId:c,commentType:h,contents:d})}},{key:"modifyComment",value:function(e){var t=e.commentId,n=e.pos,i=e.len,o=e.replyId,a=e.isReply,r=void 0!==a&&a,s=e.string,l=void 0===s?"":s,u={name:"modifyNewComment",param:{commentId:t,pos:n,len:i,replyId:o,isReply:r,contents:e.contents,string:Object(T.n2r)(l)}};return window.APP.editor.cmdExecutor.exec(u)}},{key:"removeComment",value:function(e){var t=e.pos,n=e.len;if(void 0!==t&&void 0!==n){var i={name:"deleteComment",param:{pos:t,len:n}};window.APP.editor.cmdExecutor.exec(i)}}},{key:"removeComments",value:function(e){e&&e.length&&window.APP.editor.cmdExecutor.exec({name:"deleteComments",param:{comments:e}})}},{key:"getCommentByBookmarkPos",value:function(e){var t=this.commentBodys.rangeClass.findNodeContainPos(e);return t&&t.comment||null}},{key:"getCommentByCommentEnd",value:function(e){return 0===e?null:this.rangeClass.findNodeEndWith(e)}},{key:"collectByPlaceHolder",value:function(e,t,n){return this.rangeClass.mapInRange(e,e+t,n,E)}},{key:"collectComments",value:function(e,t,n){return this.rangeClass.mapInRange(e,e+t,n,p.IT.strictIntersectTest)}},{key:"getComment",value:function(e){var t=this.collectComments(e,1);return t.length>0?t[0]:null}},{key:"getCommentByRcId",value:function(e){var t=void 0;return this.rangeClass.forEachNode((function(n){if(n.rc_id===e)return t=n,!0})),t}},{key:"getCommentByCommentId",value:function(e){return!e||Object(w.isTempCommentId)(e)?null:(this.ids[e]||console.warn("Not find comment by comment_id"),this.ids[e])}},{key:"getCommentByRange",value:function(e,t){return void 0===e||void 0===t?null:this.rangeClass.findNodeEqualRange(e,e+t)}},{key:"empty",value:function(){return this.rangeClass.tree.empty()}},{key:"count",value:function(){var e=0;return this.rangeClass.forEachNode((function(t){++e})),e}},{key:"getCommentById",value:function(e,t,n){return this.rangeClass.findRangeByRefId(e)||this.getCommentByCommentId(t)||this.getCommentByRcId(n)}},{key:"onAttachNode",value:function(e,t){t.comment_id&&(this.ids[t.comment_id]=t),this._dispatch("onAttachCommentNode",t)}},{key:"onDetachNode",value:function(e,t){t.comment_id&&delete this.ids[t.comment_id],this._dispatch("onDetachCommentNode",t)}},{key:"_setCommentId",value:function(e,t,n,i){e.comment_id=t,e.comment_type=n,e.comment_userId=i,e.comment_id&&(this.ids[t]=e)}},{key:"setLocalComment",value:function(e){this.localComment=e}},{key:"getLocalComment",value:function(){var e=this;return this.localComment&&!this.localComment.isOrphan()&&this.localComment.body&&!this.localComment.body.isOrphan()||(console.warn("Error local comment cahce!"),this.rangeClass.forEachNode((function(t){if(!t.refId)return e.localComment=t,!0}))),this.localComment}},{key:"clearLocalComment",value:function(){this.localComment&&delete this.localComment}},{key:"_cacheNewestComments",value:function(e){this.newestComments||(this.newestComments=[]),this.newestComments.push(e)}},{key:"_updateRcId",value:function(){if(this.idCacheMgr.localCache){var e=this.document,t=this.idCacheMgr.localCache.comment_id,n=this.newestComments.find((function(n){return n.isOrphan()?(console.warn("The comment is an orphan node!"),!1):R(e,n).comment_id===t}));n&&this._dispatch("onReplaceRcId",n,this.idCacheMgr.localCache.id),this.newestComments=[]}else this.newestComments=[]}}]),e}(),x=function(e){function t(e,n,i,a,r){l()(this,t);var s=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return s.comments=i,s.id=a||v.getRandomId(),s.count=r||1,s}return r()(t,e),c()(t,[{key:"getComments",value:function(e){return this.comments.collectByPlaceHolder(this.end-this.count,this.count,e)}},{key:"getCommentByIndex",value:function(e){return this.comments.collectByPlaceHolder(this.end-this.count,this.count,N(window.APP.doc))[e]}},{key:"addCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.count+=e}}]),t}(p.ITRange);function R(e,t){if(void 0!==t.comment_id)return{comment_id:t.comment_id.length>0?t.comment_id:void 0,comment_type:t.comment_type,comment_userId:t.comment_userId};var n="",i="text",o="",a=e.bookmarks.getBookmarkByCommentBody(t.body);if(a){var r=a.data.getName(),s=m.decodeBkName(r);s&&(n=s.comment_id,i=s.type,o=s.userId)}return e.comments._setCommentId(t,n,i,o),{comment_id:n,comment_type:i,comment_userId:o}}function N(e){return function(t){var n=t._node,i=R(e,n);return{comment_id:i.comment_id,comment_type:i.comment_type,type:n.type,pos:n.pos,len:n.len,rc_id:n.rc_id,author:n.author,content:n.content,date:m.getTime(n.date),body:n.body,isDone:n.isDone,woUserId:n.woUserId,relatedUserIds:n.relatedUserIds}}}var A=function(){function e(t,n){l()(this,e),this.bubble=t,this.id=t.id,this.range={pos:t.pos,len:t.len},this.type="comments";var i=t.getComments(N(n));this.data=i.sort((function(e,t){return e.date-t.date}))}return c()(e,[{key:"setPageIndex",value:function(e){this.pageIndex=e}}]),e}(),D=function(){function e(){l()(this,e),this.caches=[]}return c()(e,[{key:"cacheId",value:function(e,t){this.caches.push({key:e,id:t})}},{key:"cacheCommentBubbleId",value:function(e,t){var n=e.comment_id,i=e.rc_id,o=e.refId;o?this.cacheId(o,t):this.cacheLocalId({comment_id:n,rc_id:i,refId:o,id:t}),n&&this.cacheId(n,t),i&&this.cacheId(i,t)}},{key:"getCachedCommentBubbleId",value:function(e){var t=e.comment_id,n=e.rc_id,i=e.refId;if(!i){if(!this.localCache)return v.getRandomId();var o=this.localCache;return this.clearLocalId(),o.id}return this.getId((function(e){return i&&e.key===i||t&&e.key===t||n&&e.key===n}))}},{key:"cacheCommentId",value:function(e){var t=e.comment_id,n=e.rc_id,i=e.refId;i?this.cacheId(i,n):this.cacheLocalId({comment_id:t,rc_id:n,refId:i,id:n}),t&&this.cacheId(t,n)}},{key:"getCachedCommentId",value:function(e){var t=e.comment_id,n=e.refId;if(!n){if(!this.localCache)return e.rc_id;var i=this.localCache;return this.clearLocalId(),i.id}return this.getId((function(e){return n&&e.key===n||t&&e.key===t}))||v.getRandomId()}},{key:"cacheLocalId",value:function(e){this.localCache=e}},{key:"clearLocalId",value:function(){this.localCache&&this.clearId(this.localCache.id)}},{key:"getId",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return this.caches.shift();var n=this.caches.find(e);return n?(this.clearId(n.id),n.id):t?v.getRandomId():null}},{key:"clear",value:function(){this.caches.splice(0)}},{key:"clearId",value:function(e){this.caches=this.caches.filter((function(t){return t.id!==e})),this.localCache&&this.localCache.id===e&&delete this.localCache}}]),e}(),M=function(){function e(t){l()(this,e),this.doc=t,this.comments=t.comments,this.bubbles=new p.ITToolkit(p.IT.outer,p.IT.Crossing),this.idMgr=new D,this.ids={},Object(_.default)(this),t.comments.attachObserver(this),t.getDataLogic("final").attachObserver(this),this.init(t)}return c()(e,[{key:"init",value:function(e){var t=this,n=e.getLimitedRange(0),i=e.comments.collectByPlaceHolder(n.pos,n.len,(function(e){return e._node}));i.sort((function(e,t){return e.end-t.end})),i.forEach((function(e){return t.onInsertComment(t,e,!0)}))}},{key:"clearAll",value:function(e){this.bubbles.reset(),e&&(this.idMgr.clear(),this.ids={})}},{key:"attachNode",value:function(e){this.bubbles.attachNode(e),e.id&&(this.ids[e.id]=e)}},{key:"detachNode",value:function(e){this.bubbles.detachNode(e),e.id&&delete this.ids[e.id]}},{key:"doInsertBubble",value:function(e,t){var n=e.begin,i=e.end,o=this.idMgr.getCachedCommentBubbleId(e),a=new x(n,i,this.comments,o);return this.attachNode(a),!t&&this._dispatch("onAddCommentBubble",a),a}},{key:"onInsertComment",value:function(e,t,n){this.newComment=t;var i=void 0,o=this.bubbles.findNodeEqualRange(t.begin,t.end-1);o&&(i=o=this.merge(o,null,n));var a=this.bubbles.mapInRange(t.end,t.end+1,p.IT.mapToNode,p.IT.strictIntersectTest).find((function(e){return e.begin===t.begin&&e.end-e.count===t.end}));a&&(o?i=this.merge(o,a,n):(a.addCount(),i=a)),o||a||(i=this.doInsertBubble(t,n)),this.newCmtBubble=i}},{key:"onRemoveComment",value:function(e,t){var n=this.getBubbleByPlaceHolder(t.end-1);if(n)if(window.APP.workspace&&window.APP.workspace.updateDisabled&&this.idMgr.cacheCommentBubbleId(t,n.id),n.end-n.count===t.end-1)n.addCount(-1),n.count<=0&&(this._dispatch("onRemoveCommentBubble",n),this.detachNode(n));else{var i=void 0;n.end>t.end&&(i=new x(n.begin,n.end,this.comments,void 0,n.end-t.end),this.attachNode(i));var o=t.end-1-(n.end-n.count),a=new x(n.begin,t.end-1,this.comments,n.id,o);this.detachNode(n),this.attachNode(a),i&&this._dispatch("onAddCommentBubble",i,a)}else console.log("Looking for bubble by comment fail.")}},{key:"onInsertText",value:function(e,t,n){this.splitBubble(t,n),this.bubbles.expand(t,n.length)}},{key:"onDeleteText",value:function(e,t,n){var i=this,o=n.length;this.collectBubbles(t,o).forEach((function(e){if(t+o>e.end-e.count&&t<e.end){var n=t<=e.end-e.count?Math.min(e.count,t+o-(e.end-e.count)):Math.min(t+o,e.end)-t;e.addCount(-n),0===e.count&&(i._dispatch("onRemoveCommentBubble",e),i.detachNode(e))}})),this.bubbles.remove(t,o),this.merge2Bubbles(t,n)}},{key:"collectBubbles",value:function(e,t){var n=this;return this.bubbles.mapInRange(e,e+(t||0),p.IT.mapToNode,p.IT.strictIntersectTest).filter((function(e){return!(e.begin>=e.end)||(console.warn("Invalid comment bubble!"),n.detachNode(e),!1)}))}},{key:"collectByPlaceHolder",value:function(e,t){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=function(e,t){var n=t._node;return p.IT.strictIntersectTest({begin:e.begin,end:e.end},{begin:n.end-n.count,end:n.end})},a=this.bubbles.mapInRange(e,e+t,p.IT.mapToNode,o);return i?a.map((function(e){return e?new A(e,n.doc):null})):a}},{key:"getBubbleByPlaceHolder",value:function(e){return this.collectBubbles(e,1).find((function(t){return e<t.end&&e>=t.end-t.count}))}},{key:"getBubbleByRange",value:function(e,t){var n=this.collectBubbles(e,t);if(n.length<=0)return null;var i=void 0;return t?i=n.find((function(n){return n.pos===e&&n.len>=t&&t>=n.len-n.count})):(n.length>1&&n.sort((function(e,t){return e.pos!==t.pos?t.pos-e.pos:e.len-t.len})),i=n[0]),i?new A(i,this.doc):null}},{key:"getBubblesByRange",value:function(e,t){var n=this,i=this.collectBubbles(e,t);return i.length<=0?null:(t||i.length>1&&i.sort((function(e,t){return e.pos!==t.pos?t.pos-e.pos:e.len-t.len})),i.map((function(e){return new A(e,n.doc)})))}},{key:"getBubbleById",value:function(e){return this.ids[e]}},{key:"merge2Bubbles",value:function(e){this.doc.getSubDocType(e)!==b.MainText||e<=0||(this.mergeByBegin(e),this.mergeByEnd(e))}},{key:"mergeByBegin",value:function(e){var t=this.getBubbleByPlaceHolder(e-1);if(t){var n=this.getBubbleByPlaceHolder(e);n&&t.begin===n.begin&&t!==n&&this.merge(t,n)}}},{key:"mergeByEnd",value:function(e){var t=this.collectBubbles(e,0).filter((function(t){return t.pos===e}));if(t&&!(t.length<2)){t.sort((function(e,t){return e.len-t.len}));for(var n=t[0],i=1;i<t.length;++i)console.assert(t[i].len-t[i].count>=n.len),n=t[i].len-t[i].count===n.len?this.merge(n,t[i]):t[i]}}},{key:"merge",value:function(e,t,n){var i=t?t.count:1;t&&this.detachNode(t);var o=e.begin,a=e.end+i,r=e.id,s=e.count+i,l=new x(o,a,this.comments,r,s);return this.detachNode(e),this.attachNode(l),t&&!n&&this._dispatch("onRemoveCommentBubble",t,l),l}},{key:"splitBubble",value:function(e){if(!(this.doc.getSubDocType(e)!==b.MainText||e<=0)){var t=this.getBubbleByPlaceHolder(e);if(t&&t.count>1&&e>t.end-t.count&&e<t.end){var n=new x(t.begin,e,this.comments,t.id,e-(t.end-t.count)),i=new x(t.begin,t.end,this.comments,void 0,t.end-e);this.detachNode(t),this.attachNode(n),this.attachNode(i),this._dispatch("onAddCommentBubble",i,n)}}}},{key:"_setBubbleId",value:function(e,t){delete this.ids[e.id],e.id=t,this.ids[t]=e}}]),e}();function L(e,t){var n=e.commentBubbles.getBubbleByPlaceHolder(t);return n?new A(n,e):null}function F(e,t,n){return e.commentBubbles.collectBubbles(t,n).map((function(t){return new A(t,e)}))}function B(e,t){var n=e.commentBubbles.getBubbleById(t);return n?new A(n,e):null}},4582:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var i=n(2503),o=.6;function a(e,t,n,a,r){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=window.APP.data.doc.useCoreMeasure?1/o-1:1-o,u=a,c=r;return s?e<0?t===i.top?c-=n.height*(1-o):t===i.middle?c-=n.height*(1-o)/2:t===i.bottom||(c-=n.measureDescent*(1-o)):e>0&&(t===i.top||(t===i.middle?c+=n.height*(1-o)/2:t===i.bottom?c+=n.height*(1-o):c+=n.measureAscent*l)):e<0?t===i.top?u+=n.height*(1-o):t===i.middle?u+=n.height*(1-o)/2:t===i.bottom||(u+=n.measureDescent*(1-o)):e>0&&(t===i.top||(t===i.middle?u-=n.height*(1-o)/2:t===i.bottom?u-=n.height*(1-o):u-=n.measureAscent*l)),{scriptPosX:c,scriptPosY:u}}},4583:function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return v}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(1915),d=n(626),p=n(411),f=function(){function e(){l()(this,e),this.context=new h.a}return c()(e,[{key:"composeLayoutPage",value:function(e){!e.isUpdate&&e.hasCompose||(this.context.enter(e),this.composeDecorativePage(e.decorativePage),this.composeLayers(e.layers),this.composeMainPage(e),this.composeEmbedShapes(e.embed_shape_map),this.context.exit(),e.hasCompose=!0)}},{key:"composeDecorativePage",value:function(e){e&&(this.composeLayers(e.layers),this.composeTextPage(e.header),this.composeTextPage(e.footer),this.composeEmbedShapes(e.embed_shape_map))}},{key:"composeLayers",value:function(e){var t=this;e&&(e.getTopShapeCards().forEach((function(e){t.composeShape(e)})),e.getBottomShapeCards().forEach((function(e){t.composeShape(e)})),e.getTextframeCards().forEach((function(e){t.composeShape(e)})))}},{key:"composeEmbedShapes",value:function(e){if(e)for(var t in e){var n=e[t];this.composeShape(n)}}},{key:"composeMainPage",value:function(e){var t=this;e.mainpages.forEach((function(e){t.composeTextPage(e),t.composeFootEndNotes(e.footnotes),t.composeFootEndNotes(e.endnotes)}))}},{key:"composeFootEndNotes",value:function(e){var t=this;e&&(this.context.enter(e),e.notes.forEach((function(e){t.composeTextPage(e.note_page)})),this.context.exit())}},{key:"composeShape",value:function(e){var t=this;if(this.context.enter(e),e.textbox_page&&this.composeTextPage(e.textbox_page),e.snippetPack&&this.composeTextPage(e.snippetPack),e.isGroup){var n=e.childShapes;n&&n.forEach((function(e){t.composeShape(e)}))}this.context.exit()}},{key:"composeTextPage",value:function(e){var t=this;e&&(this.context.enter(e),e.lines.forEach((function(e){t.context.enter(e),e.tablecells?e.tablecells.forEach((function(e){t.context.enter(e),e.is_diag_cell?e.diagCell.pages.forEach((function(e){return t.composeTextPage(e)})):t.composeTextPage(e.cell_page),t.context.exit()})):e.layoutType===p.DOCLayoutType.TextLine&&t.composeTextLine(e),t.context.exit()})),this.context.exit())}},{key:"composeTextLine",value:function(e){var t=this;if(e.sublines&&e.sublines.length)e.sublines.forEach((function(e){var n=d.a.add(t.context.position,e.position2parent,e.offset4child);e.composeProcess(!0,n)}));else{var n=d.a.add(this.context.position,e.position2parent,e.offset4child);e.composeProcess(!0,n)}}},{key:"composeCell",value:function(e){var t=this;this.context.enter(e),e.diagCell?e.diagCell.pages.forEach((function(e){t.composeTextPage(e)})):this.composeTextPage(e.cell_page),this.context.exit()}}]),e}();t.c=f;var g=function(e){function t(e){l()(this,t);var n=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.context.enter(e),n}return r()(t,e),c()(t,[{key:"composeMobilePage",value:function(e){var t=this;if(e.isUpdate||!e.hasCompose){this.context.enter(e),this.composeTextPage(e.page);var n=e.layers;n&&function e(n){n.shapeCards&&n.shapeCards.forEach((function(e){t.composeShape(e)})),n.embedShapes&&n.embedShapes.forEach((function(e){t.composeShape(e)})),n.childLayers&&n.childLayers.forEach((function(t){e(t)}))}(n),this.context.exit(),e.hasCompose=!0}}}]),t}(f),v=function(e){function t(e){l()(this,t);var n=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.context.enter(e),n}return r()(t,e),c()(t,[{key:"composeCommentPage",value:function(e){!e.isUpdate&&e.hasCompose||(this.context.enter(e),this.composeTextPage(e.page),this.context.exit(),e.hasCompose=!0)}}]),t}(f)},474:function(e,t,n){var i=n(897),o="object"==typeof self&&self&&self.Object===Object&&self,a=i||o||Function("return this")();e.exports=a},4806:function(e,t,n){"use strict";n.d(t,"b",(function(){return J}));var i=n(24),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(310),c=n(1417),h=n(4974),d=n(4109),p=n(410),f=n(8),g=n.n(f),v=n(22),m=n.n(v),_=n(23),y=n.n(_),b=n(4111),T=n(1736),C=n(4975),k=n(1590),w=n(1916),S=n(7210),P=n(5743),I=n(811),E=n(1403),O=n(336),x="初号;小初;一号;小一;二号;小二;三号;小三;四号;小四;五号;小五;六号;小六;七号;八号:42;36;26;24;22;18;16;15;14;12;10.5;9;7.5;6.5;5.5;5",R=function(){function e(t,n){r()(this,e),this.propBag=t,this.doc=n,this.props=Object.getOwnPropertyNames(t)}return l()(e,[{key:"uniqueList",value:function(){}},{key:"_hasProp",value:function(e){return void 0!==this.props.find((function(t){return t===e}))}},{key:"_getProp",value:function(e){return this.propBag.getProp(e)}},{key:"_getPropValue",value:function(e){return this.propBag.getPropVal(e)}},{key:"_hasProps",value:function(e){for(var t=0;t<e.length;++t)if(!this._hasProp(e[t]))return!1;return!0}},{key:"_removeProp",value:function(e){var t=this.props.indexOf(e);t>=0&&this.props.splice(t,1)}},{key:"_removeProps",value:function(e){var t=this;e.forEach((function(e){t._removeProp(e)}))}},{key:"titleAppend",value:function(e,t){e.val+=t+": "}},{key:"textAppend",value:function(e,t){e.val+=t}},{key:"boolAppend",value:function(e,t,n){t||this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpNot", "Not")),this.textAppend(e,n)}},{key:"colorAppend",value:function(e,t,n){this.titleAppend(e,n),this.descColor(e,t)}},{key:"replaceList",value:function(e,t){if("zh-CN"===window.langName){var n=e.split(":");if(2===n.length){var i=n[0].split(";"),o=n[1].split(";").findIndex((function(e){return e===t}));if(o>=0)return{replaced:!0,text:i[o]}}}return{replaced:!1,text:t}}},{key:"_fixed",value:function(e){return Math.round(100*e)/100}},{key:"tw2pt",value:function(e){var t=Object(O.Ti2Pt)(parseInt(e));return this._fixed(t)}},{key:"tw2mm",value:function(e){var t=Object(O.Ti2Mm)(parseInt(e));return this._fixed(t)}},{key:"hu2li",value:function(e){var t=e/100;return this._fixed(t)}},{key:"hu2ch",value:function(e){var t=e/100;return this._fixed(t)}},{key:"th2li",value:function(e){var t=e/2.4/100;return this._fixed(t)}},{key:"descColor",value:function(e,t){var n="object"===(void 0===t?"undefined":o()(t))?new E.a(t).color:t;"#000000"!=n?this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevColor", "Color")+"("+n+")"):this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevColorAuto", "Auto"))}},{key:"descBorderType",value:function(e,t){var n=S.a[t];this.textAppend(e,n)}},{key:"descBorder",value:function(e,t,n,i){this.textAppend(e,"("),t==w.l?this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevBopNoBorder", "No border")):(this.descBorderType(e,t),this.textAppend(e,", "),this.descColor(e,n),this.textAppend(e,", "),this.textAppend(e,this.tw2pt(i)+_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound")+" "+_i18n("applications.writer.core.shell.model.datalogic.RevBopLineWidth", "Width"))),this.textAppend(e,")")}},{key:"descShading",value:function(e,t,n,i){this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevShpPattern", "Pattern"))}},{key:"_removeUnmodifiedProp",value:function(e){if(this._hasProp(e)){var t=this.propBag.revision.format||this.propBag.revision.paraFormat;if(t){var n=t.historyBag;if(n){var i=n.getProp(e),a=i.val;if(!i.def){var r=this._getPropValue(e);"object"!==(void 0===a?"undefined":o()(a))||Object.prototype.toString.call(a)!==Object.prototype.toString.call(r)?a===r&&this._removeProp(e):Object(I.k)(a,r)&&this._removeProp(e)}}}}}},{key:"_removeUnmodifiedProps",value:function(e){var t=this;e.forEach((function(e){t._removeUnmodifiedProp(e)}))}}]),e}(),N=function(e){function t(e,n){return r()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return y()(t,e),l()(t,[{key:"getText",value:function(){for(var e=this,t=0,n=1,i=3,o=4,a=5,r=6,s=[],l=0;l<=r;++l)s[l]={val:""};this.appendStyle(s[t]),this.uniqueList(),this.adjustList(),this.props.forEach((function(t){var l=e._getProp(t);switch(t){case"bold":case"italic":case"font_name_ascii":case"font_name_asia_east":case"font_size_normal":e.appendFont(s[n],t,l);break;case"underline":case"underline_type":case"underline_color":e.appendUnderline(s[i],t,l);break;case"shading_texture":e.appendShading(s[o],t,l);break;case"border_type":e.appendBorder(s[a],t,l);break;case"fillEffect":break;case"strike":case"double_strike":case"script_pos":case"emphasis_type":case"highlight_color":case"font_color":case"caps":case"small_caps":case"vanish":case"outline":case"shadow":case"emboss":case"imprint":case"kerning":case"spacing":case"position":case"character_scale":case"snap_to_grid":case"language":case"east_asia_language":case"complex_language":case"aisanLayout":case"outlineEffect":case"glowEffect":case"shadowEffect":case"reflectionEffect":case"shape3DEffect":e.appendOthers(s[r],t,l)}}));var u="";return s.forEach((function(e){u.length>0&&e.val.length>0&&(u+="; "),u+=e.val})),u}},{key:"adjustList",value:function(){var e=this,t=[].concat(g()(this.props));this._removeUnmodifiedProps(t),(t=[].concat(g()(this.props))).forEach((function(t){switch(t){case"shading_fill_color":case"shading_back_color":e._removeProp("shading_texture");break;case"underline":e._removeProp("underline_type");break;case"caps":!0===e._getPropValue("caps")&&e._removeProp("small_caps");break;case"small_caps":!0===e._getPropValue("small_caps")&&e._removeProp("caps")}}))}},{key:"appendStyle",value:function(e){var t=this;if(this._removeUnmodifiedProp("basestyle"),this._hasProp("basestyle")){if(this.propBag.revision&&this.propBag.revision.format&&this.propBag.revision.format.historyBag){var n=["language","east_asia_language","complex_language"],i=this.propBag.revision.format.historyBag;Object.getOwnPropertyNames(i).filter((function(e){return i[e]!==i.def[e]&&!n.find((function(t){return t===e}))})).forEach((function(e){t.props.push(e)}))}e.val=this.propBag.basestyle.name}}},{key:"appendFont",value:function(e,t,n){0==e.val.length?this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpFont", "Font")):this.textAppend(e,", ");var i=n.val,o="";switch(t){case"bold":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpBold", "Bold"));break;case"italic":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpItalic", "Italic"));break;case"font_name_ascii":case"font_name_asia_east":this.textAppend(e,"font_name_ascii"===t?_i18n("applications.writer.core.shell.model.datalogic.RevChpDefault", "(Default)"):_i18n("applications.writer.core.shell.model.datalogic.RevChpAsian", "(Chinese)")),o=this.doc.fonttable.getName(i),this.textAppend(e,o);break;case"font_size_normal":var a=this.tw2pt(i).toString(),r=this.replaceList(x,a);o=r.replaced?r.text:a+" "+_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound"),this.textAppend(e,o)}}},{key:"appendUnderline",value:function(e,t,n){e.val.length>0&&this.textAppend(e,", ");var i=n.val,o=!1,a=void 0;switch(t){case"underline":i==C.None?this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpNoUnderline", "(None)")):i==C.Wordonly?this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpWordUnderline", "Underline words only")):(o=!0,a=this._getPropValue("underline_type"));break;case"underline_type":o=!0,a=i;break;case"underline_color":this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpUnderlineColor", "Underline color")),this.textAppend(e,": "),this.descColor(e,i)}if(o){var r="";switch(a){case k.wpsUnderlineNone:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpNoUnderline", "(None)");break;case k.wpsUnderlineSingle:case k.wpsUnderlineWords:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpUnderline", "Underline");break;case k.wpsUnderlineDouble:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDoubleUnderline", "Double underline");break;case k.wpsUnderlineDotted:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDottedUnderline", "Dotted underline");break;case k.wpsUnderlineThick:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpThickUnderline", "Thick underline");break;case k.wpsUnderlineDash:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDashUnderline", "Dashed underline");break;case k.wpsUnderlineDotDash:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDotDashUnderline", "Dot-dash underline");break;case k.wpsUnderlineDotDotDash:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDotDotDashUnderline", "Dot-dot-dash underline");break;case k.wpsUnderlineWavy:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpWavyUnderline", "Wave underline");break;case k.wpsUnderlineWavyHeavy:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpHeavyWavyUnderline", "Wave heavy underline");break;case k.wpsUnderlineDottedHeavy:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDottedHeavyUnderline", "Dotted heavy underline");break;case k.wpsUnderlineDashHeavy:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDashHeavyUnderline", "Dashed heavy underline");break;case k.wpsUnderlineDotDashHeavy:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDotDashHeavyUnderline", "Dot-dash heavy underline");break;case k.wpsUnderlineDotDotDashHeavy:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDotDotDashHeavyUnderline", "Dot-dot-dash heavy underline");break;case k.wpsUnderlineDashLong:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDashLongUnderline", "Dashed long underline");break;case k.wpsUnderlineDashLongHeavy:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpDashLongHeavyUnderline", "Dashed long heavy underline");break;case k.wpsUnderlineWavyDouble:r=_i18n("applications.writer.core.shell.model.datalogic.RevChpWavyDoubleUnderline", "Double wave underline")}r.length>0&&this.textAppend(e,r)}}},{key:"appendBorder",value:function(e,t,n){this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevBopBorder", "Border"));var i=n.val;this.descBorder(e,i,this._getPropValue("border_color"),this._getPropValue("border_size"))}},{key:"appendShading",value:function(e,t,n){var i=n.val;this.descShading(e,i,this._getPropValue("shading_fill_color"),this._getPropValue("shading_back_color"))}},{key:"appendOthers",value:function(e,t,n){e.val.length>0&&this.textAppend(e,", ");var i=n.val;switch(t){case"strike":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpStrike", "Strikeout"));break;case"double_strike":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpDoubleStrike", "Double strikethrough"));break;case"script_pos":i>0?this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpSuperscript", "Superscript")):i<0?this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpSubscript", "Subscript")):this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpNot", "Not")+_i18n("applications.writer.core.shell.model.datalogic.RevChpSuperscript", "Superscript")+" /"+_i18n("applications.writer.core.shell.model.datalogic.RevChpSubscript", "Subscript"));break;case"emphasis_type":var o="";switch(i){case P.a:o=_i18n("applications.writer.core.shell.model.datalogic.RevChpNoEmphasisMark", "No emphasis");break;case P.c:o=_i18n("applications.writer.core.shell.model.datalogic.RevChpDot", "Dot");break;case P.b:o=_i18n("applications.writer.core.shell.model.datalogic.RevChpPauseMark", "Enumeration comma");break;case P.d:o=_i18n("applications.writer.core.shell.model.datalogic.RevChpCircle", "Full stop");break;case P.e:o=_i18n("applications.writer.core.shell.model.datalogic.RevChpDot", "Dot")}this.textAppend(e,o);break;case"highlight_color":var a="#ffffffffff000000"==i;this.boolAppend(e,!a,_i18n("applications.writer.core.shell.model.datalogic.RevChpHighlight", "Highlight"));break;case"font_color":this.colorAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpFontColor", "Font color"));break;case"caps":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpCaps", "All caps"));break;case"small_caps":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpSmallCaps", "Small caps"));break;case"vanish":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpVanish", "Hidden"));break;case"outline":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpOutline", "Hollow"));break;case"shadow":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpShadow", "Shadow"));break;case"emboss":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpEmboss", "Emboss"));break;case"imprint":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpImprint", "Deboss"));break;case"kerning":var r=this.tw2pt(i).toString(),s=this.replaceList(x,r);s.replaced?r=s.text:r+=_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound"),this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpKernAt", "Kerning adjustment:")+r);break;case"spacing":if(0==i)this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpExpandedByCondensedBy", "Expanded by/Condensed by"));else{var l=i>0?_i18n("applications.writer.core.shell.model.datalogic.RevChpExpandedBy", "Expanded by:"):_i18n("applications.writer.core.shell.model.datalogic.RevChpCondensedBy", "Condensed by:");l+=this.tw2pt(Math.abs(i))+" "+_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound"),this.textAppend(e,l)}break;case"position":if(0==i)this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevCHpRaisedByLoweredBy", "Raised by/Lowered by"));else{var u=i>0?_i18n("applications.writer.core.shell.model.datalogic.RevCHpRaisedBy", "Raised by:"):_i18n("applications.writer.core.shell.model.datalogic.RevCHpLoweredBy", "Lowered by:");u+=this.tw2pt(Math.abs(i))+" "+_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound"),this.textAppend(e,u)}break;case"character_scale":var c=_i18n("applications.writer.core.shell.model.datalogic.RevChpCharacterScale", "Character scale")+":  "+i+"%";this.textAppend(e,c);break;case"snap_to_grid":this.textAppend(e,i?_i18n("applications.writer.core.shell.model.datalogic.RevChpSnapToGrid", "Snap to grid"):_i18n("applications.writer.core.shell.model.datalogic.RevChpDontSnapToGrid", "Don\'t snap to grid"));break;case"east_asia_language":this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpAsian", "(Chinese)"));break;case"complex_language":this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpComplex", "(Complex script)"));break;case"language":this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevChpLanguage", "Language"));break;case"asian_layout":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpAisanLayout", "Two lines in one"));break;case"outlineEffect":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpOutlineEffect", "Outline"));break;case"glowEffect":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpGlowEffect", "Glow"));break;case"shadowEffect":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpShadowEffect", "Shadow effect"));break;case"reflectionEffect":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpReflectionEffect", "Reflection"));break;case"shape3DEffect":this.boolAppend(e,i,_i18n("applications.writer.core.shell.model.datalogic.RevChpShape3DEffect", "Shape 3D"))}}}]),t}(R),A=function(e){function t(e,n){return r()(this,t),m()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return y()(t,e),l()(t,[{key:"getText",value:function(){for(var e=this,t=0,n=1,i=2,o=3,a=4,r=5,s=6,l=7,u=8,c=9,h=10,d=[],p=0;p<=h;++p)d[p]={val:""};this.appendStyle(d[t]),this.predelBorder(d[l]),this.uniqueList(),this.adjustIndentProps(),this.adjustList(),this.adjustPapSpace(),this.props.forEach((function(t){var p=e._getProp(t);switch(t){case"horizontal_align_mode":e.appendAlignment(d[n],t,p);break;case"left_indent_abs":case"left_indent_chars":case"first_line_indent_abs":case"first_line_indent_chars":case"right_indent_abs":case"right_indent_chars":e.appendIndent(d[i],t,p);break;case"para_margin_before_auto":case"para_margin_before":case"para_lineunit_margin_before":case"para_margin_after_auto":case"para_margin_after":case"para_lineunit_margin_after":e.appendMargin(d[o],t,p);break;case"line_spacing":e.appendSpacing(d[a],t,p);break;case"vertical_align_mode":e.appendFontAlignment(d[r],t,p);break;case"tab_stops":e.appendTabStops(d[s],t,p);break;case"border_top":case"border_left":case"border_bottom":case"border_right":case"border_between":e.appendBorder(d[l],t,p);break;case"shading_texture":e.appendShading(d[u],t,p);break;case"list_id":e.appendList(d[c],t,p);break;case"snap_to_grid":case"widow_control":case"auto_space_dn":case"auto_space_de":case"keep_next":case"keep_lines":case"page_break_before":case"word_wrap":case"overflow_punct":case"topline_punct":case"kinsoku":case"sup_line_num":case"sup_auto_hyphens":case"adjust_right_indent":case"bidi":case"out_line_level":e.appendOthers(d[h],t,p)}}));var f="";return d.forEach((function(e){f.length>0&&e.val.length>0&&(f+="; "),f+=e.val})),f}},{key:"appendAlignment",value:function(e,t,n){e.val.length>0&&this.textAppend(e,", ");var i="";switch(n.val){case T.Left:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapLeft", "Alignment left");break;case T.Center:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapCentered", "Center");break;case T.Right:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapRight", "Alignment right");break;case T.Adjustify:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapJustified", "Alignment both");break;case T.FullAdjustify:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapDistributed", "Alignment decentralized")}this.textAppend(e,i)}},{key:"appendMargin",value:function(e,t,n){0==e.val.length?this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevPapSpace", "Paragraph spacing:")):this.textAppend(e,", ");var i=n.val,o="";switch(t){case"para_margin_before_auto":o=_i18n("applications.writer.core.shell.model.datalogic.RevBeforePapSpaceAuto", "Before paragraph: Automatic");break;case"para_margin_before":o=_i18n("applications.writer.core.shell.model.datalogic.RevPapBefore", "Before paragraph (Unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound")).replace("{1}",this.tw2pt(i));break;case"para_lineunit_margin_before":o=_i18n("applications.writer.core.shell.model.datalogic.RevPapBefore", "Before paragraph (Unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitLine", "Rows")).replace("{1}",this.hu2li(i));break;case"para_margin_after_auto":o=_i18n("applications.writer.core.shell.model.datalogic.RevAfterPapSpaceAuto", "After paragraph: automatic");break;case"para_margin_after":o=_i18n("applications.writer.core.shell.model.datalogic.RevPapAfter", "After the paragraph (Unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound")).replace("{1}",this.tw2pt(i));break;case"para_lineunit_margin_after":o=_i18n("applications.writer.core.shell.model.datalogic.RevPapAfter", "After the paragraph (Unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitLine", "Rows")).replace("{1}",this.hu2li(i))}this.textAppend(e,o)}},{key:"appendIndent",value:function(e,t,n){0==e.val.length?(this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevPapIndent", "Indent")),this.textAppend(e,": ")):this.textAppend(e,", ");var i=n.val,o="";switch(t){case"left_indent_abs":var a=this._getPropValue("first_line_indent_abs");void 0!==a&&a<0&&(i+=a),o=_i18n("applications.writer.core.shell.model.datalogic.RevPapIndentLeft2", "Left (Unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitMM", "mm")).replace("{1}",this.tw2mm(i));break;case"left_indent_chars":o=_i18n("applications.writer.core.shell.model.datalogic.RevPapIndentLeft", "Left (Unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitCH", "Characters")).replace("{1}",this.hu2ch(i));break;case"first_line_indent_abs":o=(i>=0?_i18n("applications.writer.core.shell.model.datalogic.RevPapFirstLine", "First line indentation (unit: {0}): {1}"):_i18n("applications.writer.core.shell.model.datalogic.RevPapHanging", "Hanging Indent (Unit: {0}): {1}")).replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitMM", "mm")).replace("{1}",this.tw2mm(Math.abs(i)));break;case"first_line_indent_chars":o=(i>=0?_i18n("applications.writer.core.shell.model.datalogic.RevPapFirstLine", "First line indentation (unit: {0}): {1}"):_i18n("applications.writer.core.shell.model.datalogic.RevPapHanging", "Hanging Indent (Unit: {0}): {1}")).replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitCH", "Characters")).replace("{1}",this.hu2ch(Math.abs(i)));break;case"right_indent_abs":o=_i18n("applications.writer.core.shell.model.datalogic.RevPapIndentRight2", "Right side (unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitMM", "mm")).replace("{1}",this.tw2mm(i));break;case"right_indent_chars":o=_i18n("applications.writer.core.shell.model.datalogic.RevPapIndentRight", "Right (Unit: {0}): {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitCH", "Characters")).replace("{1}",this.hu2ch(i))}this.textAppend(e,o)}},{key:"appendSpacing",value:function(e,t,n){e.val.length>0&&this.textAppend(e,", "),this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevPapLineSpacing", "Line spacing"));var i="",o=n.val||{rule:"auto",value:240};if("auto"!=o.rule)i=("exact"==o.rule?_i18n("applications.writer.core.shell.model.datalogic.RevPapExactly", "Fixed value (Unit: {0}) {1}"):_i18n("applications.writer.core.shell.model.datalogic.RevPapAtLeast", "Minimum value (unit: {0}) {1}")).replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitPT", "Pound")).replace("{1}",this.tw2pt(o.value));else switch(o.value){case 240:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapSingle", "Single");break;case 360:i=_i18n("applications.writer.core.shell.model.datalogic.RevPap15Lines", "1.5 Spacing");break;case 480:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapDouble", "Double Spacing");break;default:i=_i18n("applications.writer.core.shell.model.datalogic.RevPapMultiple", "Multiple line spacing (unit: {0}) {1}").replace("{0}",_i18n("applications.writer.core.shell.model.datalogic.RevUnitLi", "Lines")).replace("{1}",this.th2li(o.value))}this.textAppend(e,i)}},{key:"appendFontAlignment",value:function(e,t,n){e.val.length>0&&this.textAppend(e,", "),this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevPapFontAlignment", "Text alignment"));var i="";switch(n.val){case"middle":i=_i18n("applications.writer.core.shell.model.datalogic.RevPapCenter", "Center");break;case"top":i=_i18n("applications.writer.core.shell.model.datalogic.RevPapTop", "Top alignment");break;case"bottom":i=_i18n("applications.writer.core.shell.model.datalogic.RevPapBottom", "Bottom alignment");break;case"alphabetic":i=_i18n("applications.writer.core.shell.model.datalogic.RevPapBaseLine", "Baseline")}this.textAppend(e,i)}},{key:"appendTabStops",value:function(e,t,n){}},{key:"appendBorder",value:function(e,t,n){var i=n.val;if(i){0==e.val.length?this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevBopBorder", "Border")):this.textAppend(e,", ");var o="";switch(t){case"border_top":o=_i18n("applications.writer.core.shell.model.datalogic.RevBopTop", "Top");break;case"border_left":o=_i18n("applications.writer.core.shell.model.datalogic.RevBopLeft", "Left");break;case"border_bottom":o=_i18n("applications.writer.core.shell.model.datalogic.RevBopBottom", "Bottom");break;case"border_right":o=_i18n("applications.writer.core.shell.model.datalogic.RevBopRight", "Right");break;case"border_between":o=_i18n("applications.writer.core.shell.model.datalogic.RevBopBetween", "Between")}this.titleAppend(e,o),this.descBorder(e,i.style,i.color,i.lineWidth)}}},{key:"appendOthers",value:function(e,t,n){e.val.length>0&&this.textAppend(e,", ");var i=n.val,o="";switch(t){case"snap_to_grid":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapSnapToGrid", "Snap to grid"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontSnapToGrid", "Dont snap to grid");break;case"widow_control":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapWindowControl", "No orphan control"):_i18n("applications.writer.core.shell.model.datalogic.RevPapNoWindowControl", "Orphan control");break;case"auto_space_dn":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapAutoSpaceDn", "Adjust space between Asian text and numbers"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontAutoSpaceDn", "Don\'t adjust space between Asian text and numbers");break;case"auto_space_de":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapAutoSpaceDE", "Adjust space between Latin and Asian text"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontAutoSpaceDE", "Don\'t adjust space between Latin and Asian text");break;case"keep_next":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapKeepNext", "Keep on same page as next paragraph"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontKeepNext", "Don\'t keep on same page as next paragraph");break;case"keep_lines":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapKeepLines", "Keep lines on same page"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontKeepLines", "Don\'t keep lines on same page");break;case"page_break_before":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapPageBreakBefore", "Page break before"):_i18n("applications.writer.core.shell.model.datalogic.RevPapPageDontBreakBefore", "No page break before");break;case"word_wrap":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapWordWrap", "Allow Latin text to wrap in the middle of a word"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontWordWrap", "Don\'t allow Latin text to wrap in the middle of a word");break;case"overflow_punct":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapOverflowPunct", "Allow hanging punctuation"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontOverflowPunct", "Don\'t allow hanging punctuation");break;case"topline_punct":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapTopLinePunct", "Compress punctuation at the start of a line"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontTopLinePunct", "Don\'t compress punctuation at the start of a line");break;case"kinsoku":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapKinsoku", "Use Asian rules for controlling first and last characters"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontKinsoku", "Don\'t use Asian rules for controlling first and last characters");break;case"sup_line_num":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapSupLineNum", "Suppress line numbers"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontSupLineNum", "Don\'t suppress line numbers");break;case"sup_auto_hyphens":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapsupAutoHyphens", "Hyphenate"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontsupAutoHyphens", "Don\'t hyphenate");break;case"adjust_right_indent":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapadjustRightIndent", "Automatically adjust right indent when document grid is defined"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontadjustRightIndent", "Don\'t adjust right indent when document grid is defined");break;case"bidi":o=i?_i18n("applications.writer.core.shell.model.datalogic.RevPapBidi", "Right to left"):_i18n("applications.writer.core.shell.model.datalogic.RevPapDontBidi", "Left to right");break;case"out_line_level":o=i>=0&&i<=8?_i18n("applications.writer.core.shell.model.datalogic.RevPapLevel", "Level {0}").replace("{0}",i+1):_i18n("applications.writer.core.shell.model.datalogic.RevPapNone", "Body text")}this.textAppend(e,o)}},{key:"appendShading",value:function(e,t,n){var i=n.val;this.descShading(e,i,this._getPropValue("shading_fill_color"),this._getPropValue("shading_back_color"))}},{key:"appendList",value:function(e,t,n){var i=this.doc.autoNumMgr,o=n.val,a=o&&i.findAutoNum(o),r=void 0;if(a){if(o!=r)this._getPropValue("list_level")>=a.levels.length||this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevPapModifyPap", "Modified paragraph"))}else{var s=this._getPropValue("revision");s&&s.paraFormat&&s.paraFormat.historyBag&&(r=s.paraFormat.historyBag.list_id)&&this.textAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevPapNoBulOrNum", "No bullets or numbering"))}}},{key:"appendStyle",value:function(e){var t=this;if(this._removeUnmodifiedProp("basestyle"),this._hasProp("basestyle")){if(this.propBag.revision&&this.propBag.revision.paraFormat&&this.propBag.revision.paraFormat.historyBag){var n=["language","east_asia_language","complex_language"],i=this.propBag.revision.paraFormat.historyBag;Object.getOwnPropertyNames(i).filter((function(e){return i[e]!==i.def[e]&&!n.find((function(t){return t===e}))})).forEach((function(e){t.props.push(e)}))}var o=this.propBag.basestyle.id;e.val+=o>0&&o<=9?_i18n("applications.writer.core.shell.model.datalogic.RevTitle", "Title")+o:0===o?_i18n("applications.writer.core.shell.model.datalogic.RevMainText", "Body"):this.propBag.basestyle.name}}},{key:"predelBorder",value:function(e){var t=this.propBag,n=function(e,n){var i=t.type;if(void 0!==i&&i&b.b)return 0==n;switch(e){case"border_top":case"border_bottom":return 20==n;case"border_left":case"border_right":return 80===n;default:return!1}},i=["border_top","border_bottom","border_left","border_bottom"];if(this._hasProps(i)){var o=this._getPropValue(i[0]);if(o&&n(i[0],o.margin)){for(var a=1;a<4;++a){var r=this._getPropValue(i[a]);if(!r&&o.style!=r.style&&o.color!=r.color&&o.lineWidth!=r.lineWidth&&!n(i[a],r.margin))return}this._removeProps(i),this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevBopBorder", "Border")),this.titleAppend(e,_i18n("applications.writer.core.shell.model.datalogic.RevBopBox", "Box")),this.descBorder(e,o.style,o.color,o.lineWidth)}}}},{key:"adjustList",value:function(){var e=this,t=[].concat(g()(this.props));this._removeUnmodifiedProps(t),(t=[].concat(g()(this.props))).forEach((function(n){switch(n){case"shading_fill_color":case"shading_back_color":e._removeProp("shading_texture");break;case"left_indent_abs":0!==t.indexOf("first_line_indent_chars")&&e._getPropValue("first_line_indent_chars")<0&&e._removeProp("left_indent_abs"),0===e._getPropValue("left_indent_chars")&&e._removeProp("left_indent_chars");break;case"left_indent_chars":0!==e._getPropValue("left_indent_chars")&&e._removeProp("left_indent_abs");break;case"first_line_indent_chars":0===e._getPropValue("first_line_indent_chars")&&0!==e._getPropValue("first_line_indent_abs")?e._removeProp("first_line_indent_chars"):e._removeProp("first_line_indent_abs");break;case"right_indent_abs":0===e._getPropValue("right_indent_chars")&&0!==e._getPropValue("right_indent_abs")&&e._removeProp("right_indent_chars"),0===e._getPropValue("right_indent_chars")&&e._removeProp("right_indent_chars");break;case"right_indent_chars":0!==e._getPropValue("right_indent_chars")&&e._removeProp("right_indent_abs");break;case"para_margin_after_auto":e._getPropValue("para_margin_after_auto")?(e._removeProp("para_margin_after"),e._removeProp("para_lineunit_margin_after")):e._removeProp("para_margin_after_auto");break;case"para_margin_before_auto":e._getPropValue("para_margin_before_auto")?(e._removeProp("para_margin_before"),e._removeProp("para_lineunit_margin_before")):e._removeProp("para_margin_before_auto");break;case"para_lineunit_margin_before":e._getPropValue("para_lineunit_margin_before")?e._removeProp("para_margin_before"):e._removeProp("para_lineunit_margin_before");break;case"para_lineunit_margin_after":e._getPropValue("para_lineunit_margin_after")?e._removeProp("para_margin_after"):e._removeProp("para_lineunit_margin_after")}}))}},{key:"adjustPapSpace",value:function(){for(var e=["para_lineunit_margin_after","para_margin_before","para_margin_before_auto","para_lineunit_margin_after","para_margin_after","para_margin_after_auto"],t=null,n=0;n<e.length;++n){if(this.props.indexOf(e[n])>=0){if(!t){t=e[n];continue}this._removeProp(e[n]);var i=this.props.indexOf(t);this.props.splice(i,0,e[n]),t=e[n]}}}},{key:"adjustIndentProps",value:function(){var e=this,t=this.propBag.revision.paraFormat&&this.propBag.revision.paraFormat.historyBag;t&&["left_indent_abs","left_indent_chars","first_line_indent_abs","first_line_indent_chars","right_indent_abs","right_indent_chars"].forEach((function(n){var i=e.propBag.getProp(n),a=i.val;if(!i.def){var r=t.getPropVal(n);(a===r||"object"===(void 0===a?"undefined":o()(a))&&Object.prototype.toString.call(a)===Object.prototype.toString.call(r)&&Object(I.k)(a,r))&&e._removeProp(n)}}))}}]),t}(R),D=n(2294),M=n(1103),L=n(309),F=n(324),B=n(1643),H=n(966),G=n(760),W=n(3332),j=function(){function e(t,n,i,o,a){r()(this,e),this.mixin_ITRange_init(t,n),this.revisions=a,this.revisionType=i,this.prop=o,this.init(i)}return l()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:u.ITRange,methodName:"init"}]}}]),l()(e,[{key:"init",value:function(e){var t=this.revisions.doc;switch(e){case h.c:case h.a:this.content=this.getText();break;case h.b:this.content=new N(this.prop,t).getText();break;case h.e:this.content=new A(this.prop,t).getText();break;case h.f:this.content=_i18n("applications.writer.core.shell.model.datalogic.RevisionFormattedTable", "Formatted Table");break;case h.d:this.content=_i18n("applications.writer.core.shell.model.datalogic.RevisonBulletsAndNumbering", "Bullets and Numbering");break;default:this.content="Unknown Revision"}this.rc_id=this.revisions.idManager.getId(this)}},{key:"accept",value:function(){this._revisionOp(!0)}},{key:"reject",value:function(){this._revisionOp(!1)}},{key:"_revisionOp",value:function(e){var t=this.revisions.getRevision(this.pos);if(!t||t.rc_id!=this.rc_id){t=this}var n=this._filterPlaceHolder(t.content);n&&n.length>100&&(n=n.slice(0,100)+"...");var i={pos:t.pos,len:t.len,revisionType:t.revisionType,accept:e,string:n};window.APP.editor.cmdExecutor.sendCommandBlock({name:"revisionOp",param:i})}},{key:"compare",value:function(e){var t=this.revisions.getCompatibleFunc(this.revisionType);return!(!t||!t(this.prop,e.prop))&&(this.begin==e.begin&&this.end==e.end)}},{key:"compare2",value:function(e){return(this.begin==e.begin||this.end==e.end)&&this.isCompactible(e)}},{key:"txIdentifyRevisionEx",value:function(){var e=this.prop.revision;if(e)switch(this.revisionType){case h.c:return e.insert;case h.a:return e.delete;case h.b:return e.format;case h.e:return e.paraFormat;default:return}}},{key:"isCompactible",value:function(e){if(this.revisionType!=e.revisionType)return!1;var t=this.txIdentifyRevisionEx(),n=e.txIdentifyRevisionEx();return null==t&&null==n||!(null==t&&null!=n||null==n&&null!=t)&&!!Object(d.g)(t,n)}},{key:"getText",value:function(){var e=this,t=this.revisions.doc,n="";(function(e,t,n){var i=[],o={pos:t,len:n};i.push({class:void 0,range:o});return e.collectRanges(t,n).forEach((function(e){switch(e.classType){case M.j:case M.n:case M.k:case M.h:!function(e,t,n){for(var i,o,a=0,r=0;r<n.length;++r)for(var s=n[r],l=a;l<e.length;++l){var u=e[l],c=u.range;if(o=s,(i=c).pos<=o.pos&&i.pos+i.len>=o.pos+o.len){if(s.pos>c.pos){var h={range:{pos:c.pos,len:s.pos-c.pos}};e.splice(l,0,h),++l}if(s.pos+s.len==c.pos+c.len)u.classType=t,u.range=s;else if(s.pos+s.len<c.pos+c.len){var d={range:s};d.classType=t,e.splice(l,0,d);var p=c.pos+c.len;c.pos=s.pos+s.len,c.len=p-c.pos,++l}a=l;break}}}(i,e.classType,e.ranges)}})),i})(t,this.begin,this.end-this.begin).forEach((function(i){switch(i.classType){case M.n:n+=_i18n("applications.writer.core.shell.model.datalogic.RevTextPicture", "[Image]");break;case M.j:var o=t.fields.getInnerField(i.range.pos);o&&(o.isTranslated?n+=o.getTranslateResult():n+=e._getFieldResult(t,o));break;case M.k:var a=i.range.pos,r=t.footnotes.getNote(a);r&&(n+=Object(W.f)(r,!0,null,t));break;case M.h:var s=i.range.pos,l=t.endnotes.getNote(s);l&&(n+=Object(W.f)(l,!1,null,t));break;case M.l:case M.i:break;default:n+=t.getDataLogic("final").getText(i.range.pos,i.range.len)}}));var i=t.getSubDocType(this.begin);if((i===L.Footnote||i===L.Endnote)&&n.includes(W.e)){var o=i===L.Footnote?t.footnoteBodys.getRefByPos(this.begin):t.endnoteBodys.getRefByPos(this.begin);if(o){var a=Object(W.f)(o,i===L.Footnote,null,t);n=n.replace(W.e,a)}}return this._filterPlaceHolder(n)}},{key:"_getFieldResult",value:function(e,t){var n="",i=!1;if("PAGE"==t.type){var o=e.getSubDocType(t.begin);o!==L.HeaderFooter&&o!==L.TextboxInHF||(i=!0,n="!#PAGENUM#!",this.pageNumField=window.APP.data.fieldManager.getField(t.begin))}if(!i){var a=t.sep+1,r=t.end;r>a&&(n=e.getDataLogic("final").getText(a,r-a-1))}return n}},{key:"parsePageNumField",value:function(e){return this.pageNumField?(window.APP.data.fieldManager.parseField(this.pageNumField,e),this.pageNumField.getResult()):""}},{key:"_filterPlaceHolder",value:function(e){for(var t="",n=0;n<e.length;++n){switch(e.charCodeAt(n)){case F.m:t+=_i18n("applications.writer.core.shell.model.datalogic.RevSectionBreak", "[Section break]");break;case F.k:t+=_i18n("applications.writer.core.shell.model.datalogic.RevPageBreak", "[Page break]");break;case F.i:t+=_i18n("applications.writer.core.shell.model.datalogic.RevColumnBreak", "[Column break]");break;case F.g:case F.f:var i=this.revisions.doc,o=i.anchors.rangeClass.findNodeContainPos(this.begin+n)||i.inlineAnchors.rangeClass.findNodeContainPos(this.begin+n);o&&(o.refShape.private.flags.isPicture?t+=_i18n("applications.writer.core.shell.model.datalogic.RevTextPicture", "[Image]"):t+=_i18n("applications.writer.core.shell.model.datalogic.RevTextShape", "[Shape]"));break;case F.j:t+=_i18n("applications.writer.core.shell.model.datalogic.RevLineBreak", "[Line break]");break;case F.d:case F.e:break;default:t+=e[n]}}return t=Object(G.filterText)(t,void 0,void 0)}},{key:"user",get:function(){return this.prop.revision[this.type].user}},{key:"author",get:function(){return this.user}},{key:"userID",get:function(){return this.prop.revision[this.type].userID}},{key:"date",get:function(){return this.prop.revision[this.type].date}},{key:"type",get:function(){return Object(d.h)(this.revisionType)}},{key:"leader",get:function(){switch(this.revisionType){case h.c:return _i18n("applications.writer.core.shell.model.datalogic.RevisionInserted", "Insert");case h.a:return _i18n("applications.writer.core.shell.model.datalogic.RevisionDeleted", "Delete");case h.b:case h.e:default:return _i18n("applications.writer.core.shell.model.datalogic.RevisionFormatted", "Format")}}},{key:"wholeContent",get:function(){return this.leader+": "+this.content}},{key:"visible",get:function(){return this.content.length>0}}]),e}();p.a.mix(j,u.ITRange);var U={};function V(e,t){var n=e.begin,i=t.begin;return n==i?e.date-t._node.date:n-i}V.extractFast=function(e){U.begin=e.begin,U.date=e.date};var Y=function(){function e(t){r()(this,e),this.caches=[]}return l()(e,[{key:"getId",value:function(e){for(var t=0;t<this.caches.length;++t){var n=this.caches[t];if(n.compare2(e)&&!n._rcIdReused)return n._rcIdReused=!0,this.caches[t].rc_id}return D.getRandomId()}},{key:"clear",value:function(){this.updateDisabled||this.caches.splice(0)}},{key:"cacheRevision",value:function(e){this.caches.push(e)}},{key:"updateDisabled",get:function(){return window.APP.workspace&&window.APP.workspace.updateDisabled}}]),e}();function z(e,t,n){var i=["strike","double_strike"];for(var a in e)if(!n[a])if(void 0!==e[a]&&null!==e[a]){var r="object"===o()(e[a]);(!r&&e[a]===t[a]||r&&Object(I.k)(e[a],t[a])||-1!==i.indexOf(a)&&e[a]===e.def[a]&&void 0===t[a])&&delete e[a]}else delete e[a]}var K={special:!0},Z={nest_level:!0,para_type:!0};var X=function(){function e(t,n){var i=this;r()(this,e),this.dataLogic=t,this.doc=n,this.rangeSet=new u.ITToolkit(u.IT.upper,u.IT.Crossing,!0),this.rangeSet.sortby=V,this.todoList=new c.default,this.idManager=new Y(this),n.concernRanges.forEach((function(e){var t=e.pos,n=e.pos+e.len;i.todoList.todo({begin:t,end:n})})),t.attachObserver(this)}return l()(e,[{key:"getIdManager",value:function(){return this.idMgr}},{key:"attach",value:function(e){this.rangeSet.attachNode(e)}},{key:"detach",value:function(e){this.rangeSet.detachNode(e)}},{key:"isSameInsRevision",value:function(e,t){return t.revision&&t.revision.insert&&Object(d.g)(t.revision.insert,e.revision.insert)}},{key:"isSameDelRevision",value:function(e,t){return t.revision&&t.revision.delete&&Object(d.g)(t.revision.delete,e.revision.delete)}},{key:"isSameChpxRevision",value:function(e,t){return t.revision&&t.revision.format&&Object(d.g)(t.revision.format,e.revision.format)&&Object(d.e)(e,t)}},{key:"isSamePapxRevision",value:function(e,t){return t.revision&&t.revision.paraFormat&&t.revision.paraFormat.user===e.revision.paraFormat.user&&Object(d.g)(t.revision.paraFormat,e.revision.paraFormat)&&Object(d.f)(e,t)}},{key:"getCompatibleFunc",value:function(e){switch(e){case h.c:return this.isSameInsRevision;case h.a:return this.isSameDelRevision;case h.b:return this.isSameChpxRevision;case h.e:default:return this.isSamePapxRevision}}},{key:"expandRange",value:function(e,t){var n=this.getCompatibleFunc(t);if(!e.good&&!n)return{begin:e.pos,end:e.pos+e.len};var i=e.pos,o=e.pos+e.len,a=this.doc.getLimitedRange(e.pos);if(!a)return{begin:e.pos,end:e.pos+e.len};if(i>a.pos){var r=this._getPropHint(e.pos,t);for(this._moveHintToPrev(r,t);r.good&&r.pos>=a.pos&&n(e.prop,r.prop);)i=r.pos,this._moveHintToPrev(r,t)}var s=a.pos+a.len;if(o<s){var l=this._getPropHint(e.pos,t);for(this._moveHintToNext(l,t);l.good&&l.pos+l.len<=s&&n(e.prop,l.prop);)o=l.pos+l.len,this._moveHintToNext(l,t)}return{begin:i,end:o}}},{key:"update",value:function(){var e=this;this.todoList.doInTurn((function(t){e.idManager.clear(),e.rangeSet.mapInRange(t.begin,t.end,u.IT.mapToNode,u.IT.strictIntersectTest).forEach((function(t){e.idManager.cacheRevision(t),e.detach(t)})),function(e,t){for(var n=e.getDataLogic("prime"),i=n.getChpx(t.begin);i.good&&i.pos<t.end;){var o=n.getChp(i.pos);if(!o.basestyle){var a=o.revision;a&&a.format&&a.format.historyBag&&(delete a.format.historyBag.revision,z(o,a.format.historyBag,K))}n.moveChpxToNext(i)}for(var r=n.getPapx(t.begin);r.good&&r.pos<t.end;){var s=n.getPap(r.pos);if(!s.basestyle){var l=s.revision;l&&l.paraFormat&&l.paraFormat.historyBag&&(delete l.paraFormat.historyBag.revision,z(s,l.paraFormat.historyBag,Z))}n.movePapxToNext(r)}}(e.doc,t);for(var n=0;n<h.g;++n)e.updateRevision(t,n);return e.idManager.clear(),{doneRange:{begin:t.begin,end:t.end},stop:!1}}))}},{key:"_getPropHint",value:function(e,t){switch(t){case h.c:case h.a:case h.b:return this.dataLogic.getChpx(e);case h.e:default:return this.dataLogic.getPapx(e)}}},{key:"_moveHintToNext",value:function(e,t){switch(t){case h.c:case h.a:case h.b:return this.dataLogic.moveChpxToNext(e);case h.e:default:return this.dataLogic.movePapxToNext(e)}}},{key:"_moveHintToPrev",value:function(e,t){switch(t){case h.c:case h.a:case h.b:return this.dataLogic.moveChpxToPrev(e);case h.e:default:return this.dataLogic.movePapxToPrev(e)}}},{key:"updateRevision",value:function(e,t){for(var n=e.begin,i=this._getPropHint(n,t),o=function(e){return{end:e.end,revisionType:e._node.revisionType}};n<e.end&&i.good;)if(i.prop.revision&&i.prop.revision[Object(d.h)(t)]){var a=this.rangeSet.mapInRange(n,n+1,o,u.IT.strictIntersectTest).find((function(e){return e.revisionType===t}));if(a)n=a.end,i=this._getPropHint(n,t);else{var r=this.expandRange(i,t),s=r.begin,l=r.end,c=new j(s,l,t,i.prop,this);c.visible&&this.checkEnbaleVisible(c)&&this.attach(c),n=l,i=this._getPropHint(n,t)}}else n=i.pos+i.len,this._moveHintToNext(i,t)}},{key:"collectRevisions",value:function(e,t){return this.update(),this.rangeSet.mapInRange(e,e+t,u.IT.mapToNode,u.IT.strictIntersectTest)}},{key:"getRevision",value:function(e){var t=this.collectRevisions(e,1);return t.length>0?t[0]:null}},{key:"getRevisionWithType",value:function(e,t){var n=this.collectRevisions(e,1);return n.length>0?n.find((function(e){return e.revisionType===t})):null}},{key:"getRevisionById",value:function(e){var t=this,n=void 0;return this.doc.concernRanges.some((function(i){var o=i.pos,a=i.len,r=t.rangeSet.mapInRange(o,o+a,u.IT.mapToNode,u.IT.strictIntersectTest);return n=r.find((function(t){return t.rc_id===e}))})),n}},{key:"getLastChpxRevision",value:function(e){var t=e.pos,n=e.exactRange,i=this.collectRevisions(t,1);if(0==i.length)return null;if(n&&n.len&&void 0!==n.pos){var o=i.find((function(e){return n.pos===e.pos&&n.len===e.len}));if(o&&[h.c,h.a,h.b].find((function(e){return e===o.revisionType})))return o}i.reverse();var a=void 0;return i.forEach((function(e){e.revisionType!=h.c&&e.revisionType!=h.a&&e.revisionType!=h.b||a||(a=e)})),a}},{key:"onBeforeInsertText",value:function(e,t,n,i){}},{key:"onInsertText",value:function(e,t,n,i){this.rangeSet.expand(t,n.length);var o=this.adjustInvalidRange({begin:t,end:t});o.end+=n.length,this.todoList.expand(t,n.length),this.todoList.todo(o)}},{key:"onBeforeDeleteText",value:function(e,t,n){}},{key:"onDeleteText",value:function(e,t,n){var i=this.adjustInvalidRange({begin:t,end:t});i.end+=n.length,this.todoList.todo(i),this.todoList.remove(t,n.length),this.rangeSet.remove(t,n.length)}},{key:"onChpxChanged",value:function(e,t){this.onSetProp(e,t)}},{key:"onPapxChanged",value:function(e,t){this.onSetProp(e,t)}},{key:"onSetProp",value:function(e,t){var n=this.adjustInvalidRange({begin:t.pos,end:t.pos+t.len});this.todoList.todo(n)}},{key:"adjustInvalidRange",value:function(e){var t=e.begin,n=e.end,i=this.doc.getLimitedRange(t);return i?{begin:Math.max(t-1,i.pos),end:Math.min(n+1,i.pos+i.len)}:{begin:t,end:n}}},{key:"checkEnbaleVisible",value:function(e){if(e.revisionType===h.b&&this.rangeSet.mapInRange(e.pos,e.pos+1,u.IT.mapToNode,u.IT.strictIntersectTest).find((function(t){return(t.revisionType===h.c||t.revisionType===h.a)&&t.begin<=e.begin&&e.end<=t.end})))return!1;return!0}},{key:"empty",value:function(){var e=void 0;return this.rangeSet.forEachNode((function(t){return e=t,!0})),!e}}]),e}(),q=(t.a=X,function(){function e(t){r()(this,e),this.data=t,this.range={pos:t.pos,len:t.len}}return l()(e,[{key:"setPageIndex",value:function(e,t){this.idx=e,this.pageIndex=e,this.docType=t}},{key:"accept",value:function(){this.data.accept()}},{key:"reject",value:function(){this.data.reject()}},{key:"rc_id",get:function(){return void 0!==this.pageIndex&&this.docType!=H.DOC_TYPE.main?this.data.rc_id+"_"+this.pageIndex:this.data.rc_id}},{key:"user",get:function(){return this.data.user}},{key:"author",get:function(){return this.data.author}},{key:"userID",get:function(){return this.data.userID}},{key:"date",get:function(){return B.getTime(this.data.date)}},{key:"wholeContent",get:function(){return this.isPageNumRevision?this.leader+": "+this.pageNumContent:this.data.wholeContent}},{key:"visible",get:function(){return this.data.visible}},{key:"pos",get:function(){return this.data.pos}},{key:"len",get:function(){return this.data.len}},{key:"type",get:function(){return this.data.type}},{key:"revisionType",get:function(){return this.data.revisionType}},{key:"begin",get:function(){return this.data.begin}},{key:"end",get:function(){return this.data.end}},{key:"leader",get:function(){return this.data.leader}},{key:"content",get:function(){return this.data.content}}]),e}());function J(e,t,n,i){var o=i,a=e.doc.getSubDocType(t),r=[L.TextboxInHF,L.HeaderFooter].includes(a);r&&void 0===o&&(o=e.selection.selContext.headerfooterLayoutIndex);var s=e.doc.revisions.collectRevisions(t,n).map((function(t){var n=new q(t);if(-1!=t.content.indexOf("!#PAGENUM#!")){var i=e.typoinfo.layout_pages[o].pageNum;n.isPageNumRevision=!0,n.pageNumContent=t.parsePageNumField(i)}return n}));return s.length>0&&r&&s.forEach((function(e){e.setPageIndex(o)})),s}},4809:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(410),l=n(310),u=n(6112),c=n(411),h=n(1251),d=n(1032),p=n(309),f=n(626),g=n(1804),v=n(400),m=n(2292),_=n(336),y=n(7160),b=n(7161),T=n(3319),C=function(){function e(t){var n=t.outer,i=t.viewPage,a=t.range,r=t.coorSystem,s=t.anchor,l=t.raw_card;o()(this,e),this.init({outer:n,viewPage:i,range:a,coorSystem:r,anchor:s,raw_card:l})}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCCard",base:u.a,methodName:"init"},{baseName:"DOCCard",base:u.a,methodName:"setRect"},{baseName:"DOCLayout",base:c.DOCLayout,methodName:"init"},{baseName:"ITPoint",base:l.ITPoint,methodName:"init"},{baseName:"DOCTopShape",base:b.a,methodName:"cleanRenderInfo"}]}}]),r()(e,[{key:"init",value:function(e){var t=e.outer,n=e.viewPage,i=e.range,o=e.coorSystem,a=e.anchor,r=e.raw_card;this.mixin_DOCCard_init(),this.mixin_DOCLayout_init({parent:null,viewPage:n,coorSystem:o}),this.mixin_ITPoint_init(i.begin),this.outer=t,this.anchor=a,this.wrap_mode=a.wrapMode,this.wrap_side=a.wrapSide,this.layer=a.layer,this._layoutInCell=!0,r&&this._initFromRawData(r)}},{key:"reset",value:function(e){var t=e.outer,n=(e.viewPage,e.range,e.coorSystem,e.anchor);e.raw_card;this.outer=t,this.anchor=n,this.wrap_mode=this.anchor.wrapMode,this.wrap_side=this.anchor.wrapSide,this.layer=this.anchor.layer}},{key:"_initFromRawData",value:function(e){var t=this;if(null!=e.subDocType&&(this.subdoc_type=parseInt(e.subDocType)),null!=e.geometry&&(this.rect=v.a.initByDocRect(e.geometry),this.setRect(this.rect)),e.hasTextbox&&e.textboxPage&&!this.anchor.shapeData.hasArtWord){if(this.hostPendings=[],this.has_textbox=!0,this.left_padding=Object(_.Ti2Px)(e.leftPadding),this.right_padding=Object(_.Ti2Px)(e.rightPadding),this.top_padding=Object(_.Ti2Px)(e.topPadding),this.bottom_padding=Object(_.Ti2Px)(e.bottomPadding),e.textboxPage&&e.textboxPage.rect&&!e.textboxPage.rect.isAdjusted){var n=e.textboxPage.lines,i=e.textboxPage.rect,o=i.right,a=i.bottom,r=i.left,s=i.top,l=void 0,u=n.length?n[n.length-1].rect.bottom:Object(_.Ti2Px)(a-s),c=!1;if(null!=e.textboxPage.textFlow){var h=new m.a(parseInt(e.textboxPage.textFlow));"T2B"===h.corX?(s=i.left,c=!0):"B2T"===h.corX&&(s=0,c=!0),"L2R"===h.corY?r=i.top:"R2L"===h.corY&&(r=Object(_.Px2Ti)(this.rect.width-(this.right_padding+this.left_padding))-i.top-u)}l=c?Object(_.Px2Ti)(this.rect.height-(this.top_padding+this.bottom_padding))-i.left:o-r-e.leftPadding-e.rightPadding,i.left=r+e.leftPadding,i.top=s+e.topPadding,i.right=r+l,i.bottom=s+u,i.isAdjusted=!0}this.textbox_page=new d.d({parent:this,viewPage:this.viewPage,coorSystem:this.viewPage.coorSystem},{subdoc_type:this.subdoc_type,compose:this.viewPage.compose,textpage:e.textboxPage}),this.shapeData&&this.autoFitByContent()}e.childTextboxs&&this._initChildTextboxs(e.childTextboxs),this.updateInnerBoundary(),this.shapeData||(this.afterInitDrawingTool=function(){t.textbox_page&&t.autoFitByContent(),e.childTextboxs&&t._initChildTextboxs(e.childTextboxs),t.updateInnerBoundary(),delete t.afterInitDrawingTool})}},{key:"initTextbox",value:function(){this._createTextbox()}},{key:"_isInSnippetCard",value:function(){return this.outer.host.layoutType===c.DOCLayoutType.SnippetScene}},{key:"clone",value:function(){var e=Object.assign({},this);return e.id=this.id,e.wrap_mode=this.wrap_mode,e.wrap_side=this.wrap_side,e.layer=this.layer,e.is_behind_text=this.is_behind_text,e.vert_rel=this.vert_rel,e.zorder=this.zorder,e.isBehindText=this.isBehindText,e.isWrap=this.isWrap,e.allowover=this.allowover,e.isAutoSize=this.isAutoSize,e.shape_tree_type=this.shape_tree_type,e}},{key:"initInkData",value:function(){this.isInk&&!this.inkData&&(this.inkData=new y.a,this.inkData.initFromServer(this))}},{key:"isView",value:function(){return!1}},{key:"isScene",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"isCoorSystem",value:function(){return!0}},{key:"setRect",value:function(e){this.mixin_DOCCard_setRect(e)}},{key:"isContain",value:function(e){return this.anchor&&this.anchor.body?l.IT.containTest(this.anchor.body,e):l.IT.strictContainTest(this,e)}},{key:"cleanRenderInfo",value:function(){this.mixin_DOCTopShape_cleanRenderInfo()}},{key:"getWrapPoints",value:function(){var e=this.rect,t=e.left,n=e.top,i=e.width,o=e.height,a=this.anchor.data.private.wrapPoints;if(a&&a.length){var r=void 0;if(this.shapeData&&(this.horizontalFlipped||this.verticalFlipped||0!==this.rotation)){var s=new window.QMatrix;s.translate(t+i/2,n+o/2),0!==this.rotation&&s.rotate(this.rotation),s.translate(-i/2,-o/2),r=a.map((function(e){var t=e.x,n=e.y,a=s.map_point(new window.Point(t*i/21600,n*o/21600));return{x:a.x(),y:a.y()}}))}else r=a.map((function(e){var a=e.x,r=e.y;return{x:t+a*i/21600,y:n+r*o/21600}}));return r}}},{key:"id",get:function(){return this.anchor.shapeId}},{key:"is_behind_text",get:function(){return 1===this.layer}},{key:"vert_rel",get:function(){return this.anchor.vertRel}},{key:"zorder",get:function(){return this.anchor.zorder}},{key:"isBehindText",get:function(){return this.is_behind_text&&this.wrap_mode===h.b}},{key:"isWrap",get:function(){if(this._isInSnippetCard())return!1;var e=this.wrap_mode;return e!==h.b&&e!==h.a}},{key:"allowover",get:function(){return!!this._isInSnippetCard()||this.anchor.allowover}},{key:"vertAnchor",get:function(){return this.anchor.shapeData.vertAnchor}},{key:"shapeType",get:function(){return this.anchor.shapeData.shapeType}},{key:"isTextBox",get:function(){return!!this.anchor.flags.isTextBox}},{key:"isPicture",get:function(){return!!this.anchor.shapeData.picture}},{key:"isInk",get:function(){return!!this.anchor.shapeData&&this.anchor.shapeData.isInk}},{key:"isLatexMath",get:function(){return this.anchor.shapeData.extData&&this.anchor.shapeData.extData.isLatexMath}},{key:"isBrokenImg",get:function(){return this.anchor.shapeData.extData&&this.anchor.shapeData.extData.isBrokenImg}},{key:"brokenImgOrgSrc",get:function(){return this.anchor.shapeData.extData&&this.anchor.shapeData.extData.brokenImgOrgSrc}},{key:"effectExtents",get:function(){return this.anchor.effectExtents}},{key:"shape_tree_type",get:function(){return this.subdoc_type==p.HeaderFooter||this.subdoc_type==p.TextboxInHF?g.b:g.d}},{key:"position2parent",get:function(){return f.a.initWithOrigin({x:this.rect.left,y:this.rect.top})}},{key:"offset4child",get:function(){return f.a.ZERO()}},{key:"layoutType",get:function(){return c.DOCLayoutType.ShapeScene}},{key:"layoutInCell",set:function(e){this._layoutInCell=e},get:function(){return this._layoutInCell}},{key:"layoutRect",set:function(e){this._layoutRect=e},get:function(){return this._layoutRect||this.rect}},{key:"layoutViewRect",get:function(){var e=this.layoutRect?this.layoutRect:this.rect;if(this.coor_pos2view){var t=new T.a(e);return t.addOffset(this.coor_pos2view.x,this.coor_pos2view.y),t}return e}}]),e}();t.a=C;s.a.mix(C,u.a,c.DOCLayout,l.ITPoint,b.a)},4810:function(e,t,n){"use strict";var i=n(22),o=n.n(i),a=n(145),r=n.n(a),s=n(23),l=n.n(s),u=n(1),c=n.n(u),h=n(2),d=n.n(h),p=n(7121),f=n(7155),g=n(310),v=n(2010),m=n(6106),_=function(){function e(t){c()(this,e),this.textPart=t}return d()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCDataLogic",base:v.a,methodName:"init"}]}}]),d()(e,[{key:"getSegments",value:function(e){var t=[],n=this.getChpx(e.pos),i=this.getPapx(e.pos),o=new m.a({pos:e.pos,len:e.len},n.prop,i.prop);return t.push(o),t}},{key:"getText",value:function(e,t){return this.textPart.getText(e,t)}},{key:"getTextSize",value:function(){return this.textPart.getTextSize()}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.IT.Include;return this.textPart.getChpx(e,t)}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.IT.Include;return this.textPart.getPapx(e,t)}}]),e}(),y=n(4969),b=n(7128),T=n(4577),C=function(){function e(t){c()(this,e),this.textPart=t,this.fontServer=window.APP.fontServer}return d()(e,[{key:"init",value:function(){}},{key:"load",value:function(e){var t=this,n=e.glyphArrays,i={};n.forEach((function(e){if(e.isVisible()&&e.font){var t=e.font,n=t.fontFamily,o=""!==t.fontWeight&&void 0!==t.fontWeight,a=""!==t.fontStyle&&void 0!==t.fontStyle,r=(o?3:0)|(a?1:0);i[n]||(i[n]={}),i[n][r]||(i[n][r]={family:n,bold:o,italic:a,emphasizes:T.b})}}));var o=this.textPart.getGcpRange();Object.keys(i).forEach((function(e){var n=i[e];Object.keys(n).forEach((function(e){t.fontServer.load(n[e],o)}))}))}}]),e}(),k=function(){function e(){c()(this,e)}return d()(e,[{key:"init",value:function(){}},{key:"load",value:function(e){var t=e.glyphArrays,n=e.glyphBuff;t.forEach((function(e){e.chpx.getPropVal("vanish")&&e.setHiddenFlag(),n.buffs.slice(e.begin,e.end).forEach((function(e){e.mi&&delete e.mi}))}))}}]),e}(),w=function(){function e(t,n){c()(this,e),this.doc=t,this.textPart=n}return d()(e,[{key:"init",value:function(){}},{key:"load",value:function(e){var t=e.glyphArrays,n=this.textPart.getGcpRange(),i=n.pos,o=i+n.len;this.doc.fields.getFields({begin:i,end:o}).length&&t.forEach((function(e){e.setFieldFlag()}))}}]),e}(),S=function(e){function t(e,n){c()(this,t);var i=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.init(e,n),i}return l()(t,e),d()(t,[{key:"init",value:function(e,n){this.textPart=n,r()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),window.APP.createBidi&&this.initBidiLoader(),this.validate({begin:0,end:this.size})}},{key:"creatLoaders",value:function(){if(y.b.Field==this.textPart.textPartType||y.b.FootnoteEndnote===this.textPart.textPartType)return[new f.a,new k,new w(this.doc,this.textPart),new p.a,new C(this.textPart)]}},{key:"createDataLogic",value:function(){return new _(this.textPart)}},{key:"onFontUpdate",value:function(e,t){var n=this.textPart.getGcpRange();t.some((function(e){return e.pos<n.pos+n.len&&e.pos+e.len>n.pos}))&&this.validate({begin:0,end:n.len})}}]),t}(b.a);t.a=S},4955:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return c}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=function(){function e(){o()(this,e)}return r()(e,[{key:"getWrapOpDones",value:function(e){return e}},{key:"getWrapOps",value:function(e){return e}},{key:"getOpsFromWraper",value:function(e,t){}},{key:"getOpsDoneFromWraper",value:function(e,t){}},{key:"transOpFmla",value:function(){return!1}},{key:"decompileOpsFmla",value:function(){return!1}},{key:"getCmdMainId",value:function(e){console.error("pure virtual func")}},{key:"updateShapeIdxPath",value:function(e){}},{key:"OpTrsOp",value:function(){console.error("pure virtual func")}},{key:"reverse",value:function(e){console.error("pure virtual func")}},{key:"trans",value:function(e,t){var n=this.getWrapOpDones(e),i=this.getWrapOps(t),o=[];o[i.length-1]=0,o=o.fill(0);for(var a=!1,r=!1,s=0;s<i.length;++s)for(var l=o[s];l<n.length;++l){var u=[],c=[],h=this.transOpFmla(n[l],i[s]);if(this.OpTrsOp(n[l],i[s],c,this.svtMap),this.OpTrsOp(i[s],n[l],u,this.mstMap),c.length>0){if(i.splice.apply(i,[s,1].concat(c)),c.length>1){var d=[s+1,0],p=l+Math.max(u.length,1);d[c.length]=p,d=d.fill(p,2),o.splice.apply(o,d)}a=!0}u.length>0&&(n.splice.apply(n,[l,1].concat(u)),l+=u.length-1,r=!0),h&&this.decompileOpsFmla(c)&&(a=!0)}return a&&this.getOpsFromWraper(i,t),r&&this.getOpsDoneFromWraper(n,e),a}},{key:"trans_Reverser",value:function(e,t){var n=this.reverse(e);return!(n.length<=0)&&this.trans(n,t)}},{key:"trans_othersReverser",value:function(e,t){var n=this.reverse(e);return!(n.length<=0)&&this.trans(n,t)}},{key:"getLocalCmds",value:function(e){var t=[];return e?(e.forEach((function(e){t.push(e.localCommand)})),t):t}},{key:"getMainOps",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i={};return e?(e.forEach((function(e){if(!(t&&e.isVerOfCurExec||n&&e.isSelf))for(var o in e.mainOperstes)if(e.mainOperstes.hasOwnProperty(o)){var a=e.mainOperstes[o];a.length<=0||(null==o&&(o=0),i[o]=o in i?i[o].concat(a):a)}})),i):i}}]),e}(),l=function(e){var t=[],n=[],i=e.applyVersions.length,o=e.resetBaseVersions.length;if(0===i||0===o)return e;for(var a=0;a<i;++a)for(var r=e.applyVersions[a],s=0;s<o;++s){var l=e.resetBaseVersions[s];if(r.bornTaskVer===l.bornTaskVer||r.bornTaskVer===l.taskVer){n[a]=!0,t[s]=!0;break}}if(0===t.length&&0===n.length)return e;var u={};u.localVersions=e.localVersions,u.localCommitedVersion=e.localCommitedVersion,u.resetBaseVersions=[],u.applyVersions=[],u.shapePictureChanged=e.shapePictureChanged;for(var c=0;c<i;++c)!0!==n[c]&&u.applyVersions.push(e.applyVersions[c]);for(var h=0;h<o;++h)!0!==t[h]&&u.resetBaseVersions.push(e.resetBaseVersions[h]);return u},u=function(e,t){var n=t.getLocalCmds(e.localVersions),i=t.getLocalCmds(e.localCommitedVersion);if(0===n.length)return n;e=l(e);var o={};return o.trans=t.getMainOps(e.applyVersions,!0),o.trans_Reverser=t.getMainOps(e.resetBaseVersions,!1),o.trans_othersReverser=t.getMainOps(e.resetBaseVersions,!0),["trans_othersReverser","trans"].forEach((function(e){var n=o[e],a=t[e];if(n)for(var r=0;r<i.length;++r){var s=[i[r]];a.call(t,n,s)&&(i.splice.apply(i,[r,1].concat(s)),r+=s.length-1)}})),["trans_Reverser","trans"].forEach((function(e){for(var i=o[e],a=t[e],r=0;r<n.length;++r){var s=i[t.getCmdMainId(n[r])];if(s){var l=[n[r]];a.call(t,s,l)&&(n.splice.apply(n,[r,1].concat(l)),r+=l.length-1)}}})),t.updateShapeIdxPath(n),n},c=function(e,t,n,i){if(!e||0===n.length)return!1;e=l(e);var o={};o.trans=t.getMainOps(e.applyVersions,!1,i),o.trans_Reverser=t.getMainOps(e.resetBaseVersions,!1,i);var a=!1;return["trans_Reverser","trans"].forEach((function(e){for(var i=t[e],r=0;r<n.length;++r){var s=o[e][t.getCmdMainId(n[r])];if(s){var l=[n[r]];i.call(t,s,l)&&(a=!0,n.splice.apply(n,[r,1].concat(l)),r+=l.length-1)}}})),a}},4967:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.storeReadPosition=void 0;var i,o=n(1238),a=n(309),r=Date.now(),s=null;function l(){var e=window.APP;if(!e.isHistoryVersion&&e.workspace)try{var t=window.APP.fileId,n={id:t,expired:Date.now()+12096e5+""};if(e.isPreview){var i=e.workspace.getCurrentPageIndex();n.readPageIndex=i}else if(e.uilManager){var o=e.data.selection.selContext.subdocType;if([a.HeaderFooter,a.Endnote,a.Comment].includes(o)){var r=e.workspace.getVisiblePages();r.length?n.readPosition=r[0].range.pos:n.readPosition=e.uilManager.getGCPOnVisible()}else n.readPosition=e.uilManager.getGCPOnVisible()}var s=c();s.recordMap[t]=n,window.localStorage.setItem("WPS_READ_POSITION",function(e){return JSON.stringify(e)}(s))}catch(e){}}t.default=function(){if(!window.__CONFIG__.wps.enableAutoRestorePositionOnOpen)return!1;var e=s||c().recordMap[window.APP.fileId];if(!e)return!1;var t=window.APP;if(t.isPreview){if(e.readPageIndex)return t.workspace.scrollToPage(e.readPageIndex-1),!0}else if(e.readPosition){var n=t.data.doc.getSubDocRange(0),i=Math.min(e.readPosition,n.pos+n.len);return(0,o.typoToPositionWithLoading)(i).then((function(){t.data.selection.setPosition(i),t.workspace.makeContentVisible(i),setTimeout((function(){var e=t.workspace.element.cacheDOMAttr,n=e.clientHeight,o=e.scrollTop,a=t.data.typoinfo.getPosition(i),r=a.pos.posY*t.workspace.config.zoom;a.pos&&o+n<r&&t.workspace.makeContentVisible(i)}),1500)})),!0}return!1},t.storeReadPosition=function(e){void 0===e&&(e={}),window.__CONFIG__.wps.enableAutoRestorePositionOnOpen&&(s||(s=c().recordMap[window.APP.fileId]),e.throttle?(i||(i=window.utils.Lodash.throttle(l,1e3)),i()):l())};var u=!1;function c(){try{var e=window.localStorage.getItem("WPS_READ_POSITION");if(e)return function(e){if(!u&&Date.now()-r>6e4){var t=e.recordMap;Object.keys(t).forEach((function(e){var n=t[e];n&&parseInt(n.expired,10)<=Date.now()&&delete t[e]})),u=!0}return e}((t=e,JSON.parse(t)))}catch(e){}var t;return{recordMap:{}}}},4968:function(e,t,n){"use strict";n.d(t,"e",(function(){return v})),n.d(t,"d",(function(){return m})),n.d(t,"b",(function(){return y})),n.d(t,"a",(function(){return b})),n.d(t,"c",(function(){return T}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(3856),f=n(1591),g=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return d()(t,e),r()(t,[{key:"getGlyphPool",value:function(){return this.typoRange&&this.typoRange.data||c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getGlyphPool",this).call(this)}},{key:"canDoCompress",value:function(){return!1}},{key:"type",get:function(){return f.b.Unknow}},{key:"isTextPartZone",get:function(){return!0}}]),t}(p.a),v=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return d()(t,e),r()(t,[{key:"type",get:function(){return f.b.HFPageNumField}}]),t}(g),m=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return d()(t,e),r()(t,[{key:"clear",value:function(){c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"type",get:function(){return f.b.HFPageCountField}}]),t}(g),_=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return d()(t,e),r()(t,[{key:"isNoteZone",get:function(){return!0}}]),t}(g),y=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return d()(t,e),r()(t,[{key:"type",get:function(){return f.b.Footnote}},{key:"isFootnote",get:function(){return!0}}]),t}(_),b=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return d()(t,e),r()(t,[{key:"type",get:function(){return f.b.Endnote}},{key:"isEndnote",get:function(){return!0}}]),t}(_),T=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return d()(t,e),r()(t,[{key:"type",get:function(){return f.b.NodePlaceholder}},{key:"isNotePlaceholder",get:function(){return!0}}]),t}(_)},4969:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return u}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(310),l={Unknow:0,Field:1,FootnoteEndnote:2},u=function(){function e(){o()(this,e)}return r()(e,[{key:"getTextSize",value:function(){}},{key:"getText",value:function(e,t){}},{key:"getChpx",value:function(e){arguments.length>1&&void 0!==arguments[1]||s.IT.Include}},{key:"getPapx",value:function(e){arguments.length>1&&void 0!==arguments[1]||s.IT.Include}},{key:"convertGcp2Cp",value:function(e){}},{key:"getGcpRange",value:function(){}},{key:"clone",value:function(){}},{key:"textPartType",get:function(){return l.Unknow}}]),e}()},4970:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=function(){function e(){o()(this,e)}return r()(e,null,[{key:"doInTransact",value:function(e,t,n){window.g_rpt.beginTransact();var i=window.g_rpt.getCurrentTransact();n(),i.localCommand={name:e,param:t},window.g_rpt.endTransact()}},{key:"recordAndExec",value:function(e,t){window.g_rpt.addCustomOperate(e,t),e[t.name](t.param,!0)}}]),e}();t.a=s},4971:function(e,t,n){"use strict";t.a=function(e){e.forward=function(e){this.doOperation(e,!0)},e.backward=function(e){this.doOperation(e,!1)},e.doOperation=function(e,t){for(var n=function(e,t){if(t){var n=[];return e.forEach((function(e){n.push(e)})),n.reverse(),n}return e}(e.data,!t),i=0;i<n.length;++i){if(null!=this[n[i].name]){var o=n[i];this[o.name](o.param,t)}}},"_fireChanged"in e||(e._fireChanged=function(){})}},4972:function(e,t,n){"use strict";n.r(t),n.d(t,"wpsNotDisplayDocumentFileds",(function(){return i})),n.d(t,"wpsDisplayDocumentFields",(function(){return o})),n.d(t,"wpsDisplayDocumentFieldsWithoutBackground",(function(){return a}));var i=0,o=1,a=2},4973:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=String.fromCharCode(61693),o=String.fromCharCode(61694)},4974:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return s})),n.d(t,"d",(function(){return l})),n.d(t,"g",(function(){return u}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6},4975:function(e,t,n){"use strict";n.r(t),n.d(t,"None",(function(){return i})),n.d(t,"Normal",(function(){return o})),n.d(t,"Wordonly",(function(){return a}));var i=0,o=1,a=2},4976:function(e,t,n){"use strict";n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return v})),n.d(t,"c",(function(){return m}));var i=n(8),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(410),c=n(310),h=n(554),d=n(1169),p=n(1103),f=n(1639),g=function(){function e(t,n,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r()(this,e),this.isRepeatItem=o;var a=i.private.id;this.init(t,n,i,a),i.on(this.onDataChanged.bind(this))}return l()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCRange",base:d.d,methodName:"init"}]}}]),l()(e,[{key:"init",value:function(e,t,n,i){this.mixin_DOCRange_init(e,e+t,n,i)}},{key:"onDataChanged",value:function(e){}},{key:"hide",value:function(e){this.svgNodes&&this.svgNodes.forEach((function(t){var n=t.getAttribute("id"),i=t.parentNode;if(i&&(void 0===e||n.indexOf("-"+e)>0))for(var o=i.childNodes.length-1;o>=0;--o){var a=i.childNodes[o];a.getAttribute("id")===n&&(i.removeChild(a),a=null)}})),this.svgNodes=[]}},{key:"isModified",get:function(){return this._isModified},set:function(e){this._isModified=e}},{key:"id",get:function(){return this.getData().getId()}},{key:"objID",get:function(){return this.getData().objID}},{key:"type",get:function(){return this.getData().getType()}},{key:"title",get:function(){if(this.isRepeatItem){var e=this.parent;if(e)return e.getData().getTitle()}return this.getData().getTitle()},set:function(e){(this.isRepeatItem&&this.parent||this).getData().setTitle(e)}},{key:"tag",get:function(){if(this.isRepeatItem){var e=this.parent;if(e)return e.getData().getTag()}return this.getData().getTag()},set:function(e){(this.isRepeatItem&&this.parent||this).getData().setTag(e)}},{key:"level",get:function(){return this.getData().getLevel()}},{key:"color",get:function(){if(this.isRepeatItem){var e=this.parent;if(e)return e.getData().getColor()}return this.getData().getColor()}},{key:"appearance",get:function(){if(this.isRepeatItem){var e=this.parent;if(e)return e.getData().getAppearance()}return this.getData().getAppearance()}},{key:"lockContent",get:function(){if(this.isRepeatItem){var e=this.parent;if(e)return e.getData().getLockContent()}return this.getData().getLockContent()}},{key:"lockControl",get:function(){if(this.isRepeatItem){var e=this.parent;if(e)return e.getData().getLockControl()}return this.getData().getLockControl()}},{key:"temporary",get:function(){if(this.isRepeatItem){var e=this.parent;if(e){var t=e.getData();return!!t.getTemporary&&t.getTemporary()}}var n=this.getData();return!!n.getTemporary&&n.getTemporary()}},{key:"showPlcHdr",get:function(){return this.getData().private.showPlcHdr}},{key:"isDate",get:function(){return this.type===f.Date}},{key:"isRichText",get:function(){return this.type===f.RichText}},{key:"isDropdownList",get:function(){return this.type===f.DropdownList}},{key:"isCatalog",get:function(){return this.type===f.DocpartObj}},{key:"isPureText",get:function(){return this.type===f.PureText}},{key:"isPicture",get:function(){return this.type===f.Picture}},{key:"isComboBox",get:function(){return this.type===f.ComboBox}},{key:"isBuildingBlock",get:function(){return this.type===f.BuildingBlock}},{key:"isGroup",get:function(){return this.type===f.Group}},{key:"isCheckBox",get:function(){return this.type===f.CheckBox}},{key:"isRepeatSec",get:function(){return this.type===f.RepeatSec}},{key:"placeholderText",get:function(){var e=this.getData();return e.getPlaceholderText?e.getPlaceholderText():""},set:function(e){this.getData().setPlaceholderText(e)}},{key:"multiLine",get:function(){var e=this.getData();return!!e.getMultiLine&&e.getMultiLine()},set:function(e){var t=this.getData();t.setMultiLine&&t.setMultiLine(e)}},{key:"displayFormat",get:function(){var e=this.getData();return e.getDisplayFormat?e.getDisplayFormat():""}},{key:"entries",get:function(){var e=this.getData();return e.getEntries?e.getEntries():[]},set:function(e){this.getData().setEntries(e)}},{key:"isChecked",get:function(){var e=this.getData();return!!e.getIsChecked&&e.getIsChecked()}},{key:"checkedSymbol",get:function(){var e=this.getData();return e.getCheckedSymbol?e.getCheckedSymbol():""}},{key:"unCheckedSymbol",get:function(){var e=this.getData();return e.getUnCheckedSymbol?e.getUnCheckedSymbol():""}},{key:"repeatSecs",get:function(){return this.isRepeatSec?window.APP.data.doc.repeatSecItems.findRepeatSecItems(this.pos,this.len,this.id):[]}},{key:"parent",get:function(){if(!this.isRepeatItem)return null;var e=this.getData();if(!e.getParentId)return null;var t=e.getParentId();return window.APP.data.doc.contentControls.findRangeByRefId(t)}}]),e}(),v=function(){function e(t,n){r()(this,e),function(e){Object(d.f)(e),Object(h.default)(e);var t=e.doInsertRange.bind(e);e.doInsertRange=function(e,n){t(e,n),n?this._dispatch("insertControlNode",e):this._dispatch("deleteControlNode",e)}}(this),this.rangeClass=new d.e(n,p.e,c.IT.outer,c.IT.Nesting,!0),this.doc=n;var i=this;t.forEach((function(e){i.doInsertNakedRange(e)}))}return l()(e,[{key:"doInsertNakedRange",value:function(e){var t=new g(e.pos,e.len,e.data);this.rangeClass.attachNode(t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);t&&this.rangeClass.detachNode(t)}},{key:"collect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.rangeClass.mapInRange(e,e+t,c.IT.mapToNode,c.IT.strictIntersectTest);if(n){var a=this.doc.repeatSecItems.collect(e,t);a.length&&(i=[].concat(o()(i),o()(a)).sort((function(e,t){return e.pos-t.pos})))}return i}},{key:"findControl",value:function(e,t){return this.rangeClass.findNodeEqualRange(e,e+t)}},{key:"isInTextContentControl",value:function(e){var t=this.rangeClass.findNodeContainPos(e,c.IT.Exclude);return!(!t||"text"!==t.title)}},{key:"findRangeByRefId",value:function(e){return this.rangeClass.findRangeByRefId(e)}},{key:"findControlById",value:function(e){return this.findRangeByRefId(e)||this.doc.repeatSecItems.findRangeByRefId(e)}}]),e}(),m=function(){function e(t,n){r()(this,e),Object(d.f)(this),this.rangeClass=new d.e(n,p.q,c.IT.outer,c.IT.Nesting,!0);var i=this;t&&t.forEach((function(e){i.doInsertNakedRange(e)}))}return l()(e,[{key:"doInsertNakedRange",value:function(e){var t=new g(e.pos,e.len,e.data,!0);this.rangeClass.attachNode(t)}},{key:"doRemoveNakedRange",value:function(e){var t=this.rangeClass.findNodeEqualRange(e.pos,e.pos+e.len);t&&this.rangeClass.detachNode(t)}},{key:"collect",value:function(e,t){return this.rangeClass.mapInRange(e,e+t,c.IT.mapToNode,c.IT.strictIntersectTest)}},{key:"findControl",value:function(e,t){return this.rangeClass.findNodeEqualRange(e,e+t)}},{key:"findNearestControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.collect(e,t);return n[n.length-1]}},{key:"findRepeatSecItems",value:function(e,t,n){return this.collect(e,t).filter((function(e){var t=e.getData();return(t.getParentId&&t.getParentId())===n}))}},{key:"findRangeByRefId",value:function(e){return this.rangeClass.findRangeByRefId(e)}}]),e}();u.a.mix(g,d.d)},4977:function(e,t,n){"use strict";n.d(t,"h",(function(){return d})),n.d(t,"b",(function(){return k})),n.d(t,"i",(function(){return w})),n.d(t,"j",(function(){return S})),n.d(t,"e",(function(){return E})),n.d(t,"d",(function(){return O})),n.d(t,"g",(function(){return x})),n.d(t,"k",(function(){return R})),n.d(t,"l",(function(){return N})),n.d(t,"c",(function(){return A})),n.d(t,"f",(function(){return M})),n.d(t,"a",(function(){return L}));var i=n(760),o=n(691),a=n(309),r=(n(324),a.Endnote),s=a.Footnote,l=a.HeaderFooter,u=a.Macro,c=a.Textbox,h=a.TextboxInHF,d={rankByName:"rankByName",rankByDocPos:"rankByDocPos"},p=65296,f=65305,g=97,v=122,m=19968,_=40869,y=95,b=48,T=57,C=32,k={firstCharNum:"firstCharNum",firstCharUnderline:"firstCharUnderline",hasSpace:"hasSpace",hasEngChar:"hasEngChar",noError:"noError"};function w(e,t){var n=e.name.toLocaleLowerCase(),i=t.name.toLocaleLowerCase();if(e.index!==t.index)return e.index-t.index;if(1e4!==e.index){var o=n.indexOf("："),a=i.indexOf("：");n=n.substring(o),i=i.substring(a)}for(var r=0,s=Math.min(n.length,i.length);r<s;r++){var l=I(n[r]),u=I(i[r]);if(l!==u)return l-u;if(n[r]!==i[r])return 0===l?n[r].localeCompare(i[r]):n.charCodeAt(r)-i.charCodeAt(r)}}function S(e,t){var n=P(e.pos),i=P(t.pos);return n===i?e.pos===t.pos?e.len===t.len?w(e,t):e.len-t.len:e.pos-t.pos:n-i}function P(e){switch(window.APP.data.doc.getSubDocType(e)){case a.MainText:return 0;case a.Footnote:return 1;case a.HeaderFooter:return 6;case a.Comment:return 3;case a.Endnote:return 2;case a.Textbox:return 4;case a.TextboxInHF:return 5}}function I(e){var t=e.toLocaleLowerCase().charCodeAt(0);return g<=t&&t<=v?-1:m<=t&&t<=_?0:b<=t&&t<=T?2:1}function E(e){var t=e.toLocaleLowerCase().charCodeAt(0);return t>=g&&t<=v||t>191&&(t<p||t>f)}function O(e){var t=e.charCodeAt(0);return t===C?k.hasSpace:t===y?k.firstCharUnderline:t>=b&&t<=T?k.firstCharNum:E(e)||x(e)?k.noError:k.hasEngChar}function x(e){for(var t=e.toLocaleLowerCase(),n=0;n<t.length;n++){if(!D(t.charCodeAt(n)))return!1}return!0}function R(e){return e.replace(/(^\s*)/g,"")}function N(e){for(var t=e,n=e.toLocaleLowerCase(),i=n.length-1;i>=0;i--){D(n.charCodeAt(i))||(n=n.substring(0,i)+n.substring(i+1),t=t.substring(0,i)+t.substring(i+1))}return t}function A(e){return Object(i.filterText)(e,o.isSpecialPlaceholder)}function D(e){return e>=g&&e<=v||e>=b&&e<=T||e>191||e===y}function M(e){var t=!0;try{var n=e;"string"==typeof n&&(n=window.APP.data.doc.documentFields.getFieldByName(n));var i=window.APP.data.doc.getSubDocType(n.end);(t=![r,s,u].includes(i))&&window.APP.isWebMode()&&(t=![l,h,c].includes(i))}catch(e){}return t}function L(e){var t=window.APP.data.doc;if(!t)return!1;var n=t.documentFields,i=e.reduce((function(e,t){var i=n.getFieldByName(t);return i&&e.push({pos:i.pos,len:i.len}),e}),[]);return!window.APP.restrictEditHandler.checkIsAnyRangeNonEditable(i)}},4978:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(3490),o=n(2180);function a(e,t){return function(e,t){return e===o.c&&t.isRichText&&/^[a-z]+(_[a-z]+)?$/.test(t.title)}(e,t)?i.a:i.b}},4979:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={DOTTED_BOX:0,COLOR_BLOCK:1,FULL_BOX:2}},535:function(e,t,n){"use strict";n.r(t),n.d(t,"AbsObject",(function(){return o})),n.d(t,"AbsTopObject",(function(){return l})),n.d(t,"AbsCustomObject",(function(){return s})),n.d(t,"AbsVectorObject",(function(){return a})),n.d(t,"AbsDelayVectorObject",(function(){return r})),n.d(t,"AbsTopVectorObject",(function(){return u})),n.d(t,"AbsDelayTopVectorObject",(function(){return c})),n.d(t,"AbsTopCustomObject",(function(){return h}));var i=n(614);function o(){this.objType,this.private=null,this.initialize()}function a(){this.vector=[],this.initialize()}function r(){this.cnt=0,this.initialize()}function s(){this.initialize()}function l(){this.initialize()}function u(){this.initialize()}function c(){this.initialize()}function h(){this.initialize()}o.prototype.initialize=function(){this.objType=i.default.OType_Data,this.private=null,void 0!==window.g_rpt&&window.g_rpt.registerNewObject(this)},o.prototype.isTopObject=function(){return!1},o.prototype.isMainObject=function(){return!1},o.prototype.writeLock=function(){this.objType===i.default.OType_Data?this.__modified||window.g_rpt.addDataNotify(this):console.error("object type error")},o.prototype.isNewest=function(){return!(null==this.newest||0==this.newest)},o.prototype.forward=function(e){if(e.opType===i.default.otReplaceData&&!1===this.isNewest()){var t=this.private;this.private=e.data,e.data=t}return null},o.prototype.backward=function(e){if(e.opType===i.default.otReplaceData){var t=this.private;this.private=e.data,e.data=t}},o.prototype.on=function(e){this.onChangedCB=e},o.prototype._fireChanged=function(e){this.onChangedCB&&this.onChangedCB(this,e)},a.prototype=new o,a.prototype.initialize=function(){this.objType=i.default.OType_Vector,void 0!==window.g_rpt&&window.g_rpt.registerNewObject(this)},a.prototype.writeLock=function(){},a.prototype.at=function(e){return this.vector[e]},a.prototype.length=function(){return this.vector.length},a.prototype.set=function(e,t){if(this.vector.length<=e)return-1;var n=this.vector[e];return this.vector[e]=t,window.g_rpt.addVectorOperate(this,i.default.otModify,e,t,n),0},a.prototype.push=function(e){return this.vector.push(e),window.g_rpt.addVectorOperate(this,i.default.otInsert,this.vector.length-1,e),0},a.prototype.pop=function(){this.remove(this.length()-1)},a.prototype.insert=function(e,t){return this.vector.length<e?-1:(this.vector.splice(e,0,t),window.g_rpt.addVectorOperate(this,i.default.otInsert,e,t),0)},a.prototype.remove=function(e){if(this.vector.length<=e)return-1;var t=this.vector[e];return this.vector.splice(e,1),window.g_rpt.addVectorOperate(this,i.default.otRemove,e,t),0},a.prototype.move=function(e,t){if(e+t<0||e+t>this.vector.length)return-1;var n=this.vector[e];return t<0?(this.vector.splice(e,1),this.vector.splice(e+t,0,n)):t>0&&(this.vector.splice(e+t,0,n),this.vector.splice(e,1)),window.g_rpt.addVectorOperate(this,i.default.otMove,e,n,void 0,t),0},a.prototype.forward=function(e){switch(e.opType){case i.default.otInsert:this.vector.splice(e.pos,0,e.data);break;case i.default.otRemove:this.vector.splice(e.pos,1);break;case i.default.otMove:e.offset<0?(this.vector.splice(e.pos,1),this.vector.splice(e.pos+e.offset,0,e.data)):e.offset>0&&(this.vector.splice(e.pos+e.offset,0,e.data),this.vector.splice(e.pos,1));break;case i.default.otModify:this.vector[e.pos]=e.data;break;case i.default.otReplaceData:var t=this.vector;this.vector=e.data,e.data=t}},a.prototype.backward=function(e){var t={};switch(t.object=e.object,t.pos=e.pos,e.opType){case i.default.otInsert:t.opType=i.default.otRemove,t.data=e.data;break;case i.default.otRemove:t.opType=i.default.otInsert,t.data=e.data;break;case i.default.otMove:t.opType=i.default.otMove,t.pos=e.pos+e.offset,t.offset=-e.offset,t.data=e.data;break;case i.default.otModify:t.opType=i.default.otModify,t.oldData=e.data,t.data=e.oldData;break;case i.default.otReplaceData:t=e}this.forward(t)},a.prototype.foreEachNewChildInOp=function(e,t){switch(e.opType){case i.default.otInsert:case i.default.otModify:t(e.data);break;case i.default.otReplaceData:for(var n=0;n<this.vector.length;++n)t(this.vector[n]);break;case i.default.otMove:case i.default.otRemove:break;default:console.error("foreEachNewChildInOp invalid op.opType")}},r.prototype=new a,r.prototype.initialize=function(){this.objType=i.default.OType_Delay_Vector,void 0!==window.g_rpt&&window.g_rpt.registerNewObject(this)},s.prototype=new o,s.prototype.initialize=function(){this.objType=i.default.OType_Custom,void 0!==window.g_rpt&&window.g_rpt.registerNewObject(this)},s.prototype.writeLock=function(){},s.prototype.forward=function(e){},s.prototype.backward=function(e){},s.prototype.on=function(e){this.onChangedCB=e},l.prototype=new o,l.prototype.initialize=function(){this.objType=i.default.OType_Data,void 0!==window.g_rpt&&window.g_rpt.registerTopObject(this)},l.prototype.isTopObject=function(){return!0},u.prototype=new a,u.prototype.initialize=function(){this.objType=i.default.OType_Vector,void 0!==window.g_rpt&&window.g_rpt.registerTopObject(this)},u.prototype.isTopObject=function(){return!0},c.prototype=new r,c.prototype.initialize=function(){this.objType=i.default.OType_Delay_Vector,void 0!==window.g_rpt&&window.g_rpt.registerTopObject(this)},c.prototype.isTopObject=function(){return!0},c.prototype.at=function(e,t){var n=this.vector[e];return void 0===n&&t&&t(e),n},h.prototype=new s,h.prototype.initialize=function(){this.objType=i.default.OType_Custom,void 0!==window.g_rpt&&window.g_rpt.registerTopObject(this)}},547:function(e,t,n){"use strict";n.r(t),n.d(t,"cursorTypes",(function(){return r})),n.d(t,"cursorTypeReg",(function(){return o}));var i=n(167),o=/cursor\-\S+(\-big)?/,a=(window.devicePixelRatio||1)>1||i.isIE,r={default:"cursor-default",text:"cursor-text",vertical_text:"cursor-vertical-text",hand:"cursor-hand",normal:a?"cursor-normal-big":"cursor-normal",move:a?"cursor-move-big":"cursor-move",select:a?"cursor-selected-big":"cursor-select",grab:"cursor-grab",grabbing:"cursor-grabbing",col_resize:a?"cursor-col-resize-big":"cursor-col-resize",row_resize:a?"cursor-row-resize-big":"cursor-row-resize",row_select:"cursor-row-select",row_select_left:"cursor-row-select-left",col_select_up:"cursor-col-select-up",col_select_down:"cursor-col-select-down",col_select:"cursor-col-select",cell_select:"cursor-cell-select",right:a?"cursor-right-big":"cursor-right",down:a?"cursor-down-big":"cursor-down",n_resize:a?"cursor-n-resize-big":"cursor-n-resize",e_resize:a?"cursor-e-resize-big":"cursor-e-resize",s_resize:a?"cursor-s-resize-big":"cursor-s-resize",w_resize:a?"cursor-w-resize-big":"cursor-w-resize",ne_resize:a?"cursor-ne-resize-big":"cursor-ne-resize",nw_resize:a?"cursor-nw-resize-big":"cursor-nw-resize",se_resize:a?"cursor-se-resize-big":"cursor-se-resize",sw_resize:a?"cursor-sw-resize-big":"cursor-sw-resize",ns_resize:"cursor-ns-resize",ew_resize:"cursor-ew-resize",nesw_resize:"cursor-nesw-resize",nwse_resize:"cursor-nwse-resize",zoom_in:"cursor-zoom-in",zoom_out:"cursor-zoom-out",format_painter:"cursor-format-painter",et_format_painter:"cursor-et-format-painter",wps_format_painter:"cursor-wps-format-painter",normal_big:"cursor-normal-big",move_big:"cursor-move-big",right_big:"cursor-right-big",down_big:"cursor-down-big",selected_big:"cursor-selected-big",nw_resize_big:"cursor-nw-resize-big",n_resize_big:"cursor-n-resize-big",ne_resize_big:"cursor-ne-resize-big",w_resize_big:"cursor-w-resize-big",sw_resize_big:"cursor-sw-resize-big",s_resize_big:"cursor-s-resize-big",se_resize_big:"cursor-se-resize-big",e_resize_big:"cursor-e-resize-big",col_resize_big:"cursor-col-resize-big",row_resize_big:"cursor-row-resize-big",not_allowed:"cursor-not-allowed",footnote_placeholder:"cursor-footnote-placeholder"}},554:function(e,t,n){"use strict";function i(e){this.observers.push(e)}function o(e){var t=this.observers.findIndex((function(t){return t===e}));t<0||this.observers.splice(t,1)}function a(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var a=[];this.observers.forEach((function(n){n[e]&&a.push((function(){return n[e].apply(n,[t].concat(i))}))})),a.forEach((function(e){return e()}))}n.r(t);t.default=function(e){e.observers=[],e.attachObserver=i,e.detachObserver=o,e._dispatch=a}},563:function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},5717:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(400),l=n(4105),u=n(908),c=n(310),h=n(410),d=n(1032),p=n(309),f=n(626),g=n(411),v=n(2292),m=n(1291),_=n(336),y=n(1251),b=n(7161);var T=function(){function e(t){var n=t.range,i=t.anchor,a=t.subDocType,r=t.shapeTreeType,s=t.viewPage,l=t.line,u=t.raw_embed_shape;o()(this,e),this.mixin_ITRange_init(n.begin,n.end),this.anchor=i,this.isEmbedShape=!0,this.wrap_mode=y.a,this.viewPage=s,this.parent=null,this.outer=l instanceof m.a?l.parent:l,u?this._initFromRawData(u):this._initFromOuter(i,r,a)}return r()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITRange",base:c.ITRange,methodName:"init"},{baseName:"DOCTopShape",base:b.a,methodName:"cleanRenderInfo"}]}}]),r()(e,[{key:"_initFromRawData",value:function(e){var t=this;if(null!=e.id&&(this.id=parseInt(e.id)),null!=e.shapeTreeType&&(this.shape_tree_type=parseInt(e.shapeTreeType)),null!=e.subDocType&&(this.subdoc_type=parseInt(e.subDocType)),null!=e.offsetx&&(this.offsetX=Object(_.Ti2Px)(parseInt(e.offsetx))),null!=e.offsety&&(this.offsetY=Object(_.Ti2Px)(parseInt(e.offsety))),this.size=l.a.initWithSize({width:Object(_.Ti2Px)(parseInt(e.w)),height:Object(_.Ti2Px)(parseInt(e.h))}),null!=e.geometry&&(this.size=s.a.initByDocRect(e.geometry).size),this.rect=s.a.initByOriginAndSize({x:0,y:0},this.size),e.hasTextbox&&e.textboxPage){if(this.has_textbox=!0,this.hostPendings=[],this.left_padding=Object(_.Ti2Px)(e.leftPadding),this.right_padding=Object(_.Ti2Px)(e.rightPadding),this.top_padding=Object(_.Ti2Px)(e.topPadding),this.bottom_padding=Object(_.Ti2Px)(e.bottomPadding),e.textboxPage&&e.textboxPage.rect){var n=e.textboxPage.rect;n.left+=e.leftPadding,n.right+=e.leftPadding,n.top+=e.topPadding;var i=!1;if(null!=e.textboxPage.textFlow)"T2B"===new v.a(parseInt(e.textboxPage.textFlow)).corX&&(i=!0);n.bottom=i?Object(_.Px2Ti)(this.size.width-(this.left_padding+this.right_padding)):Object(_.Px2Ti)(this.size.height-(this.top_padding+this.bottom_padding))}this.textbox_page=new d.d({parent:this,viewPage:this.viewPage,coorSystem:this.viewPage.coorSystem},{subdoc_type:p.Textbox,compose:this.viewPage.compose,textpage:e.textboxPage}),this.shapeData&&this.autoFitByContent()}e.childTextboxs&&this._initChildTextboxs(e.childTextboxs),this.updateInnerBoundary(),this.shapeData||(this.afterInitDrawingTool=function(){t.textbox_page&&t.autoFitByContent(),e.childTextboxs&&t._initChildTextboxs(e.childTextboxs),t.updateInnerBoundary(),delete t.afterInitDrawingTool})}},{key:"_initFromOuter",value:function(e,t,n){this.id=e.shapeId,this.shape_tree_type=t,this.subdoc_type=n,this.size=this.calcShapeSize(e),this.rect=s.a.initByOriginAndSize({x:0,y:0},this.size),this.sizeFromAnchor=l.a.initWithSize(this.size)}},{key:"initTextbox",value:function(){this._createTextbox()}},{key:"reset",value:function(e){this.anchor=e}},{key:"clone",value:function(){return Object.assign({},this)}},{key:"setShapeSize",value:function(e){this.size=e}},{key:"calcShapeSize",value:function(e){if(e.isHorizontalRule)return this._calcHoriRuleWidth(e);var t=l.a.initWithSize({width:Object(_.Ti2Px)(e.sizeHorz),height:Object(_.Ti2Px)(e.sizeVert)}),n=e.shapeData;if(n.hasArtWord&&n.textRect&&(n.isAutoSize||!n.isWrapText)){var i=s.a.initByDocRect(n.textRect),o=n.padding;t.width=i.width+Object(_.Ti2Px)(o.leftPadding+o.rightPadding),t.height=i.height+Object(_.Ti2Px)(o.topPadding+o.bottomPadding)}return t}},{key:"isView",value:function(){return!1}},{key:"isScene",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"isCoorSystem",value:function(){return!0}},{key:"generateRect",value:function(e,t,n){this.rect=this._calcRectByOffset(e);var i=function(e){for(var t=e.parent;t&&!(t instanceof d.d);)t=t.parent;return t}(n),o=i.textflow,a=o.corX,r=u.a.transvertPositionFromNode2Target(i,i.viewPage),l=i.parent.cell2page_offset;l&&(r.x+=l.x,r.y+=l.y),"T2B"==a?(r.x+=o.isReverseLine?this.rect.top:i.rect.width-this.rect.top-this.size.width,r.y+=this.rect.left):"B2T"==a?(r.x+=this.rect.top,r.y+=i.rect.height-this.rect.left-this.rect.height):(r.x+=this.rect.left,r.y+=this.rect.top),this.upper=i,this.viewRect=s.a.initByOriginAndSize(r,this.size),this.visible_rect=this.viewRect}},{key:"isContain",value:function(e){return this.anchor&&this.anchor.body?c.IT.containTest(this.anchor.body,e):c.IT.strictContainTest(this,e)}},{key:"cleanRenderInfo",value:function(){this.mixin_DOCTopShape_cleanRenderInfo()}},{key:"_calcHoriRuleWidth",value:function(e){var t=e.isHorizontalRule&&this.outer?this.outer.rect.width:Math.round(Object(_.Ti2Px)(e.sizeHorz)),n=0,i=e.horzRulePctSizeWidth;return i>0&&i<=1e3?n=i*t/1e3:((n=Math.round(Object(_.Ti2Px)(e.sizeHorz)))<=0||n>t)&&(n=t),this.horiRuleWidth=n,l.a.initWithSize({width:t,height:Math.round(Object(_.Ti2Px)(e.sizeVert))})}},{key:"_getXOffset",value:function(){if(this.anchor.isHorizontalRule&&this.horiRuleWidth){var e=this.size.width,t=0;switch(this.anchor.horzRuleAlign){case 0:break;case 1:t=(e-this.horiRuleWidth)/2;break;case 2:default:t=e-this.horiRuleWidth}return t}return 0}},{key:"_calcRectByOffset",value:function(e){return this.anchor.isHorizontalRule&&this.horiRuleWidth&&(e.x+=this._getXOffset(),this.size.width=this.horiRuleWidth),s.a.initByOriginAndSize(e,this.size)}},{key:"view",get:function(){return this.viewPage.view}},{key:"position2parent",get:function(){if(this.rect)return this.rect.origin}},{key:"offset4child",get:function(){return f.a.ZERO()}},{key:"effectExtents",get:function(){return this.anchor.effectExtents}},{key:"shapeType",get:function(){return this.anchor.shapeData.shapeType}},{key:"isTextBox",get:function(){return!!this.anchor.flags.isTextBox}},{key:"isPicture",get:function(){return!!this.anchor.shapeData.picture}},{key:"isLatexMath",get:function(){return this.anchor.shapeData.extData&&this.anchor.shapeData.extData.isLatexMath}},{key:"vertAnchor",get:function(){return this.anchor.shapeData.vertAnchor}},{key:"isBrokenImg",get:function(){return this.anchor.shapeData.extData&&this.anchor.shapeData.extData.isBrokenImg}},{key:"brokenImgOrgSrc",get:function(){return this.anchor.shapeData.extData&&this.anchor.shapeData.extData.brokenImgOrgSrc}},{key:"layoutType",get:function(){return g.DOCLayoutType.ShapeScene}},{key:"layoutName",get:function(){return"ShapeScene"}},{key:"layoutRect",get:function(){return this._layoutRect||this.rect}},{key:"layoutViewRect",get:function(){return this.viewRect}}]),e}();t.a=T;h.a.mix(T,c.ITRange,b.a)},5725:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentControlsEvent=void 0;var i=n(5),o=i.__importDefault(n(554)),a=n(698),r=i.__importStar(n(1639));function s(e,t){return(0,a.getPureTextExcludeSpecialPlaceholder)(window.APP.data,[{pos:e,len:t}])}function l(){var e=window.g_rpt,t=e.curVersion,n=e.baseVersion;return{curVersion:t,baseVersion:n,isCmdOperate:window.APP.isCmdResponse&&n>=t,isFinalVesion:t===n}}var u=function(){function e(e){this.doc=e,this.ctrlNodeChange={},this.ctrlNodeChangePro=null,this.ctrlContentChange={},this.ctrlContentChangePro=null,(0,o.default)(this),this.doc.contentControls.attachObserver(this),this.doc.attachObserver(this)}return e.prototype.clearAll=function(){this.doc.contentControls.detachObserver(this),this.doc.detachObserver(this)},e.prototype.insertControlNode=function(e,t){var n=Object.assign({},t.data&&t.data.data.private),i=n.id;this.ctrlNodeChange[i]&&"delete"===this.ctrlNodeChange[i].type?delete this.ctrlNodeChange[i]:this.ctrlNodeChange[i]={type:"insert",params:n},this.sendNodeEvent()},e.prototype.deleteControlNode=function(e,t){var n=Object.assign({},t.data&&t.data.data.private),i=n.id;this.ctrlNodeChange[i]&&"insert"===this.ctrlNodeChange[i].type?delete this.ctrlNodeChange[i]:this.ctrlNodeChange[i]={type:"delete",params:n},this.sendNodeEvent()},e.prototype.sendNodeEvent=function(){var e=this;this.ctrlNodeChangePro||(this.ctrlNodeChangePro=Promise.resolve().then((function(){for(var t in e.ctrlNodeChange){var n=e.ctrlNodeChange[t],i=n.type,o=n.params;"insert"===i?e._dispatch("handleControlInsert",o):"delete"===i&&e._dispatch("handleControlDelete",o)}e.ctrlNodeChange={},e.ctrlNodeChangePro=null})))},e.prototype.onBeforeInsertText=function(e,t){var n=this;if(l().isCmdOperate){var i=this.doc.contentControls.collect(t,0),o=i.length;if(o){var a=t>1&&this.doc.contentControls.collect(t-1,0),r=a&&a.length&&a[0];if(r&&!i.includes(r)&&r.end===t&&r.len){var u=r.pos,c=r.len,h=r.id,d=r.type;!this.ctrlContentChange[h]&&(this.ctrlContentChange[h]=[]),this.ctrlContentChange[h].push({id:h,type:d,pos:t,opType:"insertText",content:s(u,c),isTrueChange:!0})}}var p=!1;if(o>1){var f=i[0].pos;p=i.every((function(e){return e.pos===f}))}i.forEach((function(e,i){var a=e.pos,r=e.len,l=e.id,u=e.type;!n.ctrlContentChange[l]&&(n.ctrlContentChange[l]=[]),n.ctrlContentChange[l].push({id:l,type:u,pos:t,opType:"insertText",content:s(a,r),isTrueChange:!!(p?r:r&&i===o-1)})}))}},e.prototype.onBeforeDeleteText=function(e,t,n){var o=this;if(l().isCmdOperate){n instanceof Array&&(n=n.length);var a=this.doc.contentControls.collect(t,0),r=this.doc.contentControls.collect(t+n,0).filter((function(e){return e.pos!==t+n})),u=a[a.length-1],c=r[r.length-1];Array.from(new Set(i.__spreadArray(i.__spreadArray([],a,!0),r,!0))).forEach((function(e){var n=e.pos,i=e.len,a=e.id,r=e.type;!o.ctrlContentChange[a]&&(o.ctrlContentChange[a]=[]),o.ctrlContentChange[a].push({id:a,type:r,pos:t,opType:"deleteText",content:s(n,i),isTrueChange:e===u||e===c})}))}},e.prototype.onDeleteText=function(e,t){this.sendControlEvent()},e.prototype.onInsertText=function(e,t){this.sendControlEvent()},e.prototype.sendControlEvent=function(){var e=this;this.ctrlContentChangePro||(this.ctrlContentChangePro=Promise.resolve().then((function(){l().isFinalVesion&&Object.keys(e.ctrlContentChange).forEach((function(t){var n=e.doc.contentControls.findRangeByRefId(t);if(n){if(e.ctrlNodeChange[t])return;var i=e.ctrlContentChange[t],o=i.some((function(e){return e.isTrueChange}))?i[0]:null;if(!o)return;var a=n.id,l=n.type,u=n.title,c=n.tag,h=s(n.pos,n.len),d=o.content;if(d===h)return;if(l===r.CheckBox){if(!h||!d)return;var p=n.checkedSymbol;h=h.charCodeAt(0)===p,d=d.charCodeAt(0)===p}var f={id:a,type:l,title:u,tag:c,content:h,oldContent:d};e._dispatch("handleControlContentChange",f)}})),e.ctrlContentChange={},e.ctrlContentChangePro=null})))},e}();t.ContentControlsEvent=u},5735:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showErrorInfo=t.showDebugInfo=t.MessageKey=void 0;var i=n(5);function o(){return location.href.includes("shapeDebugger")}!function(e){e.ClearOldNodeBeforePainting="🎨【图片绘制】 🚮【清理】 开始清理上次绘制保留的节点",e.createNodeBeforePainting="🎨【图片绘制】 检测到图片，开始生成图片节点",e.nodeMissingWhenPainting="🎨【图片绘制】 ❌【失败】 svgNode节点丢失，可能因为本次绘制已经过期，节点已被清理",e.setSrcFailedWhenPainting="🎨【图片绘制】 ❌【失败】 设置src出错",e.discardOutdatedPainting="🎨【图片绘制】 🚮【丢弃】 丢弃过期的绘制",e.existPaintingWhenCacheIsNewest="🎨【图片绘制】 🚮【退出】 图片未过期，绘制完成",e.waitToPaintWhenCacheIsOutOfDate="🎨【图片绘制】 【等待】 图片过期，等待新图片信息",e.paintOriginalGifSuccessfully="🎨【图片绘制】 ✔【成功】 gif原图",e.paintThumbnailGifSuccessfully="🎨【图片绘制】 ✔【成功】 gif缩略图",e.paintThumbnailSuccessfully="🎨【图片绘制】 ✔【成功】 缩略图",e.paintImageSuccessfullyWithOriginalCache="🎨【图片绘制】 ✔【成功】 本地图片base64缓存",e.sourceSizeMissingWhenPainting="🎨【图片绘制】 ❌【失败】 图片资源尺寸缺失",e.requestForThumbnailInfo="📡【图片请求】 未找到缩略图信息，发起新的请求",e.requestForOriginalPictureInfo="📡【图片请求】 未找到原图信息，发起新的请求",e.shapeInfoRequestList="📡【图片请求】 【发起】 请求内核导出图片信息：",e.waitingRetryAfterFailure="📡【图片请求】 🔁【重试】 该图片请求失败，等待重试中，不会立即发起新的请求",e.updateShapeFailed="📡【图片请求】 ❌【失败】 内核导出图片信息失败",e.shapeInfoListSuccessfullyRequested="【图片请求】 ✔【成功】 拿到导出的图片信息",e.requestShapeInfoFailed="📡【图片请求】 ❌【失败】 内核导出图片失败",e.quantityOfShapeInfoNotMatch="📡【图片请求】 ❌【失败】 updateShape导出的图片信息数量不匹配, 请求：${0}，但只返回了：${1}",e.retryGetShapeInfoNow="📡【图片请求】 立即重新请求图片信息",e.requestShapeUrlSuccessfully="📡【图片请求】 ✔【成功】 拿到图片的url",e.requestFinallyFailed="📡【图片请求】 ❌【失败】 请求图片最终失败",e.requestFailedAndRetryLater="📡【图片请求】 🔁【重试】 本次请求图片失败，下次重试时间："}(t.MessageKey||(t.MessageKey={})),t.showDebugInfo=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];o()&&console.debug.apply(console,i.__spreadArray([e],t,!1))},t.showErrorInfo=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];o()&&console.error.apply(console,i.__spreadArray([e],t,!1))}},5736:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i={C:[0],af:[54],"af-ZA":[1078],am:[94],"am-ET":[1118],ar:[1],"ar-AE":[14337],"ar-BH":[15361],"ar-DZ":[5121],"ar-EG":[3073],"ar-IQ":[2049],"ar-JO":[11265],"ar-KW":[13313],"ar-LB":[12289],"ar-LY":[4097],"ar-MA":[6145],"ar-OM":[8193],"ar-QA":[16385],"ar-SA":[1025],"ar-SY":[10241],"ar-TN":[7169],"ar-YE":[9217],arn:[122],"arn-CL":[1146],as:[77],"as-IN":[1101],az:[44],"az-Cyrl":[29740],"az-Cyrl-AZ":[2092],"az-Latn":[30764],"az-Latn-AZ":[1068],ba:[109],"ba-RU":[1133],be:[35],"be-BY":[1059],bg:[2],"bg-BG":[1026],bn:[69],"bn-BD":[2117],"bn-IN":[1093],bo:[81],"bo-CN":[1105],br:[126],"br-FR":[1150],bs:[30746],"bs-Cyrl":[25626],"bs-Cyrl-BA":[8218],"bs-Latn":[26650],"bs-Latn-BA":[5146],ca:[3],"ca-ES":[1027],co:[131],"co-FR":[1155],cs:[5],"cs-CZ":[1029],cy:[82],"cy-GB":[1106],da:[6],"da-DK":[1030],de:[7],"de-AT":[3079],"de-CH":[2055],"de-DE":[1031],"de-LI":[5127],"de-LU":[4103],dsb:[31790],"dsb-DE":[2094],dv:[101],"dv-MV":[1125],el:[8],"el-GR":[1032],en:[9],"en-029":[9225],"en-AU":[3081],"en-BZ":[10249],"en-CA":[4105],"en-GB":[2057],"en-IE":[6153],"en-IN":[16393],"en-JM":[8201],"en-MY":[17417],"en-NZ":[5129],"en-PH":[13321],"en-SG":[18441],"en-TT":[11273],"en-US":[1033],"en-ZA":[7177],"en-ZW":[12297],es:[10],"es-AR":[11274],"es-BO":[16394],"es-CL":[13322],"es-CO":[9226],"es-CR":[5130],"es-DO":[7178],"es-EC":[12298],"es-ES":[3082],"es-GT":[4106],"es-HN":[18442],"es-MX":[2058],"es-NI":[19466],"es-PA":[6154],"es-PE":[10250],"es-PR":[20490],"es-PY":[15370],"es-SV":[17418],"es-US":[21514],"es-UY":[14346],"es-VE":[8202],et:[37],"et-EE":[1061],eu:[45],"eu-ES":[1069],fa:[41],"fa-IR":[1065],fi:[11],"fi-FI":[1035],fil:[100],"fil-PH":[1124],fo:[56],"fo-FO":[1080],fr:[12],"fr-BE":[2060],"fr-CA":[3084],"fr-CH":[4108],"fr-FR":[1036],"fr-LU":[5132],"fr-MC":[6156],fy:[98],"fy-NL":[1122],ga:[60],"ga-IE":[2108],gd:[145],"gd-GB":[1169],gl:[86],"gl-ES":[1110],gsw:[132],"gsw-FR":[1156],gu:[71],"gu-IN":[1095],ha:[104],"ha-Latn":[31848],"ha-Latn-NG":[1128],he:[13],"he-IL":[1037],hi:[57],"hi-IN":[1081],hr:[26],"hr-BA":[4122],"hr-HR":[1050],hsb:[46],"hsb-DE":[1070],hu:[14],"hu-HU":[1038],hy:[43],"hy-AM":[1067],id:[33],"id-ID":[1057],ig:[112],"ig-NG":[1136],ii:[120],"ii-CN":[1144],is:[15],"is-IS":[1039],it:[16],"it-CH":[2064],"it-IT":[1040],iu:[93],"iu-Cans":[30813],"iu-Cans-CA":[1117],"iu-Latn":[31837],"iu-Latn-CA":[2141],ja:[17],"ja-JP":[1041],ka:[55],"ka-GE":[1079],kk:[63],"kk-KZ":[1087],kl:[111],"kl-GL":[1135],km:[83],"km-KH":[1107],kn:[75],"kn-IN":[1099],ko:[18],"ko-KR":[1042],"ko-KP":[2066],kok:[87],"kok-IN":[1111],ky:[64],"ky-KG":[1088],lb:[110],"lb-LU":[1134],lo:[84],"lo-LA":[1108],lt:[39],"lt-LT":[1063],lv:[38],"lv-LV":[1062],mi:[129],"mi-NZ":[1153],mk:[47],"mk-MK":[1071],ml:[76],"ml-IN":[1100],mn:[80],"mn-Cyrl":[30800],"mn-MN":[1104],"mn-Mong":[31824],"mn-Mong-CN":[2128],moh:[124],"moh-CA":[1148],mr:[78],"mr-IN":[1102],ms:[62],"ms-BN":[2110],"ms-MY":[1086],mt:[58],"mt-MT":[1082],nb:[31764],"nb-NO":[1044],ne:[97],"ne-NP":[1121],nl:[19],"nl-BE":[2067],"nl-NL":[1043],nn:[30740],"nn-NO":[2068],no:[20],nso:[108],"nso-ZA":[1132],oc:[130],"oc-FR":[1154],or:[72],"or-IN":[1096],pa:[70],"pa-IN":[1094],pl:[21],"pl-PL":[1045],prs:[140],"prs-AF":[1164],ps:[99],"ps-AF":[1123],pt:[22],"pt-BR":[1046],"pt-PT":[2070],qut:[134],"qut-GT":[1158],quz:[107],"quz-BO":[1131],"quz-EC":[2155],"quz-PE":[3179],rm:[23],"rm-CH":[1047],ro:[24],"ro-RO":[1048],ru:[25],"ru-RU":[1049],rw:[135],"rw-RW":[1159],sa:[79],"sa-IN":[1103],sah:[133],"sah-RU":[1157],se:[59],"se-FI":[3131],"se-NO":[1083],"se-SE":[2107],si:[91],"si-LK":[1115],sk:[27],"sk-SK":[1051],sl:[36],"sl-SI":[1060],sma:[30779],"sma-NO":[6203],"sma-SE":[7227],smj:[31803],"smj-NO":[4155],"smj-SE":[5179],smn:[28731],"smn-FI":[9275],sms:[29755],"sms-FI":[8251],sq:[28],"sq-AL":[1052],sr:[31770],"sr-Cyrl":[27674],"sr-Cyrl-BA":[7194],"sr-Cyrl-CS":[3098],"sr-Cyrl-ME":[12314],"sr-Cyrl-RS":[10266],"sr-Latn":[28698],"sr-Latn-BA":[6170],"sr-Latn-CS":[2074],"sr-Latn-ME":[11290],"sr-Latn-RS":[9242],sv:[29],"sv-FI":[2077],"sv-SE":[1053],sw:[65],"sw-KE":[1089],syr:[90],"syr-SY":[1114],ta:[73],"ta-IN":[1097],te:[74],"te-IN":[1098],tg:[40],"tg-Cyrl":[31784],"tg--Cyrl-TJ":[1064],th:[30],"th-TH":[1054],tk:[66],"tk-TM":[1090],tn:[50],"tn-ZA":[1074],tr:[31],"tr-TR":[1055],tt:[68],"tt-RU":[1092],tzm:[95],"tzm-Latn":[31839],"tzm--Latn-DZ":[2143],ug:[128],"ug-CN":[1152],uk:[34],"uk-UA":[1058],ur:[32],"ur-PK":[1056],uz:[67],"uz-Cyrl":[30787],"uz-Cyrl-UZ":[2115],"uz-Latn":[31811],"uz-Latn-UZ":[1091],vi:[42],"vi-VN":[1066],wo:[136],"wo-SN":[1160],xh:[52],"xh-ZA":[1076],yo:[106],"yo-NG":[1130],zh:[30724],"zh-CN":[2052],"zh-Hans":[4],"zh-Hant":[31748],"zh-HK":[3076],"zh-MO":[5124],"zh-SG":[4100],"zh-TW":[1028],zu:[53],"zu-ZA":[1077]},o=function(e){return(i[e]||[])[0]||i.C[0]}},5737:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i=window.location.search.toLowerCase().indexOf("performance_log")>=0||window.parent!==window&&window._parent.location.search.toLowerCase().indexOf("performance_log")>=0;function o(e,t,n){var i=e+" "+t+" "+(performance.now()-n);console.info(i)}},5738:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(7206);function o(e,t){var n=null,o=!0;switch(t){case i.e:"ja-JP"===e?n="．":0===e.indexOf("zh")?"zh-CN"===e?(n="．",o=!1):n="‧":n="˙";break;case i.b:n="zh-TW"===e||"zh-HK"===e||"zh-MO"===e||"ko-KR"===e?"。":"、";break;case i.a:n=0===e.indexOf("zh")&&"zh-CN"!==e?"。":"˚";break;case i.d:n="￠",o=!1}return{renderText:n,renderAbove:o}}},5739:function(e,t,n){"use strict";var i,o=n(1),a=n.n(o),r=n(2),s=n.n(r),l=n(1145),u={"宋体":{ascent:220,descent:36,height:294,emsize:256},SimSun:{ascent:220,descent:36,height:294,emsize:256},"Times New Roman":{ascent:1825,descent:443,height:2355,emsize:2048},"仿宋_GB2312":{ascent:220,descent:36,height:294,emsize:256},BatangChe:{ascent:879,descent:145,height:1117,emsize:1024},"楷体_GB2312":{ascent:220,descent:36,height:294,emsize:256},"文星标宋":{ascent:820,descent:204,height:1177,emsize:1024}},c={"仿宋":{missGlyphs:new Set([160]),fallbackFont:"Arial",isCJK:!1}},h=10,d="",p=(i=void 0,function(e){return e&&(i=e),i}),f=void 0,g=function(){function e(){if(a()(this,e),p())return p();this.initCalcHeightDom(),p(this)}return s()(e,[{key:"measureChars",value:function(e,t,n,i,o){var a=e.fontArg,r=1===t.len?o.getCharCode(n[i]):0;t.metrics=this.calculateHeight(e,"M",a,r)}},{key:"initCalcHeightDom",value:function(){f?this.ruler=f:(f=this.ruler=document.createElement("div"),this.ruler.className="ruler",this.caliper=document.createElement("span"),this.vernier=document.createElement("div"),this.ruler.setAttribute("style","position: fixed;top: 0;left: 0;background: grey;display: block;width: auto;height: auto;text-align: center;z-index: -99;opacity: 0;white-space: nowrap;"),this.vernier.setAttribute("style","display: inline-block; width: 15px; height: 1px; background: red;"),this.ruler.appendChild(this.caliper),this.ruler.appendChild(this.vernier),document.body.appendChild(this.ruler))}},{key:"parseFontFace",value:function(e){var t={};return t.family=e.fontFamily,t.size=e.fontSize,null!=e.fontWeight&&""!=e.fontWeight?t.bold=!0:t.bold=!1,null!=e.fontStyle&&""!=e.fontStyle?t.italic=!0:t.italic=!1,t}},{key:"calculateHeight",value:function(e,t,n,i){var o=t,a=window.APP.fontServer;a.preLoadSystemFont(n.fontFamily);var r=this.parseFontFace(n);r.family=this.checkGlyphIndexIsValid(e,r.family,i);var s=a.getFontHeight(r,e);if(!s){var c={};"\r"!==o&&"\n"!==o||(o=" ");try{var h=n.fontFamily;a.isFontNeedReplace2FallBackFont(h)?h=a.docFontFallBack.getSystemOnLoadFontName(h):a.isFontNeedReplace2EnglishFontName(h)?h=l.a.getPureFontName(h):a.isFontNeedReplace2SpecialSoveFontName(h)&&(h=a.docSystemFontFallBack.getSpecialSystemOnLoadFontName(h)),(c=u[n.fontFamily])||(c=this.getMetrics(a.getFontNameForRender(h),o),this.isMetricsValid(c)||d||(d=h,this.retryMeasure()))}finally{}a.addFontHeightMetrics(r,c),s=c}return s=this.adjustHeight(r.size,e,s)}},{key:"getMetrics",value:function(e,t){var n={};this.caliper.innerText=t,this.caliper.setAttribute("style","font-family: "+e+"; font-size: 256px; line-height: normal;"),this.vernier.style.verticalAlign="baseline",n.ascent=this.vernier.offsetTop-this.caliper.offsetTop,this.vernier.style.verticalAlign="bottom";var i=this.vernier.offsetTop-this.caliper.offsetTop-this.caliper.offsetHeight;return n.height=this.vernier.offsetTop-this.caliper.offsetTop-i,n.descent=n.height-n.ascent,n.emsize=256,n}},{key:"adjustHeight",value:function(e,t,n){var i=n.ascent,o=n.height,a=n.descent,r=n.emsize||1,s=t.isCJKFont||!1,l=0,u=0;s?(l=.15*(i+a),o=2*(l=Math.round(l))+i+a,u=l):u=o-i-a;var c=t.vertAlignMode,h=e*i/r,d=e*a/r;return{ascent:i=e*("alphabetic"==c||0==c||4==c?u+i:"top"==c||1==c?u:"middle"==c||2==c?.5*o:"bottom"==c||3==c?s?o-.25*a-l:o-.5*a:u+i)/r,height:o=e*o/r,descent:a=o-i,measureAscent:h,measureDescent:d,external:u*e/r,fontSize:e}}},{key:"isMetricsValid",value:function(e){return e.height>0}},{key:"retryMeasure",value:function(){var e=this;setTimeout((function(){h>0&&(h--,e.getMetrics(d,"m").height?(window.APP.fontServer.clearInvalidFontHeightMetics(),window.APP.fontServer._onFontUpdate(window.APP.data.doc.concernRanges),window.APP.workspace.commentRenderHandler.refresh()):e.retryMeasure())}),1500)}},{key:"checkGlyphIndexIsValid",value:function(e,t,n){if(0===n)return t;var i=c[t];return i&&i.missGlyphs.has(n)?(e.isCJKFont=void 0!==i.isCJK?i.isCJK:e.isCJKFont,i.fallbackFont||t):t}}]),e}();t.a=g},5740:function(e,t,n){"use strict";n.d(t,"m",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"B",(function(){return a})),n.d(t,"n",(function(){return r})),n.d(t,"o",(function(){return s})),n.d(t,"s",(function(){return l})),n.d(t,"v",(function(){return u})),n.d(t,"J",(function(){return c})),n.d(t,"w",(function(){return h})),n.d(t,"z",(function(){return d})),n.d(t,"r",(function(){return p})),n.d(t,"e",(function(){return f})),n.d(t,"u",(function(){return g})),n.d(t,"i",(function(){return v})),n.d(t,"p",(function(){return m})),n.d(t,"g",(function(){return _})),n.d(t,"a",(function(){return y})),n.d(t,"x",(function(){return b})),n.d(t,"t",(function(){return T})),n.d(t,"F",(function(){return C})),n.d(t,"l",(function(){return k})),n.d(t,"E",(function(){return w})),n.d(t,"b",(function(){return S})),n.d(t,"I",(function(){return P})),n.d(t,"q",(function(){return I})),n.d(t,"d",(function(){return E})),n.d(t,"C",(function(){return O})),n.d(t,"y",(function(){return x})),n.d(t,"D",(function(){return R})),n.d(t,"A",(function(){return N})),n.d(t,"k",(function(){return A})),n.d(t,"h",(function(){return D})),n.d(t,"j",(function(){return M})),n.d(t,"f",(function(){return L})),n.d(t,"G",(function(){return F})),n.d(t,"H",(function(){return B}));var i=16,o=32,a=64,r=128,s=256,l=512,u=1024,c=2048,h=4096,d=8192,p=16384,f=32768,g=65536,v=1<<17,m=1<<18,_=1<<19,y=1<<20,b=1<<21,T=1<<22,C=1<<23,k=1<<24,w=1<<25,S=1<<26,P=1<<27,I=1<<28,E=1<<29,O=1<<30,x=1<<31,R=1,N=2,A=4,D=8,M=16,L=32,F=64,B=128},5741:function(e,t,n){"use strict";n.d(t,"c",(function(){return I})),n.d(t,"a",(function(){return E})),n.d(t,"b",(function(){return O})),n.d(t,"d",(function(){return x})),n.d(t,"e",(function(){return R}));var i=n(145),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(22),c=n.n(u),h=n(23),d=n.n(h),p=n(310),f=n(2010),g=n(3332),v=n(309),m=n(4969),_=n(4810),y=n(4968),b=n(3976),T=n(1475),C=n(4106),k=n(3331),w=function(e){function t(e,n,i){r()(this,t);var o=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.note=e,o.doc=i,o.text=n,o}return d()(t,e),l()(t,[{key:"getTextSize",value:function(){return this.text.length}},{key:"getText",value:function(e,t){return this.text.substr(e,t)}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.IT.Include,n=this.note.pos;this.note.isCustom&&++n;var i=this.doc.getDataLogic("final").getChpx(n,t);if(!i.good)return null;var o=f.b.make(!0,i.pos,i.len,i.prop.duplicate());return o.pos=0,o}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.IT.Include,n=this.note.pos,i=this.doc.getDataLogic("final").getPapx(n,t);if(!i.good)return null;var o=f.b.make(!0,i.pos,i.len,i.prop.duplicate());return o.pos=0,o}},{key:"convertGcp2Cp",value:function(e){return 0}},{key:"getGcpRange",value:function(){return{pos:this.note.pos,len:this.note.len}}},{key:"clone",value:function(){return new t(this.note,this.text,this.doc)}},{key:"textPartType",get:function(){return m.b.FootnoteEndnote}}]),t}(m.a),S=function(e){function t(e,n,i,o){r()(this,t);var a=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.line=e,a.doc=o,a.text=i,a.posOffset=n,a}return d()(t,e),l()(t,[{key:"getTextSize",value:function(){return this.text.length}},{key:"getText",value:function(e,t){return this.text.substr(e,t)}},{key:"getChpx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.IT.Include,n=this.line.range.pos+this.posOffset,i=this.doc.getDataLogic("final").getChpx(n,t);if(!i.good)return null;var o=f.b.make(!0,i.pos,i.len,i.prop.duplicate());return o.pos=0,o}},{key:"getPapx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.IT.Include,n=this.line.range.pos+this.posOffset,i=this.doc.getDataLogic("final").getPapx(n,t);if(!i.good)return null;var o=f.b.make(!0,i.pos,i.len,i.prop.duplicate());return o.pos=0,o}},{key:"convertGcp2Cp",value:function(e){return 0}},{key:"getGcpRange",value:function(){return{pos:this.line.range.pos+this.posOffset,len:1}}},{key:"clone",value:function(){return new t(this.line,this.posOffset,this.text,this.doc)}},{key:"textPartType",get:function(){return m.b.FootnoteEndnote}}]),t}(m.a),P=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return d()(t,e),l()(t,[{key:"initZone",value:function(e,n,i){o()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initZone",this).call(this,e,n,i);var a=this.getTextPart(n);i.typoRange.data=new _.a(n.dataStatus.data.doc,a),i.partRangePos=0,i.textPart=a}},{key:"updateZone",value:function(e,t){var n=e.zones[e.zones.length-1],i=new b.a(t.dataStatus.data,n.typoRange.data),o=t.updatingZoneStatus||{};return C.a.initZone(o,e,t,i),C.a.processZoneNoBreak(n,o),o.zoneExceed?(e.zoneExceed=!0,e.hasBrokenZone=!0,T.a.LineEnd):(C.a.endZone(n,o),T.a.Pass)}}]),t}(k.a),I=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return d()(t,e),l()(t,[{key:"mateOf",value:function(e,t){var n=t.thisGlyphIterator&&t.thisGlyphIterator.glyphGroup;return n&&n.isFootnote()&&!n.isRevisionHidden()}},{key:"makeZone",value:function(e){return new y.b({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"getTextPart",value:function(e){var t=e.dataStatus,n=t.data.doc,i=n.footnotes.getNote(t.pos),o=Object(g.f)(i,!0,e.pack.viewPage,n);return new w(i,o,n)}}]),t}(P),E=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return d()(t,e),l()(t,[{key:"mateOf",value:function(e,t){var n=t.thisGlyphIterator&&t.thisGlyphIterator.glyphGroup;return n&&n.isEndnote()&&!n.isRevisionHidden()}},{key:"makeZone",value:function(e){return new y.a({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"getTextPart",value:function(e){var t=e.dataStatus,n=t.data.doc,i=n.endnotes.getNote(t.pos),o=Object(g.f)(i,!1,e.pack.viewPage,n);return new w(i,o,n)}}]),t}(P),O=function(e){function t(){return r()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return d()(t,e),l()(t,[{key:"mateOf",value:function(e,t){var n=t.thisGlyphIterator&&t.thisGlyphIterator.glyphGroup,i=t.dataStatus,o=i.data.doc.getSubDocType(i.pos),a=o===v.Footnote||o===v.Endnote;return n&&n.isFootEndNotePlaceholder()&&a&&!n.isRevisionHidden()}},{key:"makeZone",value:function(e){var t=new y.c({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem});return this.line=e,t}},{key:"getTextPart",value:function(e){var t=e.dataStatus,n=t.data.doc,i=t.pos,o=n.getSubDocType(t.pos)===v.Footnote,a=o?n.footnoteBodys.getRefByPos(i):n.endnoteBodys.getRefByPos(i);if(a){var r=this.line,s=Object(g.f)(a,o,r.viewPage,n);return new S(r,i-r.range.pos,s,n)}return null}}]),t}(P),x=function(e,t,n,i){var o=i.parent,a=i.viewPage,r=i.coorSystem,s=n?e.footnotes.getNote(t):e.endnotes.getNote(t);if(s.pos!==t)return null;var l=Object(g.f)(s,n,a,e),u=new w(s,l,e),c=n?new y.b({parent:o,viewPage:a,coorSystem:r}):new y.a({parent:o,viewPage:a,coorSystem:r});return c.typoRange={pos:0,len:u.getTextSize(),data:new _.a(e,u)},c.textPart=u,c.partRangePos=0,c.rtlText=e.getDataLogic("final").getChpx(t).prop.getPropVal("right_to_left_text"),c},R=function(e,t,n){var i=n.parent,o=n.viewPage,a=n.coorSystem,r=e.getSubDocType(t)===v.Footnote,s=r?e.footnoteBodys.getRefByPos(t):e.endnoteBodys.getRefByPos(t);if(s){var l=Object(g.f)(s,r,o,e),u=new S(i,t-i.range.pos,l,e),c=new y.c({parent:i,viewPage:o,coorSystem:a});return c.typoRange={pos:0,len:u.getTextSize(),data:new _.a(e,u)},c.textPart=u,c.partRangePos=0,c.rtlText=e.getDataLogic("final").getChpx(t).prop.getPropVal("right_to_left_text"),c}return null}},5742:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"g",(function(){return u}));var i=0,o=1,a=2,r=3,s=4,l=5;function u(e,t,n){return t?e?s:l:n?e?i:a:e?o:r}},5743:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return s}));var i=0,o=1,a=2,r=3,s=4},5744:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return u})),n.d(t,"h",(function(){return c})),n.d(t,"i",(function(){return h})),n.d(t,"j",(function(){return d})),n.d(t,"k",(function(){return p})),n.d(t,"m",(function(){return f})),n.d(t,"n",(function(){return g})),n.d(t,"p",(function(){return v})),n.d(t,"r",(function(){return m})),n.d(t,"q",(function(){return _})),n.d(t,"s",(function(){return y})),n.d(t,"t",(function(){return b})),n.d(t,"u",(function(){return T})),n.d(t,"v",(function(){return C})),n.d(t,"o",(function(){return k})),n.d(t,"l",(function(){return w}));var i=1,o=2,a=3,r=4,s=5,l=6,u=7,c=8,h=9,d=10,p=11,f=12,g=13,v=14,m=15,_=16,y=17,b=18,T=19,C=20,k=21,w=22},5745:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(1032),d=n(1591),p=n(2502),f=n(7213),g=n(3082),v=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.compose,u=n.textpage,c=n.pageOffsetFromServer;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r},{compose:s,textpage:u,pageOffsetFromServer:c}))}return c()(t,e),r()(t,[{key:"getPageNumStyle",value:function(){for(var e=this.parent,t=e.layers.topCards,n=e.view.data.doc,i=function(e,t){if(!t.has_textbox)return!1;var n=t.textbox_page.range;return e.fields.getFields({begin:n.pos,end:n.pos+n.len}).find((function(e){return"PAGE"==e._node.type}))},o=0;o<t.length;++o){var a=t[o];if(!(a.begin>=this.range.pos+this.range.len||a.begin<this.range.pos)&&i(n,a))return this._parsePageNum(n,e,a)}return null}},{key:"_parsePageNum",value:function(e,t,n){var i={};return i.pageNumStyle=this._parsePageNumStyle(e,t,n),i.pageNumPos=this._parsePageNumPos(n),i}},{key:"_getSurroundStr",value:function(e,t,n){for(var i=e.getDataLogic("final"),o=n.begin,a=n.end,r=t.begin-1,s=t.end,l=void 0,u=void 0;r>=o;){var c=i.getText(r,1);if(" "!==c){l=c;break}--r}for(;s<a;){var h=i.getText(s,1);if(" "!==h){u=h;break}++s}return{leftStr:l,rigthStr:u}}},{key:"_surroundByOrderStr",value:function(e,t,n){var i=this._getSurroundStr(e,t,n),o=i.leftStr,a=i.rigthStr;return"第"===o&&"页"===a}},{key:"_parsePageNumStyle",value:function(e,t,n){for(var i=void 0,o=n.textbox_page.lines[0],a=o.zones,r=t.section,s=o.range,l=void 0,u=void 0,c=0;c<a.length;++c){var h=a[c];h.type==d.b.HFPageNumField&&(l=h),h.type==d.b.HFPageCountField&&(u=h)}var f=r.getPageNumFormat(),v=!1;if(l&&(v=this._surroundByOrderStr(e,l.textPart.rawField,s)),l&&!u)if(v)switch(f){case p.b:i=g.d.ArabicNumChnOrder;break;case p.ab:case p.i:i=g.d.ChnNumChnOrder;break;default:console.log("页码样式尚未支持，nfc: ",f)}else switch(f){case p.b:var m=this._getSurroundStr(e,l.textPart.rawField,s),_=m.leftStr,y=m.rigthStr;_||y?"—"===_&&"—"===y&&(i=g.d.LineArabic):i=g.d.PureArabic;break;case p.db:i=g.d.UCRoman;break;case p.R:i=g.d.DashArabic;break;case p.i:i=g.d.ChnDbNum1;break;case p.r:i=g.d.DbChar;break;case p.y:i=g.d.GB3;break;case p.O:i=g.d.LCRoman;break;case p.cb:i=g.d.UCLetter;break;case p.N:i=g.d.LCLetter;break;case p.gb:i=g.d.Zodiac1;break;case p.hb:i=g.d.Zodiac2;break;case p.u:i=g.d.DbNum3;break;case p.o:i=g.d.DAiueo;break;case p.q:i=g.d.DIroha;break;case p.S:i=g.d.Ordinal;break;case p.g:i=g.d.Cardtext;break;case p.T:i=g.d.Ordtext;break;case p.j:i=g.d.ChnDbNum2;break;default:console.log("页码样式尚未支持，nfc: ",f)}else if(l&&u)switch(f){case p.b:i=v?g.d.ArabicNumChnOrder2:g.d.PureArabic;break;case p.ab:case p.i:i=g.d.ChnNumChnOrder2;break;default:console.log("页码样式尚未支持，nfc: ",f)}return i}},{key:"_parsePageNumPos",value:function(e){var t=void 0,n=e.anchor;switch(n.horzAlign){case f.d:t=g.c.Left;break;case f.b:t=g.c.Center;break;case f.f:t=g.c.Right;break;case f.c:t=g.c.Inside;break;case f.e:t=g.c.OutSide;break;default:console.log("页码位置尚未支持，align: ",n.horzAlign)}return t}}]),t}(h.d),m=function(){function e(t,n){o()(this,e),this.section=t,this.pageNum=n}return r()(e,[{key:"eq",value:function(e,t){return this.section===e&&this.pageNum===t}}]),e}(),_=function(){function e(){o()(this,e),this.pageMap=new Map}return r()(e,[{key:"getDecorativePage",value:function(e){var t=e.section,n=e.pageNum,i=void 0;return this.pageMap&&this.pageMap.forEach((function(e,o){o.eq(t,n)&&(i=e)})),i}},{key:"cacheDecorativePage",value:function(e,t){var n=e.section,i=e.pageNum,o=new m(n,i);this.pageMap.set(o,t)}},{key:"clearCache",value:function(e){var t=this,n=e.section,i=e.pageNum;this.pageMap&&this.pageMap.forEach((function(e,o){o.eq(n,i)&&t.pageMap.delete(o)}))}}]),e}();t.b=_},5746:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(805),l=function(){function e(t){o()(this,e),this.container=t,this._style={}}return r()(e,[{key:"reset",value:function(){Object(s.assignStyle)(this._element,this._style,{left:"-100px",top:"-9999px"})}},{key:"setIndex",value:function(e){Object(s.assignStyle)(this._element,this._style,{"z-index":e})}},{key:"isTarget",value:function(e){return e===this._element}},{key:"addEventListener",value:function(e,t){this._element.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._element.removeEventListener(e,t)}},{key:"remove",value:function(){this.container.removeChild(this._element)}}]),e}();t.a=l},5747:function(e,t,n){"use strict";n.d(t,"b",(function(){return x}));var i=n(30),o=n.n(i),a=n(13),r=n.n(a),s=n(8),l=n.n(s),u=n(144),c=n.n(u),h=n(1),d=n.n(h),p=n(2),f=n.n(p),g=n(908),v=n(1291),m=n(1807),_=n(4978),y=n(3490),b=n(626),T=n(2011),C=n(4979),k=n(411),w=n(805),S=n(3863),P=n(1032),I=n(6125);function E(e,t){for(var n=t.x,i=t.widths,o=0,a=e-t.beginOffset;o<a&&o<i.length;++o)n+=i[o];return n}function O(e){for(var t=e.parent;t&&!(t instanceof S.a);)t=t.parent;return t}function x(e){for(var t=e.parent;t&&!(t instanceof P.d);)t=t.parent;return t}var R=function(){function e(){d()(this,e)}return f()(e,null,[{key:"_getLineInTypoinfo",value:function(e,t){var n=e.view,i=e instanceof v.a?e.parent.parent:e.parent,o=e.viewPage,a=i.lines,r=Object(w.bSearchUpperBound)(a,0,a.length,e,(function(e,t,n){return t[e].range.pos>=n.range.pos}));if(~r){if(t?r++:r--,a[r])return a[r];var s=o.mainpages||[o.page];if(i instanceof P.a)if(t){if(i.nextPack&&i.nextPack.lines)return i.nextPack.lines[0]}else if(i.prevPack&&i.prevPack.lines)return i.nextPack.lines[i.prevPack.lines.length-1];var l=s.length<=1?0:Object(w.bSearchUpperBound)(s,0,s.length,i,(function(e,t,n){return t[e].range.pos>=n.range.pos}));if(~l){if(t?(l++,r=0):r=s[--l]&&s[l].lines.length-1,s[l])return s[l].lines[r];var u=n.layout_pages,c=u.length<=1?0:Object(w.bSearchUpperBound)(u,0,u.length,o,(function(e,t,n){return t[e].layout_index>=n.layout_index}));if(~c&&(t?(!u[++c]||u[c].mainpages&&u[c].mainpages.length||c++,l=0,r=0):(!u[--c]||u[c].mainpages&&u[c].mainpages.length||c--,l=(s=u[c]&&(u[c].mainpages||[u[c].page]))&&s.length-1,r=s&&s[l].lines.length-1),u[c])){var h=(s=u[c].mainpages||[u[c].page])[l].lines[r],d=null;return h instanceof T.a&&h.range.begin<=e.range.begin&&h.range.end>=e.range.end&&h.tablecells.some((function(t){if(t.diagCell)return t.diagCell.pages.some((function(t){return!!(d=t.lines.find((function(t){return t.range.begin===e.range.end})))})),d;var n=t.cell_page;return!!n&&(d=n.lines.find((function(t){return t.range.begin===e.range.end})))})),d||h}}}}},{key:"_splitRectIntoPoints",value:function(e){var t=e.left,n=e.right,i=e.top,o=e.bottom;return[{x:t-=.5,y:i-=.5},{x:n+=.5,y:i},{x:n,y:o+=.5},{x:t,y:o}]}},{key:"formatInnerRect",value:function(t,n){if(t){var i=t.length;if(i<2)return e._collectPointsFromRects(t);for(var o=1,a=n?t[0].left:Number.MAX_SAFE_INTEGER,r=n?Number.MIN_SAFE_INTEGER:t[0].right;o<i;++o){var s=t[o].left,l=t[o].right;a=s<a?s:a,r=l>r?l:r}for(o=0;o<i;++o)switch(o){case 0:n?t[o].minLeft=a:t[o].right=r;break;case i-1:n?t[o].right=r:t[o].left=a;break;default:t[o].left=a,t[o].right=r}var u=e._collectPointsFromRects(t),c=!1;return u=u.map((function(e){return e.reduce((function(t,o,a){return n?3===a?e[a-1].y<o.y?t.push({x:o.x,y:e[a-1].y}):(t[2].y=o.y,t.push(o)):a===2*i+2?t.push({x:o.x,y:e[a+1].y}):t.push(o):(c=a>1&&a<2*(i-1),a===e.length-2||a===2*i-1?t.push({x:o.x,y:e[a-1].y}):c?t.push(e[1]):t.push(o)),t}),[])}))}}},{key:"_collectPointsFromRects",value:function(t){var n=t.length;if(2===n){var i=c()(t,2),o=i[0],a=i[1];if(o.right<a.left||a.right<o.left)return[].concat(l()(e._collectPointsFromRects([o])),l()(e._collectPointsFromRects([a])))}for(var r=new Array(4*n+1),s=0;s<n;s++){var u=e._splitRectIntoPoints(t[s]);0===s&&(r[0]=u[0]),r[2*s+1]=u[1],r[2*s+2]=u[2],r[4*n-2*s-1]=u[3],r[4*n-2*s]=u[0]}return[r]}},{key:"_isRangeOverlap",value:function(e,t,n,i){return Math.max(e,n)<Math.min(t,i)}},{key:"_getMinOverLapRegion",value:function(e,t,n,i){return{begin:Math.max(e,n),end:Math.min(t,i)}}},{key:"_processTableLine",value:function(e,t){var n=e.__line,i=e.minLayoutIndex,o=e.maxLayoutIndex,a=e.options,r=e.minTextPage,s=e.maxTextPage,l=t.rect,u=n.viewPage.outer_rect,c=t.innerRect,h=a.innerPadding||0,d=g.a.getPosition2view(n),p=d.x,f=d.y,v=n.rect.right-n.rect.left,m=n.rect.bottom-n.rect.top,_=p,y=_+v,b=f,T=f+m,C=n.viewPage.layout_index;t.minLayoutIndex=Math.min(i,C),t.maxLayoutIndex=Math.max(o,C),l.left=_+u.left,l.right=y+u.left,l.top=b+u.top,l.bottom=T+u.top,l.size={width:v,height:m},l.pageIndex=C,c.left=_-h,c.right=y+h,c.top=b-h,c.bottom=T+h,c.size={width:v,height:m},t.layoutIndex=C,t.result=!0;var k=O(n);t.belongingTextPage=k,t.minLayoutIndex=Math.min(i,C),t.maxLayoutIndex=Math.max(o,C),t.minTextPage=r&&r.range.pos<k.range.pos?r:k,t.maxTextPage=s&&s.range.pos>k.range.pos?s:k}},{key:"_processLine",value:function(t,n){var i=t.__line,o=t._line,a=t.options,r=t.minLayoutIndex,s=t.maxLayoutIndex,u=t.beginOffset,c=t.endOffset,h=t.bidi,d=t.minTextPage,p=t.maxTextPage,f=n.rect,v=n.innerRect,m=a.innerPadding||0,_=i.glyphGroupInfos,y=o.rect.bottom-o.rect.top,C=window.APP.isPCMode(),k=i.viewPage.outer_rect,w=i.rect.left,S=o.viewPage.layout_index,P=C?g.a.getPosition2view(o):g.a.transvertPositionFromNode2Target(i,i.viewPage),I=P.x,x=P.y,R=I-w,N=R,A=Number.MAX_SAFE_INTEGER,D=Number.MIN_SAFE_INTEGER,M=R+k.left,L=M,F=A,B=D,H=!1,G=Number.MAX_SAFE_INTEGER,W=Number.MIN_SAFE_INTEGER;_||(i.composeProcess(!1,b.a.add(i.position2parent,i.offset4child)),_=i.glyphGroupInfos);var j=O(i);if(n.belongingTextPage=j,n.minLayoutIndex=Math.min(r,S),n.maxLayoutIndex=Math.max(s,S),n.minTextPage=d&&d.range.pos<j.range.pos?d:j,n.maxTextPage=p&&p.range.pos>j.range.pos?p:j,o.auto_num_pos&&o.auto_num){var U=window.APP.formatContentController.getInnerMostControl(o.auto_num.gcp);if(U&&(U.isRepeatSec||U.isRichText&&o.range.len<U.len)){var V=o.auto_num_pos,Y=V.x,z=V.y,K=o.auto_num.offset;_=[{x:Y,y:z,beginOffset:0,endOffset:1,widths:[K],widthSum:K,metrics:o.auto_num}].concat(l()(_))}}for(var Z=0,X=_.length;Z<X;++Z){var q=_[Z];if(e._isRangeOverlap(u,c,q.beginOffset,q.endOffset)){var J=e._getMinOverLapRegion(u,c,q.beginOffset,q.endOffset),Q=E(J.begin,q),$=E(J.end,q);G=Math.min(Q,G),W=Math.max($,W);var ee=q.metrics,te=x+(void 0===i.baseline?0:i.baseline-ee.ascent),ne=te+ee.height,ie=k.top+te,oe=k.top+ne;if(F=Math.min(F,ie),B=Math.max(B,oe),A=Math.min(A,te),D=Math.max(D,ne),H=!0,q.endOffset>=c)break}}R+=G,M+=G,N+=W,L+=W,o instanceof T.a&&(N=L=I-w+o.rect.right);var ae=(B-F)*a.paddingFactor;if(a.preventZeroWidth&&R===N&&(N+=ae,L+=ae),R!==N&&(M-=m,L+=m,F-=m,B+=m),a.restrictBorderContainSelection){A>x&&(F-=A-x,A=x);var re=x+y;Math.round(D)<=Math.round(re)&&(B+=re-D,D=re)}R!==N&&(A-=m,D+=m,R-=m,N+=m),f.left=Math.max(M,0),f.minLeft=0,f.right=Math.min(L,k.left+k.size.width-1),f.maxRight=k.left+k.size.width-1,f.isBidi=h,f.top=F,f.bottom=B,f.size={width:f.right-f.left,height:B-F},f.pageIndex=i.viewPage.layout_index,v.left=Math.max(R,0),v.minLeft=0,v.right=Math.min(N,k.size.width-1),v.maxRight=k.size.width-1,v.isBidi=h,v.top=A,v.bottom=D,v.size={width:v.right-v.left,height:D-A},n.layoutIndex=S,n.result=H}},{key:"_collectInRange",value:function(t){var n=t.range,i=t.line,o=t.options,a=t.ctrl,r=i,s=r,u=n.pos,c=n.len,h=s instanceof v.a?s.parent.parent.range:s.parent.range;if(s.isInTable&&(u<h.pos||a&&a.level===I.a||(u===h.pos||a&&a.isRepeatItem&&u-1===h.pos)&&u+c>h.pos+h.len)){var d=[],p=void 0;do{if(r instanceof T.a)break;if(p=r.parent.parent.parent,s=r=p,d.push(p),p.parent.layoutType!==k.DOCLayoutType.CellPage)break}while(s&&s.isInTable&&u<s.parent.range.pos);u>s.range.pos&&(s=r=d[d.length-2]||s)}var f=new Map,g=!1,m={begin:Number.MAX_SAFE_INTEGER,end:Number.MIN_SAFE_INTEGER},_=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER,b=null,C=null,w=!1,S=window.APP.data.doc.getDataLogic("final").getPapx(u);S&&S.prop&&S.prop.bidi&&(w=!0);do{var P=void 0;if(s instanceof v.a?(P=s.parent.sublines,s=s.parent):P=s.sublines?s.sublines:[s],P.forEach((function(t){var i=t.range,a=Math.max(n.pos-i.pos,0),r=Math.min(n.pos+n.len-i.pos,i.len);if(~a&&~r){var l={rect:{},innerRect:{}};t.tablecells?e._processTableLine({__line:t,minLayoutIndex:_,maxLayoutIndex:y,options:o,minTextPage:b,maxTextPage:C},l):e._processLine({__line:t,_line:s,options:o,minLayoutIndex:_,maxLayoutIndex:y,beginOffset:a,endOffset:r,bidi:w,minTextPage:b,maxTextPage:C},l);var u=l.layoutIndex;_=l.minLayoutIndex,y=l.maxLayoutIndex,b=l.minTextPage,C=l.maxTextPage;var c=l.belongingTextPage;if(l.result){f.has(u)||f.set(u,new Map);var h=f.get(u);h.has(c)||h.set(c,{innerRects:[],rects:[]});var d=h.get(c);d.rects.push(l.rect),d.innerRects.push(l.innerRect)}}m.begin=Math.min(i.pos,m.begin),m.end=Math.max(i.pos+i.len,m.end)})),n.pos<m.begin){g=!0;var E=e._getLineInTypoinfo(s,!1);s=E!==s?E:null}else if(n.pos+n.len>m.end){g&&(g=!1,s=r);var O=e._getLineInTypoinfo(s,!0);s=O!==s?O:null}else;}while(s&&!(m.begin<=u&&m.end>=u+c));var x={},R={};return[].concat(l()(f.keys())).forEach((function(t){for(var n=f.get(t).entries(),i=n.next();!i.done;){var r=i.value,s=r[0],l=r[1],u=l.innerRects,c=l.rects,h=u.sort((function(e,t){return e.top-t.top}));x[t]=x[t]||new Map;var d=a&&(a.isDropdownList||a.isComboBox)&&t===y&&s===C;if(d){var p=h[h.length-1];if(w){var g=p.left-20;p.left=g<p.minLeft?p.minLeft:g}else{var v=p.right+20;p.right=v>p.maxRight?p.maxRight:v}}o.innerPosSpecialOutPut?x[t].set(s,e.formatInnerRect(h,w)):x[t].set(s,e._collectPointsFromRects(h));var m=c.sort((function(e,t){return e.top-t.top}));if(R[t]=R[t]||new Map,R[t].set(s,m),d&&a&&(a.isDropdownList||a.isComboBox)){var _=m[m.length-1];if(w){var b=_.left-20,T=_.size.width+20;_.left=b<_.minLeft?_.minLeft:b,_.size.width=b<_.minLeft?_.size.width:T}else{var k=_.right+20,S=_.size.width+20;_.right=k>_.maxRight?_.maxRight:k,_.size.width=k>_.maxRight?_.size.width:S}}i=n.next()}})),{rects:R,pointsMap:x,minLayoutIndex:_,maxLayoutIndex:y,minTextPage:b,maxTextPage:C}}},{key:"_collectContentBlock",value:function(t){var n=t.range,i=t.line,o=t.options,a=n.pos,s=n.len,l={},u=!1,c={begin:Number.MAX_SAFE_INTEGER,end:Number.MIN_SAFE_INTEGER},h=void 0,d=void 0;(h=d=i)instanceof v.a?d=h=h.parent:h.isInTable&&h instanceof m.a&&(d=h=h.parent.parent.parent);do{var p=h.range,f=h.viewPage.outer_rect,_=h.viewPage.layout_index,y=g.a.getPosition2view(h),b=y.x,T=y.y,C=Math.ceil(b-(h.before_indent||0)),k=Math.ceil(b+h.rect.width),w=Math.ceil(T),S=Math.ceil(w+h.rect.height),P=Math.ceil(C+f.left),I=Math.ceil(k+f.left),E=Math.ceil(w+f.top),x=Math.ceil(S+f.top);l[_]=l[_]||new Map;var R=O(h);l[_].has(R)||l[_].set(R,[]),l[_].get(R).push({left:P,right:I,top:E,bottom:x,innerLeft:C,innerRight:k,innerTop:w,innerBottom:S}),c.begin=c.begin>p.pos?p.pos:c.begin,c.end=c.end<p.pos+p.len?p.pos+p.len:c.end,a<c.begin?(u=!0,h=e._getLineInTypoinfo(h,!1)):a+s>=c.end&&(u&&(u=!1,h=d),h=e._getLineInTypoinfo(h,!0))}while(h&&!(c.begin<=a&&c.end>a+s));var N={},A={},D={left:Number.MAX_SAFE_INTEGER,right:Number.MIN_SAFE_INTEGER,top:Number.MAX_SAFE_INTEGER,bottom:Number.MIN_SAFE_INTEGER};return Object.keys(l).forEach((function(t){for(var n=l[t].entries(),i=n.next(),a=function(){var a=i.value[0],s=i.value[1],l=r()({},D),u=r()({},D);s.forEach((function(e){l.left=Math.min(l.left,e.left),l.right=Math.max(l.right,e.right),l.top=Math.min(l.top,e.top),l.bottom=Math.max(l.bottom,e.bottom),u.left=Math.min(u.left,e.innerLeft),u.right=Math.max(u.right,e.innerRight),u.top=Math.min(u.top,e.innerTop),u.bottom=Math.max(u.bottom,e.innerBottom)}));var c=o.horizontalPadding,h=o.verticalPadding;l.left-=c,l.right+=c,l.top-=h,l.bottom+=h,l.size={width:l.right-l.left,height:l.bottom-l.top},N[t]=N[t]||new Map,N[t].has(a)||N[t].set(a,[]),N[t].get(a).push(l),u.left-=c,u.right+=c,u.top-=h,u.bottom+=h,u.size=l.size,A[t]=A[t]||new Map,A[t].set(a,e._collectPointsFromRects([u])),i=n.next()};!i.done;)a()})),{rects:N,pointsMap:A}}},{key:"_hitOnDate",value:function(t,n,i,o){var a=n.pos,r=n.len,s=n.displayFormat,l=n.data,u=n.id,c=i.line,h={isDate:!0,begin:a,end:a+r,data:l,len:r,pos:a,ctrl:n,id:u},d={pos:a+1,len:Math.max(r-2,1)},p=e._collectInRange({range:d,line:c,options:{paddingFactor:.25,innerPadding:3,innerPosSpecialOutPut:!0,restrictBorderContainSelection:!0}});h.minLayoutIndex=p.minLayoutIndex,h.maxLayoutIndex=p.maxLayoutIndex,h.minTextPage=p.minTextPage,h.maxTextPage=p.maxTextPage,h.rects=p.rects,h.pointsMap=p.pointsMap,h.highlightType=C.a.FULL_BOX,h.displayFormat=s;var f=t.getText(d.pos,d.len);h.isShowTime=s&&(s.includes("H:i")||s.includes("hh:mm")),h.isShowLunar=f&&f.indexOf(_i18n("applications.writer.core.components.hit.hittest.modules.contentcontrols.lunarCalendar", "Lunar Calendar"))>-1,h.timestr=f,o.push(h)}},{key:"_hitOnRichText",value:function(t,n,i,o){var a=n.pos,s=n.len,l=n.tag,u=n.title,c=n.lockControl,h=n.lockContent,d=n.id,p=i.line,f={isRichText:!0,id:d};f.begin=a,f.end=a+s,f.len=s;var g=void 0,v=t.isEnhancedTemplate,m=t.templateType,b=Object(_.a)(m,n);if(v){g={pos:a,len:s};var T=void 0,C=void 0,k=void 0;b===y.a&&(C=(T=e._collectContentBlock({range:g,line:p,options:{horizontalPadding:28,verticalPadding:4}})).rects,k=r()({},T.pointsMap)),f.ctrl=n,f.rects=C,f.pointsMap=k}else{g={pos:a,len:s};var w=e._collectInRange({range:g,line:p,options:{paddingFactor:.15,innerPadding:3,preventZeroWidth:!0,innerPosSpecialOutPut:!0,restrictBorderContainSelection:!0},ctrl:n});f.rect=w.rects,f.pointsMap=r()({},w.pointsMap),f.ctrl=n,f.minLayoutIndex=w.minLayoutIndex,f.maxLayoutIndex=w.maxLayoutIndex,f.minTextPage=w.minTextPage,f.maxTextPage=w.maxTextPage}f.tag=l,f.title=u,f.lockControl=c,f.lockContent=h,o.push(f)}},{key:"_hitOnOhterControl",value:function(t,n,i,a){var s,l=t.doc,u=n.pos,c=n.len,h=n.tag,d=n.title,p=n.lockControl,f=n.lockContent,g=n.id,v=i.line,m=(n.isPureText?"isPureText":n.isPicture&&"isPicture")||n.isComboBox&&"isComboBox"||n.isCheckBox&&"isCheckBox"||n.isRepeatSec&&"isRepeatSec"||n.isRepeatItem&&"isRepeatItem",b=(s={},o()(s,m,!0),o()(s,"id",g),s);b.begin=u,b.end=u+c,b.len=c;var T=void 0,C=l.isEnhancedTemplate,k=l.templateType,w=Object(_.a)(k,n);if(C){T={pos:u,len:c};var S=void 0,P=void 0,I=void 0;w===y.a&&(P=(S=e._collectContentBlock({range:T,line:v,options:{horizontalPadding:28,verticalPadding:4}})).rects,I=r()({},S.pointsMap)),b.ctrl=n,b.rects=P,b.pointsMap=I}else{T={pos:u,len:c};var E=e._collectInRange({range:T,line:v,options:{paddingFactor:.15,innerPadding:3,preventZeroWidth:!0,innerPosSpecialOutPut:!0,restrictBorderContainSelection:!0},ctrl:n});b.rect=E.rects,b.pointsMap=r()({},E.pointsMap),b.ctrl=n,b.minLayoutIndex=E.minLayoutIndex,b.maxLayoutIndex=E.maxLayoutIndex,b.minTextPage=E.minTextPage,b.maxTextPage=E.maxTextPage}b.tag=h,b.title=d,b.lockControl=p,b.lockContent=f,"isCheckBox"===m&&e._hitCheckBox(t,n,i,b),a.push(b)}},{key:"_hitCheckBox",value:function(e,t,n,i){if(!t||!t.isCheckBox)return!1;try{var o=n.pos,a=n.line,r={x:o.x-e.typoinfo.viewOffset.x,y:o.y-e.typoinfo.viewOffset.y},s=a.viewPage.layout_index,l=(i.rect||i.rects)[s].entries().next().value[1][0],u=l.left,c=l.top,h=l.size;r.x>=u&&r.x<=u+h.width&&r.y>=c&&r.y<=c+h.height&&(n.isHitCheckBox=!0)}catch(e){}}},{key:"getRichText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=window.APP.data.doc.contentControls.collect(e,t);if(n.length)return n.filter((function(e){return e.isRichText}))}},{key:"hit",value:function(t,n,i,o){if(o){var a=o.position,r=n.doc.contentControls.collect(a,1,!0)||[],s=o.line&&o.line.glyphGroupInfos;if(s&&s.length&&(r=r.filter((function(e){if(e.begin<o.line.range.begin||e.begin>=o.line.range.end)return!0;var t=e.begin-o.line.range.begin,n=s.find((function(e){return e.beginOffset<=t&&t<e.endOffset}));return!n||!n.isRevisionHidden()}))),!r.length)return;r.sort((function(e,t){return e.len-t.len}));var l=o.ctrlInfos=[];r.forEach((function(t){switch(!0){case t.isDate:e._hitOnDate(n.doc,t,o,l);break;case t.isRichText||t.isDropdownList:e._hitOnRichText(n.doc,t,o,l);break;case t.isPureText||t.isPicture||t.isComboBox||t.isCheckBox||t.isRepeatSec||t.isRepeatItem:e._hitOnOhterControl(n,t,o,l)}}))}}}]),e}();t.a=R},594:function(e,t,n){"use strict";n.r(t),n.d(t,"KeyCode2Key",(function(){return o})),n.d(t,"Code2Key",(function(){return i}));var i={Backquote:"`",Backslash:"\\",Backspace:"Backspace",BracketLeft:"[",BracketRight:"]",Comma:",",Digit0:"0",Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Equal:"=",KeyA:"A",KeyB:"B",KeyC:"C",KeyD:"D",KeyE:"E",KeyF:"F",KeyG:"G",KeyH:"H",KeyI:"I",KeyJ:"J",KeyK:"K",KeyL:"L",KeyM:"M",KeyN:"N",KeyO:"O",KeyP:"P",KeyQ:"Q",KeyR:"R",KeyS:"S",KeyT:"T",KeyU:"U",KeyV:"V",KeyW:"W",KeyX:"X",KeyY:"Y",KeyZ:"Z",Minus:"-",Period:".",Quote:"'",Semicolon:";",Slash:"/",AltLeft:"Alt",AltRight:"Alt",CapsLock:"CapsLock",ContextMenu:"ContextMenu",ControlLeft:"Ctrl",ControlRight:"Ctrl",Enter:"Enter",MetaLeft:"Meta",MetaRight:"Meta",ShiftLeft:"Shift",ShiftRight:"Shift",Space:"Space",Tab:"Tab",Delete:"Delete",End:"End",Help:"Help",Home:"Home",Insert:"Insert",PageDown:"PageDown",PageUp:"PageUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",Escape:"Esc",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",Fn:"Fn",FnLock:"FnLock",PrintScreen:"PrintScreen",ScrollLock:"ScrollLock",Pause:"Pause",NumLock:"NumLock"},o={192:"`",220:"\\",8:"Backspace",219:"[",221:"]",188:",",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",48:"0",187:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",189:"-",190:".",222:"'",186:";",191:"/",18:"Alt",20:"CapsLock",93:"ContextMenu",17:"Ctrl",13:"Enter",91:"Meta",92:"Meta",16:"Shift",32:"Space",9:"Tab",46:"Delete",35:"End",36:"Home",45:"Insert",34:"PageDown",33:"PageUp",40:"ArrowDown",37:"ArrowLeft",39:"ArrowRight",38:"ArrowUp",27:"Esc",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",44:"PrintScreen",145:"ScrollLock",19:"Pause",144:"NumLock",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",107:"+",194:",",110:".",111:"/",12:"Clear",106:"*",109:"-"}},600:function(e,t,n){"use strict";n.r(t),n.d(t,"findIndex",(function(){return i.a})),n.d(t,"find",(function(){return r})),n.d(t,"each",(function(){return s.a})),n.d(t,"sortBy",(function(){return h})),n.d(t,"groupBy",(function(){return d})),n.d(t,"throttle",(function(){return p.a})),n.d(t,"debounce",(function(){return f.debounce})),n.d(t,"debounceFrame",(function(){return g})),n.d(t,"getType",(function(){return o.a})),n.d(t,"memoize",(function(){return m}));var i=n(405),o=n(289),a=n(308),r=function(e,t){if(Object(o.a)(e)!=a.a.arrayTag)throw new TypeError(a.b.ARRAY_ERROR_TEXT);var n=Object(i.a)(e,t);return n>-1?e[n]:void 0},s=n(406),l=n(8),u=n.n(l),c=function(e,t){if(e!==t){var n=void 0!==e,i=null===e,r=e==e,s=Object(o.a)(e)===a.a.symbolTag,l=void 0!==t,u=null===t,c=t==t,h=Object(o.a)(e)===a.a.symbolTag;if(!u&&!h&&!s&&e>t||s&&l&&c&&!u&&!h||i&&l&&c||!n&&c||!r)return 1;if(!i&&!s&&!h&&e<t||h&&n&&r&&!i&&!s||u&&n&&r||!l&&r||!c)return-1}return 0},h=function(e){var t=Object(o.a)(e);if(!e||t===a.a.stringTag||t===a.a.numberTag)return[];if(t===a.a.arrayTag&&e.length<=1||t===a.a.objectTag&&Object.keys(e).length<=1)return e;for(var n=Array.prototype.slice.call(arguments,1),i=-1,r=n.length,s=[];++i<r;){var l=n[i],h=Object(o.a)(l);h===a.a.stringTag||h===a.a.funcTag?s.push(l):h===a.a.arrayTag&&s.push.apply(s,u()(l))}return 0===s.length&&s.push((function(e){return e})),(e=(e=t===a.a.objectTag?Object.values(e):e).map((function(e,t){var n=s.map((function(t){return Object(o.a)(t)===a.a.funcTag?t(e):e&&void 0!==e[t]?e[t]:e}));return e&&e.value?{index:t,value:e.value,filter:n}:{index:t,value:e,filter:n}}))).sort((function(e,t){for(var n=-1,i=s.length;++n<i;){var o=c(e.filter[n],t.filter[n]);if(o)return o}return e.index-t.index})),e.map((function(e){return e.value}))},d=function(e,t){if(null==e||!t)return{};var n={};return Object(s.a)(e,(function(e){var i=void 0,r=Object(o.a)(t);if(r===a.a.stringTag?i=e[t]:r===a.a.funcTag&&(i=t(e)),void 0!==i){var s=n[i];n[i]=s?[].concat(u()(s),[e]):[e]}})),n},p=n(448),f=n(81),g=function(e,t){if(Object(o.a)(e)!=a.a.funcTag)throw new TypeError(a.b.FUNC_ERROR_TEXT);t=Number(t)||0;var n=void 0,i=void 0,r=void 0,s=void 0;function l(){n&&cancelAnimationFrame(n),performance.now()-i>=t?e.apply(r,s):n=requestAnimationFrame(l)}return function(){s=Array.prototype.slice.call(arguments),r=this,i=performance.now(),n=requestAnimationFrame(l)}};function v(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];var r=t?t.apply(this,o):o[0],s=n.cache;if(s.has(r))return s.get(r);var l=e.apply(this,o);return l&&l.then?l.then((function(e){return n.cache=s.set(r,e)||s,e})):(n.cache=s.set(r,l)||s,l)};return n.cache=new(v.Cache||Map),n}v.Cache=Map;var m=v},6006:function(e,t,n){"use strict";n.d(t,"a",(function(){return T})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return b}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(336),f=n(411),g=n(626),v=n(400),m=n(1032),_=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.note,u=n.compose,c=n.pos,h=n.pageOffsetFromServer;o()(this,t);var d=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r}));return d.compose=u,s&&d._initFromRawData(s,c,h),d}return d()(t,e),r()(t,[{key:"isCoorSystem",value:function(){return!1}},{key:"_initFromRawData",value:function(e,t,n){var i=0,o=0,a=0,r=0;if(this.rect=v.a.initByOriginAndSize({x:a,y:r},{width:o,height:i}),e.notePage){this.note_page=new m.b({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem},{compose:this.compose,notePage:e.notePage,pageOffsetFromServer:n});var s=this.note_page.textflow;"T2B"===s.corX||"B2T"===s.corX?a=t:r=t,i=this.note_page.rect.height,o=this.note_page.rect.width,this.rect.updateByOrigin(a,r),this.rect.updateBySize(o,i)}}},{key:"cleanRenderInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.note_page&&this.note_page.cleanRenderInfo(e),c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this)}},{key:"layoutType",get:function(){return f.DOCLayoutType.FootEndNote}},{key:"position2parent",get:function(){return g.a.initWithOrigin({x:this.rect.left,y:this.rect.top})}}]),t}(f.DOCLayout),y=Object(p.Ti2Px)(243),b=Object(p.Ti2Px)(2880),T=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.notes,u=n.compose,c=n.pos,h=n.info;o()(this,t);var d=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r}));return d.compose=u,d.notes=[],s&&d._initFromRawData(s,c,h),d}return d()(t,e),r()(t,[{key:"isCoorSystem",value:function(){return!1}},{key:"_initFromRawData",value:function(e,t,n){var i=this,o=void 0,a=void 0,r=void 0,s=void 0,l=this.parent,u=l.textflow,c=l.rect;this.rect=v.a.initByOriginAndSize({x:o,y:a},{height:r,width:s});var h=n.offsets;if("T2B"!==u.corX||u.isReverseLine)if("B2T"===u.corX||"T2B"===u.corX&&u.isReverseLine){var d=y;e.map((function(e){var t=h&&h[n.index++]||0,o=new _({parent:i,viewPage:i.viewPage,coorSystem:i.coorSystem},{note:e,compose:i.compose,pos:d,pageOffsetFromServer:t});i.notes.push(o),d=o.rect.right})),o=t,a=0,r=c.height,s=d}else{var p=y;e.map((function(e){var t=h&&h[n.index++]||0,o=new _({parent:i,viewPage:i.viewPage,coorSystem:i.coorSystem},{note:e,compose:i.compose,pos:p,pageOffsetFromServer:t});i.notes.push(o),p=o.rect.bottom})),o=0,a=t,s=c.width,r=p}else{for(var f=0,g=[],m=0,b=e.length;m<b;++m)g.push(h&&h[n.index++]||0);g=g.reverse();var T=0;e.reverse().map((function(e){var t=g[T++],n=new _({parent:i,viewPage:i.viewPage,coorSystem:i.coorSystem},{note:e,compose:i.compose,pos:f,pageOffsetFromServer:t});i.notes.push(n),f=n.rect.right})),f+=y,o=0,a=0,r=c.height,s=f}this.rect.updateByOrigin(o,a),this.rect.updateBySize(s,r),this.coororigin_pos2parent={x:o,y:a}}},{key:"cleanRenderInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.notes.forEach((function(t){t.cleanRenderInfo(e)})),c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this)}},{key:"layoutType",get:function(){return f.DOCLayoutType.FootEndNotes}},{key:"position2parent",get:function(){return g.a.initWithOrigin({x:this.rect.left,y:this.rect.top})}}]),t}(f.DOCLayout)},6096:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=new Map,a=function(){function e(){this.cacheMap=o}return e.prototype.add=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,n,o,a,r,s;return i.__generator(this,(function(i){switch(i.label){case 0:return this.cacheMap.has(e)?[2,this.cacheMap.get(e)]:[4,window.__WPSENV__.request({method:"GET",responseType:"blob",url:e}).end().catch((function(){var t=-1!==e.indexOf("?")?e+"&xhr-request":"?xhr-request";return window.__WPSENV__.request({method:"GET",responseType:"blob",url:t}).end()})).then((function(e){return new Promise((function(t,n){if(e.status>=400)throw new Error;var i=new FileReader;i.onload=function(){var n={format:"",base64Data:i.result,sourceSize:e.body.size};t(n),n.format=e.body.type.split("/")[1]},i.onerror=function(){n()},i.readAsDataURL(e.body)}))}))];case 1:return t=i.sent(),n=t.format,o=t.base64Data,a=t.sourceSize,[4,this.calcSize(o)];case 2:return r=i.sent(),s={format:n,size:r,base64Data:o,sourceSize:a},this.cacheMap.set(e,s),[2,s]}}))}))},e.prototype.get=function(e){return this.cacheMap.get(e)||{format:"",size:void 0,base64Data:"",sourceSize:0}},e.prototype.calcSize=function(e){return e?new Promise((function(t,n){var i=new Image;i.onload=function(){var e=i.width,n=i.height;t({width:e,height:n})},i.onerror=function(){n({url:e,reason:"load failed"}),console.warn("load image error: ",e)},i.src=e})):(console.warn("no image url to calc size"),Promise.resolve(null))},e}();t.default=a},6097:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return r}));var i=4352,o=4353,a=4354,r=4355},6098:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(6099);function o(e){switch(e){case i.e:return"\0";case i.a:return".";case i.c:return"-";case i.f:return"_";case i.d:return"·";case i.b:return String.fromCharCode(183);default:return""}}},6099:function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return l}));var i=0,o=1,a=2,r=3,s=4,l=5},6100:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jumpPosition=t.storeReadPosition=void 0;var i=n(5),o=n(14),a=n(167),r=n(7748),s=i.__importDefault(n(4967)),l=n(4967);Object.defineProperty(t,"storeReadPosition",{enumerable:!0,get:function(){return l.storeReadPosition}}),t.jumpPosition=function(){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(t){return(e=window.APP).isHistoryVersion?[2]:!a.isMobile&&e.isCommentEnabled&&(0,o.hasQuery)("commentid")?((0,r.jumpToComment)(),[2]):(window.__CONFIG__.wps.enableAutoRestorePositionOnOpen&&(0,s.default)(),[2])}))}))}},6101:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"f",(function(){return l}));var i=1,o=2,a=3,r=4,s=6,l=7},6102:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3078),l=n(324),u=0,c=1,h=2,d=3,p=function(){function e(){o()(this,e)}return r()(e,null,[{key:"calcHeight",value:function(t,n,i){return e.calcHeightMax(t,n,i)}},{key:"calcHeightMax",value:function(e,t,n){for(var i=e.parent,o=0,a=0,r=0,p=0,f=0,g=0,v=0,m=0,_=0,y=0,b=0,T=0,C=!1,k=!1,w=!1,S=!1,P=!1,I=!0,E=0,O=0,x=!1,R=!1,N=e.getPartRange(),A=N.pos,D=N.pos+N.len,M=n.makeGlyphAt(A),L=null;M.position<D;)if(M.charCode!==l.b&&M.charCode!==l.c){var F=M.glyphGroup;if(F.isHidden()||F.isRevisionHidden()||!F.isMath()&&F.isSpecHidden()&&M.charCode!==l.d&&M.charCode!==l.e||!F.isClusterStart())R&&F.unSetLineFirstCharFlag(),M.next();else{R?F.unSetLineFirstCharFlag():(F.setLineFirstCharFlag(),R=!0);var B=M.glyphGroup.metrics;if(!F.isCharBox()&&this.isWeekChar(M)){if(E=Math.max(E,B.ascent),O=Math.max(O,B.descent),k||C){M.next();continue}for(M.next();M.position<D;)if(!M.glyphGroup.isHidden()&&M.glyphGroup.isClusterStart()){if(!this.isWeekChar(M)||this.isPageBreakChar(M))break;B=M.glyphGroup.metrics,M.next()}else M.next();M.prev(),k=!0,g=Math.max(g,B.ascent),v=Math.max(v,B.descent)}else if(this.isNatureGlyph(M))I&&!F.isEmbedDrawing()&&(I=!1),!P&&F.isEmbedDrawing()&&(P=!0),S=!0,y=Math.max(y,B.ascent),b=Math.max(b,B.descent);else if(M.glyphGroup.isMath()){var H=n.data.typoinfo.mathCache.get(M.position);H&&(null===L&&(L=B.fontSize||0),S=!0,y=Math.max(y,H.baseline+.144*L),b=Math.max(b,H.height-H.baseline),x=!0,M.seek(H.end)),p=Math.max(y,B.ascent),f=Math.max(b,B.descent)}else C=!0,p=Math.max(p,B.ascent),f=Math.max(f,B.descent),T=Math.max(T,B.height);x=!0,M.next()}}else M.next();M.free();var G=k&&!C&&!S;if(x&&i.auto_num)if(w=!0,C){var W=t.vertAlignMode;"alphabetic"==W||0==W||4==W?(m=i.auto_num.ascent,_=0):"top"==W||1==W?(m=0,_=0):"middle"==W||2==W?(m=.5*i.auto_num.height,_=0):"bottom"!=W&&3!=W||(m=i.auto_num.ascent,_=i.auto_num.descent)}else m=i.auto_num.ascent,_=i.auto_num.descent;var j=u;switch(o=C?T:w?m+_:k?g+v:0,C&&0==o&&(o=E+O),j=C?d:w?S?d:h:S?t.gridMode!=s.c.Typo_GridMode_None&&t.snapToGrid?d:c:u){case d:a=Math.max(a,p),r=Math.max(r,f),a=Math.max(a,m),r=Math.max(r,_),a=Math.max(a,y),r=Math.max(r,b);break;case h:a=Math.max(a,m),r=Math.max(r,_);break;case c:a=Math.max(a,y),r=Math.max(r,b);break;case u:a=Math.max(a,g),r=Math.max(r,v)}if(k&&(c===j||h===j)&&g+v>a+r){var U=!0,V=t.lineSpacing;if(V.isHeightOrMargin&&V.bMetricOrPercent&&!V.bFixedOrMin&&(U=!1),U)c===j&&P&&I?a=g+v-r:(a=g,r=v)}return{baseHeight:o,maxCharHeight:(a=Math.max(a,p))+(r=Math.max(r,f)),maxAscent:a,maxDescent:r,allWeakChar:G,maxStrongAscent:p,maxStrongDescent:f}}},{key:"isWeekChar",value:function(e){var t=e.glyphBuff.getCharCode(e.position),n=!1;return t!=l.A&&t!=l.r&&t!=l.B&&t!=l.l&&t!=l.j&&t!=l.k&&t!=l.m&&t!=l.i&&t!=l.h||(n=!0),n}},{key:"isNatureGlyph",value:function(e){return e.glyphGroup.isEmbedDrawing()||e.charCode===l.d||e.charCode===l.e}},{key:"isPageBreakChar",value:function(e){return e.charCode===l.m||e.charCode===l.k||e.charCode===l.i}}]),e}();t.a=p},6103:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(4968),f=n(4810),g=n(4106),v=n(3976),m=n(1475),_=function(e){function t(){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return d()(t,e),r()(t,[{key:"mateOf",value:function(e,t){var n=t.dataStatus.document.fields,i=t.dataStatus.pos,o=n.getField(i);return!(!o||"PAGE"!==o.type)}},{key:"makeZone",value:function(e){return new p.e({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"initZone",value:function(e,n,i){c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initZone",this).call(this,e,n,i);var o=n.dataStatus,a=o.data.fieldManager,r=a.getField(o.pos);if(r){r.section=e.viewPage.section,a.parseField(r,e.viewPage.pageNum);var s=new f.a(o.document,r.clone());i.typoRange.data=s,i.partRangePos=0,i.textPart=r}}},{key:"updateZone",value:function(e,t){var n=e.zones[e.zones.length-1],i=new v.a(t.dataStatus.data,n.typoRange.data),o=t.updatingZoneStatus||{};return g.a.initZone(o,e,t,i),g.a.processZone(n,o),g.a.endZone(n,o),m.a.Pass}}],[{key:"mateByField",value:function(e){return e&&"PAGE"==e.type}},{key:"makeZoneByField",value:function(e,n,i,o){if(!t.mateByField(i))return null;var a=i.fieldObj;a.section=n.viewPage.section,e.fieldManager.parseField(a,n.viewPage.pageNum);var r=new f.a(e.doc,a.clone()),s=new p.e({parent:n,viewPage:n.viewPage,coorSystem:n.coorSystem});return s.typoRange={pos:o-n.range.pos,len:i.len,data:r},s.partRangePos=0,s.textPart=a,s}}]),t}(n(3331).a);t.a=_},6104:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(8),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(410),c=n(310),h=function(){function e(t){r()(this,e),this.init(t)}return l()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"ITToolkit",base:c.ITToolkit,methodName:"init"}]}}]),l()(e,[{key:"init",value:function(e){this.mixin_ITToolkit_init(c.IT.upper,c.IT.NonIntersect,!0),this.ba_hint=this.tree.makeHintAtTree(),this.size=e&&e.size||0,this.isString=e&&e.isString||!1,this.maxPieceSize=e&&e.maxPieceSize||1200,this.sugPieceSize=e&&e.sugPieceSize||Math.round(2*this.maxPieceSize/3),this.bigSize=e&&e.bigSize||80*this.sugPieceSize,this.sugPieceSize>=this.maxPieceSize&&(this.sugPieceSize=Math.round(2*this.maxPieceSize/3)),this.isString&&(this.at=this.charAt)}},{key:"makeNode",value:function(e,t,n){var i=new c.ITRange(e,t);return i.piece=n,i}},{key:"fill",value:function(e,t,n){for(var i=this.sugPieceSize,o=e,a=o+i,r=null,s=e,l=0;a<t;){for(r=this.makeNode(o,a,new Array(i)),this.attachNode(r),s=o,l=0;s<a;++s,++l)n(s,r.piece,l);o=a,a+=i}for(a=Math.min(a,t),r=this.makeNode(o,a,new Array(a-o)),this.attachNode(r),s=o,l=0;s<a;++s,++l)n(s,r.piece,l)}},{key:"format",value:function(e,t,n){var i=this;if(!this.isString){var o=e;this.mapInRange(e,t,c.IT.mapToRange,c.IT.strictIntersectTest).forEach((function(e){o<e.begin&&i.fill(o,e.begin,n),o=e.end})),o<t&&this.fill(o,t,n),this.size=Math.max(this.size,t)}}},{key:"fillText",value:function(e,t,n){for(var i=this.sugPieceSize,o=e,a=o+i,r=null;a<t;)r=this.makeNode(o,a,n.slice(o-e,a-e)),this.attachNode(r),o=a,a+=i;a=Math.min(a,t),r=this.makeNode(o,a,n.slice(o-e,a-e)),this.attachNode(r)}},{key:"formatText",value:function(e,t,n){var i=this;if(this.isString||t-e===n.length){var o=e,a=0,r=0,s=null,l=null;this.mapInRange(e,t,c.IT.mapToRangeAndNode,c.IT.strictIntersectTest).forEach((function(u){a=u.begin,r=u.end,s=u.node.piece,o<a&&(i.fillText(o,a,n.slice(o-e,a-e)),o=a),l=o>a?s.slice(0,o-a):"",u.node.piece=t<r?l+n.slice(o-e)+s.slice(t-a):l+n.slice(o-e,r-e),o=u.end})),o<t&&this.fillText(o,t,n.slice(o-e)),this.size=Math.max(this.size,t)}}},{key:"insert",value:function(e,t){this.expand(e,t.length);var n=this.fetchHintContainPos(this.ba_hint,e);if(n.good()){var i=n.pos,o=n.end,a=n.len,r=n._node,s=e-i,l=r.piece;if(l=l.slice(0,s).concat(t,l.slice(s)),a>this.maxPieceSize){var u=this.sugPieceSize,c=Math.ceil(a/u),h=Math.ceil(a/c),d=0,p=h;for(this.detachNode(r);p<a;)this.attachNode(this.makeNode(i+d,i+p,l.slice(d,p))),d+=h,p+=h;this.attachNode(this.makeNode(i+d,o,l.slice(d,a)))}else r.piece=l}else this.attachNode(this.makeNode(e,e+t.length,t));this.size+=t.length}},{key:"delete",value:function(e,t){var n=e+t,i=this.fetchHintContainPos(this.ba_hint,e);if(i.good()){var o=i.pos,a=i._node,r=a.piece;n<i.end?a.piece=r.slice(0,e-o).concat(r.slice(n-o)):(a.piece=r.slice(0,e-o),(i=this.fetchHintContainPos(this.ba_hint,n)).good()&&((a=i._node).piece=a.piece.slice(n-i.pos))),this.remove(e,t)}this.size-=t}},{key:"slice",value:function(e,t){if(e===t)return this.isString?"":[];var n=this.fetchHintContainPos(this.ba_hint,e);if(n.good()){var i=n.pos,o=n.end;if(t<o)return n._node.piece.slice(e-i,t-i);var a=n._node.piece.slice(e-i);return this.forEachHintInRange(o,t,(function(e){a=a.concat(t<e.end?e._node.piece.slice(0,t-e.pos):e._node.piece.slice(0))}),c.IT.strictIntersectTest),a}return this.isString?"":[]}},{key:"set",value:function(e,t){var n=this.fetchHintContainPos(this.ba_hint,e);n.good()&&t(e,n._node.piece,e-n.pos),this.size=Math.max(this.size,e+1)}},{key:"forEach",value:function(e,t,n){var i=null,o=0,a=e,r=0,s=this.fetchHintContainPos(this.ba_hint,a);if(s.good())if(i=s._node.piece,o=e-s.begin,t<s.end){for(;a<t;++a,++o)if(n(a,i,o))return}else{for(r=s.end;a<r;++a,++o)if(n(a,i,o))return;for(s.moveNext();a<t&&s.good();s.moveNext())for(a=s.pos,r=s.end,i=s._node.piece,o=0;a<r&&a<t;++a,++o)if(n(a,i,o))return}}},{key:"reverseForEach",value:function(e,t,n){var i=null,o=0,a=t-1,r=0,s=this.fetchHintContainPos(this.ba_hint,a);if(s.good())if(i=s._node.piece,o=a-s.begin,e>=s.pos){for(;a>=e;--a,--o)if(n(a,i,o))return}else{for(r=s.pos;a>=r;--a,--o)if(n(a,i,o))return;for(s.movePrev();a>=e&&s.good();s.movePrev())for(a=s.end-1,r=s.pos,i=s._node.piece,o=a-r;a>=r&&a>=e;--a,--o)if(n(a,i,o))return}}},{key:"at",value:function(e){var t=this.fetchHintContainPos(this.ba_hint,e);if(t.good())return t._node.piece[e-t.pos]}},{key:"charAt",value:function(e){var t=this.fetchHintContainPos(this.ba_hint,e);if(t.good())return t._node.piece.charAt(e-t.pos)}}]),e}(),d=function(){function e(t){r()(this,e),this.init(t)}return l()(e,[{key:"init",value:function(e){this.size=e&&e.size||0,this.isString=e&&e.isString||!1,this.maxPieceSize=e&&e.maxPieceSize||1200,this.sugPieceSize=e&&e.sugPieceSize||Math.round(2*this.maxPieceSize/3),this.bigSize=e&&e.bigSize||80*this.sugPieceSize,this.sugPieceSize>=this.maxPieceSize&&(this.sugPieceSize=Math.round(2*this.maxPieceSize/3)),this.isString?(this.at=this.charAt,this.insert=this.insertText,this.delete=this.deleteText,this.onePiece=""):this.onePiece=[]}},{key:"format",value:function(e,t,n){if(!this.isString){for(var i=this.onePiece,o=e;o<t;++o)i[o]||n(o,i,o);this.size=Math.max(this.size,t)}}},{key:"formatText",value:function(e,t,n){if(this.isString&&t-e===n.length){var i=this.onePiece;i.length<e&&(i+=" ".repeat(e-i.length)),this.onePiece=i.slice(0,e)+n+i.slice(t),this.size=Math.max(this.size,t)}}},{key:"insert",value:function(e,t){var n;(n=this.onePiece).splice.apply(n,[e,0].concat(o()(t))),this.size+=t.length}},{key:"delete",value:function(e,t){this.onePiece.splice(e,t),this.size-=t}},{key:"insertText",value:function(e,t){this.onePiece=this.onePiece.slice(0,e)+t+this.onePiece.slice(e),this.size+=t.length}},{key:"deleteText",value:function(e,t){this.onePiece=this.onePiece.slice(0,e)+this.onePiece.slice(e+t),this.size-=t}},{key:"slice",value:function(e,t){return this.onePiece.slice(e,t)}},{key:"set",value:function(e,t){t(e,this.onePiece,e),this.size=Math.max(this.size,e+1)}},{key:"forEach",value:function(e,t,n){for(var i=this.onePiece,o=e;o<t;++o)if(n(o,i,o))return}},{key:"reverseForEach",value:function(e,t,n){for(var i=this.onePiece,o=t-1;o>=e;--o)if(n(o,i,o))return}},{key:"at",value:function(e){return this.onePiece[e]}},{key:"charAt",value:function(e){return this.onePiece.charAt(e)}}]),e}(),p=function(){function e(t){r()(this,e),this.init(t)}return l()(e,[{key:"init",value:function(e){this.toolkit=new d(e)}},{key:"beBigOnDemand",value:function(){var e=this.size;if(e>this.toolkit.bigSize){console.log("-----------------------beBigBigArray");var t=this.toolkit.onePiece;if(this.toolkit=new h(this.toolkit),this.toolkit.size=e,this.beBigOnDemand=function(){},this.toolkit.isString)this.formatText(0,e,t);else for(var n=0,i=0,o=function(e,n,i){n[i]=t[e]};n<e;++n)if(t[n]){for(i=n+1;t[i];++i);this.format(n,i,o),n=i}}}},{key:"format",value:function(e,t,n){this.beBigOnDemand(),this.toolkit.format(e,t,n)}},{key:"formatText",value:function(e,t,n){this.beBigOnDemand(),this.toolkit.formatText(e,t,n)}},{key:"insert",value:function(e,t){this.beBigOnDemand(),this.toolkit.insert(e,t)}},{key:"delete",value:function(e,t){this.toolkit.delete(e,t)}},{key:"slice",value:function(e,t){return this.toolkit.slice(e,t)}},{key:"set",value:function(e,t){this.toolkit.set(e,t)}},{key:"forEach",value:function(e,t,n){this.toolkit.forEach(e,t,n)}},{key:"reverseForEach",value:function(e,t,n){this.toolkit.reverseForEach(e,t,n)}},{key:"at",value:function(e){return this.toolkit.at(e)}},{key:"size",get:function(){return this.toolkit.size}}]),e}();u.a.mix(h,c.ITToolkit)},6105:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return l}));var i=[65039,8419],o=[35,42,48,49,50,51,52,53,54,55,56,57],a=[55357,56516],r=function(e){return-1!=o.indexOf(e)},s=function(e){return e==i[0]||e==i[1]},l=function(e){return e==a[0]||e==a[1]}},6106:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(336),l=function(){function e(t,n,i){o()(this,e),this.span=t,this.chpx=n,this.papx=i}return r()(e,[{key:"calcFontsize",value:function(e){return Object(s.Ti2Px)(parseInt(e))}},{key:"pos",get:function(){return this.span.pos}},{key:"len",get:function(){return this.span.len}},{key:"fontSize",get:function(){return this.calcFontsize(this.chpx.getPropVal("font_size_normal")||this.chpx.getPropVal("font_size_cs"))||14}},{key:"fontStyle",get:function(){return this.chpx.getPropVal("italic")?"italic":""}},{key:"fontColor",get:function(){return this.chpx.getPropVal("font_color")}},{key:"highLightColor",get:function(){var e=this.chpx.getProp("highlight_color");return"#ffffffffff000000"===e.val||e.def?"#ffffffffff000000":e.val}},{key:"shadingBackColor",get:function(){return this.chpx.getPropVal("shading_back_color")}},{key:"shadingFillColor",get:function(){return this.chpx.getPropVal("shading_fill_color")}},{key:"shadingTexture",get:function(){return this.chpx.getPropVal("shading_texture")}},{key:"scriptPos",get:function(){return this.chpx.getPropVal("script_pos")}},{key:"fontWeight",get:function(){return this.chpx.getPropVal("bold")?"bold":""}},{key:"scale",get:function(){return null!=this.chpx.getPropVal("character_scale")?this.chpx.getPropVal("character_scale")/100:1}},{key:"border",get:function(){return{border:this.chpx.getPropVal("border"),borderSize:this.chpx.getPropVal("border_size"),borderType:this.chpx.getPropVal("border_type"),borderColor:this.chpx.getPropVal("border_color")}}},{key:"papxBorder",get:function(){return{border_top:this.papx.getPropVal("border_top"),border_bottom:this.papx.getPropVal("border_bottom"),border_left:this.papx.getPropVal("border_left"),border_right:this.papx.getPropVal("border_right"),border_between:this.papx.getPropVal("border_between")}}},{key:"emphasis",get:function(){return this.chpx.getPropVal("emphasis_type")}}]),e}();t.a=l},6107:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(4968),f=n(4810),g=n(4106),v=n(3976),m=n(1475),_=function(e){function t(){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return d()(t,e),r()(t,[{key:"mateOf",value:function(e,t){var n=t.dataStatus.document.fields,i=t.dataStatus.pos,o=n.getField(i);return!!o&&("NUMPAGES"==o.type||"SECTIONPAGES"==o.type)}},{key:"makeZone",value:function(e){return new p.d({parent:e,viewPage:e.viewPage,coorSystem:e.coorSystem})}},{key:"initZone",value:function(e,n,i){c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initZone",this).call(this,e,n,i);var o=n.dataStatus,a=o.data.fieldManager.getField(o.pos);if(a){if(a.section=e.viewPage.section,!a.result){var r=a.getRawResult();r=r||e.viewPage.pageNum+"",a.setResult(r)}var s=e.viewPage.view,l=e.viewPage.section;if("SECTIONPAGES"==a.getType()&&s.secPageCountCache.has(l)){var u=s.secPageCountCache.get(l);a.setResult(a.formatResult(u),!1)}var h=a.host&&a.host.viewPage.section!==l?a.clone():a;a.host=e.host;var d=new f.a(o.document,a);i.typoRange.data=d,i.partRangePos=0,i.textPart=h}}},{key:"updateZone",value:function(e,t){var n=e.zones[e.zones.length-1],i=new v.a(t.dataStatus.data,n.typoRange.data),o=t.updatingZoneStatus||{};return g.a.initZone(o,e,t,i),g.a.processZone(n,o),g.a.endZone(n,o),o.zoneExceed?(e.zoneExceed=!0,e.hasBrokenZone=!0,m.a.LineEnd):m.a.Pass}}],[{key:"mateByField",value:function(e){return e&&"NUMPAGES"==e.type||"SECTIONPAGES"==e.type}},{key:"makeZoneByField",value:function(e,n,i,o){if(!t.mateByField(i))return null;var a=i.fieldObj;a.section=n.viewPage.section,e.fieldManager.parseField(a,n.view.pageCount),a.section=n.viewPage.section;var r=n.viewPage.view,s=n.viewPage.section;if("SECTIONPAGES"==a.getType()&&r.secPageCountCache.has(s)){var l=r.secPageCountCache.get(s);a.setResult(a.formatResult(l),!1)}var u=a.host&&a.host.viewPage.section!==s?a.clone():a;a.host=n.host;var c=new p.d({parent:n,viewPage:n.viewPage,coorSystem:n.coorSystem}),h=new f.a(e.doc,a);return c.typoRange={pos:o-n.range.pos,len:i.len,data:h},c.partRangePos=0,c.textPart=u,c}}]),t}(n(3331).a);t.a=_},6108:function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return s}));var i=0,o=0,a=0,r=1,s=2},6109:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(2502),l=["〇","一","二","三","四","五","六","七","八","九"],u=["","十","百","千","万"],c=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],h=["","拾","佰","仟","万"],d=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],p=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],f=["〇","壱","弐","参","四","伍","六","七","八","九","拾","百","阡","萬","億","兆","-","."],g=["ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト","ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","ヘ","ホ","マ","ミ","ム","メ","モ","ヤ","ユ","ヨ","ラ","リ","ル","レ","ロ","ワ","ヲ","ン"],v=["イ","ロ","ハ","ニ","ホ","ヘ","ト","チ","リ","ヌ","ル","ヲ","ワ","カ","ヨ","タ","レ","ソ","ツ","ネ","ナ","ラ","ム","ウ","ヰ","ノ","オ","ク","ヤ","マ","ケ","フ","コ","エ","テ","ア","サ","キ","ユ","メ","ミ","シ","ヱ","ヒ","モ","セ","ス","ン"],m=["０","１","２","３","４","５","６","７","８","９"],_=["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","⑰","⑱","⑲","⑳"],y=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],b=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],T=["zero","one","two","three","four","five","six","seven","eight","nine"],C=["","ten","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],k=["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],w=["th","st","nd","rd"],S=["","㈠","㈡","㈢","㈣","㈤","㈥","㈦","㈧","㈨","㈩"],P=function(){function e(){o()(this,e)}return r()(e,null,[{key:"numberFormat",value:function(t,n){var i=parseInt(t);if(isNaN(i))return i;switch(n){case s.b:return parseInt(i);case s.r:case s.p:return e.toDArabicNum(i);case s.n:case s.y:return e.toNoRepeatNum(i,_);case s.gb:return e.toNoRepeatNum(i,d);case s.hb:return e.toNoRepeatNum(i,p);case s.o:case s.L:return e.toNoRepeatNum(i,g);case s.q:return e.toNoRepeatNum(i,v);case s.cb:return e.toLetterNum(i,y);case s.N:return e.toLetterNum(i,b);case s.ab:case s.i:case s.k:case s.h:return e.toChineseNum(i);case s.j:return e.toChineseNum2(i);case s.db:return e.toRomanNum(i);case s.O:return e.toRomanNum(i,!1);case s.u:return e.tojplegalNum(i);case s.R:return e.toDashNum(i);case s.S:return e.toEnThNum(i);case s.g:return e.toEnOneNum(i);case s.T:return e.toEnFirstNum(i);case s.z:return e.toGB4(i)}return i}},{key:"toDArabicNum",value:function(e){for(var t=""+e,n="",i=0;i<t.length;++i)n+=m[t[i]];return n}},{key:"toNoRepeatNum",value:function(e,t){return 0===e?0:e<=t.length?t[e-1]:e}},{key:"toLetterNum",value:function(e,t){if(0===e)return t[0];for(var n="",i=e,o=t.length;i>0;)n=t[(i-1)%o]+n,i=Math.floor((i-1)/o);return n}},{key:"toChineseNum",value:function(e){var t=e;if(0===(t=parseInt(t)))return"〇";var n=function(e){for(var t=e.toString().split("").reverse(),n="",i=0;i<t.length;i++)n=(0==i&&0==t[i]||i>0&&0==t[i]&&0==t[i-1]?"":l[t[i]]+(0==t[i]?u[0]:u[i]))+n;return n},i=Math.floor(t/1e4),o=t%1e4;o.toString().length<4&&(o="0"+o);var a=i?n(i)+"万"+n(o):n(t);return 0==a.indexOf("一十")&&(a=a.replace("一十","十")),a}},{key:"toChineseNum2",value:function(e){var t=e;if(0===(t=parseInt(t)))return"零";var n=function(e){for(var t=e.toString().split("").reverse(),n="",i=0;i<t.length;i++)n=(0==i&&0==t[i]||i>0&&0==t[i]&&0==t[i-1]?"":c[t[i]]+(0==t[i]?h[0]:h[i]))+n;return n},i=Math.floor(t/1e4),o=t%1e4;return o.toString().length<4&&(o="0"+o),i?n(i)+"万"+n(o):n(t)}},{key:"toRomanNum",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e;if(0===(n=parseInt(n)))return".";if(n>=4e3)return n;var i=[["","I","II","III","IV","V","VI","VII","VIII","IX"],["","X","XX","XXX","XL","L","LX","LXX","LXXX","XC"],["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM"],["","M","MM","MMM"]],o=i[3][Math.floor(n/1e3)],a=i[2][Math.floor(n%1e3/100)],r=i[1][Math.floor(n%100/10)],s=i[0][n%10],l=o+a+r+s;return t?l:l.toLowerCase()}},{key:"tojplegalNum",value:function(e){if(0===e)return f[0];var t=e+"",n=t.length%12,i=parseInt((t.length-1)/12),o=-1,a=!1,r="";do{for(;n>0;){var s=t[++o];switch(n){case 12:case 8:case 4:"0"!==s&&("1"!==s&&(r+=f[parseInt(s)]),r+=f[12],a=!0);break;case 11:case 7:case 3:"0"!==s&&("1"!==s&&(r+=f[parseInt(s)]),r+=f[11],a=!0);break;case 10:case 6:case 2:"0"!==s&&("1"!==s&&(r+=f[parseInt(s)]),r+=f[10],a=!0);break;case 9:"0"!==s?(r+=f[parseInt(s)],r+=f[parseInt(14)]):a&&(r+=f[parseInt(14)]),a=!1;break;case 5:"0"!==s?(r+=f[parseInt(s)],r+=f[parseInt(13)]):a&&(r+=f[parseInt(13)]),a=!1;break;case 1:"0"!==s&&(r+=f[parseInt(s)]),i>0&&(r+=f[parseInt(15)]),a=!1}--n}n=--i>=0?12:0}while(n);return r}},{key:"toDashNum",value:function(e){return"- "+e+" -"}},{key:"toEnThNum",value:function(e){var t=e;switch(t%10){case 1:case 2:case 3:t%100/10!=1&&(t%=10);break;default:t=0}return e+w[t]}},{key:"toEnOneNum",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="";if(e<=999999){if(0==e)return T[e];n=this.serialNumEn1000(e,n),t&&(n=n.charAt(0).toUpperCase()+n.slice(1))}return n}},{key:"serialNumEn1000",value:function(e,t){var n=t,i=e;return i<1e3?this.serialNumEn999(i,n):(n+=this.serialNumEn999(parseInt(i/1e3),n),n+=" ",n+="thousand",0!=(i%=1e3)&&(n+=" ",n=this.serialNumEn999(i,n)),n)}},{key:"serialNumEn999",value:function(e,t){var n=t,i=e;return i<100?this.serialNumEn99(i,n):(n+=T[parseInt(i/100)],n+=" ",n+="hundred",0!=(i%=100)&&(n+=" ",n=this.serialNumEn99(i,n)),n)}},{key:"serialNumEn99",value:function(e,t){var n=t,i=e;return i<10?n+=T[i]:(1!=parseInt(i/10)?(n+=C[parseInt(i/10)],0!=(i%=10)&&(n+="-",n+=T[i%10])):n+=k[i%10],n)}},{key:"toEnFirstNum",value:function(e){var t=void 0;if(e>999999)return e;switch((t=this.toEnOneNum(e,!1)).charAt(t.length-1)){case"e":switch(e%10){case 1:t=t.replace(t.slice(t.length-3),"first");break;case 3:t=t.replace(t.slice(t.length-5),"third");break;case 9:t=t.replace(t.slice(t.length-1),"th");break;case 5:case 2:t=t.replace(t.slice(t.length-2),"fth")}break;case"o":var n=e%10;2==n?t=t.replace(t.slice(t.length-3),"second"):0==n&&(t+=w[0]);break;case"y":t=t.replace(t.slice(t.length-1),"ieth");break;case"t":t=t.replace(t.slice(t.length-1),w[0]);break;default:t+=w[0]}return t=t.charAt(0).toUpperCase()+t.slice(1)}},{key:"toGB4",value:function(e){return e<=0||e>10?e:S[e]}}]),e}();t.a=P},6110:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i=0,o=1},6111:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"e",(function(){return a})),n.d(t,"g",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return u}));var i=1,o=2,a=3,r=4,s=5,l=6,u=7},6112:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3319);function l(e,t,n){e.left+=t,e.right+=t,e.top+=n,e.bottom+=n}var u=function(){function e(){o()(this,e),this.init()}return r()(e,[{key:"init",value:function(){this.boundaryRect=new s.a}},{key:"intersectStrict",value:function(e,t){var n=e.left,i=e.top,o=e.right,a=e.bottom,r=new s.a(this.boundaryRect);return t&&(r.left-=t.x,r.right-=t.x,r.top-=t.y,r.bottom-=t.y),!(r.right<n||r.bottom<i||o<r.left||a<r.top)}},{key:"intersect",value:function(e,t){var n=e.left,i=e.top,o=e.right,a=e.bottom,r=new s.a(this.boundaryRect);return t&&(r.left-=t.x,r.right-=t.x,r.top-=t.y,r.bottom-=t.y),!(r.right<=n||r.bottom<=i||o<=r.left||a<=r.top)}},{key:"offset",value:function(e,t){this.boundaryRect&&l(this.boundaryRect,e,t),this.rect&&l(this.rect,e,t),this.visibleRect&&l(this.visibleRect,e,t),this.visible_rect&&l(this.visible_rect,e,t)}},{key:"setRect",value:function(e){this.rect=new s.a(e),this.visible_rect=new s.a(e)}},{key:"clone",value:function(){return Object.assign({},this)}},{key:"boundary",get:function(){return this.boundaryRect},set:function(e){var t=e.left,n=e.top,i=e.right,o=e.bottom;this.boundaryRect.init({left:t,top:n,right:i,bottom:o})}},{key:"viewRect",get:function(){if(this.coor_pos2view){var e=new s.a(this.rect);return l(e,this.coor_pos2view.x,this.coor_pos2view.y),e}return this.rect}}]),e}();t.a=u},6113:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(400),o=n(4580),a=n(1032),r=n(411),s=n(310),l=n(4809),u=n(336);function c(e,t,n,h,d,p,f){var g=f.data.doc,v=f.data.doc.anchors,m=[];return e.forEach((function(e){var c=void 0;if(null!=e.tblLayer){if((c=new o.a({outer:h,viewPage:d,range:{}})).upper=h,c.coor_pos2view=t,function(e,t){e.visible_rect=e.rect=i.a.initByOriginAndSize({x:Object(u.Ti2Px)(parseInt(t.x)),y:Object(u.Ti2Px)(parseInt(t.y))},{width:Object(u.Ti2Px)(parseInt(t.w)),height:Object(u.Ti2Px)(parseInt(t.h))}),e.limit_rect&&(e.visible_rect=i.a.intersectsRect(e.limit_rect,e.visible_rect));e.pic_rect=i.a.initByDocRect(t.picRect),e.boundary=e.visible_rect}(c,e),e.textFramePage){var _=d.serverOffset;c.snippetPack=new a.c({parent:c,viewPage:d,coorSystem:r.DOCCoorSystemType.TextFramePage},{subdoc_type:parseInt(e.subDocType),compose:n,textpage:e.textFramePage,pageOffsetFromServer:_})}c.snippetPack.coor_pos2view=t;var y=c.snippetPack.range,b=f.frameLineRanges.mapInRange(y.pos,y.pos+y.len,(function(e){return e._node.line}),s.IT.strictIntersectTest),T=void 0;b.forEach((function(e){e.isSnippetLine&&e.viewPage===d&&e.range.pos<=y.pos&&e.range.len>=y.len&&(!T||T.range.len>e.range.len)&&(T=e)})),c.outer=c.snippetLine=T,c.snippetLine.card=c,c.snippetLine.pack=c.snippetPack,c.initRange(y)}else{var C=parseInt(e.id),k=parseInt(e.subDocType),w=e.anchor;if(!w){var S=v.getAnchor(C,g.getSubDocOffset(k),g.getSubDocSize(k));w=S&&S.anchor}if(w){var P={begin:w.begin,end:w.end},I=f.collectTextLines(P).find((function(e){return!e.isSubLine&&s.IT.containTest(e.range,P)}));I?w.shapeData&&!w.shapeData.hide&&((c=new l.a({outer:I,viewPage:d,range:P,coorSystem:null,anchor:w,raw_card:e})).upper=h):e.anchor=w}}c?p.commitCard(c):m.push(e)})),m.length&&!e.sorted&&(m.sort((function(e,t){return e.anchor.pos-t.anchor.pos})),m.sorted=!0,m=c(m,t,n,h,d,p,f)),m}},6114:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2295),o=n(2294),a=function(){function e(){this.rangesMap=new Map}return e.prototype.setRanges=function(e){if(!Array.isArray(e))return"";var t=(0,o.getUniqueId)();return this.rangesMap.set(t,e.map((function(e){return{pos:e.pos,len:e.len}}))),t},e.prototype.adjustRangeAfterContentChange=function(e,t,n){var o=this,a=[];this.rangesMap.forEach((function(o,r){(0,i.adjustRangeOnTextChanging)(e,t,n,o),0===o.length&&a.push(r)})),a.forEach((function(e){o.rangesMap.delete(e)}))},e.prototype.removeRangesById=function(e){var t=this,n=!1;return e.forEach((function(e){n=t.rangesMap.delete(e)||n})),n&&window.APP.workspace.refreshContinently(),n},e.prototype.getRanges=function(){var e=[];return this.rangesMap.forEach((function(t){e=e.concat(t)})),e},e.prototype.getRangesByRange=function(e,t){void 0===t&&(t=!1);var n=[],i=e.pos,o=e.pos+e.len;return this.rangesMap.forEach((function(e){e.forEach((function(e){var a=e.pos,r=a+e.len;if(!(e.pos>=o||e.pos+e.len<=i))if(t)switch(!0){case a>=i&&r<=o:n.push(e);break;case a<i&&r>o:n.push(Object.assign({},e,{pos:i,len:o-i}));break;case a<i&&r<=o:n.push(Object.assign({},e,{pos:i,len:r-i}));break;case a>=i&&r>o:n.push(Object.assign({},e,{pos:a,len:o-a}))}else n.push(e)}))})),n},e}();t.default=a},6115:function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"h",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return c}));var i={MultiplePages_Normal:0,MultiplePages_MirrorMargins:1,MultiplePages_2PagesPerSheet:2,MultiplePages_BookFold:4,MultiplePages_ReversBookFold:4},o={GutterPos_PageLeftRight:0,GutterPos_PageTopBottom:1},a={PageOrientation_Portrait:0,PageOrientation_Landscape:1},r={GutterPlacement_Latin:0,GutterPlacement_Bidi:1},s={TypoTextFlow_Normal:0,TypoTextFlow_Hori_L2R_Trans:8,TypoTextFlow_Hori_R2L_Norm:2,TypoTextFlow_Hori_R2L_Trans:10,TypoTextFlow_Vert_R2L_Norm:5,TypoTextFlow_Vert_R2L_Trans:13,TypoTextFlow_Vert_L2R_Norm:1,TypoTextFlow_Vert_L2R_Trans:9,TypoTextFlow_Vert_D2U_L2R_Norm:3,TypoTextFlow_Vert_D2U_R2L_Norm:7},l={BorderApplyTo_AllPage:0,BorderApplyTo_FirstPage:1,BorderApplyTo_OtherPage:2},u={BorderMeasureFrom_Text:0,BorderMeasureFrom_PageEdge:1},c={BorderStyleType_None:0,BorderStyleType_LineStyle:1,BorderStyleType_LineArtStyle:2}},6116:function(e,t,n){"use strict";function i(e,t){for(var n=0,i=void 0,o=t.length-1,a=void 0,r=!1;n<=o;)if(e<(a=t[i=n+o>>1]).beginOffset)o=i-1;else{if(!(e>=a.endOffset)){r=!0;break}n=i+1}for(;i>1;){var s=t[i-1];if(s.beginOffset!==a.beginOffset)break;a=s,--i}var l=void 0;if(r){var u=a.widths,c=a.oMath?1:e-a.beginOffset;if(a.isLayoutRTL){l=a.x+a.widthSum;for(var h=0;h<c;++h)l-=u[h]}else{l=a.x;for(var d=0;d<c;++d)l+=u[d]}return{index:i,pos:l,glyphGroupInfo:a}}var p=n;if(e>=(a=t[p]).endOffset){if(p>=t.length-1)return{index:-1,pos:0,glyphGroupInfo:null};a=t[++p]}return{index:p,pos:l=a.isLayoutRTL?a.x+a.widthSum:a.x,glyphGroupInfo:a}}n.d(t,"a",(function(){return i}))},6117:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(309),l=new(function(){function e(){o()(this,e),this.reset()}return r()(e,[{key:"reset",value:function(){this._cache={}}},{key:"calearCache",value:function(e){var t=this,n=this._cache;Object.keys(n).map((function(i){var o=(n[i][0]||n[i][1]).line.viewPage.layout_index;e.findIndex((function(e){return o>=e}))>=-1&&delete t._cache[i]}))}},{key:"setPos",value:function(e,t,n,i){this._cache[e]={};var o=Object.assign({},t);i&&i.data.doc.getSubDocType(e)===s.HeaderFooter&&(o.headerfooterLayoutIndex=i.selContext.headerfooterLayoutIndex),this._cache[e][n?1:0]=o}},{key:"getPos",value:function(e,t,n){if("number"!=typeof e)return null;var i=this._cache[e]&&this._cache[e][t?1:0];return i&&n&&(n.data.doc.getSubDocType(e)===s.HeaderFooter||n.data.doc.getSubDocType(e)===s.TextboxInHF)?n.selContext.headerfooterLayoutIndex===i.headerfooterLayoutIndex?i:null:i}}]),e}());t.a=l},6118:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var i=n(2502);function o(e,t,n){var o=[{nfc:i.b,name:"ARABIC"},{nfc:i.db,name:"ROMAN"},{nfc:i.O,name:"roman"},{nfc:i.cb,name:"ALPHABETIC"},{nfc:i.N,name:"alphabetic"},{nfc:i.S,name:"ORDINAL"},{nfc:i.g,name:"CARDTEXT"},{nfc:i.T,name:"ORDTEXT"},{nfc:i.D,name:"HEX"},{nfc:i.h,name:"ARABIC"},{nfc:i.s,name:"DBNUM1"},{nfc:i.t,name:"DBNUM2"},{nfc:i.a,name:"AIUEO"},{nfc:i.I,name:"IROHA"},{nfc:i.r,name:"DBCHAR"},{nfc:i.U,name:"SBCHAR"},{nfc:i.u,name:"DBNUM3"},{nfc:i.v,name:"DBNUM4"},{nfc:i.n,name:"CIRCLENUM"},{nfc:i.p,name:"ARABIC"},{nfc:i.o,name:"AIUEO"},{nfc:i.q,name:"IROHA"},{nfc:i.e,name:"ARABIC"},{nfc:i.f,name:"ARABIC"},{nfc:i.A,name:"GANADA"},{nfc:i.m,name:"CHOSUNG"},{nfc:i.w,name:"GB1"},{nfc:i.x,name:"GB2"},{nfc:i.y,name:"GB3"},{nfc:i.z,name:"GB4"},{nfc:i.gb,name:"ZODIAC1"},{nfc:i.hb,name:"ZODIAC2"},{nfc:i.ib,name:"ZODIAC3"},{nfc:i.Y,name:"CHINESENUM1"},{nfc:i.Z,name:"CHINESENUM2"},{nfc:i.ab,name:"CHINESENUM3"},{nfc:i.bb,name:"CHINESENUM4"},{nfc:i.i,name:"CHINESENUM1"},{nfc:i.j,name:"CHINESENUM2"},{nfc:i.k,name:"DBNUM1"},{nfc:i.l,name:"CHINESENUM4"},{nfc:i.J,name:"DBNUM1"},{nfc:i.K,name:"DBNUM2"},{nfc:i.L,name:"DBNUM3"},{nfc:i.M,name:"DBNUM4"},{nfc:i.B,name:"HEBREW1"},{nfc:i.c,name:"ARABICALPHA"},{nfc:i.C,name:"HINDIARABIC"},{nfc:i.d,name:"ARABICABJAD"},{nfc:i.E,name:"HINDILETTER1"},{nfc:i.F,name:"HINDILETTER2"},{nfc:i.G,name:"HINDIARABIC"},{nfc:i.H,name:"HINDICARDTEXT"},{nfc:i.V,name:"THAILETTER"},{nfc:i.W,name:"THAIARABIC"},{nfc:i.X,name:"THAICARDTEXT"},{nfc:i.fb,name:"VIETCARDTEXT"},{nfc:i.R,name:"ArabicDash"},{nfc:i.P,name:"ARABIC"},{nfc:i.eb,name:"ARABIC"},{nfc:i.Q,name:""}],a=void 0,r=void 0,s=!1;return o.forEach((function(i){if(n){if(e==i.nfc)return a=i.name,void(s=!0)}else if(t==i.name)return r=i.nfc,void(s=!0)})),s||(n||o.forEach((function(e){if(t.toLowerCase()==e.name.toLowerCase())return r=e.nfc,void(s=!0)})),s||(n?a="ARABIC":r=i.b)),{nfc:r,fmtStr:a,result:s}}function a(e,t){return o(e,t,!0)}function r(e,t){return o(t,e,!1)}},6119:function(e,t,n){"use strict";var i=n(8),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=function(){function e(){r()(this,e)}return l()(e,null,[{key:"getLayoutFirstLayerCellInfos",value:function(t,n){for(var i=t.length,o=0;o<i;++o){var a=t[o];e.getTextPageFirstLayerCellInfos(a.lineInfos,n)}}},{key:"getLayoutSelCellInfo",value:function(t,n){if(n)return e.getTextPageSelCellInfo(t[0].lineInfos,n);var i=t.length-1;return e.getTextPageSelCellInfo(t[i].lineInfos,n)}},{key:"getLayoutSelCellRanges",value:function(t,n,i,o,a){for(var r=t.length,s=0;s<r;++s){var l=t[s];e.getTextPageSelCellRanges(l.lineInfos,n,i,o,a)}}},{key:"getTextPageFirstLayerCellInfos",value:function(t,n){for(var i=t.length,o=0;o<i;++o){var a=t[o];e.getLineFirstLayerCellInfos(a.cellInfos,n)}}},{key:"getTextPageSelCellInfo",value:function(t,n){if(n)return e.getLineSelCellInfo(t[0].cellInfos,n);var i=t.length-1;return e.getLineSelCellInfo(t[i].cellInfos,n)}},{key:"getTextPageSelCellRanges",value:function(t,n,i,o,a){for(var r=t.length,s=0;s<r;++s){var l=t[s];e.getLineSelCellRanges(l.cellInfos,n,i,o,a)}}},{key:"getLineFirstLayerCellInfos",value:function(e,t){for(var n=e.length,i=0;i<n;++i){var o=e[i];t.push(o)}}},{key:"getLineSelCellInfo",value:function(t,n){if(n){if(t[0].lineInfos.length>0)return e.getTextPageSelCellInfo(t[0].lineInfos,n);var i=t[0].cell;return{cellX:i.rect.left,cellW:i.rect.right-i.rect.left,isCellsReverse:t[0].cell.rect.left>t[t.length-1].cell.rect.left}}var o=t.length-1;if(t[o].lineInfos.length>0)return e.getTextPageSelCellInfo(t[o].lineInfos,n);var a=t[o].cell;return{cellX:a.rect.left,cellW:a.rect.right-a.rect.left,isCellsReverse:t[0].cell.rect.left>t[t.length-1].cell.rect.left}}},{key:"getLineSelCellRanges",value:function(t,n,i,a,r){for(var s=t.length,l=null,u=null,c=!1,h=!1,d=0;d<s;++d){var p=t[d];if(p.lineInfos.length>0)e.getTextPageSelCellRanges(p.lineInfos,n,i,a,r);else if("break"===function(){for(var e=p.hostLine,t=[].concat(o()(e.tablecells)).sort((function(e,t){return e.rect.left-t.rect.left})),a=t.length,r=t.reduce((function(t,n,i){var o=n.range;if(o)t.push(o);else{var a=t[i-1];a?t.push({pos:a.pos+a.len,len:1}):t.push({pos:e.range.pos,len:1})}return t}),[]),s=0;s<a;++s){var d=t[s];if(!(Math.floor(d.rect.right)<=Math.floor(n))){if(Math.ceil(d.rect.left)>=Math.ceil(i))break;l||(l=r[s],c=0===s),u=r[s],h=s===a-1}}return"break"}())break}if(l&&u){if(l.pos>u.pos){var f=[u,l];l=f[0],u=f[1]}a?r.push({begin:u.pos+u.len,end:l.pos,bSelAllCell:c&&h}):r.push({begin:l.pos,end:u.pos+u.len,bSelAllCell:c&&h})}}},{key:"dealCellInfos",value:function(t){var n=t.length;if(0===n)return console.log("大哥，错了！"),!1;for(var i=[],o=0;o<n;++o){var a=t[o];if(!(a.lineInfos.length>0))break;e.getTextPageFirstLayerCellInfos(a.lineInfos,i)}if(o===n)this.dealCellInfos(i);else{if(n<2)return!1;for(var r=!0,s=t[0].hostLine,l=1;l<n;++l){var u=t[l];if(s===u.hostLine){r=!1;break}s=u.hostLine}if(r){var c=!0;s=t[0].hostLine;for(var h=1;h<n;++h){var d=t[h];if(void 0===s.range||void 0===d.hostLine.range||s.range.pos!==d.hostLine.range.pos||s.range.len!==d.hostLine.range.len){c=!1;break}s=d.hostLine}if(c)return!1}for(var p=0;p<n;++p){t[p].lineInfos=[]}}return!0}},{key:"dealResult",value:function(e,t){for(var n=!0,i=0;i<e.length;++i)if(!e[i].bSelAllCell){n=!1;break}if(n){for(var o=0;o<e.length;++o)t?e[o].begin=e[o].begin+1:e[o].end=e[o].end+1;for(var a=1;a<e.length;++a)t?e[a].end===e[a-1].begin&&(e[a-1].begin=e[a].begin,e.splice(a,1),--a):e[a].begin===e[a-1].end&&(e[a-1].end=e[a].end,e.splice(a,1),--a)}}}]),e}();t.a=u},6120:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(554),d=n(310),p=n(4105),f=n(411),g=n(626),v=n(1737),m=n(4583),_=n(7212),y=function(e){function t(e,n,i){o()(this,t);var a=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:null,viewPage:null,coorSystem:null}));return a.compose=n,a.data=e,a.typoinfo=i,a.size=p.a.ZERO(),a.comment_pages={},Object(h.default)(a),a.data.doc.comments.commentBodys.attachObserver(a),a.textLineRanges=new d.ITToolkit,a.tableLineRanges=new d.ITToolkit,a.horizontalPadding=0,a.verticalPadding=4,a.size.width=_.b,a._viewOffset={x:0,y:0},a}return c()(t,e),r()(t,[{key:"getCommentPage",value:function(e){var t=this.comment_pages[e];return this.data.doc.comments.getCommentByRcId(e)?(t&&!t.expired()||(t=this.updateCommentPage(e)),t):t}},{key:"updateCommentPage",value:function(e){var t=this.typoinfo.updater.commentUpdater.update(e);return this.comment_pages[e]=t,t}},{key:"removeCommentPage",value:function(e){this.comment_pages[e]&&delete this.comment_pages[e]}},{key:"onInsertCommentBody",value:function(e,t){}},{key:"onRemoveCommentBody",value:function(e,t){var n=t.comment.rc_id;this.removeCommentPage(n)}},{key:"isView",value:function(){return!0}},{key:"isHost",value:function(){return!1}},{key:"isCoorSystem",value:function(){return!0}},{key:"getCurrentPos",value:function(e){return 0}},{key:"setViewOffsetX",value:function(e){this._viewOffset.x=e}},{key:"setViewOffsetY",value:function(e){this._viewOffset.y=e}},{key:"locateViewPage",value:function(e){var t=this.textLineRanges.findNodeContainPos(e);if(t)return t.line.viewPage}},{key:"getPosition",value:function(e){return new v.a(this.data.selection,e)}},{key:"offsetView",value:function(e,t){this.horizontalPadding+=e,this.verticalPadding+=t,this.layout_pages.forEach((function(n){n.outer_rect.offset(e,t),n.onDel()}))}},{key:"attachLine",value:function(e){switch(e.layoutType){case f.DOCLayoutType.TextLine:this.attachTextLine(e);break;case f.DOCLayoutType.TableLine:this.attachTableLine(e)}}},{key:"attachTextLine",value:function(e){e.range.isOrphan()&&this.textLineRanges.attachNode(e.range)}},{key:"detachLine",value:function(e){switch(e.layoutType){case f.DOCLayoutType.TextLine:this.detachTextLine(e);break;case f.DOCLayoutType.TableLine:this.detachTableLine(e)}}},{key:"detachTextLine",value:function(e){e.range.isOrphan()||this.textLineRanges.detachNode(e.range)}},{key:"composeProcessLayout",value:function(e){new m.a(this).composeCommentPage(e)}},{key:"collectTextLines",value:function(e){var t=e.begin,n=e.end;return this.view.textLineRanges.mapInRange(t,n,(function(e){return e._node.line}),d.IT.strictIntersectTest)}},{key:"layoutType",get:function(){return f.DOCLayoutType.CommentView}},{key:"view",get:function(){return this}},{key:"position2parent",get:function(){return g.a.ZERO()}},{key:"viewOffset",get:function(){return this._viewOffset}},{key:"width",get:function(){return this.size.width},set:function(e){this.size.width=e}},{key:"height",get:function(){return this.size.height},set:function(e){this.size.height=e}},{key:"typoWidth",get:function(){return this.view.width-2*this.horizontalPadding}},{key:"range",get:function(){return{begin:this.textLineRanges.tree.begin,end:this.textLineRanges.tree.end}}},{key:"environment",get:function(){return"pc"}}]),t}(f.DOCLayout);t.a=y},6121:function(e,t,n){e.exports=function(e,t){n.e(888).then(n.bind(null,10879)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},6122:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={Print:"print",Mobile:"mobile",WebPC:"webpc",PagePC:"pagepc"}},6123:function(e,t,n){"use strict";var i=n(24),o=n.n(i),a=n(144),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(3489),d=n(167),p=n(240),f=n(227),g=[h.f,h.L,h.b],v=new Set(g),m=[h.i,h.B,h.C,h.L,h.b],_=new Set(m),y=Math.pow(2,0),b=Math.pow(2,1),T=Math.pow(2,2),C=new(function(){function e(){l()(this,e);for(var t=new Map,n=v.size,i=Math.pow(2,n),o=0;o<i;o++)t.set(o,new Map);this.eventMap=t}return c()(e,[{key:"configValid",value:function(e){var t=r()(e,5),n=t[0],i=t[1],a=t[2],s=t[3],l=t[4];return n.every((function(e){return"-1"!==g.indexOf(e)}))?s&&"object"!==(void 0===s?"undefined":o()(s))?(console.error("过滤条件只能是对象: ",JSON.stringify(s)),!1):l&&"function"!=typeof l?(console.error("匹配函数类型错误，实际类型为：",void 0===l?"undefined":o()(l)),!1):"function"!=typeof a&&"string"!=typeof a?(console.error("回调只能是方法或事件名"),!1):!(isNaN(i)&&!Array.isArray(i))||(console.error("快键键触发键只能是数组或数值"),!1):(console.error("修饰键只能由control/command、shift、alt组合而成"),!1)}},{key:"merge",value:function(e,t){var n=this;e.every((function(e){var i=r()(e,5),o=i[0],a=i[1],s=i[2],l=i[3],u=i[4];if(n.configValid(e)){var c={callback:s,condition:l,matchFilter:t,matchFunction:u},h=n.getMapKeyFromConfig(o),d=n.eventMap.get(h);return Array.isArray(a)?a.forEach((function(e){d.set(e,c)})):d.set(a,c),!0}return!1}))}},{key:"handleKeydown",value:function(e,t){var n=this.isMatch(e);n&&(this.execWrapper||(this.execWrapper=this.exec,t&&t.throttle&&(this.execWrapper=window.utils.Lodash.throttle(this.exec,t.throttle))),this.preKeyCode&&this.preKeyCode===e.keyCode?this.execWrapper(e,n):this.exec(e,n),this.preKeyCode=e.keyCode,Object(p.stopBubble)(e))}},{key:"isMatch",value:function(e){var t=this,n=e.keyCode;if(d.isIPad&&!0===e.metaKey&&229===n&&(n=e.code.charCodeAt(3)),!_.has(n)){var i=this.getMapKeyFromEvent(e),o=this.eventMap.get(i).get(n);if(o){var a=o.callback,r=o.condition,s=void 0===r?{}:r,l=o.matchFilter,u=o.matchFunction;return(!l||!0===l(s,e))&&((!u||!0===u(e))&&(d.isIE&&0===i&&[8,13,33,34,35,36,37,38,39,40,46].includes(n)?function(){a.apply(void 0,arguments),t.focusTimer=setTimeout((function(){window.APP.focusInput()}))}:a))}return!1}}},{key:"exec",value:function(e,t){"string"==typeof t?f.default.dispatchEvent(t):t(e)}},{key:"getMapKeyFromEvent",value:function(e){var t=0;return(d.isMacOs||d.isIPad)&&!0===e.metaKey&&!0===e.ctrlKey||(!d.isMacOs&&!0===e.ctrlKey||(d.isMacOs||d.isIPad)&&!0===e.metaKey)&&(t+=y),!0===e.shiftKey&&(t+=b),!0===e.altKey&&(t+=T),t}},{key:"getMapKeyFromConfig",value:function(e){var t=0;return-1!==e.indexOf(h.f)&&(t+=y),-1!==e.indexOf(h.L)&&(t+=b),-1!==e.indexOf(h.b)&&(t+=T),t}},{key:"cancel",value:function(){this.execWrapper&&this.execWrapper.cancel&&this.execWrapper.cancel(),clearTimeout(this.focusTimer),this.focusTimer=null}}]),e}()),k={bind:function(e,t,n){if(Array.isArray(e)){if(!t||"function"==typeof t)return C.merge(e,t),function(e){C.handleKeydown(e,n)};console.error("总过滤器必须是方法"+JSON.stringify(t))}else console.error("配置必须是数组: "+JSON.stringify(e))},isMatch:function(e){return!!C.isMatch(e)},clearAll:function(){C.cancel()}};t.a=k},6124:function(e,t,n){"use strict";n.r(t),n.d(t,"getFileDownloadId",(function(){return r})),n.d(t,"postTemplateToFile",(function(){return s}));var i=n(361),o=n(86),a="remote_template",r=function(e,t){if(!e)throw new Error('FrontEnd Error: expected "fileUrl"');var n=o.getClient().clientID,a={url:e},r="/api/v3/office/file/"+window.urlFileId+"/web_object/"+t+"?connid="+n;return{types:i.default.HTTP_TYPES,callAPI:function(e){return e.post(r).send(a).end()}}},s=function(e){var t="/api/v3/office/file/"+window.fileInfo.id+"/source/"+a+"?connid="+window.RPCClient.clientID;return{types:i.default.HTTP_TYPES,callAPI:function(n){return n.post(t).fields(e).end()}}}},6125:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=4},6126:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return window.APP.restrictEditHandler.isInReadonlyProtectMode},enumerable:!1,configurable:!0}),e.prototype.isCurrentRangeNonEditable=function(){if(!this.isEnabled)return!1;var e=window.APP.data.selection.getNormalRange();return this.isRangeNonEditable(e)},e.prototype.isAnyPapxNonEditable=function(){if(!this.isEnabled)return!1;var e,t=window.APP.data.selection.getNormalRange(),n=this.getRelatedExceptions([t]);if(this.isRangeNonEditable(t,n))return!0;if(0===t.len)return e=window.APP.data.doc.datalogics.final.getPapx(t.pos),this.isRangeNonEditable(e,n);for(var i=t.pos;i<t.pos+t.len;){if(e=window.APP.data.doc.datalogics.final.getPapx(i),this.isRangeNonEditable(e,n))return!0;i=e.end}return!1},e.prototype.isRangeNonEditable=function(e,t){if(!this.isEnabled)return!1;for(var n,i,o,a=e.pos,r=e.pos+e.len,s=t||this.getRelatedExceptions([e]),l=!1,u=0;u<s.length;u++){if(o=(i=(n=s[u]).pos)+n.len,i<=a&&o>=r){l=!0;break}if(i>=a&&i<=r&&o>r){l=!1;break}if(i<a&&o>a&&o<=r){l=!1;break}if(i>r){l=!1;break}}return!l},e.prototype.isAllRangesNonEditable=function(e){var t=this;if(!this.isEnabled)return!1;var n=this.getRelatedExceptions(e);return e.every((function(e){return t.isRangeNonEditable(e,n)}))},e.prototype.isAnyRangeNonEditable=function(e){var t=this;if(!this.isEnabled)return!1;var n=this.getRelatedExceptions(e);return e.some((function(e){return t.isRangeNonEditable(e,n)}))},e.prototype.adjustEditableRange=function(e){if(!this.isEnabled)return e;var t=window.APP.data.doc.protectExceptions.getExceptions(e);if(t.length>0){var n=t[0],i=Math.max(e.pos,n.pos);return{pos:i,len:Math.min(e.pos+e.len,n.pos+n.len)-i}}return e},e.prototype.getRelatedExceptions=function(e){var t=0,n=0;e.forEach((function(e){t=Math.min(e.pos,t),n=Math.max(e.pos+e.len)}));var i={pos:t,len:n-t+1};return window.APP.data.doc.protectExceptions.getExceptions(i)},e}();t.default=i},614:function(e,t,n){"use strict";n.r(t);t.default={OType_Nake:0,OType_Data:1,OType_Vector:2,OType_Custom:3,OType_Delay_Vector:4,otModify:0,otInsert:1,otRemove:2,otMove:3,otReplaceData:4,vtDataVersion:0,vtTaskVersion:1,vtLocalCmdVersion:2,vtInitialData:3,ctCommit:0,ctCommit_UnClose:1,ctCommit_Merge:2,ctCommit_MergeAndClose:3}},626:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1583),l=function(){function e(t){o()(this,e),t?t.origin?(this.x=t.origin.x,this.y=t.origin.y):t.rect?(this.x=t.rect.left,this.y=t.rect.top):this.x=this.y=0:this.x=this.y=0}return r()(e,[{key:"vpsc_position",get:function(){var t=s.a.getZoom();return e.initWithOrigin({x:t*this.x,y:t*this.y})}}],[{key:"initWithRect",value:function(t){return new e({rect:t})}},{key:"initWithOrigin",value:function(t){return new e({origin:t})}},{key:"add",value:function(){for(var t=e.ZERO(),n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return i.forEach((function(e){var n=e||{x:0,y:0};t={x:t.x+n.x,y:t.y+n.y}})),t}},{key:"reduce",value:function(t){if(t){for(var n=t.x,i=t.y,o=arguments.length,a=Array(o>1?o-1:0),r=1;r<o;r++)a[r-1]=arguments[r];return a.forEach((function(e){n-=e.x,i-=e.y})),e.initWithOrigin({x:n,y:i})}console.error("[DOC_TYPO_POSITION] Reduce: miniend is illegal")}},{key:"ZERO",value:function(){return new e}},{key:"copy",value:function(t){return new e({origin:t})}},{key:"isEqual",value:function(e,t){return e.x===t.x&&e.y===t.y}}]),e}();t.a=l},637:function(e,t,n){var i=n(474).Symbol;e.exports=i},676:function(e,t,n){"use strict";n.r(t),n.d(t,"createElementNS",(function(){return s})),n.d(t,"createElement",(function(){return l})),n.d(t,"assignStyle2",(function(){return c})),n.d(t,"hexToRgba",(function(){return h})),n.d(t,"getPrefix",(function(){return d})),n.d(t,"enableFinally",(function(){return f}));var i=n(24),o=n.n(i),a=n(144),r=n.n(a);function s(e){var t=document.createElementNS(e.namespaceURI,e.type);return u(e,t,!0)}function l(e){var t=document.createElement(e.type);return u(e,t)}var u=function(e,t,n){var i=e.style,a=e.id,s=e.classname,l=e.parent,u=e.text,c=e.isInsertBefore,h=void 0!==c&&c,d=e.attributes;if(t.attachTo=function(e){if(h){var n=e.children||[],i=r()(n,1)[0];if(i)return void e.insertBefore(t,i)}e.appendChild(t)},s&&(t.className=s),i)switch(void 0===i?"undefined":o()(i)){case"string":t.setAttribute("style",i);break;case"object":for(var p in i)i.hasOwnProperty(p)&&(t.style[p]=i[p])}if(a&&(t.id=a),l&&t.attachTo(l),u&&(t.innerText=u),d)for(var f in d)d.hasOwnProperty(f)&&t.setAttribute(f,d[f]);return n||s||a||console.error("为了方便定位问题，创建div时，必须在创建同时，声明classname或id"),t},c=function(e,t){for(var n in t)e.style.setProperty(n,t[n])},h=function(e){var t=void 0;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3==(t=e.substring(1).split("")).length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),"rgba("+[(t="0x"+t.join(""))>>16&255,t>>8&255,255&t].join(",")+",1)";throw new Error("Bad Hex")},d=function(){var e=window.getComputedStyle(document.documentElement,"");return(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||""===e.OLink&&["","o"])[1]};function p(e){var t=function(t){return Promise.resolve(e()).then((function(){return t}))};return this.then((function(e){return t(e)}),(function(e){return t(Promise.reject(e))}))}function f(e){return e.finally||(e.finally=p),e}!function(e){Promise.prototype.finally=Promise.prototype.finally||p,HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var i=atob(this.toDataURL(t,n).split(",")[1]),o=i.length,a=new Uint8Array(o),r=0;r<o;r++)a[r]=i.charCodeAt(r);e(new Blob([a],{type:t||"image/png"}))}});var t=e.Element.prototype;"function"!=typeof t.matches&&(t.matches=t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=0;t[n]&&t[n]!==this;)++n;return Boolean(t[n])}),"function"!=typeof t.closest&&(t.closest=function(e){for(var t=this;t&&1===t.nodeType;){if(t.matches(e))return t;t=t.parentNode}return null})}(window)},677:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i={LOCAL:"LOCAL",FILTER:"FILTER",SELECTION:"SELECTION",SHAPE:"SHAPE"},o={CONTINUE:0,BLOCK:1,DONE:2}},684:function(e,t,n){"use strict";n.r(t),n.d(t,"TYPO_MODE",(function(){return i}));var i={MODE_PC:0,MODE_MOBILE:1,MODE_WEB:2,MODE_PAGINATION:3}},691:function(e,t,n){"use strict";n.r(t),n.d(t,"isSpecialPlaceholder",(function(){return o})),n.d(t,"isInvalidPlaceholderInComment",(function(){return a})),n.d(t,"isFieldPlaceholder",(function(){return r}));var i=n(324),o=function(e){return new Set([i.g,i.f,i.j,i.l,i.m,i.k,i.i,i.q,i.a,i.d,i.e]).has(e)},a=function(e){return[i.g,i.f,i.m,i.k,i.i,i.q,i.a,i.d,i.e,i.n,i.p,i.o].includes(e)},r=function(e){return e===i.n||e===i.p||e===i.o}},698:function(e,t,n){"use strict";n.r(t),n.d(t,"getPureText",(function(){return r})),n.d(t,"getPureTextExcludeSpecialPlaceholder",(function(){return s})),n.d(t,"getDeletedTextFromString",(function(){return u})),n.d(t,"getDeletedTextFromRange",(function(){return c})),n.d(t,"getText",(function(){return h})),n.d(t,"filterSpecialPlaceholder",(function(){return d}));var i=n(691),o=n(760),a=n(324);function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments[2],i=arguments[3],a=e.selection,r=e.doc,s="",l=n||a.getNormalRanges();l.length>1&&l.sort((function(e,t){return e.pos-t.pos}));for(var u=0;u<l.length;++u){var c=l[u];c.len<=0||(s+=Object(o.filterText)(r.getText(c.pos,c.len),t,i))}return s}function s(e,t){return r(e,i.isSpecialPlaceholder,t)}function l(e){return e!==a.q&&Object(i.isSpecialPlaceholder)(e)}function u(e){if(e&&1===e.length&&Object(i.isSpecialPlaceholder)(e.charCodeAt(0)))return e;var t=Object(o.filterTab)(Object(o.filterText)(e,l));return t.length>100?t.substr(0,50)+"..."+t.substr(t.length-50,50):t}function c(e,t,n){return u(r(e,void 0,[{pos:t,len:n}]))}function h(e){return r(window.APP.data,(function(e){return![13,10].includes(e)&&Object(i.isSpecialPlaceholder)(e)}),[e])}function d(e){return Object(o.filterText)(e,i.isSpecialPlaceholder)}},7121:function(e,t,n){"use strict";var i,o=n(13),a=n.n(o),r=n(1),s=n.n(r),l=n(2),u=n.n(l),c=n(4576),h=(i=void 0,function(e){return e&&(i=e),i}),d=function(){function e(){if(s()(this,e),h())return h();h(this)}return u()(e,null,[{key:"isSubScript",value:function(e){return e<0}},{key:"isSuperScript",value:function(e){return e>0}},{key:"measureChars",value:function(t,n){var i=n.chpx;if(!(i.getPropVal("o_math")&&t.pMathMgr&&i.getPropVal("special"))){!1;var o=i.getPropVal("script_pos");o&&(t.fontArg.fontSize=c.a.calcFontSizeForSubOrSuperScript({},e.isSubScript(o),t.fontArg.fontSize,t.fontArg.fontFamily))}}}]),e}(),p=n(723),f=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),g=function(){function e(){if(s()(this,e),f())return f();f(this)}return u()(e,null,[{key:"needUpcase",value:function(e,t,n){if(p.a.isLowerAlpha(n.getCharCode(e)))return!0;if(p.a.isGeorgianMkhedruli(n.getCharCode(t.begin)))return!1;if(1===t.len){var i=n.getChar(e);return i!=i.toUpperCase()}return!1}},{key:"measureChars",value:function(t,n,i,o){var a=n.chpx;switch(!0){case a.getPropVal("small_caps"):if(e.needUpcase(i,n,o)){var r=t.fontArg;r.fontSize=.8*r.fontSize,o.toUpperAlpha(i,i+n.len)}n.setLowerAlphaSmallCapsFlag();break;case a.getPropVal("caps"):e.needUpcase(i,n,o)&&o.toUpperAlpha(i,i+n.len)}}}]),e}(),v=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),m=["Wingdings 2"];var _=function(){function e(){if(s()(this,e),v())return v();v(this)}return u()(e,null,[{key:"measureChars",value:function(e,t,n,i){var o=t.chpx,a=o.getPropVal("symbol_char"),r=o.getPropVal("symbol_fontname");if(0!=a||0!=r){var s=n+t.len,l=e.fontArg,u=l.fontTable.getName(r);l.fontFamily=u;var c=function(e){return m.includes(e)}(u);i.buffs.forEach(n,s,(function(e,t,n){if(p.a.isTextSymbol(t[n].charCode)){var i=c?61440|a:a;t[n].charCode=i,t[n].char=String.fromCharCode(i)}}))}}}]),e}(),y=n(3857),b=n(1318),T=b.c.DOCCharTypeFastDetecter,C=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),k={"方正小标宋简体":{def:.99,57:.98684211},"FZXiaoBiaoSong-B05S":{def:.99,57:.98684211},"方正仿宋_GBK":{def:.99,90:1.00734976},"方正黑体_GBK":{def:.99},"方正小标宋_GBK":{def:.99,39:.98157051},"FZXiaoBiaoSong-B05":{def:.99,39:.98157051},"方正魏碑_GBK":{def:.99},"方正书宋_GBK":{def:.99},"方正隶书_GBK":{def:.99},"方正楷体_GBK":{def:.99},"方正兰亭大黑_GBK":{def:.99},"方正大标宋简体":{def:.99431818},"仿宋_GB2312":{def:.99354619},FangSong_GB2312:{def:.99354619},"华文中宋":{def:.99,39:.99487182},"方正粗宋简体":{def:.99,39:.9815705128205129}};function w(e,t){var n=k[e];return n&&(n[t]||n.def)||1}var S=function(){function e(){if(s()(this,e),C())return C();this.specialScales=[.42,.43,.44,.45,.46,.47,.5,.53,.56,.57,.58,.59,.6,.63,.66,.67,.68,.7,.8,.83,.88,.89,1],C(this)}return u()(e,null,[{key:"measureChars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=e.scale;if(o&&100!=o){if(!t.isVisible())return;var a=o/100,r=w(e.fontArg.fontFamily,o),s=n,l=n+t.len,u=i.getMi(s);if(u.shared){var c=i.getMi(l-1);c&&!c.shared&&t.len>=2?s=n+t.len-2:l=s+1}for(var h=s;h<l;++h){u=i.getMi(h);var d=i.getCharCode(h),p=t.isFarEast()&&T.isTxRealAsia(T.getUsrType(d));u.scale=a,p?(u.width*=a*r,u.minWidth*=a*r,u.lineHeaderWidth*=a*r,u.lineTailWidth*=a*r):(u.width*=a,u.minWidth*=a,u.lineHeaderWidth*=a,u.lineTailWidth*=a),u.realWidth=u.width}}}}]),e}(),P=S,I=n(3858),E=n(2956),O=n(5736),x=n(336),R=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),N=[183,12317,65113,65115,65117,65284,65505,65509],A=[8216,8220,12310],D=[8216,8220,12296,12298,12300,12302,12304,12308,12310,65288,65339,65371],M=[12317,65113,65115,65117,65284,65505,65509],L=[168,176,711,713,8213,8214,8230,8240,8242,8243,8250,8451,8758,12291,12318,65078,65082,65086,65088,65092,65114,65116,65118,65282,65285,65311,65344,65372,65374,65504],F=[183,8217,8221,12289,12290,12311,65281,65287,65292,65294,65306,65307],B=[183,8217,8221,12289,12290,12297,12299,12301,12303,12305,12309,12311,65281,65287,65289,65292,65294,65306,65307,65341,65373];function H(e,t){for(var n=0,i=t.length-1;n<=i;){var o=n+i>>1,a=t[o];if(e<a)i=o-1;else{if(!(e>a))return o;n=o+1}}return-n-1}function G(e,t,n,i,o){if(H(t,N)>-1)return!1;if(p.a.isTailPunc(t))switch(i){case 1028:if(H(t,A)<0)return!1;break;default:return!1}switch(o){case 1028:return H(n,A)<0;case 18:return H(n,D)<0;default:return!0}}function W(e,t,n){if(H(e,M)>-1||H(e,L)>-1)return!1;switch(n){case 1028:return H(t,F)<0;case 18:return H(t,B)<0;default:return!0}}var j=function(){function e(){if(s()(this,e),R())return R();R()}return u()(e,null,[{key:"measureChars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4],a=arguments[6],r=!0,s=t.chpx,l=s.getPropVal("kerning")&&Object(x.Ti2Px)(parseInt(s.getPropVal("kerning")));if((!e.bKerningPunc||!l||l>e.fontArg.fontSize||I.d==e.gridMode&&e.viewSetting&&e.viewSetting.getNoUseAsianBreakRulesInCharGrid())&&(r=!1),!(t.isSpec()||t.isHidden()||t.isRevisionHidden())){var u=o[n],h=a.getMi(u),d=a.getCharCode(u),f=Object(O.a)(s.getPropVal("east_asia_language")||""),g=!(65281!==d||1041!==f&&1028!==f),v=!1;if(p.a.isHeadCompressPunc(d)){var m=void 0,_=void 0;n>0?(m=i[n-1],_=o[n-1],v=u>0):(m=t.getPrevNode()).isTree()?m=null:_=m.begin,e.useWord97LineBreakRule&&m&&m.isFarEast()&&p.a.isTailPunc(a.getCharCode(_+m.len-1))&&v||(h.minWidth=.5*h.width),h.lineHeaderWidth*=.5}if(!g&p.a.isTailCompressPunc(d)&&(h.minWidth=.5*h.width,h.lineTailWidth=.5*h.width),r){var y=s.getPropVal("share_hint")||0;if(p.a.isHeadCompressPunc(d)){var T=void 0,C=void 0;if(n>0?(T=i[n-1],C=o[n-1]):(T=t.getPrevNode()).isTree()?T=null:C=T.begin,!T||T.isComplex())return;var k=Object(O.a)(T.chpx.getPropVal("east_asia_language")||""),w=a.getCharCode(C+T.len-1);if(0==w||!p.a.isJPNSpecPunc(w)&&!p.a.isHeadPunc(w)&&!p.a.isTailPunc(w))return;var S=k;if(!G(0,w,d,S,f))return;var P=T.chpx.getPropVal("share_hint")||0,R=T.chpx.getPropVal("kerning"),N=c.a.calcFontsize(T.chpx,P===E.b||T.isGlyphComplex());if(!R||R>N)return;var A=T.charInfo.charClass;(b.a.CC_FarEast==A||b.a.CC_Shared==A&&(y==E.c||e.bWordWrap))&&(h.width*=.5,h.minWidth=h.width,h.lineTailWidth=h.width,h.dispOffset=-h.width,t.setPuncAdjustedFlag())}else if(!g&&!p.a.isJPNSpecPunc(d)&&p.a.isTailCompressPunc(d)){var D=void 0,M=void 0;if(n<i.length-1?(D=i[n+1],M=o[n+1]):(D=t.getNextNode()).isTree()?D=null:M=D.begin,!D||D.isComplex())return;var L=a.getCharCode(M);if(0==L||!p.a.isHeadPunc(L)&&!p.a.isTailPunc(L))return;if(!W(L,d,f))return;var F=D.chpx.getPropVal("share_hint")||0,B=Object(x.Ti2Px)(parseInt(D.chpx.getPropVal("kerning"))),H=c.a.calcFontsize(D.chpx,F===E.b||D.isGlyphComplex());if(!B||B>H)return;var j=D.charInfo.charClass;(b.a.CC_FarEast==j||b.a.CC_Shared==j&&(F==E.c||e.bWordWrap))&&(h.width*=.5,h.minWidth=h.width,h.lineTailWidth=h.width,h.lineHeaderWidth=h.width,t.setPuncAdjustedFlag())}}}}}]),e}(),U=n(1910),V=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),Y=function(){function e(){if(s()(this,e),V())return V();this.spacingPolicy={normal:{getSpacing:function(e,t){return t},isAdjNeeded:function(){return!0}},contentNode:{getSpacing:function(e,t){return e!=b.a.CC_FarEast?0:t},isAdjNeeded:function(e){return e.charInfo.charClass==b.a.CC_FarEast}}},this.setSpacingPolicyInUse("normal"),V(this)}return u()(e,[{key:"setSpacingPolicyInUse",value:function(e){switch(e){case"normal":this.spacingPolicyInUse=this.spacingPolicy.normal;break;case"content":this.spacingPolicyInUse=this.spacingPolicy.contentNode;break;default:this.spacingPolicyInUse=this.spacingPolicy.normal}}},{key:"measureCharSpacing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4],a=arguments[5],r=arguments[6],s=arguments[7],l=this.spacingPolicyInUse.isAdjNeeded;if(n.isVisible()&&!n.isComplex()){var u=void 0;i>0?u=o[i-1]:(u=n.getPrevNode()).isTree()&&(u=null);var c=a[i];if(1==n.len){if(!l(u))return;if(n.isEmbedDrawing())return;var h=s.getMi(c);if(h.shared){var d=h.clone();delete d.shared,s.setMi(c,d),h=d}e.bHaveAsiaAnsiAdj&&(h.width=Math.max(0,Math.round(h.width)+.5*t),h.lineHeaderWidth=Math.max(0,h.lineHeaderWidth+.5*t));var f=s.getCharCode(c);if(p.a.isLineBreak(f))return;if(e.bDiffSBMB){if(e.bUseCJKFont||e.bPuncSpec&&p.a.isPunc(f))return void(U.a.isKanaSpec(e,f)?h.addWidth(t):h.addWidth(2*t));if(p.a.isNormalSpace(f))return!e.bWordWrap&&U.a.betweenWestWriteLetters(e,n,i,o,a,r,s)?(h.addWidth(t),void(h.minWidth=Math.max(0,h.minWidth-.5*t))):void h.addWidth(2*t)}h.addWidth(t)}else{var g=c;g>0&&!l(u)&&++g;for(var v=c+n.len;g<v;++g){var m=s.getMi(g);if(m.shared){var _=m.clone();delete _.shared,s.setMi(g,_),m=_}e.bHaveAsiaAnsiAdj&&g+1==v&&(m.width=Math.max(0,Math.round(m.width)+.5*t),m.lineHeaderWidth=Math.max(0,m.lineHeaderWidth+.5*t)),e.bDiffSBMB&&e.bUseCJKFont?U.a.isKanaSpec(e,s.getCharCode(g))?m.addWidth(t):m.addWidth(2*t):m.addWidth(t)}}}}},{key:"measureChars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4],a=arguments[5],r=arguments[6],s=this.spacingPolicyInUse.getSpacing,l=Object(x.Ti2Px)(s(e.charClass,e.spacing));l&&this.measureCharSpacing(e,l,t,n,i,o,a,r)}}]),e}(),z=n(7205),K=n(5738),Z=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),X=function(){function e(){if(s()(this,e),Z())return Z();Z(this)}return u()(e,null,[{key:"measureChars",value:function(){var e=arguments[1],t=e.chpx,n=Object(K.a)(t.getPropVal("east_asia_language"),t.getPropVal("emphasis_type"));n.renderAbove?e.setAboveTextEmphasisMarkFlag():e.setBelowTextEmphasisMarkFlag(),n.renderText&&e.font&&window.APP.fontServer.requestLoadEmphasize(e.font.fontFamily,n.renderText,e)}}]),e}(),q=n(5739),J=function(){function e(){s()(this,e)}return u()(e,null,[{key:"measureChars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4],a=arguments[5],r=arguments[6];if(t.isVisible()&&!t.isSpec()&&!t.isEmbedDrawing()){var s=e.srcGridWidth,l=e.srcGridWidth;e.bDiffSBMB&&(l*=.5);var u=!1;e.isRealComplex;for(var c=o[n],h=c+t.len;c<h;++c){var d=r.getCharCode(c);u=!!(e.bUseCJKFont||e.bPuncSpec&&p.a.isPunc(d));var f=r.getMi(c);if(f.shared){var g=f.clone();delete g.shared,r.setMi(c,g),f=g}if(e.bHaveAsiaAnsiAdj&&c+1==h){var v=u?s:l;f.width=Math.max(0,f.width+.25*v),f.lineHeaderWidth=Math.max(0,f.lineHeaderWidth+.25*v)}if(!p.a.isLineBreak(d)){if(p.a.isComplex(d),e.bDiffSBMB){if(u){U.a.isKanaSpec(e,d)?f.addWidth(.5*s):f.addWidth(s);continue}if(p.a.isNormalSpace(d)&&e.bWordWrap&&U.a.betweenWestWriteLetters(e,t,n,i,o,a,r)){f.addWidth(l),f.charWidth=Math.max(0,f.charWidth-.5*l);continue}}f.addWidth(u?s:l)}}}}}]),e}(),Q=new Map([["32_65",-113],["32_84",-37],["32_86",-37],["32_87",-37],["32_89",-76],["32_902",-113],["32_913",-113],["32_916",-113],["32_923",-113],["32_932",-37],["32_933",-76],["32_939",-76],["49_49",-76],["65_32",-113],["65_84",-227],["65_86",-264],["65_87",-164],["65_89",-188],["65_118",-152],["65_119",-188],["65_121",-188],["65_8217",-227],["70_44",-164],["70_46",-164],["70_65",-152],["76_32",-76],["76_84",-188],["76_86",-188],["76_87",-152],["76_89",-205],["76_121",-113],["76_8217",-188],["80_32",-76],["80_44",-227],["80_46",-227],["80_65",-188],["82_84",-123],["82_86",-164],["82_87",-113],["82_89",-113],["82_121",-82],["84_32",-37],["84_44",-152],["84_45",-188],["84_46",-152],["84_58",-102],["84_65",-164],["84_79",-37],["84_97",-143],["84_99",-143],["84_101",-143],["84_105",-72],["84_111",-143],["84_114",-72],["84_115",-143],["84_117",-72],["84_119",-143],["84_121",-143],["84_894",-113],["86_32",-37],["86_44",-264],["86_45",-188],["86_46",-264],["86_58",-152],["86_65",-264],["86_97",-227],["86_101",-227],["86_105",-123],["86_111",-264],["86_114",-123],["86_117",-123],["86_121",-227],["86_894",-152],["87_32",-37],["87_44",-188],["87_45",-113],["87_46",-188],["87_58",-76],["87_65",-227],["87_97",-164],["87_101",-164],["87_105",-82],["87_111",-164],["87_114",-82],["87_117",-82],["87_121",-123],["87_894",-76],["89_32",-76],["89_44",-264],["89_45",-227],["89_46",-264],["89_58",-188],["89_65",-227],["89_97",-205],["89_101",-205],["89_105",-113],["89_111",-205],["89_112",-188],["89_113",-227],["89_117",-227],["89_118",-205],["89_894",-188],["102_102",-37],["102_8217",113],["114_44",-82],["114_45",-41],["114_46",-113],["114_103",-37],["114_8217",76],["118_44",-133],["118_46",-133],["119_44",-133],["119_46",-133],["121_44",-133],["121_46",-133],["902_32",-113],["902_920",-84],["902_927",-84],["902_932",-225],["902_933",-311],["902_934",-84],["902_939",-311],["902_947",-141],["902_957",-152],["902_967",-141],["908_913",-98],["908_916",-51],["908_923",-98],["908_933",-102],["908_939",-102],["910_913",-336],["910_916",-256],["910_920",-182],["910_923",-336],["910_927",-182],["910_934",-233],["910_937",-182],["910_940",-205],["910_942",-113],["910_943",-113],["910_945",-205],["910_948",-170],["910_951",-113],["910_953",-113],["910_954",-162],["910_956",-162],["910_959",-205],["910_963",-229],["910_966",-205],["910_970",-113],["910_972",-205],["911_933",-102],["913_32",-113],["913_920",-84],["913_927",-84],["913_932",-225],["913_933",-311],["913_934",-84],["913_939",-311],["913_947",-141],["913_957",-152],["913_967",-141],["913_8217",-225],["915_44",-246],["915_46",-246],["915_912",76],["915_913",-317],["915_916",-242],["915_923",-317],["915_953",-72],["916_32",-113],["916_927",-37],["916_932",-141],["916_933",-190],["916_939",-190],["920_913",-98],["920_916",-51],["920_923",-98],["920_933",-102],["920_939",-102],["922_920",-141],["922_927",-141],["922_932",-90],["922_934",-141],["922_940",-76],["922_945",-76],["922_948",-76],["922_950",-76],["922_952",-76],["922_958",-76],["922_963",-76],["922_966",-76],["922_969",-76],["922_974",-76],["923_32",-53],["923_920",-84],["923_927",-84],["923_932",-225],["923_933",-311],["923_939",-311],["927_913",-98],["927_916",-51],["927_923",-98],["927_933",-102],["927_939",-102],["929_44",-225],["929_46",-225],["929_913",-186],["929_916",-160],["929_923",-186],["931_964",-37],["932_32",-37],["932_44",-152],["932_45",-186],["932_46",-152],["932_58",-100],["932_894",-100],["932_912",76],["932_913",-164],["932_916",-172],["932_920",-37],["932_923",-221],["932_927",-37],["932_934",-37],["932_937",-37],["932_940",-141],["932_941",-141],["932_945",-141],["932_947",-102],["932_948",-141],["932_949",-141],["932_951",-76],["932_953",-72],["932_956",-76],["932_957",-72],["932_959",-141],["932_963",-141],["932_966",-141],["932_967",-72],["932_968",-76],["932_971",-76],["932_972",-141],["932_973",-76],["933_32",-76],["933_44",-262],["933_45",-225],["933_46",-254],["933_58",-186],["933_894",-186],["933_913",-336],["933_916",-256],["933_920",-182],["933_923",-336],["933_927",-182],["933_934",-233],["933_937",-182],["933_940",-205],["933_942",-113],["933_943",-113],["933_945",-205],["933_947",-207],["933_948",-170],["933_951",-113],["933_953",-113],["933_954",-162],["933_956",-162],["933_959",-205],["933_963",-229],["933_966",-205],["933_970",-113],["933_972",-205],["934_913",-98],["934_933",-154],["934_939",-154],["935_969",-66],["935_974",-66],["936_940",-131],["936_945",-131],["936_948",-131],["936_952",-37],["936_959",-131],["936_963",-131],["936_966",-131],["936_969",-131],["936_972",-131],["936_974",-131],["937_933",-102],["937_939",-102],["939_32",-76],["939_913",-336],["939_916",-256],["939_920",-182],["939_923",-336],["939_927",-182],["939_934",-182],["939_937",-182],["939_940",-205],["939_942",-113],["939_943",-113],["939_945",-205],["939_948",-170],["939_951",-113],["939_953",-113],["939_954",-162],["939_956",-162],["939_959",-205],["939_963",-229],["939_966",-205],["939_970",-113],["939_972",-205],["947_949",-35],["950_940",-74],["950_942",-80],["950_945",-74],["950_947",-74],["950_948",-74],["950_951",-80],["950_952",-74],["950_953",-121],["950_954",-59],["950_957",-74],["950_959",-76],["950_963",-74],["950_964",-150],["950_966",-74],["950_969",-74],["950_972",-74],["950_974",-74],["954_940",-18],["954_945",-18],["954_948",-45],["954_958",-45],["954_959",-45],["954_962",-45],["954_963",-45],["954_966",-18],["954_969",-18],["954_972",-45],["954_974",-18],["955_942",-18],["955_944",-37],["955_951",-18],["955_953",-25],["955_954",-18],["955_957",-39],["955_965",-37],["955_971",-37],["955_973",-37],["958_940",-76],["958_945",-76],["958_948",-76],["958_950",-76],["958_958",-76],["958_959",-76],["958_962",-76],["958_963",-76],["958_966",-76],["958_972",-76],["967_940",-45],["967_945",-45],["967_948",-45],["967_959",-45],["967_962",-45],["967_963",-45],["967_966",-45],["967_969",-45],["967_972",-45],["967_974",-45],["1027_44",-283],["1027_46",-283],["1027_171",-129],["1027_187",-51],["1027_8212",-51],["1033_8217",-102],["1034_8217",-102],["1040_1047",-51],["1040_1054",-102],["1040_1057",-102],["1040_1058",-180],["1040_1059",-180],["1040_1060",-129],["1040_1063",-311],["1040_1069",-51],["1040_1072",-27],["1040_1073",-104],["1040_1077",-51],["1040_1086",-104],["1040_1089",-51],["1040_1090",-102],["1040_1091",-102],["1040_1092",-78],["1040_8217",-180],["1041_1040",-27],["1041_1044",-78],["1041_1046",-51],["1041_1051",-51],["1041_1054",-14],["1041_1057",-14],["1041_1058",-27],["1041_1059",-72],["1041_1060",-31],["1041_1061",-51],["1041_1063",-102],["1041_1066",-78],["1041_1071",-68],["1041_1076",-51],["1041_1083",-27],["1041_1091",-51],["1042_1040",-129],["1042_1044",-78],["1042_1046",-51],["1042_1051",-78],["1042_1058",-27],["1042_1059",-166],["1042_1061",-51],["1042_1063",-102],["1042_1066",-109],["1042_1071",-102],["1042_1076",-51],["1042_1091",-27],["1042_1093",-27],["1042_1095",-51],["1043_44",-231],["1043_46",-231],["1043_171",-129],["1043_187",-51],["1043_1040",-223],["1043_1044",-180],["1043_1047",51],["1043_1051",-154],["1043_1052",-27],["1043_1054",-51],["1043_1057",-27],["1043_1071",-154],["1043_1072",-51],["1043_1074",-78],["1043_1076",-154],["1043_1077",-156],["1043_1080",-78],["1043_1083",-154],["1043_1084",-78],["1043_1085",-78],["1043_1086",-180],["1043_1088",-129],["1043_1091",-78],["1043_1099",-129],["1043_1100",-129],["1043_1102",-102],["1043_1103",-154],["1043_8212",-51],["1044_1047",51],["1044_1059",25],["1044_1069",51],["1044_1077",25],["1044_1079",51],["1045_1047",25],["1045_1051",-27],["1046_1047",-51],["1046_1054",-51],["1046_1057",-51],["1046_1058",-35],["1046_1059",-29],["1046_1066",-20],["1046_1072",-51],["1046_1073",-102],["1046_1077",-104],["1046_1086",-104],["1046_1091",-100],["1047_1044",-125],["1047_1046",-27],["1047_1051",-90],["1047_1059",-51],["1047_1063",-78],["1047_1071",-78],["1047_1076",-51],["1047_1083",-27],["1050_1054",-51],["1050_1057",-51],["1050_1059",-41],["1050_1060",-90],["1050_1063",-27],["1050_1069",25],["1050_1072",-27],["1050_1077",-78],["1050_1079",-27],["1050_1086",-102],["1050_1089",-51],["1050_1090",-78],["1050_1091",-154],["1050_1101",-27],["1051_1060",-27],["1051_1073",-27],["1051_1077",-14],["1051_1086",-51],["1051_1091",-51],["1052_1060",-27],["1052_1077",-27],["1052_1086",-51],["1052_1091",-51],["1052_1095",-78],["1054_1040",-102],["1054_1044",-102],["1054_1046",-51],["1054_1051",-102],["1054_1057",25],["1054_1059",-115],["1054_1060",25],["1054_1061",-160],["1054_1063",-51],["1054_1071",-147],["1054_1076",-27],["1056_44",-256],["1056_46",-256],["1056_58",76],["1056_187",51],["1056_894",76],["1056_1040",-262],["1056_1044",-154],["1056_1046",-72],["1056_1047",25],["1056_1051",-154],["1056_1054",25],["1056_1057",25],["1056_1058",25],["1056_1059",-51],["1056_1060",-35],["1056_1061",-145],["1056_1071",-129],["1056_1076",-78],["1056_1077",-27],["1056_1086",-51],["1056_1101",51],["1056_1103",-78],["1057_1040",-102],["1057_1044",-102],["1057_1051",-51],["1057_1059",-27],["1057_1061",-53],["1057_1063",-51],["1057_1066",-27],["1057_1073",25],["1057_1077",25],["1057_1089",25],["1057_1090",-27],["1057_1091",-51],["1057_1095",-27],["1057_1101",25],["1058_44",-205],["1058_46",-205],["1058_171",-102],["1058_187",-53],["1058_1040",-102],["1058_1044",-129],["1058_1051",-102],["1058_1052",-27],["1058_1054",-27],["1058_1060",-45],["1058_1071",-78],["1058_1072",-51],["1058_1074",-102],["1058_1077",-78],["1058_1080",-51],["1058_1082",-51],["1058_1083",-102],["1058_1084",-51],["1058_1086",-154],["1058_1087",-78],["1058_1088",-78],["1058_1089",-78],["1058_1091",-102],["1058_1093",-102],["1058_1097",-78],["1058_1099",-102],["1058_1100",-129],["1058_1102",-102],["1058_1103",-78],["1059_44",-334],["1059_46",-334],["1059_58",-78],["1059_171",-180],["1059_187",-129],["1059_894",-78],["1059_1040",-391],["1059_1044",-207],["1059_1047",-27],["1059_1051",-231],["1059_1054",-102],["1059_1060",-152],["1059_1069",-27],["1059_1071",-231],["1059_1073",-129],["1059_1074",-231],["1059_1075",-180],["1059_1076",-287],["1059_1077",-246],["1059_1078",-180],["1059_1079",-180],["1059_1080",-180],["1059_1081",-102],["1059_1082",-180],["1059_1083",-231],["1059_1084",-180],["1059_1085",-180],["1059_1086",-231],["1059_1087",-180],["1059_1088",-180],["1059_1089",-246],["1059_1093",-205],["1059_1094",-180],["1059_1096",-180],["1059_1097",-180],["1059_1102",-180],["1059_1103",-231],["1059_8212",-51],["1060_1040",-129],["1060_1044",-180],["1060_1051",-154],["1060_1054",25],["1060_1058",-51],["1060_1059",-156],["1060_1063",-129],["1060_1071",-180],["1060_1083",-102],["1061_1047",-51],["1061_1054",-104],["1061_1057",-78],["1061_1060",-180],["1061_1069",-27],["1061_1086",-129],["1061_1091",-180],["1062_1054",-27],["1062_1086",-27],["1065_1091",25],["1066_1071",-123],["1066_8217",-129],["1068_1040",-88],["1068_1044",-150],["1068_1046",-129],["1068_1047",-78],["1068_1051",-82],["1068_1052",-82],["1068_1054",-51],["1068_1057",-51],["1068_1058",-154],["1068_1061",-147],["1068_1063",-229],["1068_1069",-27],["1068_1071",-109],["1068_8217",-129],["1069_1044",-172],["1069_1046",-51],["1069_1047",25],["1069_1051",-129],["1069_1054",25],["1069_1060",10],["1069_1061",-104],["1069_1071",-111],["1069_1076",-51],["1069_1083",-27],["1070_1040",-78],["1070_1044",-154],["1070_1046",-143],["1070_1051",-102],["1070_1054",25],["1070_1058",-51],["1070_1061",-186],["1070_1063",-78],["1070_1076",-51],["1070_1078",25],["1070_1083",-27],["1072_1083",18],["1072_1087",-27],["1072_1090",-53],["1072_1091",-104],["1072_1095",-82],["1073_1076",-51],["1073_1077",-27],["1073_1078",-51],["1073_1083",-51],["1073_1084",-20],["1073_1091",-78],["1073_1093",-78],["1073_1095",-78],["1073_1098",-51],["1073_1103",-51],["1074_1072",-27],["1074_1073",-27],["1074_1076",-51],["1074_1077",-12],["1074_1078",-59],["1074_1083",-27],["1074_1084",-35],["1074_1086",-14],["1074_1089",-12],["1074_1090",-51],["1074_1091",-70],["1074_1092",-27],["1074_1095",-78],["1074_1098",-51],["1074_1103",-27],["1075_44",-231],["1075_46",-231],["1075_1076",-102],["1075_1077",-27],["1075_1083",-104],["1075_1084",-27],["1075_1086",-51],["1075_1103",-51],["1076_1079",25],["1076_1101",51],["1077_101",25],["1077_1072",25],["1077_1076",-27],["1077_1079",25],["1077_1089",51],["1077_1091",-51],["1077_1092",25],["1077_1093",-27],["1077_1095",-51],["1078_1073",-27],["1078_1077",-27],["1078_1079",25],["1078_1086",-51],["1078_1089",-37],["1078_1095",-51],["1078_1098",-27],["1079_1076",-37],["1079_1078",-37],["1079_1079",25],["1079_1084",-29],["1079_1086",-12],["1079_1091",-43],["1079_1092",-14],["1079_1095",-41],["1079_1098",-35],["1082_171",-53],["1082_1072",-31],["1082_1073",-51],["1082_1077",-51],["1082_1079",-27],["1082_1086",-104],["1082_1089",-51],["1082_1090",-27],["1082_1091",-29],["1082_1092",-51],["1082_1095",-80],["1082_1101",-27],["1084_1072",-14],["1084_1101",25],["1086_1076",-59],["1086_1077",25],["1086_1078",-51],["1086_1083",-27],["1086_1084",-39],["1086_1089",51],["1086_1090",-27],["1086_1091",-78],["1086_1093",-51],["1086_1095",-53],["1086_1101",25],["1086_1103",-39],["1088_1076",-27],["1088_1079",25],["1088_1083",-27],["1088_1084",-31],["1088_1090",-27],["1088_1091",-27],["1088_1095",-51],["1088_1101",51],["1089_1072",25],["1089_1073",25],["1089_1077",25],["1089_1079",51],["1089_1091",-27],["1089_1092",25],["1089_1093",-27],["1089_1095",-41],["1089_1101",25],["1090_44",-154],["1090_46",-154],["1090_1072",25],["1090_1076",-27],["1090_1078",25],["1090_1079",25],["1090_1083",-51],["1090_1086",-27],["1090_1088",25],["1090_1089",25],["1090_1091",-27],["1090_1101",51],["1090_1103",-27],["1091_44",-205],["1091_46",-205],["1091_58",-27],["1091_187",51],["1091_894",-27],["1091_1072",-27],["1091_1073",-27],["1091_1076",-129],["1091_1077",-27],["1091_1078",-27],["1091_1083",-90],["1091_1084",-27],["1091_1086",-51],["1091_1092",-51],["1091_1103",-51],["1092_1076",-51],["1092_1083",-51],["1092_1091",-51],["1092_1092",-12],["1092_1095",-55],["1092_1103",-27],["1093_1072",-27],["1093_1073",-78],["1093_1077",-51],["1093_1079",-27],["1093_1086",-78],["1093_1089",-59],["1093_1090",-51],["1093_1091",-78],["1093_1092",-78],["1093_1095",-102],["1093_1098",-78],["1093_1101",-27],["1094_1079",25],["1100_1090",-78],["1100_1095",-156],["1101_1076",-106],["1101_1078",-76],["1101_1083",-37],["1101_1084",-18],["1101_1092",-12],["1101_1093",-80],["1101_1103",-27],["1102_1076",-104],["1102_1078",-51],["1102_1083",-51],["1102_1084",-27],["1102_1090",-27],["1102_1092",-12],["1102_1093",-80],["1102_1095",-78],["1118_44",-205],["1118_46",-205],["1118_187",25],["1168_44",-203],["1168_46",-203],["1168_58",-51],["1168_171",-180],["1168_187",-78],["1168_894",-51],["1168_8212",-51],["8216_8216",-152],["8217_32",-152],["8217_115",-113],["8217_116",-37],["8217_8217",-152],["8218_1026",-205],["8218_1035",-205],["8218_1058",-205],["8218_1063",-385],["8218_1066",-205],["8222_1026",-205],["8222_1035",-205],["8222_1058",-205],["8222_1063",-385],["8222_1066",-205]]),$=new Map([["Times New Roman",Q]]);function ee(e,t,n){var i=$.get(e);if(i){var o=t+"_"+n,a=i.get(o);return a||0}return 0}var te=b.c.DOCCharTypeFastDetecter,ne=function(){var e=void 0;return function(t){return t&&(e=t),e}}();function ie(e,t,n,i){var o=null;return e<n.length-1?o=n[e+1]:(o=t.getNextNode()).isTree()&&(o=null),o}function oe(e,t,n,i){var o=!1,a=void 0;if(t+1<n)o=!0,a=e.getCharCode(t+1);else{if(!i)return{bRet:!1};o=!1,a=e.getCharCode(i.begin)}return{bRet:!0,inCurSpan:o,nextCharCode:a}}function ae(e,t,n){var i=t.getPropVal("kerning")&&Object(x.Ti2Px)(parseInt(t.getPropVal("kerning")));return!i||i>n.fontArg.fontSize||(e.getPropVal("font_size_normal")!==t.getPropVal("font_size_normal")||e.getPropVal("bold")!==t.getPropVal("bold")||e.getPropVal("italic")!==t.getPropVal("italic")||e.getPropVal("strike")!==t.getPropVal("strike")||e.getPropVal("double_strike")!==t.getPropVal("double_strike")||e.getPropVal("script_pos")!==t.getPropVal("script_pos")||e.getPropVal("snap_to_grid")!==t.getPropVal("snap_to_grid")||e.getPropVal("position")!==t.getPropVal("position"))}function re(e,t,n){var i=te.getUnicodeCharItem(t),o=U.a.getFontIndex({},i.charClass,e);return n.fontArg.fontFamily!==n.fontArg.fontTable.getName(o)}var se=function(){function e(){if(s()(this,e),ne())return ne();ne(this)}return u()(e,null,[{key:"measureChars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4],a=arguments[6];if(!e.bUseCJKFont&&!e.isRealComplex&&e.bHasKerning&&!(t.isHidden()||t.isRevisionHidden()||t.isSpecHidden()&&!t.isDrawing())){var r=t.chpx,s=r.getPropVal("kerning")&&Object(x.Ti2Px)(parseInt(r.getPropVal("kerning")));if(s&&!(s>e.fontArg.fontSize))for(var l=1024*r.getPropVal("font_size_normal")/5,u=ie(n,t,i),c=o[n],h=c,d=c+t.len,p=h;p<d;++p){var f=a.getMi(p);if(f.shared){var g=f.clone();delete g.shared,a.setMi(p,g),f=g}var v=a.getCharCode(p),m=oe(a,p,d,u),_=m.bRet,y=m.inCurSpan,b=m.nextCharCode;if(!_||!b)break;if(p+1===d){if(!y&&ae(r,u.chpx,e))break;if(re(u.chpx,b,e))break}var T=ee(e.fontArg.fontFamily,v,b);if(T){var C=Object(U.d)(e.fontArg.fontFamily);C&&(T=T*l/C,f.addWidth(Object(x.Ti2Px)(.004882*T)))}}}}}]),e}(),le=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),ue=function(){function e(){if(s()(this,e),le())return le();le(this)}return u()(e,null,[{key:"measureChars",value:function(){var e=arguments[1];if(!(e.isHidden()||e.isRevisionHidden()||e.isSpecHidden()&&!e.isDrawing())){var t=e.chpx,n=t.getPropVal("position");n&&0!==n&&(e.metrics.ascent+=Object(x.Ti2Px)(n),e.metrics.descent-=Object(x.Ti2Px)(n))}}}]),e}(),ce=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),he=function(){function e(){if(s()(this,e),ce())return ce();ce(this)}return u()(e,null,[{key:"measureChars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4],a=arguments[6];if(!e.isRealComplex&&(e.bAdjAsiaAnsiSpace||e.bAdjAsiaNumSpace)){e.bHaveAsiaAnsiAdj=!1;var r=U.a.getNextGlyphGroup(n,t,i,!0);if(r&&r.isVisible()&&t&&t.isVisible()){var s=o[n]+t.len-1,l=a.getCharCode(s),u=a.getCharCode(r.begin),c=!1;e.bAdjAsiaAnsiSpace&&(t.charInfo.isRealAsia&&(r.charInfo.isAlpha||p.a.isSpecialAlpha(u))||(t.charInfo.isAlpha||p.a.isSpecialAlpha(l))&&r.charInfo.isRealAsia)&&(c=!0);var h=!1;if(!c&&e.bAdjAsiaNumSpace&&(p.a.isRealAsia(l)&&r.charInfo.isDigit||t.charInfo.isDigit&&p.a.isRealAsia(u))&&(h=!0),c||h){I.d,e.gridMode;var d=e.fontArg.fontSize/U.a.getAdjCalcFactor(e)||0;t.isLowerAlphaSmallCaps()&&(d*=.8);var f=a.getMi(s);if(f.shared){var g=f.clone();delete g.shared,a.setMi(s,g),f=g}f.width+=d,f.charLineHeaderWidth+=d,e.bHaveAsiaAnsiAdj=!0}}}}}]),e}(),de=n(1145),pe=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),fe=function(){function e(){if(s()(this,e),pe())return pe();pe(this)}return u()(e,null,[{key:"measureChars",value:function(e,t,n,i,o,a,r){this.measureSpacingRatio(e,t,n,i,o,a,r),this.measureMinWidth(t,n,o,r)}},{key:"measureSpacingRatio",value:function(e,t,n,i,o,a,r){if(t.isVisible()&&!t.isComplex()){n>0?i[n-1]:t.getPrevNode().isTree()&&null;var s=o[n];if(1==t.len){if(0===s)return;if(t.isEmbedDrawing())return;var l=r.getMi(s);if(l.shared){var u=l.clone();delete u.shared,r.setMi(s,u),l=u}e.bHaveAsiaAnsiAdj&&this.addSpacingRatio(l,.5);var c=r.getCharCode(s);if(p.a.isLineBreak(c))return;if(e.bDiffSBMB){if(e.bUseCJKFont||e.bPuncSpec&&p.a.isPunc(c))return void(U.a.isKanaSpec(e,c)?this.addSpacingRatio(l,1):this.addSpacingRatio(l,2));if(p.a.isNormalSpace(c))return!e.bWordWrap&&U.a.betweenWestWriteLetters(e,t,n,i,o,a,r)?void this.addSpacingRatio(l,1):void this.addSpacingRatio(l,2)}this.addSpacingRatio(l,1)}else{var h=s;0;for(var d=s+t.len;h<d;++h){var f=r.getMi(h);if(f.shared){var g=f.clone();delete g.shared,r.setMi(h,g),f=g}e.bHaveAsiaAnsiAdj&&h+1==d&&this.addSpacingRatio(f,.5),e.bDiffSBMB&&e.bUseCJKFont?U.a.isKanaSpec(e,r.getCharCode(h))?this.addSpacingRatio(f,1):this.addSpacingRatio(f,2):this.addSpacingRatio(f,1)}}}}},{key:"addSpacingRatio",value:function(e,t){void 0===e.spacingRatio&&(e.spacingRatio=0),e.spacingRatio+=t}},{key:"measureMinWidth",value:function(e,t,n,i){for(var o=n[t],a=o+e.len,r=o;r<a;++r){var s=i.getMi(r);s&&(s.minWidth=s.width)}}}]),e}(),ge=n(309),ve=n(167),me=function(){function e(){s()(this,e),this.normalCharMeasurer=new y.a,this.whiteSpaceMeasurer=new z.a,this.textHeightMeasurer=new q.a,this.charSpacingMeasurer=new Y}return u()(e,[{key:"init",value:function(e){this.doc=e}},{key:"load",value:function(e){var t=this,n=e.glyphGroups,i=e.glyphPoss,o=e.glyphArrays,r=e.glyphBuff,s=e.context,l=e.begin,u=a()({},s),h=1;if(window.APP.isMobileMode()&&window.APP.appApi){var f=window.APP.appApi.readingFontSize;h=f/100}var v={},m=this.doc.fonttable,y=!1;v.fontTable=m,u.fontArg=v,u.bDiffSBMB=!this.doc.settings.getDiffSBMB(),u.bKerningPunc=this.doc.settings.getKerningPuncType(),u.useWord79LineBreakRule=this.doc.settings.getWord79LineBreakRule(),u.bAppIsFELanguage=!0;var b=this.doc.sections.getSection(l);u.gridMode=b.getSnapMode(),u.srcGridWidth=Object(x.Ti2Px)(b.getSrcGridWidth());var T=b.getPrevNode(),C=T.isTree()?0:T.pos,k=b.pos+1,w=l>=C&&l<k,S=U.a.getFontIndex,O=this.normalCharMeasurer,R=this.whiteSpaceMeasurer,N=this.textHeightMeasurer,A=this.charSpacingMeasurer,D=u.gridMode==I.a&&0!=u.srcGridWidth&&!u.bIsInFitCell,M=void 0,L=void 0,F=void 0,B=void 0,H=void 0,G=void 0,W=void 0,V=void 0,Y=void 0,z=void 0,K=void 0,Z=void 0,q=void 0,Q=void 0,ee=void 0;o.forEach((function(e,a){var s=i[a],l=t.doc.getSubDocType(s);w&&s>=k&&(b=t.doc.sections.getSection(s),u.gridMode=b.getSnapMode(),u.srcGridWidth=Object(x.Ti2Px)(b.getSrcGridWidth()),T=b.getPrevNode(),C=T.pos,k=b.pos+1,w=s>=C&&s<k,D=u.gridMode==I.a&&0!=u.srcGridWidth&&!u.bIsInFitCell);var f=e.chpx,te=e.papx,ne=i[a];if(M!==te&&(u.bAdjAsiaAnsiSpace=te.getPropVal("auto_space_de"),u.bAdjAsiaNumSpace=te.getPropVal("auto_space_dn"),u.bWordWrap=te.getPropVal("word_wrap"),F=te.getProp("vertical_align_mode"),M=te),L!==f){B=f.getPropVal("complex_script")||f.getPropVal("share_hint")===E.b;var ie=f.getPropVal("character_scale")||100;u.fitTextId=ie>15&&f.getPropVal("fit_text")>0?f.getPropVal("fit_text_id"):0,u.scale=!u.fitTextId||t.doc.useCoreTypo?f.getPropVal("character_scale"):100,u.spacing=!u.fitTextId||t.doc.useCoreTypo?f.getPropVal("spacing"):0,H=f.getPropVal("symbol_char")||f.getPropVal("symbol_fontname"),G=f.getPropVal("small_caps")||f.getPropVal("caps"),W=f.getPropVal("script_pos"),V=f.getPropVal("emphasis_type"),Q=D&&f.getPropVal("snap_to_grid")&&!u.fitTextId}var oe=e.charInfo;u.vertAlignMode=F.def&&e.isTransposeCoor?"middle":F.val;var ae=u.vertAlignMode!==q;q=u.vertAlignMode;var re=B||e.isGlyphComplex();re&&e.setComplexFlag();var le,ce=!1;if(L===f&&Y==re||(v.fontSize=c.a.calcFontsize(f,re)*h,v.fontWeight=(re?f.getPropVal("bold_cs"):f.getPropVal("bold"))?"bold":"normal",v.fontStyle=(re?f.getPropVal("italic_cs"):f.getPropVal("italic"))?"italic":"normal",ae=!0,ce=!0),(K!==oe.charClass||ae||y||ee!==oe.isRealAsia)&&(u.charClass=oe.charClass,v.fontIndex=S(u,u.charClass,f),z=m.getName(u.fontArg.fontIndex),v.fontIndex>=0&&!window.APP.fontServer.usedFonts.has(z)&&window.APP.fontServer.usedFonts.add(z),window.APP.fontServer.preLoadSystemFont(z),v.fontFamily=window.APP.fontServer.getFontName(z,oe),oe.isPunc||(v.fontFamily=window.APP.fontServer.fallbackByChar(u,r.getChar(ne),v.fontFamily)),ae=!0),L=f,Y=re,K=oe.charClass,ee=oe.isRealAsia,l==ge.Comment&&(v.fontFamily=ve.isMacOs||ve.isIos?"PingFang SC', 'WPS Emoji":"Microsoft YaHei', 'WPS Emoji"),e.isEmojiKeycap&&(ve.isMacOs||ve.isIos)?(v.fontFamily="Apple Color Emoji",y=!0,ae=!0):y=!1,u.bBoldAdjustment=!1,"bold"===v.fontWeight&&v.fontFamily){var pe=Object(U.c)(v.fontFamily,v.fontWeight);u.bBoldAdjustment=pe&&"bold"!==pe&&"bold_italic"!==pe}u.isCJKFont=oe.isRealAsia||Object(de.b)(z),window.APP.isMobileMode()&&!window.APP.fontServer.isFontEffectiveByCSS(z)&&(u.isCJKFont=!1),u.bHasKerning=(le=z,!!$.has(le)),H&&_.measureChars(u,e,ne,r),ae?(N.measureChars(u,e,i,a,r),ue.measureChars(u,e),Z=e.metrics):e.metrics=Z;var me=v.fontSize;if((ce||ae||W)&&d.measureChars(u,e),G&&g.measureChars(u,e,ne,r),O.measureChars(u,e,ne,r),1==e.len){var _e=r.getCharCode(ne);(p.a.isNormalSpace(_e)||p.a.isFullWidthSpace(_e))&&R.measureChars(u,e,a,o,i,n,r)}he.measureChars(u,e,a,o,i,n,r),se.measureChars(u,e,a,o,i,n,r),u.scale&&100!=u.scale&&P.measureChars(u,e,ne,r),A.measureChars(u,e,a,o,i,n,r),Q&&J.measureChars(u,e,a,o,i,n,r),oe.isPunc&&!u.isRealComplex&&u.bUseCJKFont&&!U.a.isJPNMonospacedFont()&&j.measureChars(u,e,a,o,i,n,r),V&&X.measureChars(u,e),u.fitTextId&&fe.measureChars(u,e,a,o,i,n,r),v.fontSize=me}))}}]),e}();t.a=me},7128:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(3485),l=void 0,u=[[1536,1791],[1872,1919],[64336,65023],[65136,65279]];function c(e){for(var t=0,n=u.length;t<n;++t){var i=u[t];if(e>=i[0]&&e<=i[1])return!0}return!1}function h(e,t){for(var n=0,i=e.length-1;n<=i;){var o=n+(i-n>>>1);if(t<e[o].ch)i=o-1;else{if(t==e[o].ch)return e[o];n=o+1}}return null}var d={};function p(e){return d[e]}function f(e,t,n,i){if(!i.start&&!i.middle)return!1;var o=e[t];if(32==o||46==o)return!1;for(var a=l,r=a,s=t;a.childs;){if(p(o)){if(++s<n){o=e[s];continue}break}var u=h(a.childs,o);if(!u)break;if(u.level>0&&(r=u),a=u,!(++s<n))break;o=e[s]}return r!=l&&!(!r.middle&&!r.end)}function g(){l||function(e){var t,n={ch:1569,isolate:{ch:65152},level:e.level+1},i={ch:1570,end:{ch:65154},isolate:{ch:65153},level:e.level+1},o={ch:1571,end:{ch:65156},isolate:{ch:65155},level:e.level+1},a={ch:1572,end:{ch:65158},isolate:{ch:65157},level:e.level+1},r={ch:1573,end:{ch:65160},isolate:{ch:65159},level:e.level+1},s={ch:1574,start:{ch:65163},end:{ch:65162},middle:{ch:65164},isolate:{ch:65161},level:e.level+1},l={ch:1575,end:{ch:65166},isolate:{ch:65165},level:e.level+1},u={ch:1576,start:{ch:65169},end:{ch:65168},middle:{ch:65170},isolate:{ch:65167},level:e.level+1},c={ch:1577,end:{ch:65172},isolate:{ch:65171},level:e.level+1},h={ch:1578,start:{ch:65175},end:{ch:65174},middle:{ch:65176},isolate:{ch:65173},level:e.level+1},p={ch:1579,start:{ch:65179},end:{ch:65178},middle:{ch:65180},isolate:{ch:65177},level:e.level+1},f={ch:1580,start:{ch:65183},end:{ch:65182},middle:{ch:65184},isolate:{ch:65181},level:e.level+1},g={ch:1581,start:{ch:65187},end:{ch:65186},middle:{ch:65188},isolate:{ch:65185},level:e.level+1},v={ch:1582,start:{ch:65191},end:{ch:65190},middle:{ch:65192},isolate:{ch:65189},level:e.level+1},m={ch:1583,end:{ch:65194},isolate:{ch:65193},level:e.level+1},_={ch:1584,end:{ch:65196},isolate:{ch:65195},level:e.level+1},y={ch:1585,end:{ch:65198},isolate:{ch:65197},level:e.level+1},b={ch:1586,end:{ch:65200},isolate:{ch:65199},level:e.level+1},T={ch:1587,start:{ch:65203},end:{ch:65202},middle:{ch:65204},isolate:{ch:65201},level:e.level+1},C={ch:1588,start:{ch:65207},end:{ch:65206},middle:{ch:65208},isolate:{ch:65205},level:e.level+1},k={ch:1589,start:{ch:65211},end:{ch:65210},middle:{ch:65212},isolate:{ch:65209},level:e.level+1},w={ch:1590,start:{ch:65215},end:{ch:65214},middle:{ch:65216},isolate:{ch:65213},level:e.level+1},S={ch:1591,start:{ch:65219},end:{ch:65218},middle:{ch:65220},isolate:{ch:65217},level:e.level+1},P={ch:1592,start:{ch:65223},end:{ch:65222},middle:{ch:65224},isolate:{ch:65221},level:e.level+1},I={ch:1593,start:{ch:65227},end:{ch:65226},middle:{ch:65228},isolate:{ch:65225},level:e.level+1},E={ch:1594,start:{ch:65231},end:{ch:65230},middle:{ch:65232},isolate:{ch:65229},level:e.level+1},O={ch:1601,start:{ch:65235},end:{ch:65234},middle:{ch:65236},isolate:{ch:65233},level:e.level+1},x={ch:1602,start:{ch:65239},end:{ch:65238},middle:{ch:65240},isolate:{ch:65237},level:e.level+1},R={ch:1603,start:{ch:65243},end:{ch:65242},middle:{ch:65244},isolate:{ch:65241},level:e.level+1},N={ch:1604,start:{ch:65247},end:{ch:65246},middle:{ch:65248},isolate:{ch:65245},level:e.level+1},A={ch:1605,start:{ch:65251},end:{ch:65250},middle:{ch:65252},isolate:{ch:65249},level:e.level+1},D={ch:1606,start:{ch:65255},end:{ch:65254},middle:{ch:65256},isolate:{ch:65253},level:e.level+1},M={ch:1607,start:{ch:65259},end:{ch:65258},middle:{ch:65260},isolate:{ch:65257},level:e.level+1},L={ch:1608,end:{ch:65262},isolate:{ch:65261},level:e.level+1},F={ch:1609,start:{ch:64488},end:{ch:65264},middle:{ch:64489},isolate:{ch:65263},level:e.level+1},B={ch:1610,start:{ch:65267},end:{ch:65266},middle:{ch:65268},isolate:{ch:65265},level:e.level+1},H={ch:1649,end:{ch:64337},isolate:{ch:64336},level:e.level+1},G={ch:1657,start:{ch:64360},end:{ch:64359},middle:{ch:64361},isolate:{ch:64358},level:e.level+1},W={ch:1662,start:{ch:64344},end:{ch:64343},middle:{ch:64345},isolate:{ch:64342},level:e.level+1},j={ch:1670,start:{ch:64380},end:{ch:64379},middle:{ch:64381},isolate:{ch:64378},level:e.level+1},U={ch:1672,end:{ch:64393},isolate:{ch:64392},level:e.level+1},V={ch:1681,end:{ch:64397},isolate:{ch:64396},level:e.level+1},Y={ch:1700,start:{ch:64364},end:{ch:64363},middle:{ch:64365},isolate:{ch:64362},level:e.level+1},z={ch:1705,start:{ch:64400},end:{ch:64399},middle:{ch:64401},isolate:{ch:64398},level:e.level+1},K={ch:1709,start:{ch:64469},end:{ch:64468},middle:{ch:64470},isolate:{ch:64467},level:e.level+1},Z={ch:1711,start:{ch:64404},end:{ch:64403},middle:{ch:64405},isolate:{ch:64402},level:e.level+1},X={ch:1722,end:{ch:64415},isolate:{ch:64414},start:{ch:65255},middle:{ch:65256},level:e.level+1},q={ch:1726,start:{ch:64428},end:{ch:64427},middle:{ch:64429},isolate:{ch:64426},level:e.level+1},J={ch:1729,start:{ch:64424},end:{ch:64423},middle:{ch:64425},isolate:{ch:64422},level:e.level+1},Q={ch:1735,end:{ch:64472},level:e.level+1},$={ch:1736,end:{ch:64476},level:e.level+1},ee={ch:1740,start:{ch:64510},end:{ch:64509},middle:{ch:64511},isolate:{ch:64508},level:e.level+1},te={ch:1744,start:{ch:64486},middle:{ch:64487},end:{ch:64485},level:e.level+1},ne={ch:1746,end:{ch:64431},isolate:{ch:64430},level:e.level+1},ie={ch:1747,end:{ch:64433},isolate:{ch:64432},level:e.level+1},oe={ch:1749,end:{ch:65258},level:e.level+1};e.childs=[n,i,o,a,r,s,l,u,c,h,p,f,g,v,m,_,y,b,T,C,k,w,S,P,I,E,O,x,R,N,A,D,M,L,F,B,H,G,W,j,U,V,Y,z,K,Z,X,q,J,Q,$,ee,te,ne,ie,oe],t=d,[{begin:1552,end:1563},{begin:1600,end:1601},{begin:1611,end:1632},{begin:1648,end:1649},{begin:1750,end:1757},{begin:1759,end:1765},{begin:1767,end:1769},{begin:1770,end:1774}].forEach((function(e){for(var n=e.begin,i=e.end,o=n;o<i;++o)t[o]=!0})),N.childs=[{ch:1570,isolate:{ch:65269},end:{ch:65270},level:2},{ch:1571,isolate:{ch:65271},end:{ch:65272},level:2},{ch:1573,isolate:{ch:65273},end:{ch:65274},level:2},{ch:1575,isolate:{ch:65275},end:{ch:65276},level:2}];var ae={ch:1604,childs:[{ch:1604,childs:[{ch:1607,isolate:{ch:65010},level:4},{ch:1729,isolate:{ch:65010},level:4}]}]};l.childs=[ae];var re={ch:1604,childs:[{ch:1575,childs:[{ch:1604,isolate:{ch:65020},level:4}]}]};y.childs=[re]}(l={level:0})}function v(e){g();var t=e.srcPos,n=t+e.len,i=0,o=!0,a=!0,r=-1,s=!1,u=t,d=e.startOrMiddleNode,v=e.srcBuff;d||(e.startOrMiddleNode=d={});for(var m=t;m<n;){var _=v[m],y=l,b=y,T=c(_);for(m===t&&(o=!1);b.childs;){if(p(_)){if(y!=l)break;if(e.desBuff[e.desPos++]=_,i++,e.len--,e.srcPos++,u++,++m<n){_=v[m];continue}return i}var C=h(b.childs,_);if(C){if(-1!=r&&r!=C.level)return i;b=C,m++,C.level>0&&(y=C,u=m),m<n&&(_=v[m])}if(!C||m>=n)break}if(-1!=r&&(r!=y.level||s!=T))return i;if(r=y.level,s=T,y==l)e.desBuff[e.desPos]=_,u++,o=!1;else{a=!(u>=n)&&f(v,u,n,y);var k=y.isolate;if(k||(k=y.end),k||(k=y.start),k||(k=y.middle),k||(k=y),!o&&e.desPos>=1&&(o=!!d[e.desBuff[e.desPos-1]]),o&&a){var w=y.middle;w?d[w.ch]=w:w=y.end?y.end:k,e.desBuff[e.desPos]=w.ch,o=w==y.middle||w==y.start}else if(o&&!a){var S=y.end;S||(S=y.middle?y.middle:k),e.desBuff[e.desPos]=S.ch,o=!1}else if(!o&&a){var P=y.start;o=!!P,P?d[P.ch]=P:P=y.isolate?y.isolate:k,e.desBuff[e.desPos]=P.ch}else if(!o&&!a){var I=y.isolate;I||(I=y.start?y.start:k),e.desBuff[e.desPos]=I.ch,o=!1}}if(e.len-=u-e.srcPos,e.srcPos=u,m=u,i++,e.desPos++,y.level>1)return i}return i}var m=n(324),_=["font_size_cs","font_name_complex","script_pos","character_scale","bold_cs","italic_cs"],y=String.fromCharCode(m.u);function b(e,t){var n=e.chpx,i=t.chpx,o=!1;return _.some((function(e){if(n[e]!=i[e])return o=!0,!0})),!o}function T(e,t,n){for(var i=e.len,o=t.getText(e.pos,i),a=new Array(i),r=0;r<i;++r)a[r]=o.charCodeAt(r);return n.concat(a)}var C=function(){function e(){o()(this,e)}return r()(e,[{key:"init",value:function(e,t){this.doc=e,this.dataLogic=t}},{key:"load",value:function(e){for(var t=e.glyphPool,n=e.glyphPoss,i=e.glyphArrays,o=e.glyphBuff,a=[],r=[],l=0,u=this.dataLogic,c=s.d.make(t),h=n[0]-1;h>=0&&c.seek(h);){var d=c.glyphGroup;if(h=d.pos-1,!d.isHidden()){if(!d.charInfo.isArabic)break;i.splice(0,0,d),n.splice(0,0,d.pos)}}var p=i[i.length-1];for(h=n[i.length-1]+p.len;c.seek(h);){var f=c.glyphGroup;if(!f)break;if(h=f.pos+f.len,!f.isHidden()){if(!f.charInfo.isArabic)break;i.push(f),n.push(f.pos)}}for(var g=0,v=i.length;g<v;++g){var m=i[g];m.isHidden()||(m.charInfo.isArabic?(l&&!b(a[a.length-1],m)&&(this.__process(a,o,r,l),a=[],r=[],l=0),a.push(m),r=T(m,u,r),l+=m.len):l&&(this.__process(a,o,r,l),a=[],r=[],l=0))}a.length&&this.__process(a,o,r,l),c.free()}},{key:"__process",value:function(e,t,n,i){var o=new Array(i),a={srcBuff:n,srcPos:0,desBuff:o,desPos:0,len:i};do{for(v(a);a.desPos<a.srcPos;)o[a.desPos++]=m.u}while(a.len>0);var r=0,s=t.getBuffs();e.forEach((function(n,i){var a=n.len;if(n.isCombine){var l=String.fromCharCode(o[i]);0!=i&&(l=y+l),i!=e.length-1&&(l+=y),s.at(n.pos).char=l}else t.setRenderChars(o,r,n.pos,a);r+=a}))}}]),e}(),k=n(3484),w={60:62,62:60,171:187,187:171};function S(e){var t={};return e.split("").forEach((function(e){t[e.charCodeAt(0)]=!0})),t}function P(e){var t={};return e.forEach((function(e){var n=e.str,i=e.isRTL;n.split("").forEach((function(e){t[e.charCodeAt(0)]=i}))})),t}var I=S(" :().-,!@．，？，。?~！#￥%…&（）*—+{}|：“”《》、？$^_<>[]\\;’/='–"),E={he:S(""),ar:S("")},O={ar:S(" /-±¡|<>°¬~^(){}[]!:+%"),he:S(" @#$₪%&*()«»_-+\\;:!?=/•©¥£½¿<>[]{}¡|¦¶~^")},x={ar:P([{str:".",isRTL:!1}]),he:P([{str:"-#%$₪:+-¥£½¿<>[]{}µ",isRTL:!1}])},R={ar:P([{str:":",isRTL:!1}])},N=function(){function e(t){o()(this,e),this.bidi=window.APP.createBidi(),this.glyphPool=t}return r()(e,[{key:"init",value:function(e,t){this.doc=e,this.dataLogic=t}},{key:"load",value:function(e){e.glyphGroups;for(var t=e.glyphArrays,n=e.glyphBuff,i=e.segments,o=0,a=t.length;o<a;){var r=t[o];if(r.papx.getPropVal("bidi")||r.isRTL()||r.chpx.getPropVal("right_to_left_text")){var s=this.__collectGlyphGroup(o,t),l=s.groups,u=s.index;if(!l.length)break;this.__calcBidiLevelForPara(l,n,i),o=u}else++o}}},{key:"__collectGlyphGroup",value:function(e,t){for(var n=e,i=[],o=s.d.make(this.glyphPool),a=!1,r=e-1;r>=0;--r){var l=t[r];if(l.isVisible()){switch(l.getCharRngFlag()){case k.f:case k.h:case k.i:case k.a:a=!0}if(a)break;i.push(l)}}if(a=!1,r<0){var u=t[0].pos-1;if(u>=0)for(;o.seek(u);){var c=o.glyphGroup;if(u=c.pos-1,c.isVisible()){switch(c.getCharRngFlag()){case k.f:case k.h:case k.i:case k.a:a=!0}if(a)break;i.push(c)}}}i.reverse();var h=t.length;a=!1;for(var d=!1;n<h;){var p=t[n++];if(p.isVisible()){switch(i.push(p),p.getCharRngFlag()){case k.f:case k.h:case k.i:case k.a:a=!0,d=!0}if(a)break}}if(n>=h&&!d){a=!1;for(var f=t[t.length-1],g=f.pos+f.len;o.seek(g);){var v=o.glyphGroup;if(g=v.pos+v.len,v.isVisible()){switch(i.push(v),v.getCharRngFlag()){case k.f:case k.h:case k.i:case k.a:a=!0}if(a)break}}}return o.free(),{groups:i,index:n}}},{key:"__calcBidiLevel",value:function(e,t,n,i,o){for(var a=o.getBuffs(),r=[],s=127===i?1:0,l=[],u=t,c=t+n;u<c;++u){var h=e[u],d=h.pos;a.forEach(d,d+h.len,(function(e,t,n){r.push(t[n].charCode)}));for(var p=0,f=h.len;p<f;++p)l.push(0)}var g=this.bidi;g.setPara(r,i,l);for(var v=g.getLevels(),m=0,_=t,y=t+n;_<y;++_){var b=e[_],T=v[m];if(T<s&&(T+=2),b.charInfo.isDigit&&b.chpx.getPropVal("right_to_left_text"))T+=2;else if(1==b.len)if(b.chpx.getPropVal("right_to_left_text")){var C=b.chpx.getPropVal("complex_language");C&&C.length>2&&(C=C.substr(0,2)),C||(C="ar");var k=a.at(b.pos).charCode;if(T%2){var S=E[C];S&&S[k]&&++T}else{var P=O[C];P&&P[k]&&++T}var N=x[C];N&&null!=N[k]&&this.__isNearByNum(_,t,y,e)&&(N[k]!=T%2?++T:T+=2);var A=R[C];A&&null!=A[k]&&this.__isBetweenNum(_,t,y,e)&&(A[k]!=T%2?++T:T+=2)}else if(T%2){var D=a.at(b.pos).charCode;I[D]&&++T}if(b.bidiLevel=T,m+=b.len,T%2){if(b.setLayoutRTLFlag(),1==b.len){var M=a.at(b.pos).charCode,L=w[M]||g.getBidiMirror(M);M!=L&&o.setRenderChars([L],0,b.pos,1)}}else b.setLayoutLTRFlag()}}},{key:"__isNearByNum",value:function(e,t,n,i){if(e>t&&i[e-1].charInfo.isDigit)return!0;if(e<n-1&&i[e+1].charInfo.isDigit)return!0;return!1}},{key:"__isBetweenNum",value:function(e,t,n,i){return e>t&&e<n-1&&(!!i[e-1].charInfo.isDigit&&!!i[e+1].charInfo.isDigit)}},{key:"__isDigitOrDigitPunch",value:function(e,t){return!!e.charInfo.isDigit||1==e.len&&t.getCharCode(e.pos)==="-".charCodeAt(0)}},{key:"__calcBidiLevelForPara",value:function(e,t,n){for(var i=0,o=e.length,a=e[0].papx.getPropVal("bidi")?127:126;i<o;){var r=this.__getGroupsInSameChp(e,i,n);this.__calcBidiLevel(e,i,r,a,t),i+=r}var s=e[e.length-1];s.bidiLevel=127===a?1:0,s.bidiLevel%2?s.setLayoutRTLFlag():s.setLayoutLTRFlag()}},{key:"__getGroupsInSameChp",value:function(e,t,n){var i=e[t],o=e.length,a=i.pos,r=n.length,s=n[r-1],l=a+i.len;if(a<n[0].span.pos||a>=s.span.pos+s.span.len){var u=this.dataLogic.getChpx(a);l=u.pos+u.len}else for(var c=0,h=r-1;c<=h;){var d=c+h>>1,p=n[d].span;if(a<p.pos)h=d-1;else{if(!(a>=p.pos+p.len)){l=p.pos+p.len;break}c=d+1}}for(var f=t+1;f<o&&!(e[f].pos>=l);)++f;return f-t}}]),e}(),A=function(){function e(){o()(this,e)}return r()(e,[{key:"init",value:function(e){this.doc=e}},{key:"load",value:function(e){var t=this,n=e.glyphGroups,i=e.begin,o=e.end;if(window.__CONFIG__.wps.enableContentControlACL&&window.APP.restrictEditHandler.isInRestrictEditMode){var a=window.APP.restrictEditHandler;this.doc.contentControls.collect(i,o-i).forEach((function(e){if(!a.allowEditContentControlByTag(e.data.getTag())){var i=e.pos+1,o=e.len-2;t.doc.getText(i,o)===_i18n("applications.writer.core.shell.model.doc.contentControl.formatControlDefaultContent", "Click here to edit directly.")&&n.setGlyphGroupFlag((function(e){e.setContentControlPlaceholderHiddenFlag()}),{begin:i,end:i+o})}}))}}}]),e}(),D=function(){function e(){o()(this,e),window.APP.fontServer.attachObserver(this)}return r()(e,[{key:"init",value:function(e){var t=this;this.doc=e,this.loaders=this.creatLoaders(),this.dataLogic=this.createDataLogic();var n=this.dataLogic.getTextSize();this.glyphGroups=new s.c,this.glyphBuff=new s.a(n),this.glyphIterator=s.d.make(this),this.loaders.forEach((function(n){n.init(e,t.dataLogic)}));var i=e.documentFields,o=e.footnotes,a=e.endnotes,r=e.footnoteBodys,l=e.endnoteBodys;i.attachObserver(this),o.attachObserver(this),a.attachObserver(this),r.attachObserver(this),l.attachObserver(this)}},{key:"clearAll",value:function(){window.APP.fontServer.detachObserver(this);var e=window.APP.data.doc,t=e.documentFields,n=e.footnotes,i=e.endnotes,o=e.footnoteBodys,a=e.endnoteBodys;t.detachObserver(this),n.detachObserver(this),i.detachObserver(this),o.detachObserver(this),a.detachObserver(this)}},{key:"afterOpen",value:function(){}},{key:"creatLoaders",value:function(){return[]}},{key:"createDataLogic",value:function(){}},{key:"getDataLogic",value:function(){return this.dataLogic}},{key:"getBodyRange",value:function(e){return{begin:0,end:this.dataLogic.getTextSize()}}},{key:"needQueryData",value:function(){return!1}},{key:"getValidateStep",value:function(e){return 0}},{key:"validate",value:function(e){return e.end-e.begin>this.size&&(e.end=e.begin+this.size),this.glyphGroups.dropGroups(0,this.size),this.load(0,this.size),!0}},{key:"load",value:function(e,t){for(var n={textPartType:this.textPart&&this.textPart.textPartType},i=this.dataLogic.getSegments({pos:e,len:t-e}),o=this.loaders,a={glyphPool:this,glyphGroups:this.glyphGroups,glyphPoss:[],glyphArrays:[],glyphBuff:this.glyphBuff,segments:i,context:n,begin:e,end:t},r=0;r<o.length;++r){o[r].load(a)}}},{key:"getGlyphGroups",value:function(e,t){return this.validate({begin:e,end:t}),this.glyphGroups.collectGroups(e,t)}},{key:"getGlyphIterator",value:function(e){this.validate({begin:e,end:e+1});var t=s.d.make(this);return t.seek(e)?t:null}},{key:"getVisibleText",value:function(e,t){for(var n=this.glyphBuff,i="",o=e+t,a=this.getGlyphIterator(e),r=e;r<o;){if(a.glyphGroup.isVisible()){for(var s=r,l=Math.min(o,a.glyphGroup.end);s<l;++s)i+=n.getChar(s);r=a.glyphGroup.end,a.seek(r)}else r=a.glyphGroup.end,a.seek(r)}return i}},{key:"getBackwardVisibleText",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=this.glyphBuff,i="",o=void 0,a=e-1,r=this.getBodyRange(a),s=r?r.begin:0;a>=s&&i.length<t;){var l=(o=this.getGlyphIterator(a)).glyphGroup;if(l.isVisible()){for(var u=Math.min(a,o.glyphGroup.end-1),c=Math.max(o.glyphGroup.begin,u-(t-i.length)+1),h=u;h>=c;--h)i=n.getChar(h)+i;a=o.glyphGroup.begin-1}else a=o.glyphGroup.begin-1}return i}},{key:"onInsertText",value:function(e,t,n,i){var o=t,a=n.length;this.glyphBuff.onInsert(o,a),this.glyphGroups.expand(o,a),o>0&&(o-=1,a+=1),this.validate({begin:o,end:o+a})}},{key:"onDeleteText",value:function(e,t,n,i){var o=n.length;if(!(o<=0)){var a=t,r=o;a>0&&(--a,++r),this.validate({begin:a,end:a+r}),this.glyphBuff.onRemove(t,o),this.glyphGroups.remove(t,o)}}},{key:"onChpxChanged",value:function(e,t){this.validate(t)}},{key:"onPapxChanged",value:function(e,t){this.validate(t)}},{key:"onFontUpdate",value:function(e,t){var n=this;t.forEach((function(e){n.validate(e)}))}},{key:"initArabicRenderStrLoader",value:function(){if(!this.hasInitArbic){var e=new C;e.init(this.doc,this.dataLogic),this._insertBeforeMeasure(e),this.hasInitArbic=!0}}},{key:"initBidiLoader",value:function(){if(!this.hasInitBidi){var e=new N(this);e.init(this.doc,this.dataLogic),this._insertBeforeMeasure(e),this.hasInitBidi=!0}}},{key:"_insertBeforeMeasure",value:function(e){this.loaders.splice(this.loaders.length-(this.hasInitContentControlPlaceholderHiddenLoader?3:2),0,e)}},{key:"initContentControlPlaceholderHiddenLoader",value:function(){if(!this.hasInitContentControlPlaceholderHiddenLoader){var e=new A(this);e.init(this.doc,this.dataLogic),this.loaders.push(e),this.hasInitContentControlPlaceholderHiddenLoader=!0}}},{key:"getGlyphGroupSet",value:function(){return this.glyphGroups}},{key:"size",get:function(){return this.glyphBuff.size}}]),e}();t.a=D},7138:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(5746),f=n(167),g=n(908),v=n(260),m=n(805),_=function(e){function t(e,n,i){o()(this,t);var a=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));a.beforeViewModeChange=function(){a.reset()},a.visibilityTimer=null,a.onScroll=function(){t.scrolling=!0,a.handleScrollEnd()},a.handleScrollEnd=function(){t.scrolling=!1},a.app=e,a.handlePixelRatioChange=a.handlePixelRatioChange.bind(a),a._element=document.createElement("div"),a._element.className="cursor-item";return a.relation=i,a.initialSize=1,a.width=0,window.addEventListener(v.default.view.BEFORE_VIEW_MODE_CHANGED,a.beforeViewModeChange),window.addEventListener(v.default.names.DOC_WORKSPACE_SCROLL,a.onScroll),a.handleScrollEnd=window.utils.Lodash.debounce(a.handleScrollEnd,500),a.showWaterDrop=!1,Object(m.assignStyle)(a._element,a._style,{width:"1px",height:"10px","background-color":"#22222b",position:"absolute",left:0,top:0,"pointer-events":"none"}),n.appendChild(a._element),a.handlePixelRatioChange(),a._recalculateInterval(),a}return d()(t,e),r()(t,[{key:"init",value:function(e){this.relation=e}},{key:"clearAll",value:function(){this.unbindMediaChangeEvent(),window.removeEventListener(v.default.names.DOC_WORKSPACE_SCROLL,this.onScroll),window.removeEventListener(v.default.view.BEFORE_VIEW_MODE_CHANGED,this.beforeViewModeChange),this.clearInterval(),this._recalculateInterval=Function.prototype}},{key:"bindMediaChangeEvent",value:function(){this.unbindMediaChangeEvent(),this.mql=window.matchMedia("(resolution: "+window.devicePixelRatio+"dppx)"),"function"==typeof this.mql.addEventListener?this.mql.addEventListener("change",this.handlePixelRatioChange):"function"==typeof this.mql.addListener&&this.mql.addListener(this.handlePixelRatioChange)}},{key:"unbindMediaChangeEvent",value:function(){this.mql&&("function"==typeof this.mql.removeEventListener?this.mql.removeEventListener("change",this.handlePixelRatioChange):"function"==typeof this.mql.removeListener&&this.mql.removeListener(this.handlePixelRatioChange))}},{key:"handlePixelRatioChange",value:function(){this.hideCursorForTheMoment();var e=window.devicePixelRatio;this.initialSize=e%1!=0?1/e*Math.round(e):1,this.bindMediaChangeEvent()}},{key:"clearInterval",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this._intervalHandler&&(clearInterval(this._intervalHandler),this._intervalHandler=null)}))},{key:"_recalculateInterval",value:function(){var e=this;this.clearInterval(),this.preventShow?this.hide():this.show(),this._intervalHandler=setInterval((function(){e._lockShow||e.showWaterDrop||e.toggle()}),500)}},{key:"setPos",value:function(e){var t=e.pos,n=this.app.workspace.waterdrop.getCursorCoordinates(t);if(n&&this.relation){this.top=n.top,this.left=n.left,this.isTranspose=t.isTranspose;var i=this.initialSize,o=Math.floor(t.charHeight*this.app.workspace.config.zoom);t.isTranspose?(this.height=i,this.width=o):(this.height=o,this.width=i);var a=this.visible&&!t.notInLine;if(f.isMobile&&t.line.isInTable){var r=this.app.data.typoinfo.horizontalPadding;a=a&&this.left>r}if(t.clipRect){var s=t.clipRect,l=window.APP,u=l.workspace.config.zoom,c=l.data.typoinfo.viewOffset,h=l.isWebMode()?0:l.workspace.getZoomDiff(),d=Math.floor((s.left-c.x)*u+h),p=Math.floor((s.top-c.y)*u),g=Math.ceil(d+s.width*u),v=Math.ceil(p+s.height*u),_=Math.max(d,this.left),y=Math.max(p,this.top),b=Math.min(this.left+this.width,g),T=Math.min(this.top+this.height,v);b-_<=0||T-y<=0?a=!1:(this.left=_,this.top=y,this.width=b-_,this.height=T-y)}var C=this.width%2==1?.5:0;Object(m.assignStyle)(this._element,this._style,{left:this.left-C+"px",top:this.top+C+"px",height:this.height+"px",width:(this.preventShow||this.showWaterDrop?0:this.width)+"px",visibility:a?"visible":"hidden"}),!this.preventShow&&this._recalculateInterval()}else this.reset()}},{key:"lockShow",value:function(){this.show(),this._lockShow=!0}},{key:"unlockShow",value:function(){this._lockShow=!1}},{key:"isShowWaterDrop",value:function(e){this.showWaterDrop=e,e?(this.hide(),this.switchVisibility(!1)):(this.show(),this.switchVisibility(!0))}},{key:"show",value:function(){if(this.showWaterDrop)return!1;Object(m.assignStyle)(this._element,this._style,{height:this.height+"px",width:this.width+"px"}),this._isShow=!0}},{key:"hide",value:function(){Object(m.assignStyle)(this._element,this._style,{width:"0px"}),this._isShow=!1}},{key:"toggle",value:function(){!0!==t.scrolling?this._isShow?this.hide():this.show():this._isShow||this.show()}},{key:"switchVisibility",value:function(e){e?(this._recalculateInterval(),this.preventShow=!1):(this.clearInterval(),this.hide(),this.preventShow=!0)}},{key:"switchIndicatorState",value:function(e){if(this.showWaterDrop)return!1;e?(this.unlockShow(),Object(m.assignStyle)(this._element,this._style,{opacity:1,width:this.width+"px"})):(this.lockShow(),Object(m.assignStyle)(this._element,this._style,{opacity:.5,width:this.width+"px"}))}},{key:"hideCursorForTheMoment",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;Object(m.assignStyle)(this._element,this._style,{display:"none"}),this.clearShowTimer(),this.visibilityTimer=setTimeout((function(){delete e._style.display,Object(m.assignStyle)(e._element,e._style)}),t)}},{key:"clearShowTimer",value:function(){this.visibilityTimer&&(clearTimeout(this.visibilityTimer),this.visibilityTimer=null)}},{key:"isTarget",value:function(e,n){if(c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"isTarget",this).call(this,e))return!0;if(n&&n.touches&&n.touches[0]){var i=this._element.getBoundingClientRect(),o=i.top,a=i.right,r=i.bottom,s=i.left,l=n.touches[0],u=l.clientX,h=l.clientY;if(u>s-20&&u<a+20&&h>o&&h<r){if(this.app.isEditMode)return!0;this.app.workspace.waterdrop._waterDropCursor._element.getBoundingClientRect().x}}return!1}},{key:"visible",get:function(){return this.app.isEditMode}}]),t}(p.a);_.scrolling=!1;var y=_,b=function(e){function t(e,n,i,a,r){o()(this,t);var s=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,a,r)),u=r&&r.color?r.color:"#22222b";return Object(m.assignStyle)(s._element,s._style,{width:"2px",height:"10px","background-color":u,position:"absolute",left:0,top:0,"z-index":10}),s.initialSize=2,s}return d()(t,e),r()(t,[{key:"show",value:function(){Object(m.assignStyle)(this._element,this._style,{width:this.width+"px",opacity:1,"pointer-events":"inherit"}),this._isShow=!0}},{key:"hide",value:function(){Object(m.assignStyle)(this._element,this._style,{opacity:0,"pointer-events":"inherit"}),this._isShow=!1}},{key:"setColor",value:function(e){Object(m.assignStyle)(this._element,this._style,{"background-color":e})}}]),t}(_),T=function(e){function t(e,n,i,a,r){o()(this,t);var s=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,a,r));return Object(m.assignStyle)(s._element,s._style,{width:"10px",height:"2px","background-color":"#4182D9",position:"absolute",left:0,top:0,"z-index":10}),s.height=2,s}return d()(t,e),r()(t,[{key:"setPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e.pos;if(n&&this.relation){var i=n.line,o=i.parent,a=g.a.getPosition2view(o);this.left=Math.ceil(a.x*t),this.top=Math.ceil((a.y+(n.position==i.range.begin?i.rect.top:i.rect.bottom))*t),this.width=Math.ceil(o.rect.width*t);var r=this.relation.getRelationRect(),s=this.app.workspace.scrollLeft;!f.isMobile&&this.left>r.right+s&&(this.left=r.right+s-5),Object(m.assignStyle)(this._element,this._style,{left:this.left+"px",top:this.top+"px",height:this.height+"px",width:this.width+"px"})}else this.reset()}}]),t}(_),C=n(3484);function k(e,t){if(!e)return!1;var n=e.className;return n&&"string"==typeof n&&n.match(t)}var w=function(){function e(){o()(this,e)}return r()(e,null,[{key:"onWaterDropChanged",value:function(t){e.toggleWaterDropCb=t}},{key:"toggleWaterDrop",value:function(t,n){if("function"!=typeof e.toggleWaterDropCb)return!1;var i=e.showCollection,o=i.indexOf(t);n!==(-1!==o)&&(n?(i.push(t),1===i.length&&e.toggleWaterDropCb(!0)):(i.splice(o,1),0===i.length&&e.toggleWaterDropCb(!1)))}}]),e}();w.showCollection=[],w.toggleWaterDropCb=null;var S=function(e){function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];o()(this,t);var s=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),u=r?"water-drop-cursor":"";return s._element=document.createElement("div"),s._className=u,s._element.className="water-drop "+u,s._element.setAttribute("draggable","true"),s.isBegin=i,s.isUpwards=a,s.isWaterDropCursor=r,s.relation=n,Object(m.assignStyle)(s._element,s._style,{width:"24px",height:"29px","border-radius":"100%",position:"absolute",left:0,top:0,transform:"translate(0, 0)","z-index":f.isPad?11:100}),e.appendChild(s._element),s.pointerHeight=0,s.currentLineHeight=0,s.currentCharHeight=0,s.setLineHeightToCursor=!1,s.unitKey=Date.now()+Math.random(),s._renderPointer(),s.waterDropWidth=24,s.waterDropHeight=29,s.waterDropMargin=4,s.waterDropPointerSize=2,s.handleDragMarkShow=s.handleDragMarkShow.bind(s),s}return d()(t,e),r()(t,[{key:"clearAll",value:function(){this.isWaterDropCursor&&window.removeEventListener(v.default.mobile.RENDER_DRAG_MARK,this.handleDragMarkShow)}},{key:"init",value:function(e){this.relation=e,this.isWaterDropCursor&&window.addEventListener(v.default.mobile.RENDER_DRAG_MARK,this.handleDragMarkShow)}},{key:"reset",value:function(){Object(m.assignStyle)(this._element,this._style,{transform:"translate(-100px, -100px)"}),this._renderPointer(),w.toggleWaterDrop(this.unitKey,!1)}},{key:"_renderPointer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1],n="full-box "+this._className;n+=this.isBegin?" water-drop-icon-up":" water-drop-icon-down",window.APP.frontUtil.ReactDom.render(window.APP.frontUtil.WaterDropPointerWrapper({isUpwards:this.isUpwards,isBegin:this.isBegin,height:e,iconClsName:n,isWaterDropCursor:this.isWaterDropCursor,isTranspose:t}),this._element)}},{key:"_getWaterDropClipPath",value:function(e,t,n,i,o){var a=t+i-window.APP.data.typoinfo.horizontalPadding;if(a>0){var r=Math.max(0,i-a);return e?"polygon("+r+"px 0px, "+i+"px 0px, "+i+"px "+o+"px, "+r+"px "+o+"px)":"polygon("+r+"px "+n+"px, "+i+"px "+n+"px, "+i+"px "+o+"px, "+r+"px "+o+"px)"}return"polygon(0 0, 0 0, 0 0, 0 0)"}},{key:"isTarget",value:function(e){var t=this.isBegin?/water-drop-icon-up/:/water-drop-icon-down/,n=this.isBegin?/water-drop-pointer-up/:/water-drop-pointer-down/;return this._element.className.match(/water-drop-cursor/)||k(e,/water-drop-cursor/)?e===this._element||k(e,/water-drop-cursor/):e===this._element||k(e,t)||k(e,n)}},{key:"setPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=e.pos;if(this.currentCharHeight=0,this.currentLineHeight=0,a&&this.relation){var r=window.APP,s=r.data.typoinfo.viewOffset,l=a.posY-s.y,u=a.posX-s.x,c=a.charPosY-s.y,h=void 0;if(o){var d=a.posY,p=d+(a.drawHeight||a.height),g=(d+p)/2,v=o.filter((function(e){return g>=e.top&&g<e.bottom}));h=v.length&&v[0]}var _=r.isWebMode()?0:r.workspace.getZoomDiff(),y=u*t-12+_,b=void 0;if(b=h?this.isUpwards?(h.top-s.y)*t-29:(h.bottom-s.y)*t:this.isUpwards?l*t-29:(l+(a.drawHeight||a.height))*t,i&&void 0!==a.line)if(f.isPad){var T=a.line.parent;y=(T.viewOffset.x+T.rect.width+_-12)*t}else{var k=a.line.viewPage.inner_rect;y=window.APP.isEditMode?k.right-12*t:y+4*t}else if(n&&0===a.charWidth&&void 0!==a.line){var S=a.line.glyphGroupInfos;if(S&&0!==S.length){var P=S[S.length-1];P.getCharRngFlag()===C.h&&(y+=(P.isLayoutRTL?-8:8)*t)}}var I=this.relation.getRelationRect();window.APP.isMobileMode()&&y>I.right&&(y=I.right-5),b=this.isUpwards?b-4:b+4;var E="none";if(window.APP.isEditMode&&window.APP.workspace.enableWaterDropClip&&a.line.isInTable){var O=y,x=(a.drawHeight||a.height)*t+4+1;E=this._getWaterDropClipPath(this.isUpwards,O,-x,this.waterDropWidth,this.waterDropHeight+x)}Object(m.assignStyle)(this._element,this._style,{transform:"translateX("+y+"px) translateY("+b+"px)","-webkit-clip-path":E,"clip-path":E});var R=(h?h.height:a.drawHeight||a.height)*t;this.currentLineHeight=R;try{this.isWaterDropCursor&&window.APP.data.selection.selInfo.getSelectionInfo().isPoint&&!this.setLineHeightToCursor&&(R=Math.min(b-c*t,(a.drawHeight||a.height)*t),this.currentCharHeight=R)}catch(e){}this._renderPointer(R,a.isTranspose),this._left=y,this._top=b,w.toggleWaterDrop(this.unitKey,!0)}else this.reset()}},{key:"handleDragMarkShow",value:function(e){if(window.APP.isEditMode){var t=e.detail.visible;this.setLineHeightToCursor=t,!0===t&&this.currentLineHeight>0&&this._renderPointer(this.currentLineHeight)}}},{key:"pointer",get:function(){return this.isUpwards?{x:this._left+12,y:this._top+this.waterDropHeight+1}:{x:this._left+12,y:this._top-1}}}]),t}(p.a),P=n(1737),I=n(723),E=n(1285),O={Cursor:0,WaterDrop:1,WaterDropCursor:2},x=function(){function e(t,n,i){var a=this;o()(this,e),this.app=t,this.relation=i,f.isMobile||f.isPad?(this._beginDrop=f.isMobile?new S(n,i,!0):new S(n,i,!0,!0),this._beginUpwardsDrop=f.isMobile?new S(n,i,!0,!0):null,this._endDrop=new S(n,i,!1),this._waterDropCursor=new S(n,i,!1,!1,!0),this._cursor=f.isPad?new y(t,n,i):new b(t,n,i),f.isPad&&w.onWaterDropChanged((function(e){a._cursor.isShowWaterDrop(e)}))):(this._cursor=new y(t,n,i),this.app.isWebMode()&&(this._ExclusiveShapeCursor=new T(t,n,i))),this.reset(),this.isReloadingDropShape=!0,this.isChangeBeginDropShape=!1,this.isUpwardsBeginDrop=!1}return r()(e,[{key:"init",value:function(e){this.relation=e,this._beginDrop&&this._beginDrop.init(e),this._beginUpwardsDrop&&this._beginUpwardsDrop.init(e),this._endDrop&&this._endDrop.init(e),this._waterDropCursor&&this._waterDropCursor.init(e),this._cursor&&this._cursor.init(e),this._ExclusiveShapeCursor&&this._ExclusiveShapeCursor.init(e)}},{key:"clearAll",value:function(){this._beginDrop&&this._beginDrop.clearAll(),this._beginUpwardsDrop&&this._beginUpwardsDrop.clearAll(),this._endDrop&&this._endDrop.clearAll(),this._waterDropCursor&&this._waterDropCursor.clearAll(),this._cursor&&this._cursor.clearAll(),this._ExclusiveShapeCursor&&this._ExclusiveShapeCursor.clearAll()}},{key:"reset",value:function(){this._beginDrop&&this._beginDrop.reset(),this._beginUpwardsDrop&&this._beginUpwardsDrop.reset(),this._endDrop&&this._endDrop.reset(),this._waterDropCursor&&this._waterDropCursor.reset(),this._cursor.reset(),this._ExclusiveShapeCursor&&this._ExclusiveShapeCursor.reset()}},{key:"_setCursorPos",value:function(e,t){this._ExclusiveShapeCursor&&this.app.data.selection.drapingShape?this._ExclusiveShapeCursor.setPos(e,t):this.app.isPaginationMode()||this._cursor.setPos(e,t)}},{key:"_updateCursorPositionOnly",value:function(e,t){this._cursor.switchVisibility(!1),this._cursor.setPos(e,t)}},{key:"resetCursor",value:function(){this._waterDropCursor&&this._waterDropCursor.reset(),this._cursor.reset(),this._clearWaterDropCursorTimerId&&clearTimeout(this._clearWaterDropCursorTimerId)}},{key:"resetWaterDrapCursor",value:function(e,t){this.reset(),this._cursor.switchVisibility(!0),this._cursor.setPos(e,t)}},{key:"setWaterdropCursorPos",value:function(e,t,n,i){var o=this;this._updateCursorPositionOnly(e,t),this._clearWaterDropCursorTimerId&&clearTimeout(this._clearWaterDropCursorTimerId),!0===n&&(this._clearWaterDropCursorTimerId=setTimeout((function(){o._waterDropCursor&&o._waterDropCursor.reset(),o._cursor.switchVisibility(!0),o._cursor.switchIndicatorState(!0),o._clearWaterDropCursorTimerId=0,i&&i()}),3e3)),window.requestAnimationFrame((function(){o._waterDropCursor&&o._waterDropCursor.setPos(e,t)}))}},{key:"_setBeginDropPos",value:function(e,t){this._beginDrop&&this._beginDrop.setPos(e,t,!1,!1,this._selectionRects)}},{key:"_setBeginUpwardsDropPos",value:function(e,t){this._beginUpwardsDrop&&this._beginUpwardsDrop.setPos(e,t,!1,!1,this._selectionRects)}},{key:"_setEndDropPos",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments[3];this._endDrop&&this._endDrop.setPos(e,t,n,i,this._selectionRects)}},{key:"getDrop",value:function(e){return e?this.getLeftWaterDrop():this._endDrop}},{key:"getLeftWaterDrop",value:function(){return f.isMobile&&this.isUpwardsBeginDrop?this._beginUpwardsDrop:this._beginDrop}},{key:"getDropItem",value:function(e,t){return this._cursor&&this._cursor.isTarget(e,t)?{type:O.Cursor,item:this._cursor}:this._waterDropCursor&&this._waterDropCursor.isTarget(e)?{type:O.WaterDropCursor,item:this._waterDropCursor}:this._beginDrop&&this._beginDrop.isTarget(e)?{type:O.WaterDrop,item:this._beginDrop}:this._beginUpwardsDrop&&this._beginUpwardsDrop.isTarget(e)?{type:O.WaterDrop,item:this._beginUpwardsDrop}:this._endDrop&&this._endDrop.isTarget(e)?{type:O.WaterDrop,item:this._endDrop}:null}},{key:"forceGetDropItem",value:function(){return{begin:this.getLeftWaterDrop(),end:this._endDrop}}},{key:"isCursor",value:function(e){return this._cursor.isTarget(e)}},{key:"isWaterDropCursor",value:function(e){return this._waterDropCursor&&this._waterDropCursor.isTarget(e)}},{key:"isDropItem",value:function(e){return this._beginDrop&&this._beginDrop.isTarget(e)||this._beginUpwardsDrop&&this._beginUpwardsDrop.isTarget(e)||this._endDrop&&this._endDrop.isTarget(e)||this._waterDropCursor&&this._waterDropCursor.isTarget(e)}},{key:"isWaterDrop",value:function(e){return this.isCursor(e)||this.isDropItem(e)||this.isWaterDropCursor(e)}},{key:"addEventListener",value:function(e,t){this._beginDrop&&this._beginDrop.addEventListener(e,t),this._beginUpwardsDrop&&this._beginUpwardsDrop.addEventListener(e,t),this._endDrop&&this._endDrop.addEventListener(e,t),this._cursor.addEventListener(e,t),this._waterDropCursor&&this._waterDropCursor.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._beginDrop&&this._beginDrop.removeEventListener(e,t),this._beginUpwardsDrop&&this._beginUpwardsDrop.removeEventListener(e,t),this._endDrop&&this._endDrop.removeEventListener(e,t),this._cursor.removeEventListener(e,t),this._waterDropCursor&&this._waterDropCursor.removeEventListener(e,t)}},{key:"getCursorCoordinates",value:function(e){if(!e)return null;var t=window.APP,n=t.workspace.config.zoom,i={left:0,top:0},o=e.isTranspose,a=t.data.typoinfo.viewOffset;i.top=Math.ceil((e.charPosY-a.y)*n);var r=t.isWebMode()?0:t.workspace.getZoomDiff();return i.left=o?Math.floor(e.charPosX*n+r):Math.floor((e.posX-a.x)*n+r),i}},{key:"update",value:function(e,t){if((!this.app.isReadOnly()||f.isMobile||f.isPad)&&this.relation)if(this._selectionRects=null,e&&e.begin&&e.end&&!e.activeShapeIdxPath){var n=e.getNormalRanges();if(n.length>1&&(f.isMobile||f.isPad)){var i=e.getNormalRange(),o=new P.a(e,i.pos,!1),a=new P.a(e,i.pos+i.len,!0);f.isMobile?this._setLeftWaterDropPos(o,a,t):this._setBeginDropPos(o,t),this._setEndDropPos(a,t,!0),this.resetCursor()}else{var r=e.getRangedSelection(),s=r.begin,l=r.end;if(r.isSame){if(this.reset(),!this.app.isReadOnly()){if(!s.pos)return;var u=s.pos.line.range;s.position===u.begin?this._setCursorPos(s,t):this._setCursorPos(this.app.data.typoinfo.getPosition(s.position,!0),t)}}else{if(e.inOMath&&(this._selectionRects=E.b.locateRect(this.app.data,n[0].pos,n[0].len,this.app.data.typoinfo)),f.isMobile?this._setLeftWaterDropPos(s,l,t):this._setBeginDropPos(s,t),this.checkEndIsBreak(e)){this._setEndDropPos(l,t,!1,!0)}else if(this.needAdjustEnd(e,s,l)){var c=l.glyphTail?l:new P.a(e,l.position-1);this._setEndDropPos(c,t,!0)}else this._setEndDropPos(l,t);this.resetCursor()}}}else this.reset()}},{key:"changeWaterDrop",value:function(){return!!this.app.data.selection.getNormalRange().len&&(this.isChangeBeginDropShape=!0,!0)}},{key:"_setLeftWaterDropPos",value:function(e,t,n){var i=this.getLeftWaterDrop().currentLineHeight,o=Math.abs(e.pos.posX*n-t.pos.posX*n)<24,a=Math.abs(e.pos.posY*n-t.pos.posY*n)<i+29+4+1;this.isReloadingDropShape&&(this.isUpwardsBeginDrop=o&&a),this.isChangeBeginDropShape?(o&&a?(this._beginDrop&&this._beginDrop.reset(),this._setBeginUpwardsDropPos(e,n),this.isUpwardsBeginDrop=!0):(this._beginUpwardsDrop&&this._beginUpwardsDrop.reset(),this._setBeginDropPos(e,n),this.isUpwardsBeginDrop=!1),this.isChangeBeginDropShape=!1,this.isReloadingDropShape=!0):this.isUpwardsBeginDrop?(this._setBeginUpwardsDropPos(e,n),this._beginDrop&&this._beginDrop.reset()):(this._setBeginDropPos(e,n),this._beginUpwardsDrop&&this._beginUpwardsDrop.reset())}},{key:"switchCursorVisibility",value:function(e){this._cursor.switchVisibility(e)}},{key:"switchIndicatorState",value:function(e){this._cursor.switchIndicatorState(e)}},{key:"needAdjustEnd",value:function(e,t,n){if(t&&n&&void 0!==t.position&&void 0!==n.position&&t.position!==n.position){var i=n.position;if(e.data.doc.getDataLogic("final").atPapxBound(i))return!0}return!1}},{key:"checkEndIsBreak",value:function(e){var t=e.getNormalRange().pos+e.getNormalRange().len-1,n=e.data.glyphpool.getGlyphIterator(t);return!!(n&&n.isSpec()&&I.a.isPageBreak(e.data.doc.textStream.getText(t,1).charCodeAt(0)))}},{key:"lockShow",value:function(){this._cursor.lockShow()}},{key:"unlockShow",value:function(){this._cursor.unlockShow()}},{key:"elements",get:function(){return f.isMobile?[this._beginDrop._element,this._beginUpwardsDrop._element,this._endDrop._element,this._waterDropCursor._element,this._cursor._element]:f.isPad?[this._beginDrop._element,this._endDrop._element,this._waterDropCursor._element,this._cursor._element]:[this._cursor._element]}}]),e}();t.b=x},7146:function(e,t,n){"use strict";var i=n(80),o=n.n(i),a=n(13),r=n.n(a),s=n(1),l=n.n(s),u=n(2),c=n.n(u),h=n(1913),d=n(1142),p=n(86),f=n(2694),g=n(240),v=n(227),m=n(167),_=function(){function e(t,n){l()(this,e),this.cb_funcs=t,this.parent=n,this.cmdSeq=1,this.executingCmds=null,this.cmdExecuting=!1,this.isBlocking=!1,this.baseVersion=-1,this.updateVersion=-1,this.querySendTime=0}return c()(e,[{key:"exec",value:function(){if(1!=this.cmdExecuting){var e=this.parent.gainCommands();if(0!=e.length){this.isBlocking=this.parent.hasBlocking();var t={commands:[]};e.forEach((function(e){t.commands.push(e),e.param._sending=!0,e.param.bSendSelectionBack&&(t.bSendSelectionBack=!0),e.param.bSendGlyphTailBack&&(t.bSendGlyphTailBack=!0,t.glyphTail=!!e.param.glyphTail)})),this.isBlocking&&(t.bSendedCmdBlock=!0),this._sendCmds(t,this.cmdSeq),this.cmdSeq++}}}},{key:"query",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(1==this.cmdExecuting)return!1;if(this.isBlocking=this.parent.hasBlocking(),!0===t||this.updateVersion>=window.g_rpt.getCurTaskVersion()||this.cb_funcs.hasPreparedRange()||this.parent.hasQueryCommands()){this.cmdExecuting=!0;var n={};window.g_rpt.appendVersionInfo(n),this.cb_funcs.appendSendInfo(n),e&&(n.onlyQueryStream=!0);var i=null;if(n.queryCommands)for(var o=0;o<n.queryCommands.length;++o){var a=n.queryCommands[o];if(a.param&&a.param.extArgs){i=a.param.extArgs;break}}try{if(n.userAgent=m.isMobile?"mobile":"pc",void 0!==n.blockIndexs){var r=n.blockIndexs;delete n.blockIndexs;for(var s=0;s<r.length;++s)n.blockId=r[s],console.log("[auxops] document.query ",JSON.stringify(n)),this.parent._client.send("document.query",n,i)}else this.querySendTime=Date.now(),console.log("[auxops] document.query ",JSON.stringify(n)),this.parent._client.send("document.query",n,i),window.collection("experience",{event:"reading_request_send"});return!0}catch(e){}}return!1}},{key:"queryInit",value:function(){if(1==this.cmdExecuting)return!1;this.isBlocking=this.parent.hasBlocking();return this.parent._client.send("document.query",{init:!0},null),!0}},{key:"sendUndo",value:function(){if(1==this.cmdExecuting||this.parent.hasCommands())return!1;this.isBlocking=this.parent.hasBlocking();return this._sendCmds({undo:!0},this.cmdSeq),this.cmdSeq++,!0}},{key:"sendRedo",value:function(){if(1==this.cmdExecuting||this.parent.hasCommands())return!1;this.isBlocking=this.parent.hasBlocking();return this._sendCmds({redo:!0},this.cmdSeq),this.cmdSeq++,!0}},{key:"onReconnect",value:function(){if(0!=this.cmdExecuting)if(null!=this.executingCmds){try{window.collectionOnce();var e=this.executingCmds.commands[0];e&&"paste"!==e.name&&!window.APP.isReadOnly()&&this.parent._client.send("document.exec",this.executingCmds)}catch(e){}this.executingCmds=null,this.cmdExecuting=!1}else!0===this.cmdExecuting&&(this.cmdExecuting=!1,this.parent.hasQueryCommands()&&this.query())}},{key:"versionsToString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t="[";return e.forEach((function(e){t+="{\n\tdataVer: "+e.dataVer+", self: "+e.self;var n=e.ops;t+="\n\t[",n.forEach((function(e){t+="\n\t\t"+JSON.stringify(e)})),t+="\n\t]},\n"})),t+"]\n"}},{key:"onQuery",value:function(e){var t=Date.now()-this.querySendTime;console.log("[auxops] onQuery",this.versionsToString(e.versions)),this.cmdExecuting=!1,this.executingCmds=null,this.isBlocking=!1,this.cb_funcs.onCmdResponse(e,!1),v.default.cooper.onNewCooperHistory(),this._sendOthers();var n=this.parent._client;if(n.getLastMsgLength){var i=n.getLastMsgLength();window.collection("experience",{event:"reading_request_success",times:t,value:i})}}},{key:"onExec",value:function(e){console.log("[auxops] onExec",this.versionsToString(e.versions)),this.cmdExecuting=!1,this.executingCmds=null,this.isBlocking=!1,this.cb_funcs.onCmdResponse(e,!0),v.default.cooper.onNewCooperHistory(),this._sendOthers()}},{key:"onUpdateShapes",value:function(e){this._sendOthers()}},{key:"onNotifyChange",value:function(e){e.taskVer>this.updateVersion&&(this.updateVersion=e.taskVer)}},{key:"prepareRange",value:function(e){this.cb_funcs.prepareRange(e)}},{key:"needQuery",value:function(){return this.updateVersion>window.g_rpt.getCurTaskVersion()||this.cb_funcs.hasPreparedRange()}},{key:"reset",value:function(){this.executingCmds=null,this.cmdExecuting=!1,this.cmdBlocking=!1,this.baseVersion=-1,this.updateVersion=-1,this.cmdSeq=1}},{key:"hasBlocking",value:function(){return this.isBlocking}},{key:"isIdle",value:function(){return 0==this.cmdExecuting&&null==this.executingCmds}},{key:"_sendOthers",value:function(){this.parent.hasCommands()?this.exec():(this.parent.hasQueryCommands()||this.cb_funcs.hasPreparedRange())&&this.query()}},{key:"_sendCmds",value:function(e,t){var n="document.exec";if(window.APP.isReadOnly()){var i=!1;if(window.APP.isAclComment&&e.commands.some((function(e){var t=e.name,n=e.param;if(!window.APP.isAllowCmd(t,n))return i=!1,!0;i=!0})),!i)return void console.error(window.APP.readOnlyError);n="comment.exec";for(var o=0;o<e.commands.length;++o){var a=e.commands[o];a.param&&(a.param.verifyType="comment")}}e.seq=t,window.g_rpt.appendVersionInfo(e),this.cb_funcs.appendSendInfo(e),this.cmdExecuting=!0,this.executingCmds=e;var r=null;if(e.commands)for(var s=0;s<e.commands.length;++s){var l=e.commands[s];if(l.param&&l.param.extArgs){r=l.param.extArgs;break}}console.log("[auxops] document.exec ",JSON.stringify(e));try{window.collectionOnce(),this.parent._client.send(n,e,r)}catch(e){}}},{key:"resetCmdBlocking",value:function(){this.cmdExecuting=!1,this.executingCmds=null,this.isBlocking=!1}}]),e}(),y=n(2004),b=n(4103),T=n(562),C=n(260),k=n(1290),w=n(14),S=function(){function e(){l()(this,e)}return c()(e,[{key:"onOpen",value:function(e){console.log("onOpen:",e)}},{key:"onSessionReady",value:function(e){console.log("onSessionReady",e)}},{key:"afterOpen",value:function(e){return console.log("afterOpen:",e),Promise.resolve()}},{key:"onCmdResponse",value:function(e){console.log("onCmdResponse:",e)}},{key:"onUpdateShapes",value:function(e){console.log("onUpdateShapes:",e)}},{key:"hasPreparedRange",value:function(){return console.log("hasPreparedRange:"),!1}},{key:"appendSendInfo",value:function(e){console.log("appendSendInfo:",e)}},{key:"prepareRange",value:function(e){console.log("prepareRange:",e)}},{key:"onTypoChanged",value:function(e){console.log("onTypoChaned:",e)}},{key:"beforeSendCommandBlock",value:function(e){console.log("beforeSendCommandBlock:",e)}},{key:"onPermissionChange",value:function(){}}]),e}(),P=function(){function e(t){l()(this,e),this.init(t),this.hasDocumentOpened=!1}var t,n;return c()(e,[{key:"single_reset",value:function(){}},{key:"init",value:function(e){this._documentOpened=!1,this._fileid="",this._acl="none",this._permissions=null,this._securityDocPermission=null,this._isRPCOffline=!1,this.cb_funcs=null==e?new S:e,this.commandQueue=[],this.commandCallbacks=new Map,this.cmdBlocking=!1,this.isSessionReady=!1,this.sender=new _(this.cb_funcs,this),this.queryCmds=[],this.queryCmdsSeq=0,this.shapeCmdCBs=new Map,this.shapeCmdSeq=0,this.shapeCmdCache=[],this.currentSessionLatency=0,window.session=this,this.inOfflineSimulate=!1,this._client=p.getClient(),this._interactClient=f.getClient(),this.registerEventHandlers()}},{key:"postObjectURL",value:function(){return y.urlForObject(this._fileid,"text")}},{key:"sendBroadcast",value:function(e){this._client.send("user.broadcast",{message:JSON.stringify(e)})}},{key:"openFile",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._fileid=e,this._openCallback=t;var a=Object(w.getNumberQuery)("start_version")||0;this._client.connect(i,n,o,!0,"today",a,0),this._client.enable(),window.__CONFIG__.isEnableInteractSession&&this._interactClient.enable()}},{key:"updateToken",value:function(e){this.send("token.update",{token:e})}},{key:"send",value:function(e,t){return this._client.send(e,t)}},{key:"sendSelectionChange",value:function(e){v.default.cooper.getCooperCenter().sendSelectionChange(e)}},{key:"getShapeKey",value:function(e){return"UpdateShapes-"+e}},{key:"delayUpdateShapes",value:function(){var e=this;this.shapeCmdCache.forEach((function(t){e.updateShapes(t.cmd,t.cb)})),this.shapeCmdCache=[]}},{key:"updateShapes",value:function(e,t){this.isSessionReady?e&&e.shapeTrees&&e.shapeTrees.length>0&&(e.dpi=Math.round(96*g.getDevicePixelRatio()),void 0===e.exportTextboxAsImg&&(e.exportTextboxAsImg=!1),this.shapeCmdSeq>16777216&&(this.shapeCmdSeq=0),e.shapeSeq=++this.shapeCmdSeq,t&&this.shapeCmdCBs.set(this.getShapeKey(this.shapeCmdSeq),t),this._client.send("document.updateShapes",e)):this.shapeCmdCache.push({cmd:e,cb:t})}},{key:"tryLock",value:function(){return!window.__WPSENV__.conflictLock.tryLock(!1)||(console.info("lock is fired"),!1)}},{key:"holdLock",value:function(){return!!this.tryLock()&&(v.default.dispatchEvent(v.default.names.cooper.ON_DOCUMENT_SAVEING_HOLDING_LOCK,{holdLocked:!0}),!0)}},{key:"unholdLock",value:function(){v.default.dispatchEvent(v.default.names.cooper.ON_DOCUMENT_SAVEING_HOLDING_LOCK,{holdLocked:!1})}},{key:"sendCommandBlock",value:function(e,t,n){if(window.APP.isReadOnly()&&!window.APP.isAllowCmd(e,t))return console.error(window.APP.readOnlyError),!1;if(!this.tryLock())return!1;if(this.cb_funcs.beforeSendCommandBlock(),this.cmdBlocking)throw new Error("command blocking!");if(this.commandQueue.length>0&&this.baseVersion!=window.g_rpt.getCurTaskVersion())throw new Error("version difference");return this.baseVersion=window.g_rpt.getCurTaskVersion(),this.cmdBlocking=!0,n&&this.commandCallbacks.set(e,n),console.log("[auxops] push {"+e+", "+JSON.stringify(t)+"} to commandQueue block"),this.sender.isIdle()?(this.commandQueue.push({name:e,param:t}),this.sender.exec()):this.commandQueue.push({name:e,param:t}),y.setModified(),!0}},{key:"sendCommandQueue",value:function(e,t){if(window.APP.isReadOnly()&&!window.APP.isAllowCmd(e,t))return console.error(window.APP.readOnlyError),!1;if(t&&t.isComposing)return!1;if(!this.tryLock())return!1;if(this.cmdBlocking)throw new Error("command blocking!");if(this.commandQueue.length>0&&this.baseVersion!=window.g_rpt.getCurTaskVersion())throw new Error("version difference");return this.baseVersion=window.g_rpt.getCurTaskVersion(),console.log("[auxops] push {"+e+", "+JSON.stringify(t)+"} to commandQueue"),this.sender.isIdle()?(this.commandQueue.push({name:e,param:t}),this.sender.exec()):this.commandQueue.push({name:e,param:t}),y.setModified(),!0}},{key:"addQueryCommand",value:function(e,t){for(var n=0;n<this.queryCmds.length;++n){var i=this.queryCmds[n];if(i.name===e){if(!t||!t.preventMerge)return i.param=t,this.queryCmdsSeq;if(i.param&&Object(k.shallowEqual)(i.param,t))return i.param=t,this.queryCmdsSeq}}return 16777216===this.queryCmdsSeq?this.queryCmdsSeq=0:this.queryCmdsSeq++,console.log("[auxops] push {"+e+", "+JSON.stringify(t)+"} to queryCmds"),this.queryCmds.push({name:e,param:t,seq:this.queryCmdsSeq}),this.queryCmdsSeq}},{key:"_doQueryCommand",value:function(e,t,n){if(this.cmdBlocking)throw new Error("command blocking!");var i=this.addQueryCommand(e,t);return this.cb_funcs.beforeSendCommandBlock(),this.cmdBlocking=n,this.isWholeIdle()&&this.sender.query(),i}},{key:"queryCommandBlock",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i.initiative&&window.collectionOnce();var o=this._doQueryCommand(e,t,!0);return n&&this.commandCallbacks.set(e+"-"+o,(function(){v.default.dispatchEvent(v.default.names.cooper.ON_DOCUMENT_SAVE_SUCCESS),n.apply(void 0,arguments)})),!0}},{key:"queryCommandQueue",value:function(e,t,n){var i=this._doQueryCommand(e,t,!1);n&&this.commandCallbacks.set(e+"-"+i,n)}},{key:"executeQueryCmdCallback",value:function(e){var t=e.error,n=e.name,i=e.result,o=n+"-"+e.seq,a=this.commandCallbacks.get(o);a&&(a({success:0===t,result:i}),this.commandCallbacks.delete(o))}},{key:"executeCmdCallback",value:function(e){var t=e.error,n=e.cmdName,i=this.commandCallbacks.get(n);i&&(i(r()({},e,{success:0===t})),this.commandCallbacks.delete(n))}},{key:"queryRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.sender.prepareRange(e,!this.isSessionReady),!(!this.isWholeIdle()||!this.sender.needQuery())&&this.sender.query(t)}},{key:"queryInit",value:function(){return!!this.sender.isIdle()&&(this.cmdBlocking=!0,console.warn("init version..."),this.sender.queryInit())}},{key:"sendUndo",value:function(){return!!this.sender.isIdle()&&(this.cmdBlocking=!0,this.sender.sendUndo())}},{key:"sendRedo",value:function(){return!!this.sender.isIdle()&&(this.cmdBlocking=!0,this.sender.sendRedo())}},{key:"cancelCommand",value:function(e,t){var n=function(t){for(var n=0;n<t.length;++n){if(t[n].name===e)return t.splice(n,1),!0}return!1};if(!n(this.queryCmds)&&!n(this.commandQueue)){var i={};i.cancelCommands=[{name:e,param:t}];try{this._client.send("document.cancel",i),this.commandCallbacks.delete(e)}catch(e){}}}},{key:"hasBlocking",value:function(){return this.cmdBlocking}},{key:"hasCommands",value:function(){return this.commandQueue.length>0}},{key:"gainCommands",value:function(){var e=this.commandQueue;return this.commandQueue=[],e}},{key:"isWholeIdle",value:function(){return this.isSessionReady&&this.sender.isIdle()&&!this.hasCommands()}},{key:"reset",value:function(){this.commandQueue=[],this.cmdBlocking=!1,this.sender.reset()}},{key:"clearCommands",value:function(){this.cmdBlocking?this.commandQueue.splice(0,this.commandQueue.length-1):this.commandQueue=[]}},{key:"pushCommand",value:function(e){e.param.isComposing||e.param._sending||(this.cmdBlocking?this.commandQueue.splice(this.commandQueue.length-1,0,e):this.commandQueue.push(e))}},{key:"popCommand",value:function(){!this.cmdBlocking&&this.commandQueue.length>0&&this.commandQueue.pop()}},{key:"hasQueryCommands",value:function(){return this.queryCmds.length>0}},{key:"gainQueryCommands",value:function(){var e=this.queryCmds;return this.queryCmds=[],e}},{key:"isConnected",value:function(){return this._isConnected}},{key:"_onConnected",value:function(){this._isConnected=!0,this._isRPCOffline=!1,v.default.dispatchEvent(v.default.names.network.ON_CONNECTED)}},{key:"_onDisconnected",value:function(){this._isConnected=!1,v.default.dispatchEvent(v.default.names.network.ON_DISCONNECTED)}},{key:"isRPCOffline",value:function(){return this._isRPCOffline}},{key:"renewSession",value:function(e){if(this._documentOpened=!1,this._client.serverID=e.serverid,console.log("session: renew serverid:",e.serverid),this._client.sendJson("session.renew",{serverid:this._client.serverID}),!0!==e.forbid_open){this.commandQueue=[],this.cmdBlocking=!0,this.sender.reset();var t={queryInitArgs:{lowPerformanceMode:window.__CONFIG__.wps.useLowPerformanceMode}};this._client.send("document.open",null,t)}v.default.cooper.onNewCooperHistory()}},{key:"registerEventHandlers",value:function(){var e=this,t=this;this._client.on(p.events.ONLINE,(function(){e._onConnected()})),this._client.on(p.events.OFFLINE,(function(){e._onDisconnected(),v.default.dispatchEvent(v.default.names.network.ON_RPC_OFFLINE),t._isRPCOffline=!0})),this._client.on(p.events.CLOSED,(function(){e._onDisconnected()})),this._client.on("rollback.start",(function(){console.log("session: rollback start")})),this._client.on("rollback.complete",(function(){console.log("session: rollback complete")})),this._client.on("document.rollback",(function(t){console.log("session: file rollback to revision:",t.revision,"reopen workboook"),e.renewSession(t)})),this._client.on("update_version_reconnect",(function(t){e.renewSession(t),v.default.dispatchEvent(v.default.names.network.UPDATE_NEW_VERSION)})),this._client.on("security_doc_change_reconnect",(function(t){1!==t.change_type&&2!==t.change_type||(e.renewSession(t),v.default.dispatchEvent(v.default.names.network.UPDATE_NEW_VERSION),v.default.dispatchEvent(v.default.names.file.ON_SECURITY_DOC_CHANGE_RECONNECT,t))})),this._client.on("document.save",(function(t){console.log("session: document.save",t),e.saveCallback&&(e.saveCallback(t),e.saveCallback=null)})),this._client.on("document.changed",(function(t){e._onChangedNotify(t)})),this._client.on("securitydoc.permission.change",(function(e){v.default.dispatchEvent(v.default.names.file.ON_SECURITY_DOC_PERMISSION_CHANGE,e)})),this._client.on("document.revisionCount",(function(e){var t=e.revision_count?e.revision_count:0,n=e.comment_count?e.comment_count:0;window.APP.workspace.historyVersionObj={revisionCount:t+n,compareVersion:e.start_version,preview:e.preview},C.default.dispatchEvent(C.default.revision.REVISION_COUNT,{revisionCount:t+n,compareVersion:e.start_version,preview:e.preview})})),this._client.on("securitydoc.permission",(function(t){e._securityDocPermission=t})),this._client.on("user.selection.change",(function(t){e._onOthersSelectChange(t)})),this._client.on("user.broadcast",(function(e){e.message=JSON.parse(e.message),v.default.dispatchEvent(v.default.names.cooper.ON_BROADCAST_MSG,e)})),this._client.on("session.open",(function(t){y.onFileOpen(t.fileid),e._onSessionOpen(t)})),this._client.on("doc.permission",(function(t){var n=Object.assign({},e._permissions);e._permissions=t,window.__WPSENV__.reduxDispatch(Object(h.setFilePermission)(t)),v.default.dispatchEvent(v.default.names.file.SET_FILE_PERMISSIONS,t),e.cb_funcs.onPermissionChange(n,t)})),this._client.on("session.pong",(function(t){var n=(new Date).getTime()-t.start;e.currentSessionLatency=n,v.default.dispatchEvent(v.default.names.network.ON_NETWORK_SPEED_CHANGE,n)})),this._client.on("user.nooperation",(function(e){console.log("user no operation for a long time ")})),this._client.on("document.open",(function(t){t.error?console.log("open document failed!, reason:",t.reason):(console.log("open document success"),e._onDocumentOpen(t))})),this._client.on("session.shapeUrlPrefix",(function(e){var t=e&&e.urlprefix;t?(new b.a).config(t):console.warn("shape url prefix is illegal")})),this._client.on("session.error",(function(t){var n=y.onSessionError(t);e._client.close(),n&&e._client.reconnect()})),this._client.on("document.exec",(function(t){e._onDocumentExec(t)})),this._client.on("document.query",(function(t){e._onDocumentQuery(t)})),this._client.on("document.updateShapes",(function(t){e._onDocumentUpdateShapes(t)})),this._client.on("document.cancel",(function(t){e._onDocumentCancel(t)})),this._client.on("document.styletag",(function(t){e._onStyleTagReceived(t)})),this._client.on("session.full",(function(){console.log("session: max users exceed, retry later..."),v.default.dispatchEvent(v.default.names.network.ON_FILE_OPEN_ERROR,{type:T.default.SessionFull}),e._client.close()})),this._client.on("document.typoChanged",(function(t){e._onTypoChanged(t)})),this._client.on("file.compatiblity",(function(){window.Notice&&window.Notice.warn(_i18n("applications.writer.components.network.saveError", "This is a plain text file. You will only be able to save text content."))})),this._client.on("document.reloadas",(function(t){var n=t.UserReloadArgs,i=n.encoding,o=n.isReloadAfterReconnect,a=t.connid,r=t.userid;a===e._client.clientID||o||C.default.dispatchEvent(C.default.document.ON_OTHER_USER_CHANGE_DOCUMENT_ENCODING,{userId:r,encoding:i})})),this._client.on("space.full",(function(e){var t=Object.assign({manual:!0},e);v.default.dispatchEvent(v.default.names.ON_FILE_SPACE_CHANGE,t)})),this._client.on("space.info",(function(e){var t=Object.assign({manual:!1},e);v.default.dispatchEvent(v.default.names.ON_FILE_SPACE_CHANGE,t)})),this._client.on("link_permission_change",(function(e){var t=Object.assign({eventName:"permission_change"},e);v.default.dispatchEvent(v.default.names.file.ON_FILE_INFO_CHANGE,t)})),this._client.on("update_version",(function(e){var t=Object.assign({eventName:"update_version"},e);v.default.dispatchEvent(v.default.names.file.ON_FILE_INFO_CHANGE,t)})),this._client.on("version.upgrade",(function(){v.default.dispatchEvent(v.default.names.file.ON_FILE_INFO_CHANGE,{eventName:"force_refresh"})})),this._client.on("online_mode_change",(function(e){return y.onOnlineModeChange(e)})),this._client.on("session.ready",(function(){e.isSessionReady=!0,window.APP&&window.APP.data&&window.APP.data.doc&&(e.delayUpdateShapes(),e.sender.query(!1,!0),e.cb_funcs.onSessionReady())})),this._client.on("ack.error",(function(e){switch(e.reason){case"BinVariantException":window.__CONFIG__.wps.onBinVariantException&&v.default.dispatchEvent(v.default.names.file.BIN_VARIANT_EXCEPTION),window.collection("BinVariantException",e)}})),this._client.on("comment.emoji.update",(function(e){if(e||e.message){var t=JSON.parse(e.message);C.default.dispatchEvent(C.default.comments.COMMENT_EMOJI_UPDATE,t)}})),this._client.on("comment_text_review",(function(e){v.default.dispatchEvent(C.default.comments.ON_COMMENT_TEXT_REVIEW,e)})),this._interactClient?(this._interactClient.on("user.list",(function(e){v.default.cooper.onUserListInit(e)})),this._interactClient.on("users.total",(function(e){v.default.cooper.onUsersTotal(e)})),this._interactClient.on("user.change",this._onUserChange)):(this._client.on("user.list",(function(e){v.default.cooper.onUserListInit(e)})),this._client.on("user.change",this._onUserChange))}},{key:"beginOfflineSimulate",value:function(){this._client.close(),this.inOfflineSimulate=!0,this._onDisconnected()}},{key:"endOfflineSimulate",value:function(){this.inOfflineSimulate=!1,this._client.reconnect()}},{key:"_onSessionOpen",value:function(e){console.log("session: opened with connid:",e.connid,"serverid:",e.serverid,"acl:",e.acl),this._acl=e.acl,this._documentOpened&&e.serverid===this._client.serverID&&this._client.serverIDEqual&&!e.will_query_init?this.sender.onReconnect():(this._documentOpened=!1,this._client.serverIDEqual=!0),this._sessInfo=e}},{key:"_onDocumentOpen",value:(n=o()(regeneratorRuntime.mark((function e(t){var n,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.reset(),n=this.hasDocumentOpened,e.next=4,this.cb_funcs.onOpen(t);case 4:this._documentOpened=!0,this.sender.cb_funcs=this.cb_funcs,n?this.afterFirstPaint(t):(this.hasDocumentOpened=!0,setTimeout((function(){i.afterFirstPaint(t)}),50));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"afterFirstPaint",value:(t=o()(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cb_funcs.afterOpen(t);case 2:this._openCallback(this._sessInfo),C.default.dispatchEvent(C.default.document.ON_DOCUMENT_OPEN);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_onUserChange",value:function(e){v.default.cooper.onUserChange(e),v.default.cooper.onNewCooperHistory()}},{key:"_onOthersSelectChange",value:function(e){v.default.cooper.onOthersSelectChange(e)}},{key:"_onChangedNotify",value:function(e){var t=this;this.sender.onNotifyChange(e),setTimeout((function(){t.isWholeIdle()&&t.sender.query()}))}},{key:"_onDocumentQuery",value:function(e){var t=this;this.sender.hasBlocking()&&(this.cmdBlocking=!1),e.queryResult&&e.queryResult.length>0&&e.queryResult.forEach((function(e){t.executeQueryCmdCallback(e)})),this.sender.onQuery(e),v.default.cooper.onNewCooperHistory(),this.isWholeIdle()&&this.sender.needQuery()&&!this._isError(e)&&this.sender.query()}},{key:"_onDocumentExec",value:function(e){var t=this;this.sender.hasBlocking()&&(this.cmdBlocking=!1),this.sender.onExec(e),this.isWholeIdle()&&this.sender.needQuery()&&!this._isError(e)&&this.sender.query(),e.execResult&&e.execResult.length>0&&e.execResult.forEach((function(e){t.executeCmdCallback(e)}))}},{key:"_onStyleTagReceived",value:function(e){C.default.dispatchEvent(C.default.names.ON_STYLE_TAG_RECEIVED,e)}},{key:"_onDocumentUpdateShapes",value:function(e){var t=void 0===e.shapeSeq?1:e.shapeSeq,n=this.getShapeKey(t),i=this.shapeCmdCBs.get(n);i&&(i(e),this.shapeCmdCBs.delete(n)),this.sender.onUpdateShapes(e),this._isError(e)&&console.error("server error!",e),this.isWholeIdle()&&this.sender.needQuery()&&!this._isError(e)&&this.sender.query()}},{key:"_onDocumentCancel",value:function(e){this._isError(e)&&console.error("server error!",e)}},{key:"_onTypoChanged",value:function(e){this.cb_funcs.onTypoChanged(e)}},{key:"_isError",value:function(e){return void 0!==e.error}},{key:"resetCmdBlocking",value:function(){this.cmdBlocking=!1,this.sender.resetCmdBlocking()}},{key:"cmdBlocking",get:function(){return this._cmdBlocking},set:function(e){this._cmdBlocking!==e&&(this._cmdBlocking=e,e?this._switchBlockingStateTimeout=setTimeout((function(){v.default.dispatchEvent(v.default.names.edit.ON_CMD_BLOCKING_STATE_CHANGED,e)}),400):(this._switchBlockingStateTimeout&&(clearTimeout(this._switchBlockingStateTimeout),this._switchBlockingStateTimeout=null),v.default.dispatchEvent(v.default.names.edit.ON_CMD_BLOCKING_STATE_CHANGED,e)))}}],[{key:"buildGetInstance",value:function(t){return d.a.buildGetInstance(e,t)}}]),e}();t.a=P},7154:function(e,t,n){"use strict";n.r(t);var i=n(8),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(623),c=n(361),h=function(){function e(){r()(this,e),this.timeout=null,this.ids=[],this.handles=[],this.shapeIds=[]}return l()(e,[{key:"getShapeURL",value:function(e,t,n){var i={ids:e,support_webp:!1};window.APP.dispatch(function(e){if(!e)throw new Error("Update Shapes Param Error");var t="/api/v3/office/file/"+window.urlFileId+"/shapes";return{types:c.default.HTTP_TYPES,autoErrorToast:!1,callAPI:function(n){return n.post(t).send(e).end()}}}(JSON.stringify(i))).then((function(e){if(e.error)window.report(u.TYPE.COUNT,"wps_shape_update_url_response_error",1),n.forEach((function(e){e.resolve()}));else{var i=e.response.body;Object.keys(t).forEach((function(e){var o={urls:{},webp_urls:{}};t[e].forEach((function(e){i.urls[e]&&(o.urls[e]=i.urls[e]),i.webp_urls[e]&&(o.webp_urls[e]=i.webp_urls[e])})),n[e].resolve(o)}))}}))}},{key:"getParams",value:function(){var e=this.shapeIds,t=this.handles,n=this.ids;return this.ids=[],this.shapeIds=[],this.handles=[],[n,e,t]}},{key:"updateShapeUrl",value:function(e){var t,n=this;this.timeout&&(clearTimeout(this.timeout),this.timeout=null);var i=Array.isArray(e)?e:[e];return(t=this.ids).push.apply(t,o()(i)),this.shapeIds.push(i),new Promise((function(e,t){var i={resolve:e,reject:t};if(n.handles.push(i),n.ids.length>9){var a=n.getParams();n.getShapeURL.apply(n,o()(a))}else n.timeout=setTimeout((function(){var e=n.getParams();n.getShapeURL.apply(n,o()(e))}),100)}))}}]),e}();t.default=h},7155:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(1318),l=n(324),u=n(3484),c=n(2956),h=n(309),d=n(1251),p=n(3485),f=n(723),g=s.c.DOCCharTypeFastDetecter,v=s.b.usrDevangari,m=s.b.usrTibet,_=s.b.usrLao,y=s.b.usrThai,b=s.b.usrTamil,T=s.b.usrTelugu,C=s.b.usrCeylon,k=s.b.usrGurmukhi,w=s.b.usrBurma,S=s.b.usrBengali,P=s.b.usrMalayalam,I=s.b.usrKannada,E=s.b.usrGujarati,O=s.b.usrCambodia,x={};function R(e,t){var n={};return t.forEach((function(e){for(var t=e.begin,i=e.end;t<i;++t)n[t]=!0})),x[e]=n,n}var N=R(v,[{begin:2304,end:2308},{begin:2362,end:2365},{begin:2366,end:2384},{begin:2385,end:2392},{begin:2402,end:2404}]);R(m,[{begin:3864,end:3866},{begin:3893,end:3894},{begin:3895,end:3896},{begin:3897,end:3898},{begin:3902,end:3904},{begin:3953,end:3973},{begin:3974,end:3976},{begin:3981,end:4029}]),R(_,[{begin:3761,end:3762},{begin:3764,end:3773},{begin:3784,end:3790}]),R(y,[{begin:3633,end:3634},{begin:3635,end:3643},{begin:3655,end:3663}]),R(b,[{begin:2946,end:2947},{begin:3006,end:3022},{begin:3031,end:3032}]),R(T,[{begin:3072,end:3077},{begin:3134,end:3159},{begin:3170,end:3172}]),R(C,[{begin:3458,end:3460},{begin:3530,end:3552},{begin:3570,end:3571}]),R(k,[{begin:2561,end:2564},{begin:2620,end:2642},{begin:2672,end:2674},{begin:2677,end:2678}]),R(w,[{begin:4139,end:4159},{begin:4182,end:4186},{begin:4190,end:4193},{begin:4194,end:4197},{begin:4199,end:4206},{begin:4209,end:4213},{begin:4226,end:4238},{begin:4239,end:4240},{begin:4250,end:4254}]),R(S,[{begin:2433,end:2436},{begin:2492,end:2493},{begin:2494,end:2510},{begin:2519,end:2520},{begin:2530,end:2532},{begin:2558,end:2559}]),R(P,[{begin:3328,end:3332},{begin:3387,end:3389},{begin:3390,end:3406},{begin:3415,end:3416},{begin:3426,end:3428}]),R(I,[{begin:3201,end:3204},{begin:3260,end:3261},{begin:3262,end:3287},{begin:3298,end:3300}]),R(E,[{begin:2689,end:2692},{begin:2748,end:2749},{begin:2750,end:2766},{begin:2786,end:2788},{begin:2810,end:2816}]),R(O,[{begin:6070,end:6100},{begin:6109,end:6110}]);var A=[2509],D=[2503,2507,2508];function M(e,t,n,i,o){if(t<n&&!o[e]){var a=0,r=0;return i.forEach(t,n,(function(e,t,n){if(r=t[n].charCode,!o[r])return!0;++a})),a}return 0}function L(e,t,n){var i=1,o=t,a=e.at(o++).charCode,r=g.getUnicodeCharItem(a);switch(r.usrType){case v:i+=function(e,t,n,i){if(t<n){var o=i.at(t).charCode,a=null;if((o>=2304&&o<2432||o===l.u)&&(N[e]!=N[o]||o===l.u)){var r=1;return i.forEach(t+1,n,(function(e,t,n){if((a=t[n].charCode)!==l.u&&!N[a]&&o!==l.u)return!0;++r,o=a})),r}}return 0}(a,o,n,e);break;case S:i=function e(t,n,i){var o=0;if(t<n){var a=x[S],r=i.at(t).charCode;if(g.getUnicodeCharItem(r).usrType===S){for(o=1;t+o<n&&A.includes(i.at(t+o).charCode);){var s=e(t+o+1,n,i);if(!s.len)break;o=s.pos+s.len-t}for(1===o&&(o+=M(r,t+o,n,i,a));t+o<n;){var l=e(t+o,n,i);if(!l.len)break;if(!D.includes(i.at(l.pos+l.len-1).charCode))break;o+=l.len}}}return{pos:t,len:o}}(o-1,n,e).len;break;default:var s=x[r.usrType];s&&(i+=M(a,o,n,e,s))}return i}var F=n(6105),B=s.c.DOCCharTypeFastDetecter,H=s.b.usrHebrewXA,G=s.b.usrBasicHebrew,W=s.b.usrBasicArabic,j=s.b.usrArabicX,U=s.b.usrArabicSupplement,V=s.b.usrSyriac,Y=s.b.usrArabicPresentationFormsA,z=s.b.usrArabicPresentationFormsB,K=s.b.usrThai,Z=function(){function e(){o()(this,e)}return r()(e,[{key:"init",value:function(e,t){this.doc=e,this.dataLogic=t}},{key:"isEmbedShape",value:function(e){var t=this.doc,n=t.anchors.findAnchor(e);if(n)return{isEmbed:d.a===n.wrapMode};var i=t.inlineAnchors.findAnchor(e);if(i){var o=i.shapeData;return{isEmbed:!!i,isOleEmbed:!!(o&&o.isOle&&o.controlObj)}}return{isEmbed:!1}}},{key:"isTickCharBox",value:function(e,t,n){var i=this.doc,o=void 0,a=e;if(n){a=t&&t.getPropVal("symbol_char");var r=t&&t.getPropVal("symbol_fontname");o=i.fonttable.getName(r)}else o=i.fonttable.getName(t.font_name_ascii||t.font_name_ftcbi);return!a||163!=a&&42!=a&&82!=a&&61603!=a&&61482!=a&&61522!=a?!a||168!=a&&111!=a&&254!=a&&61608!=a&&61551!=a&&61694!=a?9633==a||9745==a:"Wingdings"===o:"Wingdings 2"===o}},{key:"calcGlyphGroup",value:function(e,t,n,i,o){var a=e,r=o.getCharCode(a),h=B.getUnicodeCharItem(r);i.charInfo=h;var d=h.charClass,p=a++,g=n.chpx.getPropVal("special");g&&i.setSpecFlag();var v=void 0;if(n.chpx.getPropVal("share_hint")!==c.b&&!n.chpx.getPropVal("right_to_left_text")&&!n.chpx.getPropVal("complex_script")||g||(i.setCharRngFlag(u.b),i.setComplexFlag()),Object(F.b)(r)&&t-e>=2){var m=a,_=0,y=o.getCharCode(m++);Object(F.c)(y)&&_++;var b=o.getCharCode(m++);if(_>0&&Object(F.c)(b)&&_++,_>0)return _++,i.isCombine=!0,i.isEmojiKeycap=!0,i.reset(p,p+_),i.len}if(Object(F.a)(r)&&t-e>=2){var T=a,C=0,k=o.getCharCode(T++);if(Object(F.a)(k)&&C++,C>0)return C++,i.isCombine=!0,i.reset(p,p+C),i.len}if(d==s.a.CC_Ascii&&r==l.C&&this.isTickCharBox(r,n.chpx,!0)||this.isTickCharBox(r,n.chpx,!1))return r==l.C&&i.setTickCharSymbolFlag(),i.setTickCharBoxFlag(),i.reset(p,a),i.len;switch(d){case s.a.CC_FarEast:if(i.setCharRngFlag(u.e),h.usrType==s.b.usrHighSurrogates||h.usrType==s.b.usrLowSurrogates){var w=!1;if(a<t&&h.usrType==s.b.usrHighSurrogates){var S=o.getCharCode(a),P=B.getUnicodeCharItem(S,r);P&&(w=!0,i.charInfo=P,P.charClass!==s.a.CC_FarEast&&i.setCharRngFlag(P.charClass))}w&&(i.isCombine=!0,a++);break}if(r==l.r)i.setCharRngFlag(u.l);else if(a<t&&!f.a.isJPNSpecPunc(r)&&!h.isPunc)for(;a<t;){var I=o.getCharCode(a);if(I!=l.r&&!f.a.isJPNSpecPunc(I)&&(v=B.getUnicodeCharItem(I))&&!v.isPunc){if(v.usrType==s.b.usrHighSurrogates||v.usrType==s.b.usrLowSurrogates)break;if(v.charClass==s.a.CC_FarEast){++a;continue}}break}break;case s.a.CC_Ascii:switch(r){case l.D:i.setCharRngFlag(u.n);break;case l.A:case l.z:i.setCharRngFlag(u.l);break;case l.j:i.setCharRngFlag(u.f);break;case l.m:i.setCharRngFlag(u.i);break;case l.k:case l.i:i.setCharRngFlag(u.a);break;case l.l:case l.h:i.setCharRngFlag(u.h);break;case l.B:i.setCharRngFlag(u.m);break;case l.g:case l.f:if(g){var E=this.isEmbedShape(p),O=E.isEmbed,x=E.isOleEmbed;O?(i.setCharRngFlag(u.d),x&&i.setOleEmbedDrawingFlag()):i.setCharRngFlag(u.c)}break;case l.a:g&&i.setSpecFlag();break;case l.y:i.setSpecHiddenFlag();break;case l.C:i.unSetSpecFlag(),i.setCharRngFlag(u.g);break;case l.d:case l.e:i.setSpecHiddenFlag();break;case l.q:i.setFootEndNotePlaceholder();break;default:if(Object(F.b)(r)&&a+1<t){var R=o.getCharCode(a+1);if(Object(F.c)(R))break}if(i.setCharRngFlag(u.g),r>=48&&r<=57)for(;a<t;){var N=o.getCharCode(a);if(a+1<t){var A=o.getCharCode(a+1);if(Object(F.b)(N)&&Object(F.c)(A))break}if(!(N>=48&&N<=57))break;++a}else if(r>=97&&r<=122)for(;a<t;){var D=o.getCharCode(a);if(!(D>=97&&D<=122))break;++a}else if(r>=65&&r<=90)for(;a<t;){var M=o.getCharCode(a);if(!(M>=65&&M<=90))break;++a}}break;case s.a.CC_Shared:var Z=n.chpx.getPropVal("share_hint");Z==c.c?i.setCharRngFlag(u.j):Z==c.a?i.setCharRngFlag(u.k):i.setCharRngFlag(u.b);break;case s.a.CC_NoFarEast:r==l.w?i.setCharRngFlag(u.l):i.setCharRngFlag(u.k);break;case s.a.CC_Complex:switch(i.setCharRngFlag(u.b),i.setComplexFlag(),h.isRtl&&(i.setRTLFlag(),this.hasRTLGroup=!0,h.isArabic&&window.APP.data.glyphpool.initArabicRenderStrLoader()),h.usrType){case H:case G:case V:for(;a<t;){var X=o.getCharCode(a);if(B.getUnicodeCharItem(X).usrType!=h.usrType)break;++a}break;case W:case j:case Y:case z:for(;a<t;){var q=o.getCharCode(a),J=B.getUnicodeCharItem(q);if(!J.isArbic||J.usrType===U)break;++a}break;case U:i.isCombine=!0;break;default:K===h.usrType&&window.APP.initThaiDict();var Q=L(o.buffs,a-1,t);Q>1&&(i.isCombine=!0,a+=Q-1)}}return i.reset(p,a),i.len}},{key:"load",value:function(e){var t=this,n=e.glyphGroups,i=e.glyphPoss,o=e.glyphArrays,a=e.glyphBuff,r=e.segments,l=e.context,u=e.end,c=e.begin,d=this.dataLogic.getText(c,u-c);a.setChars(d,{begin:c,end:u});var f=!window.APP.isPCMode(),g=r,v=a.getCharCode(c);if(B.getUnicodeCharItem(v).usrType==s.b.usrLowSurrogates&&c>0){var m=a.getCharCode(c-1);B.getUnicodeCharItem(m).usrType==s.b.usrHighSurrogates&&(c-=1,n.dropGroups(c,u),g[0].span.pos=c,g[0].span.len+=1)}var _=[],y=void 0;if(g.forEach((function(e){t.hasRTLGroup=!1;for(var r=e.pos,s=r+e.len;r<s;){var l=new p.b;l.chpx=e.chpx,l.papx=e.papx,i.push(r),r+=t.calcGlyphGroup(r,s,e,l,a),!f&&e.isTransposeCoor&&(l.isTransposeCoor=!0),n.attachNode(l),o.push(l)}(t.hasRTLGroup||e.papx.getPropVal("bidi")||e.chpx.getPropVal("right_to_left_text"))&&(y&&y.pos+y.len===e.pos?y.len+=e.len:(y={pos:e.pos,len:e.len},_.push(y)))})),!l.textPartType){for(var b in h)if("MainText"!==b){var T=this.doc.getSubDocOffset(h[b])-1;if(!(T<c||T>=u)){var C=n.findNodeContainPos(T);C&&C.setSeparatorFlag()}}_.length&&window.APP.initBidi(_)}}}]),e}();t.a=Z},716:function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},7160:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(24),l=n.n(s);function u(e,t){var n=void 0;if(null==e||"object"!==(void 0===e?"undefined":l()(e)))return e;if(e instanceof Date)return(n=new Date).setTime(e.getTime()),n;if(e instanceof Array){n=[];for(var i=0,o=e.length;i<o;i++)n[i]=u(e[i],t);return n}if(e instanceof Function)return n=function(){return e.apply(this,arguments)};if(e instanceof Object){for(var a in n=t?new e.constructor:{},e)e.hasOwnProperty(a)&&(n[a]=u(e[a],t));return n}throw new Error("Unable to copy obj as type isn't supported "+e.constructor.name)}function c(e){return u(e,!1)}var h=n(2699),d=n(336),p=function(){function e(t){o()(this,e),this.init(t)}return r()(e,[{key:"init",value:function(e){var t=this;if(e){var n=this.defaultBrush(),i=e.brushColor,o=e.trace,a=e.lineWidth,r=e.pencilType,s=e.points;if(null!=i&&(n.color={toRGB:i,type:0,isAutoColor:!1,sRgb:parseInt(i.slice(-6),16)}),r&&(n.tip=this.pencilType2Tip(r)),a&&this.setLineWidth(n,a),this.leftTop={x:Number.MAX_SAFE_INTEGER,y:Number.MAX_SAFE_INTEGER},this.rightBottom={x:Number.MIN_SAFE_INTEGER,y:Number.MIN_SAFE_INTEGER},this.inkData={brushMap:{br0:n},context:{timeStamp:"",traceFormat:{channelX:{resolution:{uint:h.i.ti,value:.05}},channelY:{resolution:{uint:h.i.ti,value:.05}}}},vecTrace:[]},o&&o.length>0){for(var l=0;l<o.length;l++){var u=o[l];this.updateRect(u.px,u.py)}this.appendTrace(o,"br0")}s&&s.length>0&&s.forEach((function(e){t.appendPoint(e.x,e.y)})),this.scaleX=1,this.scaleY=1}}},{key:"initFromServer",value:function(e){var t=this;if(e.isInk&&e.anchor.shapeData.inkData){var n=e.anchor.shapeData,i=c(n.inkData),o=e.rect,a=o.left+Object(d.Ti2Px)(e.effectExtents.left),r=o.top+Object(d.Ti2Px)(e.effectExtents.top),s=o.right-Object(d.Ti2Px)(e.effectExtents.right),l=o.bottom-Object(d.Ti2Px)(e.effectExtents.bottom),u=i.vecTrace,h=Number.MAX_SAFE_INTEGER,p=Number.MAX_SAFE_INTEGER,f=Number.MIN_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;u.forEach((function(e){t.stringToPoints(e.strPoints).forEach((function(e){e.px<h&&(h=e.px),e.py<p&&(p=e.py),e.px>f&&(f=e.px),e.py>g&&(g=e.py)}))})),f==h&&(f+=1),g==p&&(g+=1),this.scaleX=(s-a)/(f-h),this.scaleY=(l-r)/(g-p),u.forEach((function(e){var n=t.stringToPoints(e.strPoints);n.forEach((function(e){e.px=e.px*t.scaleX,e.px+=a,e.py=e.py*t.scaleY,e.py+=r})),e.vecPoints||(e.vecPoints=[]),e.vecPoints=e.vecPoints.concat(n)})),this.inkData=i,this.inkId=n.mimeDataId}}},{key:"getPencil",value:function(e){return{pencilType:this.getPencilType(e),pencilParams:{selectColor:this.getSelectColor(e),strokeSize:this.getStrokeSize(e)}}}},{key:"getPencilType",value:function(e){var t=this.getBrush(e.brushRef);return this.tip2PencilType(t.tip)}},{key:"getSelectColor",value:function(e){var t=this.getBrush(e.brushRef);return t.color.toRGB.length>7?"#"+t.color.toRGB.substring(3,t.color.toRGB.length):t.color.toRGB}},{key:"getStrokeSize",value:function(e){var t=this.getBrush(e.brushRef),n=t.widthUnit,i=0;return n==h.i.in?i=Object(d.Pt2Px)(72*t.width):n==h.i.cm&&(i=Object(d.Ti2Px)(Object(d.Mm2Ti)(10*t.width))),i}},{key:"pencilType2Tip",value:function(e){return e===h.d.MARKER?h.g.ellipse:e===h.d.FLUORESCENCE?h.g.rectangle:e===h.d.HIGHLIGHTER?h.g.highlight:e===h.d.ERASER?h.g.drop:h.g.ellipse}},{key:"tip2PencilType",value:function(e){switch(e){case h.g.ellipse:return h.d.MARKER;case h.g.rectangle:return h.d.FLUORESCENCE;case h.g.highlight:return h.d.HIGHLIGHTER;case h.g.drop:return h.d.ERASER;default:return h.d.MARKER}}},{key:"updateRect",value:function(e,t){e<this.leftTop.x&&(this.leftTop.x=e),t<this.leftTop.y&&(this.leftTop.y=t),e>this.rightBottom.x&&(this.rightBottom.x=e),t>this.rightBottom.y&&(this.rightBottom.y=t)}},{key:"createInkShape",value:function(e,t){this.init(t),this.applyToShape(e)}},{key:"applyToShape",value:function(e){e&&e.setInkData(this)}},{key:"pointsToString",value:function(e){for(var t="",n=0;n<e.length;n++){var i=e[n],o=i.px,a=i.py;if(0===n)t=parseInt(635*o)+" "+parseInt(635*a);else{var r=e[n-1],s=o-r.px,l=a-r.py;t+=","+parseInt(635*s)+" "+parseInt(635*l)}}return t}},{key:"stringToPoints",value:function(e){for(var t=[],n=e.split(","),i=0,o=0,a=0;a<n.length;++a)i+=parseFloat(n[a].split(" ")[0]),o+=parseFloat(n[a].split(" ")[1]),t.push({px:i,py:o});return t}},{key:"setBrush",value:function(e,t){if(this.inkData){var n=this.inkData.brushMap||{};n[e]=c(t),this.inkData.brushMap=n}}},{key:"defaultBrush",value:function(){if(!this._defaultBrash){var e=h.h.brushDefaultWidth4Ellipse/12700/72;this._defaultBrash={tip:h.g.ellipse,rasterOp:h.f.CopyPen,widthUnit:h.i.in,heightUnit:h.i.in,fitToCurve:!1,antiAliased:!0,ignorePressure:!1,width:e,height:2*e,color:{toRGB:"#FF0000",type:0,isAutoColor:!1,sRgb:parseInt("#FF0000".slice(-6),16)}}}return this._defaultBrash}},{key:"setTraceBrush",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.inkData){null!=n&&this.setBrush(t,n);var i=this.inkData.vecTrace||[];e>=0&&e<i.length&&(i[e].brushRef=t),this.inkData.vecTrace=i}}},{key:"_genTimestamp",value:function(e){var t=e.length;if(0==t)return 100*Date.now();var n=e[t-1].timestamp;if(null==n)return 100*Date.now();var i=Math.floor(n/100),o=Date.now();return i===o?100*o+n%100+1:100*o}},{key:"appendTrace",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.inkData){null!=n&&this.setBrush(t,n);var i=this.inkData.vecTrace||[],o=void 0,a=void 0;"string"==typeof e?(o=e,a=this.stringToPoints(o)):(o=this.pointsToString(e),a=e);var r=this._genTimestamp(i),s={brushRef:t,strPoints:o,vecPoints:a,timestamp:r};i.push(s),this.inkData.vecTrace=i}}},{key:"appendPoint",value:function(e,t){var n=e,i=t;if(this.inkData){this.updateRect(n,i);var o=this.inkData.brushMap||{},a=this.inkData.vecTrace||[],r=Object.keys(o),s=null,l=null,u=[],c=a.length;if(c>0){var h=a[c-1],d=h.vecPoints;if(d.length<100&&d.length>0){var p=d[d.length-1],f=n-p.px,g=i-p.py;return h.strPoints+=","+f+" "+g,d.push({px:n,py:i}),void(h.timestamp=this._genTimestamp(a))}if(s=h.brushRef,d.length>0){var v=d[d.length-1];u.push({px:v.px,py:v.py})}u.push({px:n,py:i})}else s=0==r.length?"br0":r[0],0==r.length&&(l=this.defaultBrush()),u.push({px:n,py:i});this.appendTrace(u,s,l)}}},{key:"mapPoint2Local",value:function(e){for(var t=0;t<e.vecPoints.length;++t){var n=e.vecPoints[t];n.px=Object(d.Px2Ti)(n.px-this.leftTop.x),n.py=Object(d.Px2Ti)(n.py-this.leftTop.y)}}},{key:"getCommandData",value:function(){if(this.inkData){for(var e=c(this.inkData),t=[],n={brushMap:{},vecTrace:t,context:e.context},i=e.vecTrace||[],o=0;o<i.length;o++){var a=i[o];if(0===t.length)t.push(Object.assign({},a));else{var r=t[t.length-1];r.brushRef===a.brushRef?r.vecPoints=r.vecPoints.concat(a.vecPoints):t.push(Object.assign({},a))}}for(var s=[],l=0;l<t.length;l++){var u=t[l];s.push(u.brushRef),this.mapPoint2Local(u),u.strPoints=this.pointsToString(u.vecPoints),delete u.vecPoints}for(var h=e.brushMap||{},d=Object.keys(h),p=0;p<d.length;p++){var f=d[p];s.indexOf(f)>=0&&(n.brushMap[f]=c(h[f]))}return n}}},{key:"setFromCommandData",value:function(e){this.inkData=c(e);for(var t=this.inkData.vecTrace,n=[],i=0;i<t.length;i++){var o=this._genTimestamp(n);t[i].vecPoints=this.stringToPoints(t[i].strPoints),t[i].timestamp=o,n.push(t[i])}this.inkData.vecTrace=n}},{key:"getBrush",value:function(e){if(this.inkData)return(this.inkData.brushMap||{})[e]}},{key:"setBrushProperty",value:function(e,t,n){var i=this.getBrush(e);switch(t){case"width":this.setLineWidth(i,n);break;case"height":this.setLineWidth(i,n/2);break;default:i[t]=n}}},{key:"setAllBrushProperty",value:function(e,t){for(var n=this.inkData.brushMap||{},i=Object.keys(n),o=0;o<i.length;o++){var a=i[o];this.setBrushProperty(a,e,t)}}},{key:"setLineWidth",value:function(e,t){e.widthUnit=h.i.in,e.width=Object(d.Px2Pt)(t)/72,e.heightUnit=h.i.in,e.height=2*e.width}},{key:"getBoundRect",value:function(){var e=this.rightBottom.x-this.leftTop.x>0?this.rightBottom.x-this.leftTop.x:1,t=this.rightBottom.y-this.leftTop.y>0?this.rightBottom.y-this.leftTop.y:1;return{x:Object(d.Px2Ti)(this.leftTop.x),y:Object(d.Px2Ti)(this.leftTop.y),width:Object(d.Px2Ti)(e),height:Object(d.Px2Ti)(t),horizontalFlipped:!1,verticalFlipped:!1,rotation:0}}},{key:"getFirstPoint",value:function(){var e=this.inkData.vecTrace;return e.length<=0?{px:0,py:0}:e[0].vecPoints[0]}}]),e}()},7161:function(e,t,n){"use strict";var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(13),l=n.n(s),u=n(1),c=n.n(u),h=n(2),d=n.n(h),p=n(4103),f=n(410),g=n(336),v=n(3319),m=n(1032),_=n(309),y=n(400),b=n(411),T=n(310),C=n(2292),k=n(4107),w=n(7208),S=n(4108),P=n(167);var I=function(){function e(t,n){c()(this,e),this._shapeData=t,this.parent=n,this.id=t.private.shapeId,this.shape_tree_type=null==t.private.shapeTreeType?-1:t.private.shapeTreeType,this.viewPage=n.viewPage}return d()(e,[{key:"isView",value:function(){return!1}},{key:"isScene",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"isCoorSystem",value:function(){return!0}},{key:"getShapeDataBoxRect",value:function(){var e=this.drawingLayout,t=e&&e.geometry2D&&e.geometry2D.geometry&&e.geometry2D.geometry.textBoxRect;if(t){var n=t.x/635,i=t.y/635,o=t.width/635,a=t.height/635,r=this.transform2D;if(Math.abs(o-Object(k.a)(r.width))<1&&Math.abs(a-Object(k.a)(r.height))<1)return null;if(0===o||0===a)return null;var s=new v.a({left:n,top:i,right:n+o,bottom:i+a}),l=this.visualTransform2D;return l.horizontalFlipped&&s.addOffset(Object(k.a)(l.width)-s.right-s.left,0),l.verticalFlipped&&s.addOffset(0,Object(k.a)(l.height)-s.bottom-s.top),s}}},{key:"getShapeIndex",value:function(e){return this.childShapes.findIndex((function(t){return t.id===e}))}},{key:"startFetchingImg",value:function(){var e=void 0;if(this.isGroup)this.childShapes.forEach((function(e){e.startFetchingImg()}));else if(this.isPresetDrawing){p.a.getInstance().initImageEndOnce()}else{var t=p.a.getInstance(),n=this.shape_tree_type,i=this.id;if(n<0)return;var o=t.shapeMap.getSha1(n,i),a=this.isRealPicture;e=!a,o&&!t.isShapeUpdated(i)||t.startShapeFetching([{shapeTreeType:n,shapeId:i,origin:a}])}if(!e&&(!this.isGroup||this.isTopShape)){var r=p.a.getInstance(),s=this.shape_tree_type,l=this.id;if(s<0)return;r.shapeMap.getSha1(s,l)&&!r.isShapeUpdated(l)||r.startShapeFetching([{shapeTreeType:s,shapeId:l,origin:!1}])}}},{key:"_createTextbox",value:function(){if(this.shapeData)if(this.isGroup)this._createChildTextbox();else{var e=this.shapeData.private;if(e.hasTextbox&&!e.hasArtWord){this.textbox_page=new m.d({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem},{subdoc_type:_.Textbox,compose:this.viewPage.compose,textpage:null}),this.textbox_page.textflow=C.a.fromOrientation(e.textOrientation);var t=e.padding;this.left_padding=Object(g.Ti2Px)(t.leftPadding),this.right_padding=Object(g.Ti2Px)(t.rightPadding),this.top_padding=Object(g.Ti2Px)(t.topPadding),this.bottom_padding=Object(g.Ti2Px)(t.bottomPadding),this.hostPendings=[],this.has_textbox=!0,this.shapeDataBoxRect=this.getShapeDataBoxRect(),this.textbox_page.rect=this.getTextBoxRect()}}}},{key:"getTextBoxRect",value:function(){var e=this.autoFitTextRect||this.shapeDataBoxRect,t=(e?e.left:0)+this.left_padding,n=(e?e.top:0)+this.top_padding,i=this.rect&&this.rect.size||this.size,o=(e?e.width:i.width)-(this.left_padding+this.right_padding),a=(e?e.height:i.height)-(this.top_padding+this.bottom_padding),r=y.a.initByOriginAndSize({x:t,y:n},{width:o,height:a});if(!this.shapeData.private.isRotateText){var s=this.visualRotation;(s>=45&&s<135||s>=225&&s<315)&&(r.updateBySize(a,o),r.updateByOrigin(t+o/2-a/2,n+a/2-o/2))}return r}},{key:"_createChildTextbox",value:function(){this.childShapes.forEach((function(e){e._createTextbox()}))}},{key:"selectLayersByPack",value:function(e){return this.layers}},{key:"createLayersByPack",value:function(e,t){return this.layers||(this.layers=t.makeLayers({parent:this,viewPage:this.viewPage,coorSystem:b.DOCCoorSystemType.Canvas}),this.viewPage.layers.addChild(this.layers)),this.layers}},{key:"autoFitByContent",value:function(e,t){var n=this,i=!1,o=this.textbox_page.getTextRect(),a=this.textbox_page.textflow,r=!1,s=this.visualRotation;this.shapeData.private.isRotateText||(s>=45&&s<135||s>=225&&s<315)&&(r=!0);var u=this.shapeDataBoxRect,c=t||this.backupTextRect;if(c){var h=function(e){n.rect.right+=e,n.visible_rect&&(n.visible_rect.right+=e),n.boundaryRect&&(n.boundaryRect.right+=e)},d=function(e){n.rect.bottom+=e,n.visible_rect&&(n.visible_rect.bottom+=e),n.boundaryRect&&(n.boundaryRect.bottom+=e)};if("L2R"===a.corX){this.textbox_page.rect.updateByHeight(o.height);var p=o.height-c.height;this.isAutoSize&&(r?h(p):d(p));var f=o.width-c.width;this.isWrapText||(r?d(f):h(f),this.textbox_page.rect.updateByWidth(o.width),this.textbox_page.lines.forEach((function(e){e.rect.updateByWidth(o.width)}))),i=p&&this.isAutoSize||f&&!this.isWrapText}else{this.textbox_page.rect.updateByWidth(o.height);var v=o.height-c.height;this.isAutoSize&&(r?d(v):h(v));var m=o.width-c.width;this.isWrapText||(r?h(m):d(m),this.textbox_page.rect.updateByHeight(o.width),this.textbox_page.lines.forEach((function(e){e.rect.updateByWidth(o.width)}))),i=v&&this.isAutoSize||m&&!this.isWrapText}if(i){var _=this.parent&&this.parent.drawingLayout,y=l()({},this.shapeData.private);if(y.transform2D=l()({},y.transform2D),this.isChildShape){var b=this.parent.shapeData.private.childExtents,T=_.layoutRect;y.transform2D.width=Math.round((r?this.rect.height:this.rect.width)*b.width/T.width),y.transform2D.height=Math.round((r?this.rect.width:this.rect.height)*b.height/T.height)}else y.transform2D.width=Object(k.c)(this.rect.width),y.transform2D.height=Object(k.c)(this.rect.height);var C=window.APP.drawingTools.createShape(y);this.isChildShape&&(C.parent=this.parent.shapeData),this.shapeDataForAutoFit=C,this._drawingLayout=window.APP.drawingTools.layout({shapeData:C,isLocalShape:!0,scale:Object(g.Ti2Px)(1),parentLayout:_}),this.autoFitTextRect=this.getShapeDataBoxRect()}}else{var w=this.rect&&this.rect.size||this.size,S=this.originWidth=w.width,P=this.originHeight=w.height,I=function(e){var t=e;u&&S!==u.width&&(t=t+S-u.width),n.isEmbedShape?(n.size.width=t,n.rect&&(n.rect.right=n.rect.left+t)):n.boundaryRect.right=n.rect.right=n.visible_rect.right=n.rect.left+t},E=function(e){var t=e;u&&P!==u.height&&(t=t+P-u.height),n.isEmbedShape?(n.size.height=t,n.rect&&(n.rect.bottom=n.rect.top+t)):n.boundaryRect.bottom=n.rect.bottom=n.visible_rect.bottom=n.rect.top+t};if("L2R"===a.corX?(this.textbox_page.rect.updateByHeight(o.height),this.isAutoSize&&(r?I(this.left_padding+this.right_padding+o.height):E(this.top_padding+this.bottom_padding+o.height)),this.isWrapText||(this.textbox_page.rect.updateByWidth(o.width),this.textbox_page.lines.forEach((function(e){e.rect.updateByWidth(o.width)})),r?E(o.width+this.top_padding+this.bottom_padding):I(o.width+this.left_padding+this.right_padding))):(this.textbox_page.rect.updateByWidth(o.height),this.isAutoSize&&(r?E(this.top_padding+this.bottom_padding+o.height):I(o.height+this.left_padding+this.right_padding)),this.isWrapText||(this.textbox_page.rect.updateByHeight(o.width),this.textbox_page.lines.forEach((function(e){e.rect.updateByWidth(o.width)})),r?I(this.left_padding+this.right_padding+o.width):E(this.top_padding+this.bottom_padding+o.width))),(this.isAutoSize||!this.isWrapText)&&window.APP.drawingTools){var O=this.parent&&this.parent.drawingLayout,x=l()({},this.shapeData.private);if(x.transform2D=l()({},x.transform2D),this.isChildShape){var R=this.parent.shapeData.private.childExtents,N=O.layoutRect;x.transform2D.width=Math.round((r?this.rect.height:this.rect.width)*R.width/N.width),x.transform2D.height=Math.round((r?this.rect.width:this.rect.height)*R.height/N.height)}else{var A=this.rect?this.rect.size:this.size;x.transform2D.width=Object(k.c)(A.width),x.transform2D.height=Object(k.c)(A.height)}var D=window.APP.drawingTools.createShape(x);this.isChildShape&&(D.parent=this.parent.shapeData),this.shapeDataForAutoFit=D,this._drawingLayout=window.APP.drawingTools.layout({shapeData:D,isLocalShape:!0,scale:Object(g.Ti2Px)(1),parentLayout:O}),this.autoFitTextRect=this.getShapeDataBoxRect(),this.isEmbedShape||(r&&this.isAutoSize!==!this.isWrapText?this.needAlignToOriginCenter=!0:(s>=45&&s<135||s>=225&&s<315)&&(this.needAdjustForRotate90=!0))}i=!1}return this.backupTextRect=this.textbox_page.getTextRect(),function(e,t){var n=t.textflow,i=t.rect,o=e.getTextBoxRect(),a=0,r=0,s=e.shapeData.private.isVml?1:e.shapeData.private.vertAnchor;if("L2R"===n.corX){var l=void 0;switch(s){case 3:l=Math.max((o.height-i.height)/2,0)+o.top;break;case 4:l=Math.max(o.height-i.height,0)+o.top;break;default:l=o.top}r=l-i.top,a=o.left-i.left,i.offset(a,r)}else if("T2B"!==n.corX||n.isReverseLine){var u=void 0;switch(s){case 3:u=Math.max((o.width-i.width)/2,0)+o.left;break;case 4:u=Math.max(o.width-i.width,0)+o.left;break;default:u=o.left}a=u-i.left,r=o.top-i.top,i.offset(a,r),n.isReverseLine?t.coororigin_pos2parent={x:i.right,y:i.top}:t.coororigin_pos2parent={x:i.left,y:i.bottom}}else{var c=void 0;switch(s){case 3:c=o.right-Math.max((o.width-i.width)/2,0);break;case 4:c=o.right-Math.max(o.width-i.width,0);break;default:c=o.right}a=c-i.width-i.left,r=o.top-i.top,i.offset(a,r),t.coororigin_pos2parent={x:i.right,y:i.top}}if(0!==a||0!==r){var h=e.layers;h&&h.embedShapes&&h.embedShapes.length&&h.embedShapes.forEach((function(e){e.viewRect&&e.viewRect.offset(a,r)}))}if(t.renderInfo&&t.renderInfo.clipRect){var d=t.renderInfo.clipRect;i.left===d.left&&i.top===d.top&&i.width===d.width&&i.height===d.height||(t.renderInfo.clipRectChange=!0,t.renderInfo.moved=!0)}}(this,this.textbox_page),i}},{key:"cleanRenderInfo",value:function(){if(this.textbox_page){this.textbox_page.cleanRenderInfo();var e=this.getTextboxLayers();e&&e.cleanRenderInfo()}this.isGroup&&this.childShapes.forEach((function(e){e.cleanRenderInfo()})),delete this.renderInfo}},{key:"getTextboxLayers",value:function(){var e=this,t=this.viewPage.layers,n=void 0;return t.childLayers&&function t(i){i.some((function(i){return i.parent===e?(n=i,!0):i.childLayers&&t(i.childLayers)}))}(t.childLayers),n}},{key:"hasEnterTextbox",value:function(){var e=window.APP.data.selection.selContext,t=e.shapeIdxPathOfTextbox,n=e.shapeTreeTypeOfTextbox;return this.shape_tree_type===n&&Object(S.b)(t,this.shapeIdxPath)}},{key:"shapeData",get:function(){return this._shapeData||this.anchor.shapeDataObj}},{key:"isWebshape",get:function(){return this.shapeData&&this.shapeData.private.webExtension&&"webshape"===this.shapeData.private.webExtension.normalProperty.private.key&&!P.isMacOs&&!P.isIos}},{key:"webshapeUrl",get:function(){return this.shapeData&&this.isWebshape&&this.shapeData.private.webExtension.normalProperty.private.url}},{key:"webshapeDisplayText",get:function(){return this.shapeData&&this.isWebshape&&"hyperlinkText"===this.shapeData.private.webExtension.diyProperties.private[0].private.key&&this.shapeData.private.webExtension.diyProperties.private[0].private.value}},{key:"webshapeAutoSnapshot",get:function(){return this.shapeData&&this.isWebshape&&this.shapeData.private.webExtension.autoSnapshot}},{key:"flags",get:function(){return this.shapeData.private.flags}},{key:"isPresetDrawing",get:function(){return!!this.shapeData&&(!!this.isGroup||Object(w.a)(this.shapeData))}},{key:"drawingLayout",get:function(){if(!this._drawingLayout&&window.APP.drawingTools)if(this.isCanvasShape&&this.isTopShape){var e=this.rect?this.rect.size:this.size,t=e.width,n=e.height;this._drawingLayout={layoutRect:{x:0,y:0,width:t,height:n}}}else if(this.isCanvasLayers)this._drawingLayout=l()({},this.parent.drawingLayout);else if(this.isTopShape&&this.sizeFromAnchor){var i=this.shapeData,o=i.getTransform2D()||{height:0,horizontalFlipped:!1,rotation:0,verticalFlipped:!1,width:0,x:0,y:0};(Math.abs(Object(k.a)(o.width)-this.sizeFromAnchor.width)>1||Math.abs(Object(k.a)(o.height)-this.sizeFromAnchor.height)>1)&&(i.orgPrivate=i.private,i.private=l()({},i.private),i.private.transform2D=l()({},o),i.private.transform2D.width=Object(k.c)(this.sizeFromAnchor.width),i.private.transform2D.height=Object(k.c)(this.sizeFromAnchor.height),this.needAdjustChildTransform=!0),this._drawingLayout=window.APP.drawingTools.layout({shapeData:i,isLocalShape:!0,scale:Object(g.Ti2Px)(1)})}else{var a=this.parent&&!this.parent.isCanvasShape&&!this.parent.isCanvasLayers&&this.parent.drawingLayout,r=this.shapeData,s=r.getTransform2D()||{height:0,horizontalFlipped:!1,rotation:0,verticalFlipped:!1,width:0,x:0,y:0};if(0===s.width&&0===s.height){r.orgPrivate=r.private,r.private=l()({},r.private),r.private.transform2D=l()({},s);var u=this.rect;u||(u=this.topShape.rect),u||(u=r.private.anchor&&r.private.anchor.private&&r.private.anchor.private.width&&r.private.anchor.private.height?{width:Object(g.Ti2Px)(r.private.anchor.private.width),height:Object(g.Ti2Px)(r.private.anchor.private.height)}:{width:0,height:0}),r.private.transform2D.width=Object(k.c)(u.width),r.private.transform2D.height=Object(k.c)(u.height),this.needAdjustChildTransform=!0}this._drawingLayout=window.APP.drawingTools.layout({shapeData:r,isLocalShape:!0,scale:Object(g.Ti2Px)(1),parentLayout:a})}return this._drawingLayout}},{key:"adjustHandles",get:function(){var e=this.drawingLayout;return e&&e.geometry2D&&e.geometry2D.geometry&&e.geometry2D.geometry.adjustHandles}},{key:"shapeProperty",get:function(){var e=this.drawingLayout;return e&&e.shapeProperty}},{key:"isCanvasShape",get:function(){return this.shapeData&&this.shapeData.isCanvasShape}},{key:"isCanvasLayers",get:function(){return this.shapeData&&this.shapeData.isCanvasLayers}},{key:"isCanvasInnerShape",get:function(){if(this.isChildShape)for(var e=this.parent;e;){if(e.isCanvasShape)return!0;e=e.parent}return!1}},{key:"isGroup",get:function(){return this.shapeData&&(this.shapeData.private.group||this.shapeData.isCanvasShape||this.shapeData.isCanvasLayers)}},{key:"childShapes",get:function(){var e=this,t=this.shapeData;return!this._childShapes&&t&&(this._childShapes=[],t.getChilds().forEach((function(t){e._childShapes.push(new E(t,e))}))),this._childShapes}},{key:"transform2D",get:function(){var e=this.shapeData;return e&&e.getTransform2D&&e.getTransform2D()}},{key:"visualTransform2D",get:function(){if(this.isTopShape)return this.transform2D;var e=this.shapeData;return e&&e._visual&&e._visual.getRealTransform2D()}},{key:"visualRotation",get:function(){var e=this.visualTransform2D;return e&&e.rotation||0}},{key:"rotation",get:function(){var e=this.transform2D;return e&&e.rotation||0}},{key:"horizontalFlipped",get:function(){var e=this.transform2D;return e&&e.horizontalFlipped||!1}},{key:"verticalFlipped",get:function(){var e=this.transform2D;return e&&e.verticalFlipped||!1}},{key:"isRotateText",get:function(){var e=this.shapeData;return e&&e.private&&e.private.isRotateText}},{key:"isAutoSize",get:function(){var e=this.shapeData;return e&&e.private&&e.private.isAutoSize}},{key:"isWrapText",get:function(){var e=this.shapeData;return e&&e.private&&e.private.isWrapText}},{key:"isRealPicture",get:function(){return Object(w.b)(this.shapeData)}},{key:"topShape",get:function(){for(var e=this;e&&!e.isTopShape;)e=e.parent;return e}},{key:"shapeIdxPath",get:function(){for(var e=[],t=this;t&&!t.isTopShape;){var n=t.parent;e.push(n.childShapes.indexOf(t)),t=n}return e.push(window.APP.data.doc.layer.getShapeTree(this.shape_tree_type).childs.getShapeIndex(t.id)),e.reverse()}},{key:"coreShapeInfo",get:function(){return window.APP.data.typoinfo.getTypoShapeInfo(this)}},{key:"dataVersion",get:function(){var e=this.coreShapeInfo;return e?e.dataVersion:-1}},{key:"allowRotate",get:function(){if(this.isCanvasShape)return!1;var e=this.shapeData?this.shapeData.private:{},t=e.isChart,n=e.isSmartArt,i=e.isOle,o=e.flags;if(t||n||i)return!1;if(this.isGroup){var a=!0;return this.childShapes.some((function(e){if(!e.allowRotate)return a=!1,!0})),a}return!o||!o.isControlShape&&!o.isHorizontalLine}}]),e}(),E=function(e){function t(e,n){c()(this,t);var i=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=void 0,r=void 0,s=void 0,l=void 0;if(i.isCanvasLayers){a=0,r=0;var u=n.rect?n.rect.size:n.size;s=u.width,l=u.height}else{var h=i.drawingLayout.layoutRect;a=h.x,r=h.y,s=h.width,l=h.height}return i.rect=new v.a({left:a,top:r,right:a+s,bottom:r+l}),i.visible_rect=new v.a(i.rect),i.boundaryRect=new v.a(i.rect),i}return r()(t,e),d()(t,[{key:"isContain",value:function(e){return this.anchor&&this.anchor.body?T.IT.containTest(this.anchor.body,e):T.IT.strictContainTest(this,e)}},{key:"isChildShape",get:function(){return!0}},{key:"outer",get:function(){for(var e=this.parent;e&&!e.isTopShape;)e=e.parent;return e&&e.outer}},{key:"size",get:function(){return this.rect.size}},{key:"viewRect",get:function(){var e=this.topShape,t=e.viewRect,n=this.drawingLayout.layoutRect,i=void 0,o=void 0;if(0!==e.rotation||e.verticalFlipped||e.horizontalFlipped){var a=new window.QMatrix;a.translate((t.left+t.right)/2,(t.top+t.bottom)/2),a.rotate(e.rotation),a.scale(e.horizontalFlipped?-1:1,e.verticalFlipped?-1:1),a.translate(-t.width/2,-t.height/2);var r=a.map_point(new window.Point(n.x+n.width/2,n.y+n.height/2));i=r.x()-n.width/2,o=r.y()-n.height/2}else i=t.left+n.x,o=t.top+n.y;return new v.a({left:i,top:o,right:i+n.width,bottom:o+n.height})}},{key:"rect2TopShape",get:function(){var e=this.topShape,t=e.drawingLayout.layoutRect,n=this.drawingLayout.layoutRect,i=void 0,o=void 0;if(0!==e.rotation||e.verticalFlipped||e.horizontalFlipped){var a=new window.QMatrix;a.translate(t.width/2,t.height/2),a.rotate(e.rotation),a.scale(e.horizontalFlipped?-1:1,e.verticalFlipped?-1:1),a.translate(-t.width/2,-t.height/2);var r=a.map_point(new window.Point(n.x+n.width/2,n.y+n.height/2));i=r.x()-n.width/2,o=r.y()-n.height/2}else i=n.x,o=n.y;return new v.a({left:i,top:o,right:i+n.width,bottom:o+n.height})}},{key:"layoutRect",set:function(e){this._layoutRect=e},get:function(){return this._layoutRect||this.rect}},{key:"layoutViewRect",get:function(){var e=this.topShape.rect,t=new v.a(this.layoutRect);return t.addOffset(e.left,e.top),t}},{key:"layoutType",get:function(){return b.DOCLayoutType.ShapeScene}},{key:"range",get:function(){return this.topShape}},{key:"view",get:function(){return this.viewPage.view}},{key:"innerBoundary",get:function(){if(this.isPresetDrawing){var e=this.drawingLayout,t=e.layoutRect,n=e.exactRect,i=n.width,o=n.height;return y.a.initByOriginAndSize({x:n.x-t.x,y:n.y-t.y},{width:i,height:o})}var a=this.coreShapeInfo;if(a){var r=a.visualInnerBounding,s=r.left,l=r.top,u=r.right,c=r.bottom;return y.a.initByOriginAndSize({x:Object(g.Ti2Px)(s),y:Object(g.Ti2Px)(l)},{width:Object(g.Ti2Px)(u-s),height:Object(g.Ti2Px)(c-l)})}return null}}]),t}(I),O=function(){function e(){c()(this,e)}return d()(e,null,[{key:"mixin_bind_method_list",value:function(){return[{baseName:"DOCShapeBase",base:I,methodName:"startFetchingImg"}]}}]),d()(e,[{key:"startFetchingImg",value:function(){window.APP.drawingTools?this.mixin_DOCShapeBase_startFetchingImg():window.APP.initDrawing([{pos:this.pos,len:1}],this)}},{key:"_initChildTextboxs",value:function(e){var t=this,n=this.childShapes;if(n&&n.length){n.forEach((function(n){!function n(i){if(i.isGroup)i.childShapes.forEach((function(e){n(e)}));else{var o=i.id,a=e.find((function(e){return e.id===o}));if(a){i.textbox_page=new m.d({parent:i,viewPage:t.viewPage,coorSystem:t.viewPage.coorSystem},{subdoc_type:_.Textbox,compose:t.viewPage.compose,textpage:a.textboxPage});var r=i.shapeData&&i.shapeData.private.padding||{leftPadding:0,rightPadding:0,topPadding:0,bottomPadding:0},s=r.leftPadding,l=r.rightPadding,u=r.topPadding,c=r.bottomPadding;i.left_padding=Object(g.Ti2Px)(s),i.right_padding=Object(g.Ti2Px)(l),i.top_padding=Object(g.Ti2Px)(u),i.bottom_padding=Object(g.Ti2Px)(c),i.has_textbox=!0}}}(n)}))}}},{key:"updateInnerBoundary",value:function(){if(this.shapeData)if(this.isGroup){var e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;if(function o(a){a.childShapes.forEach((function(a){if(a.isGroup)if(a.isCanvasShape){var r=a.rect2TopShape;e=Math.min(e,r.left),t=Math.max(t,r.right),n=Math.min(n,r.top),i=Math.max(i,r.bottom)}else o(a);else{var s=a.rect2TopShape,l=a.innerBoundary;if(l){var u=s.left+l.left,c=s.top+l.top;e=Math.min(e,u),t=Math.max(t,u+l.width),n=Math.min(n,c),i=Math.max(i,c+l.height)}else e=Math.min(e,s.left),t=Math.max(t,s.right),n=Math.min(n,s.top),i=Math.max(i,s.bottom)}}))}(this),this.isCanvasShape){e=Math.min(0,e),n=Math.min(0,n);var o=this.rect?this.rect.size:this.size;t=Math.max(o.width,t),i=Math.max(o.height,i)}this.innerBoundary=y.a.initByOriginAndSize({x:e,y:n},{width:t-e,height:i-n})}else if(this.isPresetDrawing){var a=this.drawingLayout.exactRect,r=a.x,s=a.y,l=a.width,u=a.height;this.innerBoundary=y.a.initByOriginAndSize({x:r,y:s},{width:l,height:u})}else{var c=this.coreShapeInfo;if(c){var h=c.visualInnerBounding,d=h.left,p=h.top,f=h.right,v=h.bottom;this.innerBoundary=y.a.initByOriginAndSize({x:Object(g.Ti2Px)(d),y:Object(g.Ti2Px)(p)},{width:Object(g.Ti2Px)(f-d),height:Object(g.Ti2Px)(v-p)})}}}},{key:"isTopShape",get:function(){return!0}}]),e}();t.a=O;f.a.mix(O,I)},7201:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"i",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"k",(function(){return h})),n.d(t,"h",(function(){return d})),n.d(t,"j",(function(){return p}));var i=0,o=32769,a=32770,r=32771,s=32772,l=32773,u=0,c=-4,h=-8,d=-12,p=-16},7202:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(3856),d=n(1591),p=function(e){function t(e){var n=e.parent,i=e.viewPage,a=e.coorSystem;return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:a}))}return c()(t,e),r()(t,[{key:"rollBack",value:function(e,t){this.resetLen(this.typoRange.len-e),t.locate(this.getPartRange().pos+this.len)}},{key:"type",get:function(){return d.b.Text}}]),t}(h.a);t.a=p},7203:function(e,t,n){"use strict";var i=n(8),o=n.n(i),a=n(1),r=n.n(a),s=n(2),l=n.n(s),u=n(22),c=n.n(u),h=n(23),d=n.n(h),p=n(3856),f=n(1591),g=n(626),v=function(e){function t(e){var n=e.parent,i=e.viewPage,o=e.coorSystem;r()(this,t);var a=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:n,viewPage:i,coorSystem:o}));return a.bracketWidth=0,a}return d()(t,e),l()(t,[{key:"canDoCompress",value:function(){return!1}},{key:"splitGlyphGroup",value:function(){var e=this.getGlyphPool().getGlyphGroupSet();e.trySplit(this.firstLine.range.end),this.secondLine&&e.trySplit(this.secondLine.range.end)}},{key:"getHeightInfo",value:function(){var e=0,t=0,n=0;return e+=this.firstLine?this.firstLine.rect.height:0,e+=this.secondLine?this.secondLine.rect.height:0,this.isCenterVertAlign?t=n=.5*e:n=e-(t=3*e/4),{baseHeight:e,maxCharHeight:e,maxAscent:t,maxDescent:n,maxStrongAscent:t,maxStrongDescent:n}}},{key:"getGlyphGroupsForCompose",value:function(){var e=this.getComposeLineRange();return this.getGlyphPool().getGlyphGroups(e.begin,e.end)}},{key:"composeProcess",value:function(e,t){this.updateLinesRange(),this.setComposeLineGlyphGroupInfos(),this.updateLinesHoriPos(),this.getOtherLine()?(this.updateLinesVertPos(),this.composeLines(e,t),this.insertOtherLineGlyphGroupInfos(),this.firstLine.papx=this.secondLine.papx=this.parent.papx):this.adjustComposeLineVert()}},{key:"getComposeLine",value:function(){return this.secondLine?this.firstLine.textWidth>=this.secondLine.textWidth?this.firstLine:this.secondLine:this.firstLine}},{key:"getOtherLine",value:function(){return this.getComposeLine()!==this.firstLine?this.firstLine:this.secondLine}},{key:"adjustComposeLineVert",value:function(){}},{key:"updateLinesVertPos",value:function(){var e=this.getComposeLine(),t=this.parent.baseline,n=this.parent.rect.top,i=t+this._getFirstLineVertOff()-this.firstLine.baseline,o=this.firstLine.rect.height;this.firstLine.rect.top=n+i,this.firstLine.rect.bottom=this.firstLine.rect.top+o,this.firstLine===e&&this.firstLine.glyphGroupInfos.forEach((function(e){e.y+=i}));var a=t+this._getSecondLineVertOff()-this.secondLine.baseline,r=this.secondLine.rect.height;this.secondLine.rect.top=n+a,this.secondLine.rect.bottom=this.secondLine.rect.top+r,this.secondLine===e&&this.secondLine.glyphGroupInfos.forEach((function(e){e.y+=a}))}},{key:"_getFirstLineVertOff",value:function(){return-.75*this.secondLine.rect.height}},{key:"_getSecondLineVertOff",value:function(){return.2*this.firstLine.rect.height}},{key:"setComposeLineGlyphGroupInfos",value:function(){var e=this,t=this.parent,n=this.getComposeLine(),i=t.glyphGroupInfos.filter((function(t){return t.zone===e}));n.glyphGroupInfos=i;var o={ascent:0,descent:0,height:0};n.glyphGroupInfos.metrics=o,i.forEach((function(e){o.ascent=Math.max(o.ascent,e.metrics.ascent),o.descent=Math.max(o.descent,e.metrics.descent),o.height=Math.max(o.height,e.metrics.height)}))}},{key:"composeLines",value:function(e,t){var n=this.parent.compose,i=this.getComposeLine(),o=i.glyphGroupInfos,a=function(e,t){e.forEach((function(e){e.beginOffset+=t,e.endOffset+=t}))};a(o,this.parent.range.pos-i.range.pos),n.linestyle.process(i,o),n.colorblock.process(i,o),a(o,i.range.pos-this.parent.range.pos);var r=this.getOtherLine(),s=g.a.add(r.position2parent,r.offset4child);r.isUpdateRequired=!0,n.process(r,e,s)}},{key:"updateLinesHoriPos",value:function(){var e=this.parent,t=this.getComposeLine(),n=t.glyphGroupInfos,i=0,o=e.rect.right;if(n.forEach((function(e){i+=e.widthSum,o=Math.min(o,e.x)})),t.rect.left=o,t.rect.right=o+i,this.secondLine){var a=t.range.end-1,r=this.getGlyphBuff().getMi(a),s=n[n.length-1],l=s.widths[s.widths.length-1]||0,u=i-l+r.width,c=this.getOtherLine();c.rect.left=o,c.rect.right=o+u}}},{key:"insertOtherLineGlyphGroupInfos",value:function(){var e,t=this,n=this.parent.glyphGroupInfos,i=this.getOtherLine(),a=void 0,r=this;i===this.firstLine?a=n.findIndex((function(e){return e.zone===r})):(n.forEach((function(e,t){e.zone===r&&(a=t)})),++a);var s=i.glyphGroupInfos.filter((function(){return!0})),l=i.range.pos-this.parent.range.pos;s.forEach((function(e){e.beginOffset+=l,e.endOffset+=l,e.zone=t})),(e=this.parent.glyphGroupInfos).splice.apply(e,[a,0].concat(o()(s)));var u=this.getComposeLine(),c=s[s.length-1];c.widthSum+=u.rect.width-i.rect.width,c.widths[c.widths.length-1]+=u.rect.width-i.rect.width}},{key:"updateLinesRange",value:function(){var e=this.getPartRange().pos,t=e+this.firstLine.range.len;this.firstLine.range.reset(e,t),this.secondLine&&this.secondLine.range.reset(t,t+this.secondLine.range.len)}},{key:"getFirstLineRange",value:function(){return this.updateLinesRange(),{begin:this.firstLine.range.begin,end:this.firstLine.range.end}}},{key:"getSecondLineRange",value:function(){return this.updateLinesRange(),{begin:this.secondLine.range.begin,end:this.secondLine.range.end}}},{key:"getComposeLineRange",value:function(){this.updateLinesRange();var e=this.getComposeLine();return{begin:e.range.begin,end:e.range.end}}},{key:"render",value:function(e,t,n,i,o,a){if(this.renderLeftBracket(n),this.renderRightBracket(n),!this.renderWithOutLine(e)){var r=function(e,t){e.forEach((function(e){e.beginOffset+=t,e.endOffset+=t}))};this.updateLinesRange(),r(this.firstLine.glyphGroupInfos,e.range.pos-this.firstLine.range.pos),r(this.secondLine.glyphGroupInfos,e.range.pos-this.secondLine.range.pos),n.render(this.firstLine,i,t,o,a),n.render(this.secondLine,i,t,o,a),r(this.firstLine.glyphGroupInfos,this.firstLine.range.pos-e.range.pos),r(this.secondLine.glyphGroupInfos,this.secondLine.range.pos-e.range.pos)}}},{key:"renderWithOutLine",value:function(e){return!this.secondLine||e===this.firstLine||e===this.secondLine}},{key:"getFirstLineBottom",value:function(){return this.parent.rect.top+this.parent.baseline+this._getFirstLineVertOff()+this.firstLine.glyphGroupInfos.metrics.descent}},{key:"getDrawBaseline",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.secondLine)return e;var i=this.parent.range.begin;return i+t.beginOffset>=this.getSecondLineRange().begin?this.secondLine.baseline+(n?this.secondLine.rect.top:0):this.firstLine.baseline+(n?this.firstLine.rect.top:0)}},{key:"getLineDrawTop",value:function(e,t){return this.secondLine?this.parent.range.begin+e.beginOffset>=this.getSecondLineRange().begin?(this.firstLine.rect.bottom+this.secondLine.rect.top)/2:void 0!==t?t:this.firstLine.rect.top:t}},{key:"getLineDrawBottom",value:function(e,t){return this.secondLine?this.parent.range.begin+e.beginOffset>=this.getSecondLineRange().begin?void 0!==t?t:this.secondLine.rect.bottom:(this.firstLine.rect.bottom+this.secondLine.rect.top)/2:t}},{key:"getLineDrawHeight",value:function(e){var t=this.getLineDrawBottom(e),n=this.getLineDrawTop(e);return Math.max(0,t-n)}},{key:"getLeftTypoWidth",value:function(){return this.leftBracket?this.bracketWidth:0}},{key:"getRightTypoWidth",value:function(){return this.rightBracket?this.bracketWidth:0}},{key:"needAddLeftTypoWidth",value:function(e){if(!this.leftBracket)return!1;this.updateLinesRange();var t=this.parent.range.begin;return e.beginOffset===this.firstLine.range.begin-t||this.secondLine&&e.beginOffset===this.secondLine.range.begin-t}},{key:"needAddRightTypoWidth",value:function(e){if(!this.rightBracket)return!1;this.updateLinesRange();var t=this.parent.range.begin;return e.endOffset===this.firstLine.range.end-t||this.secondLine&&e.endOffset===this.secondLine.range.end-t}},{key:"renderLeftBracket",value:function(e){var t=this.leftBracket;if(t){var n=e.textCtx;n.save(),n.textAlign="start",n.fontFace=this.bracketFontArg,n.fillText(t,this.firstLine.rect.left-this.bracketWidth,this.parent.rect.top+this.parent.baseline),n.restore()}}},{key:"renderRightBracket",value:function(e){var t=this.rightBracket;if(t){var n=e.textCtx;n.save(),n.textAlign="start",n.fontFace=this.bracketFontArg,n.fillText(t,this.firstLine.rect.right,this.parent.rect.top+this.parent.baseline),n.restore()}}},{key:"type",get:function(){return f.b.TwoLinesInOne}},{key:"textWidth",get:function(){return this.secondLine?Math.max(this.firstLine.textWidth,this.secondLine.textWidth):this.firstLine.textWidth}}]),t}(p.a);t.a=v},7204:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=function(){function e(){o()(this,e),this.setFixedWidth(0)}return r()(e,[{key:"setFixedWidth",value:function(e){this.lineHeaderWidth=this.lineTailWidth=this.minWidth=this.width=e}},{key:"addWidth",value:function(e){this.width+=e,this.minWidth+=e,this.lineHeaderWidth+=e,this.lineTailWidth+=e,this.width<0&&this.setFixedWidth(0)}},{key:"clone",value:function(){var t=new e,n=this;return Object.keys(n).forEach((function(e){t[e]=n[e]})),t}}]),e}();t.a=s},7205:function(e,t,n){"use strict";var i,o=n(1),a=n.n(o),r=n(2),s=n.n(r),l=n(1910),u=n(723),c=(i=void 0,function(e){return e&&(i=e),i}),h=function(){function e(){if(a()(this,e),c())return c();this.adjSpaceWidthPolicy={normal:{adjSpaceWidth:function(e,t){e.setFixedWidth(t/2)}},contentNode:{adjSpaceWidth:function(e,t){}}},this.setAdjSpaceWidthPolicyInUse("normal"),c(this)}return s()(e,[{key:"setAdjSpaceWidthPolicyInUse",value:function(e){switch(e){case"normal":this.adjSpaceWidthPolicyInUse=this.adjSpaceWidthPolicy.normal;break;case"contentNode":this.adjSpaceWidthPolicyInUse=this.adjSpaceWidthPolicy.contentNode;break;default:this.adjSpaceWidthPolicyInUse=this.adjSpaceWidthPolicy.normal}}},{key:"measureChars",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],i=arguments[2],o=arguments[3],a=arguments[4],r=arguments[5],s=arguments[6],c=n.chpx;if(!c.getPropVal("o_math")){var h=!1,d=0;if(!n.isHidden()&&!n.isRevisionHidden()){var p=s.getCharCode(a[i]);if(!t.bDiffSBMB||!u.a.isFullWidthSpace(p)){var f=s.getMi(a[i]);t.bKashida||n.isComplex()||(t.bWordWrap||h||(h=!0,d=l.a.getAdjCalcFactor(t)),t.bDiffSBMB&&(t.bAppIsFELanguage||t.bUseFELayout||t.bDefaultFEFontIsCJKFont)?!t.bWordWrap&&l.a.betweenWestWriteLetters(t,n,i,o,a,r,s)?f.minWidth=Math.min(f.minWidth,t.fontArg.fontSize/d):this.adjSpaceWidthPolicyInUse.adjSpaceWidth(f,t.fontArg.fontSize):t.bWordWrap||(f.minWidth=Math.min(f.minWidth,t.fontArg.fontSize/d))),e.adjBold(t,f)}}}}}],[{key:"adjBold",value:function(e,t){if(!e.bBoldAdjustment)return!1;var n=.00198*e.fontArg.fontSize;return t.addWidth(n),!0}},{key:"adjustSpaceWidth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3],o=arguments[4];if(!e.bDiffSBMB||!u.a.isFullWidthSpace(n))if(e.bKashida)this.adjBold(e,t);else{var a=0;e.bWordWrap||(a=l.a.getAdjCalcFactor(e)),e.bDiffSBMB&&(e.bAppIsFELanguage||e.bUseFELayout||e.bDefaultFEFontIsCJKFont)?!e.bWordWrap&&l.a.betweenWestWriteLetters2(i,o)?t.minWidth=Math.min(t.minWidth,e.fontArg.fontSize/a):t.setFixedWidth(e.fontArg.fontSize/2):e.bWordWrap||(t.minWidth=Math.min(t.minWidth,e.fontArg.fontSize/a)),this.adjBold(e,t)}}}]),e}();t.a=h},7206:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"d",(function(){return s}));var i=0,o=1,a=2,r=3,s=4},7207:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(1807),d=n(411),p=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.compose,u=n.snippetLine,c=n.pageOffsetFromServer;o()(this,t);var h=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r},{compose:s,textline:u,pageOffsetFromServer:c}));return h.card=void 0,h.page=void 0,h.isSnippetLine=!0,h}return c()(t,e),r()(t,[{key:"isHost",value:function(){return!1}},{key:"layoutType",get:function(){return d.DOCLayoutType.SnippetLine}}]),t}(h.a);t.a=p},7208:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var i=[];function o(e){var t=e.private,n=t.flags,o=t.geometry2D,a=t.isChart,r=t.isSmartArt,s=t.isVml,l=t.hasArtWord,u=t.scene3D,c=t.shape3D,h=t.effects,d=t.fill,p=t.outline,f=t.style;if(n.isOle||n.isPicture||a||r||s||l||u||c||h&&Object.keys(h).length||d&&(d.blip||d.stops||void 0!==d.pattern)||p&&p.fill&&p.fill.stops)return!1;if(f){var g=f.fillIndex,v=f.effectsIndex,m=f.lineIndex;if(g>=1e3||m>=1e3||v>=1e3)return!1;var _=window.APP.data.doc.theme.baseStyle.formatScheme,y=_.getFillAt(g);if(y&&(y.blip||y.stops||void 0!==y.pattern))return!1;var b=_.getEffectsAt(v);if(b&&Object.keys(b).length>0)return!1}return!(!o||!(o.presetType&&!i.includes(o.presetType)||o.paths))}function a(e){var t=e.private,n=t.flags,i=t.isVml,o=t.picture;return!i&&(!(o&&o.blip&&o.blip.effects)&&(n.isPicture&&!n.isControlShape))}},7209:function(e,t,n){"use strict";n.d(t,"l",(function(){return i})),n.d(t,"n",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"y",(function(){return h})),n.d(t,"u",(function(){return d})),n.d(t,"r",(function(){return p})),n.d(t,"x",(function(){return f})),n.d(t,"t",(function(){return g})),n.d(t,"q",(function(){return v})),n.d(t,"w",(function(){return m})),n.d(t,"s",(function(){return _})),n.d(t,"p",(function(){return y})),n.d(t,"v",(function(){return b})),n.d(t,"o",(function(){return T})),n.d(t,"h",(function(){return C})),n.d(t,"c",(function(){return k})),n.d(t,"i",(function(){return w})),n.d(t,"j",(function(){return S})),n.d(t,"m",(function(){return P})),n.d(t,"k",(function(){return I}));var i=0,o=1,a=2,r=3,s=4,l=5,u=6,c=7,h=8,d=9,p=10,f=11,g=12,v=13,m=14,_=15,y=16,b=17,T=18,C=19,k=20,w=21,S=22,P=23,I=24},7210:function(e,t,n){"use strict";var i,o=n(30),a=n.n(o),r=n(1916);t.a=(i={},a()(i,r.l,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleNone", "None")),a()(i,r.n,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleSingle", "Line")),a()(i,r.f,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDot", "Dot")),a()(i,r.e,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDashSmallGap", "Dotted Line")),a()(i,r.d,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDashLargeGap", "Dash")),a()(i,r.a,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDashDo", "Dash Dot")),a()(i,r.b,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDashDotDot", "Dash Dot Dot")),a()(i,r.g,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDouble", "Double Thin Line")),a()(i,r.y,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleTriple", "Triple Thin Line")),a()(i,r.u,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThinThickSmallGap", "Thick Thin-1")),a()(i,r.r,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThickThinSmallGap", "Thin Thick-1")),a()(i,r.x,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThinThickThinSmallGap", "Thin Thick Thin-1")),a()(i,r.t,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThinThickMedGap", "Thick Thin-2")),a()(i,r.q,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThickThinMedGap", "Thin Thick-2")),a()(i,r.w,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThinThickThinMedGap", "Thin Thick Thin-2")),a()(i,r.s,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThinThickLargeGap", "Thick Thin-3")),a()(i,r.p,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThickThinLargeGap", "Thin Thick-3")),a()(i,r.v,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleThinThickThinLargeGap", "Thin Thick Thin-3")),a()(i,r.o,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleSingleWavy", "Wavy line")),a()(i,r.h,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDoubleWavy", "Double wavy line")),a()(i,r.c,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleDashDotStroked", "Diagonal Stripe")),a()(i,r.i,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleEmboss3D", "Top Shadow")),a()(i,r.j,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleEngrave3D", "Bottom Shadow")),a()(i,r.m,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleNone", "None")),a()(i,r.k,_i18n("applications.writer.components.core.shell.model.doc.enums.lineStyleNone", "None")),i)},7211:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(4113),f=n(1590),g=n(2503),v=n(4582),m=g.top,_=g.middle,y=g.bottom,b=function(e){function t(){return o()(this,t),l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return d()(t,e),r()(t,[{key:"init",value:function(){c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this),this.underlineColor=p.a,this.revisionInsertion=!1,this.revisionFormating=!1,this.revisionUserId="",this.revisionUser="",this.doNoMerge=!1}},{key:"getItem",value:function(){var e={underlineType:this.underlineType,underlineColor:this.underlineColor,underlineWidth:this.underlineWidth,revisionInsertion:this.revisionInsertion,revisionFormating:this.revisionFormating,revisionUserId:this.revisionUserId,revisionUser:this.revisionUser,revisionColor:this.revisionColor,isRevisionActive:this.isRevisionActive};return this.doNoMerge&&(e.doNoMerge=!0),Object.assign(e,c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getItem",this).call(this))}}]),t}(p.b),T=function(e){function t(){o()(this,t);var e=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.preInfo={underlineColor:p.a,underlineType:1,underlineWidth:1,scriptPos:0,revisionInsertion:!1,revisionFormating:!1,revisionUserId:""},e}return d()(t,e),r()(t,[{key:"initItem",value:function(){this.item=new b}},{key:"getItems",value:function(e){var n=c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getItems",this).call(this);return this.clipUnderline(e,n),this.mergeUnderline(n)}},{key:"clipUnderline",value:function(e,t){for(var n=e.glyphGroupInfos[0],i=e.inEqZone?e.rect.left+n.x:e.rect.left,o=e.inEqZone?e.rect.right+n.x:e.rect.right,a=0,r=t.length;a<r;){var s=t[a];s.startX>o||s.endX<i?(t.splice(a,1),--r):(s.startX=Math.max(i,s.startX),s.endX=Math.min(o,s.endX),++a)}}},{key:"mergeUnderline",value:function(e){if(e.length){for(var t=e.sort((function(e,t){return e.startX-t.startX})),n=-1,i=void 0,o=void 0,a=void 0,r=void 0,s=t.length,l=function(e,t,n){for(var i=t;i<n;++i){var r=e[i];r.yPos=o,r.underlineWidth=a}},u=0;u<s;++u)(i=t[u]).doNoMerge?(n>=0&&l(t,n,u),n=-1):r&&i.startX>r.endX?(n>=0&&l(t,n,u),n=u,o=i.yPos,a=i.underlineWidth):n<0?(n=u,o=i.yPos,a=i.underlineWidth):(o=Math.max(o,i.yPos),a=Math.max(a,i.underlineWidth)),r=i;return n>=0&&l(t,n,s),t}return[]}},{key:"recordPreInfo",value:function(e){Object.assign(this.preInfo,{underlineColor:e.underlineColor,underlineType:e.underlineType,underlineWidth:e.underlineWidth,scriptPos:e.scriptPos,revisionInsertion:e.revisionInsertion,revisionFormating:e.revisionFormating,revisionUserId:e.revisionUserId,revisionUser:e.revisionUser})}},{key:"isType",value:function(e){return e.revisionInsertion||e.revisionFormating||1===e.underline&&e.underlineType!==f.wpsUnderlineNone}},{key:"isDifferent",value:function(e){return this.preInfo.revisionInsertion===e.revisionInsertion&&!e.revisionInsertion||this.preInfo.revisionFormating===e.revisionFormating&&!e.revisionFormating?this.preInfo.revisionInsertion!==e.revisionInsertion||this.preInfo.revisionFormating!==e.revisionFormating||this.preInfo.underlineColor!==e.underlineColor||this.preInfo.underlineType!==e.underlineType||this.preInfo.underlineWidth!==e.underlineWidth||this.preInfo.scriptPos!==e.scriptPos||this.preInfo.revisionUser!==e.revisionUser||this.preInfo.revisionUserId!==e.revisionUserId:this.preInfo.revisionInsertion!==e.revisionInsertion||this.preInfo.revisionFormating!==e.revisionFormating||this.preInfo.revisionUserId!==e.revisionUserId}},{key:"moveNext",value:function(e){c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"moveNext",this).call(this,e),this.item.underlineType=e.underlineType,this.item.underlineColor=e.underlineColor,this.item.underlineWidth=e.underlineWidth,this.item.revisionInsertion=e.revisionInsertion,this.item.revisionFormating=e.revisionFormating,this.item.revisionColor=e.revisionColor,this.item.revisionUserId=e.revisionUserId,this.item.revisionUser=e.revisionUser,e.scriptPos<0&&(this.item.doNoMerge=!0)}},{key:"calcYPos",value:function(e){var t=e.y,n=e.metrics,i=e.scriptPos,o=e.vertAlignMode;switch(o){case m:t+=n.measureAscent;break;case _:t+=n.measureAscent-(n.measureAscent+n.measureDescent)/2;break;case y:t-=n.measureDescent}return t+=n.measureDescent/2,Object(v.b)(i,o,n,t).scriptPosY}}]),t}(p.c);t.default=T},7212:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=184,o=25},7213:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return l}));var i=1,o=2,a=3,r=4,s=5,l=6},7214:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=283,o=283},7215:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={TABLE:"TABLE",TASK_LIST:"TASK_LIST",CONTENT_CONTROLS:"CONTENT_CONTROLS",SHAPE:"SHAPE",COOP_SEL:"COOP_SEL",WATER_DROP:"WATER_DROP"}},7216:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(676),o=function(e,t){var n=e.replace(/(\r\n)|(\r)|(\n)/g,String.fromCharCode(10)).split(String.fromCharCode(10)),i={width:0,height:0,arr:[]};return n.forEach((function(e){var n=function(e,t){var n=document.createElement("span"),i=document.createElement("div"),o=i.cloneNode(!1);o.setAttribute("style","display: inline-block; width: 1px; height: 0"),i.setAttribute("style","visibility: hidden; position: absolute; top: 0; left: 0; z-index: -999;"),i.appendChild(n),i.appendChild(o),document.body.appendChild(i);var a={},r=void 0,s=void 0;try{var l="font: "+t+"; word-break: keep-all; white-space: nowrap;";n.setAttribute("style",l),n.innerHTML="",n.appendChild(document.createTextNode(e.replace(/\s/g,String.fromCharCode(960)))),s=n.getBoundingClientRect(),o.style.verticalAlign="baseline",r=o.getBoundingClientRect(),a.ascent=r.top-s.top,o.style.verticalAlign="bottom",r=o.getBoundingClientRect(),a.height=r.top-s.top,a.descent=a.height-a.ascent,a.width=s.width}finally{i.parentNode.removeChild(i),i=null}return a}(e,t);i.width=Math.max(i.width,n.width),i.height+=n.height,i.arr.push({str:e,height:n.height,width:n.width})})),i},a=0,r=function(e){var t=e.value,n=e.fillstyle,r=void 0===n?"#000000":n,s=e.font,l=void 0===s?"":s,u=e.rotate,c=void 0===u?0:u,h=e.horizontal,d=void 0===h?0:h,p=e.vertical,f=void 0===p?0:p;if(t&&"string"==typeof t){var g=t.replaceAll(" "," "),v=f/2,m=f/2,_=d/2,y=d/2,b=o(g,l),T=b.height,C=b.width,k=T+v+m,w=C+y+_,S="http://www.w3.org/2000/svg",P="wmk-"+a++,I=Object(i.createElementNS)({namespaceURI:S,type:"pattern",id:P,attributes:{width:w,height:k,patternTransform:"rotate("+180*c/Math.PI+")",patternUnits:"userSpaceOnUse"}}),E=0;b.arr.forEach((function(e){var t=e.str,n=e.height;Object(i.createElementNS)({type:"text",namespaceURI:S,parent:I,style:{font:l,fill:r,textAnchor:"middle",dominantBaseline:"alphabetic",whiteSpace:"pre"},attributes:{x:w/2,y:E+(k-n)/2}}).appendChild(document.createTextNode(t)),E+=n}));var O=I.innerHTML;if(O&&window.btoa){var x="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent('\n                <svg xmlns="'+S+'" height="'+k+'px" width="'+w+'px">\n                 '+O+"\n                </svg>"))),R='<image x="0" y="0" width='+w+" height="+k+' preserveAspectRatio="none" xlink:href="'+x+'"></image>';I.innerHTML=R}return{patternElement:I,patternId:P}}}},7217:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryEnterAltModeOnKeyup=t.altModeKeydownHandler=void 0;var i=n(5),o=n(246),a=n(167),r=i.__importDefault(n(227)),s={isPressingAltKeyOnly:!1,canEnterAltModeOnKeyup:!1};function l(e){return["INPUT","TEXTAREA"].includes(e.tagName)||e.isContentEditable}t.altModeKeydownHandler=function(e){var t=e.key===o.Keys.Alt;s.isPressingAltKeyOnly=t,s.canEnterAltModeOnKeyup=t},t.tryEnterAltModeOnKeyup=function(e){var t;if(e.key===o.Keys.Alt){var n=s.isPressingAltKeyOnly,i=s.canEnterAltModeOnKeyup;if(n&&i&&function(e){return window.__CONFIG__.altEnable&&a.isWindows&&!window.APP.isEmbed()&&!e.isComposing&&!window.APP.data.selection.isComposing}(e)){e.preventDefault();var u=document.activeElement,c=u===(null===(t=window.APP.workspace.input)||void 0===t?void 0:t.element),h=l(u);return c?window.APP.blurInput():h&&document.activeElement.blur(),r.default.dispatchEvent(r.default.names.ENTER_ALT_MODE),window.addEventListener(r.default.names.EXIT_ALT_MODE,(function e(t){window.removeEventListener(r.default.names.EXIT_ALT_MODE,e),!1!==t.detail.focusDoc&&(l(document.activeElement)||(c?window.APP.isReadOnly()||window.APP.focusInput():h&&document.body.contains(u)&&u.focus()))})),!0}s.isPressingAltKeyOnly=!1}return!1}},723:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(324),l=n(1318),u=function(){function e(){o()(this,e)}return r()(e,null,[{key:"makeLangID",value:function(e,t){return t<<10|e}},{key:"getPrimaryLangID",value:function(e){return 1023&e}},{key:"getSubLangID",value:function(e){return e>>10}},{key:"makeLocaleID",value:function(e,t){return t<<16|e}},{key:"makeSortLocaleID",value:function(t,n,i){return e.makeLocaleID(t,n)|i<<20}},{key:"getLgidFromLcid",value:function(e){return e}},{key:"sortIDFromLcid",value:function(e){return e>>16&15}},{key:"sortVersionFromLcid",value:function(e){return e>>20&15}},{key:"getLangSystemDefault",value:function(){return e.makeLangID(0,2)}},{key:"getLangUserDefault",value:function(){return e.makeLangID(0,1)}},{key:"getLocaleSystemDefault",value:function(){return e.makeLocaleID(e.getLangSystemDefault(),0)}},{key:"getLocaleUserDefault",value:function(){return e.makeLocaleID(e.getLangUserDefault(),0)}},{key:"getLocaleNeutral",value:function(){return e.makeLocaleID(0,0)}},{key:"getLangIDSimpChinese",value:function(){return e.makeLangID(4,2)}},{key:"getLangIDUSEnglish",value:function(){return e.makeLangID(9,1)}}]),e}(),c=l.c.DOCCharTypeFastDetecter,h=function(){function e(){o()(this,e)}return r()(e,null,[{key:"isParaBreak",value:function(e){return e==s.l||e==s.m||7==e}},{key:"isPageBreak",value:function(e){return e==s.k||e==s.i||e==s.m}},{key:"isSpace",value:function(e){return c.getUnicodeCharItem(e).isPlaceHolder&&e==s.A||e==s.r||e==s.w}},{key:"isFullWidthSpace",value:function(e){return e==s.r}},{key:"isNormalSpace",value:function(e){return e==s.A}},{key:"isNonBreakSpace",value:function(e){return e==s.w}},{key:"isNoWidthSpace",value:function(e){return e==s.v}},{key:"isSimpleLineBreak",value:function(e){return e==s.j||e==s.l}},{key:"isLineBreak",value:function(e){return e==s.l||e==s.k||e==s.j||e==s.m||e==s.i||e==s.h}},{key:"isControl",value:function(e){return e==s.d||e==s.e}},{key:"isTab",value:function(e){return e==s.B}},{key:"isTextSymbol",value:function(e){return e==s.C}},{key:"isComment",value:function(e){return e==s.a}},{key:"isFootnote",value:function(e){return e==s.q}},{key:"isDrawing",value:function(e){return e==s.f}},{key:"isEmbedDrawing",value:function(e){return e==s.g}},{key:"isControlBegin",value:function(e){return e==s.d}},{key:"isControlEnd",value:function(e){return e==s.e}},{key:"isFieldBeginEnd",value:function(e){return e==s.n||e==s.p}},{key:"isAlpha",value:function(e){return e>="a".codePointAt()&&e<="z".codePointAt()||e>="A".codePointAt()&&e<="Z".codePointAt()}},{key:"isLowerAlpha",value:function(e){return e>="a".codePointAt()&&e<="z".codePointAt()}},{key:"isUpperAlpha",value:function(e){return e>="A".codePointAt()&&e<="Z".codePointAt()}},{key:"isGeorgianMkhedruli",value:function(e){return e>=4304&&e<=4351}},{key:"isNum",value:function(e){return e>="0".codePointAt()&&e<="9".codePointAt()}},{key:"isSpecialAlpha",value:function(e){return 1046==e}},{key:"isRealAsia",value:function(e){return c.getUnicodeCharItem(e).isRealAsia}},{key:"isComplex",value:function(e){return c.getUnicodeCharItem(e).isComplex}},{key:"isPunc",value:function(e){return c.getUnicodeCharItem(e).isPunc||this.isJPNSpecPunc(e)}},{key:"isPureHeadPunc",value:function(e){return"$([{£¥‘“〈《「『【〔〖〝﹙﹛﹝＄（［｛￡￥".indexOf(String.fromCharCode(e))>-1}},{key:"isHeadPunc",value:function(e){return"$([{£¥·‘“〈《「『【〔〖〝﹙﹛﹝＄（．［｛￡￥".indexOf(String.fromCharCode(e))>-1}},{key:"isTailPunc",value:function(t){return t==s.w||"!%),.:;>?]}¢¨°·ˇˉ―‖’”…‰′″›℃∶、。〃々〉》」』】〕〗〞︶︺︾﹀﹄﹚﹜﹞！＂％＇），．：；？］｀｜｝～￠".indexOf(String.fromCharCode(t))>-1||e.isJPNSpecPunc(t)}},{key:"isGenkohangPunc",value:function(t){return e.isTailPunc(t)}},{key:"isHangPunc",value:function(e,t,n,i){if(n)return this.isGenkohangPunc(e);switch(u.getPrimaryLangID(t)){case 17:return",.!),:;?]}、，。".indexOf(String.fromCharCode(e))>-1;case 18:return",.!),:;?]}，".indexOf(String.fromCharCode(e))>-1;case 4:return i?",.!),:;?]}".indexOf(String.fromCharCode(e))>-1:"!),.:;?]}￠ˇ’”∶、。〉》」』】〕〗！＂＇），．·：；".indexOf(String.fromCharCode(e))>-1;default:return this.isDefaultHangPunc(e,i)}}},{key:"isDefaultHangPunc",value:function(e,t){return t?",.!),:;?]}".indexOf(String.fromCharCode(e))>-1:"!),.:;?]}￠ˇ’”∶＂".indexOf(String.fromCharCode(e))>-1}},{key:"isHeadCompressPunc",value:function(e){return c.getUnicodeCharItem(e).isPunc&&"‘“〈《「『【〔〖（［｛".indexOf(String.fromCharCode(e))>-1}},{key:"isTailCompressPunc",value:function(e){return c.getUnicodeCharItem(e).isPunc&&"·’”∶、。〃〉》」』】〕〗！｝］＇），．：；".indexOf(String.fromCharCode(e))>-1}},{key:"isCompressPunc",value:function(t){return e.isTailCompressPunc(t)||e.isHeadCompressPunc(t)}},{key:"isJPNSpecPunc",value:function(e){return 12539==e}},{key:"isMathFunction",value:function(e){return e==s.t}},{key:"isMathArgEnd",value:function(e){return e==s.s}},{key:"isFieldSep",value:function(e){return e==s.p}},{key:"toUpperAlpha",value:function(e){return e.toUpperCase()}},{key:"toLowerAlpha",value:function(e){return e.toLowerCase()}},{key:"isFieldLinkPlaceholder",value:function(e){return"📄"==e}},{key:"dealReplaceSpecChar",value:function(e){var t=e;switch(t.charCodeAt(0)){case 30:t=String.fromCharCode(45);break;case 160:case 8194:t=String.fromCharCode(176)}return t}}]),e}();t.a=h},733:function(e,t,n){"use strict";n.r(t),n.d(t,"rangeMap",(function(){return o}));var i=window.CommandBarComponent.cmbIds.et,o={cell:{value:"cell",text:_i18n("applications.public.constants.historyTypes.cell", "Recent changes to the cell"),cmbId:i.RightMenuHistory},d1:{value:"d1",msg:_i18n("applications.public.constants.historyTypes.msg1", "No changes today"),text:_i18n("applications.public.constants.historyTypes.today", "Changes of Today"),cmbId:i.RightMenuHistoryToady},d3:{value:"d3",msg:_i18n("applications.public.constants.historyTypes.msg2", "No changes in the last 3 days"),text:_i18n("applications.public.constants.historyTypes.threeDay", "Changes in 3 Days"),cmbId:i.RightMenuHistoryThreeDay},d7:{value:"d7",msg:_i18n("applications.public.constants.historyTypes.msg3", "No changes in the last 7 days"),text:_i18n("applications.public.constants.historyTypes.sevenDay", "Changes in 7 Days"),cmbId:i.RightMenuHistorySevenDay}};t.default={INVALID:0,MODIFY:1,ROLL_BACK:2,USER_JOIN:3,OFFLINE_UPDATE:4,INSERT_OBJECT:5}},742:function(e,t,n){var i=n(637),o=n(967),a=n(968),r=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":r&&r in Object(e)?o(e):a(e)}},7528:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(145),c=n.n(u),h=n(23),d=n.n(h),p=n(411),f=n(400),g=n(626),v=n(3863),m=n(5717),_=n(310),y=function(){function e(){o()(this,e)}return r()(e,null,[{key:"makeEmbedShapeMap",value:function(e){var t=e.naked_embed_shapes,n=e.viewPage,i={},o=n.view,a=o.data.doc,r=a.inlineAnchors,s=a.anchors;t.forEach((function(e){var t=e.id,l=e.shapeTreeType,u=e.subDocType,c=r.getAnchor(t,a.getSubDocOffset(u),a.getSubDocSize(u))||s.getAnchor(t,a.getSubDocOffset(u),a.getSubDocSize(u)),h=c&&c.pos>=0&&c.anchor;if(h){var d=new m.a({range:{begin:h.begin,end:h.end},anchor:h,subDocType:u,shapeTreeType:l,viewPage:n,line:null,raw_embed_shape:e});i[t]=d,d.startFetchingImg(),o.embedShapeRanges.attachNode(d)}}));var l=function(e){var t=i[e],a=t.anchor,r=o.collectTextLines({begin:a.begin,end:a.end}).find((function(e){return _.IT.containTest(e.range,a)&&e.viewPage===n}));if(!r)return console.log("Can not find the line!"),"continue";if(t.outer=r,a.shapeData.hasTextbox&&!a.shapeData.hasArtWord){var s=g.a.add(r.position2parent,r.offset4child),l=r.baseline-t.size.height;s.y+=l,t.generateRect(s,{x:0,y:l},r)}};for(var u in i)l(u);return i}}]),e}(),b=n(3860),T=n(6113),C=n(309),k=n(5745),w=function(e){function t(e,n,i){var a=i.layoutPage;o()(this,t);var r=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:e,coorSystem:p.DOCCoorSystemType.Canvas}));return r.compose=n,r.versionNo=void 0,r.isVisible=!0,r.layers=new b.a({parent:r,viewPage:r,coorSystem:p.DOCCoorSystemType.Canvas}),r.pagePendings=[],r.hostPendings=[],r.pageRange={},r.embed_shape_map={},a&&r._initFromRawData(a),r.isUpdate=!0,r}return d()(t,e),r()(t,[{key:"isCoorSystem",value:function(){return!0}},{key:"isView",value:function(){return!1}},{key:"isScene",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"isHit",value:function(e){return f.a.pointInRect(e,this.inner_rect)}},{key:"selectLayersByPack",value:function(e){return this.layers}},{key:"_initFromRawData",value:function(e){var t=this;this.versionNo=e.versionNo,this.isVisible=void 0===e.isVisible||e.isVisible,this.isSecFirstPage=void 0!==e.isSecFirstPage&&e.isSecFirstPage,this.pageNum=void 0===e.pageNum?0:e.pageNum,this.sectionIndex=void 0===e.sectionIndex?0:e.sectionIndex,null!=e.pageIndex&&(this.layout_index=e.pageIndex),null!=e.innerRect&&(this.inner_rect=f.a.initByDocRect(e.innerRect)),null!=e.outerRect&&(this.outer_rect=f.a.initByDocRect(e.outerRect)),this.serverOffset=e.mainTextPagesOffset||0,this.section=this.view.data.doc.sections.getSection(e.pos);var n={footnote:{offsets:e.footnotesOffset,index:0},endnote:{offsets:e.endnotesOffset,index:0}};null!=e.mainPages&&(this.mainpages=e.mainPages.map((function(e){var i=t._createTextPage(e,t.compose,t.serverOffset,null,null,n);return i.section=t.section,i}))),this._initDecorativePage(e),this._initShapes(e),this._initEmbedShapes(e),this.view.data.doc.useCoreMeasure?this.glyphGroupInfoForEmbed&&(this.compose.linkEmbed(this.glyphGroupInfoForEmbed),delete this.glyphGroupInfoForEmbed):this.view.composeProcessLayout(this)}},{key:"_createTextPage",value:function(e,t,n,i,o,a){return e?new v.a({parent:i||this,viewPage:o||this,coorSystem:this.coorSystem},{compose:t,mainpage:e,pageOffsetFromServer:n,notesInfo:a}):null}},{key:"_createHFTextPage",value:function(e,t,n,i,o){return e?new k.a({parent:i||this,viewPage:o||this,coorSystem:this.coorSystem},{compose:t,textpage:e,pageOffsetFromServer:n}):null}},{key:"_initEmbedShapes",value:function(e){if(null!=e.typoEmbedDrawingInfos){var t=e.typoEmbedDrawingInfos.filter((function(e){var t=parseInt(e.subDocType);return t!==C.HeaderFooter&&t!==C.TextboxInHF}));t.length>0&&(this.embed_shape_map=y.makeEmbedShapeMap({naked_embed_shapes:t,viewPage:this}))}}},{key:"_initShapes",value:function(e){if(null!=e.typoDrawingInfos){var t=[];e.typoDrawingInfos.forEach((function(e){parseInt(e.subDocType)!==C.HeaderFooter&&t.push(e)}));var n=0;do{n=t.length,t=Object(T.a)(t,g.a.ZERO(),this.compose,this,this,this.layers,this.parent)}while(t.length&&t.length!==n)}}},{key:"_initDecorativePage",value:function(e){var n=new t(this.view,this.view.compose,{});if(n.isDecorativePage=!0,n.section=this.section,n.sectionIndex=this.sectionIndex,n.isSecFirstPage=this.isSecFirstPage,n.pageNum=this.pageNum,n.outer_rect=this.outer_rect,n.contentPage=this,this.decorativePage=n,null!=e.header&&(n.header=this._createHFTextPage(e.header,this.compose,e.headerOffset,n,n),n.header.footer_type="header"),null!=e.footer&&(n.footer=this._createHFTextPage(e.footer,this.compose,e.footerOffset,n,n),n.footer.footer_type="footer"),n.serverOffset=n.headerOffset||n.footerOffset||0,null!=e.typoDrawingInfos){var i=[];e.typoDrawingInfos.forEach((function(e){parseInt(e.subDocType)===C.HeaderFooter&&i.push(e)})),Object(T.a)(i,g.a.ZERO(),n.compose,n,n,n.layers,n.parent)}if(null!=e.typoEmbedDrawingInfos){var o=e.typoEmbedDrawingInfos.filter((function(e){var t=parseInt(e.subDocType);return t===C.HeaderFooter||t===C.TextboxInHF}));o.length>0&&(n.embed_shape_map=y.makeEmbedShapeMap({naked_embed_shapes:o,viewPage:n}))}n.layout_index=this.layout_index,n.glyphGroupInfoForEmbed&&(this.compose.linkEmbed(n.glyphGroupInfoForEmbed),delete n.glyphGroupInfoForEmbed),n.header&&(this.header=n.header),n.footer&&(this.footer=n.footer)}},{key:"term",value:function(){this.header&&this.header.term(),this.footer&&this.footer.term(),this.mainpages.forEach((function(e){e.term()}))}},{key:"findSelMainPageInfos",value:function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=[],a=this.mainpages.length,r=0;r<a;++r){var s=n?this.mainpages[a-1-r]:this.mainpages[r];if(!(s.lines.length<=0)&&!(s.range.pos+s.range.len<=e)){if(s.range.pos>=t)break;var l={mainPage:s},u=s.findSelLineInfos(e,t,i);if(l.lineInfos=u,l.textPage=s,u.length<=0)return[];n?o.splice(0,0,l):o.push(l)}}return o}},{key:"getTextFrameInMainPage",value:function(){var e=[],t=this.getTextFrameInHeaderFooter();return(this.layers?this.layers.getTextframeCards():[]).forEach((function(n){var i=!1;t.forEach((function(e){n!==e||(i=!0)})),i||e.push(n)})),e}},{key:"getTextFrameInHeaderFooter",value:function(){var e=[],t=this.header&&this.header.range,n=this.footer&&this.footer.range,i=this.layers?this.layers.getTextframeCards():[];return i&&i.forEach((function(i){var o=i.snippetPack.range;(t&&o.pos>=t.pos&&o.pos<t.pos+t.len||n&&o.pos>=n.pos&&o.pos<n.pos+n.len)&&e.push(i)})),e}},{key:"getTextboxInMainPage",value:function(){var e=[],t=this.view.data.doc,n=this.layers.getTextboxCards();for(var i in n.length>0&&n.forEach((function(n){t.getSubDocType(n.anchor.pos)==C.MainText&&e.push(n)})),this.embed_shape_map){var o=this.embed_shape_map[i];if(o.has_textbox)t.getSubDocType(o.anchor.pos)==C.MainText&&e.push(o)}return e}},{key:"getTextboxInHeaderFooter",value:function(){var e=[],t=this.view.data.doc,n=this.layers.getTextboxCards();for(var i in n.length>0&&n.forEach((function(n){t.getSubDocType(n.anchor.pos)==C.HeaderFooter&&e.push(n)})),this.embed_shape_map){var o=this.embed_shape_map[i];if(o.has_textbox)t.getSubDocType(o.anchor.pos)==C.HeaderFooter&&e.push(o)}return e}},{key:"getTextboxs",value:function(){var e=[],t=this.layers.getTextboxCards();for(var n in t.length>0&&t.forEach((function(t){e.push(t)})),this.embed_shape_map){var i=this.embed_shape_map[n];i.has_textbox&&e.push(i)}return e}},{key:"empty",value:function(){return!(this.mainpages.length>0&&this.mainpages[0].lines.length>0)&&!(this.footnotes&&this.footnotes.length>0||this.endnotes&&this.endnotes.length>0)}},{key:"removeEmbedShape",value:function(e){console.error("嵌入式对象移动至layers里管理")}},{key:"getMainRange",value:function(){if(!this.mainpages||this.mainpages.length<=0)return null;if(this.parent.isPageOverMainRange(this.layout_index))return null;var e=this.mainpages[0].range,t=this.mainpages[this.mainpages.length-1].range;return e&&t?{pos:e.pos,len:t.pos+t.len-e.pos}:null}},{key:"cleanRenderInfo",value:function(){var e=this;c()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this),this.header&&this.header.cleanRenderInfo(),this.footer&&this.footer.cleanRenderInfo(),this.decorativePage&&this.decorativePage.cleanRenderInfo(),this.mainpages&&this.mainpages.forEach((function(e){e.cleanRenderInfo()})),this.embed_shape_map&&Object.keys(this.embed_shape_map).forEach((function(t){var n=e.embed_shape_map[t];n&&n.cleanRenderInfo()})),this.layers.cleanRenderInfo()}},{key:"position2parent",get:function(){return g.a.ZERO()}},{key:"offset4child",get:function(){return g.a.ZERO()}},{key:"layoutType",get:function(){return p.DOCLayoutType.LayoutPage}},{key:"view",get:function(){return this.parent}},{key:"range",get:function(){var e=this.mainpages&&this.mainpages.length;if(e&&this.mainpages[0].range){var t=this.mainpages[0].range.pos,n=this.mainpages[e-1].range;return{pos:t,len:n.pos+n.len-t}}return null}},{key:"visible",get:function(){return this.isVisible}},{key:"viewOffset",get:function(){return{x:this.outer_rect.left,y:this.outer_rect.top}}},{key:"next",get:function(){var e=0;for(e=0;e<this.view.pageCount&&this!==this.view.getLayoutPageCache(e);++e);var t=this.view.layout_pages;if(e===t.length-1)return null;var n=e+1;if(n>t.length-1)return null;var i=this.view.getLayoutPageCache(n);return i.isMoc?null:i}},{key:"hasRenderCorner",get:function(){return this.renderInfo&&this.renderInfo.hasRenderCorner},set:function(e){this.renderInfo||(this.renderInfo={}),this.renderInfo.hasRenderCorner=e}}]),t}(p.DOCLayout);t.a=w},7534:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(626),d=n(411),p=n(1291),f=n(4973),g=n(2293),v=String.fromCharCode(61548),m=String.fromCharCode(61550),_=String.fromCharCode(61557),y=String.fromCharCode(61558),b=String.fromCharCode(61656),T=String.fromCharCode(61692),C=String.fromCharCode(61618),k=n(6111),w=n(1734),S=n(336),P=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=e.gcp,u=n.compose,c=n.autoNum;o()(this,t);var h=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r}));return h.compose=u,h.gcp=s,c&&h._initFromRawData(c),h}return c()(t,e),r()(t,[{key:"isCoorSystem",value:function(){return!1}},{key:"_initFromRawData",value:function(e){null!=e.line&&(this.line=new p.b({parent:this.parent,viewPage:this.viewPage,coorSystem:this.coorSystem},{compose:this.compose,textline:e.line})),null!=e.jcOffset&&(this.jcOffset=Object(S.Ti2Px)(parseInt(e.jcOffset))),null!=e.size&&(this.size=Object(S.Ti2Px)(parseInt(e.size))),null!=e.text&&(this.text=e.text)}},{key:"getSizeOfAutoNumLine",value:function(){return this.line.rect.size}},{key:"getTaskOrBulletListInfo",value:function(){switch(this.text.charAt(0)){case f.b:return{isTaskList:!0,index:g.b};case f.a:return{isTaskList:!0,index:g.a};case m:return{isBullet:!0,index:k.f};case v:return{isBullet:!0,index:k.b};case _:return{isBullet:!0,index:k.e};case y:return{isBullet:!0,index:k.g};case b:return{isBullet:!0,index:k.d};case T:return{isBullet:!0,index:k.a};case C:return{isBullet:!0,index:k.c};default:return{isTaskList:!1,isBullet:!1}}}},{key:"position2parent",get:function(){return h.a.ZERO()}},{key:"offset4child",get:function(){return h.a.initWithOrigin({x:this.jcOffset,y:0})}},{key:"offset",get:function(){return this.jcOffset+this.line.rect.width}},{key:"ascent",get:function(){return this.line.baseline}},{key:"height",get:function(){return this.line.rect.bottom-this.line.rect.top}},{key:"descent",get:function(){return this.height-this.ascent}},{key:"isBullet",get:function(){return void 0===this._isBullet&&(this._isBullet=window.APP.data.selection.selInfo.getListType([{pos:this.gcp,len:1}])===w.a),this._isBullet},set:function(e){this._isBullet=e}}]),t}(d.DOCLayout);t.a=P},760:function(e,t,n){"use strict";n.r(t),n.d(t,"filterText",(function(){return o})),n.d(t,"filterTab",(function(){return a}));var i=n(324),o=function(e,t,n){var o="",a=[];if(e)for(var r=0;r<e.length;++r)e.charCodeAt(r)===i.n?a.push(!0):e.charCodeAt(r)===i.p?a[a.length-1]=!1:e.charCodeAt(r)===i.o?a.pop():0!==a.length&&(1!==a.length||a[0])||t&&t(e.charCodeAt(r))||(o+=n?n(e[r]):e[r]);return o},a=function(e){return e.replace(/\t/g," ")}},772:function(e,t,n){"use strict";n.d(t,"e",(function(){return w})),n.d(t,"a",(function(){return S})),n.d(t,"b",(function(){return P})),n.d(t,"d",(function(){return I})),n.d(t,"c",(function(){return E}));var i=n(22),o=n.n(i),a=n(145),r=n.n(a),s=n(23),l=n.n(s),u=n(1),c=n.n(u),h=n(2),d=n.n(h),p=n(1032),f=n(400),g=n(626),v=n(411),m=n(908),_=n(1915),y=n(4579),b=n(2292),T=n(3860),C=n(6113),k=n(336),w={NONE:0,FIRST:1,MIDDLE:2,LAST:3},S={TOP:0,Center:2,Bottom:3},P={HEAD:0,TAIL:1,MIDDLE:2},I=function(){function e(){c()(this,e)}return d()(e,null,[{key:"generateTableCells",value:function(e,t){var n=e.parent,i=e.viewPage,o=e.coorSystem,a=t.tablecells,r=t.compose,s=t.height,l=t.pageOffsetFromServer,u=[],c=a.length;return a.forEach((function(e,t){var a=P.MIDDLE;0===t&&(a=P.HEAD),c-1===t&&(a=P.TAIL);var h=new E({parent:n,viewPage:i,coorSystem:o},{index:t,cell_sum:c,pos_type:a,tablecell:e,height:s,compose:r,pageOffsetFromServer:l});u.push(h)})),u}}]),e}(),E=function(e){function t(e,n){var i=e.parent,a=e.viewPage,r=e.coorSystem,s=n.index,l=n.cell_sum,u=n.pos_type,h=n.tablecell,d=n.height,p=n.compose,f=n.pageOffsetFromServer;c()(this,t);var g=o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:i,viewPage:a,coorSystem:r}));return g.compose=p,g.pos_type=u,g.height=d,g.index=s,g.line_cell_sum=l,g.isHostAtMobile=window.APP.isMobileMode()||window.APP.isWebMode(),h&&g._initFromRawData(h,f),g}return l()(t,e),d()(t,[{key:"isCoorSystem",value:function(){return!1}},{key:"_initFromRawData",value:function(e,t){this.is_diag_cell=e.isDiagCell,this.is_diag_cell&&(this.diagCell=this._initFromRowDiagCell(e.diagonal,t)),this.merge_type=e.mergedType||w.NONE,this.width=Object(k.Ti2Px)(parseInt(e.width));var n=Object(k.Ti2Px)(parseInt(e.x));this.rect=f.a.initByRawRect({left:n,top:0,right:n+this.width,bottom:0+this.height});var i=new b.a(e.cellPage&&e.cellPage.textFlow||"0"),o=Object(k.Ti2Px)(parseInt(e.pageOffset));"T2B"===i.corX?this.cell2page_offset=g.a.initWithOrigin({y:0,x:i.isReverseLine?o:-o}):"B2T"===i.corX?this.cell2page_offset=g.a.initWithOrigin({y:0,x:o}):this.cell2page_offset=g.a.initWithOrigin({x:0,y:o});var a=_.a.findView(this),r=m.a.transvertPositionFromNode2Target(this,a);if(null!=e.cellPage&&(this.cell_page=new p.a({parent:this,viewPage:this.viewPage,coorSystem:this.coorSystem},{compose:this.compose,cellpage:e.cellPage,pageOffsetFromServer:t})),null!=e.typoDrawingInfos&&e.typoDrawingInfos.length>0){var s=this.layers=new T.a({parent:this,viewPage:this.viewPage});this.viewPage.layers.addChild(s),Object(C.a)(e.typoDrawingInfos,r,this.compose,this,this.viewPage,s,this.viewPage.parent)}}},{key:"_initFromRowDiagCell",value:function(e,t){var n=this,i=[];return e.pages&&(i=e.pages.map((function(e){return new p.a({parent:n,viewPage:n.viewPage,coorSystem:n.coorSystem},{compose:n.compose,cellpage:e,pageOffsetFromServer:t})}))),{pages:i,diags:e.diags}}},{key:"cleanRenderInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.cell_page&&this.cell_page.cleanRenderInfo(),this.layers&&(this.layers.topCards&&this.layers.topCards.forEach((function(e){e.isWrap&&e.cleanRenderInfo()})),this.layers.cleanRenderInfo(e)),this.diagCell&&this.diagCell.pages.forEach((function(e){e.cleanRenderInfo()})),r()(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cleanRenderInfo",this).call(this)}},{key:"position2parent",get:function(){return this.rect.origin}},{key:"offset4child",get:function(){return this.cell2page_offset}},{key:"layoutType",get:function(){return v.DOCLayoutType.Cell}},{key:"isInTable",get:function(){return!0}},{key:"position_in_line",get:function(){var e=this,t=this.line_cell_sum;if(1===t)return y.b;var n=this.index;switch(this.isHostAtMobile&&(n=this.parent.tablecells.findIndex((function(t){return t===e}))),n){case 0:return y.a;case t-1:return y.d;default:return y.c}}},{key:"viewOffset",get:function(){var e=this.parent.parent.viewOffset;return{x:e.x+this.rect.left,y:e.y+this.rect.top}}},{key:"range",get:function(){var e=void 0;if(this.diagCell){e=this.diagCell.pages[0].range.pos;var t=this.diagCell.pages[this.diagCell.pages.length-1].range;return{pos:e,len:t.pos+t.len-e}}return this.cell_page?this.cell_page.range:null}}]),t}(v.DOCLayout)},7730:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importDefault(n(7154)),a=i.__importDefault(n(6096)),r=n(5735),s=n(1805),l=n(3478),u=new(function(){function e(){this.retryCountMap=new Map,this.retryInterval=[2e3,8e3,3e4,6e4]}return e.prototype.getRetryTime=function(e){var t=1;return this.retryCountMap.has(e)&&(t=this.retryCountMap.get(e)+1),t>this.retryInterval.length&&(t=1),this.retryCountMap.set(e,t),Date.now()+this.retryInterval[t-1]},e.prototype.isRetryFinish=function(e){return this.retryCountMap.get(e)===this.retryInterval.length},e.prototype.resetRetryInfo=function(e){this.retryCountMap.delete(e)},e}()),c=function(){function e(e,t){var n=this;this.SECOND=1e3,this.RETRY_INTERVAL=3*this.SECOND,this.MAX_RETRY_COUNT=10,this.shapeUrlHelper=new o.default,this.isSessionReady=!1,this.retryCount=1,this.isRetrying=!1,this.shapeRequestCache=[],this.sha1ShapeMapRequestList=new Map,this.failedRequestSet=new Set,this.retryWaitingList=[],this.shapeDataCache=new a.default,this.updateShape=function(e,t){void 0===t&&(t=!1);var i=[],o=function(){var o=window.APP.scheduler,a=o.PRIORITY,s=o.taskName.handlePictureUpdateFail,l=a.ImmediatePriority,u=s;o.scheduleCallback(l,{callback:function(){return e.forEach((function(e){var i=e.shapeTreeType;e.shapeIds.forEach((function(e){var o=n.getRequestKey(i,e,t);n.handleRequestFail(o)}))})),void(0,r.showDebugInfo)(r.MessageKey.requestShapeInfoFailed,i.join(" "))},name:u})};if(n.serverApi.isConnected()){e.forEach((function(e){var o=e.shapeTreeType;e.shapeIds.forEach((function(e){var a=n.getRequestKey(o,e,t);i.push(a)}))})),(0,r.showDebugInfo)(r.MessageKey.shapeInfoRequestList,i.join(" "));var a=[];s.privileges.font_founder_official&&a.push("font_founder_official");var l=null,u={callback:function(e){if(clearTimeout(l),!e||!e.shapeTrees||e.shapeTrees.length<1)o();else{var a=[];e.shapeTrees.forEach((function(e){var i=e.shapeTreeType;e.shapes.forEach((function(e){a.push(n.getRequestKey(i,e.shapeId,t))}))})),n.verifyUpdateShapeResult(i,a),n.handleShapeInfoReceived(e,t)}}};n.serverApi.updateShapes({origin:t,shapeTrees:e,privileges:a},(function(e){u.callback(e)})),l=setTimeout((function(){u.callback=function(){},o(),console.error("导出图片失败，超时了！")}),30*n.retryCount*1e3)}else setTimeout((function(){o()}),50)},this.startRetryPolling=function(){setTimeout((function(){var e=Date.now(),t=[];n.retryWaitingList.forEach((function(n){n.expectTime<=e&&t.push(n.requestInfo)})),n.retryWaitingList=n.retryWaitingList.filter((function(t){return t.expectTime>e})),t.length>0?(n.isRetrying=!0,n.retryCount<n.MAX_RETRY_COUNT&&n.retryCount++,n.requestUrl(t,!0)):n.isRetrying&&(n.retryCount=1,n.isRetrying=!1),n.startRetryPolling()}),n.retryCount*n.RETRY_INTERVAL)},this.serverApi=e,this.shapeManager=t,this.startRetryPolling();var i=new Promise((function(e){n.handleSessionReady=function(){n.isSessionReady=!0,e()}})),l=(0,s.getPrivileges)().catch((function(){return!1}));Promise.all([i,l]).then((function(){n.resumeUpdateShapesAfterSessionReady()})),e.isConnected()&&e.isSessionReady&&this.handleSessionReady()}return e.prototype.handleSessionReady=function(){},e.prototype.requestUrl=function(e,t){var n=this;if(this.isSessionReady){var i=[],o=[];e.forEach((function(e){var a=n.getRequestKey(e.shapeTreeType,e.shapeId,e.origin);if(!t&&n.retryWaitingList.length>0&&n.failedRequestSet.has(a))(0,r.showDebugInfo)(r.MessageKey.waitingRetryAfterFailure,a);else{var s=void 0;(s=e.origin?o.find((function(t){return t.shapeTreeType===e.shapeTreeType})):i.find((function(t){return t.shapeTreeType===e.shapeTreeType})))||(s={shapeTreeType:e.shapeTreeType,shapeIds:[]},e.origin?o.push(s):i.push(s)),s.shapeIds.includes(e.shapeId)||s.shapeIds.push(e.shapeId)}})),o.length&&this.updateShape(o,!0),i.length&&this.updateShape(i)}else this.recordShapeTreeIdsBeforeSessionReady(e)},e.prototype.handleShapeInfoReceived=function(e,t){var n=this,i=new Set,o=new Map,a=[];e.shapeTrees.forEach((function(e){var s=e.shapeTreeType;e.shapes.forEach((function(e){var l=n.getRequestKey(s,e.shapeId,t);if(e.error)(0,r.showDebugInfo)(r.MessageKey.requestShapeInfoFailed,l),n.handleRequestFail(l);else{var u=e.sha1,c=e.format,h=e.isPicture,d=e.shapeId;i.add(u),o.has(u)||o.set(u,[]),o.get(u).push({shapeTreeType:s,shape:e});var p=n.shapeManager.getShapeFromMap(s,d,!0);t?p.orgSha1=u:p.sha1=u,Object.assign(p,{format:c||"",isPicture:h}),a.push(l)}}))})),a.length&&(0,r.showDebugInfo)(r.MessageKey.shapeInfoListSuccessfullyRequested,a.join(" ")),this.getShapeUrl(i,o,t)},e.prototype.getShapeUrl=function(e,t,n){var i=this,o=new Set,a=new Set;e.forEach((function(e){i.sha1ShapeMapRequestList.has(e)?o.add(e):a.add(e)}));var s=function(e,t,o,a){var s=i.getRequestKey(e.shapeTreeType,e.shape.shapeId,n),c=i.shapeManager.getShapeFromMap(e.shapeTreeType,e.shape.shapeId,!0);Promise.all([i.preRequestShape(t),i.preRequestShape(o)]).then((function(){(0,r.showDebugInfo)(r.MessageKey.requestShapeUrlSuccessfully,s,t,o);var l=e.shapeTreeType,h=e.shape,d=h.dataVersion;(n?void 0===c.orgDataVersion||d>c.orgDataVersion:void 0===c.dataVersion||d>c.dataVersion)?(i.shapeManager.deleteDelayRenderShapeId(h.shapeId),n?Object.assign(c,{latestAvailableOrgSourceUrl:o||t,orgSourceUrl:t,orgSourceWebpUrl:o,readyOrgSha1:a,orgDataVersion:d}):Object.assign(c,{latestAvailableSourceUrl:o||t,sourceUrl:t,sourceWebpUrl:o,readySha1:a,dataVersion:d}),c.onUrlUpdate(),i.shapeManager.handleShapeUrlUpdate(l,h.shapeId)):(n?d===c.orgDataVersion:d===c.dataVersion)?c.onUrlUpdate():(void 0!==d&&c.clearPromise(n,d),console.debug("On update old data version shapeTreeType:".concat(l," shapeId:").concat(h.shapeId," dataVersion:").concat(d))),u.resetRetryInfo(s)})).catch((function(e){var t=!0;if(e&&"load failed"===e.reason){var o=(0,l.parseBase64String)(e.url);t=o.isValid&&/^image\//.test(o.mimeType),n&&(c.isOriginalSourceValid=!1)}else console.warn(e);i.sha1ShapeMapRequestList.delete(a),i.handleRequestFail(s,t)}))};a.size>0&&(a.forEach((function(e){i.sha1ShapeMapRequestList.set(e,{shapeInfos:[],url:"",webp_url:""})})),this.shapeUrlHelper.updateShapeUrl(Array.from(a)).then((function(e){if(!e||!e.urls)throw new Error("Error: get url failed!");Object.keys(e.urls).forEach((function(n){var o=e.urls[n],a=e.webp_urls[n];(i.sha1ShapeMapRequestList.get(n)||{shapeInfos:[]}).shapeInfos.concat(t.get(n)).forEach((function(e){s(e,o,a,n)}))}))})).catch((function(){a.forEach((function(e){(i.sha1ShapeMapRequestList.get(e)||{shapeInfos:[]}).shapeInfos.concat(t.get(e)).forEach((function(t){i.sha1ShapeMapRequestList.delete(e);var o=i.getRequestKey(t.shapeTreeType,t.shape.shapeId,n);i.handleRequestFail(o)}))}))})).then((function(){a.forEach((function(e){i.sha1ShapeMapRequestList.delete(e)}))}))),o.size>0&&o.forEach((function(e){var n=i.sha1ShapeMapRequestList.get(e),o=n.url,a=void 0===o?"":o,r=n.webp_url,l=void 0===r?"":r;a?(n.shapeInfos.concat(t[e]).forEach((function(t){s(t,a,l,e)})),n.shapeInfos.length=0):n.shapeInfos=n.shapeInfos.concat(t.get(e))}))},e.prototype.recordShapeTreeIdsBeforeSessionReady=function(e){var t;(t=this.shapeRequestCache).push.apply(t,e)},e.prototype.resumeUpdateShapesAfterSessionReady=function(){this.requestUrl(this.shapeRequestCache),this.shapeRequestCache.length=0},e.prototype.preRequestShape=function(e){return e?this.shapeDataCache.add(e):Promise.resolve({base64Data:"",sourceSize:0})},e.prototype.getRequestKey=function(e,t,n){return"".concat(e,"-").concat(t,"-").concat(!!n)},e.prototype.parseRequestKey=function(e){var t=e.split("-");return{shapeTreeType:parseInt(t[0]),shapeId:parseInt(t[1]),origin:"true"===t[2]}},e.prototype.handleRequestFail=function(e,t){void 0===t&&(t=!0);var n=this.parseRequestKey(e),i=this.shapeManager.getShapeFromMap(n.shapeTreeType,n.shapeId);if(!t||i&&u.isRetryFinish(e))return(0,r.showErrorInfo)(r.MessageKey.requestFinallyFailed,e),i.onRequestUrlFail(n.origin,r.MessageKey.requestFinallyFailed),void this.failedRequestSet.delete(e);this.failedRequestSet.add(e),this.retryRequestUrl(e)},e.prototype.retryRequestUrl=function(e){if(!!!this.retryWaitingList.find((function(t){return t.requestKey===e}))){var t=u.getRetryTime(e),n=new Date(t);(0,r.showDebugInfo)(r.MessageKey.requestFailedAndRetryLater,"".concat(n.getHours(),":").concat(n.getMinutes(),":").concat(n.getSeconds()),e),this.retryWaitingList.push({requestInfo:this.parseRequestKey(e),expectTime:t,requestKey:e})}},e.prototype.verifyUpdateShapeResult=function(e,t){var n=this;t.length!==e.length&&((0,r.showErrorInfo)(r.MessageKey.quantityOfShapeInfoNotMatch.replace("${0}",e.join(" ")).replace("${1}",t.join(" "))),e.forEach((function(i){if(!t.includes(i))if(e.length>1){var o=i.split("-");setTimeout((function(){var e=parseInt(o[0]),t=parseInt(o[1]),a="true"===o[2];(0,r.showDebugInfo)(r.MessageKey.retryGetShapeInfoNow,i),n.updateShape([{shapeTreeType:e,shapeIds:[t]}],a)}),30)}else n.handleRequestFail(i)})))},e}();t.default=c},7731:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5).__importDefault(n(7732)),o=function(){function e(){this.map=new Map,this.map=new Map}return e.prototype.getShapeInfo=function(e,t,n){void 0===n&&(n=!1);var o=this.map.get(e);if(!o&&n&&(o=new Map,this.map.set(e,o)),o){var a=o.get(t)||null;return!a&&n&&(a=new i.default(e,t),o.set(t,a)),a}return null},e.prototype.copy=function(e,t){var n=this.getShapeInfo(e.shapeTreeType,e.shapeId);if(!n)return!1;this.map.has(t.shapeTreeType)||this.map.set(t.shapeTreeType,new Map);var o=Object.create(i.default.prototype);return o=Object.assign(o,n,{thumbnailPromise:[],originalPicturePromise:[]}),this.map.get(t.shapeTreeType).set(t.shapeId,o),o},e.prototype.getShapeInfoBySha1=function(e){return this.traverseMap((function(t){return t.sha1===e}))[0]},e.prototype.hasOriginalPicture=function(e,t){var n=this.getShapeInfo(e,t);return!!n&&n.isOriginalPictureReady},e.prototype.getSha1=function(e,t){var n=this.getShapeInfo(e,t);return n?n.sha1:""},e.prototype.getReadySha1=function(e,t){var n=this.getShapeInfo(e,t);return n?n.readySha1:""},e.prototype.getOrgSha1=function(e,t){var n=this.getShapeInfo(e,t);return n?n.orgSha1:""},e.prototype.getReadyOrgSha1=function(e,t){var n=this.getShapeInfo(e,t);return n?n.readyOrgSha1:""},e.prototype.getFormat=function(e,t){var n=this.getShapeInfo(e,t);return n?n.format:null},e.prototype.isPicture=function(e,t){var n=this.getShapeInfo(e,t);return!n||n.isPicture},e.prototype.markShapeOutOfDate=function(e){this.traverseMap((function(t){return t.shapeId===e})).forEach((function(e){e.isOutOfDate=!0}))},e.prototype.unmarkShapeOutOfDate=function(e){this.traverseMap((function(t){return t.shapeId===e})).forEach((function(e){e.isOutOfDate=!1}))},e.prototype.traverseMap=function(e){for(var t=[],n=Array.from(this.map.values()),i=0;i<n.length;i++)for(var o=n[i],a=Array.from(o.values()),r=0;r<a.length;r++){var s=a[r];e(s)&&t.push(s)}return t},e}();t.default=o},7732:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=n(3478),a=new(i.__importDefault(n(6096)).default),r=function(){function e(e,t){this.shapeId=-1,this.shapeTreeType=-1,this.readyOrgSha1="",this.readySha1="",this.format=null,this.isPicture=!1,this.isFailed=!1,this.isOriginalSourceValid=!0,this.isWebshape=!1,this.webshapeUrl="",this.webshapeDisplayText="",this.mimeDataId="",this.sourceUrl="",this.sourceWebpUrl="",this.orgSourceUrl="",this.orgSourceWebpUrl="",this.latestAvailableSourceUrl="",this.latestAvailableOrgSourceUrl="",this.thumbnailPromise=[],this.originalPicturePromise=[],this._isOutOfDate=!0,this._orgSha1="",this._sha1="",this.base64Data="",this.orgBase64Data="",this.shapeId=t,this.shapeTreeType=e,this.initRefShapeObjId()}return Object.defineProperty(e.prototype,"sourceSize",{get:function(){return a.get(this.sourceUrl).sourceSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webpSourceSize",{get:function(){return a.get(this.sourceWebpUrl).sourceSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originalSourceSize",{get:function(){return a.get(this.orgSourceUrl).sourceSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originalWebpSourceSize",{get:function(){return a.get(this.orgSourceWebpUrl).sourceSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"latestAvailableSourceInfo",{get:function(){return a.get(this.latestAvailableSourceUrl).base64Data&&a.get(this.latestAvailableSourceUrl)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"latestAvailableOrgSourceInfo",{get:function(){return a.get(this.latestAvailableOrgSourceUrl).base64Data&&a.get(this.latestAvailableOrgSourceUrl)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOutOfDate",{get:function(){return this._isOutOfDate},set:function(e){this._isOutOfDate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sha1",{get:function(){return this._sha1},set:function(e){e!==this._sha1&&(this.sourceUrl=this.sourceWebpUrl="",this.base64Data="",this._isOutOfDate=!0,e||(this.orgSha1=""),this.format=null),this._sha1=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"orgSha1",{get:function(){return this._orgSha1},set:function(e){e!==this._orgSha1&&(this.orgSourceUrl=this.orgSourceWebpUrl="",this.orgBase64Data="",this._isOutOfDate=!0),this._orgSha1=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return a.get(this.sourceUrl).base64Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webp_url",{get:function(){return a.get(this.sourceWebpUrl).base64Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"orgUrl",{get:function(){return a.get(this.orgSourceUrl).base64Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"orgWebpUrl",{get:function(){return a.get(this.orgSourceWebpUrl).base64Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return a.get(this.sourceUrl).size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"orgSize",{get:function(){return a.get(this.orgSourceUrl).size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isThumbnailReady",{get:function(){return!(null===this.format||!this.size||!this.webp_url&&!this.url)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOriginalPictureReady",{get:function(){return!(null===this.format||!this.orgSize||!this.orgWebpUrl&&!this.orgUrl)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.shapeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shape_tree_type",{get:function(){return this.shapeTreeType},enumerable:!1,configurable:!0}),e.prototype.getUrl=function(e,t,n){var i=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=void 0),new Promise((function(o,a){e&&i.isOriginalSourceValid?!i.isOriginalPictureReady||void 0!==n&&n!==i.orgDataVersion?i.originalPicturePromise.push({resolve:o,reject:a,dataVersion:n}):o(i.orgWebpUrl||i.orgUrl):t&&i.isOriginalPictureReady&&i.isOriginalSourceValid&&(void 0===n||n===i.orgDataVersion)?o(i.orgWebpUrl||i.orgUrl):!i.isThumbnailReady||void 0!==n&&n!==i.dataVersion?i.thumbnailPromise.push({resolve:o,reject:a,dataVersion:n}):o(i.webp_url||i.url)}))},e.prototype.getBase64Data=function(e,t){var n=this;return this.getUrl(e,t).then((function(i){return(0,o.parseBase64String)(i).isValid?i:e?n.orgBase64Data?n.orgBase64Data:n.getBase64DataFromUrl(i).then((function(e){return n.orgBase64Data=e,n.orgBase64Data})):t&&n.orgBase64Data?n.orgBase64Data:n.base64Data?n.base64Data:n.getBase64DataFromUrl(i).then((function(e){return n.base64Data=e,n.base64Data}))}),(function(e){return Promise.reject(e)}))},e.prototype.onRequestUrlFail=function(e,t){void 0===t&&(t="request url fail"),this.isFailed=!0,e?(this.originalPicturePromise.forEach((function(e){e.reject(t)})),this.originalPicturePromise.length=0):(this.thumbnailPromise.forEach((function(e){e.reject(t)})),this.thumbnailPromise.length=0)},e.prototype.onUrlUpdate=function(){var e=this;this._isOutOfDate=!1;var t=function(t,n){if(n)for(var i=0;i<t.length;){void 0===(o=t[i]).dataVersion||e.orgDataVersion===o.dataVersion?(o.resolve(e.orgWebpUrl||e.orgUrl),t.splice(i,1)):++i}else for(i=0;i<t.length;){var o;void 0===(o=t[i]).dataVersion||e.dataVersion===o.dataVersion?(o.resolve(e.webp_url||e.url),t.splice(i,1)):++i}};this.isThumbnailReady&&t(this.thumbnailPromise,!1),this.isOriginalPictureReady?t(this.originalPicturePromise,!0):this.isPicture||(this.originalPicturePromise.length>0&&console.warn("非图片对象没有原图，将返回缩略图。"),t(this.originalPicturePromise,!1))},e.prototype.clearPromise=function(e,t){var n=function(e){for(var n=0;n<e.length;){var i=e[n];i.dataVersion<=t?(i.reject(),e.splice(n,1)):++n}};n(e?this.originalPicturePromise:this.thumbnailPromise)},e.prototype.getBase64DataFromUrl=function(e){return window.__WPSENV__.request({method:"GET",responseType:"blob",url:e}).end().then((function(e){return new Promise((function(t,n){var i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(){n()},i.readAsDataURL(e.body)}))}))},e.prototype.initRefShapeObjId=function(){var e=this,t=function(t){var n=t.shapeData;return!!n&&(n.shapeId===e.shapeId&&n.shapeTreeType===e.shapeTreeType)};try{var n=window.APP.data.doc,i=null;if(1===this.shapeTreeType)i=n.inlineAnchors.rangeClass.map().find(t);else i=n.anchors.rangeClass.map().find(t);i&&(this.refShapeObjId=i.refShapeObjId)}catch(e){}},e}();t.default=r},7733:function(e,t,n){e.exports=function(e,t){n.e(886).then(n.bind(null,10913)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7734:function(e,t,n){e.exports=function(e,t){n.e(878).then(n.bind(null,10882)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7735:function(e,t,n){e.exports=function(e,t){n.e(891).then(n.bind(null,10878)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7736:function(e,t,n){e.exports=function(e,t){n.e(887).then(n.bind(null,10923)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7737:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=n(7738),a=i.__importDefault(n(7739)),r=n(7740),s=i.__importDefault(n(7741)),l=function(){function e(){var e=this;this.decreaseTime=100,this.listenTargets=[window],this.events=["mousemove","keydown","mousedown","touchstart","scroll","wheel"],this.lock=!0,this.PRIORITY=o.PRIORITY,this.PRIORITY_TIMEOUT=o.TIMEOUT,this.currentTask=null,this.taskIdCounter=1,this.taskQueue=[],this.isCallbackScheduling=!1,this.isPerformingWork=!1,this.isMessageLoopRunning=!1,this.schedulePerformWorkUntilDeadline=Function.prototype,this.scheduledHostCallback=Function.prototype,this.init=function(){e.initScheduleCore()},this.initListeners=function(){e.listenTargets.forEach((function(t){e.events.forEach((function(n){t.addEventListener(n,e.resetTaskTimeout,{passive:!1,capture:!0})}))}))},this.initScheduleCore=function(){e.schedulePerformWorkUntilDeadline=function(){e.currentTask&&e.currentTask.continue||(e.currentTask=a.default.peek(e.taskQueue));var t=e.currentTask,n=t.callback,i=t.name;e.currentTask.continue&&(e.currentTask.timeout-=e.decreaseTime),(0,r.schedulerLog)("[SCHEDULER_LOG]: start schedule. timeout: ".concat(e.currentTask.timeout)),e.callbackId=setTimeout((function(){return e.performWorkUntilDeadline(n,{name:i})}),e.currentTask.timeout)}},this.resetTaskTimeout=function(t){if(("scroll"!==t.type||!window.APP.workspace.scrollerHelper.deperacted_isPassiveScroll())&&e.callbackId){var n=e.currentTask.resetEvents;if(n&&!n.includes(t.type))return;e.currentTask.timeout=e.getTimeout(e.currentTask.sortIndex),clearTimeout(e.callbackId),e.schedulePerformWorkUntilDeadline()}},this.flushWork=function(t,n,i,o){e.isCallbackScheduling=!1,e.isPerformingWork=!0;try{return e.workLoop(t,n,i,o)}finally{e.isPerformingWork=!1}},this.workLoop=function(t,n,i,o){var s=o.name,l=e.shouldYieldToHost();if(console.log("[SCHEDULER_LOG]: shouldYieldToHost: ".concat(l,", ").concat(s,",")),l)return!0;if("function"==typeof t){e.currentTask.callback=null,(0,r.schedulerLog)("[SCHEDULER_LOG]: exec schedule callback. ".concat(s));var u=t();if("function"==typeof u){if(e.currentTask.callback=u,e.currentTask.continue=!0,e.currentTask===a.default.peek(e.taskQueue))return!0;e.currentTask.timeout=e.getTimeout(e.currentTask.sortIndex)}else e.currentTask===a.default.peek(e.taskQueue)&&a.default.pop(e.taskQueue)}else a.default.pop(e.taskQueue);return e.currentTask=a.default.peek(e.taskQueue),null!==e.currentTask},this.performWorkUntilDeadline=function(t,n){if(null!==e.scheduledHostCallback){var i=e.getCurrentTime(),o=!0;try{o=e.scheduledHostCallback(t,!0,i,n)}finally{o?(console.log("[SCHEDULER_LOG]: hasMoreWork"),e.schedulePerformWorkUntilDeadline()):(e.removeListeners(),e.isMessageLoopRunning=!1,e.scheduledHostCallback=null)}}else e.isMessageLoopRunning=!1},this.scheduleCallback=function(t,n){var i=n.callback,o=n.name,r=n.resetEvents;if(e.taskQueue.length||e.initListeners(),e.hasTask(o))return!1;var s=e.getCurrentTime(),l=e.getTimeout(t),u=s+l,c={resetEvents:r,id:e.taskIdCounter++,callback:i,startTime:s,expirationTime:u,sortIndex:t,name:o,timeout:l};return a.default.push(e.taskQueue,c),e.isCallbackScheduling||e.isPerformingWork||(e.isCallbackScheduling=!0,!e.lock&&e.requestHostCallback(e.flushWork)),c},this.unlock=function(){e.lock=!1,e.requestHostCallback(e.flushWork)},this.requestHostCallback=function(t){e.scheduledHostCallback=t,e.isMessageLoopRunning||(e.isMessageLoopRunning=!0,e.schedulePerformWorkUntilDeadline())},this.shouldYieldToHost=function(){return!1},this._getType=function(e){return Object.prototype.toString.call(e).slice(8,-1)},this.getCurrentTime=function(){return window.performance&&"Function"===e._getType(window.performance.now)?performance.now():Date.now()},this.init()}return e.prototype.reset=function(){this.currentTask=null,this.taskIdCounter=1,this.taskQueue=[],this.isCallbackScheduling=!1,this.isPerformingWork=!1,this.isMessageLoopRunning=!1,this.removeListeners(),this.init()},Object.defineProperty(e.prototype,"taskName",{get:function(){return s.default},enumerable:!1,configurable:!0}),e.prototype.removeListeners=function(){var e=this;this.listenTargets.forEach((function(t){e.events.forEach((function(n){t.removeEventListener(n,e.resetTaskTimeout,{passive:!1,capture:!0})}))})),clearTimeout(this.callbackId)},e.prototype.hasTask=function(e){return this.taskQueue.find((function(t){return t.name===e}))},e.prototype.clearTask=function(e){var t=this.taskQueue.findIndex((function(t){return t.name===e}));t>-1&&(this.taskQueue.splice(t,1),this.callbackId&&this.currentTask&&this.currentTask.name===e&&(clearTimeout(this.callbackId),this.callbackId=null,a.default.peek(this.taskQueue)&&this.schedulePerformWorkUntilDeadline()))},e.prototype.getTimeout=function(e){var t,n=this.PRIORITY,i=n.ImmediatePriority,o=n.UserBlockingPriority,a=n.NormalPriority,r=n.LowPriority,s=this.PRIORITY_TIMEOUT,l=s.IMMEDIATE_PRIORITY_TIMEOUT,u=s.USER_BLOCKING_PRIORITY_TIMEOUT,c=s.NORMAL_PRIORITY_TIMEOUT,h=s.LOW_PRIORITY_TIMEOUT;switch(e){case i:t=l;break;case o:t=u;break;case r:t=h;break;case a:default:t=c}return t},e}();t.default=l},7738:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdlePriority=t.LowPriority=t.NormalPriority=t.UserBlockingPriority=t.ImmediatePriority=t.NoPriority=t.maxYieldMs=t.continuousYieldMs=t.frameYieldMs=t.enableProfiling=t.enableIsInputPending=t.PRIORITY=t.TIMEOUT=void 0,t.TIMEOUT={IMMEDIATE_PRIORITY_TIMEOUT:700,USER_BLOCKING_PRIORITY_TIMEOUT:1200,USER_VISIBLE_PRIORITY_TIMEOUT:1500,NORMAL_PRIORITY_TIMEOUT:5e3,LOW_PRIORITY_TIMEOUT:1e4},t.PRIORITY={NoPriority:0,ImmediatePriority:1,UserBlockingPriority:2,NormalPriority:3,LowPriority:4,IdlePriority:5},t.enableIsInputPending=!1,t.enableProfiling=!1,t.frameYieldMs=5,t.continuousYieldMs=50,t.maxYieldMs=300,t.NoPriority=0,t.ImmediatePriority=1,t.UserBlockingPriority=2,t.NormalPriority=3,t.LowPriority=4,t.IdlePriority=5},7739:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this;this.push=function(t,n){var i=t.length;t.push(n),e.siftUp(t,n,i)},this.peek=function(e){return 0===e.length?null:e[0]},this.pop=function(t){if(0===t.length)return null;var n=t[0],i=t.pop();return i!==n&&(t[0]=i,e.siftDown(t,i,0)),n},this.siftUp=function(t,n,i){for(var o=i;o>0;){var a=o-1>>>1,r=t[a];if(!(e.compare(r,n)>0))return;t[a]=n,t[o]=r,o=a}},this.siftDown=function(t,n,i){for(var o=i,a=t.length,r=a>>>1;o<r;){var s=2*(o+1)-1,l=t[s],u=s+1,c=t[u];if(e.compare(l,n)<0)u<a&&e.compare(c,l)<0?(t[o]=c,t[u]=n,o=u):(t[o]=l,t[s]=n,o=s);else{if(!(u<a&&e.compare(c,n)<0))return;t[o]=c,t[u]=n,o=u}}},this.compare=function(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}};t.default=new i},7740:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.schedulerLog=void 0;var i="1"===(0,n(5).__importDefault(n(654)).default)("schedulerlog");t.schedulerLog=Function.prototype,i&&(t.schedulerLog=console.log)},7741:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={status_clearExpireItems:"status_clearExpireItems",storage_clearExpireItems:"storage_clearExpireItems",user_visible_update:"user_visible_update",user_blocking_update:"user_blocking_update",handlePictureUpdateFail:"handlePictureUpdateFail",documentMapRequest:"documentMapRequest"}},7742:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importDefault(n(7743)),a=i.__importDefault(n(7744)),r=i.__importDefault(n(7745)),s=i.__importDefault(n(7746)),l=i.__importDefault(n(7747)),u=function(){function e(e){this.comment=new o.default,this.altMode=new a.default,this.picture=new r.default,this.table=new s.default,this.revision=new l.default,this.app=e}return e.prototype.handleSelectionChange=function(){var e=this.app.data.selection,t=e.selInfo.info,n=e.getNormalRange(),i=window.APP.formatContentController.checkIsAllowInsertObjInControl(n.pos).allowInsertObj;this.comment.handleSelectionChange(this.app,t),this.picture.handleSelectionChange(this.app,t,i),this.table.handleSelectionChange(this.app,t,i),this.revision.handleSelectionChange(this.app,t)},e}();t.default=u},7743:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.disabled=!0,this.entryInContextMenu={visible:!1,disabled:!0},this.entryInReviewTab={visible:!0,disabled:!0},this.entryButtonInMainText={visible:!1,disabled:!0},this.keyboardShortcut={visible:!0,disabled:!0},this.entryInMobileInsertTab={visible:!0,disabled:!0},this.entryInMobileReviewTab={visible:!0,disabled:!0},this.entryInMobileEditButtons={visible:!0,disabled:!0}}return Object.defineProperty(e.prototype,"hasCommentAuthority",{get:function(){var e=window.APP;return!e.isReadOnly()||e.isReadOnlyComment()},enumerable:!1,configurable:!0}),e.prototype.handleSelectionChange=function(e,t){var n=!0;this.disabled=!0;var i=e.isReadOnly(),o=e.data&&e.data.doc.getReadOnly(),a=i&&!window.__CONFIG__.wps.enableReadOnlyComment,r=e.isCommentEnabled,s=e.isHistoryVersion,l=!a&&r&&!s&&!o;if(this.entryInReviewTab.visible=e.isCommentEnabled&&!e.isHistoryVersion,this.entryInContextMenu.visible=l,this.entryButtonInMainText.visible=l,this.keyboardShortcut.visible=l,this.entryInMobileInsertTab.visible=this.entryInMobileReviewTab.visible=e.isCommentEnabled&&!e.isHistoryVersion,e.isCommentEnabled){var u=t.begin,c=t.end,h=t.ctrls,d=void 0===h?[]:h,p=t.isInComment,f=t.isNonEditableInRestrictedMode,g=t.isInReadonlyDocumentField,v=t.isInHeaderFooter,m=t.isInTextbox,_=t.isAllowCommentWithControl,y=t.isInFootnoteOrEndnote,b=t.controlInfo.isHitOnDatetime,T=e.data.api.isConnected(),C=e.restrictEditHandler.isInRestrictEditMode,k=e.data.selection.selContext.isParagraphSetting,w=!1;d.some((function(t){var n=!1;if((t.begin<=u&&t.end>=u&&(n=!0),t.begin<=c&&t.end>=c&&(n=!0),n)&&e.formatContentController.checkIsDefaultContent(t))return w=!0,!0;return!1})),n=!T||a||o||p||b||v||m||y||g||C||f&&!e.restrictEditHandler.isInCommentProtectMode||!_||w||k,i&&u===c&&(n=!0),this.entryButtonInMainText.visible&&n&&(this.entryButtonInMainText.visible=!1),this.disabled=n}this.entryButtonInMainText.disabled=this.disabled,this.entryInContextMenu.disabled=this.disabled,this.entryInReviewTab.disabled=this.disabled,this.keyboardShortcut.disabled=this.disabled,this.entryInMobileInsertTab.disabled=this.disabled,this.entryInMobileReviewTab.disabled=this.disabled,this.entryInMobileEditButtons.disabled=this.disabled},e.prototype.updateStateNow=function(){try{var e=window.APP,t=e.data.selection.selInfo.getSelectionInfo();this.handleSelectionChange(e,t)}catch(e){}},e.prototype.updateMainTextEntryStatus=function(){try{var e=window.APP,t=e.data.selection.getNormalRange().pos,n=!1,i=!1;e.data.selection.selInfo&&(i=e.data.selection.selInfo.isHitOnCtrl().isHitOnDatetime,n=e.data.selection.selInfo.checkIsSelInReadOnlyDocumentField()),(e.data.selection.selContext.isInTextbox||e.data.selection.selContext.isInHeaderFooter||e.data.selection.selContext.isInComment()||e.isCommentDisabledInRestrictEditMode()||i||e.formatContentController.isInsideControlDefault(t)||!e.formatContentController.checkIsEditable().allowComment||n||e.data.selection.selContext.isParagraphSetting)&&(this.entryButtonInMainText.visible=!1)}catch(e){}},e}();t.default=i},7744:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5).__importDefault(n(227)),o=function(){function e(){this._isInAltMode=!1,this.bindThis(["handleEnterAltMode","handleExitAltMode"]),this.init()}return Object.defineProperty(e.prototype,"isInAltMode",{get:function(){return this._isInAltMode},enumerable:!1,configurable:!0}),e.prototype.refreshKeyTip=function(){this.isInAltMode&&window.postMessage(JSON.stringify({eventName:"alt_web_access",cmd:"refresh"}))},e.prototype.clearAll=function(){window.removeEventListener(i.default.names.ENTER_ALT_MODE,this.handleEnterAltMode),window.removeEventListener(i.default.names.EXIT_ALT_MODE,this.handleExitAltMode)},e.prototype.init=function(){window.addEventListener(i.default.names.ENTER_ALT_MODE,this.handleEnterAltMode),window.addEventListener(i.default.names.EXIT_ALT_MODE,this.handleExitAltMode)},e.prototype.handleEnterAltMode=function(){this._isInAltMode=!0},e.prototype.handleExitAltMode=function(){this._isInAltMode=!1},e.prototype.bindThis=function(e){var t=this;e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))},e}();t.default=o},7745:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.entryInMobileInsertTab={visible:!0,disabled:!1}}return e.prototype.handleSelectionChange=function(e,t,n){var i=e.isReadOnly(),o=t.controlInfo||{},a=o.isIncludedByPicCtrl,r=o.isHitOnPicture,s=i||t.isNonEditableInRestrictedMode||t.begin===t.end&&r||t.isInComment||!t.isAllowInsertPicWithControl||t.isInTextbox||t.isInReadonlyDocumentField||!n&&!a||t.inOMath;this.entryInMobileInsertTab.disabled=s},e}();t.default=i},7746:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.entryInMobileInsertTab={visible:!0,disabled:!1}}return e.prototype.handleSelectionChange=function(e,t,n){var i=e.isReadOnly(),o=t.controlInfo,a=i||!n||t.isNonEditableInRestrictedMode||t.isInReadonlyDocumentField||t.isInTextbox||t.isInComment||o.isHitAroundBlockCtrl||(o.isHitOnRichText||o.isHitOnRepeatSec)&&o.isHitOnInlineCtrl||t.inTable||!t.isAllowInsertWithControl||t.inOMath;this.entryInMobileInsertTab.disabled=a},e}();t.default=i},7747:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.entryInMobileReviewTab={visible:!0,disabled:!1}}return e.prototype.handleSelectionChange=function(e,t){var n=e.isReadOnly(),i=e.restrictEditHandler,o=i.isInRevisionProtectMode,a=i.isInCommentProtectMode,r=i.isInReadonlyProtectMode,s=n||o||a||r;this.entryInMobileReviewTab.disabled=s},e}();t.default=i},7748:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jumpToComment=void 0;var i=n(5),o=i.__importDefault(n(260));t.jumpToComment=function(){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(t){return(e=window.APP).appApi.showComments({checked:!1}),e.appApi.setCommentShowStatus({commentBubble:!1,commentPanel:!0}),o.default.dispatchEvent(o.default.taskPane.OPEN_COMMENT_PANEL),[2]}))}))}},7749:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.list=new Map}return e.prototype.add=function(e,t){void 0===t&&(t={}),this.list.set(e,t)},e.prototype.get=function(e){return this.list.get(e)},e.prototype.delete=function(e){this.list.delete(e)},e.prototype.clear=function(){this.list.clear()},e}();t.default=i},7750:function(e,t,n){e.exports=function(e,t){n.e(881).then(n.bind(null,7509)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7751:function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=o.__importDefault(n(733)),r=o.__importDefault(n(4104)),s=o.__importDefault(n(260)),l=n(1238),u=n(3483),c=n(309),h=n(1733),d=o.__importStar(n(1033)),p=n(1643);function f(e){var t={noOpsTip:_i18n("applications.writer.components.core.app.services.recordlocate.noOpsTip", "This historical content has no location information and cannot be located."),deleteOrMoveTip:_i18n("applications.writer.components.core.app.services.recordlocate.deleteOrMoveTip", "This historical content has been deleted or moved and cannot be located.")},n=t[e]?t[e]:t.noOpsTip;window.Toast.info(n)}function g(e,t){var n=b.commonClick(e,t);if(!n)return!1;var i=window.APP.data.doc.recordHighlightRanges.find((function(e){return e.isNearest}));return i&&0!==i.len?n:(f("deleteOrMoveTip"),n.cancel(),!1)}function v(e,t){var n=g(e,t);if(!n)return!1;var i=window.APP.data,o=i.doc.recordHighlightRanges.find((function(e){return e.isNearest})),a=i.doc.anchors.findAnchor(o.pos)||i.doc.inlineAnchors.findAnchor(o.pos);return a&&a.shapeId&&n.then((function(){i.selection.selAlter.selectShape({id:a.shapeId,gcp:a.pos})}),(function(){})),n}function m(e,t){var n=b.commonClick(e,t);if(!n)return!1;var i=window.APP.data.doc.recordHighlightRanges.find((function(e){return e.isNearest}));return!i||0===i.pos&&0===i.len?(f("deleteOrMoveTip"),n.cancel(),!1):n}var _,y=((i={redo:function(e,t){var n=window.APP.recordLocateServ.get(e);if(n&&n.versions&&n.versions[0]){var i=n.versions[0].getRealVersion(),o=i.command&&i.command.name;if(o===r.default.mergeTableCells&&y[o])return void y[o](e,[])}m(e,t)},undo:function(e,t){var n=window.APP.recordLocateServ.get(e);if(n&&n.versions&&n.versions[0]){var i=n.versions[0].getRealVersion(),o=i.command&&i.command.name;if(o===r.default.mergeTableCells&&y[o])return void y[o](e,[])}m(e,t)},createFile:function(){f()},updateVersion:function(){f("deleteOrMoveTip")},rollBack:function(){f("deleteOrMoveTip")}})[r.default.insertWatermark]=function(){f()},i[r.default.insertPageNumber]=function(){f()},i[r.default.setDocProps]=function(){f()},i[r.default.insertHeaderFooter]=function(){f()},i[r.default.insertBreak]=function(){f()},i[r.default.insertSeparator]=function(){f()},i[r.default.deleteBookmarks]=function(){f()},i[r.default.deleteWatermark]=function(){f()},i[r.default.mergeTableCells]=function(e,t){if(b.commonClick(e,t)){var n=window.APP.data,i=n.doc.recordHighlightRanges,o=i.filter((function(e){return e.isCurrentOps}));if(o.forEach((function(e){var t=(0,h.getCellRangeByPos)(n.doc,e.pos);t&&(e.pos=t.begin,e.len=t.end-t.begin)})),o.length>1){var a=i.find((function(e){return e.isNearest}));if(a){var r=(0,h.collectTable)(n.doc,a.pos);r&&r.range&&(n.doc.recordHighlightRanges=[{pos:r.range.begin,len:r.range.end-r.range.begin}])}}}},i[r.default.splitTableCells]=function(e,t){g(e,t)},i[r.default.insertColumnRight]=function(e,t){if(b.commonClick(e,t)){var n=window.APP.data,i=n.doc.recordHighlightRanges.find((function(e){return e.isNearest})),o=(0,h.collectColumns)(n.doc,i.pos,i.pos).ranges;o&&o.length&&(n.doc.recordHighlightRanges=o.map((function(e){return{pos:e.begin,len:e.end-e.begin}})))}},i[r.default.insertColumnLeft]=function(e,t){if(b.commonClick(e,t)){var n=window.APP.data,i=n.doc.recordHighlightRanges.find((function(e){return e.isNearest})),o=(0,h.collectColumns)(n.doc,i.pos,i.pos).ranges;o&&o.length&&(n.doc.recordHighlightRanges=o.map((function(e){return{pos:e.begin,len:e.end-e.begin}})))}},i[r.default.insertRowAbove]=function(e,t){if(g(e,t)){var n=window.APP.data,i=n.doc.recordHighlightRanges.find((function(e){return e.isNearest})),o=(0,h.collectRows)(n.doc,i.pos,i.pos).range;o&&(n.doc.recordHighlightRanges=[{pos:o.begin,len:o.end-o.begin}])}},i[r.default.insertRowBelow]=function(e,t){if(g(e,t)){var n=window.APP.data,i=n.doc.recordHighlightRanges.find((function(e){return e.isNearest})),o=(0,h.collectRows)(n.doc,i.pos,i.pos).range;o&&(n.doc.recordHighlightRanges=[{pos:o.begin,len:o.end-o.begin}])}},i[r.default.insertPicture]=function(e,t){v(e,t)},i[r.default.resizeShape]=function(e,t){v(e,t)},i[r.default.setShapeWrapFormat]=function(e,t){v(e,t)},i[r.default.moveShape]=function(e,t){v(e,t)},i[r.default.movePicture]=function(e,t){v(e,t)},i[r.default.changePicture]=function(e,t){var n=b.commonClick(e,t);if(!n)return!1;var i=window.APP.data,o=i.doc.recordHighlightRanges.find((function(e){return e.isNearest}));if(!o)return f("deleteOrMoveTip"),n.cancel(),!1;var a=window.APP.recordLocateServ.get(e),r=a.data&&a.data.commands&&a.data.commands[0],s=r&&r.param,l=s&&s.shapeId,u=s&&s.shapeTreeType;if(l){var c=-1;[i.doc.anchors,i.doc.inlineAnchors].some((function(e){return e.rangeClass.forEachNode((function(e){var t=e.shapeData;-1===c&&t&&t.shapeId===l&&t.shapeTreeType===u&&(o.pos=c=e.pos,o.len=e.len,n.then((function(){return i.selection.selAlter.selectShape({id:l,gcp:o.pos})}),(function(){})))})),!(-1===c)}))}return 0===o.len?(f("deleteOrMoveTip"),n.cancel(),!1):n},i[r.default.formatOp]=function(e,t){var n=b.commonClick(e,t);if(!n)return!1;var i=window.APP.recordLocateServ.get(e),o=i.versions&&i.versions[0]&&i.versions[0],a=o&&o.command,r=a&&a.param&&a.param.opType,s=o&&o.ops&&o.ops[0];if(!o||!r&&0!==r||!s)return f(),n.cancel(),!1;if([d.Sec_Margins,d.Sec_PageOrientation,d.Sec_PageSize].includes(r))return f(),n.cancel(),!1;var l=window.APP.data,u=l.doc.recordHighlightRanges.find((function(e){return e.isNearest}));if(!u||0===u.len&&s.canSplit())return f("deleteOrMoveTip"),n.cancel(),!1;if(!1===s.canSplit()){var c=u.pos,h=u.len;if((p=l.doc.getDataLogic("final").getPapx(c)).good)if(u.pos=p.pos,u.len=Math.max(Math.abs(p.pos-c)+h,p.len),c+h>p.pos+p.len)(g=l.doc.getDataLogic("final").getPapx(c+h-1)).good&&g.pos!==u.pos&&(u.len=Math.abs(g.pos+g.len-c-h)+u.len)}else if(r===d.Style_ApplyToRange&&1===u.len&&"\r"===l.doc.getText(u.pos,u.len)){var p,g;c=u.pos,h=u.len;if((p=l.doc.getDataLogic("final").getPapx(c)).good)if(u.pos=p.pos,u.len=Math.max(Math.abs(p.pos-c)+h,p.len),c+h>p.pos+p.len)(g=l.doc.getDataLogic("final").getPapx(c+h-1)).good&&g.pos!==u.pos&&(u.len=Math.abs(g.pos+g.len-c-h)+u.len)}return n},i[r.default.insertText]=function(e,t){g(e,t)},i[r.default.insertTable]=function(e,t){g(e,t)},i[r.default.insertTableOfContents]=function(e,t){g(e,t)},i[r.default.insertHyperlink]=function(e,t){g(e,t)},i[r.default.insertDatetime]=function(e,t){g(e,t)},i[r.default.addContentControl]=function(e,t){g(e,t)},i[r.default.editContentControl]=function(e,t){if(g(e,t)){var n=window.APP.data,i=n.doc.recordHighlightRanges.find((function(e){return e.isNearest})),o=n.doc.contentControls.collect(i.pos,i.len);if(o&&o.length){var a=o[0],r=a.pos,s=a.len;i.pos=r,i.len=s}}},i[r.default.insertBookmark]=function(e,t){var n=m(e,t);if(n){var i=window.APP.data,o=i.doc.bookmarks;if(o){var a=i.doc.recordHighlightRanges.find((function(e){return e.isNearest}));if(!o.getBookMark(a.pos,a.len))return f("deleteOrMoveTip"),n.cancel(),!1}}return n},i[r.default.insertPic4ProcessOn]=function(e,t){g(e,t)},i[r.default.insertPic4LatexMath]=function(e,t){g(e,t)},i[r.default.insertNewComment]=function(e,t){var n=window.APP.data,i=window.APP.recordLocateServ.get(e),o=i.data&&i.data.commands&&i.data.commands[0],a=o&&o.param,r=(0,p.decodeBkName)(a.bkName),s=r&&r.comment_id;if(s){var l=n.doc.comments.getCommentByCommentId(s);if(l){var u=b.gotoRange([{pos:l.pos,len:l.len,isNearest:!0,isCurrentOps:!0}],l);return void(u&&u.then(b.closeHighlight,(function(){})))}}f("deleteOrMoveTip")},i[r.default.dragTable]=function(e,t){g(e,t)},i[r.default.moveTableOfRowOrCol]=function(e,t){g(e,t)},i),b=function(){function e(){}return e.getCommandType=function(e,t){var n="";return e.commands&&e.commands.length?n=e.commands[0].name:e.undo?n="undo":e.redo?n="redo":t===a.default.ROLL_BACK?n="rollBack":t===a.default.OFFLINE_UPDATE&&(n="updateVersion",1===e.version&&(n="createFile")),n},e.getNearestRange=function(e){var t=window.APP.uilManager.getGCPOnVisible(),n=o.__spreadArray([],e,!0).reverse().find((function(e){return e.pos>=t}))||e[0];return n.isNearest=!0,n},e.click=function(t){var n=t.revision,i=t.info,o=t.type,a=t.mergedRevisions,r=e.getCommandType(i,o);(y[r]||e.commonClick)(n,a)},e.commonClick=function(t,n){var i=e.getHighlightRanges(t,n);if(!i)return!1;var o=e.gotoRange(i);return!!o&&(o.then(e.closeHighlight,(function(){})),o)},e.getHighlightRanges=function(e,t){var n=window.APP.recordLocateServ,i=o.__spreadArray([e],t||[],!0).reduce((function(e,t){try{var i=n.locate(t);i.error||(e[t]=i.rgs.sort((function(e,t){return t.pos-e.pos})).reduce((function(e,t){var n={pos:t.pos,len:isNaN(t.len)?0:t.len};if(e.every((function(e){return e.pos!==n.pos||e.len!==n.len}))){var i=e.find((function(e){return e.pos===n.pos+n.len}));i?(i.pos=n.pos,i.len=n.len+i.len):e.push(n)}return e}),[]))}catch(e){console.error(e)}return e}),{}),a=Object.keys(i).sort((function(e,t){return parseInt(t)-parseInt(e)}));if(!a.length||!i[e])return console.log("[record locate]: ".concat(e),"\n",n.get(e)),f(),!1;var r=a.reduce((function(e,t,n){return i[t].forEach((function(t){var i=t.pos,a=t.len;e.every((function(e){return e.pos!==i||e.len!==a}))&&e.push(o.__assign({pos:i,len:a},0===n?{isCurrentOps:!0}:{}))})),e}),[]);return console.log("[record locate]: ".concat(e)+"\n",n.get(e),"\n","highlightRanges: [".concat(r.map((function(e){return"{pos:"+e.pos+",len:"+e.len+"}"})),"]")),r},e.gotoRange=function(t,n){var i=window.APP.data;i.selection.selContext.isInComment()&&(window.APP.uilManager.exitCommentBody(),i.selection.setPosition(0,0,{updateOnly:!0}));var o=e.getNearestRange(t.filter((function(e){return e.isCurrentOps}))),a=i.doc.getSubDocType(o.pos),r=n||(a?i.doc.commentBodys.getCommentByPos(o.pos):null),h=o.pos,d=o.len;if(r&&(h=r.begin,d=r.len),!r&&a===c.Comment&&0===d||d<0)return f("deleteOrMoveTip"),!1;for(var p=0;p<t.length;p++){var g=t[p];g!==o&&g.pos+g.len===o.pos&&(o.pos=g.pos,o.len=g.len+o.len,t.splice(p--,1))}i.doc.recordHighlightRanges=t;var v=function(){},m=new Promise((function(e,t){var n=(0,l.typoToPositionWithLoading)(h+d).then(e,t);v=function(){n.cancel&&n.cancel(),t()}}));return m.cancel=v,m.then((function(){if(r){var e=i.doc.commentBubbles.getBubbleByRange(r.begin,r.len);if(e){i.doc.recordHighlightRanges.push({pos:r.begin,len:r.len});var t=e.id,n={commentId:r.comment_id,rcId:r.rc_id,bubbleId:t};window.APP.todoList.add(u.EventType.ShowCommentItemAfterFindLocate,n),window.APP.workspace.scrollToPos(i.typoinfo.getPosition(r.begin).pos),s.default.dispatchEvent(s.default.comments.SCROLL_FIND_COMMENT,n)}}else 0===o.len?(i.selection.setPosition(o.pos,o.pos+o.len),window.APP.workspace.makesureCursorVisible(!0,!0,!1)):(window.APP.workspace.scrollToPos(i.typoinfo.getPosition(o.pos).pos),window.APP.workspace.refreshDryly())}),(function(){i.doc.clearRecordHighlight()})),m},e.closeHighlight=function(){_&&clearTimeout(_),_=setTimeout((function(){window.APP.data.doc.clearRecordHighlight(),window.APP.workspace.refreshDryly(),_=null}),1e3)},e}();t.default=b},7752:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CharWidthMap=void 0;var i={Wingdings:{"":{size:2048,width:1529},"":{size:2048,width:2020},"":{size:2048,width:1627},"":{size:2048,width:1609},"":{size:2048,width:1826},"":{size:2048,width:1826}}};t.CharWidthMap=i},7753:function(e,t){},7754:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importDefault(n(7755)),a=i.__importDefault(n(7756)),r=function(){function e(){this.highlight=new a.default,this.underline=new o.default}return e.prototype.afterOpen=function(){window.APP.data.doc.attachObserver(this)},e.prototype.clearAll=function(){window.APP.data.doc.detachObserver(this)},e.prototype.onInsertText=function(e,t,n){this.highlight.adjustRangeAfterContentChange(t,n,!0),this.underline.adjustRangeAfterContentChange(t,n,!0)},e.prototype.onDeleteText=function(e,t,n){this.highlight.adjustRangeAfterContentChange(t,n,!1),this.underline.adjustRangeAfterContentChange(t,n,!1)},e}();t.default=r},7755:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=n(2294),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rangesMap=new Map,t}return i.__extends(t,e),t.prototype.setRanges=function(e,t){if(void 0===t&&(t=!0),!window.Array.isArray(e))return console.warn("参数错误，应为Array<{ pos: number; len: number; color: string; type: string }>"),"";var n="u_"+(0,o.getUniqueId)(),i=[];return this.rangesMap.set(n,i),e.forEach((function(e){Number.isInteger(e.pos)&&Number.isInteger(e.len)&&"string"==typeof e.color&&"string"==typeof e.type&&i.push({pos:e.pos,len:e.len,color:e.color,type:e.type})})),t&&i.length>0&&window.APP.workspace.refreshContinently(),n},t.prototype.setUnderlineGroup=function(e){var t=this,n=e.map((function(e){return t.setRanges(e,!1)}));return n.length&&window.APP.workspace.refreshContinently(),n},t}(i.__importDefault(n(6114)).default);t.default=a},7756:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=n(2294),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rangesMap=new Map,t}return i.__extends(t,e),t.prototype.setRanges=function(e,t){if(void 0===t&&(t=!0),!window.Array.isArray(e))return console.warn("参数错误，应为Array<{ pos: number; len: number; color: string }>"),"";var n="hl_"+(0,o.getUniqueId)(),i=[];return this.rangesMap.set(n,i),e.forEach((function(e){Number.isInteger(e.pos)&&Number.isInteger(e.len)&&"string"==typeof e.color&&i.push({pos:e.pos,len:e.len,color:e.color})})),t&&i.length>0&&window.APP.workspace.throttleForceRefresh(),n},t.prototype.setHighlightGroup=function(e){var t=this,n=e.map((function(e){return t.setRanges(e,!1)}));return n.length&&window.APP.workspace.throttleForceRefresh(),n},t}(i.__importDefault(n(6114)).default);t.default=a},7757:function(e,t,n){e.exports=function(e,t){n.e(889).then(n.bind(null,10934)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7758:function(e,t,n){e.exports=function(e,t){n.e(890).then(n.bind(null,10895)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7759:function(e,t,n){e.exports=function(e,t){n.e(872).then(n.bind(null,2658)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7760:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(2503),l=n(310),u=function(){function e(){o()(this,e)}return r()(e,null,[{key:"filter",value:function(e){return e&&e.vertical_align_mode&&(e.vertical_align_mode=s.alphabetic),e}},{key:"filterPapx",value:function(t){return t.prop=e.filter(t.prop),t}},{key:"adapt",value:function(t){var n=t.getPap.bind(t),i=t.getPapx.bind(t),o=t.collectPapxs.bind(t),a=t.getPrevPapx.bind(t),r=t.getNextPapx.bind(t),s=t.movePapxToPrev.bind(t),u=t.movePapxToNext.bind(t);return t.getPap=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.IT.Include;return e.filter(n(t,i))},t.getPapx=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.IT.Include;return e.filterPapx(i(t,n))},t.collectPapxs=function(t,n){return o(t,n).map((function(t){return e.filterPapx(t)}))},t.getPrevPapx=function(t){return e.filterPapx(a(t))},t.getNextPapx=function(t){return e.filterPapx(r(t))},t.movePapxToPrev=function(t){return s(t),e.filterPapx(t)},t.movePapxToNext=function(t){return u(t),e.filterPapx(t)},t}}]),e}();t.a=u},7761:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(22),l=n.n(s),u=n(23),c=n.n(u),h=n(626),d=n(411),p=n(336),f=n(554),g=n(7528),v=n(1737),m=n(3862),_=n(400),y=n(6119),b=n(310),T=n(5745),C=n(4583),k=n(7214),w=n(6120),S=n(260),P=n(1583),I=n(309),E=function(e){function t(e,n,i){var a=i.typoInfo;o()(this,t);var r=l()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:null,viewPage:null,coorSystem:null}));return r.compose=n,r.data=e,r.shouldClearCanvas=[],r._layout_pages=[],r.layout_pages=[],r.pendinglowPageCounts=[],r.page_heights=[],r.pageWidths=[],r.pagePos=[],r.page_ycap=Object(p.Ti2Px)(k.b),r.page_ybetween=Object(p.Ti2Px)(k.a),r.allpage_width=0,r.allpage_height=0,r.outer_rects=[],r.outer_rects_is_dirty=!0,r.isTypoEnd=!1,r.curVersion=0,r.isupdating=!1,r.pendingPages=[],r.localCount=-1,r._padding=16,r.decorativePageCache=new T.b,r.secPageCountCache=new Map,r._stableAllPageHeight=0,r._stablePageCount=0,r.scheduling=!1,r.commentView=new w.a(e,n,r),Object(f.default)(r),r.packRanges=new b.ITToolkit(b.IT.upper,b.IT.Crossing),r.textLineRanges=new b.ITToolkit(b.IT.upper,b.IT.Crossing),r.tableLineRanges=new b.ITToolkit(b.IT.upper,b.IT.Nesting),r.frameLineRanges=new b.ITToolkit(b.IT.upper,b.IT.Nesting),r.shapeCardRanges=new b.ITToolkit(b.IT.upper,b.IT.Nesting),r.embedShapeRanges=new b.ITToolkit(b.IT.upper,b.IT.Nesting),r.coreTypoShapeInfo=new Map,a&&(r._initFromRawData(a,!0),r._dealCoreShapeInfo(a.typoShapeInfo)),r}return c()(t,e),r()(t,[{key:"isCoorSystem",value:function(){return!0}},{key:"mergePages",value:function(e){return e}},{key:"_dealCoreShapeInfo",value:function(e){var t=this;e&&e.forEach((function(e){var n=e.id,i=t.coreTypoShapeInfo.get(n);if(t.coreTypoShapeInfo.set(n,e),i&&i.shape){var o=t.data.doc.anchors.getAnchor(i.shape.id,i.shape.pos,1);o||(o=t.data.doc.inlineAnchors.getAnchor(i.shape.id,i.shape.pos,1)),o&&t.data.doc._dispatch("onChpxChanged",{pos:i.shape.pos,len:1})}}))}},{key:"getTypoShapeInfo",value:function(e){if(!e)return null;var t=this.coreTypoShapeInfo.get(e.id);return t||(t={dataVersion:-99,id:e.id,shape:e.topShape,visualInnerBounding:{left:0,top:0,right:Object(p.Px2Ti)(e.rect.width),bottom:Object(p.Px2Ti)(e.rect.height)}},this.coreTypoShapeInfo.set(e.id,t),this.data.api.queryRange({gcpCurrent:t.shape.pos,length:1})),t}},{key:"update",value:function(e){if(this.data.doc.useCoreTypo){var t=this.mergePages(e);this._initFromRawData(t),this.calcRects()}else this.lastCoreTypoinfo=e;this._dealCoreShapeInfo(e.typoShapeInfo)}},{key:"deletePendingPage",value:function(e){var t=this.pendingPages.indexOf(e);t>-1&&this.pendingPages.splice(t,1)}},{key:"changeToCoreTypo",value:function(){this.lastCoreTypoinfo&&(this.updater.dropPages(this,{from:0,to:this.layout_pages.length}),this.pageCount=0,this.layout_pages=[],this._initFromRawData(this.lastCoreTypoinfo,!0),this.calcRects(),delete this.lastCoreTypoinfo)}},{key:"getCurrentPos",value:function(e){for(var t=e.top,n=e.bottom,i=[],o=0;o<this.outer_rects.length;++o){var a=this.outer_rects[o];if(!this.layout_pages[o])break;var r=a.top,s=r+a.height,l=Math.max(r,t),u=Math.min(s,n);l<u&&i.push({index:o,height:u-l})}return i.length>0?(i.sort((function(e,t){return e.height<t.height})),this.layout_pages[i[0].index]&&this.layout_pages[i[0].index].mainpages[0]&&this.layout_pages[i[0].index].mainpages[0].range&&this.layout_pages[i[0].index].mainpages[0].range.pos||0):0}},{key:"_initFromRawData",value:function(e,t){var n=this;if(this.data.doc.useCoreTypo){if(this.curVersion=window.g_rpt.curVersion,this.isTypoEnd!==e.typoEnd&&e.typoEnd&&setTimeout((function(){n.onAllPageDone()}),16),this.isTypoEnd=!0===e.typoEnd,this.pageCount=e.pageCount,this.outer_rects=[],this.outer_rects_is_dirty=!0,e.pageHeight){var i=e.pageHeight.length;e.pageHeight.length=e.pageCount,i<e.pageCount&&e.pageHeight.fill(e.pageHeight[i-1],i)}if(e.pageWidth){var o=e.pageWidth.length;e.pageWidth.length=e.pageCount,o<e.pageCount&&e.pageWidth.fill(e.pageWidth[o-1],o)}if(e.pagePos){var a=e.pageWidth.length;e.pagePos.length=e.pageCount;for(var r=a;r<e.pageCount;++r)e.pagePos.push(e.pagePos[r-1]+1)}if(e.fontTableInfo){var s=e.fontTableInfo,l=window.APP.fontServer;s.forEach((function(e){l.requestLoadFontResource({family:e.coreFontName})}))}this.page_ycap=Object(p.Ti2Px)(e.yCap),this.page_ybetween=Object(p.Ti2Px)(e.yBetween),this.pageWidths=e.pageWidth.map((function(e){return Object(p.Ti2Px)(e)})),this.page_heights=e.pageHeight.map((function(e){return Object(p.Ti2Px)(e)}));var u=this.allpage_height,c=2*e.yCap+(this.page_heights.length-1)*e.yBetween;e.pageHeight.forEach((function(e){c+=e})),this.allpage_height=Object(p.Ti2Px)(c),this.allpage_width=0,e.pageWidth.forEach((function(e){n.allpage_width=Math.max(n.allpage_width,Object(p.Ti2Px)(e))})),this.pagePos=[];for(var h=0;h<e.pagePos.length;h++)this.pagePos[h]=0==h?{beginPos:0,endPos:e.pagePos[h]}:{beginPos:e.pagePos[h-1],endPos:e.pagePos[h]};var d=function(t){var i=t.pageIndex;void 0!==t.isVisible&&!t.isVisible&&i<n.page_heights.length&&(n.page_heights.length>1&&(n.allpage_height-=Object(p.Ti2Px)(e.yBetween)),n.allpage_height-=n.page_heights[i],n.page_heights[i]=0)},f=0===this._layout_pages.length,g=this._layout_pages.splice(0,this._layout_pages.length),v=this.layout_pages.splice(0,this.layout_pages.length),m=null,_=null,y=-1;(t||f?this.data.cache.typoinfo.typoPageInfo:e.typoPageInfo).forEach((function(t){var i=t;if(i.pageIndex<e.pageCount){if(y=Math.max(y,i.pageIndex),void 0!==i.oldPageIndex){if(!(i.oldPageIndex<g.length))return void console.log("后端导的数据可能有问题:",i);m=g[i.oldPageIndex],_=v[i.oldPageIndex],g[i.oldPageIndex]=!1,v[i.oldPageIndex]=!1,_&&(_.layout_index=i.pageIndex,n.layout_pages[i.pageIndex]=_),m.pageIndex=i.pageIndex,i=m}else i.pageIndex<g.length&&(g[i.pageIndex]=!1);d(i),n._layout_pages[i.pageIndex]=i}})),g.forEach((function(t){t&&(n._layout_pages[t.pageIndex]&&console.error("typoinfo._layout_pages[",t.pageIndex,"] need be cleared"),t.pageIndex<e.pageCount&&(-1===y||t.pageIndex<y)&&(d(t),n._layout_pages[t.pageIndex]=t))})),v.forEach((function(e){e&&n.freeLayoutPage(e)})),u!=this.allpage_height&&this.onContainerChanged(),this.data.fieldManager&&this.data.fieldManager.updatePageCountField(this.pageCount),this.onViewportChanged()}}},{key:"calcSectionPageCount",value:function(e){var t=0,n={begin:Number.MAX_SAFE_INTEGER,end:Number.MIN_SAFE_INTEGER},i={begin:Number.MAX_SAFE_INTEGER,end:Number.MIN_SAFE_INTEGER},o=function(e,t){var n=t.begin,i=t.end;if(e.range){var o=e.range.pos,a=e.range.pos+e.range.len;n=n>o?o:n,i=i<a?a:i}return{begin:n,end:i}},a=void 0,r=void 0;this.layout_pages.forEach((function(s){s.section===e.section&&(s.header&&(n=o(s.header,n),a=!0),s.footer&&(i=o(s.footer,i),r=!0),++t)})),n=a?n:null,i=r?i:null;var s=this.data.fieldManager.updateSectionPageCountField(e,t,n,i);return s&&this.secPageCountCache.set(e.section,t),s}},{key:"freeLayoutPage",value:function(e){if(e.isMoc){var t=e.mainpages[0].lines[0];this.detachTextLine(t)}else this._freeLayoutPage(e)}},{key:"_freeLayoutPage",value:function(e){var t=this;if(e.decorativePage){var n=e.decorativePage;n.header&&this._freePack(n.header),n.footer&&this._freePack(n.footer)}e.mainpages.forEach((function(e){e.footnotes&&e.footnotes.notes.forEach((function(e){t._freePack(e.note_page)})),e.endnotes&&e.endnotes.notes.forEach((function(e){t._freePack(e.note_page)})),t._freePack(e)}))}},{key:"_freePack",value:function(e){var t=this;e.lines.forEach((function(e){t._freeLine(e)}))}},{key:"_freeLine",value:function(e){var t=this,n=e.range;if(e.tablecells)return e.tablecells.forEach((function(e){var n=e.cell_page;n&&t._freePack(n),e.diagCell&&e.diagCell.pages.forEach((function(e){t._freePack(e)}))})),void this.detachTableLine(e);if(e.isSnippetLine){var i=e.pack;return i&&this._freePack(i),void this.detachFrameLine(e)}e.sublines&&e.sublines.length>0&&e.sublines.forEach((function(e){t._freeLine(e)})),this.shapeCardRanges.mapInRange(n.begin,n.end,b.IT.mapToNode,b.IT.strictIntersectTest).forEach((function(n){if(!t.data.doc.useCoreTypo||n.viewPage===e.viewPage){if(n.has_textbox){var i=n.textbox_page;i&&t._freePack(i)}t.shapeCardRanges.detachNode(n)}})),this.embedShapeRanges.mapInRange(n.begin,n.end,b.IT.mapToNode,b.IT.strictIntersectTest).forEach((function(n){if(!t.data.doc.useCoreTypo||n.viewPage===e.viewPage){if(n.has_textbox){var i=n.textbox_page;i&&t._freePack(i)}t.embedShapeRanges.detachNode(n)}})),this.detachTextLine(e)}},{key:"onUpdated",value:function(e,t){var n=e.dropCount,i=e.from;this.calcRects(n,i),this.onPosChanged({updatePosAfterTypo:!0,params:{updatedPages:t,dropCount:n}}),this.onContainerChanged(),this.onViewportChanged()}},{key:"increasePageIndex",value:function(e){var t=e.from,n=this.layout_pages;if(n[t+1]){n[t+1].layout_index!==t&&(n[t+1].layout_index=t);for(var i=t+1;i<n.length;i++){n[i].layout_index+=1}for(var o=0;o<this.pendingPages.length;o++)this.pendingPages[o]>=t&&(this.pendingPages[o]+=1);for(var a=window.APP.workspace.canvasHandler._canvasPool,r=0;r<a.length;r++){var s=a[r];s.layout_index>=t&&(s.layout_index+=1)}}}},{key:"decreasePageIndex",value:function(e){var t=e.from,n=e.dropCount;e.dropIndex;this.updaePendingPages(t,n),this.updateCanvasIndex(t,n),this.updateLayoutPages(t+1,n)}},{key:"updateLayoutPages",value:function(e,t){for(var n=this.layout_pages,i=e;i<n.length;i++){n[i].layout_index-=t}}},{key:"updaePendingPages",value:function(e,t){var n=this,i=this.pendingPages,o=i.findIndex((function(t){return t>=n.layout_pages[e].layout_index}));if(-1!==o)for(i[o]=e,o+=1;o<i.length;o++)i[o]-=t}},{key:"updateCanvasIndex",value:function(e,t){for(var n=window.APP.workspace.canvasHandler._canvasPool,i=0;i<n.length;i++){var o=n[i];o.layout_index===this.layout_pages[e].layout_index&&(o.layout_index=e),o.layout_index>=e&&o.layout_index<e+t&&this.shouldClearCanvas.push(o),this.layout_pages[e+1]&&o.layout_index>=this.layout_pages[e+1].layout_index&&(o.layout_index-=t)}}},{key:"onAllPageDone",value:function(){this._isBeforeAllPageUpated=!0,this._stableAllPageHeight=this.allpage_height,this._stablePageCount=this.pageCount,this.isTypoEnd=!0,window.APP.workspace.asyncRefresh(),S.default.dispatchEvent(S.default.names.DOC_TYPO_ALL_PAGE_DONE)}},{key:"calcRects",value:function(e,t){var n=this;if(!this.outer_rects_is_dirty)return this.outer_rects;this.page_heights.length>this.pageCount&&(e&&(this.pagePos.splice(t,e),this.page_heights.splice(t,e),this.pageWidths.splice(t,e),this.outer_rects.splice(t,e)),this.page_heights.length>this.pageCount&&(this.pagePos.splice(this.pageCount,this.pagePos.length-this.pageCount),this.page_heights.splice(this.pageCount,this.page_heights.length-this.pageCount),this.pageWidths.splice(this.pageCount,this.pageWidths.length-this.pageCount),this.outer_rects.splice(this.pageCount,this.outer_rects.length-this.pageCount)));var i=this.page_ycap,o=0;return this.page_heights.forEach((function(e){var t=e;if(o<n.pageCount){var a=n.page_ybetween;if(o in n._layout_pages){var r=n._layout_pages[o],s=r.outerRect.left,l=r.outerRect,u=l.right,c=l.bottom,h=l.top,d=Math.round(Object(p.Ti2Px)(u-s)),f=Math.round(Object(p.Ti2Px)(c-h));void 0===r.isVisible||r.isVisible||(f=0,a=0),s=Math.round(Object(p.Ti2Px)(s)),s=(n.width-d)/2,n.outer_rects[o]={left:Math.round(s),top:i,width:d,height:f}}else{n.data.doc.useCoreTypo?(t=0,a=0):n.layout_pages[o].outer_rect.updateByOrigin(null,i);var g=Math.round(n.pageWidths[o]),v=Math.round((n.width-g)/2);n.outer_rects[o]={left:v,width:g,top:i,height:t}}i+=t,i+=a,++o}})),this.lastAllPageHeight=this.allpage_height,this.allpage_height=i-this.page_ybetween+this.page_ycap,this.outer_rects_is_dirty=!1,this.outer_rects}},{key:"_intersects",value:function(e,t,n,i){return!(e>i||n>t)}},{key:"_scaleValue",value:function(e){return e*P.a.getZoom()}},{key:"getPageByView",value:function(e){var t=e.top,n=e.bottom,i=[],o=this.calcRects(),a=o.length;if(0===a)return{from:0,to:0};for(var r=0;r<a;r++){var s=o[r];this._intersects(t,n,s.top,s.top+s.height)&&i.push(r)}if(0===i.length)return!1;var l=i[0],u=i[i.length-1],c=o[l],h=o[u];return c.top>t&&l>0&&i.unshift(l-1),h.top+h.height<n&&u<this.view.pageCount&&i.push(u+1),{from:i[0],to:i[i.length-1]}}},{key:"updateStablePageInfo",value:function(){this._stableAllPageHeight=this.allpage_height,this._stablePageCount=Math.max(this._stablePageCount,this.pageCount)}},{key:"getLeftInfo",value:function(e){var t=this.data.typoinfo.getLayoutPageCache(e);return{outerLeft:t.outer_rect.left,innerLeft:t.inner_rect.left}}},{key:"isPageOverMainRange",value:function(e){if(e>=this.pagePos.length)return!1;var t=this.pagePos[e],n=this.data.doc.concernRanges.length,i=this.data.doc.concernRanges[n-1];return t.beginPos+1===i.pos}},{key:"getLayoutPageCache",value:function(e){if(e>=this.pageCount&&e>=this.layout_pages.length||e<0)return null;if(this.data.doc.useCoreTypo&&!this.layout_pages[e-1]&&this.getLayoutPageCache(e-1),!this.layout_pages[e]){if(this._layout_pages[e]){var t=this._layout_pages[e];this.layout_pages[e]=new g.a(this,this.compose,{layoutPage:t})}else{var n=this.outer_rects[e],i=n.left+n.width,o=n.top+n.height,a=_.a.initByRawRect({left:n.left,top:n.top,right:i,bottom:o}),r=this.pagePos[e];this.layout_pages[e]=new m.a(this,this.compose,e,a,r.beginPos,r.endPos)}this._handleViewData(e)}return this.layout_pages[e]}},{key:"getPrevVisibleLayoutPageCache",value:function(e){for(var t=e-1;t>=0;){var n=this.getLayoutPageCache(t);if(n&&n.isVisible)return n;--t}return null}},{key:"queryRangeForPage",value:function(e,t){var n=this.data.api.sender.updateVersion,i=e,o=t;if(null==i||null==o){if(!(o>=this.pageCount-2&&(this.curVersion<n||!this.isTypoEnd)))return;i=o}o=Math.min(o,i+10);var a=parseInt((i+o)/2),r=parseInt((10-(o-i))/2);o+=r;var s=0,l=0;if((i=i-r<0?0:i-r)>=this.pageCount){s=this.getLayoutPageCache(this.pageCount-1).range.pos,l+=2e3}else{var u=this.getLayoutPageCache(i);if(!u)return;if(!u.range){var c=this.data.doc;if(c.endnotes&&!c.endnotes.rangeClass.tree.empty()){var h=c.getSubDocRange(I.Endnote);this.data.api.queryRange({gcpCurrent:h.pos,length:h.len})}if(c.footnotes&&!c.footnotes.rangeClass.tree.empty()){var d=c.getSubDocRange(I.Footnote);this.data.api.queryRange({gcpCurrent:d.pos,length:d.len})}return}if(s=u.range.pos,o>=this.pageCount&&(o=this.pageCount-1),o<a+4&&(this.curVersion<n||!this.isTypoEnd)){var p=this.getLayoutPageCache(a);l=p.range.pos+p.range.len+2e3}else{var f=this.getLayoutPageCache(o);l=f.range.pos+f.range.len}this.data.api.queryRange({gcpCurrent:s,length:l-s})}}},{key:"_handleViewData",value:function(e){var t=this.layout_pages[e];if(!t)throw new Error("Layoutpage Not Created!");var n=t.outer_rect,i=n.left,o=n.right,a=Math.round(o-i),r=Math.round((this.width-a)/2)-i;t.outer_rect.offset(r,0)}},{key:"onViewportChanged",value:function(){this._dispatch("onViewportChanged")}},{key:"onContainerChanged",value:function(){this._dispatch("onContainerChanged")}},{key:"onPosChanged",value:function(e){this._dispatch("onPosChanged",e)}},{key:"updateComponent",value:function(e,t){var n=t.pageNo,i=t.pos;S.default.dispatchEvent(S.default.names.DOC_TYPO_FINISHED),this.data.doc.reviewMgr.updateComponent(this.data,e,{pageNo:n,pos:i}),this.data.doc.reviewMgr.dispatchCommentsDataEvent()}},{key:"getPosition",value:function(e,t){return new v.a(this.data.selection,e,t)}},{key:"isView",value:function(){return!0}},{key:"isHost",value:function(){return!0}},{key:"findSelLayoutPageInfos",value:function(e,t,n,i){for(var o={isSupportSnippetLine:!0},a=[],r=e,s=t,l=r;l<=s;++l){var u=this.getLayoutPageCache(l);if(u.isMoc)return;var c=u.findSelMainPageInfos(n,i,!1,o);if(c.length<=0)return;a=a.concat(c)}for(var h={beginRs:y.a.getLayoutSelCellInfo(a,!0),endRs:y.a.getLayoutSelCellInfo(a,!1)},d=this.getLayoutPageCache(r);!(d.mainpages[0]!==a[0].textPage||r<=0||(--r,(d=this.getLayoutPageCache(r)).isMoc));){var p=d.findSelMainPageInfos(n,i,!0,o);if(p.length<=0)break;a=p.concat(a)}for(d=this.getLayoutPageCache(s);!(d.mainpages[d.mainpages.length-1]!==a[a.length-1].textPage||++s>=this.pageCount||(d=this.getLayoutPageCache(s)).isMoc);){var f=d.findSelMainPageInfos(n,i,!1,o);if(f.length<=0)break;a=a.concat(f)}return h.mainPageInfos=a,h}},{key:"dealCellRangeReverse",value:function(e,t,n){if(t)if(1!==e.length||n)e.reverse();else{var i=[e[0].end,e[0].begin];e[0].begin=i[0],e[0].end=i[1]}else if(1===e.length&&n){var o=[e[0].end,e[0].begin];e[0].begin=o[0],e[0].end=o[1]}}},{key:"getSelCellRanges",value:function(e,t,n,i,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=e.line.isSubLine?e.line.parent:e.line,s=t.line.isSubLine?t.line.parent:t.line;if(void 0!==r&&void 0!==s&&void 0!==r.range&&void 0!==s.range&&void 0===r.tablecells&&void 0===s.tablecells){var l=r.parent,u=s.parent;if(void 0!==l&&void 0!==u){if(l===u)return a?"sameCell":void 0;var c=l,h=u;if(l=l.parent,u=u.parent,void 0!==l&&void 0!==u){if(e.layoutIndex===t.layoutIndex){if(o){var p=l;l=u,u=p}for(var f=[],g=[],v=[];l.layoutType===d.DOCLayoutType.Cell;)g.splice(0,0,l),l=l.parent,v.splice(0,0,l),l=l.parent,f.splice(0,0,l),l=l.parent;for(var m=[],_=[],b=[];u.layoutType===d.DOCLayoutType.Cell;)_.splice(0,0,u),u=u.parent,b.splice(0,0,u),u=u.parent,m.splice(0,0,u),u=u.parent;if(f.length<=0||m.length<=0)return void console.log("大哥，错了！");if(f[0]===m[0]){for(var T=0,C=f.length,k=m.length;T<C&&T<k&&f[T]===m[T];)++T;var w=f[--T];if(w.layoutType!==d.DOCLayoutType.CellPage&&w.layoutType!==d.DOCLayoutType.TextPage&&w.layoutType!==d.DOCLayoutType.MainPage)return void console.log("大哥，错了！");if(g[T]===_[T]){if(c!==h){var S=g[T].range;return o?{begin:S.pos+S.len,end:S.pos}:{begin:S.pos,end:S.pos+S.len}}return}if(void 0!==e.isInFooter||void 0!==e.isInTextbox){var P=[],I={rs:P};if(!w.getSelCellRanges(v[T],b[T],g[T],_[T],o,I))return;return y.a.dealResult(P,I.bReverseRg),this.dealCellRangeReverse(P,o,I.bReverseRg),P}}}var E=e.layoutIndex,O=t.layoutIndex;if(E>O){var x=O;O=E,E=x}var R=this.findSelLayoutPageInfos(E,O,n,i);if(void 0!==R){var N=[];if(y.a.getLayoutFirstLayerCellInfos(R.mainPageInfos,N),y.a.dealCellInfos(N)){var A=R.beginRs.isCellsReverse||R.endRs.isCellsReverse,D=o&&R.endRs.cellX>R.beginRs.cellX&&!A||o&&R.beginRs.cellX>R.endRs.cellX&&A||!o&&R.beginRs.cellX>R.endRs.cellX&&!A||!o&&R.endRs.cellX>R.beginRs.cellX&&A,M=Math.min(R.beginRs.cellX,R.endRs.cellX),L=Math.max(R.beginRs.cellX+R.beginRs.cellW,R.endRs.cellX+R.endRs.cellW),F=[];if(y.a.getLayoutSelCellRanges(R.mainPageInfos,M,L,D,F),!(F.length<=0))return y.a.dealResult(F,D),this.dealCellRangeReverse(F,o,D),F;console.log("大哥，错了！")}}}else console.log("大哥，错了！")}else console.log("大哥，错了！")}else console.log("大哥，错了！")}},{key:"attachPack",value:function(e){this.packRanges.attachNode(e.packRange)}},{key:"attachTextLine",value:function(e){e.range.isOrphan()&&this.textLineRanges.attachNode(e.range)}},{key:"attachTableLine",value:function(e){e.range.isOrphan()&&this.tableLineRanges.attachNode(e.range)}},{key:"attachFrameLine",value:function(e){e.range.isOrphan()&&this.frameLineRanges.attachNode(e.range)}},{key:"detachPack",value:function(e){e.packRange&&this.packRanges.detachNode(e.packRange)}},{key:"detachLine",value:function(e){switch(e.layoutType){case d.DOCLayoutType.TextLine:this.detachTextLine(e);break;case d.DOCLayoutType.TableLine:this.detachTableLine(e);break;case d.DOCLayoutType.SnippetLine:this.detachFrameLine(e)}}},{key:"detachTextLine",value:function(e){e.range.isOrphan()||this.textLineRanges.detachNode(e.range)}},{key:"detachTableLine",value:function(e){e.range.isOrphan()||this.tableLineRanges.detachNode(e.range)}},{key:"detachFrameLine",value:function(e){e.range.isOrphan()||this.frameLineRanges.detachNode(e.range)}},{key:"composeProcessLayout",value:function(e){(new C.c).composeLayoutPage(e)}},{key:"collectTextLines",value:function(e){var t=e.begin,n=e.end;return this.view.textLineRanges.mapInRange(t,n,(function(e){return e._node.line}),b.IT.strictIntersectTest)}},{key:"getCommentView",value:function(e){return this.commentView}},{key:"getCommentPage",value:function(e){return this.commentView.getCommentPage(e)}},{key:"shouldCachePageInfo",get:function(){return!0}},{key:"pageCount",get:function(){return this.data.doc.useCoreTypo?this._pageCount:this.layout_pages.length},set:function(e){this.data.doc.useCoreTypo&&(this._pageCount=e)}},{key:"rangeList",get:function(){console.error("textLineRanges instead")}},{key:"tableList",get:function(){console.error("tableLineRanges instead")}},{key:"position2parent",get:function(){return h.a.ZERO()}},{key:"padding",get:function(){return this._padding},set:function(e){e!==this._padding&&(this._padding=e)}},{key:"heightChanged",get:function(){return this.lastAllPageHeight!==this.allpage_height}},{key:"width",set:function(e){var t=this;this._width=Math.max(this.allpage_width+this._padding,e),this.outer_rects_is_dirty=!0,this.layout_pages.forEach((function(e,n){t._handleViewData(n)})),this.calcRects()},get:function(){return this._width}},{key:"height",get:function(){return this.data.doc.useCoreTypo?this.allpage_height:(this._isBeforeAllPageUpated||(this._stableAllPageHeight=Math.max(this._stableAllPageHeight,this.allpage_height)),this._stableAllPageHeight)}},{key:"stablePageCount",get:function(){return this.data.doc.useCoreTypo?this.pageCount:(this._isBeforeAllPageUpated||(this._stablePageCount=Math.max(this._stablePageCount,this.pageCount)),this._stablePageCount)}},{key:"layoutType",get:function(){return d.DOCLayoutType.TypoInfo}},{key:"view",get:function(){return this}},{key:"viewOffset",get:function(){return{x:0,y:0}}},{key:"environment",get:function(){return"pc"}}]),t}(d.DOCLayout);t.a=E},7762:function(e,t,n){e.exports=function(e,t){n.e(880).then(n.bind(null,10855)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7763:function(e,t,n){e.exports=function(e,t){n.e(892).then(n.bind(null,10851)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7764:function(e,t,n){e.exports=function(e,t){n.e(884).then(n.bind(null,10857)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7765:function(e,t,n){e.exports=function(e,t){n.e(879).then(n.bind(null,10900)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7766:function(e,t,n){e.exports=function(e,t){n.e(883).then(n.bind(null,10866)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7767:function(e,t,n){e.exports=function(e,t){n.e(885).then(n.bind(null,10880)).then((function(t){e&&e(t)})).catch((function(e){/loading.* chunk/i.test(e.message)&&window.badJsFunc(!0,e),console.error(e),t&&t(e)}))}},7768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.observeSizeChange=void 0;var i=n(5),o=n(167),a=i.__importDefault(n(260));t.observeSizeChange=function(e,t,n){return void 0!==n.ResizeObserver?r(e,t,n):"undefined"!=typeof MutationObserver?s(e,t):l(t)};var r=function(e,t,n){var i=new n.ResizeObserver(t);return i.observe(e),function(){i.disconnect(),i=null}},s=function(e,t){var n=new MutationObserver(t);return n.observe(e,{attributes:!0,attributeFilter:["style"],attributeOldValue:!1}),function(){n.disconnect()}},l=function(e){return e(null),o.isMobile?(window.addEventListener("resize",e),window.addEventListener("orientationchange",e)):(window.addEventListener("resize",e),window.addEventListener(a.default.revision.ON_HISTORY_REVISION_TOOL_SHOW,e),window.addEventListener(a.default.taskPane.ON_TASK_PANE_VISIBLE,e)),function(){o.isMobile?(window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)):(window.removeEventListener("resize",e),window.removeEventListener(a.default.revision.ON_HISTORY_REVISION_TOOL_SHOW,e),window.removeEventListener(a.default.taskPane.ON_TASK_PANE_VISIBLE,e))}}},7769:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(260),l=n(805),u=n(167),c=function(){function e(t,n,i){o()(this,e),this._mobileOffsetTop=0,this.app=t,this.container=n,this.input=document.createElement("input"),this._style={},this.setupInput(),this.container.appendChild(this.input),this.relation=i}return r()(e,[{key:"init",value:function(e){this.relation=e}},{key:"clearAll",value:function(){}},{key:"setupInput",value:function(){var e={width:"100px",height:"30px",position:"absolute",left:"-200px",top:"0px",outline:"none","z-index":"-1"};this._extendInputStyle(e),this.input.classList.add("virtual-input"),this.input.classList.add("alt-excluded"),this.input.classList.add("no-public-autofocus"),Object(l.assignStyle)(this.input,this._style,e),u.isAndroid&&(this.input.enterKeyHint="enter")}},{key:"resetInput",value:function(){var e=this._getInputTop();Object(l.assignStyle)(this.input,this._style,{left:"-100px",top:e+"px"})}},{key:"_updateCalculateTop",value:function(e){var t=this.app.workspace.config.zoom,n=e.charPosY*t;return this.app.data.selection.isComposing?n=(e.posY+e.line.baseline)*t:n}},{key:"_updateCalculateLeft",value:function(e){if(!this.relation)return-100;var t=this.app.workspace.config.zoom,n=this.relation.getRelationRect(),i=e.posX*t;return i>n.right*t&&(i=n.right*t-5),i}},{key:"update",value:function(e){var t=e.pos;return t?{pos:t}:(this.resetInput(),null)}},{key:"save",value:function(e){if(e&&!e.isInComment){var t=e.pos,n=0;t&&(n=t.posY);try{var i=this.app.workspace.element;this._currentInputInfo={yToTop:n-i.cacheDOMAttr.scrollTop}}catch(e){}}}},{key:"restore",value:function(e){if(e&&!e.isInComment&&this._currentInputInfo){try{var t=e.pos,n=0;t&&(n=t.posY),this.app.workspace.scrollTo({scrollTop:n-this._currentInputInfo.yToTop})}catch(e){}this._currentInputInfo=null}}},{key:"focus",value:function(){}},{key:"blur",value:function(){this.input.blur()}},{key:"addEventListener",value:function(e,t){this.input.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.input.removeEventListener(e,t)}},{key:"value",get:function(){return this.input.value},set:function(e){this.input.value!==e&&(this.input.value=e,s.default.dispatchEvent(s.default.input.ON_INPUT_VALUE_CHANGED))}},{key:"element",get:function(){return this.input}}]),e}();t.a=c},7770:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=i.__importDefault(n(260)),a=i.__importStar(n(3479)),r=i.__importDefault(n(7771)),s=i.__importDefault(n(6126)),l=function(){function e(){this._isInRestrictEdit=null,this._restrictEditMode=a.txDocProtNone,this.commentOnlyProtection=new r.default,this.readonlyProtection=new s.default}return Object.defineProperty(e.prototype,"isInRestrictEditMode",{get:function(){return this._isInRestrictEdit&&this.restrictType===a.txDocProtForm},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInReadonlyProtectMode",{get:function(){return this.isRestrictProtectOn&&this.restrictType===a.txDocProtReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInRevisionProtectMode",{get:function(){return this.isRestrictProtectOn&&this.restrictType===a.txDocProtRevisions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInCommentProtectMode",{get:function(){return this.isRestrictProtectOn&&this.restrictType===a.txDocProtComment},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRestrictProtectOn",{get:function(){return this._isInRestrictEdit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"restrictState",{get:function(){return{isRestrictProtectOn:this.isRestrictProtectOn,restrictType:this.restrictType}},set:function(e){var t=e.isRestrictProtectOn,n=e.restrictType,i=this.isInRestrictEditMode,a=this.isInReadonlyProtectMode;this._isInRestrictEdit=t,this._restrictEditMode=n;var r=!!i!==this.isInRestrictEditMode,s=a!==this.isInReadonlyProtectMode;r&&o.default.dispatchEvent(o.default.restrictEdit.ON_RESTRICT_STATE_CHANGE,{isRestrict:this.isInRestrictEditMode}),this.isInRestrictEditMode&&window.APP.uilManager&&window.APP.uilManager.uiHandler.handleFocusEvent(!1),(s||r&&window.__CONFIG__.wps.highlightControlAreas)&&window.APP.workspace.refreshForcedly()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"restrictType",{get:function(){return this._restrictEditMode},enumerable:!1,configurable:!0}),e.prototype.queryDocProtectState=function(){var e=this;return new Promise((function(t,n){window.APP.api.queryCommandQueue("protectState",null,(function(i){var o=i.success,a=i.result;o?(e.restrictState={isRestrictProtectOn:a.protectOn,restrictType:a.protectType},t(a)):n("promise reject: query doc protect state: error")}))}))},e.prototype.protectDoc=function(e){var t=this;return new Promise((function(n,i){window.g_rpt.lockCurVersion(),window.g_rpt.lockCurrentUndoSteps(),window.APP.editor.cmdExecutor.sendCommandBlock({name:"protectDoc",param:{passwd:e}},(function(e){e.success?(t.restrictState={isRestrictProtectOn:!0,restrictType:a.txDocProtForm},n()):i("promise reject: protect doc: command block error")}))}))},e.prototype.unProtectDoc=function(e){var t=this;return new Promise((function(n,i){window.g_rpt.lockCurVersion(),window.g_rpt.lockCurrentUndoSteps(),window.APP.editor.cmdExecutor.sendCommandBlock({name:"unprotectDoc",param:{passwd:e}},(function(e){e.success?(t.restrictState={isRestrictProtectOn:!1,restrictType:a.txDocProtNone},n()):i("promise reject: unprotect doc: command block error")}))}))},e.prototype.checkIsInTextFormField=function(e){var t=window.APP.data.fieldManager,n=t.getField(e);return null==n&&(n=t.getField(e-1)),!(!n||"FORMTEXT"!==n.getType())},e.prototype.checkCanSelection=function(e){var t=e instanceof Object?e.position:"number"==typeof e?e:null;return!this.isInRestrictEditMode||!(0!==t&&!t)&&(!!this.checkIsInTextFormField(t)||window.APP.formatContentController.checkIsInContentControl(t))},e.prototype.checkCanModify=function(e){if(!this.checkCanSelection(e))return!1;if(!this.isInRestrictEditMode)return!0;if(this.checkIsInTextFormField(e))return!0;var t=window.APP.formatContentController;if(!t.checkIsInContentControl(e))return!1;var n=t.getOuterMostControl(e),i=t.getControllerBeginPos(n,!0),o=t.getControllerEndPos(n,!0);return i!==e&&o!==e},e.prototype.setRestrictState=function(e,t){this._isInRestrictEdit===e&&this._restrictEditMode===t||(this.restrictState={isRestrictProtectOn:e,restrictType:t})},e.prototype.setContentControlACL=function(e){var t={};this._contentControlACL={default:e.default_access||"edit",map:t},e.acl&&e.acl.forEach((function(e){t[e.tag]=e.access})),window.APP.data.glyphpool.initContentControlPlaceholderHiddenLoader(),window.APP.fontServer._onFontUpdate(window.APP.data.doc.concernRanges),window.APP.workspace.refreshForcedly(),window.APP.view.formatContentController.showAllBorderOfContentControls()},e.prototype.allowEditContentControlByTag=function(e){if(this._contentControlACL){var t=this._contentControlACL.map[e];return t?"edit"===t:"edit"===this._contentControlACL.default}return!0},e.prototype.checkIsRangeNonEditable=function(e){var t=this.readonlyProtection.getRelatedExceptions([e]);return this.readonlyProtection.isRangeNonEditable(e,t)||this.commentOnlyProtection.isRangeNonEditable(e,t)},e.prototype.checkIsAnyRangeNonEditable=function(e){return this.readonlyProtection.isAnyRangeNonEditable(e)||this.commentOnlyProtection.isAnyRangeNonEditable(e)},e.prototype.checkIsAnyPapxNonEditable=function(){return this.readonlyProtection.isAnyPapxNonEditable()||this.commentOnlyProtection.isAnyPapxNonEditable()},e.prototype.checkIsAllRangeNonEditable=function(e){return this.readonlyProtection.isAllRangesNonEditable(e)||this.commentOnlyProtection.isAllRangesNonEditable(e)},e}();t.default=l},7771:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return window.APP.restrictEditHandler.isInCommentProtectMode},enumerable:!1,configurable:!0}),t}(i.__importDefault(n(6126)).default);t.default=o},7772:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(260),l=n(984),u=n(4973),c=n(1238),h=n(14),d=n(1737),p=u.b.charCodeAt(0),f=u.a.charCodeAt(0),g=function(){function e(t){o()(this,e),this.isOpen=!1,this.app=t,this._debounceSelectionChanged=window.utils.Lodash.debounce(this._onSelectionChanged.bind(this),50)}return r()(e,[{key:"clearAll",value:function(){this.closeListener()}},{key:"onDocPanelLoad",value:function(){var e=l.getStatus(l.types.DOCMAP,!0);this._docmap=this.app.data.doc.getDocmap(this.app.api);var t=this._docmap.fetchInitItems();!1===(Array.isArray(t)&&t.length>0)?s.default.dispatchEvent(s.default.docmap.HIDE):null!==e&&!0!==e||(s.default.dispatchEvent(s.default.docmap.SHOW),window.collection("experience",{event:"reading_allcontents",times:Math.round(window.performance.now())}))}},{key:"open",value:function(e){e&&this._onItemInit(!0),l.setStatus(l.types.DOCMAP,!0,!0),this._onSelectionChanged(),window.addEventListener(s.default.names.DOC_SELECTION_CHANGED,this._debounceSelectionChanged),window.addEventListener(s.default.names.DOC_WORKSPACE_SCROLL,this._debounceSelectionChanged),s.default.dispatchEvent(s.default.docmap.ON_PANEL_OPEN),this.isOpen=!0}},{key:"openListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._docmap=this.app.data.doc.getDocmap(this.app.api),this._docmap.attachObserver(this),this._autonum=this.app.data.autonum,this._autonum.attachObserver(this);var t=Object(h.getBoolQuery)("hidePanel");e||!window.__CONFIG__.wps.isAutoShowDocMap||t||(this._onItemInit(),this.onDocPanelLoad())}},{key:"close",value:function(){l.setStatus(l.types.DOCMAP,void 0,!0),window.removeEventListener(s.default.names.DOC_SELECTION_CHANGED,this._debounceSelectionChanged),window.removeEventListener(s.default.names.DOC_WORKSPACE_SCROLL,this._debounceSelectionChanged),s.default.dispatchEvent(s.default.docmap.ON_PANEL_CLOSE),this.isOpen=!1}},{key:"closeListener",value:function(){this._docmap&&(this._docmap.detachObserver(this),this._docmap=null),this._autonum&&(this._autonum.detachObserver(this),this._autonum=null),this._items=[],this.stopRequest()}},{key:"jump",value:function(e,t){var n=this,i=this.app.data.selection;Object(c.typoToPositionWithLoading)(this._items[e].pos+(t||0)).then((function(){var o=n._items[e].pos+(t||0);i.selCoop.locate(o,o).then((function(){window.APP.data.selection.selCoop.showDefaultHighLight({len:n._items[e].len,pos:n._items[e].pos})}))}),(function(){}))}},{key:"mobileJump",value:function(e,t){var n=this,i=this.app.data.selection;Object(c.typoToPositionWithLoading)(this._items[e].pos+(t||0)).then((function(){var o=n._items[e].pos+(t||0),a=new d.a(i,o,!1).pos;i.selCoop.locate(o,{moveTop:!0}).then((function(){var t=new d.a(i,o,!1).pos,r=n.app.workspace,s=!1;try{var l=t.charPosY*r.config.zoom-10;(a.charPosY!==t.charPosY||r.scrollTop<l)&&(s=!0)}catch(e){s=!0}s&&r.scrollToPos(t,"moveTop"),window.APP.data.selection.selCoop.showDefaultHighLight({len:n._items[e].len,pos:n._items[e].pos})}))}))}},{key:"_startRequest",value:function(){this.processInvalidRanges(),this.startRequest()}},{key:"startRequest",value:function(){var e=this,t=window.APP.scheduler,n=t.PRIORITY,i=t.taskName.documentMapRequest,o=n.ImmediatePriority;this.hasInvalidRanges&&t.scheduleCallback(o,{callback:function(){return e._startRequest()},name:i,resetEvents:["keydown","mousedown"]})}},{key:"stopRequest",value:function(){var e=window.APP.scheduler,t=e.taskName.documentMapRequest;e.clearTask(t)}},{key:"processInvalidRanges",value:function(){this.hasInvalidRanges?this._docmap.processInvalidRanges():this.stopRequest()}},{key:"_getItem",value:function(e){var t=this._docmap.getItemText(e.begin,e.end),n=t.text,i=t.textPos;return{level:e.level,text:n,textPos:i,listString:this._getListString(e),fontName:e.fontName}}},{key:"_isTaskListString",value:function(e){return e&&1===e.length&&(e[0].charCodeAt(0)===p||e[0].charCodeAt(0)===f)}},{key:"_getListString",value:function(e){var t=this._isTaskListString(e.listString)?"":e.listString;if(!t){var n=this.app.data.autonum.getAutoNumNodeByPos(e.pos);t=n&&n.text?" ":null}return t}},{key:"_onItemInit",value:function(e){var t=this;if(this._items&&!0!==e)return!1;this._items=this._docmap.fetchInitItems();var n=this._items.map((function(e){return t._getItem(e)}));s.default.dispatchEvent(s.default.docmap.INIT,{items:n}),this._onSelectionChanged(),this.startRequest()}},{key:"_onInserted",value:function(e,t){this._items||this._onItemInit(),this._items.splice(e,0,t),s.default.dispatchEvent(s.default.docmap.INSERTED,{index:e,item:this._getItem(t),items:this._items})}},{key:"_onDeleted",value:function(e,t){var n=e;if(this._items||this._onItemInit(),this._items[n]!==t)for(;n-1>=0&&this._items[n-1]!==t;)--n;n>=0&&(this._items.splice(n,1),s.default.dispatchEvent(s.default.docmap.DELETED,{index:n,items:this._items}))}},{key:"_onModified",value:function(e,t){this._items||this._onItemInit(),this._items.splice(e,1,t),s.default.dispatchEvent(s.default.docmap.MODIFIED,{index:e,item:this._getItem(t)})}},{key:"_onAutoNumChanged",value:function(e,t){s.default.dispatchEvent(s.default.docmap.AUTONUM_CHANGED,{index:e,listString:this._getListString(t),fontName:t.fontName})}},{key:"_onSelectionChanged",value:function(e){var t=this.app.data.selection.getNormalRange().pos;if(e&&e.type===s.default.names.DOC_WORKSPACE_SCROLL){if(e.detail.passive)return;var n=window.APP.uilManager.getPosByEvent({pageX:0,pageY:this.app.workspace.element.cacheDOMAttr.rect.top+150});if(!n)return;t=window.APP.uilManager.getGCPByViewPos(n.x,n.y)}if(!(t>=this.app.data.doc.getMainTextLength())){var i=0;for(this._items||this._onItemInit();i<this._items.length&&!(this._items[i].pos>t);++i);--i;var o=e&&e.detail&&e.detail.fromServer;s.default.dispatchEvent(s.default.docmap.SELECTED,{index:i,beFolded:o})}}},{key:"onItemInsert",value:function(e,t,n){this._onInserted(t,n)}},{key:"onItemDelete",value:function(e,t,n){this._onDeleted(t,n)}},{key:"onItemChanged",value:function(e,t,n){this._onModified(t,n)}},{key:"onItemAutoNumChanged",value:function(e,t,n){this._onAutoNumChanged(t,n)}},{key:"_onDataUpdate",value:function(){this.app.data.api.hasBlocking()||(this.processInvalidRanges(),this.startRequest())}},{key:"onDataUpdate",value:function(){var e=this,t=window.APP.scheduler,n=t.PRIORITY,i=t.taskName.documentMapRequest,o=n.ImmediatePriority;t.scheduleCallback(o,{callback:function(){return e._onDataUpdate()},name:i,resetEvents:["keydown","mousedown"]})}},{key:"getDocMapWidth",value:function(){return 240}},{key:"hasItems",value:function(){return Array.isArray(this._items)&&this._items.length>0}},{key:"onAutoNumChanged",value:function(e,t){var n=this.app.data.doc.getDataLogic("final").getPapx(t).prop.getPropVal("list_id"),i=this._docmap.mapListId2Items[n];i&&(i.minBegin=Math.min(i.minBegin?i.minBegin:1/0,t))}},{key:"hasInvalidRanges",get:function(){return this._docmap&&this._docmap.hasInvalidRanges()}}]),e}();t.a=g},805:function(e,t,n){"use strict";n.r(t),n.d(t,"cleanUnknowProperties",(function(){return i})),n.d(t,"deepCopyer",(function(){return o})),n.d(t,"bSearchUpperBound",(function(){return a})),n.d(t,"assignStyle",(function(){return r})),n.d(t,"runOnce",(function(){return s})),n.d(t,"r2n",(function(){return l})),n.d(t,"n2r",(function(){return u})),n.d(t,"focusOnOtherInput",(function(){return h})),n.d(t,"addShadowRoot",(function(){return d}));var i=function(e){for(var t=Object.getOwnPropertyNames(e),n=0;n<t.length;n++){var i=t[n];(null===e[i]||void 0===e[i]||"number"==typeof e[i]&&isNaN(e[i]))&&delete e[i]}return e},o=function(e){return JSON.parse(JSON.stringify(e))},a=function(e,t,n,i,o){var a=n,r=t;if(r>a||i>e[a])return-1;for(var s=Math.floor((r+a)/2);r<a;)o(s,e,i)?a=s:r=s+1,s=Math.floor((r+a)/2);return s},r=function(e,t,n){t&&Object.assign(t,n);var i="";for(var o in t)i+=o+": "+t[o]+"; ";e.setAttribute("style",i)},s=function(e,t){var n=e;return function(){try{n&&n.apply(t||this,arguments)}catch(e){}finally{n=null}}},l=function(e){return e.replace(/(\r\n)|(\r)/g,"\n")},u=function(e){return e.replace(/(\r\n)|(\n)/g,"\r")},c=null,h=function(){c||((c=document.createElement("input")).classList.add("fake-pad-input"),r(c,{},{position:"fixed",top:0,left:0,opacity:0,"z-index":"-100"}),document.body.appendChild(c)),c.focus()},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"closed";if(e.attachShadow&&window.__CONFIG__.wps.enabledShadowDomForSvgRender){var n=e.attachShadow({mode:t});return n}return null}},811:function(e,t,n){"use strict";n.d(t,"k",(function(){return P})),n.d(t,"f",(function(){return I})),n.d(t,"b",(function(){return x})),n.d(t,"d",(function(){return R})),n.d(t,"g",(function(){return A})),n.d(t,"h",(function(){return D})),n.d(t,"i",(function(){return L})),n.d(t,"j",(function(){return F})),n.d(t,"e",(function(){return W})),n.d(t,"a",(function(){return V})),n.d(t,"c",(function(){return Y}));var i=n(22),o=n.n(i),a=n(23),r=n.n(a),s=n(8),l=n.n(s),u=n(1),c=n.n(u),h=n(2),d=n.n(h),p=n(24),f=n.n(p),g=n(3855),v=n(6097),m=n(1403),_=n(1251),y=n(1590),b=n(1731),T=n(4575),C=n(6098),k=n(7201),w=n(336),S=n(805);function P(e,t){if(e===t)return!0;if(!e||!t)return!1;var n=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);return n.length===i.length&&n.every((function(n){if("parent"===n)return!0;if("def"===n){if(e[n]!==t[n])return!1}else{if("object"===f()(e[n])&&Object.prototype.toString.call(e[n])===Object.prototype.toString.call(t[n]))return!!P(e[n],t[n]);if(e[n]!==t[n])return!1}return!0}))}var I=function(){function e(t){c()(this,e),this.naked_stylesheet=t,t.on(this._onStyleSheetChanged.bind(this)),this._default={chpx:new V,papx:new Y},this._init()}return d()(e,[{key:"findStyle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e!==b.m)for(var n in this._stylesheet){var i=this._stylesheet[n];if(e<b.l&&i.id===e)return i;if(e===b.q&&t===i.name)return i}}},{key:"applyStyle",value:function(e,t){for(var n in this._stylesheet){var i=this._stylesheet[n];if(i.id===e){i.apply!==t&&(i.apply=t);break}}}},{key:"_getStylesheet",value:function(){for(var e={},t=this.naked_stylesheet.private.length,n=0;n<t;n++){var i=this.naked_stylesheet.private[n],o=i.getName();i.on(this._onStyleChanged.bind(this)),e[o]=this.buildStyle(i)}return e}},{key:"filterStyle",value:function(e){if(e.getId()===b.p){var t=e.private.props.chpx;void 0!==t.fontNameAscii&&delete t.fontNameAscii,void 0!==t.fontNameComplex&&delete t.fontNameComplex,void 0!==t.fontNameAsiaEast&&delete t.fontNameAsiaEast,void 0!==t.fontNameFtcbi&&delete t.fontNameFtcbi}}},{key:"buildStyle",value:function(e){if(void 0!==e){this.filterStyle(e);var t=e.getProps(),n=t.chpx,i=t.papx,o=(new V).initFromServer(n),a=(new Y).initFromServer(i),r=void 0!==e.getLinkStyle?e.getLinkStyle():void 0;return{id:e.getId(),name:e.getName(),apply:e.getApply(),nextstyle:new O(e.getNextStyle()).basestyle,linkStyle:r,properties:{chpx:o,papx:a}}}}},{key:"defaultChpx",value:function(e){var t={};t[_i18n("applications.writer.components.CommandBars.ContextMenu.HyperLink.hyperLink", "Hyperlink")]={font_color:"#0000ff",underline:1,underline_type:1};var n=new V;return e&&t[e]&&n.setProps(t[e]),n}},{key:"getStyle",value:function(e){if(!e)return this._default;var t=e,n=t.name;if(!this.stylesheet[n]){var i=void 0,o=[];for(i=this._stylesheet[n];i;i=t&&this._stylesheet[t.name]){var a=i.properties,r=a.chpx,s=a.papx;o.unshift({chpx:r,papx:s}),t=s.basestyle}var l=this.defaultChpx(n),u=new Y;o.forEach((function(e){e.chpx&&l.setProps(e.chpx),e.papx&&u.setProps(e.papx)})),this.stylesheet[n]={chpx:l,papx:u};var c=u.out_line_level;c>=0&&c<9&&(this.stylesheet.findStyle(c+1).apply=!0)}return this.stylesheet[n]}},{key:"getStyleByProp",value:function(e){return this.getStyle(null!=e?e.basestyle:null)}},{key:"getPrimeStyle",value:function(e){var t=this._stylesheet[e.name];return t?t.properties:void 0}},{key:"getNextStyle",value:function(e){if(e){var t=this._stylesheet[e.name];return t?t.nextstyle:void 0}}},{key:"_onStyleChanged",value:function(e){null!=e&&(this._stylesheet[e.getName()]=this.buildStyle(e),this.stylesheet[e.getName()]=null,window.APP.data.doc.getDataLogic("prime").onStyleChanged(e))}},{key:"_init",value:function(){this._stylesheet=this._getStylesheet(),this.stylesheet={},this.stylesheet.applyStyle=this.applyStyle.bind(this),this.stylesheet.getStyle=this.getStyle.bind(this),this.stylesheet.getStyleByProp=this.getStyleByProp.bind(this),this.stylesheet.findStyle=this.findStyle.bind(this),this.stylesheet.getPrimeStyle=this.getPrimeStyle.bind(this),this.stylesheet.getNextStyle=this.getNextStyle.bind(this)}},{key:"_onStyleSheetChanged",value:function(e){this._init()}}]),e}();function E(e){var t=void 0;if(e.user)if("number"==typeof e.user){t=4294967294===e.user?"":e.user.toString()}else t=e.user;return{user:t,userID:e.userId,accountId:e.accountId,providerId:e.providerId}}var O=function(){function e(t){c()(this,e),this.naked_basestyle=t}return d()(e,[{key:"basestyle",get:function(){if(void 0!==this.naked_basestyle&&null!=this.naked_basestyle)return{id:this.naked_basestyle.id,name:this.naked_basestyle.name}}}]),e}(),x=function(){function e(t){c()(this,e),this.delete=this.insert=this.format=this.historyBag=null,this.initFromServer(t)}return d()(e,[{key:"initFromServer",value:function(e){if(e){if(e.delete){var t=E(e.delete);this.delete={date:e.delete.date,user:t.user,userID:t.accountId}}if(e.insert){var n=E(e.insert);this.insert={date:e.insert.date,user:n.user,userID:n.accountId}}if(e.format){this.historyBag=(new V).initFromServer(e.format.historyBag),delete this.historyBag.revision;var i=E(e.format);this.format={date:e.format.date,user:i.user,userID:i.accountId,historyBag:this.historyBag}}}}},{key:"revision",get:function(){return this.delete||this.insert||this.format?{delete:this.delete,insert:this.insert,format:this.format}:null}}]),e}(),R=function(){function e(t){c()(this,e),this.paraFormat=null,this.historyBag=null,this.orignalList=null,this.initFromServer(t)}return d()(e,[{key:"initFromServer",value:function(e){if(e){var t=e.revision;if(t){var n=t.papx;if(!n){var i=e.listId;i&&-1!==i&&(n=t.list)}if(n){this.historyBag=(new Y).initFromServer(n.historyBag);var o=E(n);this.paraFormat={date:n.date,user:o.user,userID:o.accountId,historyBag:this.historyBag},this.orignalList&&(this.paraFormat.orignalList=this.orignalList)}}}}},{key:"revision",get:function(){return this.paraFormat?{paraFormat:this.paraFormat}:null}}]),e}(),N=function(){function e(t){c()(this,e),this.frame=void 0,void 0!==t.picTextFrame&&this._initFromNakedFrame(t.picTextFrame),!this.frame&&t.tableRow&&this._initFromNakedTap(t.tableRow)}return d()(e,[{key:"_initFromNakedFrame",value:function(e){!1!==e?(this.frame=e,void 0!==e.horiSpace&&(this.frame.rightSpace=e.horiSpace),void 0!==e.vertSpace&&(this.frame.bottomSpace=e.vertSpace),void 0!==e.xAlign&&(this.frame.horiAlign=e.xAlign),void 0!==e.x&&(this.frame.horiPos=e.x),void 0===this.frame.yAlign&&null==this.frame.y||(this.frame.vertPos=e.yAlign||e.y),delete this.frame.xAlign,delete this.frame.yAlign,delete this.frame.x,delete this.frame.y,this.frame.overlap=!0):this.frame=null}},{key:"_initFromNakedTap",value:function(e){e.wrapInfo&&void 0!==e.wrapInfo.mode&&e.wrapInfo.mode!==_.f&&(this.frame={},this.frame.horiAnchor=e.wrapInfo.horiAnchor,this.frame.vertAnchor=e.wrapInfo.vertAnchor,this.frame.wrapMode=e.wrapInfo.mode,this.frame.horiSpace=e.leftFromText,this.frame.vertSpace=e.topFromText,this.frame.rightSpace=e.rightFromText,this.frame.bottomSpace=e.bottomFromText,this.frame.vertPos=e.tableYPos,void 0!==e.tableXPos&&(e.tableXPos===k.d||e.tableXPos>=k.f&&e.tableXPos<=k.e?this.frame.horiAlign=e.tableXPos:(this.frame.horiAlign=k.a,this.frame.horiPos=e.tableXPos)),this.frame.overlap=!e.overLap)}}]),e}(),A={revision:"",special:"",share_hint:"",language:"",east_asia_language:"",complex_language:"",symbol_fontname:"",symbol_char:""},D={drop_cap:"",nest_level:"",para_type:"",type:"",table_row:""},M=["alphabetic","top","middle","bottom","alphabetic"],L={Auto:0,Left:1,Center:2,Right:3,Adjustify:4,FullAdjustify:5,MiddleAdjustify:6,CenterAcross:7,HighAdjustify:8,LowAdjustify:9,ThaiFullAdjustify:10},F={Set:0,Clear:1,Cover:2,RawSet:3,RawCover:4},B={basestyle:null,share_hint:0,font_color:null,font_size_normal:200,font_size_cs:200,font_name_ascii:T.b.ascii,font_name_complex:T.b.cs,font_name_asia_east:T.b.ea,font_name_ftcbi:T.b.cs,bold:!1,italic:!1,underline:0,underline_type:0,underline_color:"#000000",strike:!1,double_strike:!1,emphasis_type:0,script_pos:0,vanish:!1,snap_to_grid:!0,spacing:0,special:!1,character_scale:100,position:0,kerning:null,border_type:0,border_color:"#000000",border_size:10,highlight_color:"#ffffff",shading_fill_color:null,shading_back_color:"#ffffff",shading_texture:0,symbol_fontname:0,symbol_char:0,outline:!1,shadow:!1,language:null,east_asia_language:"zh-CN",complex_language:0,asian_layout:null,fit_text:0,fit_text_id:0,caps:!1,small_caps:!1,emboss:!1,imprint:!1,bold_cs:!1,italic_cs:!1,right_to_left_text:!1,complex_script:!1,line_break_code:0,ligatures:0,number_form:0,number_spacing:0,o_math:0,o_math_script:0,o_math_align:0,o_math_break:0,contextual_alternates:0,revision:null,wo_user_id:0,p_tab_alignment:0,p_tab_leader:0,p_tab_relative_to:0},H={basestyle:null,drop_cap:null,line_spacing:null,para_margin_before:0,para_margin_after:0,para_margin_before_auto:!1,para_margin_after_auto:!1,para_lineunit_margin_before:0,para_lineunit_margin_after:0,horizontal_align_mode:0,bidi:!1,snap_to_grid:!0,tab_stops:null,auto_space_de:!0,auto_space_dn:!0,widow_control:!0,keep_next:!1,keep_lines:!1,page_break_before:!1,out_line_level:9,vertical_align_mode:0,sup_line_num:!1,sup_auto_hyphens:!0,word_wrap:!1,overflow_punct:!0,topline_punct:!1,kinsoku:!0,contextual_spacing:!1,adjust_right_indent:!0,shading_back_color:null,shading_fill_color:null,shading_texture:0,border_top:null,border_right:null,border_bottom:null,border_left:null,border_between:null,left_indent_chars:0,left_indent_abs:0,first_line_indent_chars:0,first_line_indent_abs:0,right_indent_chars:0,right_indent_abs:0,nest_level:0,list_level:0,list_id:-1,type:0,para_type:0,table_row:null,revision:null,text_frame:null},G={strike:"double_strike",double_strike:"strike",caps:"small_caps",small_caps:"caps"},W=function(){function e(){c()(this,e),this.mixMarks={}}return d()(e,[{key:"getPropSelf",value:function(e){return this[e]}},{key:"getProp",value:function(e){var t=this[e],n=!1;return void 0===t&&void 0!==(t=this.def[e])&&(n=!0),{val:t,def:n}}},{key:"getPropVal",value:function(e){var t=this[e];return void 0!==t?t:this.def[e]}},{key:"setProps",value:function(e,t){for(var n in e)if(void 0!==this.def[n]){if(t&&void 0!==t[n]&&"revision"!==n)continue;if("table_row"===n)if(this[n])for(var i in e[n])this[n][i]=e[n][i];else this[n]=e[n];else{this[n]=e[n];var o=G[n];void 0!==o&&e[n]&&this[o]&&delete this[o]}}}},{key:"copy",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var i in t)void 0!==this.def[i]&&void 0!==t[i]&&(n&&"object"===f()(t[i])?e[i]=Object(S.deepCopyer)(t[i]):e[i]=t[i])}},{key:"clearProps",value:function(e){for(var t in e)("table_row"!==t||e.hasOwnProperty("paraType"))&&void 0!==this.def[t]&&delete this[t]}},{key:"isEqualProp",value:function(e,t){return"object"===(void 0===e?"undefined":f()(e))?P(e,t):e===t}},{key:"intersect",value:function(e){var t=this,n=void 0,i=void 0;[].concat(l()(Object.keys(e)),l()(Object.keys(this))).forEach((function(o){"mixMarks"!==o&&(n=t[o],i=o in e?e:t.def,t.isEqualProp(n,i[o])||(delete t[o],t.mixMarks[o]=!0))}))}}]),e}(),j={baseStyle:function(e,t){t.basestyle=new O(e.baseStyle).basestyle},shareHint:function(e,t){t.share_hint=e.shareHint},fontColor:function(e,t){t.font_color=new m.a(e.fontColor).color},fontSizeNormal:function(e,t){t.font_size_normal=e.fontSizeNormal},fontSizeCs:function(e,t){t.font_size_cs=e.fontSizeCs},fontNameAscii:function(e,t){t.font_name_ascii=e.fontNameAscii},fontNameComplex:function(e,t){t.font_name_complex=e.fontNameComplex},fontNameAsiaEast:function(e,t){t.font_name_asia_east=e.fontNameAsiaEast},fontNameFtcbi:function(e,t){t.font_name_ftcbi=e.fontNameFtcbi},bold:function(e,t){t.bold=e.bold},italic:function(e,t){t.italic=e.italic},underline:function(e,t){t.underline=e.underline},underlineType:function(e,t){t.underline_type=function(e){switch(e){case 1:return y.wpsUnderlineSingle;case 0:return y.wpsUnderlineNone;case 3:return y.wpsUnderlineDouble;case 4:return y.wpsUnderlineDotted;case 6:return y.wpsUnderlineThick;case 7:return y.wpsUnderlineDash;case 9:return y.wpsUnderlineDotDash;case 10:return y.wpsUnderlineDotDotDash;case 11:return y.wpsUnderlineWavy;case 18:return y.wpsUnderlineWavyHeavy;case 12:return y.wpsUnderlineDottedHeavy;case 13:return y.wpsUnderlineDashHeavy;case 16:return y.wpsUnderlineDotDashHeavy;case 17:return y.wpsUnderlineDotDotDashHeavy;case 14:return y.wpsUnderlineDashLong;case 15:return y.wpsUnderlineDashLongHeavy;case 19:return y.wpsUnderlineWavyDouble}return e}(e.underlineType)},underlineColor:function(e,t){t.underline_color=new m.a(e.underlineColor).colorEx},strike:function(e,t){t.strike=e.strike},doubleStrike:function(e,t){t.double_strike=e.doubleStrike},emphasisType:function(e,t){t.emphasis_type=e.emphasisType},scriptPos:function(e,t){t.script_pos=e.scriptPos},vanish:function(e,t){t.vanish=e.vanish},snapToGrid:function(e,t){t.snap_to_grid=e.snapToGrid},special:function(e,t){t.special=e.special},spacing:function(e,t){t.spacing=e.spacing},characterScale:function(e,t){t.character_scale=e.characterScale},position:function(e,t){t.position=e.position},kerning:function(e,t){t.kerning=e.kerning},border:function(e,t){t.border=e.border},borderType:function(e,t){t.border_type=e.borderType},borderColor:function(e,t){t.border_color=new m.a(e.borderColor).color},borderSize:function(e,t){t.border_size=Math.round(Object(w.Ti2Px)(e.borderSize))},highlightColor:function(e,t){t.highlight_color=new m.a(e.highlightColor).colorEx},shadingFillColor:function(e,t){t.shading_fill_color=new m.a(e.shadingFillColor).color},shadingBackColor:function(e,t){t.shading_back_color=new m.a(e.shadingBackColor).color},shadingTexture:function(e,t){t.shading_texture=e.shadingTexture},symbolFontName:function(e,t){t.symbol_fontname=e.symbolFontName},symbolChar:function(e,t){t.symbol_char=e.symbolChar},outLine:function(e,t){t.outline=e.outLine},shadow:function(e,t){t.shadow=e.shadow},language:function(e,t){t.language=e.language},eastAsiaLanguage:function(e,t){t.east_asia_language=e.eastAsiaLanguage},complexLanguage:function(e,t){t.complex_language=e.complexLanguage},aisanLayout:function(e,t){t.asian_layout=e.aisanLayout},fitText:function(e,t){t.fit_text=e.fitText},fitTextId:function(e,t){t.fit_text_id=e.fitTextId},caps:function(e,t){t.caps=e.caps},smallCaps:function(e,t){t.small_caps=e.smallCaps},emboss:function(e,t){t.emboss=e.emboss},imprint:function(e,t){t.imprint=e.imprint},boldCs:function(e,t){t.bold_cs=e.boldCs},italicCs:function(e,t){t.italic_cs=e.italicCs},rightToLeftText:function(e,t){t.right_to_left_text=e.rightToLeftText},complexScript:function(e,t){t.complex_script=e.complexScript},clearType:function(e,t){t.line_break_code=e.clearType},ligatures:function(e,t){t.ligatures=e.ligatures},numberForm:function(e,t){t.number_form=e.numberForm},numberSpacing:function(e,t){t.number_spacing=e.numberSpacing},oMath:function(e,t){t.o_math=e.oMath},oMathScript:function(e,t){t.o_math_script=e.oMathScript},oMathAlign:function(e,t){t.o_math_align=e.oMathAlign},oMathBreak:function(e,t){t.o_math_break=e.oMathBreak},contextualAlternates:function(e,t){t.contextual_alternates=e.contextualAlternates},revision:function(e,t){t.revision=new x(e.revision).revision},woUserID:function(e,t){t.wo_user_id=e.woUserID},pTabAlignment:function(e,t){t.p_tab_alignment=e.pTabAlignment},pTabLeader:function(e,t){t.p_tab_leader=e.pTabLeader},pTabRelativeTo:function(e,t){t.p_tab_relative_to=e.pTabRelativeTo}},U={baseStyle:function(e,t){t.basestyle=new O(e.baseStyle).basestyle},dropCap:function(e,t){t.drop_cap=e.dropCap},lineSpacing:function(e,t){t.line_spacing=e.lineSpacing},paraMarginBefore:function(e,t){t.para_margin_before=e.paraMarginBefore},paraMarginBeforeAuto:function(e,t){t.para_margin_before_auto=e.paraMarginBeforeAuto},paraLineUnitMarginBefore:function(e,t){t.para_lineunit_margin_before=e.paraLineUnitMarginBefore},paraMarginAfter:function(e,t){t.para_margin_after=e.paraMarginAfter},paraMarginAfterAuto:function(e,t){t.para_margin_after_auto=e.paraMarginAfterAuto},paraLineUnitMarginAfter:function(e,t){t.para_lineunit_margin_after=e.paraLineUnitMarginAfter},alignMode:function(e,t){t.horizontal_align_mode=parseInt(e.alignMode)},bidi:function(e,t){t.bidi=e.bidi},snapToGrid:function(e,t){t.snap_to_grid=e.snapToGrid},tabStops:function(e,t){t.tab_stops=e.tabStops},autoSpaceDn:function(e,t){t.auto_space_dn=e.autoSpaceDn},autoSpaceDE:function(e,t){t.auto_space_de=e.autoSpaceDE},windowControl:function(e,t){t.widow_control=e.windowControl},keepNext:function(e,t){t.keep_next=e.keepNext},keepLines:function(e,t){t.keep_lines=e.keepLines},pageBreakBefore:function(e,t){t.page_break_before=e.pageBreakBefore},outLineLevel:function(e,t){t.out_line_level=e.outLineLevel},textAlign:function(e,t){t.vertical_align_mode=M[parseInt(e.textAlign)]},supLineNum:function(e,t){t.sup_line_num=e.supLineNum},supAutoHyphens:function(e,t){t.sup_auto_hyphens=e.supAutoHyphens},wordWrap:function(e,t){t.word_wrap=e.wordWrap},overflowPunct:function(e,t){t.overflow_punct=e.overflowPunct},topLinePunct:function(e,t){t.topline_punct=e.topLinePunct},kinsoku:function(e,t){t.kinsoku=e.kinsoku},contextualSpacing:function(e,t){t.contextual_spacing=e.contextualSpacing},adjustRightIndent:function(e,t){t.adjust_right_indent=e.adjustRightIndent},shadingFillColor:function(e,t){t.shading_fill_color=new m.a(e.shadingFillColor).color},shadingBackColor:function(e,t){t.shading_back_color=new m.a(e.shadingBackColor).color},shadingTexture:function(e,t){t.shading_texture=e.shadingTexture},borderTop:function(e,t){t.border_top=e.borderTop},borderLeft:function(e,t){t.border_left=e.borderLeft},borderBottom:function(e,t){t.border_bottom=e.borderBottom},borderRight:function(e,t){t.border_right=e.borderRight},borderBetween:function(e,t){t.border_between=e.borderBetween},leftIndentChars:function(e,t){t.left_indent_chars=e.leftIndentChars},leftIndentAbs:function(e,t){t.left_indent_abs=e.leftIndentAbs},firstLineIndentChars:function(e,t){t.first_line_indent_chars=e.firstLineIndentChars},firstLineIndentAbs:function(e,t){t.first_line_indent_abs=e.firstLineIndentAbs},rightIndentChars:function(e,t){t.right_indent_chars=e.rightIndentChars},rightIndentAbs:function(e,t){t.right_indent_abs=e.rightIndentAbs},listLevel:function(e,t){t.list_level=e.listLevel},listId:function(e,t){t.list_id=e.listId},nestLevel:function(e,t){t.nest_level=e.nestLevel},type:function(e,t){t.type=e.type},paraType:function(e,t){t.para_type=e.paraType},tableRow:function(e,t,n){t.table_row=n?Object(S.deepCopyer)(e.tableRow):e.tableRow},revision:function(e,t){t.revision=new R(e).revision}},V=function(e){function t(e){return c()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return r()(t,e),d()(t,[{key:"duplicate",value:function(){var e=new t;return this.copy(e,this),e}},{key:"initFromServer",value:function(e){if(e)for(var t in e)void 0!==e[t]&void 0!==j[t]&&j[t](e,this);return this}},{key:"clearAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e)for(var t in this)t in A||delete this[t];else for(var n in this)delete this[n]}},{key:"def",get:function(){return B}}]),t}(W),Y=function(e){function t(e){return c()(this,t),o()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return r()(t,e),d()(t,[{key:"duplicate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new t;return this.copy(n,this,e),n}},{key:"initFromServer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){for(var n in e)void 0!==e[n]&void 0!==U[n]&&U[n](e,this,t);(void 0!==e.picTextFrame||e.tableRow&&e.tableRow.wrapInfo)&&(this.text_frame=new N(e).frame)}return this}},{key:"getTabCapsInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getProp("tab_stops"),i=n.def,o=n.val,a=o&&o.stops;if(!i&&a instanceof Array){for(var r=void 0,s=void 0,l=void 0,u=void 0,c=void 0,h=0;h<a.length;++h){var d=a[h],p=d.pos,f=d.type,g=a[h].leadType;if(p="number"==typeof p?Object(w.Ti2Px)(p):0,c=g,4!==f&&(t?e<=p:e<p)){switch(f){case 0:r=v.c;break;case 1:r=v.a;break;case 2:r=v.d;break;case 3:r=v.b;break;default:r=v.c}var m=Object(C.a)(g);m?l=m:(l="\0",f=0),u=!0,s=p;break}}return h===a.length?{bRet:!1}:{bRet:!0,code:r,tabEndPos:s,leadingChar:l,isCustom:u,leadType:c}}return{bRet:!1}}},{key:"hasAutoNum",value:function(){var e=this.getPropVal("list_id"),t=this.getPropVal("list_level");return-1!==e&&t>=0&&t<=g.a}},{key:"clearAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e)for(var t in this)t in D||delete this[t];else for(var n in this)delete this[n]}},{key:"def",get:function(){return H}}]),t}(W)},897:function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(83))},908:function(e,t,n){"use strict";var i=n(1),o=n.n(i),a=n(2),r=n.n(a),s=n(626),l=n(1291),u=function(){function e(){o()(this,e)}return r()(e,null,[{key:"isTextSubline",value:function(e){return e instanceof l.a}}]),e}(),c=function(){function e(){o()(this,e)}return r()(e,null,[{key:"getPosition2coorsystem",value:function(t){if(!t.parent||t.parent.isCoorSystem())return t.position2parent;var n=e.getCompactNode4Child(t);return s.a.add(e.getPosition2coorsystem(n),n.offset4child,t.position2parent)}},{key:"getPosition2view",value:function(t){if(t.parent&&t.parent.isView())return t.position2parent;if(t.isEmbedShape)return s.a.add(e.getPosition2view(t.outer.parent),t.position2parent);if(t.isScene()&&!t.isChildShape)return s.a.add(e.getPosition2view(t.upper),t.position2parent);var n=e.getCompactNode4Child(t);return s.a.add(e.getPosition2view(n),n.offset4child,t.position2parent)}},{key:"getPosition2viewForMobile",value:function(t){if(!t.parent||t.parent.isView()){var n=t.position2parent;return t._drawingOffset&&(n={x:n.x-t._drawingOffset.x,y:n.y-t._drawingOffset.y}),n}var i=e.getCompactNode4Child(t);return s.a.add(e.getPosition2viewForMobile(i),i.offset4child,t.position2parent)}},{key:"getCompactNode4Child",value:function(e){return u.isTextSubline(e)?e.parent.parent:e.parent}},{key:"transvertPositionFromNode2Target",value:function(t,n){if(t===n)return s.a.ZERO();var i=null;i=n.isCoorSystem()?{coor_node:n,pos_2_coor:s.a.ZERO(),isContainTarget:!0}:e.findoutPositionInfoAndDetectTarget(n,n);for(var o=t,a=null,r=s.a.ZERO(),l=s.a.ZERO(),u=s.a.ZERO();;){if((a=e.findoutPositionInfoAndDetectTarget(o,n)).coor_node===i.coor_node||i.coor_node.decorativePage&&a.coor_node===i.coor_node.decorativePage){l=a.pos_2_coor,u=i.pos_2_coor;var c=s.a.reduce(l,u);r=s.a.add(r,c);break}r=s.a.add(r,a.pos_2_coor),o=a.coor_node}return r}},{key:"findoutPositionInfoAndDetectTarget",value:function(e,t){if(!e)return console.warn("[findOutNodeCoorsystem] node is null"),null;var n=!1;try{var i=e;n=i===t||i.isDecorativePage&&i.contentPage===t;var o=s.a.ZERO();do{if(n=n||i===t||i.isDecorativePage&&i.contentPage===t,o=s.a.add(o,i.position2parent),i.outer)if(i.isEmbedShape)i=i.outer.parent,o=s.a.add(o,i.parent.cell2page_offset);else if(i.isWrap)i=i.outer.parent.parent;else if(i.isChildShape){var a=i.rect2TopShape;o=s.a.add(o,{x:a.left,y:a.top}),i=i.topShape}else{for(var r=i.linkLayers;r.parentLayers;)r=r.parentLayers;i=r.parent}else i=i.isDecorativePage?i.contentPage:i.parent}while(null!=i&&!i.isCoorSystem());return{coor_node:i,pos_2_coor:o,isContainTarget:n}}catch(e){console.error(e)}}}]),e}();t.a=c},936:function(e,t,n){var i=n(563),o=n(1105),a=n(1048),r=Math.max,s=Math.min;e.exports=function(e,t,n){var l,u,c,h,d,p,f=0,g=!1,v=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function _(t){var n=l,i=u;return l=u=void 0,f=t,h=e.apply(i,n)}function y(e){return f=e,d=setTimeout(T,t),g?_(e):h}function b(e){var n=e-p;return void 0===p||n>=t||n<0||v&&e-f>=c}function T(){var e=o();if(b(e))return C(e);d=setTimeout(T,function(e){var n=t-(e-p);return v?s(n,c-(e-f)):n}(e))}function C(e){return d=void 0,m&&l?_(e):(l=u=void 0,h)}function k(){var e=o(),n=b(e);if(l=arguments,u=this,p=e,n){if(void 0===d)return y(p);if(v)return clearTimeout(d),d=setTimeout(T,t),_(p)}return void 0===d&&(d=setTimeout(T,t)),h}return t=a(t)||0,i(n)&&(g=!!n.leading,c=(v="maxWait"in n)?r(a(n.maxWait)||0,t):c,m="trailing"in n?!!n.trailing:m),k.cancel=function(){void 0!==d&&clearTimeout(d),f=0,l=p=u=d=void 0},k.flush=function(){return void 0===d?h:C(o())},k}},952:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={debug:!1,getMakedName:function(e){return"delaymember_"+e+"_maked"},makeOnce:function(e,t,n){return i.debug&&(e[i.getMakedName(t)]&&console.warn("[DelayMember] double maked ["+t+"] of",e),e[i.getMakedName(t)]=!0),n(e)},bind:function(e,t,n){Object.defineProperty(e,[t],{enumerable:!0,configurable:!0,get:function(){var o=i.makeOnce(e,t,n);return Object.defineProperty(e,[t],{enumerable:!0,configurable:!0,writable:!0,value:o}),o}})}}},966:function(e,t,n){"use strict";n.r(t),n.d(t,"CR_TYPE",(function(){return i})),n.d(t,"TEMP",(function(){return o})),n.d(t,"NOTIFY_TYPE",(function(){return a})),n.d(t,"DOC_TYPE",(function(){return r}));var i={revision:"revision",comments:"comments"},o="temp",a={deleteText:"DeleteText",insertText:"InsertText",setProp:"SetProp",insertComment:"InsertComment",insertComments:"InsertComments",insertCommentText:"InsertCommentText",removeComment:"RemoveComment",removeComments:"RemoveComments",deleteCommentText:"DeleteCommentText",delInsSame:"DelInsSame",updateComments:"UpdateComments"},r={head:"head",foot:"foot",main:"main"}},967:function(e,t,n){var i=n(637),o=Object.prototype,a=o.hasOwnProperty,r=o.toString,s=i?i.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),n=e[s];try{e[s]=void 0;var i=!0}catch(e){}var o=r.call(e);return i&&(t?e[s]=n:delete e[s]),o}},968:function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},984:function(e,t,n){"use strict";n.r(t),n.d(t,"setStatus",(function(){return s})),n.d(t,"getStatus",(function(){return l})),n.d(t,"deleteStatus",(function(){return u})),n.d(t,"clearExpireItems",(function(){return c})),n.d(t,"types",(function(){return o}));var i=n(2698),o={DOCMAP:"DOCMAP",TYPOMODE:"TYPOMODE",INK_SCROLL_TIPS:"INK_SCROLL_TIPS",SPELLCHECKAUTOOPEN:"SPELLCHECKAUTOOPEN",SPELLCHECKIGNOREWORDS:"SPELLCHECKIGNOREWORDS",SPELLCHECKREPLACEWORDS:"SPELLCHECKREPLACEWORDS",FONTCOLOR:"FONTCOLOR",HIGHLIGHTCOLOR:"HIGHLIGHTCOLOR",SHOW_COMMENT:"SHOW_COMMENT",READING_MODE_FONT_SIZE:"READING_MODE_FONT_SIZE",READING_MODE_LINE_SPACING:"READING_MODE_LINE_SPACING",TASK_PANEL_OPENED:"TASK_PANEL_OPENED",OFFICIAL_DOCUMENT_FIELD_DELETE_OPTION:"OFFICIAL_DOCUMENT_FIELD_DELETE_OPTION",KEYBOARD_ACTIVE_NOTICE:"KEYBOARD_ACTIVE_NOTICE",STORE_GCP:"STORE_GCP",STORE_GCP_SWITCH:"STORE_GCP_SWITCH",REVISION_VIEW:"REVISION_VIEW",REVISION_SHOW_MARK:"REVISION_SHOW_MARK",REVISION_SHOW_FRAME:"REVISION_FRAME",REVISION_MODE:"REVISION_MODE",NOT_SHOW_DASHED_BORDER:"NOT_SHOW_DASHED_BORDER",MISSING_FONT_ALERT_HIDDEN:"MISSING_FONT_ALERT_HIDDEN"},a=function(e,t){return t||(new Date).getTime()+(e?12096e5:94608e7)},r=function(e,t){return"w-st-"+e+(t?"-"+Object(i.a)():"")},s=function(e,t,n,i){window.localStorage.setItem(r(e,n),JSON.stringify({value:void 0!==t&&t,expire:a(n,i)}))},l=function(e,t){var n=window.localStorage.getItem(r(e,t));if(n){var i=JSON.parse(n),o=i.value,a=i.expire,s=(new Date).getTime();if(a&&a>s)return o}return null},u=function(e,t){var n=r(e,t);n in window.localStorage&&window.localStorage.removeItem(n)},c=function(){var e=(new Date).getTime(),t=[];for(var n in window.localStorage)0===n.indexOf("w-st")&&(JSON.parse(window.localStorage.getItem(n)).expire||0)<e&&t.push(n);return t.forEach((function(e){window.localStorage.removeItem(e)})),!0}},985:function(e,t,n){var i=n(742),o=n(716);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==i(e)}}}]);